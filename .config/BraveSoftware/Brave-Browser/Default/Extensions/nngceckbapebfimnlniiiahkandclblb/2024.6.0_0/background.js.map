{"version":3,"file":"background.js","mappings":"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ACA,SACA,UACA,SACA,SACA,WACA,QACA,SACA,YACA,YACA,YACA,YACA,YACA,OACA,UACA,SACA,SACA,QACA,YACA,SACA,QACA,UACA,QACA,WACA,UACA,YACA,QACA,YACA,YACA,SACA,WACA,YACA,UACA,QACA,OACA,OACA,OACA,MACA,OACA,YACA,QACA,YACA,QACA,UACA,UACA,YACA,QACA,QACA,YACA,WACA,SACA,QACA,QACA,WACA,WACA,UACA,WACA,SACA,OACA,QACA,QACA,QACA,YACA,QACA,WACA,UACA,WACA,WACA,OACA,WACA,SACA,SACA,WACA,QACA,YACA,QACA,WACA,YACA,YACA,WACA,YACA,YACA,SACA,YACA,YACA,SACA,UACA,UACA,WACA,OACA,QACA,QACA,QACA,UACA,WACA,UACA,WACA,QACA,SACA,WACA,QACA,YACA,UACA,QACA,QACA,SACA,WACA,SACA,YACA,SACA,UACA,WACA,YACA,UACA,YACA,UACA,SACA,UACA,UACA,UACA,SACA,SACA,WACA,OACA,YACA,UACA,QACA,SACA,SACA,SACA,UACA,UACA,YACA,YACA,UACA,SACA,UACA,YACA,YACA,WACA,QACA,YACA,QACA,QACA,WACA,YACA,WACA,WACA,UACA,WACA,UACA,YACA,UACA,YACA,WACA,WACA,WACA,SACA,UACA,YACA,WACA,SACA,WACA,WACA,YACA,WACA,YACA,WACA,YACA,YACA,YACA,YACA,SACA,UACA,QACA,QACA,UACA,SACA,UACA,SACA,WACA,WACA,UACA,SACA,WACA,QACA,SACA,UACA,YACA,SACA,UACA,YACA,YACA,WACA,WACA,YACA,UACA,WACA,QACA,YACA,YACA,UACA,QACA,YACA,YACA,YACA,YACA,WACA,WACA,UACA,UACA,QACA,QACA,WACA,QACA,OACA,WACA,YACA,YACA,WACA,OACA,QACA,WACA,WACA,QACA,QACA,YACA,UACA,WACA,QACA,SACA,UACA,SACA,UACA,UACA,UACA,SACA,UACA,OACA,QACA,QACA,SACA,UACA,UACA,QACA,SACA,UACA,SACA,YACA,WACA,QACA,MACA,SACA,YACA,SACA,YACA,UACA,QACA,QACA,OACA,QACA,QACA,SACA,YACA,SACA,WACA,SACA,UACA,WACA,UACA,UACA,YACA,YACA,YACA,SACA,WACA,QACA,OACA,WACA,OACA,SACA,YACA,UACA,SACA,SACA,UACA,YACA,WACA,YACA,YACA,SACA,QACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,WACA,UACA,UACA,WACA,QACA,WACA,YACA,SACA,YACA,SACA,SACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,SACA,SACA,WACA,SACA,UACA,WACA,QACA,WACA,UACA,OACA,QACA,QACA,SACA,QACA,QACA,SACA,UACA,SACA,QACA,OACA,OACA,SACA,WACA,SACA,SACA,WACA,YACA,YACA,WACA,SACA,SACA,YACA,WACA,WACA,UACA,YACA,WACA,WACA,YACA,UACA,UACA,WACA,YACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,YACA,SACA,WACA,WACA,YACA,WACA,QACA,WACA,YACA,SACA,QACA,UACA,QACA,UACA,SACA,WACA,QACA,SACA,UACA,SACA,SACA,YACA,UACA,QACA,UACA,WACA,QACA,SACA,WACA,SACA,UACA,YACA,UACA,QACA,WACA,SACA,SACA,SACA,WACA,QACA,WACA,WACA,SACA,SACA,UACA,WACA,WACA,SACA,YACA,UACA,SACA,WACA,SACA,UACA,SACA,UACA,QACA,WACA,UACA,WACA,SACA,UACA,SACA,OACA,YACA,UACA,YACA,SACA,WACA,YACA,UACA,WACA,YACA,WACA,OACA,YACA,SACA,QACA,QACA,QACA,SACA,SACA,QACA,OACA,QACA,OACA,YACA,WACA,YACA,UACA,UACA,SACA,SACA,UACA,UACA,UACA,QACA,OACA,QACA,UACA,YACA,YACA,QACA,YACA,YACA,QACA,WACA,YACA,SACA,UACA,SACA,QACA,QACA,UACA,QACA,QACA,WACA,QACA,QACA,UACA,UACA,WACA,SACA,OACA,WACA,QACA,WACA,UACA,WACA,OACA,OACA,WACA,WACA,UACA,OACA,SACA,UACA,QACA,SACA,YACA,QACA,QACA,UACA,SACA,QACA,QACA,WACA,UACA,WACA,WACA,OACA,SACA,UACA,SACA,SACA,UACA,UACA,YACA,OACA,SACA,SACA,QACA,OACA,MACA,UACA,OACA,UACA,SACA,UACA,WACA,QACA,WACA,WACA,WACA,QACA,UACA,SACA,SACA,QACA,OACA,YACA,YACA,OACA,YACA,SACA,QACA,SACA,UACA,WACA,UACA,QACA,QACA,QACA,SACA,UACA,WACA,YACA,OACA,YACA,WACA,SACA,QACA,OACA,SACA,WACA,SACA,SACA,WACA,SACA,WACA,YACA,YACA,SACA,SACA,QACA,SACA,UACA,OACA,SACA,SACA,WACA,YACA,UACA,WACA,SACA,SACA,WACA,UACA,UACA,QACA,QACA,QACA,QACA,UACA,UACA,SACA,YACA,OACA,QACA,QACA,UACA,UACA,YACA,UACA,UACA,YACA,YACA,UACA,UACA,YACA,YACA,YACA,UACA,WACA,SACA,SACA,YACA,SACA,SACA,WACA,QACA,QACA,UACA,WACA,YACA,SACA,WACA,WACA,SACA,WACA,QACA,QACA,WACA,QACA,YACA,SACA,WACA,SACA,YACA,SACA,SACA,SACA,WACA,WACA,YACA,YACA,WACA,WACA,UACA,QACA,SACA,UACA,SACA,SACA,UACA,UACA,QACA,OACA,QACA,YACA,SACA,OACA,UACA,YACA,YACA,WACA,WACA,UACA,UACA,UACA,WACA,WACA,WACA,QACA,QACA,SACA,SACA,SACA,UACA,YACA,WACA,QACA,OACA,SACA,OACA,SACA,UACA,OACA,WACA,OACA,SACA,UACA,SACA,YACA,QACA,UACA,QACA,SACA,QACA,SACA,SACA,QACA,QACA,WACA,UACA,OACA,UACA,OACA,WACA,WACA,UACA,YACA,WACA,UACA,YACA,OACA,UACA,UACA,UACA,YACA,QACA,SACA,WACA,SACA,WACA,UACA,WACA,SACA,QACA,SACA,SACA,UACA,SACA,QACA,OACA,SACA,WACA,WACA,SACA,UACA,SACA,SACA,SACA,QACA,YACA,SACA,UACA,SACA,UACA,UACA,WACA,OACA,YACA,UACA,UACA,SACA,YACA,UACA,UACA,UACA,YACA,UACA,YACA,UACA,UACA,QACA,UACA,SACA,YACA,SACA,UACA,WACA,WACA,YACA,YACA,YACA,WACA,SACA,YACA,QACA,SACA,UACA,UACA,WACA,UACA,YACA,WACA,YACA,QACA,YACA,YACA,UACA,UACA,UACA,SACA,YACA,QACA,SACA,WACA,SACA,UACA,YACA,YACA,QACA,UACA,UACA,UACA,OACA,OACA,SACA,SACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,WACA,SACA,UACA,WACA,WACA,UACA,YACA,WACA,UACA,SACA,SACA,SACA,UACA,YACA,SACA,QACA,UACA,YACA,SACA,SACA,YACA,QACA,UACA,YACA,UACA,WACA,WACA,UACA,SACA,SACA,QACA,SACA,YACA,WACA,WACA,SACA,SACA,SACA,WACA,WACA,YACA,YACA,YACA,UACA,WACA,WACA,QACA,WACA,QACA,QACA,UACA,YACA,UACA,YACA,WACA,SACA,SACA,UACA,QACA,QACA,YACA,WACA,UACA,QACA,UACA,YACA,YACA,WACA,UACA,WACA,UACA,UACA,QACA,UACA,UACA,WACA,QACA,UACA,SACA,WACA,WACA,WACA,UACA,WACA,SACA,WACA,UACA,QACA,QACA,SACA,SACA,OACA,YACA,UACA,QACA,YACA,SACA,QACA,QACA,UACA,QACA,WACA,SACA,UACA,QACA,QACA,YACA,YACA,YACA,WACA,YACA,YACA,QACA,QACA,QACA,OACA,WACA,SACA,WACA,WACA,QACA,WACA,WACA,SACA,YACA,UACA,QACA,UACA,WACA,SACA,OACA,SACA,UACA,WACA,SACA,SACA,QACA,OACA,SACA,QACA,QACA,QACA,QACA,QACA,WACA,QACA,SACA,WACA,SACA,WACA,WACA,YACA,SACA,UACA,UACA,WACA,UACA,SACA,SACA,OACA,QACA,QACA,OACA,QACA,WACA,SACA,SACA,QACA,YACA,QACA,WACA,UACA,UACA,WACA,UACA,WACA,UACA,QACA,QACA,QACA,UACA,SACA,WACA,OACA,OACA,QACA,QACA,QACA,UACA,QACA,SACA,YACA,WACA,QACA,SACA,UACA,SACA,UACA,WACA,QACA,SACA,WACA,OACA,SACA,QACA,UACA,QACA,QACA,UACA,WACA,UACA,UACA,WACA,QACA,SACA,UACA,WACA,YACA,QACA,WACA,SACA,SACA,YACA,SACA,UACA,QACA,YACA,UACA,UACA,WACA,YACA,YACA,OACA,WACA,SACA,UACA,SACA,QACA,UACA,MACA,WACA,SACA,UACA,SACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,OACA,OACA,OACA,OACA,WACA,WACA,UACA,WACA,SACA,YACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,SACA,WACA,OACA,OACA,OACA,UACA,QACA,QACA,SACA,QACA,WACA,UACA,UACA,WACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,SACA,UACA,SACA,YACA,WACA,WACA,YACA,UACA,YACA,WACA,WACA,YACA,WACA,YACA,UACA,UACA,UACA,WACA,UACA,YACA,UACA,QACA,YACA,UACA,WACA,WACA,SACA,WACA,YACA,YACA,UACA,YACA,YACA,UACA,OACA,UACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,YACA,UACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,WACA,WACA,UACA,YACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,UACA,YACA,YACA,WACA,UACA,UACA,UACA,UACA,WACA,UACA,YACA,UACA,UACA,YACA,OACA,SACA,SACA,UACA,SACA,UACA,SACA,OACA,QACA,OACA,WACA,YACA,UACA,SACA,SACA,SACA,YACA,YACA,WACA,WACA,YACA,QACA,WACA,UACA,WACA,YACA,SACA,UACA,WACA,UACA,YACA,YACA,UACA,SACA,SACA,WACA,YACA,SACA,SACA,YACA,OACA,UACA,SACA,QACA,QACA,QACA,YACA,YACA,WACA,YACA,UACA,SACA,UACA,WACA,QACA,UACA,WACA,UACA,SACA,WACA,OACA,WACA,YACA,WACA,WACA,SACA,WACA,UACA,WACA,YACA,YACA,SACA,QACA,YACA,QACA,UACA,UACA,QACA,QACA,QACA,UACA,WACA,WACA,WACA,WACA,SACA,SACA,UACA,YACA,QACA,UACA,UACA,YACA,SACA,WACA,YACA,SACA,WACA,WACA,WACA,WACA,WACA,SACA,QACA,QACA,SACA,QACA,QACA,WACA,UACA,WACA,YACA,UACA,WACA,UACA,WACA,OACA,UACA,QACA,QACA,QACA,UACA,SACA,WACA,UACA,UACA,UACA,WACA,UACA,YACA,SACA,WACA,UACA,QACA,QACA,QACA,QACA,OACA,QACA,SACA,UACA,UACA,QACA,QACA,UACA,UACA,YACA,UACA,YACA,UACA,QACA,YACA,SACA,UACA,WACA,WACA,YACA,UACA,WACA,YACA,UACA,UACA,WACA,QACA,OACA,SACA,UACA,UACA,YACA,OACA,UACA,UACA,WACA,SACA,SACA,WACA,WACA,YACA,WACA,UACA,YACA,WACA,UACA,YACA,UACA,QACA,SACA,UACA,UACA,UACA,SACA,OACA,SACA,SACA,SACA,SACA,YACA,UACA,QACA,QACA,QACA,UACA,SACA,UACA,SACA,SACA,YACA,QACA,QACA,QACA,OACA,SACA,UACA,YACA,UACA,YACA,WACA,YACA,UACA,MACA,QACA,SACA,UACA,UACA,WACA,SACA,YACA,YACA,MACA,MACA,WACA,SACA,QACA,WACA,SACA,QACA,QACA,WACA,QACA,UACA,YACA,SACA,WACA,QACA,SACA,SACA,WACA,YACA,QACA,WACA,WACA,YACA,UACA,WACA,WACA,UACA,OACA,OACA,YACA,OACA,YACA,OACA,WACA,SACA,WACA,WACA,UACA,OACA,SACA,WACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,WACA,SACA,YACA,WACA,SACA,UACA,YACA,QACA,OACA,YACA,SACA,WACA,QACA,UACA,WACA,SACA,QACA,SACA,SACA,QACA,QACA,YACA,QACA,WACA,SACA,WACA,YACA,WACA,UACA,SACA,YACA,YACA,UACA,YACA,UACA,YACA,WACA,OACA,WACA,UACA,SACA,YACA,YACA,YACA,QACA,WACA,SACA,WACA,YACA,SACA,SACA,OACA,OACA,SACA,SACA,WACA,SACA,WACA,SACA,UACA,SACA,YACA,YACA,YACA,WACA,UACA,YACA,WACA,WACA,WACA,UACA,SACA,WACA,SACA,WACA,UACA,YACA,WACA,YACA,YACA,QACA,WACA,UACA,UACA,SACA,SACA,OACA,WACA,YACA,WACA,SACA,YACA,QACA,WACA,QACA,WACA,YACA,SACA,WACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,UACA,QACA,SACA,WACA,SACA,YACA,YACA,WACA,SACA,YACA,WACA,SACA,WACA,YACA,YACA,WACA,SACA,QACA,SACA,QACA,UACA,SACA,UACA,UACA,OACA,YACA,YACA,WACA,YACA,SACA,UACA,YACA,WACA,SACA,SACA,SACA,WACA,YACA,YACA,UACA,UACA,QACA,WACA,SACA,SACA,WACA,QACA,UACA,YACA,UACA,YACA,YACA,WACA,WACA,YACA,YACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,YACA,WACA,WACA,SACA,YACA,YACA,WACA,YACA,YACA,SACA,WACA,YACA,WACA,UACA,QACA,UACA,WACA,UACA,UACA,YACA,WACA,SACA,UACA,YACA,UACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,YACA,YACA,UACA,OACA,WACA,SACA,YACA,QACA,OACA,SACA,UACA,YACA,WACA,YACA,WACA,WACA,YACA,YACA,MACA,WACA,YACA,WACA,OACA,SACA,OACA,WACA,QACA,SACA,SACA,UACA,SACA,QACA,UACA,SACA,YACA,QACA,QACA,SACA,SACA,UACA,UACA,UACA,SACA,SACA,UACA,WACA,YACA,YACA,WACA,YACA,WACA,YACA,WACA,WACA,WACA,SACA,WACA,WACA,UACA,YACA,WACA,UACA,UACA,YACA,WACA,WACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,WACA,OACA,YACA,UACA,OACA,UACA,YACA,YACA,WACA,WACA,YACA,SACA,UACA,WACA,UACA,WACA,SACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,YACA,WACA,UACA,WACA,UACA,YACA,UACA,WACA,WACA,UACA,WACA,UACA,WACA,UACA,WACA,WACA,WACA,WACA,QACA,QACA,QACA,YACA,UACA,WACA,WACA,WACA,WACA,SACA,WACA,YACA,YACA,WACA,WACA,WACA,YACA,QACA,SACA,SACA,OACA,WACA,WACA,QACA,QACA,QACA,QACA,OACA,SACA,YACA,SACA,QACA,UACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,UACA,QACA,QACA,SACA,WACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,WACA,UACA,QACA,OACA,YACA,SACA,SACA,OACA,SACA,WACA,SACA,OACA,OACA,QACA,OACA,OACA,WACA,YACA,YACA,WACA,YACA,WACA,UACA,UACA,YACA,WACA,YACA,QACA,UACA,UACA,OACA,UACA,WACA,YACA,YACA,WACA,YACA,YACA,YACA,SACA,SACA,WACA,SACA,SACA,QACA,OACA,UACA,QACA,QACA,QACA,UACA,WACA,YACA,WACA,WACA,SACA,WACA,SACA,SACA,WACA,UACA,UACA,UACA,QACA,QACA,QACA,YACA,UACA,WACA,UACA,UACA,UACA,QACA,QACA,WACA,SACA,OACA,MACA,SACA,YACA,UACA,WACA,UACA,WACA,WACA,QACA,OACA,OACA,SACA,SACA,MACA,OACA,SACA,WACA,OACA,UACA,WACA,WACA,MACA,OACA,SACA,YACA,YACA,UACA,UACA,WACA,SACA,SACA,OACA,OACA,UACA,OACA,QACA,QACA,QACA,UACA,UACA,WACA,UACA,YACA,UACA,WACA,UACA,WACA,WACA,OACA,QACA,UACA,UACA,UACA,SACA,UACA,QACA,UACA,UACA,WACA,WACA,WACA,UACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,SACA,UACA,QACA,UACA,SACA,WACA,SACA,YACA,YACA,SACA,WACA,UACA,QACA,SACA,SACA,OACA,OACA,QACA,QACA,QACA,YACA,OACA,SACA,UACA,YACA,UACA,WACA,YACA,UACA,YACA,YACA,OACA,WACA,SACA,OACA,UACA,SACA,WACA,YACA,WACA,MACA,YACA,UACA,YACA,SACA,YACA,SACA,SACA,WACA,WACA,YACA,UACA,YACA,SACA,QACA,YACA,UACA,SACA,QACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,UACA,YACA,YACA,WACA,SACA,MACA,WACA,WACA,YACA,QACA,UACA,SACA,MACA,UACA,WACA,MACA,YACA,QACA,YACA,WACA,YACA,QACA,UACA,QACA,QACA,UACA,SACA,UACA,YACA,YACA,QACA,WACA,UACA,SACA,SACA,WACA,SACA,YACA,QACA,UACA,YACA,WACA,OACA,QACA,WACA,UACA,WACA,UACA,UACA,WACA,WACA,YACA,WACA,YACA,WACA,WACA,WACA,WACA,UACA,UACA,YACA,QACA,MACA,SACA,YACA,SACA,YACA,YACA,WACA,UACA,YACA,SACA,SACA,YACA,YACA,WACA,UACA,UACA,WACA,WACA,YACA,QACA,SACA,UACA,UACA,YACA,YACA,UACA,YACA,WACA,YACA,YACA,WACA,YACA,WACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,WACA,WACA,YACA,UACA,SACA,UACA,YACA,YACA,YACA,UACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,SACA,SACA,SACA,UACA,UACA,SACA,SACA,YACA,WACA,YACA,WACA,SACA,UACA,SACA,SACA,YACA,SACA,SACA,WACA,UACA,WACA,UACA,YACA,WACA,WACA,WACA,UACA,WACA,QACA,OACA,SACA,OACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,WACA,UACA,QACA,SACA,WACA,UACA,UACA,YACA,SACA,YACA,YACA,WACA,SACA,SACA,UACA,YACA,SACA,SACA,UACA,QACA,QACA,WACA,YACA,YACA,WACA,WACA,WACA,SACA,YACA,YACA,WACA,UACA,QACA,UACA,YACA,YACA,SACA,WACA,WACA,YACA,YACA,WACA,UACA,UACA,WACA,UACA,QACA,YACA,SACA,YACA,WACA,UACA,QACA,WACA,YACA,YACA,UACA,UACA,OACA,YACA,YACA,YACA,WACA,WACA,QACA,WACA,UACA,OACA,QACA,YACA,SACA,QACA,UACA,UACA,WACA,YACA,YACA,YACA,SACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,SACA,YACA,YACA,YACA,YACA,QACA,OACA,YACA,SACA,UACA,SACA,QACA,WACA,OACA,SACA,YACA,WACA,WACA,SACA,UACA,YACA,YACA,YACA,YACA,YACA,QACA,SACA,WACA,YACA,SACA,SACA,WACA,UACA,YACA,WACA,UACA,UACA,UACA,YACA,WACA,WACA,YACA,SACA,WACA,UACA,YACA,YACA,WACA,YACA,SACA,YACA,WACA,WACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,WACA,YACA,UACA,SACA,WACA,SACA,YACA,UACA,UACA,SACA,YACA,UACA,UACA,OACA,SACA,UACA,SACA,OACA,QACA,UACA,OACA,WACA,SACA,SACA,WACA,UACA,UACA,YACA,QACA,UACA,OACA,UACA,YACA,YACA,UACA,UACA,WACA,SACA,UACA,WACA,SACA,YACA,YACA,UACA,WACA,WACA,MACA,QACA,UACA,SACA,SACA,OACA,OACA,SACA,SACA,WACA,WACA,WACA,WACA,WACA,QACA,QACA,UACA,SACA,UACA,WACA,YACA,WACA,SACA,SACA,QACA,SACA,SACA,WACA,UACA,YACA,QACA,QACA,QACA,QACA,UACA,SACA,WACA,WACA,YACA,UACA,UACA,QACA,WACA,QACA,UACA,SACA,WACA,SACA,SACA,SACA,UACA,OACA,SACA,QACA,WACA,SACA,WACA,WACA,UACA,UACA,YACA,QACA,WACA,QACA,UACA,WACA,WACA,YACA,SACA,UACA,UACA,WACA,MACA,OACA,UACA,UACA,WACA,WACA,YACA,YACA,QACA,UACA,QACA,QACA,YACA,UACA,WACA,WACA,OACA,UACA,YACA,YACA,YACA,WACA,WACA,SACA,QACA,UACA,WACA,SACA,WACA,UACA,YACA,YACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,OACA,UACA,SACA,QACA,QACA,SACA,SACA,QACA,QACA,OACA,QACA,QACA,QACA,WACA,OACA,SACA,UACA,QACA,WACA,UACA,UACA,QACA,SACA,UACA,WACA,OACA,MACA,MACA,OACA,QACA,OACA,WACA,SACA,WACA,SACA,WACA,SACA,OACA,OACA,OACA,UACA,WACA,WACA,YACA,SACA,WACA,WACA,WACA,UACA,WACA,UACA,WACA,UACA,WACA,YACA,WACA,UACA,WACA,WACA,WACA,SACA,SACA,UACA,WACA,WACA,MACA,QACA,WACA,WACA,UACA,YACA,WACA,YACA,WACA,QACA,QACA,UACA,UACA,YACA,SACA,UACA,QACA,WACA,WACA,WACA,UACA,UACA,UACA,WACA,WACA,UACA,WACA,SACA,YACA,WACA,YACA,WACA,UACA,WACA,YACA,WACA,UACA,SACA,WACA,SACA,YACA,WACA,QACA,UACA,UACA,WACA,SACA,SACA,QACA,SACA,WACA,YACA,YACA,WACA,QACA,SACA,UACA,QACA,UACA,YACA,SACA,OACA,QACA,YACA,UACA,WACA,WACA,YACA,SACA,QACA,QACA,SACA,WACA,YACA,WACA,QACA,YACA,SACA,MACA,QACA,MACA,YACA,UACA,QACA,OACA,YACA,WACA,UACA,SACA,SACA,UACA,YACA,SACA,YACA,WACA,OACA,SACA,QACA,SACA,SACA,WACA,UACA,MACA,SACA,UACA,SACA,SACA,UACA,SACA,UACA,SACA,UACA,SACA,MACA,WACA,YACA,SACA,UACA,WACA,QACA,OACA,OACA,SACA,OACA,QACA,OACA,SACA,MACA,SACA,UACA,WACA,WACA,QACA,UACA,YACA,SACA,QACA,YACA,WACA,YACA,UACA,YACA,WACA,WACA,SACA,YACA,YACA,YACA,WACA,YACA,UACA,YACA,UACA,UACA,UACA,QACA,QACA,YACA,SACA,UACA,YACA,QACA,OACA,WACA,YACA,WACA,SACA,WACA,SACA,SACA,SACA,QACA,UACA,SACA,WACA,QACA,QACA,SACA,QACA,UACA,UACA,UACA,QACA,YACA,SACA,YACA,UACA,SACA,WACA,YACA,QACA,UACA,QACA,WACA,UACA,WACA,UACA,SACA,UACA,UACA,UACA,UACA,SACA,UACA,SACA,UACA,WACA,WACA,SACA,YACA,YACA,UACA,WACA,QACA,QACA,QACA,UACA,WACA,UACA,OACA,SACA,YACA,UACA,SACA,OACA,OACA,WACA,OACA,UACA,QACA,WACA,WACA,YACA,OACA,UACA,QACA,UACA,OACA,OACA,OACA,QACA,WACA,YACA,QACA,SACA,OACA,SACA,OACA,SACA,WACA,OACA,UACA,SACA,SACA,SACA,OACA,OACA,OACA,WACA,YACA,WACA,YACA,SACA,SACA,WACA,UACA,YACA,WACA,WACA,UACA,WACA,QACA,WACA,WACA,UACA,UACA,UACA,WACA,UACA,SACA,UACA,QACA,WACA,QACA,QACA,UACA,YACA,QACA,QACA,YACA,UACA,UACA,YACA,WACA,SACA,YACA,SACA,YACA,YACA,UACA,QACA,OACA,UACA,WACA,WACA,YACA,SACA,QACA,UACA,WACA,OACA,YACA,OACA,QACA,YACA,WACA,WACA,QACA,UACA,YACA,QACA,YACA,QACA,SACA,WACA,OACA,UACA,OACA,WACA,SACA,QACA,QACA,SACA,WACA,SACA,QACA,SACA,UACA,QACA,QACA,SACA,UACA,QACA,OACA,SACA,WACA,WACA,UACA,UACA,YACA,UACA,WACA,SACA,QACA,YACA,WACA,WACA,QACA,UACA,YACA,QACA,OACA,WACA,QACA,OACA,UACA,UACA,YACA,UACA,QACA,SACA,WACA,OACA,OACA,QACA,QACA,UACA,OACA,SACA,MACA,UACA,WACA,YACA,WACA,UACA,WACA,SACA,SACA,UACA,UACA,MACA,UACA,QACA,OACA,UACA,OACA,SACA,SACA,YACA,SACA,UACA,SACA,UACA,YACA,UACA,WACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,SACA,UACA,WACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,SACA,YACA,SACA,QACA,YACA,YACA,UACA,WACA,UACA,YACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,WACA,YACA,UACA,WACA,YACA,SACA,WACA,WACA,WACA,YACA,WACA,QACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,UACA,QACA,UACA,OACA,SACA,QACA,UACA,YACA,QACA,SACA,YACA,WACA,UACA,WACA,YACA,OACA,UACA,SACA,QACA,QACA,SACA,WACA,SACA,WACA,SACA,OACA,WACA,WACA,YACA,YACA,YACA,SACA,SACA,YACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,UACA,WACA,YACA,YACA,UACA,WACA,OACA,OACA,QACA,UACA,YACA,UACA,QACA,UACA,YACA,QACA,SACA,SACA,SACA,UACA,UACA,WACA,WACA,UACA,YACA,QACA,WACA,QACA,SACA,SACA,YACA,QACA,WACA,SACA,UACA,UACA,UACA,UACA,QACA,YACA,WACA,WACA,UACA,WACA,SACA,SACA,WACA,OACA,MACA,OACA,OACA,OACA,QACA,SACA,WACA,SACA,QACA,YACA,WACA,UACA,SACA,YACA,WACA,YACA,WACA,WACA,SACA,SACA,YACA,YACA,SACA,WACA,SACA,OACA,SACA,UACA,WACA,WACA,SACA,SACA,SACA,UACA,SACA,YACA,UACA,QACA,OACA,UACA,OACA,SACA,YACA,MACA,SACA,UACA,WACA,YACA,WACA,YACA,YACA,YACA,SACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,MACA,UACA,QACA,OACA,OACA,MACA,WACA,WACA,WACA,UACA,YACA,YACA,WACA,WACA,WACA,SACA,QACA,OACA,QACA,WACA,SACA,SACA,YACA,WACA,WACA,QACA,YACA,WACA,UACA,WACA,UACA,YACA,WACA,UACA,YACA,WACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,SACA,SACA,YACA,UACA,WACA,YACA,YACA,WACA,SACA,UACA,YACA,YACA,WACA,UACA,YACA,YACA,QACA,WACA,YACA,WACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,UACA,WACA,YACA,WACA,UACA,YACA,YACA,YACA,UACA,YACA,SACA,WACA,SACA,SACA,MACA,OACA,SACA,OACA,QACA,MACA,OACA,YACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,WACA,YACA,YACA,UACA,QACA,UACA,YACA,UACA,OACA,YACA,SACA,QACA,MACA,MACA,SACA,SACA,YACA,UACA,WACA,YACA,SACA,YACA,WACA,MACA,UACA,UACA,SACA,UACA,UACA,WACA,QACA,OACA,QACA,UACA,UACA,OACA,UACA,YACA,OACA,OACA,YACA,UACA,QACA,SACA,SACA,MACA,QACA,SACA,QACA,SACA,WACA,OACA,UACA,UACA,MACA,SACA,YACA,SACA,UACA,OACA,UACA,WACA,WACA,YACA,QACA,OACA,MACA,SACA,WACA,YACA,SACA,UACA,WACA,YACA,WACA,QACA,YACA,WACA,YACA,OACA,SACA,WACA,UACA,QACA,YACA,QACA,UACA,UACA,OACA,SACA,QACA,OACA,WACA,WACA,OACA,SACA,UACA,SACA,UACA,WACA,SACA,QACA,OACA,UACA,YACA,UACA,SACA,WACA,WACA,QACA,WACA,UACA,SACA,QACA,QACA,SACA,WACA,OACA,MACA,OACA,SACA,OACA,WACA,WACA,SACA,OACA,OACA,WACA,WACA,YACA,WACA,OACA,SACA,SACA,WACA,SACA,WACA,UACA,UACA,UACA,OACA,UACA,UACA,YACA,WACA,SACA,UACA,UACA,OACA,SACA,QACA,OACA,UACA,WACA,OACA,QACA,WACA,QACA,QACA,QACA,SACA,UACA,QACA,OACA,UACA,UACA,WACA,YACA,WACA,SACA,SACA,QACA,UACA,WACA,SACA,UACA,SACA,OACA,OACA,QACA,SACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,YACA,YACA,WACA,YACA,WACA,YACA,QACA,UACA,SACA,QACA,SACA,UACA,SACA,OACA,QACA,OACA,OACA,QACA,OACA,QACA,OACA,SACA,WACA,UACA,SACA,WACA,SACA,UACA,UACA,SACA,WACA,SACA,WACA,SACA,WACA,OACA,WACA,OACA,SACA,QACA,SACA,SACA,WACA,UACA,UACA,YACA,OACA,UACA,SACA,YACA,UACA,QACA,OACA,SACA,OACA,OACA,UACA,SACA,UACA,YACA,WACA,SACA,UACA,QACA,WACA,SACA,WACA,YACA,YACA,SACA,UACA,YACA,UACA,UACA,WACA,MACA,OACA,SACA,UACA,UACA,WACA,SACA,WACA,WACA,SACA,QACA,QACA,OACA,OACA,UACA,YACA,QACA,QACA,UACA,WACA,OACA,QACA,WACA,WACA,SACA,SACA,WACA,UACA,OACA,OACA,MACA,UACA,UACA,SACA,OACA,OACA,WACA,YACA,SACA,SACA,SACA,UACA,QACA,SACA,QACA,YACA,UACA,SACA,SACA,YACA,YACA,QACA,UACA,YACA,WACA,YACA,YACA,SACA,WACA,UACA,SACA,YACA,WACA,YACA,UACA,UACA,SACA,QACA,WACA,WACA,YACA,YACA,OACA,QACA,OACA,YACA,OACA,SACA,WACA,SACA,YACA,UACA,YACA,WACA,QACA,YACA,SACA,QACA,YACA,WACA,WACA,SACA,WACA,WACA,QACA,OACA,UACA,YACA,WACA,UACA,SACA,UACA,WACA,QACA,YACA,WACA,YACA,YACA,YACA,UACA,YACA,WACA,WACA,SACA,WACA,UACA,YACA,WACA,WACA,QACA,YACA,SACA,YACA,OACA,OACA,SACA,UACA,YACA,UACA,WACA,UACA,WACA,UACA,YACA,WACA,SACA,SACA,QACA,QACA,YACA,UACA,UACA,UACA,YACA,WACA,YACA,SACA,UACA,UACA,YACA,QACA,UACA,SACA,UACA,QACA,WACA,SACA,SACA,SACA,OACA,MACA,WACA,YACA,UACA,UACA,WACA,QACA,QACA,YACA,YACA,SACA,WACA,SACA,SACA,UACA,WACA,SACA,YACA,SACA,UACA,SACA,QACA,YACA,SACA,YACA,YACA,UACA,SACA,YACA,SACA,UACA,WACA,SACA,UACA,UACA,UACA,YACA,WACA,UACA,WACA,YACA,WACA,WACA,YACA,OACA,SACA,YACA,YACA,SACA,SACA,SACA,SACA,WACA,WACA,WACA,QACA,WACA,WACA,UACA,QACA,SACA,YACA,SACA,UACA,SACA,WACA,WACA,UACA,QACA,SACA,SACA,WACA,SACA,UACA,YACA,SACA,UACA,YACA,WACA,QACA,WACA,OACA,YACA,WACA,WACA,UACA,MACA,YACA,SACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,YACA,UACA,WACA,UACA,YACA,QACA,SACA,WACA,SACA,YACA,WACA,UACA,WACA,YACA,YACA,YACA,WACA,MACA,SACA,WACA,UACA,YACA,WACA,WACA,WACA,QACA,YACA,WACA,YACA,YACA,UACA,WACA,SACA,QACA,OACA,WACA,YACA,SACA,WACA,YACA,SACA,YACA,QACA,QACA,YACA,WACA,UACA,WACA,UACA,WACA,QACA,YACA,YACA,QACA,QACA,UACA,OACA,QACA,SACA,QACA,SACA,OACA,OACA,MACA,MACA,WACA,QACA,OACA,SACA,UACA,WACA,WACA,YACA,YACA,SACA,WACA,QACA,YACA,UACA,QACA,QACA,WACA,UACA,YACA,SACA,QACA,YACA,QACA,YACA,WACA,SACA,UACA,YACA,WACA,QACA,QACA,SACA,YACA,QACA,UACA,UACA,SACA,YACA,QACA,UACA,SACA,WACA,OACA,YACA,YACA,SACA,OACA,SACA,SACA,SACA,UACA,YACA,UACA,OACA,QACA,MACA,OACA,OACA,SACA,QACA,YACA,OACA,SACA,SACA,UACA,QACA,SACA,UACA,YACA,WACA,SACA,WACA,UACA,SACA,WACA,WACA,WACA,YACA,OACA,SACA,UACA,SACA,WACA,SACA,WACA,SACA,YACA,SACA,SACA,WACA,WACA,YACA,WACA,YACA,YACA,UACA,UACA,OACA,SACA,OACA,UACA,QACA,OACA,MACA,YACA,SACA,WACA,WACA,SACA,UACA,QACA,OACA,SACA,WACA,WACA,QACA,QACA,SACA,SACA,WACA,YACA,QACA,WACA,QACA,UACA,SACA,UACA,SACA,UACA,SACA,UACA,SACA,WACA,UACA,WACA,YACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,SACA,WACA,WACA,YACA,QACA,SACA,QACA,MACA,MACA,QACA,MACA,YACA,WACA,WACA,SACA,WACA,UACA,WACA,YACA,SACA,YACA,OACA,UACA,YACA,YACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,SACA,YACA,SACA,UACA,YACA,YACA,WACA,WACA,SACA,QACA,SACA,UACA,SACA,UACA,UACA,OACA,MACA,OACA,WACA,OACA,MACA,QACA,WACA,QACA,OACA,UACA,WACA,OACA,WACA,UACA,WACA,UACA,QACA,SACA,WACA,OACA,WACA,QACA,UACA,YACA,UACA,OACA,SACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,WACA,UACA,YACA,YACA,YACA,WACA,QACA,UACA,WACA,SACA,WACA,WACA,YACA,YACA,MACA,YACA,UACA,QACA,QACA,OACA,QACA,QACA,SACA,UACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,UACA,WACA,WACA,QACA,WACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,SACA,UACA,UACA,WACA,WACA,UACA,YACA,YACA,UACA,UACA,SACA,UACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,SACA,OACA,QACA,OACA,UACA,UACA,WACA,UACA,WACA,WACA,YACA,YACA,WACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,UACA,YACA,YACA,YACA,UACA,WACA,WACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,YACA,WACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,UACA,YACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,UACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,UACA,WACA,WACA,WACA,UACA,YACA,WACA,YACA,MACA,SACA,UACA,YACA,UACA,YACA,SACA,WACA,SACA,QACA,QACA,YACA,UACA,WACA,WACA,WACA,SACA,SACA,UACA,SACA,WACA,UACA,QACA,QACA,SACA,UACA,SACA,YACA,OACA,WACA,YACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,WACA,QACA,WACA,OACA,YACA,QACA,UACA,WACA,YACA,UACA,YACA,SACA,QACA,YACA,YACA,SACA,QACA,UACA,UACA,WACA,YACA,SACA,UACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,WACA,WACA,YACA,SACA,UACA,YACA,SACA,SACA,QACA,UACA,UACA,SACA,WACA,SACA,SACA,UACA,UACA,UACA,SACA,UACA,YACA,SACA,UACA,YACA,QACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,UACA,UACA,YACA,WACA,WACA,WACA,QACA,SACA,SACA,UACA,SACA,WACA,UACA,QACA,YACA,SACA,WACA,YACA,OACA,WACA,UACA,QACA,YACA,UACA,SACA,YACA,YACA,SACA,WACA,QACA,YACA,WACA,SACA,SACA,UACA,UACA,WACA,SACA,QACA,QACA,SACA,UACA,WACA,UACA,SACA,SACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,UACA,SACA,OACA,SACA,WACA,UACA,SACA,UACA,UACA,YACA,WACA,UACA,YACA,QACA,SACA,UACA,WACA,YACA,MACA,WACA,UACA,QACA,YACA,YACA,YACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,QACA,OACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,QACA,OACA,YACA,YACA,SACA,YACA,QACA,SACA,WACA,QACA,YACA,SACA,YACA,YACA,QACA,UACA,UACA,SACA,UACA,YACA,SACA,UACA,YACA,QACA,YACA,QACA,SACA,WACA,UACA,UACA,WACA,QACA,UACA,QACA,SACA,UACA,UACA,SACA,WACA,UACA,WACA,WACA,UACA,WACA,YACA,YACA,WACA,WACA,SACA,UACA,YACA,YACA,UACA,WACA,YACA,WACA,UACA,UACA,WACA,UACA,YACA,WACA,QACA,WACA,QACA,SACA,YACA,SACA,WACA,YACA,UACA,OACA,OACA,OACA,OACA,OACA,QACA,OACA,UACA,WACA,SACA,OACA,YACA,UACA,QACA,MACA,OACA,OACA,OACA,UACA,UACA,WACA,YACA,SACA,QACA,SACA,QACA,SACA,QACA,SACA,SACA,QACA,SACA,WACA,QACA,OACA,YACA,UACA,YACA,UACA,SACA,OACA,OACA,UACA,OACA,SACA,SACA,QACA,WACA,WACA,UACA,WACA,YACA,OACA,SACA,WACA,WACA,SACA,YACA,WACA,UACA,SACA,WACA,QACA,OACA,SACA,WACA,WACA,SACA,UACA,SACA,UACA,WACA,SACA,SACA,UACA,YACA,UACA,UACA,QACA,SACA,WACA,QACA,UACA,OACA,WACA,YACA,UACA,QACA,SACA,MACA,WACA,SACA,WACA,UACA,WACA,YACA,SACA,UACA,WACA,YACA,UACA,WACA,WACA,UACA,YACA,UACA,SACA,WACA,YACA,UACA,UACA,SACA,YACA,YACA,UACA,YACA,WACA,YACA,YACA,SACA,UACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,SACA,UACA,SACA,YACA,YACA,YACA,SACA,UACA,YACA,UACA,QACA,UACA,YACA,UACA,YACA,YACA,WACA,UACA,SACA,UACA,UACA,YACA,UACA,UACA,WACA,SACA,YACA,WACA,QACA,SACA,YACA,UACA,UACA,SACA,QACA,WACA,QACA,QACA,QACA,SACA,SACA,WACA,UACA,UACA,YACA,QACA,YACA,WACA,WACA,YACA,QACA,UACA,YACA,UACA,YACA,UACA,WACA,YACA,WACA,WACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,UACA,WACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,QACA,QACA,YACA,SACA,WACA,YACA,SACA,YACA,WACA,WACA,YACA,WACA,UACA,QACA,UACA,YACA,WACA,SACA,YACA,YACA,WACA,WACA,QACA,WACA,SACA,SACA,WACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,UACA,UACA,WACA,YACA,QACA,SACA,QACA,YACA,QACA,UACA,MACA,UACA,SACA,YACA,SACA,SACA,MACA,OACA,YACA,OACA,UACA,QACA,YACA,OACA,SACA,SACA,QACA,WACA,YACA,YACA,UACA,WACA,OACA,QACA,SACA,QACA,WACA,YACA,WACA,SACA,WACA,YACA,QACA,UACA,WACA,SACA,SACA,UACA,SACA,SACA,WACA,YACA,OACA,QACA,YACA,WACA,UACA,WACA,WACA,YACA,SACA,YACA,UACA,WACA,UACA,SACA,QACA,UACA,OACA,SACA,WACA,UACA,YACA,SACA,QACA,WACA,QACA,WACA,QACA,UACA,YACA,YACA,UACA,UACA,QACA,UACA,UACA,SACA,YACA,YACA,WACA,UACA,SACA,QACA,UACA,UACA,YACA,YACA,YACA,QACA,QACA,QACA,UACA,YACA,QACA,OACA,SACA,YACA,WACA,YACA,QACA,QACA,OACA,SACA,SACA,OACA,SACA,QACA,SACA,WACA,YACA,WACA,YACA,WACA,QACA,SACA,SACA,OACA,OACA,SACA,SACA,UACA,SACA,UACA,UACA,WACA,UACA,SACA,OACA,SACA,QACA,SACA,WACA,OACA,SACA,QACA,YACA,SACA,SACA,SACA,UACA,SACA,UACA,UACA,UACA,QACA,OACA,SACA,SACA,OACA,UACA,SACA,QACA,SACA,SACA,UACA,YACA,WACA,QACA,YACA,WACA,WACA,UACA,WACA,OACA,YACA,WACA,UACA,YACA,YACA,YACA,WACA,SACA,WACA,WACA,WACA,UACA,YACA,SACA,QACA,UACA,SACA,SACA,UACA,SACA,UACA,UACA,WACA,WACA,SACA,SACA,YACA,SACA,SACA,SACA,SACA,YACA,YACA,UACA,SACA,WACA,UACA,WACA,YACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,YACA,SACA,SACA,UACA,SACA,WACA,WACA,SACA,YACA,YACA,UACA,WACA,WACA,YACA,WACA,UACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,YACA,UACA,WACA,WACA,WACA,YACA,YACA,SACA,SACA,UACA,SACA,WACA,WACA,WACA,WACA,YACA,UACA,UACA,WACA,UACA,UACA,YACA,SACA,YACA,YACA,UACA,SACA,WACA,YACA,SACA,SACA,UACA,UACA,SACA,SACA,SACA,WACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,YACA,QACA,SACA,SACA,YACA,YACA,UACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,YACA,UACA,WACA,WACA,QACA,QACA,UACA,UACA,YACA,WACA,WACA,WACA,UACA,QACA,UACA,YACA,UACA,SACA,SACA,SACA,WACA,SACA,YACA,OACA,SACA,SACA,UACA,UACA,WACA,SACA,WACA,WACA,YACA,YACA,QACA,UACA,YACA,SACA,UACA,SACA,YACA,UACA,UACA,UACA,WACA,SACA,WACA,YACA,YACA,WACA,YACA,YACA,UACA,UACA,WACA,WACA,YACA,WACA,SACA,SACA,SACA,WACA,UACA,SACA,UACA,YACA,YACA,UACA,SACA,SACA,WACA,YACA,SACA,WACA,WACA,SACA,WACA,UACA,SACA,UACA,QACA,WACA,SACA,YACA,SACA,YACA,YACA,UACA,UACA,WACA,YACA,YACA,YACA,OACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,YACA,UACA,QACA,SACA,WACA,UACA,SACA,WACA,WACA,WACA,WACA,SACA,SACA,QACA,UACA,UACA,YACA,YACA,YACA,WACA,WACA,UACA,WACA,YACA,YACA,YACA,SACA,WACA,WACA,WACA,WACA,SACA,WACA,UACA,WACA,SACA,SACA,WACA,YACA,YACA,SACA,WACA,YACA,SACA,YACA,YACA,UACA,UACA,UACA,UACA,WACA,SACA,SACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,QACA,SACA,UACA,SACA,UACA,UACA,WACA,QACA,SACA,UACA,UACA,UACA,SACA,UACA,YACA,WACA,WACA,UACA,YACA,YACA,SACA,YACA,SACA,WACA,UACA,YACA,UACA,UACA,WACA,YACA,SACA,SACA,WACA,YACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,UACA,QACA,SACA,UACA,OACA,SACA,SACA,WACA,UACA,UACA,WACA,SACA,OACA,SACA,UACA,OACA,UACA,QACA,QACA,UACA,SACA,OACA,OACA,QACA,UACA,OACA,UACA,WACA,WACA,UACA,SACA,WACA,UACA,OACA,SACA,OACA,UACA,UACA,QACA,QACA,YACA,WACA,YACA,YACA,UACA,WACA,SACA,UACA,QACA,UACA,OACA,QACA,WACA,SACA,WACA,SACA,SACA,WACA,YACA,UACA,WACA,YACA,WACA,QACA,QACA,QACA,OACA,OACA,SACA,SACA,OACA,SACA,UACA,UACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,UACA,QACA,SACA,QACA,SACA,SACA,UACA,SACA,UACA,OACA,SACA,SACA,MACA,SACA,OACA,SACA,WACA,UACA,QACA,YACA,UACA,SACA,UACA,QACA,OACA,SACA,UACA,QACA,OACA,OACA,OACA,MACA,UACA,WACA,YACA,SACA,YACA,SACA,YACA,UACA,WACA,QACA,UACA,SACA,YACA,YACA,SACA,WACA,UACA,OACA,OACA,UACA,QACA,OACA,QACA,OACA,QACA,SACA,WACA,SACA,SACA,QACA,SACA,QACA,OACA,WACA,SACA,UACA,YACA,YACA,OACA,SACA,WACA,WACA,WACA,YACA,SACA,UACA,WACA,UACA,YACA,UACA,SACA,WACA,UACA,UACA,YACA,UACA,YACA,YACA,WACA,QACA,WACA,YACA,OACA,QACA,UACA,YACA,QACA,UACA,YACA,UACA,OACA,YACA,QACA,UACA,WACA,QACA,YACA,YACA,UACA,WACA,WACA,YACA,QACA,QACA,SACA,UACA,QACA,UACA,SACA,QACA,YACA,MACA,UACA,SACA,UACA,WACA,QACA,UACA,WACA,UACA,WACA,OACA,UACA,UACA,WACA,QACA,YACA,SACA,WACA,YACA,SACA,QACA,UACA,YACA,WACA,QACA,YACA,SACA,WACA,YACA,SACA,WACA,YACA,WACA,UACA,UACA,YACA,QACA,QACA,WACA,QACA,QACA,UACA,QACA,SACA,YACA,YACA,SACA,YACA,SACA,UACA,QACA,WACA,SACA,YACA,UACA,WACA,WACA,SACA,WACA,WACA,WACA,YACA,YACA,QACA,UACA,UACA,SACA,WACA,SACA,WACA,YACA,SACA,SACA,UACA,YACA,WACA,WACA,UACA,UACA,WACA,QACA,QACA,WACA,YACA,SACA,UACA,WACA,YACA,YACA,SACA,UACA,SACA,YACA,SACA,UACA,WACA,WACA,QACA,SACA,WACA,WACA,WACA,SACA,WACA,UACA,UACA,UACA,SACA,WACA,YACA,YACA,WACA,OACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,SACA,UACA,OACA,SACA,WACA,YACA,YACA,YACA,YACA,WACA,QACA,YACA,SACA,SACA,SACA,WACA,YACA,SACA,SACA,YACA,UACA,WACA,QACA,UACA,UACA,SACA,WACA,UACA,UACA,SACA,WACA,QACA,YACA,YACA,UACA,UACA,WACA,SACA,QACA,SACA,UACA,YACA,UACA,SACA,QACA,QACA,WACA,UACA,YACA,UACA,QACA,QACA,UACA,UACA,QACA,UACA,WACA,QACA,SACA,QACA,UACA,QACA,YACA,UACA,UACA,UACA,YACA,QACA,SACA,OACA,QACA,QACA,QACA,QACA,UACA,SACA,WACA,SACA,SACA,UACA,WACA,YACA,SACA,UACA,SACA,UACA,QACA,UACA,YACA,UACA,QACA,OACA,QACA,YACA,QACA,QACA,WACA,UACA,WACA,WACA,QACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,YACA,SACA,QACA,QACA,UACA,WACA,WACA,SACA,WACA,UACA,UACA,QACA,UACA,YACA,YACA,WACA,QACA,SACA,WACA,WACA,YACA,WACA,SACA,SACA,SACA,SACA,SACA,UACA,WACA,YACA,SACA,QACA,SACA,WACA,UACA,UACA,YACA,OACA,QACA,OACA,MACA,UACA,WACA,UACA,SACA,SACA,SACA,OACA,UACA,WACA,WACA,SACA,SACA,UACA,OACA,YACA,QACA,OACA,OACA,SACA,YACA,SACA,YACA,SACA,WACA,SACA,UACA,YACA,SACA,UACA,SACA,WACA,WACA,UACA,SACA,UACA,MACA,QACA,SACA,SACA,SACA,UACA,WACA,YACA,UACA,UACA,QACA,UACA,WACA,YACA,UACA,UACA,OACA,SACA,SACA,WACA,SACA,UACA,YACA,WACA,WACA,UACA,SACA,SACA,SACA,OACA,QACA,QACA,QACA,SACA,UACA,UACA,WACA,UACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,SACA,YACA,UACA,WACA,WACA,QACA,UACA,WACA,WACA,UACA,QACA,YACA,UACA,OACA,UACA,UACA,WACA,YACA,SACA,QACA,OACA,UACA,QACA,WACA,YACA,UACA,WACA,QACA,UACA,OACA,OACA,QACA,QACA,QACA,SACA,QACA,YACA,SACA,SACA,UACA,QACA,SACA,YACA,UACA,WACA,YACA,WACA,WACA,QACA,WACA,YACA,SACA,OACA,OACA,SACA,WACA,SACA,SACA,UACA,WACA,SACA,OACA,YACA,UACA,SACA,OACA,OACA,QACA,QACA,MACA,QACA,UACA,YACA,UACA,WACA,UACA,QACA,WACA,QACA,YACA,QACA,QACA,QACA,UACA,QACA,OACA,SACA,YACA,YACA,UACA,QACA,UACA,SACA,UACA,SACA,SACA,WACA,YACA,SACA,WACA,QACA,UACA,UACA,OACA,QACA,QACA,SACA,QACA,QACA,SACA,WACA,QACA,QACA,UACA,WACA,SACA,UACA,SACA,QACA,UACA,UACA,QACA,QACA,WACA,YACA,YACA,UACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,WACA,WACA,YACA,WACA,QACA,OACA,QACA,UACA,SACA,WACA,QACA,YACA,YACA,WACA,YACA,UACA,WACA,UACA,WACA,SACA,YACA,YACA,WACA,YACA,SACA,QACA,YACA,UACA,WACA,YACA,UACA,WACA,QACA,OACA,SACA,YACA,SACA,SACA,QACA,SACA,QACA,QACA,UACA,SACA,UACA,UACA,WACA,UACA,WACA,QACA,SACA,WACA,YACA,UACA,YACA,WACA,YACA,UACA,WACA,SACA,WACA,WACA,SACA,WACA,WACA,WACA,UACA,WACA,UACA,UACA,WACA,SACA,SACA,YACA,SACA,SACA,UACA,QACA,WACA,SACA,QACA,QACA,QACA,WACA,SACA,SACA,WACA,YACA,UACA,UACA,WACA,SACA,UACA,SACA,QACA,SACA,SACA,SACA,QACA,QACA,QACA,SACA,YACA,YACA,SACA,SACA,SACA,SACA,SACA,OACA,OACA,OACA,UACA,WACA,WACA,QACA,SACA,WACA,SACA,WACA,WACA,YACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,QACA,WACA,WACA,SACA,SACA,SACA,YACA,UACA,YACA,YACA,SACA,QACA,UACA,QACA,QACA,UACA,WACA,WACA,YACA,UACA,WACA,YACA,YACA,YACA,WACA,WACA,UACA,UACA,QACA,QACA,QACA,SACA,WACA,YACA,SACA,UACA,WACA,WACA,YACA,UACA,QACA,WACA,UACA,YACA,UACA,WACA,SACA,WACA,UACA,WACA,UACA,YACA,UACA,UACA,WACA,QACA,QACA,SACA,YACA,SACA,UACA,SACA,UACA,YACA,UACA,QACA,YACA,WACA,WACA,YACA,QACA,QACA,QACA,YACA,WACA,YACA,YACA,UACA,OACA,SACA,UACA,OACA,SACA,UACA,YACA,YACA,WACA,YACA,UACA,OACA,QACA,UACA,UACA,YACA,SACA,WACA,YACA,QACA,YACA,YACA,UACA,WACA,UACA,WACA,WACA,WACA,SACA,WACA,SACA,UACA,YACA,OACA,SACA,QACA,QACA,QACA,QACA,QACA,YACA,YACA,YACA,UACA,QACA,QACA,SACA,QACA,QACA,YACA,YACA,WACA,UACA,UACA,WACA,YACA,WACA,UACA,YACA,YACA,QACA,QACA,QACA,WACA,UACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,UACA,QACA,QACA,SACA,SACA,SACA,WACA,YACA,QACA,SACA,UACA,SACA,WACA,SACA,SACA,SACA,SACA,WACA,SACA,WACA,SACA,SACA,WACA,YACA,WACA,YACA,SACA,YACA,UACA,WACA,QACA,SACA,QACA,UACA,UACA,UACA,WACA,SACA,QACA,UACA,UACA,SACA,QACA,UACA,WACA,SACA,UACA,YACA,QACA,QACA,UACA,UACA,WACA,QACA,SACA,WACA,SACA,UACA,YACA,UACA,WACA,SACA,QACA,YACA,YACA,YACA,UACA,WACA,WACA,WACA,YACA,UACA,WACA,SACA,WACA,UACA,YACA,WACA,YACA,YACA,WACA,SACA,UACA,WACA,YACA,YACA,YACA,UACA,YACA,YACA,UACA,UACA,WACA,YACA,YACA,UACA,WACA,SACA,WACA,WACA,UACA,SACA,SACA,YACA,UACA,YACA,OACA,UACA,SACA,SACA,OACA,WACA,YACA,UACA,SACA,YACA,WACA,QACA,UACA,QACA,WACA,WACA,WACA,SACA,UACA,UACA,UACA,SACA,OACA,SACA,WACA,YACA,SACA,YACA,YACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,SACA,WACA,SACA,UACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,YACA,SACA,UACA,WACA,UACA,UACA,UACA,UACA,WACA,UACA,YACA,YACA,WACA,SACA,WACA,UACA,YACA,WACA,QACA,UACA,UACA,WACA,YACA,YACA,OACA,YACA,UACA,YACA,OACA,WACA,QACA,OACA,QACA,QACA,QACA,QACA,QACA,SACA,UACA,UACA,YACA,YACA,UACA,WACA,WACA,WACA,UACA,WACA,QACA,QACA,SACA,SACA,UACA,UACA,QACA,SACA,QACA,QACA,QACA,WACA,WACA,YACA,WACA,UACA,UACA,WACA,UACA,WACA,WACA,YACA,YACA,QACA,SACA,UACA,UACA,QACA,WACA,SACA,SACA,YACA,UACA,YACA,UACA,SACA,WACA,QACA,OACA,UACA,WACA,UACA,UACA,WACA,UACA,YACA,MACA,UACA,OACA,SACA,SACA,WACA,OACA,QACA,SACA,WACA,QACA,SACA,OACA,SACA,UACA,UACA,UACA,WACA,UACA,WACA,WACA,UACA,UACA,OACA,YACA,SACA,SACA,UACA,QACA,SACA,SACA,WACA,OACA,SACA,QACA,YACA,UACA,QACA,WACA,SACA,WACA,SACA,QACA,SACA,QACA,OACA,OACA,UACA,YACA,OACA,QACA,QACA,WACA,WACA,UACA,UACA,YACA,QACA,SACA,WACA,UACA,UACA,YACA,WACA,WACA,QACA,UACA,QACA,QACA,SACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,SACA,QACA,QACA,QACA,WACA,SACA,SACA,WACA,YACA,SACA,SACA,SACA,WACA,SACA,YACA,SACA,WACA,YACA,YACA,UACA,WACA,OACA,QACA,WACA,WACA,OACA,YACA,UACA,QACA,QACA,QACA,SACA,WACA,UACA,OACA,QACA,UACA,UACA,YACA,YACA,WACA,UACA,OACA,SACA,OACA,OACA,QACA,SACA,UACA,YACA,UACA,SACA,WACA,SACA,SACA,WACA,SACA,WACA,OACA,UACA,OACA,SACA,SACA,SACA,UACA,YACA,SACA,SACA,SACA,QACA,UACA,QACA,WACA,UACA,QACA,UACA,YACA,UACA,UACA,WACA,YACA,QACA,UACA,SACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,QACA,QACA,SACA,WACA,WACA,OACA,YACA,WACA,YACA,UACA,QACA,SACA,OACA,UACA,UACA,YACA,SACA,SACA,QACA,WACA,SACA,QACA,WACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,WACA,WACA,UACA,YACA,SACA,WACA,WACA,UACA,QACA,SACA,YACA,WACA,UACA,YACA,UACA,WACA,WACA,UACA,OACA,SACA,WACA,UACA,UACA,UACA,WACA,WACA,SACA,WACA,UACA,UACA,YACA,SACA,WACA,QACA,SACA,QACA,QACA,UACA,QACA,SACA,YACA,UACA,WACA,WACA,YACA,QACA,MACA,QACA,WACA,UACA,UACA,UACA,MACA,UACA,QACA,SACA,WACA,QACA,SACA,UACA,WACA,WACA,YACA,OACA,SACA,UACA,SACA,SACA,OACA,QACA,OACA,MACA,QACA,QACA,QACA,WACA,SACA,YACA,SACA,QACA,QACA,UACA,YACA,OACA,WACA,QACA,QACA,QACA,YACA,UACA,UACA,WACA,SACA,SACA,UACA,SACA,QACA,OACA,QACA,WACA,YACA,QACA,YACA,WACA,SACA,YACA,SACA,YACA,YACA,WACA,UACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,UACA,YACA,WACA,SACA,SACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,UACA,WACA,WACA,YACA,UACA,YACA,YACA,UACA,UACA,SACA,YACA,YACA,UACA,QACA,SACA,UACA,SACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,SACA,YACA,YACA,WACA,UACA,UACA,UACA,UACA,YACA,UACA,YACA,WACA,QACA,YACA,UACA,YACA,SACA,YACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,YACA,YACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,WACA,UACA,SACA,YACA,UACA,YACA,WACA,UACA,WACA,UACA,SACA,WACA,SACA,YACA,UACA,WACA,YACA,WACA,YACA,WACA,UACA,YACA,SACA,YACA,YACA,YACA,SACA,WACA,UACA,YACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,SACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,SACA,UACA,WACA,YACA,YACA,WACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,YACA,WACA,UACA,YACA,SACA,SACA,UACA,WACA,UACA,UACA,YACA,YACA,QACA,YACA,YACA,YACA,YACA,YACA,QACA,WACA,YACA,SACA,WACA,OACA,YACA,WACA,WACA,UACA,SACA,YACA,YACA,UACA,UACA,UACA,WACA,WACA,YACA,UACA,SACA,YACA,YACA,YACA,YACA,UACA,WACA,WACA,QACA,YACA,WACA,WACA,WACA,YACA,YACA,UACA,WACA,WACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,UACA,WACA,UACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,UACA,YACA,YACA,WACA,YACA,SACA,WACA,SACA,YACA,WACA,UACA,WACA,WACA,YACA,WACA,YACA,YACA,YACA,YACA,WACA,SACA,YACA,WACA,UACA,WACA,UACA,YACA,YACA,SACA,SACA,YACA,YACA,YACA,WACA,SACA,YACA,YACA,WACA,SACA,YACA,YACA,UACA,SACA,YACA,SACA,WACA,WACA,SACA,SACA,WACA,UACA,WACA,YACA,YACA,UACA,WACA,WACA,YACA,WACA,WACA,SACA,WACA,YACA,SACA,YACA,YACA,WACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,SACA,WACA,WACA,SACA,WACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,YACA,UACA,YACA,YACA,WACA,WACA,WACA,SACA,UACA,WACA,YACA,UACA,UACA,YACA,WACA,UACA,WACA,WACA,SACA,QACA,QACA,UACA,WACA,WACA,YACA,SACA,YACA,YACA,YACA,YACA,UACA,YACA,SACA,UACA,WACA,UACA,UACA,WACA,SACA,UACA,WACA,WACA,YACA,WACA,YACA,WACA,WACA,YACA,UACA,WACA,YACA,SACA,WACA,YACA,UACA,QACA,YACA,SACA,WACA,YACA,SACA,UACA,YACA,YACA,YACA,SACA,YACA,WACA,UACA,UACA,YACA,YACA,QACA,SACA,UACA,WACA,YACA,SACA,UACA,UACA,WACA,SACA,SACA,SACA,WACA,YACA,SACA,OACA,QACA,UACA,WACA,UACA,SACA,SACA,UACA,SACA,UACA,WACA,UACA,UACA,WACA,WACA,UACA,SACA,UACA,SACA,WACA,SACA,SACA,UACA,QACA,SACA,WACA,UACA,SACA,SACA,YACA,UACA,SACA,QACA,UACA,OACA,YACA,OACA,QACA,QACA,UACA,UACA,UACA,SACA,SACA,QACA,UACA,SACA,SACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,QACA,SACA,SACA,YACA,QACA,UACA,SACA,SACA,WACA,UACA,YACA,WACA,WACA,SACA,UACA,UACA,UACA,UACA,UACA,UACA,WACA,WACA,SACA,WACA,OACA,QACA,SACA,YACA,SACA,WACA,SACA,WACA,UACA,SACA,YACA,WACA,WACA,YACA,UACA,QACA,QACA,YACA,WACA,UACA,UACA,SACA,QACA,UACA,SACA,YACA,WACA,UACA,OACA,SACA,OACA,UACA,OACA,WACA,YACA,SACA,QACA,OACA,WACA,UACA,QACA,WACA,SACA,UACA,WACA,YACA,WACA,UACA,UACA,YACA,WACA,UACA,UACA,YACA,WACA,SACA,SACA,QACA,QACA,UACA,WACA,QACA,OACA,YACA,UACA,WACA,UACA,UACA,SACA,WACA,UACA,QACA,QACA,WACA,WACA,UACA,WACA,YACA,UACA,YACA,QACA,WACA,WACA,UACA,WACA,QACA,UACA,OACA,WACA,SACA,UACA,UACA,QACA,SACA,UACA,QACA,QACA,SACA,YACA,MACA,QACA,SACA,QACA,QACA,QACA,SACA,QACA,OACA,SACA,OACA,UACA,SACA,SACA,QACA,OACA,UACA,SACA,UACA,SACA,WACA,YACA,YACA,WACA,YACA,UACA,SACA,SACA,YACA,UACA,UACA,WACA,YACA,UACA,OACA,UACA,QACA,QACA,WACA,SACA,OACA,WACA,SACA,OACA,QACA,QACA,WACA,QACA,YACA,SACA,QACA,WACA,UACA,QACA,WACA,UACA,WACA,SACA,MACA,OACA,SACA,QACA,SACA,QACA,QACA,YACA,UACA,OACA,OACA,YACA,WACA,UACA,SACA,WACA,WACA,WACA,WACA,SACA,WACA,SACA,YACA,UACA,SACA,YACA,OACA,OACA,QACA,UACA,OACA,OACA,UACA,SACA,WACA,SACA,OACA,QACA,WACA,SACA,OACA,SACA,OACA,OACA,WACA,QACA,UACA,SACA,SACA,WACA,SACA,MACA,OACA,YACA,YACA,YACA,YACA,YACA,UACA,OACA,OACA,SACA,OACA,QACA,OACA,OACA,UACA,UACA,YACA,QACA,YACA,YACA,QACA,QACA,QACA,MACA,UACA,QACA,SACA,WACA,UACA,WACA,SACA,UACA,UACA,UACA,UACA,QACA,UACA,UACA,YACA,UACA,WACA,UACA,YACA,UACA,OACA,QACA,QACA,MACA,UACA,UACA,OACA,OACA,OACA,WACA,WACA,SACA,WACA,QACA,UACA,OACA,MACA,YACA,UACA,QACA,MACA,SACA,QACA,QACA,OACA,SACA,SACA,OACA,QACA,MACA,UACA,QACA,MACA,WACA,OACA,YACA,QACA,YACA,UACA,UACA,QACA,OACA,MACA,SACA,SACA,OACA,SACA,YACA,YACA,UACA,QCrkPWC,GACXt1G,OAAOovG,OAAO,CACZ35B,SAAU,EACVC,cAAe,IACfC,YAAY,EACZC,eAAe,ICNZ,MAAM,GAdb,WACE,MAAMH,EAAWz1E,OAAOovG,OAAO,CAC7B/oG,IAAK,EACL5C,IAAK,KAGP,OAAOzD,OAAOovG,OAAO,CACnB35B,YAEJ,CAKiC,GAI1B,MAAM8/B,GAuBX,WAAAh/G,CAAYoqB,GACV,IAAwB9Z,EAAe6oG,EASvC34G,KAAK4pB,OAASgvF,gBAAgBhvF,GAC9B5pB,KAAK0+E,UAVmB5uE,EAUO8Z,EAAOu0F,eAVCxF,EAUe,GAAkBj6B,SATrD,CACfpvE,IAAKrJ,KAAKyG,IAAIisG,EAAgBrpG,IAAKQ,GACnCpD,IAAKzG,KAAKyG,IAAIisG,EAAgBjsG,IAAKoD,IAQzC,CAGA,kBAAImpG,GAOF,MANiB,CACfj5G,KAAK4pB,OAAOg1D,WACZ5+E,KAAK4pB,OAAOi1D,cACZ7+E,KAAK4pB,OAAOu0F,eAAiB,GAAkBz/B,SAASpvE,KAG1C4gC,UAAS,EAC3B,CAMA,WAAAopE,CAAY5nG,GAWV,MAAMktE,EAAa5+E,KAAK4pB,OAAOg1D,YAAcltE,EAAQktE,aAAc,EAC7DC,EAAgB7+E,KAAK4pB,OAAOi1D,eAAiBntE,EAAQmtE,gBAAiB,EAGtEH,EAdN,SAAqB5uE,EAAe0pG,GAClC,MAAM,IAAElqG,EAAG,IAAE5C,GAAQ8sG,EAEfC,EAAiBxzG,KAAKqJ,IAAIQ,QAAAA,EAAS0pG,EAAWlqG,IAAK5C,GAGzD,OAFuBzG,KAAKyG,IAAI+sG,EAAgBnqG,EAGlD,CAOiBiqG,CAAY7nG,EAAQgtE,SAAU1+E,KAAK0+E,UAEpD,OAAO,OAAP,wBACKhtE,GAAO,CACVgtE,WACAE,aACAC,iBAEJ,CAMA,QAAA66B,CAAShoG,G,QAEP,MAAMitE,EACsB,KAA1BjtE,EAAQitE,cACJ,GAC0B,QAA1B,EAAqB,QAArB,EAAAjtE,EAAQitE,qBAAa,eAAG,UAAE,QAAI4/B,GAAmC5/B,cAEvE,OAAO,OAAP,wBACKjtE,GAAO,CACVitE,iBAEJ,E,2SC3GF,MAAM8/B,GAA2C,CAC/Ch8G,OAAQ,GACR2hB,UAAW,EACX65D,WAAW,EACXx2B,QAAQ,EACR62B,UAAW,EACXJ,WAAW,EACXC,aAAc,EACdC,WAAW,EACXC,aAAc,EACdE,SAAS,EACTC,WAAY,EACZlxE,KAAM,WACNoxE,SAAU,EACVC,cAAe,IACfC,YAAY,EACZC,eAAe,GAGX6/B,GAAgB,IAAIT,GAInB,MAAMU,GACX,WAAAn/G,CACUsU,EACAkkB,EACAtb,GAFA,KAAA5I,cAAAA,EACA,KAAAkkB,cAAAA,EACA,KAAAtb,aAAAA,CACP,CAEG,gBAAAshG,CAAiBtsG,G,gDACrB,GAA8C,gBAA7B,QAAZ,EAAAA,EAAQpE,YAAI,QAAImxG,GAAenxG,MAClC,OAAOtN,KAAK4+G,mBAAmB,OAAD,wBAAMH,IAAmB/sG,IAGzD,MACMykB,EADY,IAAIsiF,GAAkCiG,IACpChF,SAAS,OAAD,wBAAM+E,IAAmB/sG,IAE/CmtG,EAAsB,GAC5B,GAAI1oF,EAAEioD,WAAajoD,EAAEkoD,aAAe,EAClC,IAAK,IAAI37E,EAAI,EAAGA,EAAIyzB,EAAEkoD,aAAc37E,IAClCm8G,EAAUjkG,KAAK,KAGnB,GAAIub,EAAE+nD,WAAa/nD,EAAEgoD,aAAe,EAClC,IAAK,IAAIz7E,EAAI,EAAGA,EAAIyzB,EAAEgoD,aAAcz7E,IAClCm8G,EAAUjkG,KAAK,KAGnB,GAAIub,EAAEsxB,QAAUtxB,EAAEmoD,UAAY,EAC5B,IAAK,IAAI57E,EAAI,EAAGA,EAAIyzB,EAAEmoD,UAAW57E,IAC/Bm8G,EAAUjkG,KAAK,KAGnB,GAAIub,EAAEooD,SAAWpoD,EAAEqoD,WAAa,EAC9B,IAAK,IAAI97E,EAAI,EAAGA,EAAIyzB,EAAEqoD,WAAY97E,IAChCm8G,EAAUjkG,KAAK,KAGnB,KAAOikG,EAAUp8G,OAAS0zB,EAAE1zB,QAC1Bo8G,EAAUjkG,KAAK,WAIX5a,KAAK8+G,aAAaD,GAGxB,IAAIE,EAAa,GAEbC,EAAmB,4BACnB7oF,EAAE8nD,YACJ+gC,GAAoB,KAElB7oF,EAAEioD,YACJ2gC,GAAcC,GAGhB,IAAIC,EAAmB,2BACnB9oF,EAAE8nD,YACJghC,GAAoB,MAElB9oF,EAAE+nD,YACJ6gC,GAAcE,GAGhB,IAAIC,EAAgB,WAChB/oF,EAAE8nD,YACJihC,GAAiB,MAEf/oF,EAAEsxB,SACJs3D,GAAcG,GAGhB,MAAMC,EAAiB,WACnBhpF,EAAEooD,UACJwgC,GAAcI,GAGhB,IAAIr7F,EAAW,GACf,IAAK,IAAIphB,EAAI,EAAGA,EAAIyzB,EAAE1zB,OAAQC,IAAK,CACjC,IAAI08G,EACJ,OAAQP,EAAUn8G,IAChB,IAAK,IACH08G,EAAgBJ,EAChB,MACF,IAAK,IACHI,EAAgBH,EAChB,MACF,IAAK,IACHG,EAAgBF,EAChB,MACF,IAAK,IACHE,EAAgBD,EAChB,MACF,IAAK,IACHC,EAAgBL,EAMpB,MAAMM,QAAwBr/G,KAAK8T,cAAcwrG,aAAa,EAAGF,EAAc38G,OAAS,GACxFqhB,GAAYs7F,EAAc11G,OAAO21G,E,CAGnC,OAAOv7F,C,IAGH,kBAAA86F,CAAmBltG,G,0CACvB,MACMykB,EADY,IAAIqoF,GAAoCE,IACtChF,SAAS,OAAD,wBAAM+E,IAAmB/sG,KAEnC,MAAdykB,EAAEuoD,UAAoBvoD,EAAEuoD,UAAY,KACtCvoD,EAAEuoD,SAAW+/B,GAAe//B,UAEV,MAAhBvoD,EAAEyoD,aACJzoD,EAAEyoD,YAAa,GAEM,MAAnBzoD,EAAE0oD,gBACJ1oD,EAAE0oD,eAAgB,GAGpB,MAAM0gC,EAAajB,GAAgB77G,OAAS,EACtC+8G,EAAW,IAAIj7G,MAAM4xB,EAAEuoD,UAC7B,IAAK,IAAIh8E,EAAI,EAAGA,EAAIyzB,EAAEuoD,SAAUh8E,IAAK,CACnC,MAAM+8G,QAAkBz/G,KAAK8T,cAAcwrG,aAAa,EAAGC,GACvDppF,EAAEyoD,WACJ4gC,EAAS98G,GAAK1C,KAAK4+E,WAAW0/B,GAAgBmB,IAE9CD,EAAS98G,GAAK47G,GAAgBmB,E,CAOlC,OAHItpF,EAAE0oD,sBACE7+E,KAAK0/G,+BAA+BF,IAErCA,EAAS36G,KAAKsxB,EAAEwoD,cACzB,G,CAEA,WAAAghC,GACE,OAAO,EAAAt9G,GAAA,GAAKrC,KAAK4/G,aACnB,CAEM,UAAAA,G,0CACJ,IAAIluG,QAAgB1R,KAAK0c,aAAamjG,+BAEpCnuG,EADa,MAAXA,EACQzI,OAAOH,OAAO,CAAC,EAAG21G,IAElBx1G,OAAOH,OAAO,CAAC,EAAG21G,GAAgB/sG,SAExC1R,KAAK0c,aAAaojG,6BAA6BpuG,GACrD,MAAM2oB,QAAwBr6B,KAAK+/G,0CAA0CruG,GAE7E,OADAA,EAAU2oB,EAAgB,GACnB,CAAC3oB,EAAS2oB,EAAgB,GACnC,G,CAEM,yCAAA0lF,CACJruG,G,0CAEA,IAAIkY,QAAe5pB,KAAKggH,oCACxBp2F,EAASA,QAAAA,EAAU,IAAIq0F,GAGI,aAAvBr0F,EAAOs0F,aAAqD,eAAvBt0F,EAAOs0F,cAC9CxsG,EAAQpE,KAAOsc,EAAOs0F,aAGxB,MAAM+B,EACY,YAAhBvuG,EAAQpE,KACJ,IAAImrG,GAAkC7uF,GACtC,IAAI40F,GAAoC50F,GAGxCs2F,EAAaD,EAAU3G,YAAY5nG,GACnCyuG,EAAYF,EAAUvG,SAASwG,GAIrC,MAAO,CADQj3G,OAAOH,OAAO4I,EAASyuG,GACtBv2F,EAClB,G,CAEM,iCAAAo2F,G,gDACJ,MAAMrmF,QAAmC,QAAlB,EAAA35B,KAAKg4B,qBAAa,eAAErB,OAAO/E,GAAWuJ,mBAC7D,IAAId,EAAkD,KAEtD,OAAgB,MAAZV,GAAwC,IAApBA,EAASl3B,QAIjCk3B,EAAS/xB,SAAS4yB,IACXA,EAAczL,SAAiC,MAAtByL,EAAchoB,OAIrB,MAAnB6nB,IACFA,EAAkB,IAAI4jF,IAIc,MAAlCzjF,EAAchoB,KAAK0rG,aAAuD,aAAhC7jF,EAAgB6jF,cAC5D7jF,EAAgB6jF,YAAc1jF,EAAchoB,KAAK0rG,aAIjB,MAAhC1jF,EAAchoB,KAAK4R,WACnBoW,EAAchoB,KAAK4R,UAAYiW,EAAgBjW,YAE/CiW,EAAgBjW,UAAYoW,EAAchoB,KAAK4R,WAG7CoW,EAAchoB,KAAK+qG,WACrBljF,EAAgB6+E,cAAe,GAG7B1+E,EAAchoB,KAAKgrG,WACrBnjF,EAAgB8+E,cAAe,GAG7B3+E,EAAchoB,KAAK4mG,aACrB/+E,EAAgB++E,YAAa,GAII,MAAjC5+E,EAAchoB,KAAKirG,YACnBjjF,EAAchoB,KAAKirG,WAAapjF,EAAgBw+E,cAEhDx+E,EAAgBw+E,YAAcr+E,EAAchoB,KAAKirG,YAG/CjjF,EAAchoB,KAAK6mG,aACrBh/E,EAAgBg/E,YAAa,GAII,MAAjC7+E,EAAchoB,KAAKgsE,YACnBhkD,EAAchoB,KAAKgsE,WAAankD,EAAgBy+E,eAEhDz+E,EAAgBy+E,aAAet+E,EAAchoB,KAAKgsE,YAIb,MAArChkD,EAAchoB,KAAK2rG,gBACnB3jF,EAAchoB,KAAK2rG,eAAiB9jF,EAAgB8jF,iBAEpD9jF,EAAgB8jF,eAAiB3jF,EAAchoB,KAAK2rG,gBAGlD3jF,EAAchoB,KAAKosE,aACrBvkD,EAAgBukD,YAAa,GAG3BpkD,EAAchoB,KAAKqsE,gBACrBxkD,EAAgBwkD,eAAgB,G,IAlE3BxkD,C,IAyEL,WAAA+lF,CAAY1uG,G,gDACV1R,KAAK0c,aAAaojG,6BAA6BpuG,EACvD,G,CAEM,UAAA2uG,G,0CAEJ,WADqBrgH,KAAK8T,cAAcwsG,cAEtC,OAAO,IAAI/7G,MAGb,GAAyE,aAA9DvE,KAAK0c,aAAa6jG,yCAAkD,CAC7E,MAAM54F,QAAkB3nB,KAAK0c,aAAa8jG,wCACpC54F,QAAkB5nB,KAAKygH,eAAe94F,SACtC3nB,KAAK0c,aAAagkG,sCAAsC94F,E,CAGhE,MAAMI,QACEhoB,KAAK0c,aAAa6jG,wCAC1B,OAAoC,MAA7Bv4F,EACHA,EACA,IAAIzjB,KACV,G,CAEM,UAAAo8G,CAAW78F,G,0CAGf,WADqB9jB,KAAK8T,cAAcwsG,cAEtC,OAGF,MAAMM,QAAuB5gH,KAAKqgH,aAGlC,GAAIrgH,KAAK6gH,gBAAgB/8F,EAAU88F,GACjC,OAGFA,EAAeE,QAAQ,IAAIpF,GAAyB53F,EAAUtX,KAAKC,QAG/Dm0G,EAAen+G,OA1SO,KA2SxBm+G,EAAeG,MAGjB,MAAMC,QAAmBhhH,KAAKihH,eAAeL,GAE7C,aADM5gH,KAAK0c,aAAagkG,sCAAsCE,SACjD5gH,KAAK0c,aAAawkG,sCAAsCF,EACvE,G,CAEM,KAAAhsD,CAAM7+C,G,0CAGV,aAFMnW,KAAK0c,aAAawkG,sCAAsC,KAAM,CAAE/qG,OAAQA,UACxEnW,KAAK0c,aAAagkG,sCAAsC,KAAM,CAAEvqG,OAAQA,IACvE,EACT,G,CAEQ,UAAAyoE,CAAW18E,GACjB,OAAOA,EAAIwH,OAAO,GAAGC,cAAgBzH,EAAI0C,MAAM,EACjD,CAEc,8BAAA86G,CAA+BF,G,0CAC3C,GAAgB,MAAZA,GAAoBA,EAAS/8G,QAAU,EACzC,OAEF,MAAM2xG,QAAcp0G,KAAK8T,cAAcwrG,aAAa,EAAGE,EAAS/8G,OAAS,GACnE0+G,QAAYnhH,KAAK8T,cAAcwrG,aAAa,EAAG,GACrDE,EAASpL,GAASoL,EAASpL,GAAS+M,CACtC,G,CAEc,cAAAF,CACZlE,G,0CAEA,GAAe,MAAXA,GAAsC,IAAnBA,EAAQt6G,OAC7B,OAAOmJ,QAAQC,QAAQ,IAGzB,MAAMwd,EAAW0zF,EAAQt4G,KAAWsd,GAAS,mCAC3C,MAAM4F,QAAkB3nB,KAAK8T,cAAcgK,QAAQiE,EAAK+B,UACxD,OAAO,IAAI43F,GAAyB/zF,EAAU3U,gBAAiB+O,EAAKqtB,KACtE,MAEA,aAAaxjC,QAAQ+d,IAAIN,EAC3B,G,CAEc,cAAAo3F,CACZ1D,G,0CAEA,GAAe,MAAXA,GAAsC,IAAnBA,EAAQt6G,OAC7B,OAAOmJ,QAAQC,QAAQ,IAGzB,MAAMwd,EAAW0zF,EAAQt4G,KAAWsd,GAAS,mCAC3C,MAAM6F,QAAkB5nB,KAAK8T,cAAcD,cAAc,IAAIvB,EAAUyP,EAAK+B,WAC5E,OAAO,IAAI43F,GAAyB9zF,EAAW7F,EAAKqtB,KACtD,MAEA,aAAaxjC,QAAQ+d,IAAIN,EAC3B,G,CAEQ,eAAAw3F,CAAgB/8F,EAAkBi5F,GACxC,OAAe,MAAXA,GAAsC,IAAnBA,EAAQt6G,QAIxBs6G,EAAQA,EAAQt6G,OAAS,GAAGqhB,WAAaA,CAClD,CAGc,YAAAg7F,CAAa5pG,G,0CACzB,IAAK,IAAIxS,EAAIwS,EAAMzS,OAAS,EAAGC,EAAI,EAAGA,IAAK,CACzC,MAAM0+G,QAAUphH,KAAK8T,cAAcwrG,aAAa,EAAG58G,IAClDwS,EAAMxS,GAAIwS,EAAMksG,IAAM,CAAClsG,EAAMksG,GAAIlsG,EAAMxS,G,CAE5C,G,6SCtYK,MAAM2+G,GAMX,WAAA7hH,CACU8hH,EACA13F,EACR23F,EAAiD,CAAC,GAF1C,KAAAD,SAAAA,EACA,KAAA13F,OAAAA,EAaF,KAAA43F,aAAe,IAAI5hH,IAVzBI,KAAKuhH,OAASt4G,OAAOH,OACnB,CAEE24G,cAAe,KAEjBF,EAEJ,CAMA,QAAAG,CAASvrG,GACP,OAAOnW,KAAKshH,SAAS1D,aAAaznG,GAAQkF,MAC5C,CAGA,SAAAwiG,CAAU1nG,GACR,OAAOnW,KAAKshH,SAASzD,UAAU1nG,EACjC,CAGM,WAAAiqG,CAAYjqG,EAAgBzE,G,gDAC1B1R,KAAKshH,SAAS1D,aAAaznG,GAAQuE,QAAO,IAAMhJ,GACxD,G,CAGA,UAAAiwG,CAAWxrG,GACT,IAAIwrG,EAAa3hH,KAAKwhH,aAAavnG,IAAI9D,GAOvC,OALKwrG,IACHA,EAAa3hH,KAAK4hH,gBAAgBzrG,GAClCnW,KAAKwhH,aAAaz5G,IAAIoO,EAAQwrG,IAGzBA,CACT,CAEQ,eAAAC,CAAgBzrG,GAatB,OAZmBnW,KAAK4pB,OAAO8M,QAAQ12B,KAAKshH,SAAS13F,OAAQzT,GAAQjK,KAEnElM,KAAKshH,SAASxD,eAId,EAAAvyB,GAAA,GAAM,CACJC,UAAW,IAAM,IAAIC,GAAA,EAAc,GACnCC,oBAAqB,KAAM,EAAAC,GAAA,GAAM3rF,KAAKuhH,OAAOE,iBAKnD,CAGM,aAAAI,CAAc1rG,EAAgBzE,G,0CAClC,MAAMkY,QAAe,OAAe5pB,KAAK2hH,WAAWxrG,IAC9C2rG,EAAYl4F,EAAO0vF,YAAY5nG,GAErC,OADkBkY,EAAO8vF,SAASoI,EAEpC,G,CAGM,QAAA/D,CAASrsG,G,0CACb,aAAa1R,KAAKshH,SAASvD,SAASrsG,EACtC,G,qUC9EK,MAAMqwG,GAaX,WAAAviH,CACEsB,EACQqP,EACA7K,EACR08G,EAAsC,MAF9B,KAAA7xG,IAAAA,EACA,KAAA7K,OAAAA,EAGRtF,KAAKiiH,cAAgBnhH,EAASyqB,QAAQjmB,EAAO6Q,OAAQhG,EAAI4pG,mBAGzD,MAAMmI,GAAY,EAAA5L,GAAA,IAAO,EAAArqG,EAAAA,IAAG,MAAOjM,KAAKiiH,cAAc5mG,QAAQnP,MAC5D,QAAK1I,GAAgC,QAApBA,QAAAA,EAAU,SAEvB2+G,GAAwBH,QAAAA,GAAe,EAAA/1G,EAAAA,KAAG,IAAgCC,MAC9E,QAAK+tG,GAAe,CAAC9pG,EAAI6pG,gBAAgBC,GAAaA,MAElDmI,GAAa,EAAAxoF,GAAA,GAAc,CAACsoF,EAAWC,IAAuBj2G,MAClE,EAAAyhF,GAAA,IAAU,EAAQ00B,GAAWrI,EAAiBC,MAAiB,mCAI7D,OAHIoI,GAAYrI,UACRh6G,KAAKsiH,gBAAgBrI,IAEtB,EAAC,EAAO,KACjB,OAKIsI,EAAUviH,KAAKsF,OAAO+V,OAAOnP,MAAK,QAAK5G,GAAW,EAAC,EAAMA,MAC/DtF,KAAKqb,QAAS,EAAAvQ,EAAA,GAAMs3G,EAAYG,GAASr2G,MACvC,QAAO,EAAEs2G,KAAUA,KACnB,QAAI,EAAE,CAAEl9G,KAAYA,KAGtBtF,KAAKg7C,eAAiBh7C,KAAKqb,OAAOnP,MAAK,QAAKsO,GAAU,CAACxa,KAAKsF,OAAO6Q,OAAQqE,MAE3Exa,KAAKyiH,eAAiBziH,KAAKiiH,cAAc5mG,MAC3C,CAIc,eAAAinG,CAAgBrI,G,0CAE5B,IAAIyI,QACE1iH,KAAKiiH,cAAcvnG,QAAQF,IAC/BkoG,EAAWloG,QAAAA,EAAS,KACb,QAKT,SADsBxa,KAAKmQ,IAAIwxC,QAAQ+gE,EAAUzI,GACpC,CACX,MAAM30G,QAAetF,KAAKmQ,IAAI1L,IAAIi+G,EAAUzI,SACtCj6G,KAAKsF,OAAOoV,QAAO,IAAMpV,G,CAEnC,G,CAGA,UAAI6Q,GACF,OAAOnW,KAAKsF,OAAO6Q,MACrB,CAgBM,MAAA3S,CAAOsM,G,0CACX,MAAM6yG,EAAa7yG,QAAAA,EAAS,KACT,OAAf6yG,UACI3iH,KAAKiiH,cAAcvnG,QAAO,IAAMioG,IAE1C,G,CAcA,MAAAjoG,CACE+vE,EACA/4E,EAAgD,MAEhD,OAAO1R,KAAKsF,OAAOoV,OAAO+vE,EAAgB/4E,EAC5C,EC3HK,MAAekxG,ICEtB,MAAMC,GAAe55G,OAAOovG,OAAO,CAEjC/8C,QAAS,IAGTwnD,QAAS,IAKTC,kBAAmB,SAUd,MAAMC,WAAyBJ,GAIpC,WAAApjH,CAA6ByjH,GAC3Bx1G,QAD2B,KAAAw1G,UAAAA,CAE7B,CAOA,IAAAC,CAAapzG,GAEX,MAAM7B,EAAOwc,KAAKC,UAAU5a,GACtBg1C,EAAM,EAAMr/C,cAAcwI,GAG1Bg1G,EAAYx4F,KAAKC,UAAU1qB,KAAKijH,WAChCE,EAAkB,EAAIN,GAAaC,QAAQrgH,OAC3C2gH,EAAgBt+D,EAAIriD,OAASwgH,EAAUxgH,OAAS0gH,EAChDE,EAAgBrjH,KAAKijH,UAAaG,EAAgBpjH,KAAKijH,UAM7D,MAFe,GAAGA,KAAan+D,KADf+9D,GAAavnD,QAAQ7O,OAAO42D,IAI9C,CAGA,MAAAC,CAAenxE,GAEb,MAAMoxE,EAAgBpxE,EAAOtrC,QAAQg8G,GAAaC,SAClD,GAAIS,EAAgB,EAClB,MAAM,IAAI/iH,MAAM,sBAElB,MAAMyiH,EAAYlgH,SAASovC,EAAOvtC,MAAM,EAAG2+G,GAAgB,IACrDC,EAAiBD,EAAgB,EAGvC,GAAIpxE,EAAO1vC,OAASwgH,EAAY,EAC9B,MAAM,IAAIziH,MAAM,kBAIlB,MAAMijH,EAAetxE,EAAOjwB,YAAY2gG,GAAaC,SACrD,GAAIW,GAAgBF,EAClB,MAAM,IAAI/iH,MAAM,uBAElB,MAAMkjH,EAAoBD,EAAe,EAIzC,GAAItxE,EAAOvtC,MAAM8+G,GAAmBj4G,MAAMo3G,GAAaE,mBACrD,MAAM,IAAIviH,MAAM,mBAIlB,MAAMskD,EAAM3S,EAAOvtC,MAAM4+G,EAAgBC,GAGnCx1G,EAAO,EAAMzI,cAAcs/C,GAGjC,OAFiBr6B,KAAKikB,MAAMzgC,EAG9B,E,2SCpEK,MAAM01G,GAKX,YACmBxzG,EACAyzG,EACjBztG,EACArV,GAHiB,KAAAqP,IAAAA,EACA,KAAAyzG,UAAAA,EAKjB5jH,KAAK6jH,eAAiB/iH,EAASyqB,QAAQpV,EAAQhG,EAAIkrG,uBAGnDr7G,KAAKg7C,eAAiBh7C,KAAK6jH,eAAe7oE,eAAe9uC,MACvD,EAAAyhF,GAAA,IACE,EAAQx3E,EAAQqE,KAAW,0CAACrE,QAAcnW,KAAK8jH,cAActpG,GAA0B,OAEzF,EAAA+wE,GAAA,GAAM,CACJC,UAAW,IACF,IAAIC,GAAA,EAA+B,GAE5CC,oBAAqB,KAAK,MAAC,SAAAC,GAAA,GAAgC,QAA1B,EAAAx7E,EAAIuB,QAAQkD,sBAAc,QAjChD,IAiC+D,KAI9E5U,KAAKqb,OAASrb,KAAKg7C,eAAe9uC,MAAK,QAAI,EAAE,CAAEsO,KAAWA,IAC5D,CAKA,UAAIrE,GACF,OAAOnW,KAAK6jH,eAAe1tG,MAC7B,CAuBA,WAAO9T,CACL8T,EACAhG,EACArP,EACA8iH,GAGA,OADoB,IAAID,GAAYxzG,EAAKyzG,EAAWztG,EAAQrV,EAE9D,CAEc,cAAAijH,EAAe,GAAE39G,EAAE,OAAE+rC,EAAM,UAAEioE,I,0CACzC,MAAMzyF,EAAYrV,EAAUtE,SAASmkC,GAC/BvqB,QAAkB5nB,KAAK4jH,UAAUrwG,QAAQoU,EAAW3nB,KAAK6jH,eAAe1tG,QAExE6tG,EAAehkH,KAAKmQ,IAAI+qG,WAAWJ,WAAWV,EAAWxyF,GAG/D,MAFe,CAACxhB,EAAIpG,KAAKmQ,IAAIuB,QAAQiD,aAAaqvG,GAGpD,G,CAEc,aAAAF,CAActxG,G,0CAE1B,GAAIA,QACF,OAAO,KAIT,MAAMyxG,EAAezxG,EAAK/N,KAAWsd,GAAS,GAAA/hB,UAAA,6BAAAA,KAAK+jH,eAAehiG,EAAK,MAGjEykC,QAAgB56C,QAAQ+d,IAAIs6F,GAGlC,OAFejkH,KAAKmQ,IAAIirG,YAAY50D,EAGtC,G,CAEc,YAAA09D,EAAc99G,EAAI2b,I,0CAC9B,MAAMoiG,EAAankH,KAAKmQ,IAAI+qG,WAAWP,SAAS54F,GAC1C4F,QAAkB3nB,KAAK4jH,UAAU9lG,QAAQqmG,EAAWhyE,OAAQnyC,KAAK6jH,eAAe1tG,QAWtF,MANmB,CACjB/P,KACA+rC,OAAQ1nB,KAAKikB,MAAMjkB,KAAKC,UAAU/C,IAClCyyF,UAAW+J,EAAW/J,UAI1B,G,CAEc,WAAAgK,CAAY5xG,G,0CAExB,GAAIA,QACF,OAAO,KAKT,MAGM6xG,EAHiBrkH,KAAKmQ,IAAIgrG,YAAY3oG,GAGP/N,KAAWsd,GAAS,GAAA/hB,UAAA,6BAAAA,KAAKkkH,aAAaniG,EAAK,MAGhF,aAFyBnW,QAAQ+d,IAAI06F,EAGvC,G,CAeM,MAAA3pG,CACJ+vE,EACA/4E,EAA+C,M,kDAG/C,IAAI4yG,EACAC,QACEvkH,KAAK6jH,eAAenpG,QAAQ3U,GAAMA,GAAG,CACzC8U,aAAc,CAAC2pG,EAAQC,KACrBH,EAAmBE,EACnBD,EAAiBE,GACV,GAETrmF,kBAAmB1sB,aAAO,EAAPA,EAAS0sB,oBAI9B,MAAMsmF,QAA2B1kH,KAAK8jH,cAAcQ,GAEpD,KADgF,QAA3D,EAAqB,QAArB,EAAA5yG,aAAO,EAAPA,EAASmJ,oBAAY,sBAAG6pG,EAAoBH,UAAe,UAE9E,OAAOG,EAIT,MAAMC,EAAsBl6B,EAAei6B,EAAoBH,GACzDK,QAA0B5kH,KAAKokH,YAAYO,GAGjD,aAFM3kH,KAAK6jH,eAAenpG,QAAO,IAAMkqG,IAEhCD,C,KCxLJ,MAAeE,I,2SCIf,MAAMC,WAAyBD,GAMpC,WAAArlH,CACmBmU,EACAoxG,EACAC,GAEjBv3G,QAJiB,KAAAkG,eAAAA,EACA,KAAAoxG,WAAAA,EACA,KAAAC,WAAAA,CAGnB,CAGM,OAAAlnG,CAAgBq0B,EAAyBh8B,G,0CAC7CnW,KAAKilH,eAAe,SAAU9yE,GAC9BnyC,KAAKilH,eAAe,SAAU9uG,GAE9B,IAAI+uG,EAASllH,KAAKglH,WAAW9B,KAAK/wE,GAG9BhiC,QAAYnQ,KAAK+kH,WAAWx3F,WAAWpX,GAC3C,MAAMwR,QAAkB3nB,KAAK2T,eAAemK,QAAQonG,EAAQ/0G,GAI5D,OAHA+0G,EAAS,KACT/0G,EAAM,KAECwX,CACT,G,CAGM,OAAApU,CAAgB4+B,EAAmBh8B,G,0CACvCnW,KAAKilH,eAAe,SAAU9yE,GAC9BnyC,KAAKilH,eAAe,SAAU9uG,GAG9B,IAAIhG,QAAYnQ,KAAK+kH,WAAWx3F,WAAWpX,GACvCyR,QAAkB5nB,KAAK2T,eAAeE,cAAcs+B,EAAQhiC,GAChEA,EAAM,KAGN,MAAMg1G,EAAWnlH,KAAKglH,WAAW1B,OAAe17F,GAGhD,OAFAA,EAAY,KAELu9F,CACT,G,CAEQ,cAAAF,CAAezjH,EAAcsO,GACnC,GAAIA,QACF,MAAM,IAAItP,MAAM,GAAGgB,gCAEvB,ECxDK,MAAe4jH,I,2SCDf,MAAMC,GACX,WAAA7lH,CACU2W,EACArC,EACAH,GAFA,KAAAwC,OAAAA,EACA,KAAArC,cAAAA,EACA,KAAAH,eAAAA,CACP,CAGG,OAAAJ,CAAQwpG,G,0CACZ,MAAM5sG,QAAYnQ,KAAK8T,cAAcyZ,WAAWvtB,KAAKmW,QAE/CkT,GAAY0zF,QAAAA,EAAW,IAAIt4G,KAAWsd,GAAS,mCACnD,MAAM4F,EAAY,IAAIrV,EAAUyP,EAAK+B,UAC/B8D,QAAkB5nB,KAAK2T,eAAeE,cAAc8T,EAAWxX,GACrE,OAAO,IAAIurG,GAAyB9zF,EAAW7F,EAAKqtB,KACtD,MAIA,aAFwBxjC,QAAQ+d,IAAIN,EAGtC,G,6SCLK,MAAMi8F,WAAqCF,GAChD,WAAA5lH,CACmBmU,EACAoxG,EACAtoG,EACA/K,EAAiC,CAAE6zG,SAAU,MAE9D93G,QALiB,KAAAkG,eAAAA,EACA,KAAAoxG,WAAAA,EACA,KAAAtoG,cAAAA,EACA,KAAA/K,QAAAA,EAKX,KAAA8zG,kBAAoB,IAAI5lH,IAGhC,KAAA6lH,MAAQ,CAAOtvG,EAAgB/I,EAAoBouG,EAA6BpsE,IAAgB,mCAC9F,MAAM50B,EAAQxa,KAAK0lH,mBAAmBvvG,GACtC,IAAIwuB,EAA8B,KAsBlC,aApBMnqB,EAAME,QACTkQ,IACCA,EAAcA,QAAAA,EAAe,GAG7B+Z,EAAS,IAAI42E,GAAoBnuG,EAAYouG,EAAUpsE,QAAAA,EAAQ5iC,KAAKC,OACpEme,EAAYk2F,QAAQn8E,GAGpB,MAAMghF,EAAW1/G,KAAKyG,IAAI,EAAG1M,KAAK0R,QAAQ6zG,UAG1C,OAFA36F,EAAY2iF,OAAOoY,EAAUC,KAEtBh7F,CAAW,GAEpB,CACE/P,aAAe+P,IAAe,MAC5B,QAAuD,QAArD,EAAAA,aAAW,EAAXA,EAAawmC,MAAMn4B,GAAMA,EAAE7rB,aAAeA,WAAW,SAAU,IAIhEu3B,CACT,IAGA,KAAA5I,KAAO,CAAO5lB,EAAgB/I,IAAuB,mCACnD,MAAMoN,EAAQxa,KAAK0lH,mBAAmBvvG,GACtC,IAAI0vG,EACAlhF,EAA8B,KAiBlC,aAfMnqB,EAAME,QACTkQ,IACCA,EAAcA,QAAAA,EAAe,IAE5B+Z,GAAU/Z,EAAY2iF,OAAOsY,EAAiB,GACxCj7F,IAET,CACE/P,aAAe+P,I,MAEb,OADAi7F,EAA4E,QAA1D,EAAAj7F,aAAW,EAAXA,EAAa7P,WAAWke,GAAMA,EAAE7rB,aAAeA,WAAW,SAAK,EAC1Ey4G,GAAmB,CAAC,IAK1BlhF,CACT,IAGA,KAAAqwB,MAAe7+C,GAAmB,mC,MAChC,MAAMqE,EAAQxa,KAAK0lH,mBAAmBvvG,GAEtC,OAD+C,QAA/B,QAAMqE,EAAME,QAAO,IAAM,cAAM,QAAI,EAErD,IAGA,KAAAorG,aAAgB3vG,GACPnW,KAAK0lH,mBAAmBvvG,GAAQkF,OAAOnP,MAAK,QAAK0e,GAAgBA,QAAAA,EAAe,KAjEzF,CAoEQ,kBAAA86F,CAAmBvvG,GACzB,IAAIqE,EAAQxa,KAAKwlH,kBAAkBvrG,IAAI9D,GAOvC,OALKqE,IACHA,EAAQxa,KAAK+lH,kBAAkB5vG,GAC/BnW,KAAKwlH,kBAAkBz9G,IAAIoO,EAAQqE,IAG9BA,CACT,CAEQ,iBAAAurG,CAAkB5vG,GAExB,MAAM6vG,EAAS,IAAIhD,GA9FI,MA+FjBY,EAAY,IAAIkB,GAAiB9kH,KAAK2T,eAAgB3T,KAAK+kH,WAAYiB,GAGvExrG,EAAQmpG,GAAYthH,KAMxB8T,EAAQ0mG,GAAmB78G,KAAKyc,cAAemnG,GAI3C5G,EAAY,IAAIqI,GACpBlvG,EACAnW,KAAK+kH,WACL/kH,KAAK2T,gBAEDsyG,EAAajmH,KAAK+kH,WACrB5lF,uBAAuBhpB,GACvBjK,MAAK,QAAKiE,GAAQA,GAAO6sG,KAU5B,OAPe,IAAI+E,GACjB/hH,KAAKyc,cACLqgG,GACAtiG,EACAyrG,EAIJ,EC1HK,MAAMC,GAA2Dj9G,OAAOovG,OAAO,CACpF/qG,KAAM,WACNuW,SAAU,OACVo9D,UAAW,KCjBN,MAAMklC,GAOX,WAAA3mH,CAAqBoqB,GAAA,KAAAA,OAAAA,CAAoC,CAGzD,kBAAIqvF,G,MACF,SAAkB,QAAX,EAAAj5G,KAAK4pB,cAAM,eAAEs0F,YACtB,CAMA,WAAA5E,CAAY5nG,GACV,OAAOA,CACT,CAMA,QAAAgoG,CAAShoG,G,MACP,MAAMwsG,EAAcl+G,KAAKi5G,eACrBj5G,KAAK4pB,OAAOs0F,YACZgI,GAA2B54G,KAC/B,OAAO,OAAP,wBACKoE,GAAO,CACVpE,KAAkB,QAAZ,EAAAoE,EAAQpE,YAAI,QAAI4wG,GAE1B,ECrBK,SAASkI,GACdlnF,EACAtV,GAGA,KADkBA,EAAOtc,OAASskB,GAAWuJ,mBAAqBvR,EAAOmF,SAEvE,OAAOmQ,EAMT,MAH0C,aAApBA,EAAIg/E,aAA8Bt0F,EAAOpX,KAAK0rG,YACrC,OAAD,wBAAMh/E,GAAG,CAAEg/E,YAAat0F,EAAOpX,KAAK0rG,cAAgBh/E,CAGpF,CAGO,MAAMmnF,GAA+Dp9G,OAAOovG,OAAO,CACxF6F,iBAAat1G,I,2SCvBR,MAAM09G,GAKX,WAAA9mH,CACmBid,EACAmN,GADA,KAAAnN,cAAAA,EACA,KAAAmN,OAAAA,CAChB,CAMH,QAAA83F,CAASvrG,GACP,OAAOnW,KAAKyc,cAAcI,cAAc8+F,GAAoBxlG,EAC9D,CAGA,SAAA0nG,CAAU1nG,GACR,OAAO,IAAI,KAAgB,OAAD,UAAM+vG,IAClC,CAMA,UAAAvE,CAAWxrG,GAOT,OANmBnW,KAAK4pB,OAAO8M,QAAQ9E,GAAWuJ,kBAAmBhlB,GAAQjK,KAC3E+wG,GAAiBmJ,GAAgBC,IACjCnJ,MACA,QAAKtzF,GAAW,IAAIu8F,GAA6Bv8F,KAIrD,CAOM,aAAAi4F,CAAc1rG,EAAgBzE,G,0CAClC,MAAMuuG,QAAkB,OAAejgH,KAAK2hH,WAAWxrG,IACjDowG,EAAUtG,EAAU3G,YAAY5nG,GAEtC,OADkBuuG,EAAUvG,SAAS6M,EAEvC,G,CAOM,WAAAnG,CAAYjqG,EAAgBzE,G,gDAC1B1R,KAAKyc,cAAcO,aAAa2+F,GAAoBjqG,EAASyE,EACrE,G,ECzDK,MAAMqwG,GAA+Dv9G,OAAOovG,OAAO,CACxF8F,eAAgB,EAChBv/B,YAAY,EACZC,eAAe,IASV,SAAS,GACd3/C,EACAtV,G,MAEA,OAAIA,EAAOtc,OAASskB,GAAWuJ,kBACtB+D,EAGF,CACLi/E,eAAgBl4G,KAAKyG,IAAIwyB,EAAIi/E,eAA0C,QAA1B,EAAAv0F,EAAOpX,KAAK2rG,sBAAc,QAAIj/E,EAAIi/E,gBAC/Ev/B,WAAYh1D,EAAOpX,KAAKosE,YAAc1/C,EAAI0/C,WAC1CC,cAAej1D,EAAOpX,KAAKqsE,eAAiB3/C,EAAI2/C,cAEpD,CChBO,MAAM4nC,GAOX,WAAAjnH,CACUm+G,EACAlhG,GADA,KAAAkhG,OAAAA,EACA,KAAAlhG,cAAAA,CACP,CAGH,YAAAmhG,CAAax3G,GACX,OAAOpG,KAAKyc,cAAc8O,QAAQnlB,EAAIy1G,GACxC,CAGA,SAAAgC,CAAUpyF,GACR,OAAO,IAAI,KAAgB,OAAD,UAAM8yF,KAAsClyF,cACxE,CAGA,UAAIzC,GACF,OAAOgI,GAAWuJ,iBACpB,CAGA,WAAA2iF,GACE,OAAO,EAAA5xG,GAAA,GACL+wG,GAAiB,GAAgBuJ,IACjCtJ,MACA,QAAKtzF,GAAW,IAAI40F,GAAoC50F,KAE5D,CAGA,QAAAm0F,CAASrsG,GACP,OAAO1R,KAAK29G,OAAOiB,mBAAmB,OAAD,wBAAMltG,GAAO,CAAEpE,KAAM,eAC5D,E,2SC6BK,MAAMo5G,GACX,WAAAlnH,CACmB2c,EACAwqG,EACAC,EAIAC,EAIA9J,GAVA,KAAA5gG,eAAAA,EACA,KAAAwqG,WAAAA,EACA,KAAAC,UAAAA,EAIA,KAAAC,YAAAA,EAIA,KAAA9J,QAAAA,CAChB,CAEH,gBAAAiB,CAAiBtsG,GACf,MAAqB,aAAjBA,EAAQpE,KACHtN,KAAK4mH,UAAU7I,SAASrsG,GAExB1R,KAAK6mH,YAAY9I,SAASrsG,EAErC,CAEA,kBAAAktG,CAAmBltG,GACjB,OAAO1R,KAAK6mH,YAAY9I,SAASrsG,EACnC,CAEQ,cAAAo1G,GAcN,SAASC,EAAsBC,GAC7B,OAAOA,EAAY96G,MAAK,QAAI,CAAC+zG,EAAWv9G,IAAM,CAACu9G,EAAWv9G,KAC5D,CAqFA,OArBoB1C,KAAKmc,eAAe6Q,eAAe9gB,MACrD,EAAAyhF,GAAA,IAAWs5B,IACT,EAAA3Q,GAAA,IA/CK,EAAArqG,EAAAA,IAZqC,CAC1C,KACA,KACA,CAAC,MAAO,GACR,KACA,KACA,CAAC,MAAO,GACR,KACA,KACA,CAAC,MAAO,MAoDN,EAAA2tB,GAAA,GAAc,CACZ55B,KAAK4mH,UAAUlF,SAASuF,EAAW7gH,IACnCpG,KAAK4mH,UAAU/I,UAAUoJ,EAAW7gH,IACpC2gH,EAAmB/mH,KAAK4mH,UAAUjF,WAAWsF,EAAW7gH,KACxDpG,KAAK6mH,YAAYnF,SAASuF,EAAW7gH,IACrCpG,KAAK6mH,YAAYhJ,UAAUoJ,EAAW7gH,IACtC2gH,EAAmB/mH,KAAK6mH,YAAYlF,WAAWsF,EAAW7gH,KAC1DpG,KAAK2mH,WAAWjF,SAASuF,EAAW7gH,IACpCpG,KAAK2mH,WAAW9I,UAAUoJ,EAAW7gH,IACrC2gH,EAAmB/mH,KAAK2mH,WAAWhF,WAAWsF,EAAW7gH,WAI/D,EAAA8gH,GAAA,MACA,QA5DF,UAAwC/J,EAAUtO,IAIhD,MAAO,CAAE,EAAG,CAAEsY,GAAmB,CAAE,EAAG,CAAEC,GAAqB,CAAE,EAAG,CAAEC,IAClElK,GAEAmK,EACAC,GACCC,EAAmBC,GACpBC,EACAC,GACCC,EAAqBC,GACtBC,EACAC,GACCC,EAAoBC,IACnBpZ,EAsBJ,MAbe,CACbyY,EACAC,EACAC,EACAE,EACAC,EACAC,EACAE,EACAC,EACAC,EAbAb,EAAmBM,GACnBL,EAAqBS,GACrBR,EAAoBY,EAgBxB,IAyBF,CAEA,WAAAtI,GA4CE,OA3CiB3/G,KAAK8mH,iBAAiB56G,MACrC,QACE,EACEo7G,EACAC,EACAC,EACAE,EACAC,EACAC,EACAE,EACAC,EACAC,EACAE,MAEA,MAAMC,EAA4BX,EAAkBlO,YAClDgO,QAAAA,EAAmBC,GAEfa,EAA8BR,EAAoBtO,YACtDoO,QAAAA,EAAqBC,GAEjBU,EAA6BL,EAAmB1O,YACpDwO,QAAAA,EAAoBC,GAiBtB,MAAO,CAdS/nH,KAAKsoH,2BAA2B,CAC9CxkG,SAAU0jG,EAAkB9N,SAASyO,GACrC1pC,WAAYmpC,EAAoBlO,SAAS0O,GACzCp8G,UAAWg8G,EAAmBtO,SAAS2O,GACvCH,kBAGaj/G,OAAOH,OACpB,IAAIm1G,GACJuJ,EAAkB59F,OAClBg+F,EAAoBh+F,OACpBo+F,EAAmBp+F,QAGiE,IAM9F,CAEM,UAAAg2F,G,0CACJ,aAAa,OAAe5/G,KAAK2/G,cACnC,G,CAEM,yCAAAI,CAA0CruG,G,0CAC9C,MAAMgwG,EAAW1hH,KAAKmc,eAAe6Q,eAAe9gB,MAClD,EAAAyhF,GAAA,IAAWs5B,IACT,EAAA5Y,GAAA,GACEruG,KAAK4mH,UAAUjF,WAAWsF,EAAW7gH,IACrCpG,KAAK6mH,YAAYlF,WAAWsF,EAAW7gH,IACvCpG,KAAK2mH,WAAWhF,WAAWsF,EAAW7gH,QAG1C,QAAI,EAAEohH,EAAmBI,EAAqBW,MAC5C,MAAM3+F,EAAS3gB,OAAOH,OACpB,IAAIm1G,GACJuJ,EAAkB59F,OAClBg+F,EAAoBh+F,OACpB2+F,EAAoB3+F,QAGhB4+F,EAAoBD,EAAoBjP,YAAY5nG,GACpD+2G,EAAsB,OAAH,wBACpB/2G,GACA62G,EAAoB7O,SAAS8O,IAElC,GAAqB,aAAjB92G,EAAQpE,KAAqB,CAC/B,MAAMi5G,EAAUiB,EAAkBlO,YAAYmP,GAE9C,MAAO,CADWjB,EAAkB9N,SAAS6M,GAC1B38F,E,CACd,CACL,MAAM28F,EAAUqB,EAAoBtO,YAAYmP,GAEhD,MAAO,CADWb,EAAoBlO,SAAS6M,GAC5B38F,E,OAKlBu2F,EAAWv2F,SAAgB,OAAe83F,GACjD,MAAO,CAELz4G,OAAOH,OAAO4I,EAASyuG,GACvBv2F,EAEJ,G,CAEM,WAAAw2F,CAAY1uG,G,0CAChB,MAAMqqE,EAAS/7E,KAAK0oH,gBAAgBh3G,GAC9B4rB,QAAsB,OAAet9B,KAAKmc,eAAe6Q,gBAIzD27F,GAAqB,EAAAta,GAAA,GACzBruG,KAAK2mH,WAAWjF,SAASpkF,EAAcl3B,IACvCpG,KAAK2mH,WAAW9I,UAAUvgF,EAAcl3B,KACxC8F,MAAK,QAAI,EAAEwF,EAASk3G,KAAcl3G,QAAAA,EAAWk3G,KAC/C,IAAIC,QAA0B,OAAeF,GAC7CE,EAAoB5/G,OAAOH,OAAO+/G,EAAmB9sC,EAAO/vE,iBACtDhM,KAAK2mH,WAAWvG,YAAY9iF,EAAcl3B,GAAIyiH,SAG9C7oH,KAAK4mH,UAAUxG,YAAY9iF,EAAcl3B,GAAI21E,EAAOj4D,gBACpD9jB,KAAK6mH,YAAYzG,YAAY9iF,EAAcl3B,GAAI21E,EAAO0C,WAC9D,G,CAEQ,eAAAiqC,CAAgBh3G,GACtB,MAAO,CACL1F,UAAW,CACTsB,KAAMoE,EAAQpE,MAEhBwW,SAAU,CACRrhB,OAAQiP,EAAQjP,OAChB2hB,UAAW1S,EAAQ0S,UACnB65D,UAAWvsE,EAAQusE,UACnBC,UAAWxsE,EAAQwsE,UACnBC,aAAczsE,EAAQysE,aACtBC,UAAW1sE,EAAQ0sE,UACnBC,aAAc3sE,EAAQ2sE,aACtB52B,OAAQ/1C,EAAQ+1C,OAChB62B,UAAW5sE,EAAQ4sE,UACnBC,QAAS7sE,EAAQ6sE,QACjBC,WAAY9sE,EAAQ8sE,YAEtBC,WAAY,CACVC,SAAUhtE,EAAQgtE,SAClBC,cAAejtE,EAAQitE,cACvBC,WAAYltE,EAAQktE,WACpBC,cAAentE,EAAQmtE,eAEzBqpC,eAAe,EAEnB,CAEQ,0BAAAI,CAA2B52G,GACjC,MAAO,CACLpE,KAAMoE,EAAQ1F,UAAUsB,KACxB7K,OAAQiP,EAAQoS,SAASrhB,OACzB2hB,UAAW1S,EAAQoS,SAASM,UAC5B65D,UAAWvsE,EAAQoS,SAASm6D,UAC5BC,UAAWxsE,EAAQoS,SAASo6D,UAC5BC,aAAczsE,EAAQoS,SAASq6D,aAC/BC,UAAW1sE,EAAQoS,SAASs6D,UAC5BC,aAAc3sE,EAAQoS,SAASu6D,aAC/B52B,OAAQ/1C,EAAQoS,SAAS2jC,OACzB62B,UAAW5sE,EAAQoS,SAASw6D,UAC5BC,QAAS7sE,EAAQoS,SAASy6D,QAC1BC,WAAY9sE,EAAQoS,SAAS06D,WAC7BE,SAAUhtE,EAAQ+sE,WAAWC,SAC7BC,cAAejtE,EAAQ+sE,WAAWE,cAClCC,WAAYltE,EAAQ+sE,WAAWG,WAC/BC,cAAentE,EAAQ+sE,WAAWI,cAClCqpC,cAAex2G,EAAQw2G,cAE3B,CAEA,UAAA7H,GACE,MAAMtD,EAAU/8G,KAAKmc,eAAe6Q,eAAe9gB,MACjD,EAAAyhF,GAAA,IAAW9uD,GAAY7+B,KAAK+8G,QAAQ+I,aAAajnF,EAAQz4B,OACzD,OAAQ,CAEN0iH,KAAM,IACN,OACE,MAAO,EACT,KAEF,QAAK/L,GAAYA,EAAQt4G,IAAIskH,OAG/B,OAAO,OAAehM,EACxB,CAEM,UAAA4D,CAAW78F,G,0CACf,MAAM+a,QAAgB,OAAe7+B,KAAKmc,eAAe6Q,iBACrD6R,aAAO,EAAPA,EAASz4B,YAELpG,KAAK+8G,QAAQ0I,MAAM5mF,EAAQz4B,GAAI0d,EAAU,YAEnD,G,CAEA,KAAAkxC,GACE,MAAMg0D,EAAWhpH,KAAKmc,eAAe6Q,eAAe9gB,MAClD,QAAQ2yB,MAAcA,aAAO,EAAPA,EAASz4B,OAC/B,EAAAunF,GAAA,IAAW9uD,GAAY7+B,KAAK+8G,QAAQ/nD,MAAMn2B,EAAQz4B,OAClD,OAAQ,CAEN0iH,KAAM,IACN,OACE,MAAO,EACT,KAEF,QAAK/L,GAAYA,EAAQt4G,IAAIskH,OAG/B,OAAO,OAAeC,EACxB,EAGF,SAASD,GAA2Bj5G,GAClC,OAAO,IAAI4rG,GAAyB5rG,EAAM1C,WAAY0C,EAAM2rG,eAAensE,UAC7E,CCvaO,MAAM25E,GAIX,UAAIr/F,GACF,MAAO,CAAC,CACV,CAGA,kBAAIqvF,GACF,OAAO,CACT,CAGA,WAAAK,CAAY5nG,GACV,OAAOA,CACT,CAGA,QAAAgoG,CAAShoG,GACP,OAAOA,CACT,ECbK,MAAMw3G,GAA0DjgH,OAAOovG,OAAO,CACnFh3B,gBAAgB,EAChBC,mBAAmB,EACnB6nC,QAAS,OCEJ,MAAMC,GAMX,WAAA5pH,CACU6pH,EACA5sG,GADA,KAAA4sG,gBAAAA,EACA,KAAA5sG,cAAAA,CACP,CAGH,YAAAmhG,CAAax3G,GACX,OAAOpG,KAAKyc,cAAc8O,QAAQnlB,EAAI01G,GACxC,CAGA,SAAA+B,CAAU1nG,GACR,OAAO,IAAI,KAAgB,OAAD,UAAM+yG,KAA6B78F,cAC/D,CAGA,UAAIzC,GAGF,OAAOgI,GAAWuJ,iBACpB,CAGA,WAAA2iF,GACE,OAAO,EAAA5xG,GAAA,IAAK,QAAKuf,GAAM,IAAIw9F,KAC7B,CAGA,QAAAlL,CAASrsG,GACP,OAAO1R,KAAKqpH,gBAAgBC,aAAa53G,EAC3C,ECrCK,MAAM63G,GAAoDtgH,OAAOovG,OAAO,CAC7E12B,aAAc,SACdC,eAAgB,GAChBunC,QAAS,OCLJ,MAAMK,GAMX,WAAAhqH,CACU6pH,EACA5sG,GADA,KAAA4sG,gBAAAA,EACA,KAAA5sG,cAAAA,CACP,CAGH,YAAAmhG,CAAax3G,GACX,OAAOpG,KAAKyc,cAAc8O,QAAQnlB,EAAI21G,GACxC,CAGA,SAAA8B,CAAU1nG,GACR,OAAO,IAAI,KAAgB,OAAD,UAAMozG,KAA0Bl9F,cAC5D,CAGA,UAAIzC,GAGF,OAAOgI,GAAWuJ,iBACpB,CAGA,WAAA2iF,GACE,OAAO,EAAA5xG,GAAA,IAAK,QAAKuf,GAAM,IAAIw9F,KAC7B,CAGA,QAAAlL,CAASrsG,GACP,OAAO1R,KAAKqpH,gBAAgBI,iBAAiB/3G,EAC/C,ECrCK,MAAMg4G,GAAwDzgH,OAAOovG,OAAO,CACjF72B,eAAgB,SAChBC,gBAAiB,GACjB0nC,QAAS,OCKJ,MAAMQ,GAMX,WAAAnqH,CACU6pH,EACA5sG,GADA,KAAA4sG,gBAAAA,EACA,KAAA5sG,cAAAA,CACP,CAGH,YAAAmhG,CAAax3G,GACX,OAAOpG,KAAKyc,cAAc8O,QAAQnlB,EAAI41G,GACxC,CAGA,SAAA6B,CAAU1nG,GACR,OAAO,IAAI,KAAgB,OAAD,UAAMuzG,KAA4Br9F,cAC9D,CAGA,UAAIzC,GAGF,OAAOgI,GAAWuJ,iBACpB,CAGA,WAAA2iF,GACE,OAAO,EAAA5xG,GAAA,IAAK,QAAKuf,GAAM,IAAIw9F,KAC7B,CAGA,QAAAlL,CAASrsG,GACP,OAAO1R,KAAKqpH,gBAAgBO,mBAAmBl4G,EACjD,E,2SCpDK,MAAMm4G,GACL,QAAA9L,CAAS9xF,EAAwBva,G,oDACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,6BAER,GAAgC,OAAZ,QAAhB,EAAAp/E,EAAQo4G,gBAAQ,eAAEtiH,SAA8C,KAA5BkK,EAAQo4G,SAAStiH,OACvD,KAAM,0BAER,GAAiC,OAAb,QAAhB,EAAAkK,EAAQo4G,gBAAQ,eAAEtiD,UAAgD,KAA7B91D,EAAQo4G,SAAStiD,QACxD,KAAM,uBAGR,MAAMwkC,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQo/E,OACnC,eAAgB,mBAChB,mBAAoB,oBAGlB7pF,EAAMyK,EAAQo4G,SAAStiD,QAAU,kBACvCwkC,EAAY5kC,KAAO38C,KAAKC,UAAU,CAChCljB,OAAQkK,EAAQo4G,SAAStiH,OACzBwsF,aACsB,MAAnBtiF,EAAQy3G,QAAkB,YAAcz3G,EAAQy3G,QAAU,KAAO,IAClE,4BAEJ,MAAMvwF,EAAU,IAAIuuC,QAAQlgE,EAAK+kG,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,OAAiB,QAAV,EAAAA,aAAI,EAAJA,EAAMuE,YAAI,eAAE3B,K,CAErB,GAAwB,MAApBnD,EAASwT,OACX,KAAM,6BAER,GAA4B,OAAxBxT,aAAQ,EAARA,EAAUs8G,YACZ,KAAM,mBAAqBt8G,EAASs8G,WAEtC,KAAM,iC,gTCzCH,MAAMC,GACL,QAAAlM,CAAS9xF,EAAwBva,G,0CACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,gCAER,MAAMkb,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQo/E,OACnC,eAAgB,sBAIdl4D,EAAU,IAAIuuC,QADR,mDACqB6kC,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,GAAIA,EAAKggD,QACP,MAAO,GAAGhgD,EAAKggD,kB,MAEZ,GAAwB,MAApBvgD,EAASwT,OAClB,KAAM,gCAER,KAAM,oCACR,G,6SC1BK,MAAMgpG,GACL,QAAAnM,CAAS9xF,EAAwBva,G,oEACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,8BAGR,MAAMq5B,QAAkBnqH,KAAKoqH,aAAan+F,EAAYva,GACtD,GAAiB,MAAby4G,GAAmC,KAAdA,EACvB,KAAM,qDAGR,MAAME,EAAY34G,EAAQy3G,SAAW,GAE/Bnd,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQo/E,OACnC,eAAgB,sBAIpBkb,EAAY5kC,KAAO38C,KAAKC,UAAU,CAChC4/F,MAAO,CAAC,2CAA4C,6BACpDC,YAAa,CACX,CACE,kBACA,CACEJ,UAAWA,EACXj8G,OAAQ,CACN,mBAAoB,CAClBsM,MAAO,UACPw5E,YAAa,GACbq2B,UAAWA,EACXG,YAAa94G,EAAQ6uE,SAASv+D,UAIpC,QAIN,MAAM4W,EAAU,IAAIuuC,QArBR,qCAqBqB6kC,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,OAAgB,CAC3B,MAAMjT,QAAaP,EAASO,OAC5B,GAC0B,MAAxBA,EAAKw8G,iBACLx8G,EAAKw8G,gBAAgBhoH,OAAS,GAC9BwL,EAAKw8G,gBAAgB,GAAGhoH,OAAS,EAEjC,GAAmC,oBAA/BwL,EAAKw8G,gBAAgB,GAAG,GAA0B,CACpD,GAAiE,OAA1B,QAAnC,EAA0B,QAA1B,EAAAx8G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEC,eAAO,eAAG,qBACxC,OAAgE,QAAzD,EAAmC,QAAnC,EAA0B,QAA1B,EAAAz8G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEC,eAAO,eAAG,2BAAmB,eAAE75G,MAEpE,GAAoE,OAA1B,QAAtC,EAA0B,QAA1B,EAAA5C,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEE,kBAAU,eAAG,qBAC3C,KACE,oBAC4D,QAA5D,EAAsC,QAAtC,EAA0B,QAA1B,EAAA18G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEE,kBAAU,eAAG,2BAAmB,eAAE32B,Y,MAG7D,GAAmC,UAA/B/lF,EAAKw8G,gBAAgB,GAAG,GACjC,KAAM,oBAA+C,QAA1B,EAAAx8G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEz2B,Y,CAI7D,GAAwB,MAApBtmF,EAASwT,QAAsC,MAApBxT,EAASwT,OACtC,KAAM,8BAER,KAAM,kC,IAGM,YAAAkpG,CAAan+F,EAAwBva,G,0CACjD,MAAMs6F,EAA2B,CAC/BxtD,MAAO,WACP6oB,OAAQ,MACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQo/E,UAIjCl4D,EAAU,IAAIuuC,QADR,4CACqB6kC,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,OAAgB,CAC3B,MAAMjT,QAAaP,EAASO,OAC5B,GAA4B,MAAxBA,EAAK28G,gBACP,OAAO38G,EAAK28G,gBAAgB,2C,CAGhC,OAAO,IACT,G,6SC3FK,MAAMC,GACL,QAAA9M,CAAS9xF,EAAwBva,G,0CACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,mCAER,MAAMkb,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,SAAWp4F,EAAQo/E,OAClC,eAAgB,sBAIpBkb,EAAY5kC,KAAO38C,KAAKC,UAAU,CAChCqE,SAAS,EACT+7F,cAAep5G,EAAQy3G,QACvBn1B,aACsB,MAAnBtiF,EAAQy3G,QAAkBz3G,EAAQy3G,QAAU,MAAQ,IAAM,4BAE/D,MAAMvwF,EAAU,IAAIuuC,QAPR,mDAOqB6kC,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,OAAOA,aAAI,EAAJA,EAAM88G,Y,CAEf,GAAwB,MAApBr9G,EAASwT,OACX,KAAM,mCAER,KAAM,uCACR,G,ECpCK,MAAM8pG,GAAb,cAGE,KAAAzqC,SAAW,IAAI0qC,GACf,KAAAnB,SAAW,IAAIoB,GACf,KAAAC,aAAe,IAAIC,GACnB,KAAAC,YAAc,IAAIC,EACpB,EAEO,MAAML,IAIN,MAAMC,IAKN,MAAME,IAIN,MAAME,I,2SCjBN,MAAMC,GACL,QAAAxN,CAAS9xF,EAAwBva,G,0CACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,+BAER,MAAMkb,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnBwkD,eAAgB95G,EAAQo/E,OACxB,eAAgB,sBAGpB,IAAI7pF,EAAMyK,EAAQ25G,YAAY7jD,QAAU,wBACjB,MAAnB91D,EAAQy3G,UACVliH,GAAO,aAAeyK,EAAQy3G,SAEhCnd,EAAY5kC,KAAO38C,KAAKC,UAAU,CAChC+gG,MACsB,MAAnB/5G,EAAQy3G,QAAkB,YAAcz3G,EAAQy3G,QAAU,KAAO,IAClE,4BAEJ,MAAMvwF,EAAU,IAAIuuC,QAAQlgE,EAAK+kG,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CAEtD,aADmBxT,EAASO,QAChBy9G,K,CAEd,GAAwB,MAApBh+G,EAASwT,OACX,KAAM,+BAER,MAAMjT,QAAaP,EAASO,OAC5B,GAAmB,OAAfA,aAAI,EAAJA,EAAM1N,OACR,KAAM,qBAAuB0N,EAAK1N,MAEpC,KAAM,qCACR,G,6SCpCK,MAAMorH,GACL,QAAA5N,CAAS9xF,EAAwBva,G,kDACrC,GAAsB,MAAlBA,EAAQo/E,QAAqC,KAAnBp/E,EAAQo/E,OACpC,KAAM,iCAER,GAAoC,OAAZ,QAApB,EAAAp/E,EAAQy5G,oBAAY,eAAE3jH,SAAkD,KAAhCkK,EAAQy5G,aAAa3jH,OAC/D,KAAM,gCAER,MAAMwkG,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,SAAW,EAAMrkG,cAAciM,EAAQo/E,OAAS,KAC/D,eAAgB,sBAGd7pF,EAAM,2CAA2CyK,EAAQy5G,aAAa3jH,iBAC5EwkG,EAAY5kC,KAAO38C,KAAKC,UAAU,CAChCkhG,OAAQl6G,EAAQy3G,QAChBn1B,aACsB,MAAnBtiF,EAAQy3G,QAAkB,YAAcz3G,EAAQy3G,QAAU,KAAO,IAClE,4BAEJ,MAAMvwF,EAAU,IAAIuuC,QAAQlgE,EAAK+kG,GAC3Bt+F,QAAiBue,EAAWw+E,YAAY7xE,GAC9C,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,OAAOA,aAAI,EAAJA,EAAMzM,MAAO,MAAmB,QAAZ,EAAAyM,aAAI,EAAJA,EAAMzG,cAAM,eAAEhG,OAAQkQ,EAAQy5G,aAAa3jH,O,CAExE,GAAwB,MAApBkG,EAASwT,OACX,KAAM,iCAER,MAAMjT,QAAaP,EAASO,OAC5B,GAAqB,OAAjBA,aAAI,EAAJA,EAAMnO,SACR,KAAM,yBAA2BmO,EAAKnO,QAExC,GAAmB,OAAfmO,aAAI,EAAJA,EAAM1N,OACR,KAAM,yBAA2B0N,EAAK1N,MAExC,KAAM,uC,gTC1BV,MAAM,GAA2C,CAC/C+M,KAAM,OACN67G,QAAS,KACT9nC,gBAAgB,EAChBC,mBAAmB,EACnBE,eAAgB,SAChBG,aAAc,SACdT,iBAAkB,GAClBd,wBAAyB,cACzBF,yBAA0B,sBAC1BW,4BAA6B,kBAC7BG,4BAA6B,8BAGxB,MAAM6qC,GACX,WAAArsH,CACUsU,EACA4I,EACAuP,GAFA,KAAAnY,cAAAA,EACA,KAAA4I,aAAAA,EACA,KAAAuP,WAAAA,CACP,CAEH,gBAAA6/F,CAAiBp6G,GACf,MAAqB,aAAjBA,EAAQpE,KACHtN,KAAKypH,iBAAiB/3G,GACH,eAAjBA,EAAQpE,KACVtN,KAAK4pH,mBAAmBl4G,GACL,cAAjBA,EAAQpE,KACVtN,KAAK+rH,kBAAkBr6G,GAEvB1R,KAAKspH,aAAa53G,EAE7B,CAEM,YAAA43G,CAAa53G,G,0CACjB,MAAMykB,EAAIltB,OAAOH,OAAO,CAAC,EAAG,GAAgB4I,GAEpB,MAApBykB,EAAEkrD,iBACJlrD,EAAEkrD,gBAAiB,GAEM,MAAvBlrD,EAAEmrD,oBACJnrD,EAAEmrD,mBAAoB,GAGxB,MAAMm+B,QAAkBz/G,KAAK8T,cAAcwrG,aAAa,EAAGhB,GAAgB77G,OAAS,GACpF,IAAIupH,EAAO1N,GAAgBmB,GAI3B,GAHItpF,EAAEkrD,iBACJ2qC,EAAOA,EAAKtiH,OAAO,GAAGC,cAAgBqiH,EAAKpnH,MAAM,IAE/CuxB,EAAEmrD,kBAAmB,CACvB,MAAM6/B,QAAYnhH,KAAK8T,cAAcwrG,aAAa,EAAG,MACrD0M,GAAchsH,KAAKisH,QAAQ9K,EAAI19G,WAAY,E,CAE7C,OAAOuoH,CACT,G,CAEM,kBAAApC,CAAmBl4G,G,0CACvB,MAAMykB,EAAIltB,OAAOH,OAAO,CAAC,EAAG,GAAgB4I,GAEtC+vE,EAAkBtrD,EAAEsrD,gBAC1B,GAAuB,MAAnBA,GAA2BA,EAAgBh/E,OAAS,EACtD,OAAO0zB,EAAEsrD,gBAEX,MAAMyqC,EAAUzqC,EAAgB56E,QAAQ,KACxC,GAAIqlH,EAAU,GAAKA,GAAWzqC,EAAgBh/E,OAAS,EACrD,OAAOg/E,EAEe,MAApBtrD,EAAEqrD,iBACJrrD,EAAEqrD,eAAiB,UAGrB,MAAM2qC,EAAiB1qC,EAAgBz+E,OAAO,EAAGkpH,GAC3CE,EAAc3qC,EAAgBz+E,OAAOkpH,EAAU,EAAGzqC,EAAgBh/E,QAExE,IAAI4pH,EAAmB,GAMvB,MALyB,WAArBl2F,EAAEqrD,eACJ6qC,QAAyBrsH,KAAKssH,aAAa,GACb,iBAArBn2F,EAAEqrD,iBACX6qC,EAAmBl2F,EAAEgzF,SAEhBgD,EAAiB,IAAME,EAAmB,IAAMD,CACzD,G,CAEM,gBAAA3C,CAAiB/3G,G,0CACrB,MAAMykB,EAAIltB,OAAOH,OAAO,CAAC,EAAG,GAAgB4I,GAE5C,GAAwB,MAApBykB,EAAEyrD,gBAA+C,KAArBzrD,EAAEyrD,eAChC,OAAO,KAEa,MAAlBzrD,EAAEwrD,eACJxrD,EAAEwrD,aAAe,UAGnB,IAAI4qC,EAAc,GAMlB,MALuB,WAAnBp2F,EAAEwrD,aACJ4qC,QAAoBvsH,KAAKssH,aAAa,GACV,iBAAnBn2F,EAAEwrD,eACX4qC,EAAcp2F,EAAEgzF,SAEXoD,EAAc,IAAMp2F,EAAEyrD,cAC/B,G,CAEM,iBAAAmqC,CAAkBr6G,G,0CACtB,MAAMykB,EAAIltB,OAAOH,OAAO,CAAC,EAAG,GAAgB4I,GAE5C,GAA0B,MAAtBykB,EAAE+qD,iBACJ,OAAO,KAGT,IAAID,EAAuB,KAC3B,MAAMurC,EAAmB,IAAIxB,GA0B7B,OAzBAwB,EAAiBrD,QAAUhzF,EAAEgzF,QACF,gBAAvBhzF,EAAE+qD,kBACJD,EAAY,IAAIsqC,GAChBiB,EAAiB17B,OAAS36D,EAAE4qD,2BAC5ByrC,EAAiBnB,YAAY7jD,QAAUrxC,EAAE6qD,6BACT,aAAvB7qD,EAAE+qD,kBACXD,EAAY,IAAI4oC,GAChB2C,EAAiB17B,OAAS36D,EAAEgqD,0BAC5BqsC,EAAiB1C,SAAStiH,OAAS2uB,EAAEiqD,wBACrCosC,EAAiB1C,SAAStiD,QAAUrxC,EAAE+pD,0BACN,iBAAvB/pD,EAAE+qD,kBACXD,EAAY,IAAI4pC,GAChB2B,EAAiB17B,OAAS36D,EAAEuqD,0BACI,aAAvBvqD,EAAE+qD,kBACXD,EAAY,IAAIipC,GAChBsC,EAAiB17B,OAAS36D,EAAEqqD,2BACI,eAAvBrqD,EAAE+qD,kBACXD,EAAY,IAAIgpC,GAChBuC,EAAiB17B,OAAS36D,EAAEmqD,0BACI,iBAAvBnqD,EAAE+qD,mBACXD,EAAY,IAAI0qC,GAChBa,EAAiB17B,OAAS36D,EAAEyqD,8BAC5B4rC,EAAiBrB,aAAa3jH,OAAS2uB,EAAE0qD,6BAG1B,MAAbI,EACK,KAGFA,EAAU88B,SAAS/9G,KAAKisB,WAAYugG,EAC7C,G,CAEA,WAAA7M,GACE,OAAO,EAAAt9G,GAAA,GAAKrC,KAAK4/G,aACnB,CAEM,UAAAA,G,0CACJ,IAAIluG,QAAgB1R,KAAK0c,aAAa+vG,+BAOtC,OALE/6G,EADa,MAAXA,EACQzI,OAAOH,OAAO,CAAC,EAAG,IAElBG,OAAOH,OAAO,CAAC,EAAG,GAAgB4I,SAExC1R,KAAK0c,aAAagwG,6BAA6Bh7G,GAC9CA,CACT,G,CAEM,WAAA0uG,CAAY1uG,G,gDACV1R,KAAK0c,aAAagwG,6BAA6Bh7G,EACvD,G,CAEc,YAAA46G,CAAa7pH,G,0CACzB,IAAIP,EAAM,GACV,MAAMyqH,EAAU,uCAChB,IAAK,IAAIjqH,EAAI,EAAGA,EAAID,EAAQC,IAAK,CAC/B,MAAM28G,QAAwBr/G,KAAK8T,cAAcwrG,aAAa,EAAGqN,IACjEzqH,GAAOyqH,EAAQjjH,OAAO21G,E,CAExB,OAAOn9G,CACT,G,CAGQ,OAAA+pH,CAAQxkE,EAAgBmlE,GAC9B,OAAOnlE,EAAOhlD,QAAUmqH,EACpBnlE,EACA,IAAIljD,MAAMqoH,EAAQnlE,EAAOhlD,OAAS,GAAGoC,KAAK,KAAO4iD,CACvD,ECxLK,MAAeolE,ICWf,MAAeC,WAEZD,GAMR,WAAArtH,CACmBmU,EACAoxG,EACTtoG,GAERhP,QAJiB,KAAAkG,eAAAA,EACA,KAAAoxG,WAAAA,EACT,KAAAtoG,cAAAA,EAQF,KAAAswG,cAAgB,IAAIntH,IAG5B,KAAAg+G,aAAgBznG,IACd,IAAIqE,EAAQxa,KAAK+sH,cAAc9yG,IAAI9D,GAQnC,OANKqE,IACHA,EAAQxa,KAAKgtH,YAAY72G,GAEzBnW,KAAK+sH,cAAchlH,IAAIoO,EAAQqE,IAG1BA,CAAK,EAmDd,KAAAsjG,YAAc,KACL,EAAA5xG,GAAA,IAAK,QAAKuf,GAAM,IAAIw9F,MAnE3BjpH,KAAK4pB,OAASgI,GAAWuJ,iBAC3B,CAiBQ,WAAA6xF,CAAY72G,GAElB,MAAM6vG,EAAS,IAAIhD,GAvCI,KAwCjBY,EAAY,IAAIkB,GAAiB9kH,KAAK2T,eAAgB3T,KAAK+kH,WAAYiB,GAGvE9K,EAAaf,GAAiBE,YAAqBG,QAAQ,WAG3DrqG,EAAM8qG,GAAoBnrG,MAAM9P,KAAKmQ,IAAIgE,gBAAiBnU,KAAKmQ,IAAIA,IAAK+qG,EAAY,CACxFvmG,aAAekjB,GAAM73B,KAAKmQ,IAAIwE,aAAakjB,GAC3CjjB,eAAgB5U,KAAKmQ,IAAIyE,eACzBoB,QAAShW,KAAKmQ,IAAI6F,UAIdi3G,EAActJ,GAAYthH,KAM9B8T,EAAQhG,EAAKnQ,KAAKyc,cAAemnG,GAG7BsJ,EAAcltH,KAAK+kH,WACtB5lF,uBAAuBhpB,GACvBjK,MAAK,QAAKiE,GAAgB,OAARA,KAQrB,OAPsB,IAAI4xG,GACxB/hH,KAAKyc,cACLzc,KAAKmtH,YACLF,EACAC,EAIJ,ECvFK,MAAME,GAAankH,OAAOovG,OAAO,CAEtCgV,OAAQpkH,OAAOovG,OAAO,CACpBjyG,GAAI,WACJ5E,KAAM,UACN8rH,oBAAoB,IAItBC,WAAYtkH,OAAOovG,OAAO,CACxBjyG,GAAI,aACJ5E,KAAM,aACN8rH,oBAAoB,IAItBE,SAAUvkH,OAAOovG,OAAO,CACtBjyG,GAAI,WACJ5E,KAAM,WACN8rH,oBAAoB,IAItBG,aAAcxkH,OAAOovG,OAAO,CAC1BjyG,GAAI,eACJ5E,KAAM,gBACN8rH,oBAAoB,IAItBI,aAAczkH,OAAOovG,OAAO,CAC1BjyG,GAAI,eACJ5E,KAAM,gBACN8rH,oBAAoB,IAItBK,YAAa1kH,OAAOovG,OAAO,CACzBjyG,GAAI,cACJ5E,KAAM,cACN8rH,oBAAoB,M,2SCjCjB,MAAMM,GAAkE3kH,OAAOovG,OAAO,CAC3F8Q,QAAS,KACT3hD,QAAS,sBACTzmE,MAAO,GACPyG,OAAQ,KAIH,MAAMqmH,WAAwBf,GAUnC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAmBV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAMy3G,KAIlC,KAAA7P,SAAkBrsG,GAAuD,mC,QACvE,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWC,OAAO7rH,K,CAG7E,IAAKkQ,EAAQlK,QAA6B,KAAnBkK,EAAQlK,OAAe,CAE5C,MADcxH,KAAKkI,YAAYovB,EAAE,oBAAqB81F,GAAWC,OAAO7rH,K,CAG1E,IAAKkQ,EAAQ81D,SAA+B,KAApB91D,EAAQ81D,QAAgB,CAE9C,MADcxnE,KAAKkI,YAAYovB,EAAE,iBAAkB81F,GAAWC,OAAO7rH,K,CAIvE,IAAIssH,EAAgB,kCACfp8G,EAAQy3G,SAA+B,KAApBz3G,EAAQy3G,UAC9B2E,EAAgB,wBAElB,MAAM95B,EAAch0F,KAAKkI,YAAYovB,EAAEw2F,EAA8B,QAAf,EAAAp8G,EAAQy3G,eAAO,QAAI,IAEnEliH,EAAMyK,EAAQ81D,QAAU,kBACxB5uC,EAAU,IAAIuuC,QAAQlgE,EAAK,CAC/B8iH,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQ3Q,MACnC,eAAgB,mBAChB,mBAAoB,mBAEtBqmE,KAAM38C,KAAKC,UAAU,CACnBljB,OAAQkK,EAAQlK,OAChBwsF,kBAIEtmF,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,OAAiB,QAAV,EAAAA,aAAI,EAAJA,EAAMuE,YAAI,eAAE3B,K,CACd,GAAwB,MAApBnD,EAASwT,OAAgB,CAElC,MADclhB,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWC,OAAO7rH,K,CAEtE,GAAIkM,aAAQ,EAARA,EAAUs8G,WAAY,CAM/B,MALchqH,KAAKkI,YAAYovB,EAC7B,iBACA81F,GAAWC,OAAO7rH,KAClBkM,EAASs8G,W,CAKX,MADchqH,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWC,OAAO7rH,KAGhF,GAxEA,CAGA,OAAI2O,GACF,OAAO8rG,EACT,CAGA,eAAIkR,GACF,OAAO5Q,EACT,EAiE4BtzG,OAAOovG,OAAO,CAC1C8Q,QAAS,KACT3hD,QAAS,sBACThgE,OAAQ,GACRzG,MAAO,K,2SCzGF,MAAMgtH,GAAuC9kH,OAAOovG,OAAO,CAChE8Q,QAAS,KACTpoH,MAAO,KAIF,MAAM,WAA4B+rH,GAQvC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAmBV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAM43G,KAIlC,KAAAhQ,SAAkBrsG,GAAyC,mCACzD,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWG,WAAW/rH,K,CAIjF,MACMo3B,EAAU,IAAIuuC,QADR,mDACqB,CAC/B4iD,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQ3Q,MACnC,eAAgB,uBAId2M,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CACtD,MAAMjT,QAAaP,EAASO,OAC5B,GAAIA,EAAKggD,QACP,MAAO,GAAGhgD,EAAKggD,mBAGf,MADcjuD,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWG,WAAW/rH,K,CAG7E,GAAwB,MAApBkM,EAASwT,OAAgB,CAElC,MADclhB,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWG,WAAW/rH,K,CAI/E,MADcxB,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWG,WAAW/rH,KAGpF,GAnDA,CAGA,OAAI2O,GACF,OAAO+rG,EACT,CAGA,eAAIiR,GACF,OAAO3Q,EACT,EA4C4BvzG,OAAOovG,OAAO,CAC1C8Q,QAAS,KACTpoH,MAAO,K,2SC9EF,MAAMitH,GAA0D/kH,OAAOovG,OAAO,CACnF8Q,QAAS,GACT3hH,OAAQ,GACRwa,OAAQ,GACRjhB,MAAO,KAIF,MAAM,WAA0B+rH,GAQrC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAcV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAM63G,KASlC,KAAAjQ,SAAkBrsG,GAA6C,mC,0BAC7D,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWI,SAAShsH,K,CAI/E,MAAM2oH,QAAkBnqH,KAAKoqH,aAAa14G,GAC1C,IAAKy4G,GAA2B,KAAdA,EAAkB,CAElC,MADcnqH,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWI,SAAShsH,K,CAI/E,MAAM4lE,EAAO38C,KAAKC,UAAU,CAC1B4/F,MAAO,CAAC,2CAA4C,6BACpDC,YAAa,CACX,CACE,kBACA,CACEJ,UAAWA,EACXj8G,OAAQ,CACN,mBAAoB,CAClBsM,MAAO,UACPw5E,YAAa,GACbq2B,UAAW34G,EAAQy3G,QACnBqB,YAAa94G,EAAQsQ,UAI3B,QAKAgqF,EAA2B,CAC/B+d,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQ3Q,MACnC,eAAgB,qBAElBqmE,QAIIxuC,EAAU,IAAIuuC,QADR,qCACqB6kC,GAE3Bt+F,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,OAAgB,CAC3B,MAAMjT,QAAaP,EAASO,OAC5B,GAC0B,MAAxBA,EAAKw8G,iBACLx8G,EAAKw8G,gBAAgBhoH,OAAS,GAC9BwL,EAAKw8G,gBAAgB,GAAGhoH,OAAS,EAEjC,GAAmC,oBAA/BwL,EAAKw8G,gBAAgB,GAAG,GAA0B,CACpD,GAAiE,OAA1B,QAAnC,EAA0B,QAA1B,EAAAx8G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEC,eAAO,eAAG,qBACxC,OAAgE,QAAzD,EAAmC,QAAnC,EAA0B,QAA1B,EAAAz8G,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEC,eAAO,eAAG,2BAAmB,eAAE75G,MAEpE,GAAoE,OAA1B,QAAtC,EAA0B,QAA1B,EAAA5C,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEE,kBAAU,eAAG,qBAA6B,CACxE,MAAMsD,EACwD,QAA5D,EAAsC,QAAtC,EAA0B,QAA1B,EAAAhgH,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEE,kBAAU,eAAG,2BAAmB,eAAE32B,YAMhE,MALch0F,KAAKkI,YAAYovB,EAC7B,iBACA81F,GAAWI,SAAShsH,KACpBysH,E,OAIC,GAAmC,UAA/BhgH,EAAKw8G,gBAAgB,GAAG,GAAgB,CACjD,MAAMwD,EAA6C,QAA1B,EAAAhgH,EAAKw8G,gBAAgB,GAAG,UAAE,eAAEz2B,YAMrD,MALch0F,KAAKkI,YAAYovB,EAC7B,iBACA81F,GAAWI,SAAShsH,KACpBysH,E,OAKD,GAAwB,MAApBvgH,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CAE7D,MADclhB,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWI,SAAShsH,K,CAK/E,MADcxB,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWI,SAAShsH,KAEhF,GAxGA,CAGA,OAAI2O,GACF,OAAOgsG,EACT,CAQA,eAAIgR,GACF,OAAO1Q,EACT,CA2Fc,YAAA2N,CAAa14G,G,0CACzB,MAAMs6F,EAA2B,CAC/BxtD,MAAO,WACP6oB,OAAQ,MACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,UAAYp4F,EAAQ3Q,SAIjC63B,EAAU,IAAIuuC,QADR,4CACqB6kC,GAC3Bt+F,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,OAAgB,CAC3B,MAAMjT,QAAaP,EAASO,OAC5B,GAA4B,MAAxBA,EAAK28G,gBACP,OAAO38G,EAAK28G,gBAAgB,2C,CAGhC,OAAO,IACT,G,EAG4B3hH,OAAOovG,OAAO,CAC1C8Q,QAAS,KACT3hH,OAAQ,GACRwa,OAAQ,GACRjhB,MAAO,K,2SC3JF,MAAMmtH,GAAyCjlH,OAAOovG,OAAO,CAClE8Q,QAAS,KACTpoH,MAAO,KAIF,MAAM,WAA8B+rH,GAQzC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAmBV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAM+3G,KAIlC,KAAAnQ,SAAkBrsG,GAAwB,mC,MACxC,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWK,aAAajsH,K,CAMnF,IAAIssH,EAAgB,kCACfp8G,EAAQy3G,SAA+B,KAApBz3G,EAAQy3G,UAC9B2E,EAAgB,wBAElB,MAAM95B,EAAch0F,KAAKkI,YAAYovB,EAAEw2F,EAA8B,QAAf,EAAAp8G,EAAQy3G,eAAO,QAAI,IAEnEvwF,EAAU,IAAIuuC,QARR,mDAQqB,CAC/B4iD,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,SAAWp4F,EAAQ3Q,MAClC,eAAgB,qBAElBqmE,KAAM38C,KAAKC,UAAU,CACnBqE,SAAS,EACT+7F,cAAep5G,EAAQy3G,QACvBn1B,kBAIEtmF,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,OAAgB,CAE3B,MADclhB,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWK,aAAajsH,K,CAE5E,GAAwB,MAApBkM,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CAE7D,aADmBxT,EAASO,QAChB88G,Y,CAGZ,MADc/qH,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWK,aAAajsH,KAGtF,GA1DA,CAGA,OAAI2O,GACF,OAAOisG,EACT,CAGA,eAAI+Q,GACF,OAAOzQ,EACT,EAmD4BzzG,OAAOovG,OAAO,CAC1C8Q,QAAS,KACTpoH,MAAO,K,2SCpFF,MAAMotH,GAA8DllH,OAAOovG,OAAO,CACvF8Q,QAAS,KACTpoH,MAAO,GACPyG,OAAQ,KAIH,MAAM,WAA8BslH,GAUzC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAcV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAMg4G,KASlC,KAAApQ,SAAkBrsG,GAA6C,mC,MAC7D,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWM,aAAalsH,K,CAGnF,IAAKkQ,EAAQlK,QAA6B,KAAnBkK,EAAQlK,OAAe,CAE5C,MADcxH,KAAKkI,YAAYovB,EAAE,oBAAqB81F,GAAWM,aAAalsH,K,CAIhF,MAAMyF,EAAM,2CAA2CyK,EAAQlK,iBAE/D,IAAIsmH,EAAgB,kCACfp8G,EAAQy3G,SAA+B,KAApBz3G,EAAQy3G,UAC9B2E,EAAgB,wBAElB,MAAM95B,EAAch0F,KAAKkI,YAAYovB,EAAEw2F,EAA8B,QAAf,EAAAp8G,EAAQy3G,eAAO,QAAI,IAEnEvwF,EAAU,IAAIuuC,QAAQlgE,EAAK,CAC/B8iH,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnB8iC,cAAe,SAAW,EAAMrkG,cAAciM,EAAQ3Q,MAAQ,KAC9D,eAAgB,qBAElBqmE,KAAM38C,KAAKC,UAAU,CACnBkhG,OAAQl6G,EAAQy3G,QAChBn1B,kBAIEtmF,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GAC7C3qB,QAAaP,EAASO,OAE5B,GAAwB,MAApBP,EAASwT,OAAgB,CAC3B,MAAMktG,EACJ,YAAangH,EAAO,kCAAoC,uBAE1D,MADcjO,KAAKkI,YAAYovB,EAAE82F,EAAYhB,GAAWM,aAAalsH,KAAMyM,EAAKnO,Q,CAE3E,GAAwB,MAApB4N,EAASwT,QAAsC,MAApBxT,EAASwT,OAAgB,CAC7D,MAAM,KAAE1f,EAAI,OAAEgG,SAAiBkG,EAASO,OAExC,MAAO,GAAGzM,MADSgG,aAAM,EAANA,EAAQhG,OAAQkQ,EAAQlK,Q,CAEtC,GAAIyG,aAAI,EAAJA,EAAMnO,QAAS,CAMxB,MALcE,KAAKkI,YAAYovB,EAC7B,iBACA81F,GAAWM,aAAalsH,KACxByM,EAAKnO,Q,CAGF,GAAImO,aAAI,EAAJA,EAAM1N,MAAO,CAEtB,MADcP,KAAKkI,YAAYovB,EAAE,iBAAkB81F,GAAWM,aAAalsH,KAAMyM,EAAK1N,M,CAItF,MADcP,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWM,aAAalsH,KAGtF,GA5EA,CAGA,OAAI2O,GACF,OAAOksG,EACT,CAQA,eAAI8Q,GACF,OAAOxQ,EACT,EAgE4B1zG,OAAOovG,OAAO,CAC1C8Q,QAAS,KACTpoH,MAAO,GACPyG,OAAQ,K,2SC5GH,MAAM6mH,GAAkDplH,OAAOovG,OAAO,CAC3E8Q,QAAS,KACT3hD,QAAS,6BACTzmE,MAAO,KAIF,MAAM,WAA6B+rH,GAQxC,WAAAttH,CACUysB,EACA/jB,EACRyL,EACAoxG,EACAtoG,GAEAhP,MAAMkG,EAAgBoxG,EAAYtoG,GAN1B,KAAAwP,WAAAA,EACA,KAAA/jB,YAAAA,EAmBV,KAAA21G,UAAa1nG,GACJ,IAAI,KAAgB,OAAD,UAAMk4G,KAIlC,KAAAtQ,SAAkBrsG,GAAkC,mC,MAClD,IAAKA,EAAQ3Q,OAA2B,KAAlB2Q,EAAQ3Q,MAAc,CAE1C,MADcf,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWO,YAAYnsH,K,CAGlF,IAAKkQ,EAAQ81D,SAA+B,KAApB91D,EAAQ81D,QAAgB,CAE9C,MADcxnE,KAAKkI,YAAYovB,EAAE,iBAAkB81F,GAAWO,YAAYnsH,K,CAI5E,IAAIyF,EAAMyK,EAAQ81D,QAAU,wBACxB8mD,EAAS,uBACT58G,EAAQy3G,SAA+B,KAApBz3G,EAAQy3G,UAC7BliH,GAAO,aAAeyK,EAAQy3G,QAC9BmF,EAAS,mCAEX,MAAM7C,EAAOzrH,KAAKkI,YAAYovB,EAAEg3F,EAAuB,QAAf,EAAA58G,EAAQy3G,eAAO,QAAI,IAErDvwF,EAAU,IAAIuuC,QAAQlgE,EAAK,CAC/B8iH,SAAU,SACVvrE,MAAO,WACP6oB,OAAQ,OACRzkD,QAAS,IAAIokD,QAAQ,CACnBwkD,eAAgB95G,EAAQ3Q,MACxB,eAAgB,qBAElBqmE,KAAM38C,KAAKC,UAAU,CAAE+gG,WAGnB/9G,QAAiB1N,KAAKisB,WAAWw+E,YAAY7xE,GACnD,GAAwB,MAApBlrB,EAASwT,OAAgB,CAE3B,MADclhB,KAAKkI,YAAYovB,EAAE,uBAAwB81F,GAAWO,YAAYnsH,K,CAIlF,MAAMyM,QAAaP,EAASO,OAC5B,GAAwB,MAApBP,EAASwT,QAAsC,MAApBxT,EAASwT,OACtC,OAAOjT,EAAKy9G,MACP,GAAIz9G,aAAI,EAAJA,EAAM1N,MAAO,CAEtB,MADcP,KAAKkI,YAAYovB,EAAE,iBAAkB81F,GAAWO,YAAYnsH,KAAMyM,EAAK1N,M,CAIrF,MADcP,KAAKkI,YAAYovB,EAAE,wBAAyB81F,GAAWO,YAAYnsH,KAGrF,GA/DA,CAGA,OAAI2O,GACF,OAAOmsG,EACT,CAGA,eAAI6Q,GACF,OAAOvQ,EACT,EAwD4B3zG,OAAOovG,OAAO,CAC1C8Q,QAAS,KACT3hD,QAAS,6BACTzmE,MAAO,K,2SCyCF,MAAMwtH,GACX,WAAA/uH,CACmB2c,EACAwqG,EACAjlC,EACAN,EACAG,EACAtB,EACAI,EACAE,EACAE,EACAE,EACAG,GAVA,KAAA3kE,eAAAA,EACA,KAAAwqG,WAAAA,EACA,KAAAjlC,SAAAA,EACA,KAAAN,YAAAA,EACA,KAAAG,WAAAA,EACA,KAAAtB,OAAAA,EACA,KAAAI,WAAAA,EACA,KAAAE,SAAAA,EACA,KAAAE,aAAAA,EACA,KAAAE,aAAAA,EACA,KAAAG,YAAAA,CAChB,CAEH,gBAAAgrC,CAAiBp6G,GACf,MAAqB,aAAjBA,EAAQpE,KACHtN,KAAKypH,iBAAiB/3G,GACH,eAAjBA,EAAQpE,KACVtN,KAAK4pH,mBAAmBl4G,GACL,cAAjBA,EAAQpE,KACVtN,KAAK+rH,kBAAkBr6G,GAEvB1R,KAAKspH,aAAa53G,EAE7B,CAEA,YAAA43G,CAAa53G,GACX,OAAO1R,KAAKohF,YAAY28B,SAASrsG,EACnC,CAEA,kBAAAk4G,CAAmBl4G,GACjB,OAAO1R,KAAKuhF,WAAWw8B,SAASrsG,EAClC,CAEA,gBAAA+3G,CAAiB/3G,GACf,OAAO1R,KAAK0hF,SAASq8B,SAASrsG,EAChC,CAEA,iBAAAq6G,CAAkBr6G,GAChB,IAAKA,EAAQwvE,iBACX,OAAO,KAGT,MAAMnF,EAAS/7E,KAAK0oH,gBAAgBh3G,GACpC,OAAQA,EAAQwvE,kBACd,KAAKksC,GAAWC,OAAOjnH,GACrB,OAAOpG,KAAKigF,OAAO89B,SAAShiC,EAAOiE,WAAWC,QAChD,KAAKmtC,GAAWG,WAAWnnH,GACzB,OAAOpG,KAAKqgF,WAAW09B,SAAShiC,EAAOiE,WAAWK,YACpD,KAAK+sC,GAAWI,SAASpnH,GACvB,OAAOpG,KAAKugF,SAASw9B,SAAShiC,EAAOiE,WAAWO,UAClD,KAAK6sC,GAAWK,aAAarnH,GAC3B,OAAOpG,KAAKygF,aAAas9B,SAAShiC,EAAOiE,WAAWS,cACtD,KAAK2sC,GAAWM,aAAatnH,GAC3B,OAAOpG,KAAK2gF,aAAao9B,SAAShiC,EAAOiE,WAAWW,cACtD,KAAKysC,GAAWO,YAAYvnH,GAC1B,OAAOpG,KAAK8gF,YAAYi9B,SAAShiC,EAAOiE,WAAWc,aAEzD,CAEA,WAAA6+B,GAqEE,OAnEiB3/G,KAAKmc,eAAe6Q,eAAe9gB,MAClD,EAAAyhF,GAAA,IAAW9uD,IACT,EAAAjF,GAAA,GAAc,CACZ55B,KAAK2mH,WAAWjF,SAAS7iF,EAAQz4B,IACjCpG,KAAK2mH,WAAW9I,UAAUh/E,EAAQz4B,IAClCpG,KAAK0hF,SAASggC,SAAS7iF,EAAQz4B,IAC/BpG,KAAK0hF,SAASm8B,UAAUh/E,EAAQz4B,IAChCpG,KAAKohF,YAAYsgC,SAAS7iF,EAAQz4B,IAClCpG,KAAKohF,YAAYy8B,UAAUh/E,EAAQz4B,IACnCpG,KAAKuhF,WAAWmgC,SAAS7iF,EAAQz4B,IACjCpG,KAAKuhF,WAAWs8B,UAAUh/E,EAAQz4B,IAClCpG,KAAKigF,OAAOyhC,SAAS7iF,EAAQz4B,IAC7BpG,KAAKigF,OAAO49B,UAAUh/E,EAAQz4B,IAC9BpG,KAAKqgF,WAAWqhC,SAAS7iF,EAAQz4B,IACjCpG,KAAKqgF,WAAWw9B,UAAUh/E,EAAQz4B,IAClCpG,KAAKugF,SAASmhC,SAAS7iF,EAAQz4B,IAC/BpG,KAAKugF,SAASs9B,UAAUh/E,EAAQz4B,IAChCpG,KAAKygF,aAAaihC,SAAS7iF,EAAQz4B,IACnCpG,KAAKygF,aAAao9B,UAAUh/E,EAAQz4B,IACpCpG,KAAK2gF,aAAa+gC,SAAS7iF,EAAQz4B,IACnCpG,KAAK2gF,aAAak9B,UAAUh/E,EAAQz4B,IACpCpG,KAAK8gF,YAAY4gC,SAAS7iF,EAAQz4B,IAClCpG,KAAK8gF,YAAY+8B,UAAUh/E,EAAQz4B,SAGvC,QACE,EACE0hH,EACAC,EACAyG,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,KAEAzvH,KAAK0vH,kBAAkB,CACrB1jH,UAAW87G,QAAAA,EAAoBC,EAC/B5mC,WAAY,CACVO,SAAU8sC,QAAAA,EAAmBC,EAC7BrtC,YAAastC,QAAAA,EAAsBC,EACnCptC,WAAYqtC,QAAAA,EAAqBC,GAEnC7uC,WAAY,CACVC,OAAQ6uC,QAAAA,EAAiBC,EACzB1uC,WAAY2uC,QAAAA,EAAqBC,EACjC1uC,SAAU2uC,QAAAA,EAAmBC,EAC7B1uC,aAAc2uC,QAAAA,EAAuBC,EACrC1uC,aAAc2uC,QAAAA,EAAuBC,EACrCzuC,YAAa0uC,QAAAA,EAAsBC,OAO/C,CAEA,UAAA7P,GACE,OAAO,OAAe5/G,KAAK2/G,cAC7B,CAEM,WAAAS,CAAY1uG,G,0CAChB,MAAMqqE,EAAS/7E,KAAK0oH,gBAAgBh3G,GAC9B4rB,QAAsB,OAAet9B,KAAKmc,eAAe6Q,gBAIzD27F,GAAqB,EAAAta,GAAA,GACzBruG,KAAK2mH,WAAWjF,SAASpkF,EAAcl3B,IACvCpG,KAAK2mH,WAAW9I,UAAUvgF,EAAcl3B,KACxC8F,MAAK,QAAI,EAAEwF,EAASk3G,KAAcl3G,QAAAA,EAAWk3G,KAC/C,IAAIC,QAA0B,OAAeF,GAC7CE,EAAoB5/G,OAAOH,OAAO+/G,EAAmB9sC,EAAO/vE,iBACtDhM,KAAK2mH,WAAWvG,YAAY9iF,EAAcl3B,GAAIyiH,SAG9Cj9G,QAAQ+d,IAAI,CAChB3pB,KAAK0hF,SAAS0+B,YAAY9iF,EAAcl3B,GAAI21E,EAAOoF,WAAWO,UAC9D1hF,KAAKohF,YAAYg/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOoF,WAAWC,aACjEphF,KAAKuhF,WAAW6+B,YAAY9iF,EAAcl3B,GAAI21E,EAAOoF,WAAWI,YAChEvhF,KAAKigF,OAAOmgC,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWC,QAC5DjgF,KAAKqgF,WAAW+/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWK,YAChErgF,KAAKugF,SAAS6/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWO,UAC9DvgF,KAAKygF,aAAa2/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWS,cAClEzgF,KAAK2gF,aAAay/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWW,cAClE3gF,KAAK8gF,YAAYs/B,YAAY9iF,EAAcl3B,GAAI21E,EAAOiE,WAAWc,cAErE,G,CAEQ,eAAA4nC,CAAgBh3G,GACtB,MAAMsuE,EAAa,CACjBC,OAAQ,CACNzY,QAAS91D,EAAQwuE,yBACjBn/E,MAAO2Q,EAAQyuE,0BACf34E,OAAQkK,EAAQ0uE,wBAChB+oC,QAASz3G,EAAQy3G,SAEnB9oC,WAAY,CACVt/E,MAAO2Q,EAAQ4uE,yBACf6oC,QAASz3G,EAAQy3G,SAEnB5oC,SAAU,CACRx/E,MAAO2Q,EAAQ8uE,0BACf2oC,QAASz3G,EAAQy3G,SAEnB1oC,aAAc,CACZ1/E,MAAO2Q,EAAQgvE,yBACfyoC,QAASz3G,EAAQy3G,SAEnBxoC,aAAc,CACZ5/E,MAAO2Q,EAAQkvE,8BACfp5E,OAAQkK,EAAQmvE,4BAChBsoC,QAASz3G,EAAQy3G,SAEnBroC,YAAa,CACX//E,MAAO2Q,EAAQqvE,2BACfvZ,QAAS91D,EAAQsvE,4BACjBmoC,QAASz3G,EAAQy3G,UA2BrB,MAAO,CAAEn9G,UAvBS,CAChB6X,SAAUnS,EAAQpE,KAClB2zE,UAAWvvE,EAAQwvE,kBAqBDC,WAlBD,CACjBC,YAAa,CACXC,eAAgB3vE,EAAQ2vE,eACxBC,kBAAmB5vE,EAAQ4vE,kBAC3B6nC,QAASz3G,EAAQy3G,SAEnB5nC,WAAY,CACVC,eAAgB9vE,EAAQ8vE,eACxBC,gBAAiB/vE,EAAQ+vE,gBACzB0nC,QAASz3G,EAAQy3G,SAEnBznC,SAAU,CACRC,aAAcjwE,EAAQiwE,aACtBC,eAAgBlwE,EAAQkwE,eACxBunC,QAASz3G,EAAQy3G,UAIWnpC,aAClC,CAEQ,iBAAA0vC,CAAkBh+G,GACxB,MAAO,CACLpE,KAAMoE,EAAQ1F,UAAU6X,SACxBw9D,eAAgB3vE,EAAQyvE,WAAWC,YAAYC,eAC/CC,kBAAmB5vE,EAAQyvE,WAAWC,YAAYE,kBAClDE,eAAgB9vE,EAAQyvE,WAAWI,WAAWC,eAC9CC,gBAAiB/vE,EAAQyvE,WAAWI,WAAWE,gBAC/CE,aAAcjwE,EAAQyvE,WAAWO,SAASC,aAC1CC,eAAgBlwE,EAAQyvE,WAAWO,SAASE,eAC5CV,iBAAkBxvE,EAAQ1F,UAAUi1E,UACpCd,0BAA2BzuE,EAAQsuE,WAAWC,OAAOl/E,MACrDq/E,wBAAyB1uE,EAAQsuE,WAAWC,OAAOz4E,OACnD04E,yBAA0BxuE,EAAQsuE,WAAWC,OAAOzY,QACpD8Y,yBAA0B5uE,EAAQsuE,WAAWK,WAAWt/E,MACxD2/E,yBAA0BhvE,EAAQsuE,WAAWS,aAAa1/E,MAC1Dy/E,0BAA2B9uE,EAAQsuE,WAAWO,SAASx/E,MACvD6/E,8BAA+BlvE,EAAQsuE,WAAWW,aAAa5/E,MAC/D8/E,4BAA6BnvE,EAAQsuE,WAAWW,aAAan5E,OAC7Du5E,2BAA4BrvE,EAAQsuE,WAAWc,YAAY//E,MAC3DigF,4BAA6BtvE,EAAQsuE,WAAWc,YAAYtZ,QAEhE,E,ICtYU,G,WCIL,MAAMmoD,GAOX,mBAAAC,CACE9rG,EACA+rG,EAAqB,KACrBC,EAAuB,MAEvB,GAAgB,MAAZhsG,GAAwC,IAApBA,EAASrhB,OAC/B,OAAO,KAET,MAAMstH,EAAmB,CACvB,YACA,MACA,YACID,QAAAA,EAAc,MACf9vH,KAAKgwH,kBAAkBH,IAGtBI,EAAkB1rH,MAAMlC,KAAK,IAAI6K,IAAI6iH,IAE3C,OADe,GAAOjsG,EAAUmsG,EAElC,CAQQ,iBAAAD,CAAkBn/G,GACxB,GAAa,MAATA,GAAkC,IAAjBA,EAAMpO,OACzB,MAAO,GAET,MAAMytH,EAAar/G,EAAMhK,QAAQ,KACjC,OAAIqpH,EAAa,EACR,GAEFr/G,EACJ5G,UAAU,EAAGimH,GACbvpH,OACAqB,cACAL,MAAM,eACX,GDnDF,SAAY6xE,GACV,mBACA,kBACD,CAHD,CAAY,QAAQ,KEEb,MAAM22C,GAMX,WAAA3wH,CAAYgT,GACE,MAARA,IAIJxS,KAAKoG,GAAKoM,EAAKpM,GACfpG,KAAKonD,SAAW50C,EAAK40C,SACrBpnD,KAAK6+C,KAAOrsC,EAAKqsC,KACjB7+C,KAAKqnD,SAAW70C,EAAK60C,SACvB,ECfK,MAAM+oE,GAIX,WAAA5wH,CAAYgT,GACE,MAARA,IAIJxS,KAAK09F,KAAOlrF,EAAKkrF,KACjB19F,KAAK29F,OAASnrF,EAAKmrF,OACrB,ECPK,MAAM0yB,GAkBX,WAAA7wH,CAAYkO,GACV,GAAgB,MAAZA,EAmBJ,OAfA1N,KAAKoG,GAAKsH,EAAStH,GACnBpG,KAAK69F,SAAWnwF,EAASmwF,SACzB79F,KAAKsN,KAAOI,EAASJ,KACrBtN,KAAKwB,KAAOkM,EAASlM,KACrBxB,KAAK8qD,MAAQp9C,EAASo9C,MACtB9qD,KAAKmQ,IAAMzC,EAASyC,IACpBnQ,KAAK89F,eAAiBpwF,EAASowF,eAC/B99F,KAAK+9F,YAAcrwF,EAASqwF,YAC5B/9F,KAAKukC,aAAe72B,EAAS62B,aAC7BvkC,KAAKgvC,eAAiBthC,EAASshC,eAC/BhvC,KAAKg+F,aAAetwF,EAASswF,aAC7Bh+F,KAAK8jB,SAAWpW,EAASoW,SACzB9jB,KAAKu3F,SAAW7pF,EAASuwF,QACzBj+F,KAAKk+F,UAAYxwF,EAASwwF,UAElBl+F,KAAKsN,MACX,KAAK,GAASkpG,KACZx2G,KAAK09F,KAAO,IAAI0yB,GAAa1iH,EAASgwF,MACtC,MACF,KAAK,GAAS4yB,KACZtwH,KAAKm+F,KAAO,IAAIgyB,GAAaziH,EAASywF,MAK5C,ECjDK,MAAMoyB,GAeX,WAAA/wH,CAAY04B,EAAYs4F,GAatB,OAZAxwH,KAAKsN,KAAO4qB,EAAK5qB,KACjBtN,KAAKwwH,WAAaA,EAClBxwH,KAAKwB,KAAO02B,EAAK12B,KAAO02B,EAAK12B,KAAKwR,gBAAkB,KACpDhT,KAAK8qD,MAAQ5yB,EAAK4yB,MAAQ5yB,EAAK4yB,MAAM93C,gBAAkB,KACvDhT,KAAK89F,eAAiB5lE,EAAK4lE,eAC3B99F,KAAKgvC,eAAwC,MAAvB9W,EAAK8W,eAAyB9W,EAAK8W,eAAeqT,cAAgB,KACxFriD,KAAKg+F,aAAoC,MAArB9lE,EAAK8lE,aAAuB9lE,EAAK8lE,aAAa37C,cAAgB,KAClFriD,KAAKmQ,IAAkB,MAAZ+nB,EAAK/nB,IAAc+nB,EAAK/nB,IAAI6C,gBAAkB,KACzDhT,KAAK8jB,SAAWoU,EAAKpU,SACrB9jB,KAAKu3F,SAAWr/D,EAAKq/D,SACrBv3F,KAAKk+F,UAAYhmE,EAAKgmE,UAEdl+F,KAAKsN,MACX,KAAK,GAASkpG,KACZx2G,KAAK09F,KAAO,IAAID,GAChBz9F,KAAK09F,KAAKA,KAAyB,MAAlBxlE,EAAKwlE,KAAKA,KAAexlE,EAAKwlE,KAAKA,KAAK1qF,gBAAkB,KAC3EhT,KAAK09F,KAAKC,OAASzlE,EAAKwlE,KAAKC,OAC7B,MACF,KAAK,GAAS2yB,KACZtwH,KAAKm+F,KAAO,IAAIX,GAChBx9F,KAAKm+F,KAAK/2C,SAAiC,MAAtBlvB,EAAKimE,KAAK/2C,SAAmBlvB,EAAKimE,KAAK/2C,SAASp0C,gBAAkB,KAK7F,ECzCK,MAAMy9G,WAA2B,GAStC,WAAAjxH,CAAYkO,GACVD,MAAMC,GACN1N,KAAKoG,GAAKpG,KAAK8gB,oBAAoB,MACnC9gB,KAAKsN,KAAOtN,KAAK8gB,oBAAoB,QACrC9gB,KAAKwB,KAAOxB,KAAK8gB,oBAAoB,QAErC,MAAM48E,EAAO19F,KAAK8gB,oBAAoB,QAC1B,MAAR48E,IACF19F,KAAK09F,KAAO,IAAID,GAAYC,IAG9B,MAAMS,EAAOn+F,KAAK8gB,oBAAoB,QAC1B,MAARq9E,IACFn+F,KAAKm+F,KAAO,IAAIX,GAAYW,IAG9Bn+F,KAAKgvC,eAAiBhvC,KAAK8gB,oBAAoB,kBAC/C9gB,KAAK0wH,kBAAoB1wH,KAAK8gB,oBAAoB,oBACpD,EC9BK,MAAM6vG,WAAqC,GAGhD,WAAAnxH,CAAYkO,GACVD,MAAMC,GAHR,KAAAtH,GAAa,KACb,KAAAa,IAAc,KAGZjH,KAAKoG,GAAKpG,KAAK8gB,oBAAoB,MACnC9gB,KAAKiH,IAAMjH,KAAK8gB,oBAAoB,MACtC,ECJK,MAAM8vG,WAAmC,GAI9C,WAAApxH,CAAYkO,GACVD,MAAMC,GAFR,KAAAzG,IAAc,KAGZjH,KAAKkqE,eAAiBlqE,KAAK8gB,oBAAoB,kBAC/C,MAAM+vG,EAAe7wH,KAAK8gB,oBAAoB,gBAC9C9gB,KAAK6wH,aAA+B,MAAhBA,EAAuB,KAAO,IAAIjzB,GAAaizB,GACnE7wH,KAAKiH,IAAMjH,KAAK8gB,oBAAoB,MACtC,E,2SCQK,MAAMgwG,GACX,WAAAtxH,CACUysB,EACA8kG,EACAC,GAFA,KAAA/kG,WAAAA,EACA,KAAA8kG,kBAAAA,EACA,KAAAC,YAAAA,CACP,CAEG,OAAAC,CAAQ7qH,G,0CACZ,MAAMJ,QAAUhG,KAAKisB,WAAWiM,KAAK,MAAO,UAAY9xB,EAAI,MAAM,GAAM,GACxE,OAAO,IAAIw3F,GAAa53F,EAC1B,G,CAEM,cAAAkrH,CACJ9qH,EACAwyB,EACAqqB,G,0CAEA,MAGMj9C,QAAUhG,KAAKisB,WAAWiM,KAC9B,OACA,iBAAmB9xB,EACnBwyB,GACA,GACA,EACAqqB,GATuBrgC,IACvBA,EAAQ7a,IAAI,UAAW3B,EAAG,IAW5B,OAAO,IAAIqqH,GAAmBzqH,EAChC,G,CAEM,uBAAAmrH,CACJj5F,EACAU,EACAqqB,G,0CAEA,MAGMj9C,QAAUhG,KAAKisB,WAAWiM,KAC9B,OACA,UAAYA,EAAK9xB,GAAK,gBAAkB8xB,EAAKimE,KAAK/3F,GAClDwyB,GACA,GACA,EACAqqB,GATuBrgC,IACvBA,EAAQ7a,IAAI,UAAWmwB,EAAK9xB,GAAG,IAWjC,OAAO,IAAIuqH,GAA6B3qH,EAC1C,G,CAEM,QAAAorH,G,0CACJ,MAAMprH,QAAUhG,KAAKisB,WAAWiM,KAAK,MAAO,SAAU,MAAM,GAAM,GAClE,OAAO,IAAIb,GAAarxB,EAAG43F,GAC7B,G,CAEM,QAAAyzB,CAASz4F,G,0CACb,MAAM5yB,QAAUhG,KAAKisB,WAAWiM,KAAK,OAAQ,SAAUU,GAAS,GAAM,GACtE,OAAO,IAAIglE,GAAa53F,EAC1B,G,CAEM,gBAAAsrH,CAAiB14F,G,0CACrB,MAAM5yB,QAAUhG,KAAKisB,WAAWiM,KAAK,OAAQ,iBAAkBU,GAAS,GAAM,GAC9E,OAAO,IAAIg4F,GAA2B5qH,EACxC,G,CAEM,sBAAAurH,CACJC,EACAC,G,0CAEA,MAAMzrH,QAAUhG,KAAKisB,WAAWiM,KAC9B,MACA,UAAYs5F,EAAS,SAAWC,EAChC,MACA,GACA,GAEF,OAAO,IAAIb,GAA2B5qH,EACxC,G,CAEA,YAAA0rH,CAAaF,EAAgBC,EAAgBj/G,GAC3C,OAAOxS,KAAKisB,WAAWiM,KAAK,OAAQ,UAAYs5F,EAAS,SAAWC,EAAQj/G,GAAM,GAAM,EAC1F,CAMM,kBAAAm/G,CAAmBn/G,G,0CACvB,MAAMxM,QAAUhG,KAAKisB,WAAWiM,KAAK,OAAQ,cAAe1lB,GAAM,GAAM,GACxE,OAAO,IAAIorF,GAAa53F,EAC1B,G,CAEM,OAAA4rH,CAAQxrH,EAAYwyB,G,0CACxB,MAAM5yB,QAAUhG,KAAKisB,WAAWiM,KAAK,MAAO,UAAY9xB,EAAIwyB,GAAS,GAAM,GAC3E,OAAO,IAAIglE,GAAa53F,EAC1B,G,CAEM,qBAAA6rH,CAAsBzrH,G,0CAC1B,MAAMJ,QAAUhG,KAAKisB,WAAWiM,KAC9B,MACA,UAAY9xB,EAAK,mBACjB,MACA,GACA,GAEF,OAAO,IAAIw3F,GAAa53F,EAC1B,G,CAEA,UAAA8rH,CAAW1rH,GACT,OAAOpG,KAAKisB,WAAWiM,KAAK,SAAU,UAAY9xB,EAAI,MAAM,GAAM,EACpE,CAEM,IAAA61B,CAAK81F,G,0CACT,MAAMrkH,QAAiB1N,KAAK2mE,OAAOorD,GAE7Bv/G,EAAO,IAAI69G,GAAS3iH,SACpB1N,KAAKgxH,YAAYn6F,OAAOrkB,EAChC,G,CAEM,OAAOpM,G,gDACLpG,KAAK8xH,WAAW1rH,SAChBpG,KAAKgxH,YAAYpyE,OAAOx4C,EAChC,G,CAEM,cAAA4rH,CAAe5rH,G,0CACnB,MAAMsH,QAAiB1N,KAAK6xH,sBAAsBzrH,GAC5CoM,EAAO,IAAI69G,GAAS3iH,SACpB1N,KAAKgxH,YAAYn6F,OAAOrkB,EAChC,G,CAIc,MAAAm0D,CAAOorD,G,gDACnB,MAAMn5F,EAAU,IAAI23F,GAAYwB,EAAS,GAAe,QAAX,EAAAA,EAAS,UAAE,eAAEvuH,OAAOG,YACjE,IAAI+J,EACJ,GAAsB,MAAlBqkH,EAAS,GAAG3rH,GAAY,CAC1B,GAAI2rH,EAAS,GAAGzkH,OAAS,GAASkpG,KAChC9oG,QAAiB1N,KAAKqxH,SAASz4F,QAE/B,IACE,MAAMq5F,QAA2BjyH,KAAKsxH,iBAAiB14F,GACvDlrB,EAAWukH,EAAmBpB,mBACxB7wH,KAAK+wH,kBAAkBpqD,OAC3BsrD,EACAF,EAAS,GAAG5zB,KAAK/2C,SACjB2qE,EAAS,GACT/xH,KAAKkyH,gBAAgBD,EAAoBvkH,G,CAE3C,MAAO7C,GACP,KAAIA,aAAa,IAAqD,MAAnCA,EAAoB6W,YAEhD,MAAI7W,aAAa,GAChB,IAAIrK,MAAOqK,EAAoB8W,oBAE/B9W,EAJN6C,QAAiB1N,KAAKmyH,2BAA2BJ,EAAUn5F,E,CAQjEm5F,EAAS,GAAG3rH,GAAKsH,EAAStH,GAC1B2rH,EAAS,GAAGl0B,SAAWnwF,EAASmwF,Q,MAEhCnwF,QAAiB1N,KAAK4xH,QAAQG,EAAS,GAAG3rH,GAAIwyB,GAEhD,OAAOlrB,C,IAGD,eAAAwkH,CACNloD,EACAt8D,GAEA,MAAO,CACL08D,WAAYpqE,KAAKoyH,2BAA2B1kH,GAC5C48D,mBAAoBtqE,KAAKqyH,mCAAmC3kH,EAAStH,GAAIsH,EAASywF,KAAK/3F,IACvFmkE,SAAUvqE,KAAKsyH,yBAAyB5kH,EAAStH,IAErD,CAEQ,0BAAAgsH,CAA2BvB,GACjC,OAAQr+G,GACCxS,KAAK0xH,aAAab,EAAazqH,GAAIyqH,EAAa1yB,KAAK/3F,GAAIoM,EAEpE,CAEQ,kCAAA6/G,CAAmCb,EAAgBC,GACzD,MAAO,IAAY,mCACjB,MAAMc,QAAsBvyH,KAAKuxH,uBAAuBC,EAAQC,GAChE,OAAOc,aAAa,EAAbA,EAAetrH,GACxB,GACF,CAEQ,wBAAAqrH,CAAyBd,GAC/B,MAAO,IACExxH,KAAK8xH,WAAWN,EAE3B,CAMM,0BAAAW,CACJJ,EACAn5F,G,0CAEA,MAAM2wC,EAAK,IAAIC,SACf,IACE,MAAMC,EAAO,IAAIC,KAAK,CAACqoD,EAAS,GAAGvuH,QAAS,CAAE8J,KAAM,6BACpDi8D,EAAGpB,OAAO,QAAS19C,KAAKC,UAAUkO,IAClC2wC,EAAGpB,OAAO,OAAQsB,EAAMsoD,EAAS,GAAG5zB,KAAK/2C,SAASp0C,gB,CAClD,MAAOnI,GACP,IAAI,EAAMxJ,QAAW,EAAMI,UAWzB,MAAMoJ,EAVN0+D,EAAGpB,OAAO,QAAS19C,KAAKC,UAAUkO,IAClC2wC,EAAGpB,OACD,OACA/lE,OAAOC,KAAK0vH,EAAS,GAAGvuH,QACxB,CACEmmE,SAAUooD,EAAS,GAAG5zB,KAAK/2C,SAASp0C,gBACpC42D,YAAa,4B,CAOrB,aAAa5pE,KAAK2xH,mBAAmBpoD,EACvC,G,ECrPK,MAAMipD,GAAsBz8G,GAAkBpL,OACnDoO,GACA,oBACA,CACEpE,aAAehM,GAAkBA,EACjCqN,QAAS,CAAC,YAKDy8G,GAAsB,IAAI18G,GACrCiD,GACA,oBACA,CACErE,aAAehM,GAAQA,EACvBqN,QAAS,CAAC,U,2SCVP,MAAM08G,GASX,WAAAlzH,CAAsBid,GAAA,KAAAA,cAAAA,EACpBzc,KAAK2yH,yBAA2B3yH,KAAKyc,cAAc0O,UAAUqnG,IAC7DxyH,KAAK4yH,gBAAkB5yH,KAAK2yH,yBAAyBt3G,OAErDrb,KAAK6yH,yBAA2B7yH,KAAKyc,cAAc0O,UAAUsnG,IAC7DzyH,KAAK8yH,gBAAkB9yH,KAAK6yH,yBAAyBx3G,MACvD,CAGM,iBAAA03G,G,0CACJ,aAAa,OAAe/yH,KAAK4yH,gBACnC,G,CAGM,iBAAAI,CAAkBljH,G,gDAChB9P,KAAK2yH,yBAAyBj4G,QAAO,IAAM5K,GACnD,G,CAGM,iBAAAmjH,G,0CACJ,aAAa,OAAejzH,KAAK8yH,gBACnC,G,CAGM,iBAAAI,CAAkBpjH,G,gDAChB9P,KAAK6yH,yBAAyBn4G,QAAO,IAAM5K,GACnD,G,ECzCK,MAAMqjH,GAMX,WAAA3zH,CAAYy5B,GALZ,KAAA7yB,GAAa,KACb,KAAAy4C,KAAe,KACf,KAAAwI,SAAmB,KACnB,KAAAD,SAAmB,KAGZnuB,IAILj5B,KAAKoG,GAAK6yB,EAAE7yB,GACZpG,KAAK6+C,KAAO5lB,EAAE4lB,KACd7+C,KAAKqnD,SAAWpuB,EAAEouB,SACpB,CAEA,YAAIwE,GACF,IACE,GAAiB,MAAb7rD,KAAK6+C,KACP,OAAO97C,SAAS/C,KAAK6+C,KAAM,K,CAE7B,S,CAGF,OAAO,CACT,CAEA,eAAO7wC,CAASC,GACd,OAAY,MAARA,EACK,KAGFhF,OAAOH,OAAO,IAAIqqH,GAAgBllH,EAC3C,ECjCK,MAAMmlH,GAIX,WAAA5zH,CAAY83B,GAHZ,KAAAomE,KAAe,KAIRpmE,IAILt3B,KAAK29F,OAASrmE,EAAEqmE,OAClB,CAEA,cAAI01B,GACF,OAAoB,MAAbrzH,KAAK09F,KAAe,WAAa,IAC1C,CAEA,eAAO1vF,CAASC,GACd,OAAY,MAARA,EACK,KAGFhF,OAAOH,OAAO,IAAIsqH,GAAgBnlH,EAC3C,EChBK,MAAMqlH,GAmBX,WAAA9zH,CAAYiK,GAlBZ,KAAArD,GAAa,KACb,KAAAy3F,SAAmB,KACnB,KAAAr8F,KAAe,KACf,KAAAspD,MAAgB,KAGhB,KAAAx9C,KAAiB,KACjB,KAAAowF,KAAO,IAAI01B,GACX,KAAAj1B,KAAO,IAAIg1B,GACX,KAAAr1B,eAA0B,KAC1B,KAAAC,YAAc,EACd,KAAAx5D,aAAqB,KACrB,KAAAy5D,aAAqB,KACrB,KAAAhvD,eAAuB,KACvB,KAAAlrB,SAAmB,KACnB,KAAAyzE,UAAW,EACX,KAAA2G,WAAY,EAGLz0F,IAILzJ,KAAKoG,GAAKqD,EAAErD,GACZpG,KAAK69F,SAAWp0F,EAAEo0F,SAClB79F,KAAKsN,KAAO7D,EAAE6D,KACdtN,KAAK89F,eAAiBr0F,EAAEq0F,eACxB99F,KAAK+9F,YAAct0F,EAAEs0F,YACrB/9F,KAAKukC,aAAe96B,EAAE86B,aACtBvkC,KAAKg+F,aAAev0F,EAAEu0F,aACtBh+F,KAAKgvC,eAAiBvlC,EAAEulC,eACxBhvC,KAAKu3F,SAAW9tF,EAAE8tF,SAClBv3F,KAAK8jB,SAAWra,EAAEqa,SAClB9jB,KAAKk+F,UAAYz0F,EAAEy0F,UACrB,CAEA,aAAIq1B,GACF,OAAO,EAAMxvH,mBAAmB/D,KAAKmQ,IACvC,CAEA,yBAAIqjH,GACF,OAA2B,MAAvBxzH,KAAK89F,gBAGF99F,KAAK+9F,aAAe/9F,KAAK89F,cAClC,CAEA,WAAI21B,GACF,OAA2B,MAAvBzzH,KAAKgvC,gBAGFhvC,KAAKgvC,gBAAkB,IAAIxiC,IACpC,CAEA,iBAAIknH,GACF,OAAO1zH,KAAKg+F,cAAgB,IAAIxxF,IAClC,CAEA,MAAAkE,GACE,OAAO,EAAM5F,MAAM,OAAD,UACX9K,MACL,CACEmQ,IAAK,EAAM5M,gBAAgBvD,KAAKmQ,MAGtC,CAEA,eAAOnC,CAASC,GACd,OAAY,MAARA,EACK,KAGFhF,OAAOH,OAAO,IAAIwqH,GAAYrlH,EAAM,CACzCkC,IAAK,EAAMlO,eAAegM,EAAKkC,KAC/BwjH,UAAW,EAAmB3lH,SAASC,EAAK0lH,WAC5Cj2B,KAAM01B,GAAaplH,SAASC,EAAKyvF,MACjCS,KAAMg1B,GAAanlH,SAASC,EAAKkwF,MACjC55D,aAAmC,MAArBt2B,EAAKs2B,aAAuB,KAAO,IAAI/3B,KAAKyB,EAAKs2B,cAC/Dy5D,aAAmC,MAArB/vF,EAAK+vF,aAAuB,KAAO,IAAIxxF,KAAKyB,EAAK+vF,cAC/DhvD,eAAuC,MAAvB/gC,EAAK+gC,eAAyB,KAAO,IAAIxiC,KAAKyB,EAAK+gC,iBAEvE,E,2SCpFK,MAAM4kF,WAAiBhrG,GAM5B,WAAAppB,CAAYmJ,GACV8E,QACW,MAAP9E,IAIJ3I,KAAK6+C,KAAOl2C,EAAIk2C,KAChB7+C,KAAK6oB,iBACH7oB,KACA2I,EACA,CACEvC,GAAI,KACJihD,SAAU,KACVD,SAAU,MAEZ,CAAC,KAAM,aAEX,CAEM,OAAA7zC,CAAQpD,G,0CASZ,aARmBnQ,KAAKmpB,WACtB,IAAIgqG,GAAanzH,MACjB,CACEonD,SAAU,MAEZ,KACAj3C,EAGJ,G,CAEA,eAAOnC,CAASrF,GACd,OAAW,MAAPA,EACK,KAGFM,OAAOH,OAAO,IAAI8qH,GAAYjrH,EAAK,CACxCy+C,SAAU90C,EAAUtE,SAASrF,EAAIy+C,WAErC,EC7CK,MAAMysE,WAAiBjrG,GAI5B,WAAAppB,CAAYmJ,GACV8E,QACW,MAAP9E,IAIJ3I,KAAK29F,OAASh1F,EAAIg1F,OAClB39F,KAAK6oB,iBACH7oB,KACA2I,EACA,CACE+0F,KAAM,MAER,IAEJ,CAEA,OAAAnqF,CAAQpD,GACN,OAAOnQ,KAAKmpB,WACV,IAAIiqG,GAAapzH,MACjB,CACE09F,KAAM,MAER,KACAvtF,EAEJ,CAEA,eAAOnC,CAASrF,GACd,OAAW,MAAPA,EACK,KAGFM,OAAOH,OAAO,IAAI+qH,GAAYlrH,EAAK,CACxC+0F,KAAMprF,EAAUtE,SAASrF,EAAI+0F,OAEjC,E,2SCpCK,MAAMo2B,WAAalrG,GAkBxB,WAAAppB,CAAYmJ,GAEV,GADA8E,QACW,MAAP9E,EA2BJ,OAvBA3I,KAAK6oB,iBACH7oB,KACA2I,EACA,CACEvC,GAAI,KACJy3F,SAAU,KACVr8F,KAAM,KACNspD,MAAO,KACP36C,IAAK,MAEP,CAAC,KAAM,aAGTnQ,KAAKsN,KAAO3E,EAAI2E,KAChBtN,KAAK89F,eAAiBn1F,EAAIm1F,eAC1B99F,KAAK+9F,YAAcp1F,EAAIo1F,YACvB/9F,KAAK8jB,SAAWnb,EAAImb,SACpB9jB,KAAKu3F,SAAW5uF,EAAI4uF,SACpBv3F,KAAKukC,aAAmC,MAApB57B,EAAI47B,aAAuB,IAAI/3B,KAAK7D,EAAI47B,cAAgB,KAC5EvkC,KAAKg+F,aAAmC,MAApBr1F,EAAIq1F,aAAuB,IAAIxxF,KAAK7D,EAAIq1F,cAAgB,KAC5Eh+F,KAAKgvC,eAAuC,MAAtBrmC,EAAIqmC,eAAyB,IAAIxiC,KAAK7D,EAAIqmC,gBAAkB,KAClFhvC,KAAKk+F,UAAYv1F,EAAIu1F,UAEbl+F,KAAKsN,MACX,KAAK,GAASkpG,KACZx2G,KAAK09F,KAAO,IAAIm2B,GAASlrH,EAAI+0F,MAC7B,MACF,KAAK,GAAS4yB,KACZtwH,KAAKm+F,KAAO,IAAIy1B,GAASjrH,EAAIw1F,MAKnC,CAEM,OAAA5qF,G,0CACJ,MAAMqgD,EAAQ,IAAI0/D,GAAStzH,MAErB8T,EAAgB,EAAMzJ,sBAAsB0J,mBAElD,IACE6/C,EAAMzjD,UAAY2D,EAAc0L,eAAexf,KAAKmQ,IAAK,MACzDyjD,EAAM+/D,gBAAkB7/G,EAAcigH,YAAYngE,EAAMzjD,I,CACxD,MAAOtF,G,CAcT,aAVM7K,KAAKmpB,WACTyqC,EACA,CACEpyD,KAAM,KACNspD,MAAO,MAET,KACA8I,EAAM+/D,WAGA3zH,KAAKsN,MACX,KAAK,GAASgjH,KACZ18D,EAAMuqC,WAAan+F,KAAKm+F,KAAK5qF,QAAQqgD,EAAM+/D,WAC3C,MACF,KAAK,GAASnd,KACZ5iD,EAAM8pC,WAAa19F,KAAK09F,KAAKnqF,QAAQqgD,EAAM+/D,WAM/C,OAAO//D,CACT,G,CAEA,eAAO5lD,CAASrF,GACd,GAAW,MAAPA,EACF,OAAO,KAGT,MAAM47B,EAAmC,MAApB57B,EAAI47B,aAAuB,KAAO,IAAI/3B,KAAK7D,EAAI47B,cAC9DyK,EAAuC,MAAtBrmC,EAAIqmC,eAAyB,KAAO,IAAIxiC,KAAK7D,EAAIqmC,gBAClEgvD,EAAmC,MAApBr1F,EAAIq1F,aAAuB,KAAO,IAAIxxF,KAAK7D,EAAIq1F,cAEpE,OAAO/0F,OAAOH,OAAO,IAAIgrH,GAAQnrH,EAAK,CACpCwH,IAAKmC,EAAUtE,SAASrF,EAAIwH,KAC5B3O,KAAM8Q,EAAUtE,SAASrF,EAAInH,MAC7BspD,MAAOx4C,EAAUtE,SAASrF,EAAImiD,OAC9B4yC,KAAMm2B,GAAS7lH,SAASrF,EAAI+0F,MAC5BS,KAAMy1B,GAAS5lH,SAASrF,EAAIw1F,MAC5B55D,eACAyK,iBACAgvD,gBAEJ,EC1HK,MAAMg2B,WAA0BzD,GAGrC,WAAA/wH,CAAY04B,GACVzqB,MAAMyqB,GACNl4B,KAAKoG,GAAK8xB,EAAK9xB,EACjB,E,2SCcK,MAAM6tH,GAaX,WAAAz0H,CACUsU,EACA5L,EACAoU,EACAG,EACA9I,GAJA,KAAAG,cAAAA,EACA,KAAA5L,YAAAA,EACA,KAAAoU,qBAAAA,EACA,KAAAG,cAAAA,EACA,KAAA9I,eAAAA,EAjBD,KAAAugH,YAAc,iBACd,KAAAC,eAAiB,OAE1B,KAAAC,OAASp0H,KAAKyc,cAAcm2G,gBAAgB1mH,MAC1C,QAAKvB,GAAW1B,OAAOmuB,OAAOzsB,GAAU,CAAC,GAAGlG,KAAK+N,GAAS,IAAIshH,GAAKthH,QAErE,KAAA6hH,WAAar0H,KAAKyc,cAAcm2G,gBAAgB1mH,MAC9C,EAAAyhF,GAAA,IAAWhjF,GACT3K,KAAKs0H,aAAarrH,OAAOmuB,OAAOzsB,GAAU,CAAC,GAAGlG,KAAK+N,GAAS,IAAIshH,GAAKthH,QAUtE,CAEG,OAAAsL,CACJ81C,EACAuqC,EACAr6E,EACA3T,G,0CAEA,IAAIokH,EAA2B,KAC/B,MAAMr8F,EAAO,IAAI47F,GAMjB,GALA57F,EAAK9xB,GAAKwtD,EAAMxtD,GAChB8xB,EAAK5qB,KAAOsmD,EAAMtmD,KAClB4qB,EAAKq/D,SAAW3jC,EAAM2jC,SACtBr/D,EAAKgmE,UAAYtqC,EAAMsqC,UACvBhmE,EAAK4lE,eAAiBlqC,EAAMkqC,eACX,MAAblqC,EAAMzjD,IAAa,CACrB,MAAMA,QAAYnQ,KAAKsc,qBAAqBquD,qBAC1C,IACA3qE,KAAKm0H,eACLn0H,KAAKk0H,aAEPtgE,EAAMzjD,IAAMA,EAAI06D,SAChBjX,EAAM+/D,UAAYxjH,EAAI46D,U,CAExB,GAAgB,MAAZjnD,EAAkB,CACpB,MAAM0wG,QAAoBx0H,KAAKsc,qBAAqBmC,sBAClDqF,EACA8vC,EAAMzjD,IACN,IAAI,ECvEuB,MDyE7B+nB,EAAKpU,SAAW0wG,EAAYjkH,M,CAQ9B,GANW,MAAPJ,IACFA,QAAYnQ,KAAK8T,cAAcyZ,cAEjC2K,EAAK/nB,UAAYnQ,KAAK2T,eAAemK,QAAQ81C,EAAMzjD,IAAKA,GACxD+nB,EAAK12B,WAAaxB,KAAK2T,eAAemK,QAAQ81C,EAAMpyD,KAAMoyD,EAAM+/D,WAChEz7F,EAAK4yB,YAAc9qD,KAAK2T,eAAemK,QAAQ81C,EAAM9I,MAAO8I,EAAM+/D,WAC9Dz7F,EAAK5qB,OAAS,GAASkpG,KACzBt+E,EAAKwlE,KAAO,IAAIm2B,GAChB37F,EAAKwlE,KAAKA,WAAa19F,KAAK2T,eAAemK,QAAQ81C,EAAM8pC,KAAKA,KAAM9pC,EAAM+/D,WAC1Ez7F,EAAKwlE,KAAKC,OAAS/pC,EAAM8pC,KAAKC,YACzB,GAAIzlE,EAAK5qB,OAAS,GAASgjH,OAChCp4F,EAAKimE,KAAO,IAAIy1B,GACJ,MAARz1B,GACF,GAAIA,aAAgBl5F,YAAa,CAC/B,MAAOzD,EAAMgR,SAAcxS,KAAKy0H,gBAC9B7gE,EAAMuqC,KAAK/2C,SACX+2C,EACAvqC,EAAM+/D,WAERz7F,EAAKimE,KAAK/2C,SAAW5lD,EACrB+yH,EAAW/hH,C,MAEX+hH,QAAiBv0H,KAAK00H,UAAUx8F,EAAMimE,EAAMvqC,EAAM+/D,WAKxD,MAAO,CAACz7F,EAAMq8F,EAChB,G,CAEA,IAAA99F,CAAKrwB,GACH,OAAOpG,KAAKo0H,OAAOloH,MACjB,SAAqB,CAACyoH,EAAUC,KAC9B,MAAMC,EAAUF,EAASz+F,MAAM2+F,GAAYA,EAAQzuH,KAAOA,IACpD0uH,EAAUF,EAAS1+F,MAAM4+F,GAAYA,EAAQ1uH,KAAOA,IAC1D,IAAKyuH,IAAYC,EAEf,OAAO,EAiDT,OA7C0B7rH,OAAOE,KAAK2rH,GAAS32D,OAAOhuD,IACpD,GACiC,MAA9B0kH,EAAQ1kH,IAA6D,OAA/B2kH,EAAQ3kH,IACf,OAA/B0kH,EAAQ1kH,IAA6D,MAA9B2kH,EAAQ3kH,GAGhD,OAAO,EAGT,OAAQA,GACN,IAAK,OACL,IAAK,QACL,IAAK,MACH,OAAqB,OAAjB0kH,EAAQ1kH,IAAkC,OAAjB2kH,EAAQ3kH,IAI9B0kH,EAAQ1kH,GAAK6C,kBAAoB8hH,EAAQ3kH,GAAK6C,gBACvD,IAAK,OACH,OAAyB,MAArB6hH,EAAQ1kH,GAAKutF,MAAqC,MAArBo3B,EAAQ3kH,GAAKutF,QAItB,MAArBm3B,EAAQ1kH,GAAKutF,MAAqC,MAArBo3B,EAAQ3kH,GAAKutF,MACrB,MAArBm3B,EAAQ1kH,GAAKutF,MAAqC,MAArBo3B,EAAQ3kH,GAAKutF,OAItCm3B,EAAQ1kH,GAAKutF,KAAK1qF,kBAAoB8hH,EAAQ3kH,GAAKutF,KAAK1qF,gBACjE,IAAK,OAEH,OAAO,EACT,IAAK,eACL,IAAK,iBACL,IAAK,eACH,OAAqB,OAAjB6hH,EAAQ1kH,IAAkC,OAAjB2kH,EAAQ3kH,IAG9B0kH,EAAQ1kH,GAAK5D,YAAcuoH,EAAQ3kH,GAAK5D,UACjD,QAEE,OAAOsoH,EAAQ1kH,KAAuB2kH,EAAQ3kH,G,GAI5B,KAE1B,QAAKwpE,GAAUA,EAAMzjD,MAAMC,GAAMA,EAAE/vB,KAAOA,MAE9C,CAEM,YAAA8wB,CAAa9wB,G,0CACjB,MAAMuzE,QAAc35E,KAAKyc,cAAcs2G,oBAEvC,OAAa,MAATp5C,GAAkBA,EAAM/3D,eAAexb,GAIpC,IAAI0tH,GAAKn6C,EAAMvzE,IAHb,IAIX,G,CAEM,MAAAuwB,G,0CACJ,MAAMgjD,QAAc35E,KAAKyc,cAAcs2G,oBACjCrlH,EAAmB,GACzB,IAAK,MAAMtH,KAAMuzE,EAEXA,EAAM/3D,eAAexb,IACvBsH,EAASkN,KAAK,IAAIk5G,GAAKn6C,EAAMvzE,KAGjC,OAAOsH,CACT,G,CAEM,wBAAAqnH,G,0CACJ,IAAIC,QAAiBh1H,KAAKyc,cAAcw2G,oBACxC,GAAgB,MAAZ+B,EACF,OAAOA,EAGTA,EAAW,GAEX,WADqBh1H,KAAK8T,cAAcwsG,cAEtC,MAAM,IAAI9/G,MAAM,sBAGlB,MAAM6oB,EAA2B,GAUjC,aAToBrpB,KAAK22B,UACnB/uB,SAASswB,IACb7O,EAASzO,KAAKsd,EAAK3kB,UAAUiW,MAAMyP,GAAM+7F,EAASp6G,KAAKqe,KAAI,UAGvDrtB,QAAQ+d,IAAIN,GAClB2rG,EAAS53F,KAAK,EAAMn1B,gBAAgBjI,KAAKkI,YAAa,eAEhDlI,KAAKyc,cAAcy2G,kBAAkB8B,GACpCA,CACT,G,CAEM,MAAAn+F,CAAOqB,G,0CACX,IAAIyhD,QAAc35E,KAAKyc,cAAcs2G,oBAIrC,GAHa,MAATp5C,IACFA,EAAQ,CAAC,GAEPzhD,aAAgBm4F,GAAU,CAC5B,MAAM5mH,EAAIyuB,EACVyhD,EAAMlwE,EAAErD,IAAMqD,C,MAEbyuB,EAAoBtwB,SAAS6B,IAC5BkwE,EAAMlwE,EAAErD,IAAMqD,CAAC,UAIbzJ,KAAKkE,QAAQy1E,EACrB,G,CAEM,KAAA3kB,CAAM7+C,G,gDACJnW,KAAKyc,cAAcy2G,kBAAkB,YACrClzH,KAAKyc,cAAcu2G,kBAAkB,KAC7C,G,CAEM,OAAO5sH,G,0CACX,MAAMuzE,QAAc35E,KAAKyc,cAAcs2G,oBACvC,GAAa,MAATp5C,EAAJ,CAIA,GAAkB,iBAAPvzE,EAAiB,CAC1B,GAAiB,MAAbuzE,EAAMvzE,GACR,cAEKuzE,EAAMvzE,E,MAEZA,EAAgBwB,SAASlF,WACjBi3E,EAAMj3E,EAAE,UAIb1C,KAAKkE,QAAQy1E,E,CACrB,G,CAEM,OAAAz1E,CAAQy1E,G,gDACN35E,KAAKyc,cAAcu2G,kBAAkBr5C,EAC7C,G,CAEM,cAAAs7C,CAAe9yF,G,0CACnB,GAAkB,MAAdA,EACF,MAAM,IAAI3hC,MAAM,0CAGlB,MAAM00H,QAAwBl1H,KAAK8T,cAAcyZ,aAQjD,aANkB,OAChBvtB,KAAKo0H,OAAOloH,MACV,EAAAyhF,GAAA,IAAiBhU,GAAU,GAAA35E,UAAA,6BAAAA,KAAKm1H,uBAAuBx7C,EAAOu7C,EAAiB/yF,EAAW,OAKhG,G,CAEc,sBAAAgzF,CACZx7C,EACAu7C,EACAE,G,0CASA,aAPuBxpH,QAAQ+d,IAC7BgwD,EAAMl1E,KAAWyzB,GAAS,mCACxB,MAAMm9F,QAAgBr1H,KAAK2T,eAAe6L,eAAe0Y,EAAK/nB,IAAK+kH,GAEnE,OADAh9F,EAAK/nB,UAAYnQ,KAAK2T,eAAemK,QAAQu3G,EAASD,GAC/C,IAAIpB,GAAkB97F,EAC/B,MAGJ,G,CAEQ,SAAAw8F,CAAUx8F,EAAYimE,EAAYhuF,GACxC,OAAO,IAAIvE,SAAQ,CAACC,EAASi0F,KAC3B,MAAMw1B,EAAS,IAAIC,WACnBD,EAAOE,kBAAkBr3B,GACzBm3B,EAAOG,OAAgBC,GAAQ,mCAC7B,IACE,MAAOl0H,EAAMgR,SAAcxS,KAAKy0H,gBAC9Bt2B,EAAK38F,KACLk0H,EAAI3sH,OAAO47B,OACXx0B,GAEF+nB,EAAKimE,KAAK/2C,SAAW5lD,EACrBqK,EAAQ2G,E,CACR,MAAO3H,GACPi1F,EAAOj1F,E,CAEX,IACAyqH,EAAOK,QAAU,KACf71B,EAAO,sBAAsB,CAC9B,GAEL,CAEc,eAAA20B,CACZrtE,EACA50C,EACArC,G,0CAEW,MAAPA,IACFA,QAAYnQ,KAAK8T,cAAcyZ,cAIjC,MAAO,OAFmBvtB,KAAK2T,eAAemK,QAAQspC,EAAUj3C,SACtCnQ,KAAK2T,eAAe2xC,eAAe,IAAInjD,WAAWqQ,GAAOrC,GAErF,G,CAEc,YAAAmkH,CAAa36C,G,0CACzB,MAAMi8C,EAAsBj8C,EAAMl1E,KAAKgF,GAAMA,EAAE8J,YACzCsiH,QAAuBjqH,QAAQ+d,IAAIisG,GAGzC,OADAC,EAAez4F,KAAK,EAAMn1B,gBAAgBjI,KAAKkI,YAAa,SACrD2tH,CACT,G,kBEzUK,MAAMC,GAIX,WAAAt2H,CAA6Bu2H,GAAA,KAAAA,WAAAA,EAHZ,KAAAC,mBAA2C,IAAIp2H,IAC/C,KAAAq2H,SAA6B,IAAIr2H,GAEkC,CAEpF,QAAAs2H,CAASjvH,GACP,OAAOjH,KAAKg2H,mBAAmBllE,IAAI7pD,EACrC,CAEA,UAAAkvH,CAAWlvH,EAAa0zE,GACtBA,EAAQv9C,KAAKp9B,KAAK+1H,YAClB/1H,KAAKg2H,mBAAmBjuH,IAAId,EAAK,IAAImvH,GAAQz7C,IAC7C36E,KAAKq2H,WAAWpvH,EAClB,CAEA,WAAAqvH,CAAYrvH,GAEV,OADAjH,KAAKq2H,WAAWpvH,GACTjH,KAAKk2H,SAASjvH,GAAOjH,KAAKg2H,mBAAmB/7G,IAAIhT,GAAKqvH,cAAgB,IAC/E,CAEA,eAAAC,CAAgBtvH,GACd,OAAOjH,KAAKk2H,SAASjvH,GAAOjH,KAAKg2H,mBAAmB/7G,IAAIhT,GAAKsvH,kBAAoB,IACnF,CAEA,OAAAC,CAAQvvH,GAEN,OADAjH,KAAKq2H,WAAWpvH,GACTjH,KAAKk2H,SAASjvH,GAAOjH,KAAKg2H,mBAAmB/7G,IAAIhT,GAAKuvH,UAAY,IAC3E,CAEA,mBAAAC,CAAoBxvH,GACdjH,KAAKk2H,SAASjvH,IAChBjH,KAAKg2H,mBAAmB/7G,IAAIhT,GAAKwvH,qBAErC,CAEA,KAAAzhE,GACEh1D,KAAKg2H,mBAAmBhhE,QACxBh1D,KAAKi2H,SAASjhE,OAChB,CAEQ,UAAAqhE,CAAWpvH,GACjBiuD,aAAal1D,KAAKi2H,SAASh8G,IAAIhT,IAC/BjH,KAAKi2H,SAASluH,IACZd,EACA6E,YAAW,KACT9L,KAAKg2H,mBAAmBp3E,OAAO33C,GAC/BjH,KAAKi2H,SAASr3E,OAAO33C,EAAI,GAjDhB,KAoDf,EAGF,MAAMmvH,GAGJ,WAAA52H,CAA6Bm7E,GAAA,KAAAA,QAAAA,EAF7B,KAAA+7C,eAAiB,CAEoC,CAErD,WAAAJ,GAEE,OADAt2H,KAAK02H,cAAgBzwH,KAAKyG,IAAI1M,KAAK02H,cAAe,GAC3C12H,KAAK26E,QAAQ36E,KAAK02H,cAC3B,CAEA,eAAAH,GACE,MAAMI,EAAc32H,KAAK26E,QAAQj7E,QAAQs/D,IAAU,MAAC,OAAgB,QAAhB,EAAAA,EAAOnN,iBAAS,eAAE+kE,YAAY,IAIlF,OAHsBD,EAAYv5F,MAChC,CAACz4B,EAAGg1D,IAAMA,EAAE9H,UAAU+kE,aAAatnF,UAAY3qC,EAAEktD,UAAU+kE,aAAatnF,YAErD,EACvB,CAEA,YAAAunF,GACE,OAAQ72H,KAAK02H,cAAgB,GAAK12H,KAAK26E,QAAQl4E,MACjD,CAEA,OAAA+zH,GACE,OAAOx2H,KAAK26E,QAAQ36E,KAAK62H,eAC3B,CAEA,mBAAAJ,GACEz2H,KAAK02H,cAAgB12H,KAAK62H,cAC5B,ECrFK,MAAMC,GAIX,WAAAt3H,CAAYwiE,EAAe/rC,GACzBj2B,KAAKgiE,IAAa,MAAPA,EAAc,GAAKA,EAC9BhiE,KAAKi2B,eAAiBA,CACxB,ECPK,MAAM8gG,GAIX,WAAAv3H,CAAYwiE,EAAevX,GACzBzqD,KAAKgiE,IAAa,MAAPA,EAAc,GAAKA,EAC9BhiE,KAAKyqD,SAAWA,CAClB,ECPK,MAAMusE,GAIX,WAAAx3H,CAAYwiE,EAAe/rC,GACzBj2B,KAAKgiE,IAAa,MAAPA,EAAc,GAAKA,EAC9BhiE,KAAKi2B,eAAiBA,CACxB,ECPK,MAAMghG,ICcN,MAAMC,GAoBX,WAAA13H,CAAYw/D,G,UAWV,OAVAh/D,KAAKsN,KAAO0xD,EAAO1xD,KACnBtN,KAAKyqD,SAAWuU,EAAOvU,SACvBzqD,KAAKi2B,eAAiB+oC,EAAO/oC,eAC7Bj2B,KAAKwB,KAAOw9D,EAAOx9D,KAAOw9D,EAAOx9D,KAAKwR,gBAAkB,KACxDhT,KAAK8qD,MAAQkU,EAAOlU,MAAQkU,EAAOlU,MAAM93C,gBAAkB,KAC3DhT,KAAK6qD,SAAWmU,EAAOnU,SACvB7qD,KAAKm3H,sBAAwBn4D,EAAOz6B,aACpCvkC,KAAKgrD,SAAWgU,EAAOhU,SACvBhrD,KAAKmQ,IAAgB,QAAV,EAAA6uD,EAAO7uD,WAAG,eAAE6C,gBAEfhT,KAAKsN,MACX,KAAKs5C,GAAWqE,MACdjrD,KAAKkrD,MAAQ,IAAI0jC,GACjB5uF,KAAKkrD,MAAMjB,KAOP,QANF,EAAiB,QAAjB,EAAA+U,EAAO9T,MAAMjB,YAAI,eAAExlD,KAAKylD,IACtB,MAAMP,EAAM,IAAIglC,GAIhB,OAHAhlC,EAAIA,IAAe,MAATO,EAAEP,IAAcO,EAAEP,IAAI32C,gBAAkB,KAClD22C,EAAIl+C,MAAmB,MAAXy+C,EAAEz+C,MAAgBy+C,EAAEz+C,MAAQ,KACxCk+C,EAAIC,YAA+B,MAAjBM,EAAEN,YAAsBM,EAAEN,YAAY52C,gBAAkB,KACnE22C,CAAG,WACV,QAAI,GACR3pD,KAAKkrD,MAAMrnC,SAAWm7C,EAAO9T,MAAMrnC,SAAWm7C,EAAO9T,MAAMrnC,SAAS7Q,gBAAkB,KACtFhT,KAAKkrD,MAAMpnC,SAAWk7C,EAAO9T,MAAMpnC,SAAWk7C,EAAO9T,MAAMpnC,SAAS9Q,gBAAkB,KACtFhT,KAAKkrD,MAAMpB,qBAC4B,MAArCkV,EAAO9T,MAAMpB,qBACTkV,EAAO9T,MAAMpB,qBAAqBzH,cAClC,KACNriD,KAAKkrD,MAAMnB,KAAOiV,EAAO9T,MAAMnB,KAAOiV,EAAO9T,MAAMnB,KAAK/2C,gBAAkB,KAC1EhT,KAAKkrD,MAAMlB,mBAAqBgV,EAAO9T,MAAMlB,mBAER,MAAjCgV,EAAO9T,MAAMf,mBACfnqD,KAAKkrD,MAAMf,iBAAmB6U,EAAO9T,MAAMf,iBAAiB1lD,KAAK0L,IAC/D,MAAMinH,EAAS,IAAI1oC,GAoBnB,OAnBA0oC,EAAOruE,aACe,MAApB54C,EAAI44C,aAAuB54C,EAAI44C,aAAa/1C,gBAAkB,KAChEokH,EAAOpuE,QACU,MAAf74C,EAAI64C,QAAmB74C,EAAI64C,QAAQh2C,gBAAmC,KACxEokH,EAAOnuE,aACe,MAApB94C,EAAI84C,aAAwB94C,EAAI84C,aAAaj2C,gBAA8B,KAC7EokH,EAAOluE,SACW,MAAhB/4C,EAAI+4C,SAAoB/4C,EAAI+4C,SAASl2C,gBAA8B,KACrEokH,EAAOjuE,SAA2B,MAAhBh5C,EAAIg5C,SAAmBh5C,EAAIg5C,SAASn2C,gBAAkB,KACxEokH,EAAOhuE,KAAmB,MAAZj5C,EAAIi5C,KAAej5C,EAAIi5C,KAAKp2C,gBAAkB,KAC5DokH,EAAO7tE,OAAuB,MAAdp5C,EAAIo5C,OAAiBp5C,EAAIo5C,OAAOv2C,gBAAkB,KAClEokH,EAAO9tE,QAAyB,MAAfn5C,EAAIm5C,QAAkBn5C,EAAIm5C,QAAQt2C,gBAAkB,KACrEokH,EAAOrpH,WAA+B,MAAlBoC,EAAIpC,WAAqBoC,EAAIpC,WAAWiF,gBAAkB,KAC9EokH,EAAO/tE,SAA2B,MAAhBl5C,EAAIk5C,SAAmBl5C,EAAIk5C,SAASr2C,gBAAkB,KACxEokH,EAAO5tE,gBACkB,MAAvBr5C,EAAIq5C,gBAA0Br5C,EAAIq5C,gBAAgBx2C,gBAAkB,KACtEokH,EAAO3tE,aACe,MAApBt5C,EAAIs5C,aAAuBt5C,EAAIs5C,aAAaz2C,gBAAkB,KAChEokH,EAAO9yF,aAAmC,MAApBn0B,EAAIm0B,aAAuBn0B,EAAIm0B,aAAa+d,cAAgB,KAC3E+0E,CAAM,KAGjB,MACF,KAAKxwE,GAAWuE,WACdnrD,KAAKorD,WAAa,IAAIyjC,GACtB7uF,KAAKorD,WAAW99C,KAAO0xD,EAAO5T,WAAW99C,KACzC,MACF,KAAKs5C,GAAWyE,KACdrrD,KAAKsrD,KAAO,IAAIijC,GAChBvuF,KAAKsrD,KAAK/D,eACsB,MAA9ByX,EAAO1T,KAAK/D,eAAyByX,EAAO1T,KAAK/D,eAAev0C,gBAAkB,KACpFhT,KAAKsrD,KAAK9D,MAA6B,MAArBwX,EAAO1T,KAAK9D,MAAgBwX,EAAO1T,KAAK9D,MAAMx0C,gBAAkB,KAClFhT,KAAKsrD,KAAK7D,OAA+B,MAAtBuX,EAAO1T,KAAK7D,OAAiBuX,EAAO1T,KAAK7D,OAAOz0C,gBAAkB,KACrFhT,KAAKsrD,KAAK5D,SACgB,MAAxBsX,EAAO1T,KAAK5D,SAAmBsX,EAAO1T,KAAK5D,SAAS10C,gBAAkB,KACxEhT,KAAKsrD,KAAK3D,QACe,MAAvBqX,EAAO1T,KAAK3D,QAAkBqX,EAAO1T,KAAK3D,QAAQ30C,gBAAkB,KACtEhT,KAAKsrD,KAAKthC,KAA2B,MAApBg1C,EAAO1T,KAAKthC,KAAeg1C,EAAO1T,KAAKthC,KAAKhX,gBAAkB,KAC/E,MACF,KAAK4zC,GAAW2E,SACdvrD,KAAKmgD,SAAW,IAAIsuC,GACpBzuF,KAAKmgD,SAAS4H,MACa,MAAzBiX,EAAO7e,SAAS4H,MAAgBiX,EAAO7e,SAAS4H,MAAM/0C,gBAAkB,KAC1EhT,KAAKmgD,SAAS6H,UACiB,MAA7BgX,EAAO7e,SAAS6H,UAAoBgX,EAAO7e,SAAS6H,UAAUh1C,gBAAkB,KAClFhT,KAAKmgD,SAAS8H,WACkB,MAA9B+W,EAAO7e,SAAS8H,WAAqB+W,EAAO7e,SAAS8H,WAAWj1C,gBAAkB,KACpFhT,KAAKmgD,SAAS+H,SACgB,MAA5B8W,EAAO7e,SAAS+H,SAAmB8W,EAAO7e,SAAS+H,SAASl1C,gBAAkB,KAChFhT,KAAKmgD,SAASgI,SACgB,MAA5B6W,EAAO7e,SAASgI,SAAmB6W,EAAO7e,SAASgI,SAASn1C,gBAAkB,KAChFhT,KAAKmgD,SAASiI,SACgB,MAA5B4W,EAAO7e,SAASiI,SAAmB4W,EAAO7e,SAASiI,SAASp1C,gBAAkB,KAChFhT,KAAKmgD,SAASkI,SACgB,MAA5B2W,EAAO7e,SAASkI,SAAmB2W,EAAO7e,SAASkI,SAASr1C,gBAAkB,KAChFhT,KAAKmgD,SAASmI,KACY,MAAxB0W,EAAO7e,SAASmI,KAAe0W,EAAO7e,SAASmI,KAAKt1C,gBAAkB,KACxEhT,KAAKmgD,SAAS3lC,MACa,MAAzBwkD,EAAO7e,SAAS3lC,MAAgBwkD,EAAO7e,SAAS3lC,MAAMxH,gBAAkB,KAC1EhT,KAAKmgD,SAASoI,WACkB,MAA9ByW,EAAO7e,SAASoI,WAAqByW,EAAO7e,SAASoI,WAAWv1C,gBAAkB,KACpFhT,KAAKmgD,SAASqI,QACe,MAA3BwW,EAAO7e,SAASqI,QAAkBwW,EAAO7e,SAASqI,QAAQx1C,gBAAkB,KAC9EhT,KAAKmgD,SAASsI,QACe,MAA3BuW,EAAO7e,SAASsI,QAAkBuW,EAAO7e,SAASsI,QAAQz1C,gBAAkB,KAC9EhT,KAAKmgD,SAAStvC,MACa,MAAzBmuD,EAAO7e,SAAStvC,MAAgBmuD,EAAO7e,SAAStvC,MAAMmC,gBAAkB,KAC1EhT,KAAKmgD,SAASuI,MACa,MAAzBsW,EAAO7e,SAASuI,MAAgBsW,EAAO7e,SAASuI,MAAM11C,gBAAkB,KAC1EhT,KAAKmgD,SAASwI,IACW,MAAvBqW,EAAO7e,SAASwI,IAAcqW,EAAO7e,SAASwI,IAAI31C,gBAAkB,KACtEhT,KAAKmgD,SAASt8B,SACgB,MAA5Bm7C,EAAO7e,SAASt8B,SAAmBm7C,EAAO7e,SAASt8B,SAAS7Q,gBAAkB,KAChFhT,KAAKmgD,SAASyI,eACsB,MAAlCoW,EAAO7e,SAASyI,eACZoW,EAAO7e,SAASyI,eAAe51C,gBAC/B,KACNhT,KAAKmgD,SAAS0I,cACqB,MAAjCmW,EAAO7e,SAAS0I,cACZmW,EAAO7e,SAAS0I,cAAc71C,gBAC9B,KAMW,MAAjBgsD,EAAOxT,SACTxrD,KAAKwrD,OAASwT,EAAOxT,OAAO/mD,KAAKw0B,IAC/B,MAAM+6B,EAAQ,IAAIw6B,GAKlB,OAJAx6B,EAAM1mD,KAAO2rB,EAAE3rB,KACf0mD,EAAMxyD,KAAOy3B,EAAEz3B,KAAOy3B,EAAEz3B,KAAKwR,gBAAkB,KAC/CghD,EAAMlkD,MAAQmpB,EAAEnpB,MAAQmpB,EAAEnpB,MAAMkD,gBAAkB,KAClDghD,EAAMnM,SAAW5uB,EAAE4uB,SACZmM,CAAK,KAIc,MAA1BgL,EAAOtT,kBACT1rD,KAAK0rD,gBAAkB,GACvBsT,EAAOtT,gBAAgB9jD,SAAS+jD,IAC9B3rD,KAAK0rD,gBAAgB9wC,KAAK,CACxByvC,aAAcsB,EAAGtB,aACjBvmC,SAAU6nC,EAAG7nC,SAAW6nC,EAAG7nC,SAAS9Q,gBAAkB,MACtD,KAIoB,MAAtBgsD,EAAOvT,cACTzrD,KAAKyrD,YAAc,CAAC,EACpBzrD,KAAKq3H,aAAe,CAAC,EACrBr4D,EAAOvT,YAAY7jD,SAASksD,IAC1B,MAAM1M,EAAW0M,EAAW1M,SAAW0M,EAAW1M,SAASp0C,gBAAkB,KAC7EhT,KAAKyrD,YAAYqI,EAAW1tD,IAAMghD,EAClC,MAAMkwE,EAAoB,IAAIL,GAC9BK,EAAkBlwE,SAAWA,EACP,MAAlB0M,EAAW3jD,MACbmnH,EAAkBnnH,IAAM2jD,EAAW3jD,IAAI6C,iBAEzChT,KAAKq3H,aAAavjE,EAAW1tD,IAAMkxH,CAAiB,IAG1D,ECzLK,MAAMC,WAA4BL,GAGvC,WAAA13H,CAAYw/D,GACVvxD,MAAMuxD,GACNh/D,KAAKoG,GAAK44D,EAAO54D,EACnB,ECNK,MAAMoxH,GAIX,WAAAh4H,CAAYm7E,EAAmBnwB,GACd,MAAXmwB,IACF36E,KAAK26E,QAAU,GACfA,EAAQ/yE,SAAS7B,IACf/F,KAAK26E,QAAQ//D,KAAK,IAAI28G,GAAoBxxH,GAAG,KAGjD/F,KAAKwqD,cAAgBA,CACvB,ECdK,MAAMitE,GAKX,WAAAj4H,CACEy2B,EACAqrC,EACA9W,EACAktE,GAA6B,GAE7B13H,KAAKi2B,eAAiBA,EACtBj2B,KAAKshE,UAAYA,EACjBthE,KAAKwqD,cAAgBA,EACrBxqD,KAAK03H,kBAAoBA,CAC3B,ECjBK,MAAMC,GAGX,WAAAn4H,CAAYgrD,GACVxqD,KAAKwqD,cAAiC,MAAjBA,EAAwB,GAAKA,CACpD,ECDK,MAAMotE,GAIX,WAAAp4H,CAAYw/D,GACVh/D,KAAKg/D,OAAS,IAAIk4D,GAAcl4D,GAChCh/D,KAAKwqD,cAAgBwU,EAAOxU,aAC9B,ECTK,MAAMqtE,GAIX,WAAAr4H,CAAYw/D,GACVh/D,KAAKyqD,SAAWuU,EAAOvU,SACvBzqD,KAAK6qD,SAAWmU,EAAOnU,QACzB,ECLK,MAAMitE,GAIX,WAAAt4H,CAAYw/D,GACVh/D,KAAKg/D,OAAS,IAAIk4D,GAAcl4D,GAChCh/D,KAAKwqD,cAAgBwU,EAAOxU,aAC9B,ECGK,MAAMutE,GAAoBhiH,GAAkBpL,OAAmB4O,GAAc,UAAW,CAC7F5E,aAAehM,GAA6B4hD,GAAWv8C,SAASrF,GAChEqN,QAAS,CAAC,YAGCgiH,GAAoBjiH,GAAkBpL,OACjD8O,GACA,mBACA,CACE9E,aAAeqqD,GAAgCrN,GAAW3jD,SAASgxD,GACnEhpD,QAAS,CAAC,SAAU,UAIXiiH,GAAiB,IAAIliH,GAChCyD,GACA,YACA,CACE7E,aAAek9C,GAAcA,EAC7B77C,QAAS,CAAC,YAIDkiH,GAA2B,IAAIniH,GAC1C0D,GACA,oBACA,CACE9E,aAAewjH,IACb,GAAyB,MAArBA,EACF,OAAO,KAQT,MAAO,CAAEn5D,OAJ6B,OAApCm5D,aAAiB,EAAjBA,EAAmBn5D,OAAOtuD,QACtBynH,EAAkBn5D,OAClBrN,GAAW3jD,SAASmqH,aAAiB,EAAjBA,EAAmBn5D,QAE5BxU,cAAe2tE,EAAkB3tE,cAAe,EAEnEx0C,QAAS,CAAC,SAAU,U,kuBCoBxB,MAAMoiH,GAAgC,IAAI,GAAAn0E,OAAO,YAE1C,MAAMo0E,GASX,QAAAC,CAASlyH,GACP,OAAOpG,KAAKu4H,aAAarsH,MAAK,QAAKssH,GAAUA,EAAMpyH,KACrD,CAQA,WAAA5G,CACUsU,EACAgwD,EACA73C,EACA/jB,EACAuwH,EACA/7G,EACA0nE,EACAzwE,EACA+kH,EACA/0D,EACAlnD,GAVA,KAAA3I,cAAAA,EACA,KAAAgwD,sBAAAA,EACA,KAAA73C,WAAAA,EACA,KAAA/jB,YAAAA,EACA,KAAAuwH,cAAAA,EACA,KAAA/7G,aAAAA,EACA,KAAA0nE,wBAAAA,EACA,KAAAzwE,eAAAA,EACA,KAAA+kH,wBAAAA,EACA,KAAA/0D,cAAAA,EACA,KAAAlnD,cAAAA,EA7BF,KAAAk8G,mBAAyC,IAAI7C,GACnD91H,KAAK44H,uBA8BL54H,KAAK64H,eAAiB74H,KAAKyc,cAAc0O,UAAU8sG,IACnDj4H,KAAK84H,sBAAwB94H,KAAKyc,cAAc0O,UAAU4sG,IAC1D/3H,KAAK+4H,sBAAwB/4H,KAAKyc,cAAc0O,UAAU6sG,IAC1Dh4H,KAAKg5H,uBAAyBh5H,KAAKyc,cAAc0O,UAAU+sG,IAC3Dl4H,KAAKi5H,uBAAyBj5H,KAAKyc,cAAc2wE,WAC/CptF,KAAK84H,sBAAsBz9G,OAC3B,IAAInH,EAAiBuF,GAAgB,yBAA0B,CAC7DjF,OAASiX,IAAoC,EAC7C9W,aAAe7E,GAAUA,IAE3B,CAAC,GAGH9P,KAAKk5H,WAAal5H,KAAK64H,eAAex9G,OAAOnP,MAAK,QAAKsG,GAASA,QAAAA,EAAQ,CAAC,KAEzExS,KAAKm5H,SAAWn5H,KAAKi5H,uBAAuB59G,OAAOnP,MACjD,EAAAktH,GAAA,IAAWC,GAAoBA,KAC/B,EAAAltH,EAAA,IAAU,IAAMnM,KAAK84H,sBAAsBz9G,UAC3C,QAAKs/D,GAAYA,QAAAA,EAAW,CAAC,KAE/B36E,KAAKu4H,aAAev4H,KAAK+4H,sBAAsB19G,OAAOnP,MACpD,QAAKssH,GAAUA,QAAAA,EAAS,CAAC,KAEzB,EAAAjtC,GAAA,GAAM,CACJG,qBAAqB,KAGzB1rF,KAAKs5H,mBAAqBt5H,KAAKg5H,uBAAuB39G,MACxD,CAEM,uBAAAk+G,CAAwBzpH,EAAqBqG,G,0CAIpC,MAATrG,GAAkC,IAAjBA,EAAMrN,eACnBzC,KAAKw5H,oBAAoB1pH,EAAOqG,IAEd,MAAtBnW,KAAKy4H,gBACM,MAAT3oH,QACI9P,KAAKy4H,cAAczkB,mBAEnBh0G,KAAKy4H,cAAcnkB,aAAaxkG,GAG5C,G,CAEc,mBAAA0pH,CAAoB1pH,EAAqBqG,G,0CACrD,MAAMsjH,EAA4C,CAAC,EACnD3pH,SAAAA,EAAOlI,SAAS7B,IACd0zH,EAAY1zH,EAAEK,IAAML,CAAC,UAEjB/F,KAAKyc,cAAcO,aAAag7G,GAAmByB,EAAatjH,EACxE,G,CAEM,UAAAujH,CAAWvjH,G,0CACfA,UAAAA,QAAiB,OAAenW,KAAKyc,cAAcqf,sBAC7C97B,KAAK25H,2BAA2BxjH,EACxC,G,CAEM,OAAA2H,CACJ81C,EACAgmE,EACAC,EACAC,EAAyB,M,gDAET,MAAZlmE,EAAMxtD,KACc,MAAlB0zH,IACFA,QAAuB95H,KAAKia,IAAI25C,EAAMxtD,KAElB,MAAlB0zH,UACI95H,KAAK+5H,8BAA8BnmE,EAAOkmE,IAElD95H,KAAKg6H,4BAA4BpmE,IAGnC,MAAMoL,EAAS,IAAIrL,GAWnB,GAVAqL,EAAO54D,GAAKwtD,EAAMxtD,GAClB44D,EAAOvU,SAAWmJ,EAAMnJ,SACxBuU,EAAOnU,SAAW+I,EAAM/I,SACxBmU,EAAO/oC,eAAiB29B,EAAM39B,eAC9B+oC,EAAO1xD,KAAOsmD,EAAMtmD,KACpB0xD,EAAOxU,cAAgBoJ,EAAMpJ,cAC7BwU,EAAOz6B,aAAeqvB,EAAMrvB,aAC5By6B,EAAOhU,SAAW4I,EAAM5I,SACxBgU,EAAOtU,KAAOkJ,EAAMlJ,WAEV1qD,KAAKi6H,gCAAiC,CAC9Cj7D,EAAO7uD,IAAyB,QAAnB,EAAA2pH,aAAc,EAAdA,EAAgB3pH,WAAG,QAAI,KACpC,MAAM+pH,QAAqBl6H,KAAKkgE,6BAA6BlB,GAM7D,OAHA46D,IAAAA,EAAqBM,GAErBL,IAAAA,EAA8BK,GACvBl6H,KAAKm6H,2BACVvmE,EACAoL,EACA46D,EACAC,E,CAGF,GAAwB,MAApBD,GAAqD,MAAzB56D,EAAO/oC,gBAEb,OADxB2jG,QAAyB55H,KAAK8T,cAAcE,UAAUgrD,EAAO/oC,iBAE3D,MAAM,IAAIz1B,MAAM,mDAMpB,OADAw+D,EAAO7uD,IAAM,KACNnQ,KAAKo6H,cAAcxmE,EAAOoL,EAAQ46D,E,IAIvC,kBAAAS,CACJC,EACAnqH,G,0CAEA,GAAwB,MAApBmqH,GAAwD,IAA5BA,EAAiB73H,OAC/C,OAAO,KAGT,MAAM4mB,EAA2B,GAC3BkxG,EAA+B,GAwBrC,OAvBAD,EAAiB1yH,SAAegsD,GAAU,mCACxC,MAAME,EAAa,IAAItB,GACvBsB,EAAW1tD,GAAKwtD,EAAMxtD,GACtB0tD,EAAWjV,KAAO+U,EAAM/U,KACxBiV,EAAWzM,SAAWuM,EAAMvM,SAC5ByM,EAAW7sD,IAAM2sD,EAAM3sD,IACvB,MAAM4sD,EAAU7zD,KAAKw6H,mBACnB5mE,EACAE,EACA,CACE1M,SAAU,MAEZj3C,GACAqZ,MAAK,IAAY,mCACA,MAAboqC,EAAMzjD,MACR2jD,EAAW3jD,UAAYnQ,KAAK8T,cAAcgK,QAAQ81C,EAAMzjD,IAAIA,IAAKA,IAEnEoqH,EAAe3/G,KAAKk5C,EACtB,MACAzqC,EAASzO,KAAKi5C,EAChB,YAEMjoD,QAAQ+d,IAAIN,GACXkxG,CACT,G,CAEM,aAAAE,CAAcC,EAA0BvqH,G,0CAC5C,IAAKuqH,IAAgBA,EAAYj4H,OAC/B,OAAO,KAGT,MAAMvB,EAAOlB,KACP26H,EAAqB,GAO3B,aANMD,EAAYz7F,QAAO,CAAO40B,EAASG,IAAU,yCAC3CH,EACN,MAAM+mE,QAAiB15H,EAAK25H,aAAa7mE,EAAO7jD,GAChDwqH,EAAU//G,KAAKggH,EACjB,KAAGhvH,QAAQC,WAEJ8uH,CACT,G,CAEM,YAAAE,CAAaC,EAAuB3qH,G,0CACxC,MAAM6jD,EAAQ,IAAInB,GAkBlB,OAjBAmB,EAAM1mD,KAAOwtH,EAAWxtH,KACxB0mD,EAAMnM,SAAWizE,EAAWjzE,SAExBizE,EAAWxtH,OAASw5C,GAAU1b,SAAgC,SAArB0vF,EAAWhrH,QACtDgrH,EAAWhrH,MAAQ,eAGf9P,KAAKw6H,mBACTM,EACA9mE,EACA,CACExyD,KAAM,KACNsO,MAAO,MAETK,GAGK6jD,CACT,G,CAEM,wBAAA+mE,CACJC,EACA7qH,G,0CAEA,IAAK6qH,IAAaA,EAASv4H,OACzB,OAAO,KAGT,MAAMvB,EAAOlB,KACPi7H,EAAqB,GAO3B,aANMD,EAAS/7F,QAAO,CAAO40B,EAASlI,IAAO,yCACrCkI,EACN,MAAMqnE,QAAch6H,EAAKi6H,uBAAuBxvE,EAAIx7C,GACpD8qH,EAAOrgH,KAAKsgH,EACd,KAAGtvH,QAAQC,WAEJovH,CACT,G,CAEM,sBAAAE,CACJC,EACAjrH,G,0CAEA,MAAMw7C,EAAK,IAAI4F,GAYf,OAXA5F,EAAGtB,aAAe+wE,EAAQ/wE,mBAEpBrqD,KAAKw6H,mBACTY,EACAzvE,EACA,CACE7nC,SAAU,MAEZ3T,GAGKw7C,CACT,G,CAEM,GAAA1xC,CAAI7T,G,0CACR,MAAMu0E,QAAgB,OAAe36E,KAAKm5H,UAE1C,GAAe,MAAXx+C,IAAoBA,EAAQ/4D,eAAexb,GAC7C,OAAO,KAGT,MAAMyrD,QAAkB,OAAe7xD,KAAKk5H,YACtCv5D,EAAWv5D,EAEjB,OAAO,IAAIutD,GAAOgnB,EAAQhb,GAAW9N,EAAYA,EAAU8N,GAAY,KACzE,G,CAEM,MAAAhpC,G,0CACJ,MAAMk7B,QAAkB,OAAe7xD,KAAKk5H,YACtCv+C,QAAgB,OAAe36E,KAAKm5H,UACpCzrH,EAAqB,GAC3B,IAAK,MAAMtH,KAAMu0E,EAEf,GAAIA,EAAQ/4D,eAAexb,GAAK,CAC9B,MAAMu5D,EAAWv5D,EACjBsH,EAASkN,KAAK,IAAI+4C,GAAOgnB,EAAQhb,GAAW9N,EAAYA,EAAU8N,GAAY,M,CAGlF,OAAOjyD,CACT,G,CAGM,eAAAu0D,G,0CACJ,IAAIo5D,QAAmBr7H,KAAKs7H,sBAC5B,GAAkB,MAAdD,GAA4C,IAAtBA,EAAW54H,OAEnC,aADMzC,KAAKu7H,uBACEv7H,KAAKs7H,sBAGpB,MAAM9/E,QAAqB,OAAex7C,KAAKyc,cAAcqf,eAE7D,OAAoB,MAAhB0f,EACK,IAGT6/E,QAAmBr7H,KAAKw7H,qBAAqBx7H,KAAK22B,SAAU6kB,SAEtDx7C,KAAKu5H,wBAAwB8B,EAAY7/E,GACxC6/E,EACT,G,CAEc,mBAAAC,G,0CACZ,OAAOryH,OAAOmuB,aAAa,OAAep3B,KAAKu4H,cACjD,G,CAEc,cAAAiD,CAAe7gD,EAAmBxkE,G,0CAC9C,MAAMhN,QAAa,OAAenJ,KAAK8T,cAAc2nH,sBAAsBtlH,GAAQ,IAEnF,GAAY,MAARhN,GAAiC,MAAhBA,EAAKoU,SAAwD,IAArCtU,OAAOE,KAAKA,EAAKuyH,SAASj5H,OAErE,OAIF,MAAMk5H,EAAUhhD,EAAQ17C,QACtB,CAAC08C,EAAK51E,K,QAGJ,OAFoB,QAApB,EAAA41E,EAAI,EAAA51E,EAAEkwB,uBAAc,QAApB0lD,EAAI,GAAsB,IAC1BA,EAAI51E,EAAEkwB,gBAAgBrb,KAAK7U,GACpB41E,CAAG,GAEZ,CAAC,GAGG0/C,SACEzvH,QAAQ+d,IACZ1gB,OAAO2B,QAAQ+wH,GAASl3H,KAAI,EAAE+O,EAAOooH,M,MACnC,OAAA57H,KAAK2T,eAAe2yC,aAClBs1E,EACqC,QAArC,EAAAzyH,EAAKuyH,QAAQloH,UAAwB,QAAIrK,EAAKoU,QAC/C,MAIJy6B,OACA5a,KAAKp9B,KAAK67H,4BAEb,OAAOR,CACT,G,CAEc,cAAAE,G,gDACZ,MAAMplH,QAAenW,KAAK0c,aAAagzB,YAEf,MAAtB1vC,KAAKy4H,gBACuD,QAA1D,QAAM,OAAez4H,KAAKy4H,cAAcrlB,yBAAkB,QAAIj9F,KAAYA,UAEtEnW,KAAKy4H,cAAcnkB,mBAAmBt0G,KAAKs7H,sBAAuBnlH,G,IAItE,0BAAA2lH,CAA2BC,EAAoBC,GAAS,G,0CAG5D,aAFsBh8H,KAAKiiE,mBAEZviE,QAAQs/D,IACjBA,EAAO7M,eAGP6pE,GAAUh9D,EAAOvU,WAAasxE,KAG/BC,GACuB,MAAxBh9D,EAAOxU,eACPwU,EAAOxU,cAAc3jD,QAAQk1H,IAAe,IAOlD,G,CAEM,qBAAAE,CACJh1H,EACAi1H,EACAC,EAAwC,M,0CAExC,MAAMxhD,QAAgB36E,KAAKiiE,kBAC3B,aAAajiE,KAAKo8H,oBAAoBzhD,EAAS1zE,EAAKi1H,EAAmBC,EACzE,G,CAEM,mBAAAC,CACJzhD,EACA1zE,EACAi1H,EACAC,EAAwC,M,0CAExC,GAAW,MAAPl1H,GAAoC,MAArBi1H,EACjB,MAAO,GAGT,MAAMrkF,QAA0B,OAC9B73C,KAAK8jE,sBAAsBlsB,wBAAwB3wC,IAIrD,OAFAk1H,UAAAA,QAAuB,OAAen8H,KAAK8jE,sBAAsBvsB,2BAE1DojC,EAAQj7E,QAAQs/D,IACrB,MAAMq9D,EAAgBr9D,EAAO1xD,OAASs5C,GAAWqE,OAA0B,OAAjB+T,EAAO9T,MAEjE,OAA2B,OAAvB8T,EAAOjU,iBAKTxmD,MAAMyQ,QAAQknH,KACdA,EAAkBhsF,SAAS8uB,EAAO1xD,OACjC+uH,MAKCA,GACKr9D,EAAO9T,MAAMmF,WAAWppD,EAAK4wC,EAAmBskF,GAG7C,GAEhB,G,CAEM,4BAAAG,CAA6BrmG,G,0CACjC,MAAMvoB,QAAiB1N,KAAKisB,WAAW62E,uBAAuB7sE,GAC9D,aAAaj2B,KAAKu8H,mCAAmC7uH,EAAUuoB,EACjE,G,CAEM,6BAAAumG,CAA8BvmG,G,0CAClC,MAAMvoB,QAAiB1N,KAAKisB,WAAWiM,KACrC,MACA,yDAA2DjC,EAC3D,MACA,GACA,GAEF,OAAOj2B,KAAKu8H,mCAAmC7uH,EAAUuoB,EAC3D,G,CAEc,kCAAAsmG,CACZ7uH,EACAuoB,G,0CAEA,GAAsB,OAAlBvoB,aAAQ,EAARA,EAAU8E,OAAgB9E,EAAS8E,KAAK/P,OAAS,EACnD,MAAO,GAGT,MAAMk4E,EAAUjtE,EAAS8E,KAAK/N,KAAKg4H,GAAO,IAAI9oE,GAAO,IAAIpJ,GAAWkyE,MAC9DtsH,QAAYnQ,KAAK8T,cAAcE,UAAUiiB,GACzColG,QAAmBr7H,KAAK2T,eAAe2yC,aAAaq0B,EAASxqE,GAGnE,OADAkrH,EAAWj+F,KAAKp9B,KAAK67H,4BACdR,CACT,G,CAEM,iBAAAqB,CAAkBz1H,EAAa+iD,GAAqB,G,0CACxD,OAAOhqD,KAAK28H,gBAAgB11H,GAAK,GAAM,EAAO+iD,EAChD,G,CAEM,qBAAA4yE,CAAsB31H,EAAa+iD,GAAqB,G,0CAC5D,OAAOhqD,KAAK28H,gBAAgB11H,GAAK,GAAO,EAAM+iD,EAChD,G,CAEM,mBAAA6yE,CAAoB51H,G,0CACxB,OAAOjH,KAAK28H,gBAAgB11H,GAAK,GAAO,GAAO,EACjD,G,CAEA,yBAAA61H,CAA0B71H,GACxBjH,KAAK24H,mBAAmBlC,oBAAoBxvH,EAC9C,CAEM,kBAAA81H,CAAmB32H,G,0CACvB,MAAM+P,QAAe,OAAenW,KAAKyc,cAAcqf,eACvD,IAAIkhG,QAAyB,OAAeh9H,KAAKk5H,YAE5C8D,IACHA,EAAmB,CAAC,GAGtB,MAAMr9D,EAAWv5D,EACb42H,EAAiBr9D,GACnBq9D,EAAiBr9D,GAAUtV,cAAe,IAAI79C,MAAOD,UAErDywH,EAAiBr9D,GAAY,CAC3BtV,cAAc,IAAI79C,MAAOD,iBAIvBvM,KAAK64H,eAAen+G,QAAO,IAAMsiH,IAEvC,MAAMC,QAA6Bj9H,KAAKs7H,sBACxC,GAAK2B,EAAL,CAIA,IAAK,IAAIv6H,EAAI,EAAGA,EAAIu6H,EAAqBx6H,OAAQC,IAAK,CACpD,MAAMw6H,EAASD,EAAqBv6H,GACpC,GAAIw6H,EAAO92H,KAAOA,EAAI,CACpB82H,EAAOrrE,UAAYmrE,EAAiB52H,GACpC,K,QAGEpG,KAAKw5H,oBAAoByD,EAAsB9mH,E,CACvD,G,CAEM,sBAAAgnH,CAAuB/2H,G,0CAC3B,MAAM+P,QAAe,OAAenW,KAAKyc,cAAcqf,eACvD,IAAIkhG,QAAyB,OAAeh9H,KAAKk5H,YAE5C8D,IACHA,EAAmB,CAAC,GAGtB,MAAMr9D,EAAWv5D,EACb42H,EAAiBr9D,GACnBq9D,EAAiBr9D,GAAUi3D,cAAe,IAAIpqH,MAAOD,UAErDywH,EAAiBr9D,GAAY,CAC3BtV,cAAc,IAAI79C,MAAOD,iBAIvBvM,KAAK64H,eAAen+G,QAAO,IAAMsiH,IAEvC,MAAMC,QAA6Bj9H,KAAKs7H,sBACxC,GAAK2B,EAAL,CAIA,IAAK,IAAIv6H,EAAI,EAAGA,EAAIu6H,EAAqBx6H,OAAQC,IAAK,CACpD,MAAMw6H,EAASD,EAAqBv6H,GACpC,GAAIw6H,EAAO92H,KAAOA,EAAI,CACpB82H,EAAOrrE,UAAYmrE,EAAiB52H,GACpC,K,QAGEpG,KAAKw5H,oBAAoByD,EAAsB9mH,E,CACvD,G,CAEM,eAAAinH,CAAgB51H,G,0CACpB,GAAc,MAAVA,EACF,OAGF,IAAIw0F,QAAgB,OAAeh8F,KAAK8jE,sBAAsB3sB,eACzD6kD,IACHA,EAAU,CAAC,GAEbA,EAAQx0F,GAAU,WACZxH,KAAK8jE,sBAAsBrsB,gBAAgBukD,EACnD,G,CAEM,gBAAAqhC,CAAiBr+D,EAAgBs+D,G,0CACrC,IAAI5vH,EACJ,GAAI4vH,GAAqC,MAAzBt+D,EAAO/oC,eAAwB,CAC7C,MAAM2C,EAAU,IAAIg/F,GAAoB54D,GACxCtxD,QAAiB1N,KAAKisB,WAAWg3E,gBAAgBrqE,E,MAC5C,GAA4B,MAAxBomC,EAAOxU,cAAuB,CACvC,MAAM5xB,EAAU,IAAIg/F,GAAoB54D,GACxCtxD,QAAiB1N,KAAKisB,WAAW+2E,iBAAiBpqE,E,KAC7C,CACL,MAAMA,EAAU,IAAIs+F,GAAcl4D,GAClCtxD,QAAiB1N,KAAKisB,WAAW82E,WAAWnqE,E,CAE9ComC,EAAO54D,GAAKsH,EAAStH,GAErB,MAAMoM,EAAO,IAAI+3C,GAAW78C,EAAUsxD,EAAOxU,eACvCw0B,QAAgBh/E,KAAK62B,OAAOrkB,GAElC,OAAO,IAAImhD,GAAOqrB,EAAQhgB,EAAO54D,IACnC,G,CAEM,gBAAAk6D,CACJtB,EACAs+D,EACAC,G,0CAEA,IAAI7vH,EACJ,GAAI4vH,GAAYC,EAAY,CAC1B,MAAM3kG,EAAU,IAAIs+F,GAAcl4D,GAClCtxD,QAAiB1N,KAAKisB,WAAWm3E,eAAepkC,EAAO54D,GAAIwyB,E,MACtD,GAAIomC,EAAOtU,KAAM,CACtB,MAAM9xB,EAAU,IAAIs+F,GAAcl4D,GAClCtxD,QAAiB1N,KAAKisB,WAAWi3E,UAAUlkC,EAAO54D,GAAIwyB,E,KACjD,CACL,MAAMA,EAAU,IAAIi/F,GAAqB74D,GACzCtxD,QAAiB1N,KAAKisB,WAAWk3E,iBAAiBnkC,EAAO54D,GAAIwyB,E,CAG/D,MAAMpmB,EAAO,IAAI+3C,GAAW78C,EAAUsxD,EAAOxU,eACvCw0B,QAAgBh/E,KAAK62B,OAAOrkB,GAElC,OAAO,IAAImhD,GAAOqrB,EAAQhgB,EAAO54D,IAAiB44D,EAAOnN,UAC3D,G,CAEM,eAAA2rE,CACJx+D,EACA/oC,EACAu0B,G,0CAEA,MAAMizE,EAAqC,GACjB,MAAtBz+D,EAAOvT,aACTuT,EAAOvT,YAAY7jD,SAASksD,IACJ,MAAlBA,EAAW3jD,KACbstH,EAAmB7iH,KACjB5a,KAAK09H,0BAA0B5pE,EAAYkL,EAAO54D,GAAI6vB,G,UAKxDrqB,QAAQ+d,IAAI8zG,GAElBz+D,EAAO/oC,eAAiBA,EACxB+oC,EAAOxU,cAAgBA,EACvB,MAAMmzE,QAAkB39H,KAAK49H,oBAAoB5+D,GAC3CpmC,EAAU,IAAIk/F,GAAmB6F,GACjCjwH,QAAiB1N,KAAKisB,WAAWy3E,eAAe1kC,EAAO54D,GAAIwyB,GAC3DpmB,EAAO,IAAI+3C,GAAW78C,EAAU88C,SAChCxqD,KAAK62B,OAAOrkB,EACpB,G,CAEM,mBAAAqrH,CACJljD,EACA1kD,EACAu0B,G,0CAEA,MAAMnhC,EAA2B,GAC3By0G,EAAuB,GAC7B,IAAK,MAAM9+D,KAAU2b,EACnB3b,EAAO/oC,eAAiBA,EACxB+oC,EAAOxU,cAAgBA,EACvBnhC,EAASzO,KACP5a,KAAK49H,oBAAoB5+D,GAAQx1C,MAAMzjB,IACrC+3H,EAAWljH,KAAK7U,EAAE,WAIlB6F,QAAQ+d,IAAIN,GAClB,MAAMuP,EAAU,IAAI4+F,GAAuBsG,EAAYtzE,GACvD,UACQxqD,KAAKisB,WAAW03E,gBAAgB/qE,E,CACtC,MAAO/tB,GACP,IAAK,MAAMm0D,KAAU2b,EACnB3b,EAAO/oC,eAAiB,KACxB+oC,EAAOxU,cAAgB,KAEzB,MAAM3/C,C,OAEF7K,KAAK62B,OAAOinG,EAAWr5H,KAAKsB,GAAMA,EAAEouD,iBAC5C,G,CAEA,wBAAA4pE,CAAyB/+D,EAAgBg/D,EAAsBC,GAAQ,GACrE,OAAO,IAAIryH,SAAQ,CAACC,EAASi0F,KAC3B,MAAMw1B,EAAS,IAAIC,WACnBD,EAAOE,kBAAkBwI,GACzB1I,EAAOG,OAAgBC,GAAa,mCAClC,IACE,MAAMwI,QAAcl+H,KAAKm+H,4BACvBn/D,EACAg/D,EAAgBx8H,KAChBk0H,EAAI3sH,OAAO47B,OACXs5F,GAEFpyH,EAAQqyH,E,CACR,MAAOrzH,GACPi1F,EAAOj1F,E,CAEX,IACAyqH,EAAOK,QAAU,KACf71B,EAAO,sBAAsB,CAC9B,GAEL,CAEM,2BAAAq+B,CACJn/D,EACAo/D,EACA5rH,EACAyrH,GAAQ,G,0CAER,MAAM5tH,QAAerQ,KAAKkgE,6BAA6BlB,GACjDq/D,QAAmCr+H,KAAKi6H,gCAExCqE,EACJD,GAA4C,MAAdr/D,EAAO7uD,IAChC,IAAI,QACGnQ,KAAK2T,eAAe6L,eAAew/C,EAAO7uD,IAAKE,IAEvDA,EAKN,GAAkB,MAAd2uD,EAAO7uD,MAAgBkuH,EAA4B,CACrD,MAAMzqE,QAAcoL,EAAOzrD,cAAcvT,KAAKkgE,6BAA6BlB,IAC3EA,QAAeh/D,KAAK8d,QAAQ81C,SACtB5zD,KAAKsgE,iBAAiBtB,E,CAG9B,MAAMu/D,QAAoBv+H,KAAK2T,eAAemK,QAAQsgH,EAAUE,GAE1DE,QAAmBx+H,KAAK8T,cAAc2qH,eAAeH,GACrDI,QAAgB1+H,KAAK2T,eAAe2xC,eAAe,IAAInjD,WAAWqQ,GAAOgsH,EAAW,IAEpF9wH,QAAiB1N,KAAK04H,wBAAwB/xD,OAClD3H,EACAu/D,EACAG,EACAT,EACAO,GAGIN,EAAQ,IAAI3zE,GAAW78C,EAAUsxD,EAAOxU,eAI9C,OAHKyzE,UACGj+H,KAAK62B,OAAOqnG,IAEb,IAAIvqE,GAAOuqE,EACpB,G,CAEM,yBAAAS,CAA0B3/D,G,0CAC9B,MAAMpmC,EAAU,IAAI++F,GAAyB34D,EAAOxU,eAC9C98C,QAAiB1N,KAAKisB,WAAW23E,qBAAqB5kC,EAAO54D,GAAIwyB,GAGvE,GAAIlrB,EAAS6vF,YAEX,kBADMv9F,KAAK4+C,OAAOogB,EAAO54D,KAG3B,MAAMoM,EAAO,IAAI+3C,GAAW78C,EAASsxD,QAC/BggB,QAAgBh/E,KAAK62B,OAAOrkB,GAClC,OAAO,IAAImhD,GAAOqrB,EAAQhgB,EAAO54D,IAAiB44D,EAAOnN,UAC3D,G,CASM,+BAAA+sE,CACJprH,EACA8tD,EACA9W,EACAktE,GAA6B,G,kDAE7B,MAAM9+F,EAAU,IAAI6+F,GAClBjkH,EACA8tD,EACA9W,EACAktE,SAGI13H,KAAKisB,WAAWiM,KAAK,OAAQ,4BAA6BU,GAAS,GAAM,GAG/E,MAAM+hD,QAAgB,OAAe36E,KAAKm5H,UAE1C,IAAK,MAAM/yH,KAAMk7D,EAAW,CAC1B,MAAMtC,EAAS2b,EAAQv0E,GACnB44D,IAEAA,EAAOxU,cADLktE,EACyC,QAApB,EAAA14D,EAAOxU,qBAAa,eAAE9qD,QAC1Cm/H,IAASr0E,EAActa,SAAS2uF,KAIZ,IAAI,IAAI3xH,IAAI,IAAyB,QAApB,EAAA8xD,EAAOxU,qBAAa,QAAI,MAAQA,K,OAKxExqD,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,IAAMigE,G,IAG1C,MAAA9jD,CAAOmoC,G,0CACX,MAAM2b,EAAU3b,aAAkBzU,GAAa,CAACyU,GAAUA,EAC1D,aAAah/D,KAAK8+H,4BAA4BjwB,IAC5Cl0B,EAAQ/yE,SAAS7B,GAAO8oG,EAAQ9oG,EAAEK,IAAkBL,IAC7C8oG,IAEX,G,CAEM,OAAA3qG,CAAQy2E,G,gDACN36E,KAAK8+H,4BAA2B,IAAMnkD,GAC9C,G,CAOc,0BAAAmkD,CACZpkH,G,0CAEA,MAAMvE,QAAe,OAAenW,KAAKyc,cAAcqf,qBAEjD97B,KAAKi5H,uBAAuBrrC,YAAW,SACvC5tF,KAAK25H,2BAA2BxjH,GACtC,MAAO,CAAE4oH,SAAwB/+H,KAAK84H,sBAAsBp+G,QAAQm0F,GACnDn0F,EAAOm0F,QAAAA,EAAW,CAAC,KAGpC,OAAOkwB,CACT,G,CAEM,KAAA/pE,CAAM7+C,G,0CACVA,UAAAA,QAAiB,OAAenW,KAAKyc,cAAcqf,sBAC7C97B,KAAKg/H,2BAA2B7oH,SAChCnW,KAAK05H,WAAWvjH,EACxB,G,CAEM,kBAAA8oH,CAAmBj9D,EAAevX,G,gDAChCzqD,KAAKisB,WAAWw3E,eAAe,IAAIszB,GAAsB/0D,EAAKvX,IAEpE,IAAIkwB,QAAgB,OAAe36E,KAAKm5H,UACzB,MAAXx+C,IACFA,EAAU,CAAC,GAGb3Y,EAAIp6D,SAASxB,IAEPu0E,EAAQ/4D,eAAexb,KACzBu0E,EAAQv0E,GAAgBqkD,SAAWA,E,UAIjCzqD,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,IAAMigE,GAChD,G,CAEM,OAAOv0E,G,0CACX,MAAMu0E,QAAgB,OAAe36E,KAAKm5H,UAC1C,GAAe,MAAXx+C,EAAJ,CAIA,GAAkB,iBAAPv0E,EAAiB,CAC1B,MAAMu5D,EAAWv5D,EACjB,GAAyB,MAArBu0E,EAAQhb,GACV,cAEKgb,EAAQhb,E,MAEdv5D,EAAkBwB,SAASlF,WACnBi4E,EAAQj4E,EAAE,UAIf1C,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,IAAMigE,G,CAChD,G,CAEM,gBAAAukD,CAAiB94H,EAAY+4H,GAAU,G,0CACvCA,QACIn/H,KAAKisB,WAAWq3E,kBAAkBl9F,SAElCpG,KAAKisB,WAAWo3E,aAAaj9F,SAG/BpG,KAAK4+C,OAAOx4C,EACpB,G,CAEM,oBAAAg5H,CAAqBp9D,EAAem9D,GAAU,G,0CAClD,MAAMvmG,EAAU,IAAIk+F,GAAwB90D,GACxCm9D,QACIn/H,KAAKisB,WAAWu3E,uBAAuB5qE,SAEvC54B,KAAKisB,WAAWs3E,kBAAkB3qE,SAEpC54B,KAAK4+C,OAAOojB,EACpB,G,CAEM,gBAAAq9D,CAAiBj5H,EAAY+2F,G,0CACjC,IAAIxiB,QAAgB,OAAe36E,KAAKm5H,UACxC,MAAMx5D,EAAWv5D,EAEjB,GAAe,MAAXu0E,GAAoBA,EAAQ/4D,eAAexb,IAAwC,MAAjCu0E,EAAQhb,GAAUlU,YAAxE,CAIA,IAAK,IAAI/oD,EAAI,EAAGA,EAAIi4E,EAAQhb,GAAUlU,YAAYhpD,OAAQC,IACpDi4E,EAAQhb,GAAUlU,YAAY/oD,GAAG0D,KAAO+2F,GAC1CxiB,EAAQhb,GAAUlU,YAAY8hD,OAAO7qG,EAAG,SAItC1C,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,KACvB,MAAXigE,IACFA,EAAU,CAAC,GAENA,I,CAEX,G,CAEM,0BAAA2kD,CAA2Bl5H,EAAY+2F,G,0CAC3C,UACQn9F,KAAKisB,WAAW24E,uBAAuBx+F,EAAI+2F,E,CACjD,MAAOtyF,GACP,OAAOe,QAAQk0F,OAAQj1F,EAAoB8W,mB,OAEvC3hB,KAAKq/H,iBAAiBj5H,EAAI+2F,EAClC,G,CAEA,qBAAAy7B,CAAsBxwH,EAAeC,GACnC,MAAMk3H,EACJn3H,EAAEypD,WAAazpD,EAAEypD,UAAUxH,aAAgBjiD,EAAEypD,UAAUxH,aAA0B,KAC7Em1E,EACJn3H,EAAEwpD,WAAaxpD,EAAEwpD,UAAUxH,aAAgBhiD,EAAEwpD,UAAUxH,aAA0B,KAE7Eo1E,EAA2B,MAAbF,GAAkC,MAAbC,EACzC,OAAIC,GAAeF,EAAYC,EACtB,EAEQ,MAAbD,GAAkC,MAAbC,GAIrBC,GAAeF,EAAYC,GAHrB,EAMO,MAAbA,GAAkC,MAAbD,EAChB,EAGF,CACT,CAEA,6BAAAG,CAA8Bt3H,EAAeC,GAC3C,MAAMs8B,EAAS3kC,KAAK44H,sBAAsBxwH,EAAGC,GAC7C,OAAe,IAAXs8B,EACKA,EAGF3kC,KAAK67H,0BAAL77H,CAAgCoI,EAAGC,EAC5C,CAEA,wBAAAwzH,GACE,MAAO,CAACzzH,EAAGC,KACT,IAAIs3H,EAAQv3H,EAAE5G,KACVo+H,EAAQv3H,EAAE7G,KAEd,GAAa,MAATm+H,GAA0B,MAATC,EACnB,OAAQ,EAEV,GAAa,MAATD,GAA0B,MAATC,EACnB,OAAO,EAET,GAAa,MAATD,GAA0B,MAATC,EACnB,OAAO,EAGT,MAAMj7F,EAAS3kC,KAAKkI,YAAYI,SAC5BtI,KAAKkI,YAAYI,SAASC,QAAQo3H,EAAOC,GACzCD,EAAMn3H,cAAco3H,GAExB,OAAe,IAAXj7F,GAAgBv8B,EAAEkF,OAASs5C,GAAWqE,OAAS5iD,EAAEiF,OAASs5C,GAAWqE,MAChEtmB,GAGe,MAApBv8B,EAAE8iD,MAAMrnC,WACV87G,GAASv3H,EAAE8iD,MAAMrnC,UAGK,MAApBxb,EAAE6iD,MAAMrnC,WACV+7G,GAASv3H,EAAE6iD,MAAMrnC,UAGZ7jB,KAAKkI,YAAYI,SACpBtI,KAAKkI,YAAYI,SAASC,QAAQo3H,EAAOC,GACzCD,EAAMn3H,cAAco3H,GAAM,CAElC,CAEM,UAAAC,CAAWz5H,G,0CACf,IAAIu0E,QAAgB,OAAe36E,KAAKm5H,UACxC,GAAe,MAAXx+C,EACF,OAGF,MAAMmlD,EAAkBngE,IACG,MAArBgb,EAAQhb,KAGZgb,EAAQhb,GAAU5U,aAAc,IAAIv+C,MAAO61C,cAAa,EAGxC,iBAAPj8C,EACT05H,EAAe15H,GAEdA,EAAgBwB,QAAQk4H,SAGrB9/H,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,KACvB,MAAXigE,IACFA,EAAU,CAAC,GAENA,IAEX,G,CAEM,oBAAAolD,CAAqB35H,EAAY+4H,GAAU,G,0CAC3CA,QACIn/H,KAAKisB,WAAW+3E,qBAAqB59F,SAErCpG,KAAKisB,WAAW83E,gBAAgB39F,SAGlCpG,KAAK6/H,WAAWz5H,EACxB,G,CAEM,wBAAA45H,CAAyBh+D,EAAem9D,GAAU,G,0CACtD,MAAMvmG,EAAU,IAAIk+F,GAAwB90D,GACxCm9D,QACIn/H,KAAKisB,WAAWi4E,0BAA0BtrE,SAE1C54B,KAAKisB,WAAWg4E,qBAAqBrrE,SAGvC54B,KAAK6/H,WAAW79D,EACxB,G,CAEM,OAAAi+D,CACJjhE,G,0CAEA,IAAI2b,QAAgB,OAAe36E,KAAKm5H,UACxC,GAAe,MAAXx+C,EACF,OAGF,MAAMulD,EAAoBn6H,IACxB,MAAM45D,EAAW55D,EAAEK,GACM,MAArBu0E,EAAQhb,KAGZgb,EAAQhb,GAAU5U,YAAc,KAChC4vB,EAAQhb,GAAUp7B,aAAex+B,EAAEw+B,aAAY,EAG7Cy6B,EAAOx/D,YAAYgC,OAAS+C,MAAM/C,KACnCw9D,EAAkDp3D,QAAQs4H,GAE3DA,EAAiBlhE,SAGbh/D,KAAK05H,mBACL15H,KAAK84H,sBAAsBp+G,QAAO,KACvB,MAAXigE,IACFA,EAAU,CAAC,GAENA,IAEX,G,CAEM,iBAAAwlD,CAAkB/5H,EAAY+4H,GAAU,G,0CAC5C,IAAIzxH,EAEFA,EADEyxH,QACen/H,KAAKisB,WAAWm4E,sBAAsBh+F,SAEtCpG,KAAKisB,WAAWk4E,iBAAiB/9F,SAG9CpG,KAAKigI,QAAQ,CAAE75H,GAAIA,EAAIm+B,aAAc72B,EAAS62B,cACtD,G,CAMM,qBAAA67F,CAAsBp+D,EAAexuD,EAAgB,M,0CACzD,IAAI9F,EAEJ,GAAI8F,EAAO,CACT,MAAMolB,EAAU,IAAIo+F,GAAyBh1D,EAAKxuD,GAClD9F,QAAiB1N,KAAKisB,WAAWq4E,2BAA2B1rE,E,KACvD,CACL,MAAMA,EAAU,IAAIo+F,GAAyBh1D,GAC7Ct0D,QAAiB1N,KAAKisB,WAAWo4E,sBAAsBzrE,E,CAGzD,MAAMynG,EAAmD,GACzD,IAAK,MAAMrhE,KAAUtxD,EAAS8E,KAC5B6tH,EAASzlH,KAAK,CAAExU,GAAI44D,EAAO54D,GAAIm+B,aAAcy6B,EAAOz6B,qBAEhDvkC,KAAKigI,QAAQI,EACrB,G,CAEM,4BAAAngE,CAA6BlB,G,0CACjC,aACSh/D,KAAK8T,cAAcE,UAAUgrD,EAAO/oC,yBACnCj2B,KAAK8T,cAAcG,8BAE/B,G,CAEM,oBAAAqsH,CAAqBxwH,G,gDACnB9P,KAAKg5H,uBAAuBt+G,QAAO,IAAM5K,GAAO,CACpD+K,aAAeg0F,KAAyB,MAAXA,GAA4B,MAAT/+F,IAEpD,G,CAMc,mBAAA8tH,CAAoBhqE,G,0CAChC,MAAMimE,QAAkC75H,KAAK8T,cAAcG,8BAC3D,aAAajU,KAAK8d,QAAQ81C,EAAO,KAAMimE,EACzC,G,CAEc,6BAAAE,CACZnmE,EACAkmE,G,0CAEA,MAAMyG,QAAuBzG,EAAevmH,cACpCvT,KAAKkgE,6BAA6B45D,IAG1C,GADAlmE,EAAMlI,gBAAkB60E,EAAe70E,iBAAmB,GACtDkI,EAAMtmD,OAASs5C,GAAWqE,OAASs1E,EAAejzH,OAASs5C,GAAWqE,MACxE,GACmC,MAAjCs1E,EAAer1E,MAAMpnC,UACa,KAAlCy8G,EAAer1E,MAAMpnC,UACrBy8G,EAAer1E,MAAMpnC,WAAa8vC,EAAM1I,MAAMpnC,SAC9C,CACA,MAAM6nC,EAAK,IAAI6F,GACf7F,EAAG7nC,SAAWy8G,EAAer1E,MAAMpnC,SACnC6nC,EAAGtB,aAAeuJ,EAAM1I,MAAMpB,qBAAuB,IAAIt9C,KACzDonD,EAAMlI,gBAAgB6hD,OAAO,EAAG,EAAG5hD,E,MAEnCiI,EAAM1I,MAAMpB,qBAAuBy2E,EAAer1E,MAAMpB,qBAG5D,GAAIy2E,EAAetuE,UAAW,CAC5B,MAAMuuE,EAAuBD,EAAe/0E,OAAO9rD,QAChDu5B,GACCA,EAAE3rB,OAASw5C,GAAU25E,QACX,MAAVxnG,EAAEz3B,MACS,KAAXy3B,EAAEz3B,MACS,MAAXy3B,EAAEnpB,OACU,KAAZmpB,EAAEnpB,QAEA4wH,EACY,MAAhB9sE,EAAMpI,OACF,GACAoI,EAAMpI,OAAO9rD,QACVu5B,GAAMA,EAAE3rB,OAASw5C,GAAU25E,QAAoB,MAAVxnG,EAAEz3B,MAA2B,KAAXy3B,EAAEz3B,OAElEg/H,EAAqB54H,SAAS+4H,IAC5B,MAAMC,EAAeF,EAAaxqG,MAAM+C,GAAMA,EAAEz3B,OAASm/H,EAAGn/H,OAC5D,GAAoB,MAAhBo/H,GAAwBA,EAAa9wH,QAAU6wH,EAAG7wH,MAAO,CAC3D,MAAM67C,EAAK,IAAI6F,GACf7F,EAAG7nC,SAAW68G,EAAGn/H,KAAO,KAAOm/H,EAAG7wH,MAClC67C,EAAGtB,aAAe,IAAI79C,KACtBonD,EAAMlI,gBAAgB6hD,OAAO,EAAG,EAAG5hD,E,KAI3C,G,CAEQ,2BAAAquE,CAA4BpmE,GACL,MAAzBA,EAAMlI,iBAA4D,IAAjCkI,EAAMlI,gBAAgBjpD,OACzDmxD,EAAMlI,gBAAkB,KACU,MAAzBkI,EAAMlI,iBAA2BkI,EAAMlI,gBAAgBjpD,OAAS,IAEzEmxD,EAAMlI,gBAAkBkI,EAAMlI,gBAAgB9mD,MAAM,EAAG,GAE3D,CAEc,yBAAA84H,CACZmD,EACAlhE,EACA1pC,G,0CAEA,MAAM6qG,QAA2B9gI,KAAKisB,WAAWw+E,YAC/C,IAAItjC,QAAQ05D,EAAe55H,IAAK,CAAEu3C,MAAO,cAE3C,GAAkC,MAA9BsiF,EAAmB5/G,OACrB,MAAM1gB,MAAM,kCAAoCsgI,EAAmB5/G,OAAOzd,YAG5E,MAAMs9H,QAAev8E,GAAe/yC,aAAaqvH,GAC3CE,QAAehhI,KAAK8T,cAAcmtH,iBAAiBF,EAAQ,MAEjE,IAAI1wH,EACJA,QAAerQ,KAAK8T,cAAcE,UAAUiiB,GAC5C5lB,IAAAA,QAAkBrQ,KAAK8T,cAAcG,+BAErC,MAAMuqH,QAAmBx+H,KAAK8T,cAAc2qH,eAAepuH,GAErDkuH,QAAoBv+H,KAAK2T,eAAemK,QAAQ+iH,EAAez5E,SAAU/2C,GACzEquH,QAAgB1+H,KAAK2T,eAAe2xC,eAAe,IAAInjD,WAAW6+H,GAASxC,EAAW,IAEtFj1D,EAAK,IAAIC,SACf,IACE,MAAMC,EAAO,IAAIC,KAAK,CAACg1D,EAAQl7H,QAAS,CAAE8J,KAAM,6BAChDi8D,EAAGpB,OAAO,MAAOq2D,EAAW,GAAGxrH,iBAC/Bu2D,EAAGpB,OAAO,OAAQsB,EAAM80D,EAAYvrH,gB,CACpC,MAAOnI,GACP,IAAI,EAAMxJ,QAAW,EAAMI,UAWzB,MAAMoJ,EAVN0+D,EAAGpB,OAAO,MAAOq2D,EAAW,GAAGxrH,iBAC/Bu2D,EAAGpB,OACD,OACA/lE,OAAOC,KAAKq8H,EAAQl7H,QACpB,CACEmmE,SAAU40D,EAAYvrH,gBACtB42D,YAAa,4B,CAQrB,UACQ5pE,KAAKisB,WAAW64E,0BACpBnlC,EACAkhE,EAAez6H,GACfmjE,EACAtzC,E,CAEF,MAAOprB,GACP,MAAM,IAAIrK,MAAOqK,EAAoB8W,mB,CAEzC,G,CAEc,kBAAA64G,CACZ5mE,EACAjrD,EACAlE,EACA0L,G,0CAEA,MAAMkZ,EAAW,GACXnoB,EAAOlB,KAEb,IAAK,MAAMmI,KAAQ1D,EAEZA,EAAImd,eAAezZ,IAIxB,SAAWmhB,EAAS43G,GAClB,MAAM33G,EAAI3d,QAAQC,UACf2d,MAAK,KACJ,MAAM23G,EAAavtE,EAAcnvD,EAAI6kB,IAAYA,GACjD,OAAI63G,GAA2B,KAAdA,EACRjgI,EAAK4S,cAAcgK,QAAQqjH,EAAWhxH,GAExC,IAAI,IAEZqZ,MAAME,IACJw3G,EAAe53G,GAAWI,CAAG,IAElCL,EAASzO,KAAK2O,EACf,CAbD,CAaGphB,EAAMQ,SAGLiD,QAAQ+d,IAAIN,EACpB,G,CAEc,iBAAA+3G,CAAkBpiE,EAAgBpL,EAAmBzjD,G,0CACjE,OAAQ6uD,EAAO1xD,MACb,KAAKs5C,GAAWqE,MAed,GAdA+T,EAAO9T,MAAQ,IAAID,GACnB+T,EAAO9T,MAAMpB,qBAAuB8J,EAAM1I,MAAMpB,qBAChDkV,EAAO9T,MAAMlB,mBAAqB4J,EAAM1I,MAAMlB,yBACxChqD,KAAKw6H,mBACT5mE,EAAM1I,MACN8T,EAAO9T,MACP,CACErnC,SAAU,KACVC,SAAU,KACVimC,KAAM,MAER55C,GAGsB,MAApByjD,EAAM1I,MAAMjB,KAAc,CAC5B+U,EAAO9T,MAAMjB,KAAO,GACpB2J,EAAM1I,MAAMjB,KAAO2J,EAAM1I,MAAMjB,KAAKvqD,QAAQwqD,GAAe,MAATA,EAAEP,MACpD,IAAK,IAAIjnD,EAAI,EAAGA,EAAIkxD,EAAM1I,MAAMjB,KAAKxnD,OAAQC,IAAK,CAChD,MAAMwzG,EAAW,IAAIhjD,GACrBgjD,EAASzqG,MAAQmoD,EAAM1I,MAAMjB,KAAKvnD,GAAG+I,YAC/BzL,KAAKw6H,mBACT5mE,EAAM1I,MAAMjB,KAAKvnD,GACjBwzG,EACA,CACEvsD,IAAK,MAEPx5C,GAEF,MAAMkxH,QAAgBrhI,KAAK2T,eAAexJ,KAAKypD,EAAM1I,MAAMjB,KAAKvnD,GAAGinD,IAAK,UACxEusD,EAAStsD,kBAAoB5pD,KAAK8T,cAAcgK,QAAQujH,EAASlxH,GACjE6uD,EAAO9T,MAAMjB,KAAKrvC,KAAKs7F,E,EAoC3B,YAhCoC,MAAhCtiD,EAAM1I,MAAMf,mBACd6U,EAAO9T,MAAMf,uBAAyBv+C,QAAQ+d,IAC5CiqC,EAAM1I,MAAMf,iBAAiB1lD,KAAW68H,GAAY,mCAClD,MAAMC,EAAY,IAAIvuE,GAyBtB,aAxBMhzD,KAAKw6H,mBACT8G,EACAC,EACA,CACEx4E,aAAc,KACdC,QAAS,KACTC,aAAc,KACdC,SAAU,KACVC,SAAU,KACVC,KAAM,KACNG,OAAQ,KACRx7C,WAAY,KACZs7C,SAAU,KACVG,gBAAiB,KACjB6Z,OAAQ,MAEVlzD,GAEFoxH,EAAUj4E,cAAgBtpD,KAAK8T,cAAcgK,QAAQla,OAAO09H,EAAQh4E,SAAUn5C,GAC9EoxH,EAAU93E,mBAAqBzpD,KAAK8T,cAAcgK,QAChDla,OAAO09H,EAAQ73E,cACft5C,GAEFoxH,EAAUj9F,aAAeg9F,EAAQh9F,aAC1Bi9F,CACT,SAIN,KAAK36E,GAAWuE,WAGd,OAFA6T,EAAO5T,WAAa,IAAID,QACxB6T,EAAO5T,WAAW99C,KAAOsmD,EAAMxI,WAAW99C,MAE5C,KAAKs5C,GAAWyE,KAed,OAdA2T,EAAO1T,KAAO,IAAID,cACZrrD,KAAKw6H,mBACT5mE,EAAMtI,KACN0T,EAAO1T,KACP,CACE/D,eAAgB,KAChBC,MAAO,KACPC,OAAQ,KACRC,SAAU,KACVC,QAAS,KACT39B,KAAM,MAER7Z,IAGJ,KAAKy2C,GAAW2E,SA2Bd,OA1BAyT,EAAO7e,SAAW,IAAIoL,cAChBvrD,KAAKw6H,mBACT5mE,EAAMzT,SACN6e,EAAO7e,SACP,CACE4H,MAAO,KACPC,UAAW,KACXC,WAAY,KACZC,SAAU,KACVC,SAAU,KACVC,SAAU,KACVC,SAAU,KACVC,KAAM,KACN9tC,MAAO,KACP+tC,WAAY,KACZC,QAAS,KACTC,QAAS,KACT53C,MAAO,KACP63C,MAAO,KACPC,IAAK,KACL9kC,SAAU,KACV+kC,eAAgB,KAChBC,cAAe,MAEjB14C,IAGJ,QACE,MAAM,IAAI3P,MAAM,wBAEtB,G,CAEc,4BAAAghI,G,0CACZ,aAAa,OAAexhI,KAAKokF,wBAAwBvvC,2BAC3D,G,CAEc,eAAA8nF,CACZ11H,EACAw6H,EACA7K,EACA5sE,G,0CAEA,MAAM5L,EAAW4L,EAAqB,sBAAwB/iD,EAAMA,EAEpE,IAAKjH,KAAK24H,mBAAmBzC,SAAS93E,GAAW,CAC/C,IAAIu8B,QAAgB36E,KAAKi8H,sBAAsBh1H,GAC/C,IAAK0zE,EACH,OAAO,KAGT,GAAI3wB,EAAoB,CACtB,MAAM03E,QAAkC1hI,KAAKwhI,+BAO7C,GALA7mD,EAAUA,EAAQj7E,QACfs/D,GACCA,EAAO9T,MAAMlB,oBACuB,MAAnCgV,EAAO9T,MAAMlB,qBAA4D,IAA9B03E,IAEzB,IAAnB/mD,EAAQl4E,OACV,OAAO,I,CAIXzC,KAAK24H,mBAAmBxC,WAAW/3E,EAAUu8B,E,CAG/C,OAAIi8C,EACK52H,KAAK24H,mBAAmBpC,gBAAgBn4E,GACtCqjF,EACFzhI,KAAK24H,mBAAmBrC,YAAYl4E,GAEpCp+C,KAAK24H,mBAAmBnC,QAAQp4E,EAE3C,G,CAEc,0BAAA4gF,CAA2B7oH,G,gDACjCnW,KAAKyc,cAAcO,aAAa+6G,GAAmB,CAAC,EAAG5hH,EAC/D,G,CAEc,0BAAAwjH,CAA2BxjH,G,gDACjCnW,KAAKw5H,oBAAoB,KAAMrjH,GACrCnW,KAAK2hI,oBACP,G,CAEQ,kBAAAA,GACN3hI,KAAK24H,mBAAmB3jE,OAC1B,CAEc,aAAAolE,CACZxmE,EACAoL,EACA7uD,G,0CAuBA,aArBMvE,QAAQ+d,IAAI,CAChB3pB,KAAKw6H,mBACH5mE,EACAoL,EACA,CACEx9D,KAAM,KACNspD,MAAO,MAET36C,GAEFnQ,KAAKohI,kBAAkBpiE,EAAQpL,EAAOzjD,GACtCnQ,KAAKy6H,cAAc7mE,EAAMpI,OAAQr7C,GAAKqZ,MAAMgiC,IAC1CwT,EAAOxT,OAASA,CAAM,IAExBxrD,KAAK+6H,yBAAyBnnE,EAAMlI,gBAAiBv7C,GAAKqZ,MAAMmiC,IAC9DqT,EAAOtT,gBAAkBC,CAAE,IAE7B3rD,KAAKq6H,mBAAmBzmE,EAAMnI,YAAat7C,GAAKqZ,MAAMiiC,IACpDuT,EAAOvT,YAAcA,CAAW,MAG7BuT,CACT,G,CAEc,0BAAAm7D,CACZvmE,EACAoL,EACA4iE,EACA/H,G,0CAGA,IAAIgI,EAgBJ,OAdEA,EADgB,MAAd7iE,EAAO7uD,UACkBnQ,KAAK8T,cAAcguH,gBAEzB,IAAI,QACjB9hI,KAAK2T,eAAe6L,eAAew/C,EAAO7uD,IAAK0pH,IAKzD76D,EAAO7uD,UAAYnQ,KAAK2T,eAAemK,QACrC+jH,EAAmB1xH,IACnByxH,GAIK5hI,KAAKo6H,cAAcxmE,EAAOoL,EAAQ6iE,EAC3C,G,CAEc,6BAAA5H,G,0CACZ,OACEl4E,GAAY,qCACL,OACL/hD,KAAK2jE,cAAc5f,oCAAoCq0E,KAG7D,G,EA9rCM,IADLj6E,IAAc,IAAM,oB,4HCnWhB,MAAM4jF,GASX,WAAAviI,CAAYkO,GACV1N,KAAKoG,GAAKsH,EAAStH,GACnBpG,KAAKi2B,eAAiBvoB,EAASuoB,eAC/Bj2B,KAAKwB,KAAOkM,EAASlM,KACrBxB,KAAKuvF,WAAa7hF,EAAS6hF,WAC3BvvF,KAAKmvF,SAAWzhF,EAASyhF,SACzBnvF,KAAKqvF,OAAS3hF,EAAS2hF,OACvBrvF,KAAKovF,cAAgB1hF,EAAS0hF,aAChC,CAEA,eAAOphF,CAASrF,GACd,OAAOM,OAAOH,OAAO,IAAIi5H,GAAe,IAAIvyC,GAA0B,CAAC,IAAK7mF,EAC9E,EChBK,MAAMq5H,GAWX,WAAAxiI,CAAYuG,GAVZ,KAAAK,GAAa,KACb,KAAA6vB,eAAyB,KACzB,KAAAz0B,KAAe,KACf,KAAA+tF,WAAqB,KAErB,KAAAJ,SAAoB,KACpB,KAAAC,cAAyB,KACzB,KAAAC,OAAkB,KAClB,KAAAI,SAAoB,KAGb1pF,IAIL/F,KAAKoG,GAAKL,EAAEK,GACZpG,KAAKi2B,eAAiBlwB,EAAEkwB,eACxBj2B,KAAKuvF,WAAaxpF,EAAEwpF,WAChBxpF,aAAak8H,KACfjiI,KAAKmvF,SAAWppF,EAAEopF,SAClBnvF,KAAKovF,cAAgBrpF,EAAEqpF,cACvBpvF,KAAKqvF,OAAStpF,EAAEspF,OAChBrvF,KAAKyvF,UAAW,GAEd1pF,aAAa2pF,KACf1vF,KAAKyvF,SAAW1pF,EAAE0pF,UAEtB,CAEA,YAAAyyC,CACEC,EACAC,EACAC,GAEA,GAAW,MAAPF,GAAeA,EAAI/7H,KAAOpG,KAAKi2B,eACjC,MAAM,IAAIz1B,MACR,gFAIJ,OAAI2hI,aAAG,EAAHA,EAAK9wG,sBAEL8wG,aAAG,EAAHA,EAAKzuG,kBAAkB0uG,EAAuBC,KAC9CriI,KAAKqvF,QACJrvF,KAAKyvF,WAAazvF,KAAKmvF,UAIrBgzC,aAAG,EAAHA,EAAKhvG,sBAAqB,MAAWgvG,aAAG,EAAHA,EAAKruG,6BAA8B9zB,KAAKyvF,QACtF,CAMA,OAAA6yC,CAAQH,EAAmB/uG,GACzB,GAAW,MAAP+uG,GAAeA,EAAI/7H,KAAOpG,KAAKi2B,eACjC,MAAM,IAAIz1B,MACR,gFAIJ,OAAI4yB,EAEKpzB,KAAKqvF,QAGP8yC,aAAG,EAAHA,EAAKhvG,qBAAqBC,KAAiCpzB,KAAKqvF,MACzE,CAMA,SAAAkzC,CAAUJ,EAAmB/uG,GAC3B,GAAW,MAAP+uG,GAAeA,EAAI/7H,KAAOpG,KAAKi2B,eACjC,MAAM,IAAIz1B,MACR,gFAIJ,MAAMgiI,IAA+BL,aAAG,EAAHA,EAAKhxG,kCAAmCgxG,EAAI3vG,QAEjF,OAAIY,EAEKovG,GAA+BxiI,KAAKqvF,QAI3C8yC,aAAG,EAAHA,EAAKxuG,uBAAuBP,KAC3BovG,GAA+BxiI,KAAKqvF,MAEzC,CAKA,qBAAAozC,CACEN,EACA/uG,GAEA,OAAO,CACT,CAEA,eAAOplB,CAASrF,GACd,OAAOM,OAAOH,OAAO,IAAIk5H,GAAe,IAAIC,IAAet5H,EAC7D,EC/GK,MAAMs5H,WAAmBr5G,GAS9B,WAAAppB,CAAYmJ,GACV8E,QACW,MAAP9E,GAIJ3I,KAAK6oB,iBACH7oB,KACA2I,EACA,CACEvC,GAAI,KACJ6vB,eAAgB,KAChBz0B,KAAM,KACN+tF,WAAY,KACZJ,SAAU,KACVC,cAAe,KACfC,OAAQ,MAEV,CAAC,KAAM,iBAAkB,aAAc,WAAY,gBAAiB,UAExE,CAEA,OAAA97E,CAAQmvH,GACN,OAAO1iI,KAAKmpB,WACV,IAAI64G,GAAehiI,MACnB,CACEwB,KAAM,MAERxB,KAAKi2B,eACLysG,EAEJ,EC9CK,MAAMC,GAKX,WAAAnjI,CAAYojI,EAASC,EAAqBrhI,EAAe4E,GAFzD,KAAA08H,SAA0B,GAGxB9iI,KAAK6iI,OAASA,EACd7iI,KAAK4iI,KAAOA,EACRphI,IACFxB,KAAK4iI,KAAKphI,KAAOA,GAEf4E,IACFpG,KAAK4iI,KAAKx8H,GAAKA,EAEnB,ECZK,MAAM28H,GAUX,qBAAOC,CACLC,EACAC,EACAp7H,EACAa,EACAk6H,EACAM,GAEA,GAAIr7H,EAAMrF,QAAUygI,EAClB,OAGF,MAAM7nE,EAAe6nE,IAAcp7H,EAAMrF,OAAS,EAC5C2gI,EAAmBt7H,EAAMo7H,GAE/B,IAAK,IAAIxgI,EAAI,EAAGA,EAAIugI,EAASxgI,OAAQC,IACnC,GAAIugI,EAASvgI,GAAGkgI,KAAKphI,OAAS4hI,EAG9B,OAAI/nE,GAAO4nE,EAASvgI,GAAGkgI,KAAKx8H,KAAOuC,EAAIvC,QAErC68H,EAASroH,KAAK,IAAI+nH,GAASh6H,EAAKk6H,EAAQO,SAI1CL,GAAaC,eACXC,EAASvgI,GAAGogI,SACZI,EAAY,EACZp7H,EACAa,EACAs6H,EAASvgI,GACTygI,GAMJ,GAAgE,IAA5DF,EAASvjI,QAAQgyD,GAAMA,EAAEkxE,KAAKphI,OAAS4hI,IAAU3gI,OAAc,CAEjE,GAAI44D,EAEF,YADA4nE,EAASroH,KAAK,IAAI+nH,GAASh6H,EAAKk6H,EAAQO,IAM1C,MAAMC,EAAcD,EAAWD,EAAYr7H,EAAMo7H,EAAY,GAC7DH,GAAaC,eACXC,EACA,EACA,CAACI,KAAgBv7H,EAAMlD,MAAMs+H,EAAY,IACzCv6H,EACAk6H,EACAM,E,CAGN,CAQA,wBAAOG,CACLL,EACA78H,GAEA,GAAI68H,EAASL,KAAKx8H,KAAOA,EACvB,OAAO68H,EAET,IAAK,IAAIvgI,EAAI,EAAGA,EAAIugI,EAASH,SAASrgI,OAAQC,IAC5C,GAAqC,MAAjCugI,EAASH,SAASpgI,GAAGogI,SAAkB,CACzC,MAAMF,EAAOG,GAAaO,kBAAkBL,EAASH,SAASpgI,GAAI0D,GAClE,GAAa,OAATw8H,EACF,OAAOA,C,CAIb,OAAO,IACT,CAQA,gCAAOW,CACLN,EACA78H,GAEA,IAAK,IAAI1D,EAAI,EAAGA,EAAIugI,EAASxgI,OAAQC,IAAK,CACxC,GAAIugI,EAASvgI,GAAGkgI,KAAKx8H,KAAOA,EAC1B,OAAO68H,EAASvgI,GACX,GAA4B,MAAxBugI,EAASvgI,GAAGogI,SAAkB,CACvC,MAAMF,EAAOG,GAAaQ,0BAA0BN,EAASvgI,GAAGogI,SAAU18H,GAC1E,GAAa,OAATw8H,EACF,OAAOA,C,EAIb,OAAO,IACT,E,2SC7FF,MAAMY,GAAgCztH,GAAkBpL,OACtDuO,GACA,cACA,CACEvE,aAAe8uH,GAAsC1B,GAAe/zH,SAASy1H,GAC7EztH,QAAS,CAAC,YAIR0tH,GAAgCxvH,EAAiB7R,KAIrDmhI,GAA+B,CAC/B7uH,aAAehM,GAAQA,EAAIlE,KAAKk/H,GAAe3B,GAAeh0H,SAAS21H,KACvEnvH,OAAQ,CAAOi8D,GAAqDmzD,uBAAwB,qCAC1F,MAAMpxH,EAAqB,GAC3B,IAAK,MAAMpM,KAAMqqE,QAAAA,EAAe,CAAC,EAAG,CAClC,MAAM4rB,EAAej2F,EACrBoM,EAAKoI,KAAK,IAAIqnH,GAAWxxD,EAAY4rB,I,CAEvC,aAAaunC,EAAkBC,YAAYrxH,EAC7C,MAKK,MAAMsxH,GAMX,yBAAAC,CAA0B/hE,GACxB,OAAOhiE,KAAKgkI,sBAAsB93H,MAChC,QAAKukE,GAAgBA,EAAY/wE,QAAQqG,GAAMi8D,EAAI9xB,SAASnqC,EAAEK,QAElE,CAEA,WAAA5G,CACUsU,EACA5L,EACEuU,GAFF,KAAA3I,cAAAA,EACA,KAAA5L,YAAAA,EACE,KAAAuU,cAAAA,EAEVzc,KAAKikI,6BAA+BjkI,KAAKyc,cAAc0O,UAAUq4G,IACjExjI,KAAKkkI,sBAAwBlkI,KAAKikI,6BAA6B5oH,OAAOnP,MACpE,QAAKukE,IACH,MAAM/iE,EAAyB,GAC/B,IAAK,MAAMtH,KAAMqqE,QAAAA,EAAe,CAAC,EAC/B/iE,EAASkN,KAAK,IAAIqnH,GAAWxxD,EAAYrqE,KAE3C,OAAOsH,CAAQ,KAInB1N,KAAKmkI,6BAA+BnkI,KAAKyc,cAAc2wE,WACrDptF,KAAKikI,6BAA6B5oH,OAClCqoH,GACA,CAAEE,kBAAmB5jI,OAGvBA,KAAKgkI,sBAAwBhkI,KAAKmkI,6BAA6B9oH,MACjE,CAEM,oBAAA+oH,G,gDACEpkI,KAAKmkI,6BAA6Bv2C,WAAW,KACrD,G,CAEM,OAAA9vE,CAAQ81C,G,0CACZ,GAA4B,MAAxBA,EAAM39B,eACR,MAAM,IAAIz1B,MAAM,sCAElB,MAAM2P,QAAYnQ,KAAK8T,cAAcE,UAAU4/C,EAAM39B,gBACrD,GAAW,MAAP9lB,EACF,MAAM,IAAI3P,MAAM,8CAElB,MAAMmjI,EAAa,IAAI1B,GAKvB,OAJA0B,EAAWv9H,GAAKwtD,EAAMxtD,GACtBu9H,EAAW1tG,eAAiB29B,EAAM39B,eAClC0tG,EAAWx0C,SAAWv7B,EAAMu7B,SAC5Bw0C,EAAWniI,WAAaxB,KAAK8T,cAAcgK,QAAQ81C,EAAMpyD,KAAM2O,GACxDwzH,CACT,G,CAEM,WAAAE,CAAYpzD,G,0CAChB,GAAmB,MAAfA,EACF,MAAO,GAET,MAAM4zD,EAAmC,GAEnCn3D,QAAyB,OAAeltE,KAAK8T,cAAcwwH,oBAE3Dj7G,EAA2B,GASjC,OARAonD,EAAY7oE,SAAS+7H,IACnBt6G,EAASzO,KACP+oH,EACGpwH,QAAQ25D,EAAiBy2D,EAAW1tG,iBACpCzM,MAAMzjB,GAAMs+H,EAAezpH,KAAK7U,KACpC,UAEG6F,QAAQ+d,IAAIN,GACXg7G,EAAejnG,KAAK,EAAMn1B,gBAAgBjI,KAAKkI,YAAa,QACrE,G,CAEM,GAAA+R,CAAI7T,G,gDACR,OAGI,QAFD,QAAM,OACLpG,KAAKkkI,sBAAsBh4H,MAAK,QAAKq4H,GAAOA,EAAGruG,MAAMnwB,GAAMA,EAAEK,KAAOA,eACpE,QAAI,I,IAIJ,MAAAuwB,G,0CACJ,aAAa,OAAe32B,KAAKkkI,sBACnC,G,CAEM,eAAAjiE,G,0CACJ,aAAa,OAAejiE,KAAKgkI,sBACnC,G,CAEM,YAAAQ,CAAa/zD,EAAgC,M,0CAC9B,MAAfA,IACFA,QAAoBzwE,KAAKiiE,mBAE3B,MAAMwiE,EAAoC,GAQ1C,OAPAh0D,EAAY7oE,SAAS7B,IACnB,MAAM2+H,EAAiB,IAAI1C,GAC3B0C,EAAet+H,GAAKL,EAAEK,GACtBs+H,EAAezuG,eAAiBlwB,EAAEkwB,eAClC,MAAMnuB,EAAkB,MAAV/B,EAAEvE,KAAeuE,EAAEvE,KAAK0C,QAAQ,aAAc,IAAIyD,MAxG7C,KAwGuE,GAC1Fo7H,GAAaC,eAAeyB,EAAO,EAAG38H,EAAO48H,EAAgB,KAzG1C,IAyGiE,IAE/ED,CACT,G,CAMM,SAAAE,CAAUv+H,G,0CACd,MAAMqqE,QAAoBzwE,KAAKwkI,eAC/B,OAAOzB,GAAaQ,0BAA0B9yD,EAAarqE,EAC7D,G,CAEM,MAAAywB,CAAO+tG,G,0CACK,MAAZA,UAGE5kI,KAAKikI,6BAA6BvpH,QAAQ+1D,IAC3B,MAAfA,IACFA,EAAc,CAAC,GAEblsE,MAAMyQ,QAAQ4vH,GAChBA,EAASh9H,SAAS7B,IAChB0qE,EAAY1qE,EAAEK,IAAML,CAAC,IAGvB0qE,EAAYm0D,EAASx+H,IAAMw+H,EAEtBn0D,KAEX,G,CAEM,OAAAvsE,CAAQusE,G,gDACNzwE,KAAKikI,6BAA6BvpH,QAAO,IAAM+1D,GACvD,G,CAEM,KAAAzb,CAAM7+C,G,0CACI,MAAVA,SACInW,KAAKikI,6BAA6BvpH,QAAO,IAAM,aAC/C1a,KAAKmkI,6BAA6Bv2C,WAAW,aAE7C5tF,KAAKyc,cAAc8O,QAAQpV,EAAQqtH,IAA+B9oH,QAAO,IAAM,MAEzF,G,CAEM,OAAOtU,G,gDACLpG,KAAKikI,6BAA6BvpH,QAAQ+1D,IAC3B,MAAfA,IACFA,EAAc,CAAC,GAEC,iBAAPrqE,SACFqqE,EAAYrqE,GAElBA,EAAsBwB,SAASlF,WACvB+tE,EAAY/tE,EAAE,IAGlB+tE,IAEX,G,6SCpMK,MAAMo0D,GACX,WAAArlI,CACUysB,EACA8kG,GADA,KAAA9kG,WAAAA,EACA,KAAA8kG,kBAAAA,CACP,CAEG,MAAApqD,CACJ3H,EACAu/D,EACAG,EACAT,EACAO,G,0CAEA,MAAM5lG,EAA6B,CACjCzoB,IAAKquH,EAAW,GAAGxrH,gBACnBo0C,SAAUm3E,EAAYvrH,gBACtB64C,SAAU6yE,EAAQl7H,OAAOG,WACzBmhI,aAAc7G,GAGhB,IAAIvwH,EACJ,IACE,MAAMukH,QAA2BjyH,KAAKisB,WAAWw4E,qBAAqBzlC,EAAO54D,GAAIwyB,GACjFlrB,EAAWuwH,EAAQhM,EAAmB50B,mBAAqB40B,EAAmB70B,qBACxEp9F,KAAK+wH,kBAAkBpqD,OAC3BsrD,EACAsM,EACAG,EACA1+H,KAAKkyH,gBAAgBD,EAAoBvkH,EAAUkrB,EAAQksG,c,CAE7D,MAAOj6H,GACP,KACGA,aAAa,IAAqD,MAAnCA,EAAoB6W,YAChB,MAAnC7W,EAAoB6W,YAShB,MAAI7W,aAAa,GAChB,IAAIrK,MAAOqK,EAAoB8W,oBAE/B9W,EAVN6C,QAAiB1N,KAAK+kI,iCACpBnsG,EAAQksG,aACR9lE,EAAO54D,GACPm4H,EACAG,EACAF,EAAW,G,CAQjB,OAAO9wH,CACT,G,CAEQ,eAAAwkH,CACNloD,EACAt8D,EACA8kB,GAEA,MAAO,CACL43C,WAAYpqE,KAAKoyH,2BAA2BpoD,EAAYx3C,GACxD83C,mBAAoBtqE,KAAKqyH,mCAAmCroD,EAAYt8D,EAAU8kB,GAClF+3C,SAAUvqE,KAAKsyH,yBAAyB5kH,EAAUs8D,EAAYx3C,GAElE,CAEQ,0BAAA4/F,CAA2BpoD,EAA0Cx3C,GAC3E,OAAQhgB,IACN,MAAM9E,EAAW8kB,EAAUw3C,EAAWqzB,mBAAqBrzB,EAAWozB,eACtE,OAAOp9F,KAAKisB,WAAW+4E,mBAAmBt3F,EAAStH,GAAI4jE,EAAWmzB,aAAc3qF,EAAK,CAEzF,CAEQ,kCAAA6/G,CACNroD,EACAt8D,EACA8kB,GAEA,MAAO,IAAY,mCACjB,MAAM+/F,QAAsBvyH,KAAKisB,WAAW84E,yBAC1Cr3F,EAAStH,GACT4jE,EAAWmzB,cAEb,OAAOo1B,aAAa,EAAbA,EAAetrH,GACxB,GACF,CAEQ,wBAAAqrH,CACN5kH,EACAs8D,EACAx3C,GAEA,MAAO,IACDA,EACKxyB,KAAKisB,WAAW44E,4BAA4Bn3F,EAAStH,GAAI4jE,EAAWmzB,cAEpEn9F,KAAKisB,WAAW24E,uBAAuBl3F,EAAStH,GAAI4jE,EAAWmzB,aAG5E,CAMM,gCAAA4nC,CACJ9G,EACAt+D,EACA4+D,EACAG,EACAvuH,G,0CAEA,MAAMo5D,EAAK,IAAIC,SACf,IACE,MAAMC,EAAO,IAAIC,KAAK,CAACg1D,EAAQl7H,QAAS,CAAE8J,KAAM,6BAChDi8D,EAAGpB,OAAO,MAAOh4D,EAAI6C,iBACrBu2D,EAAGpB,OAAO,OAAQsB,EAAM80D,EAAYvrH,gB,CACpC,MAAOnI,GACP,IAAI,EAAMxJ,QAAW,EAAMI,UAWzB,MAAMoJ,EAVN0+D,EAAGpB,OAAO,MAAOh4D,EAAI6C,iBACrBu2D,EAAGpB,OACD,OACA/lE,OAAOC,KAAKq8H,EAAQl7H,QACpB,CACEmmE,SAAU40D,EAAYvrH,gBACtB42D,YAAa,4B,CAQrB,IAAIl8D,EACJ,IAEIA,EADEuwH,QACej+H,KAAKisB,WAAW04E,gCAAgChlC,EAAU4J,SAE1DvpE,KAAKisB,WAAWy4E,2BAA2B/kC,EAAU4J,E,CAExE,MAAO1+D,GACP,MAAM,IAAIrK,MAAOqK,EAAoB8W,mB,CAGvC,OAAOjU,CACT,G,EC1JK,MAAMs3H,GAKX,WAAAxlI,CAAYkO,GACV1N,KAAKwB,KAAOkM,aAAQ,EAARA,EAAUlM,KACtBxB,KAAKoG,GAAKsH,aAAQ,EAARA,EAAUtH,GACpBpG,KAAKukC,aAAe72B,aAAQ,EAARA,EAAU62B,YAChC,CAEA,eAAOv2B,CAASrF,GACd,OAAOM,OAAOH,OAAO,IAAIk8H,GAAW,CAAC,GAAIr8H,EAC3C,ECfK,MAAMs8H,GAGX,WAAAzlI,CAAYw8H,GACVh8H,KAAKwB,KAAOw6H,EAAOx6H,KAAOw6H,EAAOx6H,KAAKwR,gBAAkB,IAC1D,E,2SCCK,MAAMkyH,GACX,WAAA1lI,CACU2lI,EACAl5G,GADA,KAAAk5G,cAAAA,EACA,KAAAl5G,WAAAA,CACP,CAEG,IAAAgQ,CAAK+/F,G,0CACT,MAAMpjG,EAAU,IAAIqsG,GAAcjJ,GAElC,IAAItuH,EACa,MAAbsuH,EAAO51H,IACTsH,QAAiB1N,KAAKolI,WAAWxsG,GACjCojG,EAAO51H,GAAKsH,EAAStH,IAErBsH,QAAiB1N,KAAKqlI,UAAUrJ,EAAO51H,GAAIwyB,GAG7C,MAAMpmB,EAAO,IAAIwyH,GAAWt3H,SACtB1N,KAAKmlI,cAActuG,OAAOrkB,EAClC,G,CAEM,OAAOpM,G,gDACLpG,KAAKslI,aAAal/H,SAClBpG,KAAKmlI,cAAcvmF,OAAOx4C,EAClC,G,CAEM,GAAA6T,CAAI7T,G,0CACR,MAAMJ,QAAUhG,KAAKisB,WAAWiM,KAAK,MAAO,YAAc9xB,EAAI,MAAM,GAAM,GAC1E,OAAO,IAAIg4F,GAAep4F,EAC5B,G,CAEc,UAAAo/H,CAAWxsG,G,0CACvB,MAAM5yB,QAAUhG,KAAKisB,WAAWiM,KAAK,OAAQ,WAAYU,GAAS,GAAM,GACxE,OAAO,IAAIwlE,GAAep4F,EAC5B,G,CAEM,SAAAq/H,CAAUj/H,EAAYwyB,G,0CAC1B,MAAM5yB,QAAUhG,KAAKisB,WAAWiM,KAAK,MAAO,YAAc9xB,EAAIwyB,GAAS,GAAM,GAC7E,OAAO,IAAIwlE,GAAep4F,EAC5B,G,CAEQ,YAAAs/H,CAAal/H,GACnB,OAAOpG,KAAKisB,WAAWiM,KAAK,SAAU,YAAc9xB,EAAI,MAAM,GAAM,EACtE,EC7CK,MAAMm/H,GAKX,WAAA/lI,CAAYy5B,GAJZ,KAAA7yB,GAAa,KACb,KAAA5E,KAAe,KACf,KAAA+iC,aAAqB,KAGdtL,IAILj5B,KAAKoG,GAAK6yB,EAAE7yB,GACZpG,KAAKukC,aAAetL,EAAEsL,aACxB,CAEA,eAAOv2B,CAASrF,GACd,MAAM47B,EAAmC,MAApB57B,EAAI47B,aAAuB,KAAO,IAAI/3B,KAAK7D,EAAI47B,cACpE,OAAOt7B,OAAOH,OAAO,IAAIy8H,GAAc58H,EAAK,CAAE47B,gBAChD,EChBK,MAAMihG,WAAe58G,GAK1B,WAAAppB,CAAYmJ,GACV8E,QACW,MAAP9E,IAIJ3I,KAAK6oB,iBACH7oB,KACA2I,EACA,CACEvC,GAAI,KACJ5E,KAAM,MAER,CAAC,OAGHxB,KAAKukC,aAAmC,MAApB57B,EAAI47B,aAAuB,IAAI/3B,KAAK7D,EAAI47B,cAAgB,KAC9E,CAEA,OAAAhxB,GACE,OAAOvT,KAAKmpB,WACV,IAAIo8G,GAAWvlI,MACf,CACEwB,KAAM,MAER,KAEJ,CAEA,eAAOwM,CAASrF,GACd,MAAM47B,EAAmC,MAApB57B,EAAI47B,aAAuB,KAAO,IAAI/3B,KAAK7D,EAAI47B,cACpE,OAAOt7B,OAAOH,OAAO,IAAI08H,GAAU78H,EAAK,CAAEnH,KAAM8Q,EAAUtE,SAASrF,EAAInH,MAAO+iC,gBAChF,E,2SCnCK,MAAMkhG,GAA2B1vH,GAAkBpL,OACxDwO,GACA,UACA,CACExE,aAAehM,GAA6Bq8H,GAAWh3H,SAASrF,GAChEqN,QAAS,CAAC,YAID0vH,GAA2BxxH,EAAiB7R,KAIvDojI,GAA0B,CAC1B9wH,aAAehM,GAAQA,EAAIlE,KAAKw0B,GAAMssG,GAAWv3H,SAASirB,KAC1DzkB,OAAQ,CAAOnS,GAAQ8iI,gBAAerxH,mBAAoB,qCACxD,MAAM+6D,EAAU5lE,OAAOmuB,OAAO/0B,GAAQ,CAAC,GAAGoC,KAAKw0B,GAAM,IAAIusG,GAAOvsG,KAEhE,aAAUnlB,EAAcwsG,oBACT6kB,EAAcQ,eAAe92D,GAEnC,EAEX,M,2SChBK,MAAM+2D,GAOX,WAAApmI,CACUsU,EACA5L,EACAs1D,EACA/gD,GAHA,KAAA3I,cAAAA,EACA,KAAA5L,YAAAA,EACA,KAAAs1D,cAAAA,EACA,KAAA/gD,cAAAA,EAERzc,KAAK6lI,sBAAwB7lI,KAAKyc,cAAc0O,UAAUs6G,IAC1DzlI,KAAK8lI,sBAAwB9lI,KAAKyc,cAAc2wE,WAC9CptF,KAAK6lI,sBAAsBxqH,OAC3BqqH,GACA,CAAEP,cAAenlI,KAAM8T,cAAe9T,KAAK8T,gBAG7C9T,KAAK+lI,SAAW/lI,KAAK6lI,sBAAsBxqH,OAAOnP,MAChD,QAAK85H,GAAe/8H,OAAOmuB,OAAO4uG,GAAYvhI,KAAKw0B,GAAM,IAAIusG,GAAOvsG,QAGtEj5B,KAAKimI,aAAejmI,KAAK8lI,sBAAsBzqH,MACjD,CAEM,UAAAq+G,G,gDACE15H,KAAK8lI,sBAAsBl4C,WAAW,GAC9C,G,CAGM,OAAA9vE,CAAQ81C,EAAmBzjD,G,0CAC/B,MAAM6rH,EAAS,IAAIwJ,GAGnB,OAFAxJ,EAAO51H,GAAKwtD,EAAMxtD,GAClB41H,EAAOx6H,WAAaxB,KAAK8T,cAAcgK,QAAQ81C,EAAMpyD,KAAM2O,GACpD6rH,CACT,G,CAEM,GAAA/hH,CAAI7T,G,0CAGR,aAFsB,OAAepG,KAAK+lI,WAE3B7vG,MAAM8lG,GAAWA,EAAO51H,KAAOA,GAChD,G,CAEM,eAAA8/H,G,0CACJ,aAAa,OAAelmI,KAAK+lI,SACnC,G,CAMM,YAAA7uG,CAAa9wB,G,0CACjB,MAAM41H,QAAeh8H,KAAKia,IAAI7T,GAC9B,OAAK41H,GACI,IAIX,G,CAKM,wBAAAjH,G,0CACJ,aAAa,OAAe/0H,KAAKimI,aACnC,G,CAEM,MAAApvG,CAAOmvG,G,gDACLhmI,KAAK6lI,sBAAsBnrH,QAAQm0D,IAKvC,GAJe,MAAXA,IACFA,EAAU,CAAC,GAGTm3D,aAAsBhB,GAAY,CACpC,MAAM/rG,EAAI+sG,EACVn3D,EAAQ51C,EAAE7yB,IAAM6yB,C,MAEf+sG,EAA4Bp+H,SAASqxB,IACpC41C,EAAQ51C,EAAE7yB,IAAM6yB,CAAC,IAIrB,OAAO41C,CAAO,GAElB,G,CAEM,OAAA3qE,CAAQ2qE,G,0CACPA,UAIC7uE,KAAK6lI,sBAAsBnrH,QAAO,IACtB,iBAAoCm0D,KAGxD,G,CAEM,KAAA7Z,CAAM7+C,G,0CACI,MAAVA,SACInW,KAAK6lI,sBAAsBnrH,QAAO,KAAM,CAAG,WAC3C1a,KAAK8lI,sBAAsBl4C,WAAW,WAEtC5tF,KAAKyc,cAAc8O,QAAQpV,EAAQsvH,IAA0B/qH,QAAO,KAAM,CAAG,IAEvF,G,CAEM,OAAOtU,G,gDACLpG,KAAK6lI,sBAAsBnrH,QAAQm0D,IACvC,GAAe,MAAXA,EAAJ,CAIA,GAAkB,iBAAPzoE,EAAiB,CAC1B,GAAmB,MAAfyoE,EAAQzoE,GACV,cAEKyoE,EAAQzoE,E,MAEdA,EAAgBwB,SAASlF,WACjBmsE,EAAQnsE,EAAE,IAGrB,OAAOmsE,C,CAAO,IAIhB,MAAM8L,QAAgB36E,KAAKw9D,cAAc7mC,SACzC,GAAe,MAAXgkD,EAAiB,CACnB,MAAMwrD,EAAoB,GAC1B,IAAK,MAAMC,KAAOzrD,EACZA,EAAQyrD,GAAK37E,WAAarkD,IAC5Bu0E,EAAQyrD,GAAK37E,SAAW,KACxB07E,EAAQvrH,KAAK+/D,EAAQyrD,KAGrBD,EAAQ1jI,OAAS,GAGnBzC,KAAKw9D,cAAc3mC,OAAOsvG,EAAQ1hI,KAAKsB,GAAMA,EAAEouD,iB,CAGrD,G,CAEM,cAAAwxE,CAAe92D,G,0CACnB,MAAMw3D,EAAwBx3D,EAAQpqE,KAAKw0B,GAAMA,EAAE1lB,YAC7C+yH,QAAyB16H,QAAQ+d,IAAI08G,GAE3CC,EAAiBlpG,KAAK,EAAMn1B,gBAAgBjI,KAAKkI,YAAa,SAE9D,MAAMq+H,EAAa,IAAIhB,GAGvB,OAFAgB,EAAW/kI,KAAOxB,KAAKkI,YAAYovB,EAAE,cACrCgvG,EAAiB1rH,KAAK2rH,GACfD,CACT,G,EClKK,MAAME,GAAb,cACU,KAAAC,MAAQ,IAAIt6G,EAAA,EAEpB,KAAAu6G,MAAQ1mI,KAAKymI,MAAMp6G,cAKrB,CAHE,IAAAwC,CAAK1T,GACHnb,KAAKymI,MAAM53G,KAAK1T,EAClB,ECbK,MAAMwrH,GAUX,WAAAnnI,CAAYkO,GACV1N,KAAKoG,GAAKsH,EAAStH,GACnBpG,KAAKwB,KAAOkM,EAASlM,KACrBxB,KAAKkhB,OAASxT,EAASwT,OACvBlhB,KAAKsN,KAAOI,EAASJ,KACrBtN,KAAK+uB,QAAUrhB,EAASqhB,QACxB/uB,KAAKmW,OAASzI,EAASyI,OACvBnW,KAAKmvB,UAAYzhB,EAASyhB,UAC1BnvB,KAAKq7B,eAAiB3tB,EAAS2tB,cACjC,E,2SCMK,MAAeurG,GAGpB,WAAApnI,CACqBkd,EACAyoH,EACA0B,EACAnoG,EACAniB,EACAihD,EACAomE,EACA33G,EACA9P,EACAynD,EACAotD,EACA8V,GAXA,KAAApqH,aAAAA,EACA,KAAAyoH,cAAAA,EACA,KAAA0B,iBAAAA,EACA,KAAAnoG,cAAAA,EACA,KAAAniB,WAAAA,EACA,KAAAihD,cAAAA,EACA,KAAAomE,kBAAAA,EACA,KAAA33G,WAAAA,EACA,KAAA9P,eAAAA,EACA,KAAAynD,YAAAA,EACA,KAAAotD,YAAAA,EACA,KAAA8V,eAAAA,EAdrB,KAAAC,gBAAiB,CAed,CAIG,WAAAC,G,0CACJ,GAA6C,aAAlChnI,KAAK0c,aAAagzB,aAC3B,OAAO,KAGT,MAAMs/B,QAAiBhvE,KAAK0c,aAAasqH,cACzC,OAAIh4D,EACK,IAAIxiE,KAAKwiE,GAGX,IACT,G,CAEM,WAAAi4D,CAAY73F,EAAYj5B,G,gDACtBnW,KAAK0c,aAAauqH,YAAY73F,EAAK1+B,SAAU,CAAEyF,OAAQA,GAC/D,G,CAEM,gBAAAi8F,CAAiBxjF,EAAsCs4G,G,0CAE3D,GADAlnI,KAAKmnI,oBACKnnI,KAAK0c,aAAao1F,qBAC1B,IACE,MAAMs1B,QAAoBpnI,KAAKmlI,cAAclrH,IAAI2U,EAAaxoB,IAC9D,IACI8gI,GAAyB,MAAfE,GACXF,GAAyB,MAAfE,GAAuBA,EAAY7iG,aAAe3V,EAAa2V,aAC1E,CACA,MAAM8iG,QAAqBrnI,KAAK6mI,iBAAiB5sH,IAAI2U,EAAaxoB,IAClE,GAAoB,MAAhBihI,EAGF,aAFMrnI,KAAKmlI,cAActuG,OAAO,IAAImuG,GAAWqC,IAC/CrnI,KAAK0+B,cAAcxG,KAAK,uBAAwB,CAAEuyB,SAAU77B,EAAaxoB,KAClEpG,KAAKsnI,eAAc,E,EAG9B,MAAOz8H,GACP7K,KAAKuc,WAAWhc,MAAMsK,E,CAG1B,OAAO7K,KAAKsnI,eAAc,EAC5B,G,CAEM,gBAAAj1B,CAAiBzjF,G,0CAErB,OADA5uB,KAAKmnI,qBACKnnI,KAAK0c,aAAao1F,6BACpB9xG,KAAKmlI,cAAcvmF,OAAOhwB,EAAaxoB,IAC7CpG,KAAK0+B,cAAcxG,KAAK,sBAAuB,CAAEuyB,SAAU77B,EAAaxoB,KACxEpG,KAAKsnI,eAAc,IACZ,GAEFtnI,KAAKsnI,eAAc,EAC5B,G,CAEM,gBAAAp1B,CAAiBtjF,EAAsCs4G,G,0CAE3D,GADAlnI,KAAKmnI,oBACKnnI,KAAK0c,aAAao1F,qBAC1B,IACE,IAAIj3F,GAAe,EACnB,MAAM0sH,QAAoBvnI,KAAKw9D,cAAcvjD,IAAI2U,EAAaxoB,IAC3C,MAAfmhI,GAAuBA,EAAYhjG,cAAgB3V,EAAa2V,eAClE1pB,GAAe,GAGjB,IAAI2sH,GAAmB,EAevB,GAdI3sH,IACEqsH,GACFrsH,EAA8B,MAAf0sH,EACfC,GAAmB,GAEe,MAA9B54G,EAAa47B,eAAwD,MAA/B57B,EAAaqH,eACrDpb,EAA8B,MAAf0sH,GAEf1sH,GAAe,EACf2sH,GAAmB,KAMtB3sH,GACD2sH,GAC+B,MAA/B54G,EAAaqH,gBACiB,MAA9BrH,EAAa47B,eACb57B,EAAa47B,cAAc/nD,OAAS,EACpC,CACA,MAAMguE,QAAoBzwE,KAAK4jI,kBAAkBjtG,SACjD,GAAmB,MAAf85C,EACF,IAAK,IAAI/tE,EAAI,EAAGA,EAAI+tE,EAAYhuE,OAAQC,IACtC,GAAIksB,EAAa47B,cAAc3jD,QAAQ4pE,EAAY/tE,GAAG0D,KAAO,EAAG,CAC9DyU,GAAe,EACf,K,EAMR,GAAIA,EAAc,CAChB,MAAM4sH,QAAqBznI,KAAKisB,WAAW22E,qBAAqBh0E,EAAaxoB,IAC7E,GAAoB,MAAhBqhI,EAGF,aAFMznI,KAAKw9D,cAAc3mC,OAAO,IAAI0zB,GAAWk9E,IAC/CznI,KAAK0+B,cAAcxG,KAAK,uBAAwB,CAAEynC,SAAU/wC,EAAaxoB,KAClEpG,KAAKsnI,eAAc,E,EAG9B,MAAOz8H,GACP,GAAS,MAALA,GAA8B,MAAjBA,EAAE6W,YAAsBwlH,EAGvC,aAFMlnI,KAAKw9D,cAAc5e,OAAOhwB,EAAaxoB,IAC7CpG,KAAK0+B,cAAcxG,KAAK,sBAAuB,CAAEynC,SAAU/wC,EAAaxoB,KACjEpG,KAAKsnI,eAAc,E,CAIhC,OAAOtnI,KAAKsnI,eAAc,EAC5B,G,CAEM,gBAAAn1B,CAAiBvjF,G,0CAErB,OADA5uB,KAAKmnI,qBACKnnI,KAAK0c,aAAao1F,6BACpB9xG,KAAKw9D,cAAc5e,OAAOhwB,EAAaxoB,IAC7CpG,KAAK0+B,cAAcxG,KAAK,sBAAuB,CAAEynC,SAAU/wC,EAAaxoB,KACjEpG,KAAKsnI,eAAc,IAErBtnI,KAAKsnI,eAAc,EAC5B,G,CAEM,cAAAh1B,CAAe1jF,EAAoCs4G,G,0CACvDlnI,KAAKmnI,cACL,MAAO3rF,EAAct6B,SAAgB,OACnClhB,KAAKmc,eAAe6Q,eAAe9gB,MACjC,EAAAC,EAAA,IAAW/D,IACA,MAALA,IACF,EAAA6D,EAAAA,IAAG,CAAC,KAAMiwB,GAAqBsD,YAE1Bx/B,KAAK4jE,YAAY9kC,eAAe12B,EAAEhC,IAAI8F,MAAK,QAAKzC,GAAM,CAACrB,EAAEhC,GAAIqD,WAM1E,GAAI+xC,IAAiB5sB,EAAazY,QAAU+K,IAAWgb,GAAqBsD,UAC1E,IACE,MAAMkoG,QAAkB,OAAe1nI,KAAKgxH,YAAYv6F,KAAK7H,EAAaxoB,KAC1E,IACI8gI,GAAuB,MAAbQ,GACXR,GAAuB,MAAbQ,GAAqBA,EAAUnjG,aAAe3V,EAAa2V,aACtE,CACA,MAAMojG,QAAmB3nI,KAAK8mI,eAAe7V,QAAQriG,EAAaxoB,IAClE,GAAkB,MAAduhI,EAGF,aAFM3nI,KAAKgxH,YAAYn6F,OAAO,IAAIw5F,GAASsX,IAC3C3nI,KAAK0+B,cAAcxG,KAAK,qBAAsB,CAAEs5F,OAAQ5iG,EAAaxoB,KAC9DpG,KAAKsnI,eAAc,E,EAG9B,MAAOz8H,GACP7K,KAAKuc,WAAWhc,MAAMsK,E,CAG1B,OAAO7K,KAAKsnI,eAAc,EAC5B,G,CAEM,cAAA/0B,CAAe3jF,G,0CAEnB,OADA5uB,KAAKmnI,qBACKnnI,KAAK0c,aAAao1F,6BACpB9xG,KAAKgxH,YAAYpyE,OAAOhwB,EAAaxoB,IAC3CpG,KAAK0+B,cAAcxG,KAAK,oBAAqB,CAAEs5F,OAAQ5iG,EAAaxoB,KACpEpG,KAAKsnI,eAAc,IACZ,GAEFtnI,KAAKsnI,eAAc,EAC5B,G,CAIU,WAAAH,GACRnnI,KAAK+mI,gBAAiB,EACtB/mI,KAAK0+B,cAAcxG,KAAK,cAC1B,CAEU,aAAAovG,CAAcM,GAGtB,OAFA5nI,KAAK+mI,gBAAiB,EACtB/mI,KAAK0+B,cAAcxG,KAAK,gBAAiB,CAAE0vG,aAAcA,IAClDA,CACT,E,kuBCtLK,MAAMC,WAAoBjB,GAC/B,WAAApnI,CACUgd,EACRL,EACA8P,EACQ63C,EACRqhE,EACA3nE,EACQ1pD,EACR8vH,EACAllG,EACQ1G,EACRg5F,EACAz0G,EACQurH,EACRprH,EACQqrH,EACRlB,EACQxtG,EACRytG,EACQ/lG,EACAinG,EACAxiG,EACAyiG,EACAtpG,EACRilC,GAEAn2D,MACEiP,EACAyoH,EACA0B,EACAnoG,EACAniB,EACAihD,EACAomE,EACA33G,EACA9P,EACAynD,EACAotD,EACA8V,GArCM,KAAAtqH,sBAAAA,EAGA,KAAAsnD,sBAAAA,EAGA,KAAAhwD,cAAAA,EAGA,KAAAkkB,cAAAA,EAGA,KAAA8vG,oBAAAA,EAEA,KAAAC,gBAAAA,EAEA,KAAA1uG,oBAAAA,EAEA,KAAA0H,6BAAAA,EACA,KAAAinG,cAAAA,EACA,KAAAxiG,eAAAA,EACA,KAAAyiG,kCAAAA,EACA,KAAAtpG,aAAAA,CAiBV,CAGe,QAAA+/B,CAASwpE,EAAoBC,GAAoB,G,0CAC9DnoI,KAAKmnI,cAEL,WAD8BnnI,KAAK0c,aAAao1F,sBAE9C,OAAO9xG,KAAKsnI,eAAc,GAG5B,MAAM76H,EAAM,IAAID,KAChB,IAAI47H,GAAY,EAChB,IACEA,QAAkBpoI,KAAKqoI,aAAaH,E,CACpC,MAAOr9H,GACP,GAAIs9H,EAEF,MADAnoI,KAAKsnI,eAAc,GACbz8H,C,CAIV,IAAKu9H,EAEH,aADMpoI,KAAKinI,YAAYx6H,GAChBzM,KAAKsnI,eAAc,GAG5B,UACQtnI,KAAKisB,WAAW8zE,uBACtB,MAAMryF,QAAiB1N,KAAKisB,WAAWk6E,UAWvC,aATMnmG,KAAKsoI,YAAY56H,EAAS6a,eAC1BvoB,KAAKuoI,YAAY76H,EAASmhE,eAC1B7uE,KAAKwoI,gBAAgB96H,EAAS+iE,mBAC9BzwE,KAAKyoI,YAAY/6H,EAASitE,eAC1B36E,KAAK0oI,UAAUh7H,EAASisE,aACxB35E,KAAK2oI,aAAaj7H,EAASsuF,eAC3Bh8F,KAAK4oI,aAAal7H,EAASisB,gBAE3B35B,KAAKinI,YAAYx6H,GAChBzM,KAAKsnI,eAAc,E,CAC1B,MAAOz8H,GACP,GAAIs9H,EAEF,MADAnoI,KAAKsnI,eAAc,GACbz8H,EAEN,OAAO7K,KAAKsnI,eAAc,E,CAGhC,G,CAEc,YAAAe,CAAaH,G,0CACzB,GAAIA,EACF,OAAO,EAGT,MAAMl5D,QAAiBhvE,KAAKgnI,cAC5B,GAAgB,MAAZh4D,GAA2C,IAAvBA,EAASziE,UAC/B,OAAO,EAGT,MAAMmB,QAAiB1N,KAAKisB,WAAWo1E,yBAMvC,OALI3zF,EAAW,GAAK1N,KAAKwlC,uBAEjBxlC,KAAKwlC,eAAe,qBAGxB,IAAIh5B,KAAKkB,IAAashE,EAI5B,G,CAEc,WAAAs5D,CAAY56H,G,0CACxB,MAAMm7H,QAAc7oI,KAAK2+B,aAAawR,iBAAiBziC,EAAStH,IAChE,GAAa,MAATyiI,GAAiBA,IAAUn7H,EAASk9B,cAKtC,MAJ2B,MAAvB5qC,KAAKwlC,uBACDxlC,KAAKwlC,eAAe,yBAGtB,IAAIhlC,MAAM,2BAGZR,KAAK8T,cAAcmzB,6BAA6Bv5B,EAASyC,WACzDnQ,KAAK8T,cAAcg1H,cAAcp7H,EAASqY,WAAYrY,EAAStH,UAC/DpG,KAAK8T,cAAci1H,gBAAgBr7H,EAASiuB,UAAWjuB,EAAStH,UAChEpG,KAAK8T,cAAck1H,WACvBt7H,EAASupB,cACTvpB,EAASgoF,sBACThoF,EAAStH,UAELpG,KAAKgoI,cAAc7nG,mBAAmBzyB,EAAStH,GAAIsH,EAASmyB,mBAC5D7/B,KAAK2+B,aAAayR,iBAAiB1iC,EAASk9B,cAAel9B,EAAStH,UACpEpG,KAAKmc,eAAe4hB,wBAAwBrwB,EAAStH,GAAIsH,EAASgvB,qBAElE18B,KAAKioI,kCAAkC7uF,cAC3C1rC,EAASkoF,kBACTloF,EAASmoF,+BAEL71F,KAAK8nI,oBAAoBniG,oBAAoBj4B,EAAS03B,wBAEtDplC,KAAKipI,kCAAkCv7H,GAE7C,MAAMiuB,EAA4C,CAAC,EACnDjuB,EAASiuB,UAAU/zB,SAAS2hB,IAC1BoS,EAAUpS,EAAEnjB,IAAM,IAAIugI,GAAap9G,EAAE,UAGjCvpB,KAAK+nI,gBAAgB9rG,KAAKN,SAE1B37B,KAAKkpI,yBAAyBx7H,UAE1B1N,KAAK8nI,oBAAoBjiG,6BAC3B7lC,KAAK8nI,oBAAoBxgG,2BAA0B,GACzDtnC,KAAK0+B,cAAcxG,KAAK,iCAIxBl4B,KAAK8nI,oBAAoBtgG,8BAE7B,G,CAEc,iCAAAyhG,CAAkCE,G,gDAE1CA,EAAgB/iH,2BACZpmB,KAAKwc,sBAAsB2rB,0BAC/B,GAAuBihG,wBACvBD,EAAgB/iI,KAIpB,MAAM4L,QAA8B,OAClChS,KAAK+gC,6BAA6BzV,2BAA2B69G,EAAgB/iI,KAG3E4L,SACFhS,KAAKuc,WAAWhc,MAAM,2DAMxB,IAAIuR,GAAmC,EACvC,IAAK,MAAMqwH,KAAOgH,EAAgBlyG,cAAe,CAC/C,MAAMzE,EAAU2vG,EAAI70H,OAASqkB,GAAqBc,MAC5CL,EAAU+vG,EAAI70H,OAASqkB,GAAqBe,MAGlD,GAAIF,GAAWJ,GAAY+vG,EAAI9xG,aAAe8xG,EAAI9xG,YAAY0E,oBAAsB,CAClFjjB,GAAmC,EACnC,K,EAIJ,QACgDlJ,IAA9CoJ,EAAsBG,sBACrBH,EAAsBE,mBACvBJ,EACA,CAGA,MAAMqE,EAAmE,QAAzD,QAAM,OAAenW,KAAKmc,eAAe6Q,uBAAgB,eAAE5mB,SACrEpG,KAAKwc,sBAAsB2rB,0BAC/B,GAAuBkhG,iDACvBlzH,E,KAKQ,wBAAA+yH,CAAyBx7H,G,0CACrC,MAAMupB,EAAoD,CAAC,EAC3DvpB,EAASupB,cAAcrvB,SAASuuB,IAC9Bc,EAAcd,EAAE/vB,IAAM,IAAI0oB,GAAiBqH,EAAG,CAC5C7E,UAAU,EACVC,gBAAgB,GAChB,IAGJ7jB,EAASgoF,sBAAsB9tF,SAASuuB,IACX,MAAvBc,EAAcd,EAAE/vB,IAClB6wB,EAAcd,EAAE/vB,IAAM,IAAI0oB,GAAiBqH,EAAG,CAC5C7E,UAAU,EACVC,gBAAgB,IAGlB0F,EAAcd,EAAE/vB,IAAImrB,gBAAiB,C,UAInCvxB,KAAKq5B,oBAAoBn1B,QAAQ+yB,EACzC,G,CAEc,WAAAsxG,CAAY76H,G,0CACxB,MAAMmhE,EAAwC,CAAC,EAI/C,OAHAnhE,EAAS9F,SAASqxB,IAChB41C,EAAQ51C,EAAE7yB,IAAM,IAAI4+H,GAAW/rG,EAAE,UAEtBj5B,KAAKmlI,cAAcjhI,QAAQ2qE,EAC1C,G,CAEc,eAAA25D,CAAgB96H,G,0CAC5B,MAAM+iE,EAAgD,CAAC,EAIvD,OAHA/iE,EAAS9F,SAAS7B,IAChB0qE,EAAY1qE,EAAEK,IAAM,IAAI27H,GAAeh8H,EAAE,UAE9B/F,KAAK4jI,kBAAkB1/H,QAAQusE,EAC9C,G,CAEc,WAAAg4D,CAAY/6H,G,0CACxB,MAAMitE,EAAwC,CAAC,EAI/C,OAHAjtE,EAAS9F,SAAS7B,IAChB40E,EAAQ50E,EAAEK,IAAM,IAAImkD,GAAWxkD,EAAE,UAEtB/F,KAAKw9D,cAAct5D,QAAQy2E,EAC1C,G,CAEc,SAAA+tD,CAAUh7H,G,0CACtB,MAAMisE,EAAoC,CAAC,EAI3C,OAHAjsE,EAAS9F,SAAS6B,IAChBkwE,EAAMlwE,EAAErD,IAAM,IAAIiqH,GAAS5mH,EAAE,UAElBzJ,KAAKgxH,YAAY9sH,QAAQy1E,EACxC,G,CAEc,YAAAgvD,CAAaj7H,G,0CACzB,IAAI47H,EAAwB,GAa5B,OAZgB,MAAZ57H,GAAkD,MAA9BA,EAASmqC,oBAC/ByxF,EAAYA,EAAUhzB,OAAO5oG,EAASmqC,oBAGxB,MAAZnqC,GAAwD,MAApCA,EAASyuF,yBAC/BzuF,EAASyuF,wBAAwBv0F,SAAS7F,IACpCA,EAAOi6F,QAAQv5F,OAAS,GAC1B6mI,EAAU1uH,KAAK7Y,EAAOi6F,Q,IAKrBh8F,KAAK8jE,sBAAsBpsB,qBAAqB4xF,EACzD,G,CAEc,YAAAV,CAAal7H,G,0CACzB,MAAMisB,EAAyC,CAAC,EAMhD,OALgB,MAAZjsB,GACFA,EAAS9F,SAAS2hB,IAChBoQ,EAASpQ,EAAEnjB,IAAM,IAAIqxB,GAAWlO,EAAE,UAGzBvpB,KAAKg4B,cAAc9zB,QAAQy1B,EAC1C,G,EArPe,IADdwkB,IAAc,IAAM,a,8aCpFvB,MAAMorF,GAAW,mCACXC,GAAa,6BAEZ,MAAMC,GACX,WAAAjqI,CACU4c,EACAG,GADA,KAAAH,sBAAAA,EACA,KAAAG,WAAAA,CACP,CAEG,OAAAmtH,CAAQv5H,G,0CACZ,GAAW,MAAPA,EACF,OAAO,KAET,IAAIw5H,EAAS,GACTluE,EAAoC,OACpCmuE,EAAS,EACTC,EAAS15H,EACb,MAAM25H,EAAwD,IAA5C35H,EAAInI,cAAcnB,QAAQ,cACtCkjI,GAAeD,GAAuD,IAA1C35H,EAAInI,cAAcnB,QAAQ,YAC5D,GAAIijI,EAAW,CACb,MAAMlsE,EAAS,EAAMn2D,eAAe0I,GACpC,GAAIytD,EAAO9M,IAAI,WAAqC,MAAxB8M,EAAO3jD,IAAI,UACrC,IACE,MAAM+vH,EAAcjnI,SAAS66D,EAAO3jD,IAAI,UAAUtT,OAAQ,MACtDqjI,EAAc,GAChBJ,EAAS,GACAI,EAAc,IACvBJ,EAASI,E,CAEX,SACAhqI,KAAKuc,WAAWhc,MAAM,wB,CAG1B,GAAIq9D,EAAO9M,IAAI,WAAqC,MAAxB8M,EAAO3jD,IAAI,UACrC,IACE,MAAMgwH,EAAclnI,SAAS66D,EAAO3jD,IAAI,UAAUtT,OAAQ,MACtDsjI,EAAc,IAChBN,EAASM,E,CAEX,SACAjqI,KAAKuc,WAAWhc,MAAM,wB,CAM1B,GAHIq9D,EAAO9M,IAAI,WAAqC,MAAxB8M,EAAO3jD,IAAI,YACrC4vH,EAASjsE,EAAO3jD,IAAI,WAElB2jD,EAAO9M,IAAI,cAA2C,MAA3B8M,EAAO3jD,IAAI,aAAsB,CAC9D,MAAMiwH,EAAWtsE,EAAO3jD,IAAI,aAAajS,cACxB,SAAbkiI,GAAoC,WAAbA,GAAsC,WAAbA,IAClDzuE,EAAMyuE,E,OAGDH,IACTF,EAAS15H,EAAInN,OAAO,GACpB4mI,EAAS,GAGX,MAAMO,EAAQlkI,KAAKspC,OAAM,IAAI/iC,MAAOD,UAAY,KAC1C69H,EAAUpqI,KAAKqqI,QAAQrqI,KAAKsqI,SAASrkI,KAAK0G,MAAMw9H,EAAQR,IAAU,GAAI,KACtEY,EAAY,EAAMznI,eAAesnI,GACjCI,EAAWxqI,KAAKyqI,WAAWZ,GAEjC,IAAKW,EAAS/nI,SAAW8nI,EAAU9nI,OACjC,OAAO,KAGT,MAAM0H,QAAanK,KAAKy3D,KAAK+yE,EAAUD,EAAW9uE,GAClD,GAAoB,IAAhBtxD,EAAK1H,OACP,OAAO,KAGT,MAAM0zD,EAAiC,GAAxBhsD,EAAKA,EAAK1H,OAAS,GAC5BiB,GACa,IAAfyG,EAAKgsD,KAAmB,IACL,IAAnBhsD,EAAKgsD,EAAS,KAAc,IACT,IAAnBhsD,EAAKgsD,EAAS,KAAc,EACV,IAAnBhsD,EAAKgsD,EAAS,GAEjB,IAAItkB,EAAM,GACV,GAAIk4F,EAAa,CACf,IAAIW,EAAoB,WAAThnI,EACf,IAAK,IAAIhB,EAAI,EAAGA,EAAIknI,EAAQlnI,IAC1BmvC,GAAO23F,GAAWkB,EAAWlB,IAC7BkB,EAAWzkI,KAAK0kI,MAAMD,EAAWlB,G,MAGnC33F,GAAOnuC,EAASuC,KAAK2kI,IAAI,GAAIhB,IAASnmI,WACtCouC,EAAM7xC,KAAKqqI,QAAQx4F,EAAK+3F,EAAQ,KAGlC,OAAO/3F,CACT,G,CAEA,eAAAg5F,CAAgB16H,GACd,IAAIw5H,EAAS,GACb,GAAW,MAAPx5H,GAA2D,IAA5CA,EAAInI,cAAcnB,QAAQ,cAAqB,CAChE,MAAM+2D,EAAS,EAAMn2D,eAAe0I,GACpC,GAAIytD,EAAO9M,IAAI,WAAqC,MAAxB8M,EAAO3jD,IAAI,UACrC,IACE0vH,EAAS5mI,SAAS66D,EAAO3jD,IAAI,UAAUtT,OAAQ,K,CAC/C,SACA3G,KAAKuc,WAAWhc,MAAM,wB,EAI5B,OAAOopI,CACT,CAIQ,OAAAU,CAAQ5gI,EAAWwnD,EAAW1nC,GAIpC,OAHI0nC,EAAI,GAAKxnD,EAAEhH,SACbgH,EAAIlF,MAAM0sD,EAAI,EAAIxnD,EAAEhH,QAAQoC,KAAK0kB,GAAK9f,GAEjCA,CACT,CAEQ,QAAA6gI,CAASzyG,GACf,OAAQA,EAAI,KAAO,IAAM,IAAM5xB,KAAKspC,MAAM1X,GAAGp0B,SAAS,GACxD,CAEQ,QAAAqnI,CAASrhI,GACfA,EAAIA,EAAEE,cACN,IAAIohI,EAAe,GAEnB,IAAK,IAAIroI,EAAI,EAAGA,EAAI+G,EAAEhH,OAAQC,IACxB6mI,GAAS1iI,QAAQ4C,EAAE/G,IAAM,IAI7BqoI,GAAgBthI,EAAE/G,IAEpB+G,EAAIshI,EAEJ,IAAIC,EAAO,GACPC,EAAM,GACV,IAAK,IAAIvoI,EAAI,EAAGA,EAAI+G,EAAEhH,OAAQC,IAAK,CACjC,MAAMwoI,EAAY3B,GAAS1iI,QAAQ4C,EAAEC,OAAOhH,IACxCwoI,EAAY,IAGhBF,GAAQhrI,KAAKqqI,QAAQa,EAAUznI,SAAS,GAAI,EAAG,K,CAEjD,IAAK,IAAIf,EAAI,EAAGA,EAAI,GAAKsoI,EAAKvoI,OAAQC,GAAK,EAAG,CAC5C,MAAMyoI,EAAQH,EAAKhoI,OAAON,EAAG,GAC7BuoI,GAAYloI,SAASooI,EAAO,GAAG1nI,SAAS,G,CAE1C,OAAOwnI,CACT,CAEQ,UAAAR,CAAWhhI,GACjB,OAAO,EAAM3G,eAAe9C,KAAK8qI,SAASrhI,GAC5C,CAEc,IAAAguD,CACZ+yE,EACAD,EACA9uE,G,0CAEA,MAAM5tD,QAAkB7N,KAAKoc,sBAAsB+pC,KAAKokF,EAAWC,EAAU/uE,GAC7E,OAAO,IAAIt5D,WAAW0L,EACxB,G,ECpKK,MAAM,GAAuB,IAAI0H,EACtC8D,GACA,iBACA,CACE1E,aAAehM,GAAQA,IAIdyiI,GAAyB,IAAIr1H,GACxCsD,GACA,sBACA,CACE1E,aAAehM,GAAQA,EACvBqN,QAAS,KAIAq1H,GAA8B,IAAIt1H,GAC7CsD,GACA,2BACA,CACE1E,aAAehM,GAAQA,EACvBqN,QAAS,K,2SCXN,MAAMs1H,GA4BX,WAAA9rI,CAAoBid,GAAA,KAAAA,cAAAA,EA3BZ,KAAA8uH,oBACNvrI,KAAKyc,cAAc4D,UAAU,IAItB,KAAA4jD,gBAAuCjkE,KAAKurI,oBAAoBlwH,OAAOnP,MAC9E,QAAKvH,GAAMA,SAAAA,KAGL,KAAA6mI,yBACNxrI,KAAKyc,cAAc0O,UAAUigH,IAItB,KAAAK,qBAA4CzrI,KAAKwrI,yBAAyBnwH,OAAOnP,MACxF,QAAKvH,GAAMA,SAAAA,KAGL,KAAA+mI,8BAA0D1rI,KAAKyc,cAAc0O,UACnFkgH,IAKO,KAAAM,0BACP3rI,KAAK0rI,8BAA8BrwH,OAAOnP,MAAK,QAAKvH,GAAMA,SAAAA,IAET,CAK7C,sBAAAinI,CAAuB97H,G,gDACrB9P,KAAKwrI,yBAAyB9wH,QAAO,IAAM5K,GACnD,G,CAKM,2BAAA+7H,CAA4B/7H,G,gDAC1B9P,KAAK0rI,8BAA8BhxH,QAAO,IAAM5K,GACxD,G,CAKM,iBAAAg8H,CAAkBh8H,G,gDAChB9P,KAAKurI,oBAAoB7wH,QAAO,IAAM5K,GAC9C,G,6SCxDK,MAAMi8H,GACX,WAAAvsI,CAAoBysB,GAAA,KAAAA,WAAAA,CAAyB,CAEvC,iBAAA+/G,CAAkBpzG,G,0CACtB,aAAa54B,KAAKisB,WAAWiM,KAAK,OAAQ,kBAAmBU,GAAS,GAAM,EAC9E,G,CAEM,6BAAAqzG,CACJh2G,EACA2C,G,0CAEA,aAAa54B,KAAKisB,WAAWiM,KAC3B,OACA,+CAAiDjC,EACjD2C,GACA,GACA,EAEJ,G,ECnBK,MAAMszG,GAAb,cACE,KAAAvxD,QAA2B,GAC3B,KAAA9L,QAAiC,GACjC,KAAAs9D,oBAAoD,EACtD,ECJO,MAAMC,GAAb,cACE,KAAAzxD,QAA2B,GAC3B,KAAAlK,YAAyC,GACzC,KAAA47D,wBAAwD,EAC1D,ECTO,MAAMC,GAIX,WAAA9sI,CAAY2Q,EAASL,GACnB9P,KAAKmQ,IAAMA,EACXnQ,KAAK8P,MAAQA,CACf,ECJK,MAAMy8H,GAMX,WAAA/sI,CAAYmkI,GAHZ,KAAAh0C,OAAqC,GACrC,KAAAC,MAAoC,GAGhB,MAAd+zC,IAGJ3jI,KAAKwB,KAAOmiI,EAAWniI,KAAOmiI,EAAWniI,KAAKwR,gBAAkB,KAChEhT,KAAKuvF,WAAao0C,EAAWp0C,WAC/B,ECXK,MAAMi9C,WAAgCD,GAG3C,WAAA/sI,CAAYmkI,GACQ,MAAdA,IAGJl2H,MAAMk2H,GACN3jI,KAAKoG,GAAKu9H,EAAWv9H,GACvB,ECTK,MAAMqmI,WAA4BxH,GAGvC,WAAAzlI,CAAYw8H,GACVvuH,MAAMuuH,GACNh8H,KAAKoG,GAAK41H,EAAO51H,EACnB,ECNK,MAAM,GAAb,cACE,KAAA+vF,SAAU,EAEV,KAAAxb,QAAwB,GACxB,KAAA9L,QAAwB,GACxB,KAAAs9D,oBAA0C,GAC1C,KAAA17D,YAAgC,GAChC,KAAA47D,wBAA8C,EAChD,E,gBCIO,MAAe,GAAtB,cACE,KAAAp2G,eAAyB,KAEf,KAAA1Z,WAAyB,IAAIhd,GAAkB,GAE/C,KAAAmtI,aAAe,iBAEf,KAAAC,mBAAqB,CAC7B,WACA,YACA,aACA,cACA,OACA,OACA,YACA,WACA,SACA,cACA,YACA,MACA,UACA,WACA,YACA,aACA,UACA,aACA,MACA,MACA,KACA,QACA,SACA,IACA,SACA,UACA,cACA,QAGA,YAGQ,KAAAC,mBAAqB,CAC7B,OACA,OACA,YACA,WACA,aACA,QACA,SACA,KACA,SACA,UACA,QACA,iBACA,SACA,OACA,UACA,WACA,MACA,cACA,aACA,YACA,QACA,YACA,SACA,WAGA,MACA,gBAGQ,KAAAC,gBAAkB,CAC1B,OACA,QACA,UACA,WACA,OACA,cACA,YACA,WACA,YACA,WACA,OAGA,aAGQ,KAAAC,cAA0B,CAClC,MACA,aACA,YACA,OACA,OACA,WACA,YACA,SACA,UACA,YACA,OACA,MACA,UACA,WACA,OACA,WACA,MAGA,MACA,WAGQ,KAAAC,gBAAkB,CAC1BC,SAAU,QACVC,gBAAgB,EAkSpB,CA/RE,gBAAcn2G,GACZ,OAA8B,MAAvB92B,KAAKi2B,cACd,CAEU,QAAAi3G,CAAS16H,GAEjB,IAAKxS,KAAKmtI,2BAA2B36H,GACnC,OAAO,KAET,MACM46H,GADS,IAAIC,WACAC,gBAAgB96H,EAAM,mBACzC,OAAc,MAAP46H,GAAmD,MAApCA,EAAIG,cAAc,eAAyBH,EAAM,IACzE,CAEU,QAAAI,CAASh7H,EAAci7H,EAAiB/7H,EAAe,CAAC,GAChE,MAAMg8H,EAAyCzkI,OAAOH,OACpD,CAAE2kI,OAAQA,GACVztI,KAAK+sI,gBACLr7H,GAEFc,EAAOxS,KAAK2tI,aAAan7H,GAAM3N,KAAK,MAAM8B,OAC1C,MAAMg+B,EAAS,SAAWnyB,EAAMk7H,GAQhC,OAPqB,MAAjB/oG,EAAOipG,QAAkBjpG,EAAOipG,OAAOnrI,OAAS,GAClDkiC,EAAOipG,OAAOhmI,SAASiD,IACR,MAATA,EAAEgjI,KACJ7tI,KAAKuc,WAAWlc,QAAQ,qBAAuBwK,EAAEgjI,IAAM,KAAOhjI,EAAE/K,Q,IAI/D6kC,EAAOnyB,MAAQmyB,EAAOnyB,KAAK/P,OAAS,EAAIkiC,EAAOnyB,KAAO,IAC/D,CAEU,iBAAAs7H,CAAkBC,GAC1B,GAAI/tI,KAAK0G,mBAAmBqnI,GAC1B,OAAO,KAET,MAAMC,EAAYhuI,KAAKwtI,SAASO,GAAS,GACzC,OAAiB,MAAbC,GAAqBA,EAAUvrI,OAAS,GAAKurI,EAAU,GAAGvrI,OAAS,EAC9DurI,EAAU,GAEZ,IACT,CAEU,YAAAC,CAAatkF,GACrB,GAAW,MAAPA,EACF,OAAO,KAGT,GAAmB,iBAARA,EAAkB,CAC3B,MAAMusD,EAAW,IAAIvmD,GAErB,OADAumD,EAASvsD,IAAM3pD,KAAKkuI,OAAOvkF,GACvB3pD,KAAK0G,mBAAmBwvG,EAASvsD,KAC5B,MAETusD,EAASzqG,MAAQ,KACV,CAACyqG,G,CAGV,GAAIvsD,EAAIlnD,OAAS,EAAG,CAClB,MAAM0rI,EAA4B,GAUlC,OATAxkF,EAAI/hD,SAASsiD,IACX,MAAMgsD,EAAW,IAAIvmD,GACrBumD,EAASvsD,IAAM3pD,KAAKkuI,OAAOhkF,GACvBlqD,KAAK0G,mBAAmBwvG,EAASvsD,OAGrCusD,EAASzqG,MAAQ,KACjB0iI,EAAUvzH,KAAKs7F,GAAS,IAEE,IAArBi4B,EAAU1rI,OAAe,KAAO0rI,C,CAGzC,OAAO,IACT,CAEU,MAAAD,CAAOvkF,GACf,OAAW,MAAPA,EACK,OAGmB,KAD5BA,EAAMA,EAAIhjD,QACFE,QAAQ,QAAiB8iD,EAAI9iD,QAAQ,MAAQ,IACnD8iD,EAAM,UAAYA,GAEhBA,EAAIlnD,OAAS,IACRknD,EAAI1/C,UAAU,EAAG,KAEnB0/C,EACT,CAEU,WAAAykF,CAAYnnI,GACpB,MAAMH,EAAW,EAAMN,YAAYS,GACnC,OAAIjH,KAAK0G,mBAAmBI,GACnB,KAEFA,EAASF,WAAW,QAAUE,EAAS5C,QAAQ,OAAQ,IAAM4C,CACtE,CAEU,kBAAAJ,CAAmBxE,GAC3B,OAAO,EAAMwE,mBAAmBxE,EAClC,CAEU,iBAAAmsI,CAAkBnsI,EAAaiN,EAAuB,MAC9D,OAAInP,KAAK0G,mBAAmBxE,GACnBiN,EAEFjN,CACT,CAEU,YAAAyrI,CAAazrI,GACrB,OAAOA,EAAIyF,MAAM3H,KAAK0sI,aACxB,CAEU,iBAAA4B,CAAkBtvE,EAAoBnS,GAC9C,GAAI7sD,KAAK0G,mBAAmBmmD,GAC1B,OAAO,EAGTA,EAAaA,EAAW3oD,QAAQ,MAAO,IAEvC,MAEMqqI,EAAc,IAAIloI,OAAO,+DAEzBmoI,EAAc3hF,EAAWphD,MAAM8iI,GAErC,IAAKC,EACH,OAAO,EAGTxvE,EAAO1T,KAAK5D,SAAW8mF,EAAY7+C,OAAO3mB,MAC1C,MAAMjc,EAAeyhF,EAAY7+C,OAAO5iC,KAExC,OADAiS,EAAO1T,KAAK3D,QAA0B,IAAhBoF,EAAKtqD,OAAe,KAAOsqD,EAAOA,GACjD,CACT,CAEU,wBAAA0hF,CAAyB9pG,GACjCA,EAAOwnG,oBAAoBvkI,SAAS5B,GAAM2+B,EAAO0nG,wBAAwBzxH,KAAK5U,KAC9E2+B,EAAO8rC,YAAc9rC,EAAOkqC,QAAQpqE,KAAKw0B,IACvC,MAAM0qG,EAAa,IAAI3B,GAGvB,OAFA2B,EAAWniI,KAAOy3B,EAAEz3B,KACpBmiI,EAAWv9H,GAAK6yB,EAAE7yB,GACXu9H,CAAU,IAEnBh/F,EAAOwnG,oBAAsB,GAC7BxnG,EAAOkqC,QAAU,EACnB,CAEU,wBAAA6/D,CAAyBC,EAAmBz6B,GACpD,MAAM06B,EAAM5uI,KAAK6uI,4BAA4BF,EAAUz6B,GACvD,OAAsB,IAAf06B,EAAInsI,OAAe,KAAOmsI,EAAI,EACvC,CAEU,2BAAAC,CAA4BF,EAAmBz6B,GACvD,OAAO3vG,MAAMlC,KAAKssI,EAASG,iBAAiB56B,IAAQx0G,QAAQqvI,GAAOA,EAAGC,aAAeL,GACvF,CAEU,eAAAM,GACR,MAAMjwE,EAAS,IAAIrN,GAMnB,OALAqN,EAAOnU,UAAW,EAClBmU,EAAOlU,MAAQ,GACfkU,EAAOxT,OAAS,GAChBwT,EAAO9T,MAAQ,IAAI8F,GACnBgO,EAAO1xD,KAAOs5C,GAAWqE,MAClB+T,CACT,CAEU,aAAAkwE,CAAclwE,GACR,MAAVA,IAGAA,EAAO1xD,OAASs5C,GAAWqE,QAC7B+T,EAAO9T,MAAQ,MAEblrD,KAAK0G,mBAAmBs4D,EAAOx9D,QACjCw9D,EAAOx9D,KAAO,MAEZxB,KAAK0G,mBAAmBs4D,EAAOlU,OACjCkU,EAAOlU,MAAQ,KAEfkU,EAAOlU,MAAQkU,EAAOlU,MAAMnkD,OAET,MAAjBq4D,EAAOxT,QAA2C,IAAzBwT,EAAOxT,OAAO/oD,SACzCu8D,EAAOxT,OAAS,MAEY,MAA1BwT,EAAOtT,iBAA6D,IAAlCsT,EAAOtT,gBAAgBjpD,SAC3Du8D,EAAOtT,gBAAkB,MAE7B,CAEU,UAAAyjF,CACRnwE,EACA7uD,EACAL,EACAxC,EAAkBw5C,GAAU0vD,MAE5B,IAAIx2G,KAAK0G,mBAAmBoJ,GAM5B,GAHI9P,KAAK0G,mBAAmByJ,KAC1BA,EAAM,IAEJL,EAAMrN,OAAS,KAAOqN,EAAMnJ,OAAOe,OAAO1H,KAAK0sI,eAAiB,EAC9C,MAAhB1tE,EAAOlU,QACTkU,EAAOlU,MAAQ,IAEjBkU,EAAOlU,OAAS36C,EAAM,KAAOnQ,KAAK2tI,aAAa79H,GAAOjL,KAAK,MAAQ,SAC9D,CACgB,MAAjBm6D,EAAOxT,SACTwT,EAAOxT,OAAS,IAElB,MAAMwI,EAAQ,IAAIxG,GAClBwG,EAAM1mD,KAAOA,EACb0mD,EAAMxyD,KAAO2O,EACb6jD,EAAMlkD,MAAQA,EACdkvD,EAAOxT,OAAO5wC,KAAKo5C,E,CAEvB,CAEU,aAAAo7E,CACRzqG,EACA0qG,EACAC,GAA2B,GAE3B,GAAItvI,KAAK0G,mBAAmB2oI,GAC1B,OAGF,IAAIE,EAAc5qG,EAAOkqC,QAAQpsE,OAEjC4sI,EAAaA,EAAWnrI,QAAQ,KAAM,KACtC,IAAIsrI,GAAY,EAEhB,IAAK,IAAI9sI,EAAI,EAAGA,EAAIiiC,EAAOkqC,QAAQpsE,OAAQC,IACzC,GAAIiiC,EAAOkqC,QAAQnsE,GAAGlB,OAAS6tI,EAAY,CACzCG,GAAY,EACZD,EAAc7sI,EACd,K,CAIJ,GAAI8sI,EAAW,CACb,MAAMv2G,EAAI,IAAIssG,GACdtsG,EAAEz3B,KAAO6tI,EACT1qG,EAAOkqC,QAAQj0D,KAAKqe,E,CAIlBq2G,GACF3qG,EAAOwnG,oBAAoBvxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQ8sI,GAE5D,CAEU,qBAAAE,CAAsBzwE,GAE5BA,EAAO1xD,OAASs5C,GAAWqE,OAC3BjrD,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,WACrC7jB,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,YACf,MAArBk7C,EAAO9T,MAAMjB,MAA6C,IAA7B+U,EAAO9T,MAAMjB,KAAKxnD,UAEhDu8D,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QAE5C,CAEU,eAAAC,CAAgB3wE,EAAoBtpD,GAC5C,GAAI1V,KAAK0G,mBAAmBgP,GAC1B,OAGF,MAAMk6H,EAAYl6H,EAAS/N,MAAM,KAC7BioI,EAAUntI,OAAS,IACrBu8D,EAAO7e,SAAS6H,UAAYhoD,KAAKquI,kBAAkBuB,EAAU,KAEtC,IAArBA,EAAUntI,OACZu8D,EAAO7e,SAAS+H,SAAWloD,KAAKquI,kBAAkBuB,EAAU,IACnDA,EAAUntI,QAAU,IAC7Bu8D,EAAO7e,SAAS8H,WAAajoD,KAAKquI,kBAAkBuB,EAAU,IAC9D5wE,EAAO7e,SAAS+H,SAAW0nF,EAAUhrI,MAAM,EAAGgrI,EAAUntI,QAAQoC,KAAK,KAEzE,CAEQ,0BAAAsoI,CAA2B36H,GAGjC,OAFc,IAAInM,OAAO,WAAY,KACHE,KAAKiM,EAEzC,EC/ZK,MAAMq9H,WAA2B,GACtC,KAAAnhG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAGF,MAAMu8D,EAASh/D,KAAKivI,kBAIpB,GAHAjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMA,EAAMrN,OAAS,IAC3Du8D,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAE3CA,EAAMrN,OAAS,GAAKqN,EAAMrN,OAAS,GAAM,EAC3C,IAAK,IAAIC,EAAI,EAAGA,EAAIoN,EAAMrN,OAAS,EAAGC,GAAK,EAAG,CAC5C,MAAMgnB,EAAc5Z,EAAMpN,EAAI,GACxBsxD,EAAgBlkD,EAAMpN,EAAI,GAChC,GAAI1C,KAAK0G,mBAAmBgjB,IAAQ1pB,KAAK0G,mBAAmBstD,GAC1D,SAGF,MAAM87E,EAAa97E,EAAMhsD,cACI,MAAzBg3D,EAAO9T,MAAMpnC,UAAoB9jB,KAAK2sI,mBAAmB9lI,QAAQipI,IAAe,EAClF9wE,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkB3kH,GAEtB,MAAzBs1C,EAAO9T,MAAMrnC,UACb7jB,KAAK4sI,mBAAmB/lI,QAAQipI,IAAe,EAE/C9wE,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkB3kH,IAEzB,MAArBs1C,EAAO9T,MAAMjB,MAA6C,IAA7B+U,EAAO9T,MAAMjB,KAAKxnD,SAChDzC,KAAK8sI,cAAcjmI,QAAQipI,IAAe,EAE1C9wE,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAavkH,GAEtC1pB,KAAKmvI,WAAWnwE,EAAQhL,EAAOtqC,E,CAKrC1pB,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECrDK,MAAMorG,WAAyB,GACpC,KAAArhG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,MAC3Cw9D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM6G,KAC5CqoD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMo7C,OACrDlrD,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EClBK,MAAMqrG,WAA0B,GACrC,KAAAthG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAU/7B,KAAKikB,MAAMl8B,GAC3B,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGH,MAAlB6hB,EAAQypF,QACVzpF,EAAQypF,OAAOroI,SAASkI,IACtB,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMogI,UAC3ClxE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM27G,MAC5CzsD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5C+3D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMqgI,KACrDnxE,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMsgI,WACrDpwI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAIV,MAAjBxY,EAAQsE,OACVtE,EAAQsE,MAAMljD,SAASkI,IACrB,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMugI,OAC3CrxE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM4tF,MAC5C19F,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAIV,MAAjBxY,EAAQ8pF,OACV9pF,EAAQ8pF,MAAM1oI,SAASkI,IACrB,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMogI,UAC3ClxE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM27G,MAC5CzsD,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAMygI,YAC1DvxE,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAM0gI,YAClDxxE,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkBv+H,EAAM2gI,KAChDzxE,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QACpC,MAAxB33C,EAAMk/B,iBAC0B,MAA9Bl/B,EAAMk/B,eAAeg6B,QACvBhK,EAAO1T,KAAK5D,SAAW53C,EAAMk/B,eAAeg6B,MAAQ,IAErB,MAA7Bl5D,EAAMk/B,eAAe+d,OACvBiS,EAAO1T,KAAK3D,QAAU73C,EAAMk/B,eAAe+d,KAAO,KAGtD/sD,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAI/Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EC7DK,MAAM+rG,WAAyB,GACpC,KAAAhiG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBACjBv+H,EAAMtO,KACNxB,KAAKquI,kBAAkBruI,KAAKouI,YAAYt+H,EAAMq5G,SAAU,OAE1DnqD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMq5G,SAC5CnqD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UAGnD9jB,KAAK0G,mBAAmBoJ,EAAM+T,YAC7B7jB,KAAK0G,mBAAmBoJ,EAAM6gI,oBAE/B3xE,EAAO9T,MAAMrnC,SAAW/T,EAAM6gI,oBAE9B3xE,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM6gI,qBAG9C3wI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EClCK,MAAMisG,WAA8B,GACzC,KAAAliG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAuB,SAAnBA,EAAM+gI,SACR,OAEF,MAAM7xE,EAASh/D,KAAKivI,kBACpBjwE,EAAOnU,SAAyB,MAAd/6C,EAAMghI,IACxB9xE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,MAC3Cw9D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMihI,OACrB,SAAnBjhI,EAAM+gI,WACR7xE,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5C+3D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,WAEvD7jB,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EC7BK,MAAMqsG,WAA0B,GAAvC,c,oBACU,KAAAC,oBAAsB,IAAI5qI,OAAO,qCA2B3C,CAzBE,KAAAqoC,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpB,IAAIztI,EAAOsO,EAAMtO,MACZA,GAAQxB,KAAKixI,oBAAoB1qI,KAAKuJ,EAAM7I,OAC/CzF,EAAOsO,EAAM7I,IAAIwE,MAAMzL,KAAKixI,qBAAqB,IAEnDjyE,EAAOx9D,KAAOxB,KAAKquI,kBAAkB7sI,EAAM,MAC3Cw9D,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5CjH,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECpBK,MAAMusG,WAA6B,GACxC,KAAAxiG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAI9P,KAAK82B,eAAiB92B,KAAK0G,mBAAmBoJ,EAAM2gE,aAAc,CAC/C3gE,EAAM2gE,YAAuB9oE,MAAM,KAC5CC,SAASupI,IACnB,IAAIC,GAAgB,EAChBC,EAAkB1sG,EAAO8rC,YAAYhuE,OAEzC,IAAK,IAAIC,EAAI,EAAGA,EAAIiiC,EAAO8rC,YAAYhuE,OAAQC,IAC7C,GAAIiiC,EAAO8rC,YAAY/tE,GAAGlB,OAAS2vI,EAAK,CACtCC,GAAgB,EAChBC,EAAkB3uI,EAClB,K,CAIJ,GAAI0uI,EAAe,CACjB,MAAMzN,EAAa,IAAI3B,GACvB2B,EAAWniI,KAAO2vI,EAClBxsG,EAAO8rC,YAAY71D,KAAK+oH,E,CAG1Bh/F,EAAO0nG,wBAAwBzxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQ4uI,GAAiB,G,MAErErxI,KAAK82B,cACf92B,KAAKovI,cAAczqG,EAAQ70B,EAAMksH,QAGnC,MAAMh9D,EAAS,IAAIrN,GACnBqN,EAAOnU,UACJ7qD,KAAK82B,cAAgE,MAAhD92B,KAAKquI,kBAAkBv+H,EAAM+6C,SAAU,KAC/DmU,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMg7C,OAC5CkU,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,KAAM,MACjD,IACEw9D,EAAOhU,SAAWjoD,SAChB/C,KAAKquI,kBAAkBv+H,EAAMk7C,SAAUnE,GAAmB98B,KAAKtmB,YAC/D,G,CAEF,MAAOoH,GAEPnK,QAAQH,MAAM,iCAAkCsK,GAChDm0D,EAAOhU,SAAWnE,GAAmB98B,I,CAGvC,IAAK/pB,KAAK0G,mBAAmBoJ,EAAM07C,QAAS,CAC1C,MAAMA,EAASxrD,KAAK2tI,aAAa79H,EAAM07C,QACvC,IAAK,IAAI9oD,EAAI,EAAGA,EAAI8oD,EAAO/oD,OAAQC,IAAK,CACtC,GAAI1C,KAAK0G,mBAAmB8kD,EAAO9oD,IACjC,SAGF,MAAM4uI,EAAgB9lF,EAAO9oD,GAAGwf,YAAY,MAC5C,IAAuB,IAAnBovH,EACF,SAGmB,MAAjBtyE,EAAOxT,SACTwT,EAAOxT,OAAS,IAGlB,MAAMwI,EAAQ,IAAIxG,GAClBwG,EAAMxyD,KAAOgqD,EAAO9oD,GAAGM,OAAO,EAAGsuI,GACjCt9E,EAAMlkD,MAAQ,KACdkkD,EAAM1mD,KAAOw5C,GAAU0vD,KACnBhrD,EAAO9oD,GAAGD,OAAS6uI,EAAgB,IACrCt9E,EAAMlkD,MAAQ07C,EAAO9oD,GAAGM,OAAOsuI,EAAgB,IAEjDtyE,EAAOxT,OAAO5wC,KAAKo5C,E,EAKvB,OADgC,MAAdlkD,EAAMxC,KAAewC,EAAMxC,KAAKtF,cAAgB,MAEhE,IAAK,OACHg3D,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC,MACF,QAAS,CACP1wE,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAO9T,MAAQ,IAAI8F,GACnBgO,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAMyhI,YAAczhI,EAAMi6C,MACrEiV,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM0hI,gBAAkB1hI,EAAM+T,UAC7Em7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM2hI,gBAAkB3hI,EAAMgU,UAC7E,MAAMmmC,EAAOjqD,KAAK8tI,kBAAkBh+H,EAAM4hI,WAAa5hI,EAAM65C,KAC7DqV,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAahkF,GACtC,K,EAIJtlB,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EClHK,SAASgtG,GAAc7hI,GAC5B,OAAa,MAATA,EACK,KAGW,iBAATA,EACFA,EAEFA,aAAK,EAALA,EAAOkD,eAChB,CCLO,MAAM4+H,GACX,eAAOC,GACL,MAAMljC,EAAM,IAAIijC,GAOhB,OANAjjC,EAAIpnD,eAAiB,WACrBonD,EAAInnD,MAAQ,OACZmnD,EAAIlnD,OAAS,mBACbknD,EAAIjnD,SAAW,KACfinD,EAAIhnD,QAAU,OACdgnD,EAAI3kF,KAAO,MACJ2kF,CACT,CAEA,aAAOmjC,CAAOnjC,EAAiBp8C,EAAO,IAAInG,IAOxC,OANAmG,EAAKhL,eAAiBonD,EAAIpnD,eAC1BgL,EAAK/K,MAAQmnD,EAAInnD,MACjB+K,EAAK9K,OAASknD,EAAIlnD,OAClB8K,EAAK7K,SAAWinD,EAAIjnD,SACpB6K,EAAK5K,QAAUgnD,EAAIhnD,QACnB4K,EAAKvoC,KAAO2kF,EAAI3kF,KACTuoC,CACT,CAEA,eAAOw/E,CAASpjC,EAAiBnnG,EAAS,IAAI6jD,IAO5C,OANA7jD,EAAO+/C,eAAuC,MAAtBonD,EAAIpnD,eAAyB,IAAIj1C,EAAUq8F,EAAIpnD,gBAAkB,KACzF//C,EAAOggD,MAAqB,MAAbmnD,EAAInnD,MAAgB,IAAIl1C,EAAUq8F,EAAInnD,OAAS,KAC9DhgD,EAAOigD,OAAuB,MAAdknD,EAAIlnD,OAAiB,IAAIn1C,EAAUq8F,EAAIlnD,QAAU,KACjEjgD,EAAOkgD,SAA2B,MAAhBinD,EAAIjnD,SAAmB,IAAIp1C,EAAUq8F,EAAIjnD,UAAY,KACvElgD,EAAOmgD,QAAyB,MAAfgnD,EAAIhnD,QAAkB,IAAIr1C,EAAUq8F,EAAIhnD,SAAW,KACpEngD,EAAOwiB,KAAmB,MAAZ2kF,EAAI3kF,KAAe,IAAI1X,EAAUq8F,EAAI3kF,MAAQ,KACpDxiB,CACT,CASA,WAAAhI,CAAY22B,GACD,MAALA,IAIJn2B,KAAKunD,eAAiBoqF,GAAcx7G,EAAEoxB,gBACtCvnD,KAAKwnD,MAAQmqF,GAAcx7G,EAAEqxB,OAC7BxnD,KAAKynD,OAASkqF,GAAcx7G,EAAEsxB,QAC9BznD,KAAK0nD,SAAWiqF,GAAcx7G,EAAEuxB,UAChC1nD,KAAK2nD,QAAUgqF,GAAcx7G,EAAEwxB,SAC/B3nD,KAAKgqB,KAAO2nH,GAAcx7G,EAAEnM,MAC9B,ECjDK,MAAMgoH,GACX,eAAOH,GACL,MAAMljC,EAAM,IAAIqjC,GAIhB,OAHArjC,EAAIntG,KAAO,aACXmtG,EAAI7+F,MAAQ,aACZ6+F,EAAIrhG,KAAOw5C,GAAU0vD,KACd7H,CACT,CAEA,aAAOmjC,CAAOnjC,EAAkBp8C,EAAO,IAAI/E,IAKzC,OAJA+E,EAAKjlD,KAAOqhG,EAAIrhG,KAChBilD,EAAKziD,MAAQ6+F,EAAI7+F,MACjByiD,EAAK/wD,KAAOmtG,EAAIntG,KAChB+wD,EAAK1K,SAAW8mD,EAAI9mD,SACb0K,CACT,CAEA,eAAOw/E,CAASpjC,EAAkBnnG,EAAS,IAAIqrD,IAK7C,OAJArrD,EAAO8F,KAAOqhG,EAAIrhG,KAClB9F,EAAOsI,MAAqB,MAAb6+F,EAAI7+F,MAAgB,IAAIwC,EAAUq8F,EAAI7+F,OAAS,KAC9DtI,EAAOhG,KAAmB,MAAZmtG,EAAIntG,KAAe,IAAI8Q,EAAUq8F,EAAIntG,MAAQ,KAC3DgG,EAAOqgD,SAAW8mD,EAAI9mD,SACfrgD,CACT,CAOA,WAAAhI,CAAY22B,GACD,MAALA,IAIJn2B,KAAKwB,KAAOmwI,GAAcx7G,EAAE30B,MAC5BxB,KAAK8P,MAAQ6hI,GAAcx7G,EAAErmB,OAC7B9P,KAAKsN,KAAO6oB,EAAE7oB,KACdtN,KAAK6nD,SAAW1xB,EAAE0xB,SACpB,ECxCK,MAAMoqF,GACX,eAAOJ,GACL,MAAMljC,EAAM,IAAIsjC,GAmBhB,OAlBAtjC,EAAI5mD,MAAQ,KACZ4mD,EAAI3mD,UAAY,OAChB2mD,EAAI1mD,WAAa,UACjB0mD,EAAIzmD,SAAW,MACfymD,EAAIxmD,SAAW,aACfwmD,EAAIvmD,SAAW,WACfumD,EAAItmD,SAAW,KACfsmD,EAAIrmD,KAAO,WACXqmD,EAAIn0F,MAAQ,KACZm0F,EAAIpmD,WAAa,QACjBomD,EAAInmD,QAAU,KACdmmD,EAAIlmD,QAAU,YACdkmD,EAAI99F,MAAQ,mBACZ89F,EAAIjmD,MAAQ,aACZimD,EAAIhmD,IAAM,eACVgmD,EAAI9qF,SAAW,OACf8qF,EAAI/lD,eAAiB,eACrB+lD,EAAI9lD,cAAgB,oBACb8lD,CACT,CAEA,aAAOmjC,CAAOnjC,EAAqBp8C,EAAO,IAAI1E,IAmB5C,OAlBA0E,EAAKxK,MAAQ4mD,EAAI5mD,MACjBwK,EAAKvK,UAAY2mD,EAAI3mD,UACrBuK,EAAKtK,WAAa0mD,EAAI1mD,WACtBsK,EAAKrK,SAAWymD,EAAIzmD,SACpBqK,EAAKpK,SAAWwmD,EAAIxmD,SACpBoK,EAAKnK,SAAWumD,EAAIvmD,SACpBmK,EAAKlK,SAAWsmD,EAAItmD,SACpBkK,EAAKjK,KAAOqmD,EAAIrmD,KAChBiK,EAAK/3C,MAAQm0F,EAAIn0F,MACjB+3C,EAAKhK,WAAaomD,EAAIpmD,WACtBgK,EAAK/J,QAAUmmD,EAAInmD,QACnB+J,EAAK9J,QAAUkmD,EAAIlmD,QACnB8J,EAAK1hD,MAAQ89F,EAAI99F,MACjB0hD,EAAK7J,MAAQimD,EAAIjmD,MACjB6J,EAAK5J,IAAMgmD,EAAIhmD,IACf4J,EAAK1uC,SAAW8qF,EAAI9qF,SACpB0uC,EAAK3J,eAAiB+lD,EAAI/lD,eAC1B2J,EAAK1J,cAAgB8lD,EAAI9lD,cAClB0J,CACT,CAEA,eAAOw/E,CAASpjC,EAAqBnnG,EAAS,IAAI+jD,IAmBhD,OAlBA/jD,EAAOugD,MAAqB,MAAb4mD,EAAI5mD,MAAgB,IAAIz1C,EAAUq8F,EAAI5mD,OAAS,KAC9DvgD,EAAOwgD,UAA6B,MAAjB2mD,EAAI3mD,UAAoB,IAAI11C,EAAUq8F,EAAI3mD,WAAa,KAC1ExgD,EAAOygD,WAA+B,MAAlB0mD,EAAI1mD,WAAqB,IAAI31C,EAAUq8F,EAAI1mD,YAAc,KAC7EzgD,EAAO0gD,SAA2B,MAAhBymD,EAAIzmD,SAAmB,IAAI51C,EAAUq8F,EAAIzmD,UAAY,KACvE1gD,EAAO2gD,SAA2B,MAAhBwmD,EAAIxmD,SAAmB,IAAI71C,EAAUq8F,EAAIxmD,UAAY,KACvE3gD,EAAO4gD,SAA2B,MAAhBumD,EAAIvmD,SAAmB,IAAI91C,EAAUq8F,EAAIvmD,UAAY,KACvE5gD,EAAO6gD,SAA2B,MAAhBsmD,EAAItmD,SAAmB,IAAI/1C,EAAUq8F,EAAItmD,UAAY,KACvE7gD,EAAO8gD,KAAmB,MAAZqmD,EAAIrmD,KAAe,IAAIh2C,EAAUq8F,EAAIrmD,MAAQ,KAC3D9gD,EAAOgT,MAAqB,MAAbm0F,EAAIn0F,MAAgB,IAAIlI,EAAUq8F,EAAIn0F,OAAS,KAC9DhT,EAAO+gD,WAA+B,MAAlBomD,EAAIpmD,WAAqB,IAAIj2C,EAAUq8F,EAAIpmD,YAAc,KAC7E/gD,EAAOghD,QAAyB,MAAfmmD,EAAInmD,QAAkB,IAAIl2C,EAAUq8F,EAAInmD,SAAW,KACpEhhD,EAAOihD,QAAyB,MAAfkmD,EAAIlmD,QAAkB,IAAIn2C,EAAUq8F,EAAIlmD,SAAW,KACpEjhD,EAAOqJ,MAAqB,MAAb89F,EAAI99F,MAAgB,IAAIyB,EAAUq8F,EAAI99F,OAAS,KAC9DrJ,EAAOkhD,MAAqB,MAAbimD,EAAIjmD,MAAgB,IAAIp2C,EAAUq8F,EAAIjmD,OAAS,KAC9DlhD,EAAOmhD,IAAiB,MAAXgmD,EAAIhmD,IAAc,IAAIr2C,EAAUq8F,EAAIhmD,KAAO,KACxDnhD,EAAOqc,SAA2B,MAAhB8qF,EAAI9qF,SAAmB,IAAIvR,EAAUq8F,EAAI9qF,UAAY,KACvErc,EAAOohD,eAAuC,MAAtB+lD,EAAI/lD,eAAyB,IAAIt2C,EAAUq8F,EAAI/lD,gBAAkB,KACzFphD,EAAOqhD,cAAqC,MAArB8lD,EAAI9lD,cAAwB,IAAIv2C,EAAUq8F,EAAI9lD,eAAiB,KAC/ErhD,CACT,CAqBA,WAAAhI,CAAY22B,GACD,MAALA,IAIJn2B,KAAK+nD,MAAQ4pF,GAAcx7G,EAAE4xB,OAC7B/nD,KAAKgoD,UAAY2pF,GAAcx7G,EAAE6xB,WACjChoD,KAAKioD,WAAa0pF,GAAcx7G,EAAE8xB,YAClCjoD,KAAKkoD,SAAWypF,GAAcx7G,EAAE+xB,UAChCloD,KAAKmoD,SAAWwpF,GAAcx7G,EAAEgyB,UAChCnoD,KAAKooD,SAAWupF,GAAcx7G,EAAEiyB,UAChCpoD,KAAKqoD,SAAWspF,GAAcx7G,EAAEkyB,UAChCroD,KAAKsoD,KAAOqpF,GAAcx7G,EAAEmyB,MAC5BtoD,KAAKwa,MAAQm3H,GAAcx7G,EAAE3b,OAC7Bxa,KAAKuoD,WAAaopF,GAAcx7G,EAAEoyB,YAClCvoD,KAAKwoD,QAAUmpF,GAAcx7G,EAAEqyB,SAC/BxoD,KAAKyoD,QAAUkpF,GAAcx7G,EAAEsyB,SAC/BzoD,KAAK6Q,MAAQ8gI,GAAcx7G,EAAEtlB,OAC7B7Q,KAAK0oD,MAAQipF,GAAcx7G,EAAEuyB,OAC7B1oD,KAAK2oD,IAAMgpF,GAAcx7G,EAAEwyB,KAC3B3oD,KAAK6jB,SAAW8tH,GAAcx7G,EAAEtS,UAChC7jB,KAAK4oD,eAAiB+oF,GAAcx7G,EAAEyyB,gBACtC5oD,KAAK6oD,cAAgB8oF,GAAcx7G,EAAE0yB,eACvC,EC3GK,MAAMqpF,GAKX,eAAOL,GACL,MAAMljC,EAAM,IAAIujC,GAchB,OAbAvjC,EAAI5lD,aAAe,QACnB4lD,EAAI3lD,QAAU,UACd2lD,EAAI1lD,aAAe,eACnB0lD,EAAIzlD,SAAW,WACfylD,EAAIxlD,SAAW,WACfwlD,EAAIvlD,KAAO,OACXulD,EAAI5gG,WAAa,aACjB4gG,EAAItlD,SAAW,WACfslD,EAAIrlD,QAAU,UACdqlD,EAAIplD,OAAS,SACbolD,EAAInlD,gBAAkB,kBACtBmlD,EAAIllD,aAAe,QACnBklD,EAAIrqE,aAAe,KACZqqE,CACT,CAQA,aAAOmjC,CAAOnjC,EAA4Bp8C,EAAO,IAAIhD,IAcnD,OAbAgD,EAAKxJ,aAAe4lD,EAAI5lD,aACxBwJ,EAAKvJ,QAAU2lD,EAAI3lD,QACnBuJ,EAAKtJ,aAAe0lD,EAAI1lD,aACxBsJ,EAAKrJ,SAAWylD,EAAIzlD,SACpBqJ,EAAKpJ,SAAWwlD,EAAIxlD,SACpBoJ,EAAKnJ,KAAOulD,EAAIvlD,KAChBmJ,EAAKxkD,WAAa4gG,EAAI5gG,WACtBwkD,EAAKlJ,SAAWslD,EAAItlD,SACpBkJ,EAAKjJ,QAAUvmD,SAAS4rG,EAAIrlD,SAC5BiJ,EAAKhJ,OAASolD,EAAIplD,OAClBgJ,EAAK/I,gBAAkBmlD,EAAInlD,gBAC3B+I,EAAK9I,aAAoC,SAArBklD,EAAIllD,aACxB8I,EAAKjuB,aAAe,IAAI93B,KAAKmiG,EAAIrqE,cAC1BiuB,CACT,CAQA,eAAOw/E,CAASpjC,EAA4BnnG,EAAS,IAAIwrD,IAevD,OAdAxrD,EAAOuhD,aAAmC,MAApB4lD,EAAI5lD,aAAuB,IAAIz2C,EAAUq8F,EAAI5lD,cAAgB,KACnFvhD,EAAOwhD,QAAyB,MAAf2lD,EAAI3lD,QAAkB,IAAI12C,EAAUq8F,EAAI3lD,SAAW,KACpExhD,EAAOyhD,aAAmC,MAApB0lD,EAAI1lD,aAAuB,IAAI32C,EAAUq8F,EAAI1lD,cAAgB,KACnFzhD,EAAO0hD,SAA2B,MAAhBylD,EAAIzlD,SAAmB,IAAI52C,EAAUq8F,EAAIzlD,UAAY,KACvE1hD,EAAO2hD,SAA2B,MAAhBwlD,EAAIxlD,SAAmB,IAAI72C,EAAUq8F,EAAIxlD,UAAY,KACvE3hD,EAAO4hD,KAAmB,MAAZulD,EAAIvlD,KAAe,IAAI92C,EAAUq8F,EAAIvlD,MAAQ,KAC3D5hD,EAAOuG,WAA+B,MAAlB4gG,EAAI5gG,WAAqB,IAAIuE,EAAUq8F,EAAI5gG,YAAc,KAC7EvG,EAAO6hD,SAA2B,MAAhBslD,EAAItlD,SAAmB,IAAI/2C,EAAUq8F,EAAItlD,UAAY,KACvE7hD,EAAO8hD,QAAyB,MAAfqlD,EAAIrlD,QAAkB,IAAIh3C,EAAUq8F,EAAIrlD,SAAW,KACpE9hD,EAAO+hD,OAAuB,MAAdolD,EAAIplD,OAAiB,IAAIj3C,EAAUq8F,EAAIplD,QAAU,KACjE/hD,EAAOgiD,gBACkB,MAAvBmlD,EAAInlD,gBAA0B,IAAIl3C,EAAUq8F,EAAInlD,iBAAmB,KACrEhiD,EAAOiiD,aAAmC,MAApBklD,EAAIllD,aAAuB,IAAIn3C,EAAUq8F,EAAIllD,cAAgB,KACnFjiD,EAAO88B,aAAeqqE,EAAIrqE,aACnB98B,CACT,CAqBA,WAAAhI,CAAY22B,GACD,MAALA,IAIJn2B,KAAK+oD,aAAe4oF,GAAcx7G,EAAE4yB,cACpC/oD,KAAKgpD,QAAU2oF,GAAcx7G,EAAE6yB,SAC/BhpD,KAAKipD,aAAe0oF,GAAcx7G,EAAE8yB,cACpCjpD,KAAKkpD,SAAWyoF,GAAcx7G,EAAE+yB,UAChClpD,KAAKmpD,SAAWwoF,GAAcx7G,EAAEgzB,UAChCnpD,KAAKopD,KAAOuoF,GAAcx7G,EAAEizB,MAC5BppD,KAAK+N,WAAa4jI,GAAcx7G,EAAEpoB,YAClC/N,KAAKqpD,SAAWsoF,GAAcx7G,EAAEkzB,UAChCrpD,KAAKspD,QAAUqoF,GAAc/tI,OAAOuyB,EAAEmzB,UACtCtpD,KAAKupD,OAASooF,GAAcx7G,EAAEozB,QAC9BvpD,KAAKwpD,gBAAkBmoF,GAAcx7G,EAAEqzB,iBACvCxpD,KAAKypD,aAAekoF,GAAc/tI,OAAOuyB,EAAEszB,eAC3CzpD,KAAKskC,aAAenO,EAAEmO,aACxB,EC7GK,MAAM6tG,GACX,eAAON,GACL,MAAMljC,EAAM,IAAIwjC,GAGhB,OAFAxjC,EAAIhlD,IAAM,qBACVglD,EAAIljG,MAAQ,KACLkjG,CACT,CAEA,aAAOmjC,CAAOnjC,EAAqBp8C,EAAO,IAAI5C,IAG5C,OAFA4C,EAAK5I,IAAMglD,EAAIhlD,IACf4I,EAAK9mD,MAAQkjG,EAAIljG,MACV8mD,CACT,CAEA,eAAOw/E,CAASpjC,EAAqBnnG,EAAS,IAAI0rD,IAIhD,OAHA1rD,EAAOmiD,IAAiB,MAAXglD,EAAIhlD,IAAc,IAAIr3C,EAAUq8F,EAAIhlD,KAAO,KACxDniD,EAAOoiD,YAAiC,MAAnB+kD,EAAI/kD,YAAsB,IAAIt3C,EAAUq8F,EAAI/kD,aAAe,KAChFpiD,EAAOiE,MAAQkjG,EAAIljG,MACZjE,CACT,CAMA,WAAAhI,CAAY22B,G,MAFZ,KAAA1qB,MAAiC,KAGtB,MAAL0qB,IAIJn2B,KAAK2pD,IAAMgoF,GAAcx7G,EAAEwzB,KACvB,gBAAiBxzB,IACnBn2B,KAAK4pD,YAA2B,QAAb,EAAAzzB,EAAEyzB,mBAAW,eAAE52C,iBAEpChT,KAAKyL,MAAQ0qB,EAAE1qB,MACjB,EClCK,MAAM2mI,GACX,eAAOP,GACL,MAAMljC,EAAM,IAAIyjC,GAMhB,OALAzjC,EAAI1kD,KAAO,GACX0kD,EAAI9qF,SAAW,OACf8qF,EAAI7qF,SAAW,gBACf6qF,EAAI5kD,KAAO,mBACX4kD,EAAIxkD,iBAAmB,CAAC+nF,GAAsBL,YACvCljC,CACT,CAEA,aAAOmjC,CAAOnjC,EAAkBp8C,EAAO,IAAIvB,IAUzC,OATgB,MAAZ29C,EAAI1kD,OACNsI,EAAKtI,KAAO0kD,EAAI1kD,KAAKxlD,KAAKylD,GAAMioF,GAAeL,OAAO5nF,MAExDqI,EAAK1uC,SAAW8qF,EAAI9qF,SACpB0uC,EAAKzuC,SAAW6qF,EAAI7qF,SACpByuC,EAAKxI,KAAO4kD,EAAI5kD,KACY,MAAxB4kD,EAAIxkD,mBACNoI,EAAKpI,iBAAmBwkD,EAAIxkD,iBAAiB1lD,KAAK0L,GAAQ+hI,GAAsBJ,OAAO3hI,MAElFoiD,CACT,CAEA,eAAOw/E,CAASpjC,EAAkBnnG,EAAS,IAAIyjD,IAS7C,OARgB,MAAZ0jD,EAAI1kD,OACNziD,EAAOyiD,KAAO0kD,EAAI1kD,KAAKxlD,KAAKylD,GAAMioF,GAAeJ,SAAS7nF,MAE5D1iD,EAAOqc,SAA2B,MAAhB8qF,EAAI9qF,SAAmB,IAAIvR,EAAUq8F,EAAI9qF,UAAY,KACvErc,EAAOsc,SAA2B,MAAhB6qF,EAAI7qF,SAAmB,IAAIxR,EAAUq8F,EAAI7qF,UAAY,KACvEtc,EAAOuiD,KAAmB,MAAZ4kD,EAAI5kD,KAAe,IAAIz3C,EAAUq8F,EAAI5kD,MAAQ,KAGpDviD,CACT,CAQA,WAAAhI,CAAY22B,GAFZ,KAAAg0B,iBAA4C,GAGjC,MAALh0B,IAIU,MAAVA,EAAE8zB,OACJjqD,KAAKiqD,KAAO9zB,EAAE8zB,KAAKxlD,KAAKylD,GAAM,IAAIioF,GAAejoF,MAGzB,MAAtB/zB,EAAEg0B,mBACJnqD,KAAKmqD,iBAAmBh0B,EAAEg0B,iBAAiB1lD,KAAK0L,GAAQ,IAAI+hI,GAAsB/hI,MAGpFnQ,KAAK6jB,SAAW8tH,GAAcx7G,EAAEtS,UAChC7jB,KAAK8jB,SAAW6tH,GAAcx7G,EAAErS,UAChC9jB,KAAK+pD,KAAO4nF,GAAcx7G,EAAE4zB,MAC9B,EC5DK,MAAMsoF,GACX,eAAOR,GACL,MAAMljC,EAAM,IAAI0jC,GAGhB,OAFA1jC,EAAI7qF,SAAW,KACf6qF,EAAItkD,aAAe,KACZskD,CACT,CAEA,aAAOmjC,CAAOnjC,EAA4Bp8C,EAAO,IAAIf,IAGnD,OAFAe,EAAKzuC,SAAW6qF,EAAI7qF,SACpByuC,EAAKlI,aAAeskD,EAAItkD,aACjBkI,CACT,CAEA,eAAOw/E,CAASpjC,EAA4BnnG,EAAS,IAAI+pD,IAGvD,OAFA/pD,EAAOsc,SAA2B,MAAhB6qF,EAAI7qF,SAAmB,IAAIxR,EAAUq8F,EAAI7qF,UAAY,KACvEtc,EAAO6iD,aAAeskD,EAAItkD,aACnB7iD,CACT,CAKA,WAAAhI,CAAY22B,GAFZ,KAAAk0B,aAAqB,KAGV,MAALl0B,IAIJn2B,KAAK8jB,SAAW6tH,GAAcx7G,EAAErS,UAChC9jB,KAAKqqD,aAAel0B,EAAEk0B,aACxB,EChCK,MAAMioF,GACX,eAAOT,GACL,MAAMljC,EAAM,IAAI2jC,GAEhB,OADA3jC,EAAIrhG,KAAO45C,GAAewoF,QACnB/gC,CACT,CAEA,aAAOmjC,CAAOnjC,EAAuBp8C,EAAO,IAAId,IAE9C,OADAc,EAAKjlD,KAAOqhG,EAAIrhG,KACTilD,CACT,CAEA,eAAOw/E,CAASpjC,EAAuBp8C,EAAO,IAAIpH,IAEhD,OADAoH,EAAKjlD,KAAOqhG,EAAIrhG,KACTilD,CACT,CAIA,WAAA/yD,CAAY22B,GACD,MAALA,IAIJn2B,KAAKsN,KAAO6oB,EAAE7oB,KAChB,ECfK,MAAMilI,GAAb,cAyHE,KAAA7mF,gBAA2C,KAC3C,KAAAnnB,aAAqB,KACrB,KAAAD,aAAqB,KACrB,KAAAymB,YAAoB,IA6CtB,CAxKE,eAAO8mF,GACL,MAAMljC,EAAM,IAAI4jC,GAkBhB,OAjBA5jC,EAAI14E,eAAiB,KACrB04E,EAAInkD,cAAgB,KACpBmkD,EAAIlkD,SAAW,KACfkkD,EAAIrhG,KAAOs5C,GAAWqE,MACtB0jD,EAAIntG,KAAO,YACXmtG,EAAI7jD,MAAQ,8BACZ6jD,EAAI9jD,UAAW,EACf8jD,EAAInjD,OAAS,GACbmjD,EAAIzjD,MAAQ,KACZyjD,EAAIvjD,WAAa,KACjBujD,EAAIrjD,KAAO,KACXqjD,EAAIxuD,SAAW,KACfwuD,EAAI3jD,SAAWnE,GAAmB98B,KAClC4kF,EAAIjjD,gBAAkB,GACtBijD,EAAIrqE,aAAe,KACnBqqE,EAAIpqE,aAAe,KACnBoqE,EAAI5jD,YAAc,KACX4jD,CACT,CAEA,aAAOmjC,CAAOnjC,EAAmBp8C,EAAO,IAAIZ,I,UAM1C,GALAY,EAAKjlD,KAAOqhG,EAAIrhG,KAChBilD,EAAK9H,SAAWkkD,EAAIlkD,SACO,MAAvB8H,EAAKt8B,iBACPs8B,EAAKt8B,eAAiB04E,EAAI14E,gBAExBs8B,EAAK/H,eAAiBmkD,EAAInkD,cAAe,CAC3C,MAAMziD,EAAM,IAAImF,KAAuB,QAAlB,EAAAqlD,EAAK/H,qBAAa,QAAI,IAAI8rD,OAAwB,QAAjB,EAAA3H,EAAInkD,qBAAa,QAAI,KAC3E+H,EAAK/H,cAAgBjmD,MAAMlC,KAAK0F,EAAIqvB,S,CAWtC,OATAm7B,EAAK/wD,KAAOmtG,EAAIntG,KAChB+wD,EAAKzH,MAAQ6jD,EAAI7jD,MACjByH,EAAK1H,SAAW8jD,EAAI9jD,SACpB0H,EAAKvH,SAAuB,QAAZ,EAAA2jD,EAAI3jD,gBAAQ,QAAInE,GAAmB98B,KAEjC,MAAd4kF,EAAInjD,SACN+G,EAAK/G,OAASmjD,EAAInjD,OAAO/mD,KAAKw0B,GAAM+4G,GAAYF,OAAO74G,MAGjD01E,EAAIrhG,MACV,KAAKs5C,GAAWqE,MACdsH,EAAKrH,MAAQknF,GAAYN,OAAOnjC,EAAIzjD,OACpC,MACF,KAAKtE,GAAWuE,WACdoH,EAAKnH,WAAaknF,GAAiBR,OAAOnjC,EAAIvjD,YAC9C,MACF,KAAKxE,GAAWyE,KACdkH,EAAKjH,KAAOsmF,GAAWE,OAAOnjC,EAAIrjD,MAClC,MACF,KAAK1E,GAAW2E,SACdgH,EAAKpS,SAAW8xF,GAAeH,OAAOnjC,EAAIxuD,UAW9C,OAP2B,MAAvBwuD,EAAIjjD,kBACN6G,EAAK7G,gBAAkBijD,EAAIjjD,gBAAgBjnD,KAAKknD,GAAO0mF,GAAsBP,OAAOnmF,MAGtF4G,EAAKjuB,aAAeqqE,EAAIrqE,aACxBiuB,EAAKhuB,aAAeoqE,EAAIpqE,aACxBguB,EAAKxH,YAAc4jD,EAAI5jD,YAChBwH,CACT,CAEA,eAAOw/E,CAASpjC,EAAmBnnG,EAAS,IAAImsD,I,MAgB9C,OAfAnsD,EAAO8F,KAAOqhG,EAAIrhG,KAClB9F,EAAOijD,SAAWkkD,EAAIlkD,SACO,MAAzBjjD,EAAOyuB,iBACTzuB,EAAOyuB,eAAiB04E,EAAI14E,gBAE9BzuB,EAAOhG,KAAmB,MAAZmtG,EAAIntG,KAAe,IAAI8Q,EAAUq8F,EAAIntG,MAAQ,KAC3DgG,EAAOsjD,MAAqB,MAAb6jD,EAAI7jD,MAAgB,IAAIx4C,EAAUq8F,EAAI7jD,OAAS,KAC9DtjD,EAAOqjD,SAAW8jD,EAAI9jD,SACtBrjD,EAAOwjD,SAAuB,QAAZ,EAAA2jD,EAAI3jD,gBAAQ,QAAInE,GAAmB98B,KACrDviB,EAAO2I,IAAiB,MAAXw+F,EAAIx+F,IAAc,IAAImC,EAAUq8F,EAAIx+F,KAAO,KAEtC,MAAdw+F,EAAInjD,SACNhkD,EAAOgkD,OAASmjD,EAAInjD,OAAO/mD,KAAKw0B,GAAM+4G,GAAYD,SAAS94G,MAGrD01E,EAAIrhG,MACV,KAAKs5C,GAAWqE,MACdzjD,EAAO0jD,MAAQknF,GAAYL,SAASpjC,EAAIzjD,OACxC,MACF,KAAKtE,GAAWuE,WACd3jD,EAAO4jD,WAAaknF,GAAiBP,SAASpjC,EAAIvjD,YAClD,MACF,KAAKxE,GAAWyE,KACd7jD,EAAO8jD,KAAOsmF,GAAWG,SAASpjC,EAAIrjD,MACtC,MACF,KAAK1E,GAAW2E,SACd/jD,EAAO24C,SAAW8xF,GAAeF,SAASpjC,EAAIxuD,UAWlD,OAP2B,MAAvBwuD,EAAIjjD,kBACNlkD,EAAOkkD,gBAAkBijD,EAAIjjD,gBAAgBjnD,KAAKknD,GAAO0mF,GAAsBN,SAASpmF,MAG1FnkD,EAAO88B,aAAeqqE,EAAIrqE,aAC1B98B,EAAO+8B,aAAeoqE,EAAIpqE,aAC1B/8B,EAAOujD,YAAc4jD,EAAI5jD,YAClBvjD,CACT,CAsBA,KAAAo7E,CAAMzsD,G,MAkBJ,OAjBAn2B,KAAKi2B,eAAiBE,EAAEF,eACxBj2B,KAAKyqD,SAAWt0B,EAAEs0B,SAClBzqD,KAAKsN,KAAO6oB,EAAE7oB,KACdtN,KAAKgrD,SAAW70B,EAAE60B,SAElBhrD,KAAKwB,KAAOmwI,GAAcx7G,EAAE30B,MAC5BxB,KAAK8qD,MAAQ6mF,GAAcx7G,EAAE20B,OACzB,QAAS30B,IACXn2B,KAAKmQ,IAAW,QAAL,EAAAgmB,EAAEhmB,WAAG,eAAE6C,iBAGpBhT,KAAK6qD,SAAW10B,EAAE00B,SAEF,MAAZ10B,EAAEq1B,SACJxrD,KAAKwrD,OAASr1B,EAAEq1B,OAAO/mD,KAAKw0B,GAAM,IAAI+4G,GAAY/4G,MAG5C9C,EAAE7oB,MACR,KAAKs5C,GAAWqE,MACdjrD,KAAKkrD,MAAQ,IAAIknF,GAAYj8G,EAAE+0B,OAC/B,MACF,KAAKtE,GAAWuE,WACdnrD,KAAKorD,WAAa,IAAIknF,GAAiBn8G,EAAEi1B,YACzC,MACF,KAAKxE,GAAWyE,KACdrrD,KAAKsrD,KAAO,IAAIsmF,GAAWz7G,EAAEm1B,MAC7B,MACF,KAAK1E,GAAW2E,SACdvrD,KAAKmgD,SAAW,IAAI8xF,GAAe97G,EAAEgqB,UAIhB,MAArBhqB,EAAEu1B,kBACJ1rD,KAAK0rD,gBAAkBv1B,EAAEu1B,gBAAgBjnD,KAAKknD,GAAO,IAAI0mF,GAAsB1mF,MAGjF3rD,KAAKskC,aAAenO,EAAEmO,aACtBtkC,KAAKukC,aAAepO,EAAEoO,aACtBvkC,KAAK+qD,YAAc50B,EAAE40B,WACvB,ECjLK,MAAMynF,WAA2BD,GAKtC,KAAA3vD,CAAMzsD,GACJn2B,KAAKoG,GAAK+vB,EAAE/vB,GACZqH,MAAMm1E,MAAMzsD,GACZn2B,KAAKwqD,cAAgBr0B,EAAEq0B,aACzB,ECRK,MAAMioF,GACX,eAAOZ,GACL,MAAMljC,EAAM,IAAI8jC,GAIhB,OAHA9jC,EAAI14E,eAAiB,uCACrB04E,EAAIntG,KAAO,kBACXmtG,EAAIpf,WAAa,KACVof,CACT,CAEA,aAAOmjC,CAAOnjC,EAAuBp8C,EAAO,IAAIyvE,IAM9C,OALAzvE,EAAK/wD,KAAOmtG,EAAIntG,KAChB+wD,EAAKg9B,WAAaof,EAAIpf,WACK,MAAvBh9B,EAAKt8B,iBACPs8B,EAAKt8B,eAAiB04E,EAAI14E,gBAErBs8B,CACT,CAEA,eAAOw/E,CAASpjC,EAAuBnnG,EAAS,IAAIy6H,IAMlD,OALAz6H,EAAOhG,KAAmB,MAAZmtG,EAAIntG,KAAe,IAAI8Q,EAAUq8F,EAAIntG,MAAQ,KAC3DgG,EAAO+nF,WAAaof,EAAIpf,WACK,MAAzB/nF,EAAOyuB,iBACTzuB,EAAOyuB,eAAiB04E,EAAI14E,gBAEvBzuB,CACT,CAOA,KAAAo7E,CAAMzsD,GACJn2B,KAAKi2B,eAAiBE,EAAEF,eACxBj2B,KAAKwB,KAAOmwI,GAAcx7G,EAAE30B,MAC5BxB,KAAKuvF,WAAap5D,EAAEo5D,UACtB,ECrCK,MAAMmjD,WAA+BD,GAG1C,aAAOX,CAAOnjC,EAA6Bp8C,EAAO,IAAIyvE,IAEpD,OADAzvE,EAAKnsD,GAAKuoG,EAAIvoG,GACPqH,MAAMqkI,OAAOnjC,EAAKp8C,EAC3B,CAEA,eAAOw/E,CAASpjC,EAA6BnnG,EAAS,IAAIy6H,IAExD,OADAz6H,EAAOpB,GAAKuoG,EAAIvoG,GACTqH,MAAMskI,SAASpjC,EAAKnnG,EAC7B,CAGA,KAAAo7E,CAAMzsD,GACJn2B,KAAKoG,GAAK+vB,EAAE/vB,GACZqH,MAAMm1E,MAAMzsD,EACd,EChBK,MAAMw8G,GACX,eAAOd,GACL,MAAMljC,EAAM,IAAIgkC,GAEhB,OADAhkC,EAAIntG,KAAO,cACJmtG,CACT,CAEA,aAAOmjC,CAAOnjC,EAAmBp8C,EAAO,IAAIgzE,IAE1C,OADAhzE,EAAK/wD,KAAOmtG,EAAIntG,KACT+wD,CACT,CAEA,eAAOw/E,CAASpjC,EAAmBnnG,EAAS,IAAIg+H,IAE9C,OADAh+H,EAAOhG,KAAmB,MAAZmtG,EAAIntG,KAAe,IAAI8Q,EAAUq8F,EAAIntG,MAAQ,KACpDgG,CACT,CAKA,KAAAo7E,CAAMzsD,GACJn2B,KAAKwB,KAAOmwI,GAAcx7G,EAAE30B,KAC9B,ECvBK,MAAMoxI,WAA2BD,GAGtC,aAAOb,CAAOnjC,EAAyBp8C,EAAO,IAAIgzE,IAEhD,OADAhzE,EAAKnsD,GAAKuoG,EAAIvoG,GACPqH,MAAMqkI,OAAOnjC,EAAKp8C,EAC3B,CAEA,eAAOw/E,CAASpjC,EAAyBnnG,EAAS,IAAIg+H,IAEpD,OADAh+H,EAAOpB,GAAKuoG,EAAIvoG,GACTqH,MAAMskI,SAASpjC,EAAKnnG,EAC7B,CAGA,KAAAo7E,CAAMzsD,GACJn2B,KAAKoG,GAAK+vB,EAAE/vB,GACZqH,MAAMm1E,MAAMzsD,EACd,E,2SCKK,MAAM08G,WAA8B,GAGzC,YACY/+H,EACA5L,EACAs1D,EACA1sB,GAEVrjC,QALU,KAAAqG,cAAAA,EACA,KAAA5L,YAAAA,EACA,KAAAs1D,cAAAA,EACA,KAAA1sB,WAAAA,CAGZ,CAEM,KAAApC,CAAMl8B,G,0CACVxS,KAAK2kC,OAAS,IAAI,GAClB,MAAM6hB,EAA+B/7B,KAAKikB,MAAMl8B,GAChD,OAAe,MAAXg0C,GAAoC,MAAjBA,EAAQD,OAC7BvmD,KAAK2kC,OAAOwxD,SAAU,EACfn2F,KAAK2kC,SAGV6hB,EAAQ7+B,gBACJ3nB,KAAK8yI,eAAetsF,SAEpBxmD,KAAK+yI,eAAevsF,GAGrBxmD,KAAK2kC,OACd,G,CAEc,cAAAmuG,CACZtsF,G,0CAEA,GAA4C,MAAxCA,EAAQwsF,6BAAsC,CAChD,MAAMtQ,QAAe1iI,KAAK8T,cAAcE,UAAUhU,KAAKi2B,gBACjDg9G,EAAmB,IAAI3gI,EAAUk0C,EAAQwsF,8BAK/C,GAAgC,cAJMhzI,KAAK8T,cAAcD,cACvDo/H,EACAvQ,IAKA,OAFA1iI,KAAK2kC,OAAOwxD,SAAU,OACtBn2F,KAAK2kC,OAAO9oB,aAAe7b,KAAKkI,YAAYovB,EAAE,qB,CAKlD,MAAM47G,EAAelzI,KAAK82B,mBAChB92B,KAAKmzI,iBAAiB3sF,SACtBxmD,KAAKozI,aAAa5sF,GAE5B,IAAK,MAAMzgD,KAAKygD,EAAQD,MAAO,CAC7B,MAAMyY,EAASwzE,GAAmBT,SAAShsI,GAE3Ci5D,EAAO54D,GAAK,KACZ44D,EAAO/oC,eAAiBj2B,KAAKi2B,eAC7B+oC,EAAOxU,cAAgB,KAGO,MAA1BwU,EAAOtT,iBAA2BsT,EAAOtT,gBAAgBjpD,OAAS,IACpEu8D,EAAOtT,gBAAkBsT,EAAOtT,gBAAgB9mD,MAAM,EAAG,KAGtD5E,KAAK82B,cAA8B,MAAd/wB,EAAE0kD,UAAoByoF,EAAapiF,IAAI/qD,EAAE0kD,UACjEzqD,KAAK2kC,OAAOwnG,oBAAoBvxH,KAAK,CACnC5a,KAAK2kC,OAAOg2C,QAAQl4E,OACpBywI,EAAaj5H,IAAIlU,EAAE0kD,YAEZzqD,KAAK82B,cAAmC,MAAnB/wB,EAAEykD,eAChCzkD,EAAEykD,cAAc5iD,SAASw+H,IACnB8M,EAAapiF,IAAIs1E,IACnBpmI,KAAK2kC,OAAO0nG,wBAAwBzxH,KAAK,CACvC5a,KAAK2kC,OAAOg2C,QAAQl4E,OACpBywI,EAAaj5H,IAAImsH,I,IAMzB,MAAM7zE,QAAayM,EAAOzrD,cAClBvT,KAAKw9D,cAAc0C,6BAA6BlB,IAExDh/D,KAAKkvI,cAAc38E,GACnBvyD,KAAK2kC,OAAOg2C,QAAQ//D,KAAK23C,E,CAG3BvyD,KAAK2kC,OAAOwxD,SAAU,CACxB,G,CAEc,cAAA48C,CACZvsF,G,0CAEA,MAAM0sF,EAAelzI,KAAK82B,mBAChB92B,KAAKmzI,iBAAiB3sF,SACtBxmD,KAAKozI,aAAa5sF,GAE5BA,EAAQD,MAAM3+C,SAAS7B,IACrB,MAAMi5D,EAASwzE,GAAmBV,OAAO/rI,GAEzCi5D,EAAO54D,GAAK,KACZ44D,EAAO/oC,eAAiB,KACxB+oC,EAAOxU,cAAgB,KAGO,MAA1BwU,EAAOtT,iBAA2BsT,EAAOtT,gBAAgBjpD,OAAS,IACpEu8D,EAAOtT,gBAAkBsT,EAAOtT,gBAAgB9mD,MAAM,EAAG,KAGtD5E,KAAK82B,cAA8B,MAAd/wB,EAAE0kD,UAAoByoF,EAAapiF,IAAI/qD,EAAE0kD,UACjEzqD,KAAK2kC,OAAOwnG,oBAAoBvxH,KAAK,CACnC5a,KAAK2kC,OAAOg2C,QAAQl4E,OACpBywI,EAAaj5H,IAAIlU,EAAE0kD,YAEZzqD,KAAK82B,cAAmC,MAAnB/wB,EAAEykD,eAChCzkD,EAAEykD,cAAc5iD,SAASw+H,IACnB8M,EAAapiF,IAAIs1E,IACnBpmI,KAAK2kC,OAAO0nG,wBAAwBzxH,KAAK,CACvC5a,KAAK2kC,OAAOg2C,QAAQl4E,OACpBywI,EAAaj5H,IAAImsH,I,IAMzBpmI,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGlCh/D,KAAK2kC,OAAOwxD,SAAU,CACxB,G,CAEc,YAAAi9C,CACZ5gI,G,0CAEA,GAAoB,MAAhBA,EAAKq8D,QACP,OAAO,KAGT,MAAMqkE,EAAe,IAAItzI,IAEzB,IAAK,MAAMq5B,KAAKzmB,EAAKq8D,QAAS,CAC5B,IAAIwkE,EACJ,GAAI7gI,EAAKmV,UAAW,CAClB,MAAMq0G,EAAS4W,GAAmBb,SAAS94G,GAC7B,MAAV+iG,IACFqX,QAAmBrX,EAAOzoH,U,MAG5B8/H,EAAaT,GAAmBd,OAAO74G,GAGvB,MAAdo6G,IACFH,EAAanrI,IAAIkxB,EAAE7yB,GAAIpG,KAAK2kC,OAAOkqC,QAAQpsE,QAC3CzC,KAAK2kC,OAAOkqC,QAAQj0D,KAAKy4H,G,CAG7B,OAAOH,CACT,G,CAEc,gBAAAC,CACZ3gI,G,0CAEA,GAAwB,MAApBA,EAAKi+D,YACP,OAAO,KAGT,MAAMyiE,EAAe,IAAItzI,IAEzB,IAAK,MAAMmG,KAAKyM,EAAKi+D,YAAa,CAChC,IAAI6iE,EACJ,GAAI9gI,EAAKmV,UAAW,CAClB,MAAMg8G,EAAa+O,GAAuBX,SAAShsI,GACnD49H,EAAW1tG,eAAiBj2B,KAAKi2B,eACjCq9G,QAAuB,OAAetzI,KAAK8T,cAAcwwH,oBAAoB96G,MAC1EkyG,GAAYiI,EAAWpwH,QAAQmoH,EAAQ31H,EAAEkwB,kB,MAG5Cq9G,EAAiBZ,GAAuBZ,OAAO/rI,GAC/CutI,EAAer9G,eAAiB,KAGZ,MAAlBq9G,IACFJ,EAAanrI,IAAIhC,EAAEK,GAAIpG,KAAK2kC,OAAO8rC,YAAYhuE,QAC/CzC,KAAK2kC,OAAO8rC,YAAY71D,KAAK04H,G,CAGjC,OAAOJ,CACT,G,6SClMK,MAAMK,WAA2CV,GAGtD,WAAArzI,CACEsU,EACA5L,EACAs1D,EACA1sB,EACQ0iG,GAER/lI,MAAMqG,EAAe5L,EAAas1D,EAAe1sB,GAFzC,KAAA0iG,2BAAAA,CAGV,CAEM,KAAA9kG,CAAMl8B,G,oGACV,MAAMmyB,EAAS,IAAI,GACb8uG,EAAmDhpH,KAAKikB,MAAMl8B,GAEpE,IAAKihI,EAEH,OADA9uG,EAAOwxD,SAAU,EACVxxD,EAIT,KAAK8uG,aAAU,EAAVA,EAAY9rH,WACf,aAAa,EAAM+mB,MAAK,UAACl8B,GAI3B,KAAKihI,aAAU,EAAVA,EAAYC,mBACf,aAAa,EAAMhlG,MAAK,UAACl8B,GAG3B,GAAIxS,KAAK2zI,gBAAgBF,GAEvB,OADA9uG,EAAOwxD,SAAU,EACVxxD,EAIT,MAAM7gB,QAAiB9jB,KAAKwzI,6BAC5B,WAAYxzI,KAAK4zI,cAAcH,EAAY3vH,IAGzC,OAFA6gB,EAAOwxD,SAAU,EACjBxxD,EAAO9oB,aAAe7b,KAAKkI,YAAYovB,EAAE,uBAClCqN,EAGT,MAAM+5F,EAAU,IAAIpsH,EAAUmhI,EAAWjhI,MACnCqhI,QAAsB7zI,KAAK8T,cAAcD,cAAc6qH,EAAS1+H,KAAKmQ,KAC3E,aAAa,EAAMu+B,MAAK,UAACmlG,EAC3B,G,CAEc,aAAAD,CACZE,EACAhwH,G,0CAEA,GAAI9jB,KAAK0G,mBAAmBod,GAC1B,OAAO,EAGT,MAAMpG,EACJo2H,EAAK9kI,UAAY,EAAQC,cACrB,IAAI,EAAgB6kI,EAAK7tH,eACzB,IAAI,EAAgB6tH,EAAK7tH,cAAe6tH,EAAK5tH,UAAW4tH,EAAK3tH,gBAEnEnmB,KAAKmQ,UAAYnQ,KAAK8wC,WAAWjzB,WAAWiG,EAAUgwH,EAAKt1H,KAAMd,GAEjE,MAAMu1H,EAAmB,IAAI3gI,EAAUwhI,EAAKd,8BAM5C,OAAgC,cAJMhzI,KAAK8T,cAAcD,cACvDo/H,EACAjzI,KAAKmQ,KAMT,G,CAEQ,eAAAwjI,CAAgBG,GACtB,QACGA,GACAA,EAAKnsH,WACLmsH,EAAKJ,mBACLI,EAAKt1H,MACLs1H,EAAK7tH,eACwB,iBAAvB6tH,EAAK7tH,eACI,MAAhB6tH,EAAK9kI,SACoB,MAAzB,EAAQ8kI,EAAK9kI,UACZ8kI,EAAKd,8BACLc,EAAKthI,KAEV,ECxGK,MAAMuhI,WAAwB,GACnC,KAAArlG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACK,SAAhBA,EAAMugI,QACRvgI,EAAMugI,MAAQ,MAEhB,MAAMrxE,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBACjBv+H,EAAMugI,MACNrwI,KAAKquI,kBAAkBruI,KAAKouI,YAAYt+H,EAAMtI,QAAS,OAEzDw3D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMtI,QAC5Cw3D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UAEjD9jB,KAAK0G,mBAAmBoJ,EAAMe,SAAW7Q,KAAK0G,mBAAmBoJ,EAAM+T,UACzEm7C,EAAO9T,MAAMrnC,SAAW/T,EAAM+T,UAE9Bm7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMe,OACrDmuD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM+T,WAG9C7jB,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EClCF,MAAMqvG,GAAgB,CAAC,YAAa,cAAe,QAAS,WAAY,WAAY,MAAO,MAEpF,MAAMC,WAA6B,GACxC,KAAAvlG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf9P,KAAKovI,cAAczqG,EAAQ3kC,KAAKquI,kBAAkBv+H,EAAM,iBAExD,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMi4C,MAAO,MAClDiX,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMjD,KAE5C,IAAIqnI,GAAyB,EAC7B,IAAK,MAAM/rI,KAAQ2H,EAEbA,EAAM8R,eAAezZ,KAClB+rI,IAA2D,IAAjCF,GAAcntI,QAAQsB,KACnD+rI,GAAyB,GAEvBA,GACFl0I,KAAKmvI,WAAWnwE,EAAQ72D,EAAM2H,EAAM3H,KAK1CnI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EC3CK,MAAMwvG,WAA6B,GACxC,KAAAzlG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACbyoG,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAzoG,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMyvG,EAAWhH,EAAIG,cAAc,YACnC,GAAgB,MAAZ6G,GAAoBp0I,KAAK0G,mBAAmB0tI,EAASC,aAGvD,OAFA1vG,EAAO9oB,aAAe,oBACtB8oB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAmEzB,OAhEgBla,KAAKikB,MAAM0lG,EAASC,aAC5BzsI,SAAS0sI,IACf,MAAMt1E,EAASh/D,KAAKivI,kBAQpB,GAPKjvI,KAAK0G,mBAAmB4tI,EAAMjE,SACjCrxE,EAAOx9D,KAAO8yI,EAAMjE,MAAM1oI,MAAM,MAAM,IAEtB,MAAd2sI,EAAM9hI,MAAiBxS,KAAK0G,mBAAmB4tI,EAAM9hI,KAAKs4C,SAC5DkU,EAAOlU,MAAQwpF,EAAM9hI,KAAKs4C,MAAMnjD,MAAM,OAAO9C,KAAK,OAGxB,MAAxByvI,EAAMhoE,gBAAyD,MAA/BgoE,EAAMhoE,eAAe9gB,OACvD,IAAK,MAAM+oF,KAAYD,EAAMhoE,eAAe9gB,OAAQ,CAElD,IAAK8oF,EAAMhoE,eAAe9gB,OAAO5pC,eAAe2yH,GAC9C,SAGF,MAAMvgF,EAAQsgF,EAAMhoE,eAAe9gB,OAAO+oF,GAE1C,OADuC,MAApBvgF,EAAMwgF,WAAqBxgF,EAAMwgF,WAAWxsI,cAAgB,MAE7E,IAAK,WACHg3D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBr6E,EAAMlkD,OACrD,MACF,IAAK,QACL,IAAK,WACL,IAAK,OACL,IAAK,OACHkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBr6E,EAAMlkD,OACrD,MACF,IAAK,MACHkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaj6E,EAAMlkD,OAC5C,MACF,QAAS,CACP,MAAM2kI,EAA4B,MAAfzgF,EAAMq8E,MAAgBr8E,EAAMq8E,MAAMroI,cAAgB,KAE1C,MAAzBg3D,EAAO9T,MAAMpnC,UACb9jB,KAAK2sI,mBAAmB9lI,QAAQ4tI,IAAe,EAE/Cz1E,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBr6E,EAAMlkD,OAE5B,MAAzBkvD,EAAO9T,MAAMrnC,UACb7jB,KAAK4sI,mBAAmB/lI,QAAQ4tI,IAAe,EAE/Cz1E,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBr6E,EAAMlkD,QAE/B,MAArBkvD,EAAO9T,MAAMjB,MAA6C,IAA7B+U,EAAO9T,MAAMjB,KAAKxnD,SAChDzC,KAAK8sI,cAAcjmI,QAAQ4tI,IAAe,EAE1Cz1E,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaj6E,EAAMlkD,OAE5C9P,KAAKmvI,WAAWnwE,EAAQhL,EAAMq8E,MAAOr8E,EAAMlkD,OAE7C,K,GAMR9P,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,ECjFK,MAAM+vG,WAA4B,GACvC,KAAAhmG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf9P,KAAKovI,cAAczqG,EAAQ3kC,KAAKquI,kBAAkBv+H,EAAM6kI,WAExD,MAAM31E,EAASh/D,KAAKivI,kBACpBjwE,EAAOnU,SAAsD,SAA3C7qD,KAAKquI,kBAAkBv+H,EAAM8kI,UAC/C51E,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM+kI,MAAO,MAClD71E,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMglI,MAC5C91E,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm/C,SAAUn/C,EAAMg/C,OACrEkQ,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAMilI,MACjD/1E,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMklI,SAEvCh1I,KAAK0G,mBAAmBoJ,EAAMm/C,WACjCjvD,KAAKmvI,WAAWnwE,EAAQ,QAASlvD,EAAMg/C,OAEzC9uD,KAAKmvI,WAAWnwE,EAAQ,QAASlvD,EAAMi/C,OACvC/uD,KAAKmvI,WAAWnwE,EAAQ,MAAOlvD,EAAM2iC,KACrCzyC,KAAKmvI,WAAWnwE,EAAQ,UAAWlvD,EAAMmlI,SACzCj1I,KAAKmvI,WAAWnwE,EAAQ,OAAQlvD,EAAMtD,MAEtCxM,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EC3BF,MAAMuwG,GAA4B,IAAIhoI,IAAI,CACxC,QACA,OACA,WACA,WACA,MACA,YACA,aAGIioI,GAAuC,IAAIjoI,IAAI,CACnD,OACA,QACA,aACA,cACA,YACA,QACA,QACA,eACA,UACA,UACA,QACA,OACA,MAEA,cAGIkoI,GAA2B,IAAIloI,IAAI,CAAC,QAAS,SAE5C,MAAMmoI,WAA4B,GACvC,KAAA3mG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,GAAuB,MAAnB6hB,EAAQ,GAAGl5C,MAAoC,MAApBk5C,EAAQ,GAAGuB,MAAe,CAIvD,GAAgE,IAHxCvB,EAGJ9mD,QAAQiF,GAAiB,SAAXA,EAAE2I,OAAiB7K,OAAc,CACjE,MAAMu8D,EAASh/D,KAAKivI,kBASpB,OARAjwE,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,GACtBrH,EAAQ5+C,SAASimI,IACf7tI,KAAKs1I,yCAAyCt2E,EAAQ6uE,EAAI,IAE5D7tI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,GACpBr6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,E,EAuC3B,OAnCA6hB,EAAQ5+C,SAASimI,IACf,MAAM7uE,EAASh/D,KAAKivI,kBAEdsG,EAAUtsI,OAAOE,KAAK0kI,GACT,aAAf0H,EAAQ,KACVv1I,KAAKovI,cAAczqG,EAAQkpG,EAAIryB,UAC/Bx7G,KAAKw1I,uBAAuBx2E,EAAQ6uE,IAGnB,SAAf0H,EAAQ,IAAgC,iBAAfA,EAAQ,IACnCv1I,KAAKy1I,mBAAmBz2E,EAAQ6uE,GAGf,SAAf0H,EAAQ,IAAgC,WAAfA,EAAQ,IACnCv1I,KAAK01I,cAAc12E,EAAQ6uE,GAGT,SAAf0H,EAAQ,IAAkB,MAAuB,UAAfA,EAAQ,IAC7Cv1I,KAAK21I,+BAA+B32E,EAAQ6uE,GAG3B,UAAf0H,EAAQ,IAAiC,SAAfA,EAAQ,IACpCv1I,KAAK41I,uBAAuB52E,EAAQ6uE,GAGtC7tI,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEA,sBAAA6wG,CAAuBx2E,EAAoB6uE,GACzC7uE,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAO9T,MAAQ,IAAI8F,GAEnBgO,EAAOx9D,KAAOqsI,EAAI9lF,MAClBiX,EAAOlU,MAAQ+iF,EAAIpiB,KACnBzsD,EAAO9T,MAAMrnC,SAAWgqH,EAAIhqH,SAC5Bm7C,EAAO9T,MAAMpnC,SAAW+pH,EAAI/pH,SAC5Bk7C,EAAO9T,MAAMnB,KAAO8jF,EAAIgI,UACxB72E,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaJ,EAAI5mI,KAE1CjH,KAAK81I,qBAAqB92E,EAAQ6uE,EAAKqH,GACzC,CAEA,kBAAAO,CAAmBz2E,EAAoB6uE,GACrC7uE,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAElB4S,EAAOx9D,KAAOqsI,EAAIkI,aAClB,IAAIC,EAAyB,GAC7B,OAAQnI,EAAIvgI,MACV,IAAK,cACH0xD,EAAO1T,KAAK/D,eAAiBsmF,EAAIkI,aACjC/2E,EAAO1T,KAAK7D,OAASomF,EAAIoI,UACzBj3E,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAKthC,KAAO6jH,EAAI7jH,KACvBhqB,KAAKsuI,kBAAkBtvE,EAAQ,GAAG6uE,EAAIqI,oBAAoBrI,EAAIsI,mBAG9DH,EAAe,CACb,eACA,iBACA,YACA,OACA,mBACA,mBAEF,MACF,IAAK,OACHh3E,EAAO1T,KAAK/D,eAAiBsmF,EAAIuI,eACjCp3E,EAAO1T,KAAK7D,OAASomF,EAAIwI,eAGzBL,EAAe,CAAC,eAAgB,iBAAkB,kBAMtDh2I,KAAK81I,qBAAqB92E,EAAQ6uE,EAAK,IAAI3gI,IAAI8oI,GACjD,CAEA,aAAAN,CAAc12E,EAAoB6uE,GAChC7uE,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,GAEtB,MAAMmoF,EAAyB,CAAC,OAAQ,UACxC,OAAQnI,EAAIvgI,MACV,IAAK,OACH0xD,EAAOx9D,KAAO,GAAGqsI,EAAIrsI,QAAQqsI,EAAIvgI,OACjCtN,KAAK2vI,gBAAgB3wE,EAAQ6uE,EAAIrsI,MACjCw9D,EAAO7e,SAAS0I,cAAgBglF,EAAIpmF,OACpC,MACF,IAAK,WACHuX,EAAOx9D,KAAO,GAAGqsI,EAAIrsI,QAAQqsI,EAAIvgI,OACjCtN,KAAK2vI,gBAAgB3wE,EAAQ6uE,EAAIrsI,MACjCw9D,EAAO7e,SAASyI,eAAiBilF,EAAIpmF,OACrC,MACF,IAAK,UACHuX,EAAOx9D,KAAO,GAAGqsI,EAAIrsI,QAAQqsI,EAAIvgI,OACjCtN,KAAK2vI,gBAAgB3wE,EAAQ6uE,EAAIrsI,MACjCw9D,EAAO7e,SAAS0I,cAAgBglF,EAAIpmF,OACpCuX,EAAO7e,SAAS3lC,MAAQqzH,EAAIrzH,MAE5Bw7H,EAAap7H,KAAK,SAClB,MACF,IAAK,kBACHokD,EAAOx9D,KAAO,GAAGqsI,EAAIrsI,QAAQqsI,EAAIvgI,OACjCtN,KAAK2vI,gBAAgB3wE,EAAQ6uE,EAAIrsI,MACjCw9D,EAAO7e,SAASwI,IAAMklF,EAAIpmF,OAC1B,MACF,IAAK,aACHuX,EAAOx9D,KAAOqsI,EAAIvgI,KAClB0xD,EAAO7e,SAAS0I,cAAgBglF,EAAIpmF,OAQxCznD,KAAK81I,qBAAqB92E,EAAQ6uE,EAAK,IAAI3gI,IAAI8oI,GACjD,CAEA,8BAAAL,CAA+B32E,EAAoB6uE,GACjD7uE,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACvB,SAAb7B,EAAIvgI,KACN0xD,EAAOx9D,KAAO,GAAGqsI,EAAI9lF,SAAS8lF,EAAIyI,cAAczI,EAAI0I,eAAe1I,EAAI2I,YACpEtyI,QAAQ,KAAM,KACdyC,OAEHq4D,EAAOx9D,KAAOqsI,EAAI4I,UAGpB,MAAMC,EAAU7I,EAChB5kI,OAAOE,KAAK0kI,GAAKjmI,SAASuI,IACxBnQ,KAAKmvI,WAAWnwE,EAAQ7uD,EAAKumI,EAAQvmI,GAAK,GAE9C,CAEA,wCAAAmlI,CAAyCt2E,EAAoB6uE,GAC3D,OAAQA,EAAIvgI,MACV,IAAK,OACHtN,KAAK2vI,gBAAgB3wE,EAAQ,GAAG6uE,EAAIyI,cAAczI,EAAI0I,eAAe1I,EAAI2I,aACzEx3E,EAAO7e,SAAS4H,MAAQ8lF,EAAI9lF,MAC5BiX,EAAOx9D,KAAOw9D,EAAO7e,SAASzqC,SAE9BspD,EAAO7e,SAASt8B,SAAWgqH,EAAI3iF,MAC/B,MACF,IAAK,QACH8T,EAAO7e,SAAStvC,MAAQg9H,EAAIh9H,MAC5B,MACF,IAAK,SACHmuD,EAAO7e,SAASuI,MAAQmlF,EAAI8I,aAC5B,MACF,IAAK,UACH33E,EAAO7e,SAASgI,SAAW0lF,EAAI5/E,QAC/B+Q,EAAO7e,SAASmI,KAAOulF,EAAIvlF,KAC3B0W,EAAO7e,SAASoI,WAAaslF,EAAIx/B,IACjCrvC,EAAO7e,SAAS3lC,MAAQqzH,EAAIrzH,MAC5BwkD,EAAO7e,SAASqI,QAAUqlF,EAAIrlF,QAMlCxoD,KAAK81I,qBAAqB92E,EAAQ6uE,EAAKsH,GACzC,CAEA,sBAAAS,CAAuB52E,EAAoB6uE,GACzC7uE,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOx9D,KAAOqsI,EAAI9lF,MAClBiX,EAAOlU,MAAQ+iF,EAAIpiB,KAEnBzrH,KAAK81I,qBAAqB92E,EAAQ6uE,EAAKuH,GACzC,CAEA,oBAAAU,CAAqB92E,EAAoB6uE,EAAUmI,GAC1B/sI,OAAOE,KAAK0kI,GAAKnuI,QAAQiF,IAAOqxI,EAAallF,IAAInsD,KACzDiD,SAASuI,IACtB,MAAM4R,EAAO8rH,EACb7tI,KAAKmvI,WAAWnwE,EAAQ7uD,EAAK4R,EAAK5R,GAAK,GAE3C,EClQF,MAAMymI,GAAiB,IAAI1pI,IAAI,CAC7B,UACA,gBACA,gBACA,SACA,WACA,0BACA,qBACA,UAGK,MAAM2pI,WAA6B,GAGxC,KAAAnoG,CAAMl8B,GACJxS,KAAK2kC,OAAS,IAAI,GAClB,MAAM6hB,EAAU/7B,KAAKikB,MAAMl8B,GAC3B,GAAe,MAAXg0C,GAAsC,IAAnBA,EAAQ/jD,OAE7B,OADAzC,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,QAGP,MAAnB6hB,EAAQswF,SACV92I,KAAK+2I,eAAevwF,EAAQswF,SAED,MAAzBtwF,EAAQwwF,eACVh3I,KAAKi3I,YAAYzwF,EAAQwwF,eAEE,MAAzBxwF,EAAQ0wF,eACVl3I,KAAKm3I,YAAY3wF,EAAQ0wF,cAAe,mBAEpB,MAAlB1wF,EAAQ4wF,QACVp3I,KAAKm3I,YAAY3wF,EAAQ4wF,OAAQ,YAEI,MAAnC5wF,EAAQ6wF,yBACVr3I,KAAKs3I,YAAY9wF,EAAQ6wF,yBAEH,MAApB7wF,EAAQ+wF,UACVv3I,KAAKw3I,gBAAgBhxF,EAAQ+wF,UAG/B,IAAK,MAAMpnI,KAAOq2C,EAEZA,EAAQ5kC,eAAezR,KAASymI,GAAe9lF,IAAI3gD,IACrDnQ,KAAKm3I,YAAY3wF,EAAQr2C,GAAM,KAAM,gBAKzC,OADAnQ,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,OAC9B,CAEQ,WAAAsyG,CAAYzwF,GAClBA,EAAQ5+C,SAASwF,IACf,MAAM4xD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBjhI,EAAW26C,OAEhDiX,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAC3BjhI,EAAW89C,MACXlrD,KAAKquI,kBAAkBjhI,EAAWqqI,iBAEhCz3I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,UACvCm7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBjhI,EAAWyD,OAChD7Q,KAAK0G,mBAAmB0G,EAAWyD,SAC7CmuD,EAAOlU,MAAQ,UAAY19C,EAAWyD,MAAQ,MAGhDmuD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBjhI,EAAW0W,UAC1Dk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAa7gI,EAAW5F,QACjDw3D,EAAOlU,OAAS9qD,KAAKquI,kBAAkBjhI,EAAWq+G,KAAM,IAExDzrH,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAEpC,CAEQ,eAAAw4E,CAAgBhxF,GACtBA,EAAQ5+C,SAASe,IACf,MAAMq2D,EAAS,IAAIrN,GACnBqN,EAAO7e,SAAW,IAAI0N,GACtBmR,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAOx9D,KAAOxB,KAAKquI,kBAAkB1lI,EAAI+M,SAAU,IACnD,MAAMk6H,EAAY5wE,EAAOx9D,KAAKmG,MAAM,KAChCioI,EAAUntI,OAAS,IACrBu8D,EAAO7e,SAAS6H,UAAYhoD,KAAKquI,kBAAkBuB,EAAU,KAEtC,IAArBA,EAAUntI,OACZu8D,EAAO7e,SAAS+H,SAAWloD,KAAKquI,kBAAkBuB,EAAU,IAC9B,IAArBA,EAAUntI,SACnBu8D,EAAO7e,SAAS8H,WAAajoD,KAAKquI,kBAAkBuB,EAAU,IAC9D5wE,EAAO7e,SAAS+H,SAAWloD,KAAKquI,kBAAkBuB,EAAU,KAE9D5wE,EAAO7e,SAASt8B,SAAW7jB,KAAKquI,kBAAkB1lI,EAAI+uI,QACtD13I,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAEpC,CAEQ,cAAA+3E,CAAevwF,GACrBA,EAAQ5+C,SAASe,IACf,MAAMq2D,EAAS,IAAIrN,GACnBqN,EAAO7e,SAAW,IAAI0N,GACtBmR,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAOx9D,KAAOxB,KAAKquI,kBAAkB1lI,EAAIgvI,aACzC34E,EAAO7e,SAASgI,SAAWnoD,KAAKquI,kBAAkB1lI,EAAIivI,aACtD54E,EAAO7e,SAASmI,KAAOtoD,KAAKquI,kBAAkB1lI,EAAI2/C,MAClD0W,EAAO7e,SAAS3lC,MAAQxa,KAAKquI,kBAAkB1lI,EAAI6R,OACnDwkD,EAAO7e,SAASoI,WAAavoD,KAAKquI,kBAAkB1lI,EAAIkvI,SACxD74E,EAAO7e,SAASqI,QAAUxoD,KAAKquI,kBAAkB1lI,EAAI6/C,SACtB,MAA3BwW,EAAO7e,SAASqI,UAClBwW,EAAO7e,SAASqI,QAAUwW,EAAO7e,SAASqI,QAAQ7+C,eAEpD3J,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAEpC,CAEQ,WAAAs4E,CAAY9wF,GAClBA,EAAQ5+C,SAASe,IACf,MAAMq2D,EAAS,IAAIrN,GACnBqN,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAOx9D,KAAOxB,KAAKquI,kBAAkB1lI,EAAImvI,MACzC94E,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkB1lI,EAAI6nI,YAChDxxE,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkB1lI,EAAIovI,OACnD/3I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK9D,SACnCxnD,KAAK0G,mBAAmBs4D,EAAOx9D,MACjCw9D,EAAOx9D,KAAOw9D,EAAO1T,KAAK9D,MAE1BwX,EAAOx9D,MAAQ,MAAQw9D,EAAO1T,KAAK9D,OAGvCxnD,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAEpC,CAEQ,WAAAm4E,CAAY3wF,EAAgBwxF,EAAsBx2I,EAAe,MACvEglD,EAAQ5+C,SAASe,IACf,MAAMq2D,EAAS,IAAIrN,GACnBqN,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QAEtC1wE,EAAOx9D,KADG,MAARA,EACYA,EAEAxB,KAAKquI,kBAAkB1lI,EAAIqvI,IAE3C,IAAK,MAAM7nI,KAAOxH,EAEZA,EAAIiZ,eAAezR,IAAQA,IAAQ6nI,GACrCh4I,KAAKmvI,WAAWnwE,EAAQ7uD,EAAKxH,EAAIwH,GAAK1M,YAG1CzD,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAEpC,ECjKK,MAAMi5E,WAA4B,GACvC,KAAAvpG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMooI,MAAO,MAClDl5E,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,OAC5C,MAAMz6C,EAAO19F,KAAKquI,kBAAkBv+H,EAAM0mG,MACrCx2G,KAAK0G,mBAAmBg3F,KACvB19F,KAAK0G,mBAAmBs4D,EAAOlU,OACjCkU,EAAOlU,MAAQ4yC,EAEf1+B,EAAOlU,OAAS,OAAS4yC,GAI7B,MAAMpwF,EAAOwC,EAAM,cACnB,GAAa,aAATxC,EACF0xD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm/C,UACrD+P,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,kBACvC,GAAa,gBAATxC,EAAwB,CACjC0xD,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAM,iBAC1DkvD,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAM,gBAClDkvD,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkBv+H,EAAMsoI,KAChD,MAAM1vE,EAAS1oE,KAAKquI,kBAAkBv+H,EAAMuoI,QAC5C,IAAKr4I,KAAK0G,mBAAmBgiE,GAAS,CACpC,MAAM4vE,EAAW5vE,EAAO/gE,MAAM,KAC1B2wI,EAAS71I,OAAS,IACpBu8D,EAAO1T,KAAK5D,SAAW3kD,SAASu1I,EAAS,GAAI,MAAM70I,WACnDu7D,EAAO1T,KAAK3D,SAAW,IAAO5kD,SAASu1I,EAAS,GAAI,OAAO70I,W,EAKjEzD,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECnDK,MAAM4zG,WAA0B,GACrC,KAAA7pG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAI6zG,GAAW,EAsGf,OArGAhyF,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,GAAM+1I,IAA0B,UAAb1oI,EAAM,IAA+B,UAAbA,EAAM,IAElE,YADA0oI,GAAW,GAIb,MAAMx5E,EAASh/D,KAAKivI,kBAyBpB,GAxBAjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMA,EAAMrN,OAAS,IAC3Du8D,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAG5B,IAAjBA,EAAMrN,SACJzC,KAAKy4I,cAAc3oI,EAAO,aACzB9P,KAAKy4I,cAAc3oI,EAAO,aAC1B9P,KAAKy4I,cAAc3oI,EAAO,UAC1B9P,KAAKy4I,cAAc3oI,EAAO,UAE7BkvD,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,SAIxC1vI,KAAKy4I,cAAc3oI,EAAO,eAC1B9P,KAAKy4I,cAAc3oI,EAAO,WAC1B9P,KAAKy4I,cAAc3oI,EAAO,iBAE1BkvD,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,IAGhBt8C,EAAMrN,OAAS,GAAKqN,EAAMrN,OAAS,GAAM,EAC3C,IAAK,IAAIC,EAAI,EAAGA,EAAIoN,EAAMrN,OAAS,EAAGC,GAAK,EAAG,CAC5C,MAAMg2I,EAAqB5oI,EAAMpN,EAAI,GACrC,GAAI1C,KAAK0G,mBAAmBgyI,GAC1B,SAGF,MAAMC,EAAoB7oI,EAAMpN,EAAI,GAC9Bk2I,EAAiBD,EAAU3wI,cAEjC,GAAIg3D,EAAO1xD,OAASs5C,GAAWqE,MAAO,CACpC,GACqB,QAAnB2tF,IACsB,MAArB55E,EAAO9T,MAAMjB,MAA6C,IAA7B+U,EAAO9T,MAAMjB,KAAKxnD,QAChD,CACAu8D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAayK,GACtC,Q,CACK,IACe,aAAnBE,GAAoD,UAAnBA,IAClC54I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,UACrC,CACAm7C,EAAO9T,MAAMrnC,SAAW60H,EACxB,Q,CACK,GACc,aAAnBE,GACA54I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,UACrC,CACAk7C,EAAO9T,MAAMpnC,SAAW40H,EACxB,Q,CACK,GAAuB,SAAnBE,GAA6B54I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMnB,MAAO,CAClFiV,EAAO9T,MAAMnB,KAAO2uF,EACpB,Q,OAEG,GAAI15E,EAAO1xD,OAASs5C,GAAWyE,KAAM,CAC1C,GACqB,eAAnButF,GACA54I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK/D,gBACpC,CACAyX,EAAO1T,KAAK/D,eAAiBmxF,EAC7B,Q,CACK,GAAuB,WAAnBE,GAA+B54I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK7D,QAAS,CACrFuX,EAAO1T,KAAK7D,OAASixF,EACrB15E,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChE,Q,CACK,GAAuB,QAAnBmxF,GAA4B54I,KAAK0G,mBAAmBs4D,EAAO1T,KAAKthC,MAAO,CAChFg1C,EAAO1T,KAAKthC,KAAO0uH,EACnB,Q,CACK,GACc,gBAAnBE,GACA54I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK5D,WACpC1nD,KAAK0G,mBAAmBs4D,EAAO1T,KAAK3D,UAEpC,GAAI3nD,KAAKsuI,kBAAkBtvE,EAAQ05E,GACjC,cAEG,GAAuB,SAAnBE,EAET,Q,CAIJ54I,KAAKmvI,WAAWnwE,EAAQ25E,EAAWD,E,CAIvC14I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEQ,aAAA8zG,CAAcjtF,EAAehqD,GACnC,OAAc,MAAVgqD,GAA0B,MAARhqD,GAIpBgqD,EAAO9rD,QAAQu5B,IAAOj5B,KAAK0G,mBAAmBuyB,IAAMA,EAAEjxB,gBAAkBxG,EAAKwG,gBAC1EvF,OAAS,CAEhB,ECtHF,MAAMo2I,GAAkB,IAAIxyI,OAAO,qBAAsB,KAElD,MAAMyyI,WAA2B,GACtC,KAAApqG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAA0B/7B,KAAKikB,MAAMl8B,GAC3C,GAAe,MAAXg0C,GAAoC,MAAjBA,EAAQD,OAA0C,IAAzBC,EAAQD,MAAM9jD,OAE5D,OADAkiC,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMo0G,EAAa,IAAIn5I,IACjBo5I,EAAkB,IAAIp5I,IACtBq5I,EAAaj5I,KAAKk5I,gBAAgB1yF,EAAQqoB,SA8ChD,OA7CA7uE,KAAKm5I,kBAAkB,KAAMF,EAAYF,GACzCA,EAAWnxI,SAAQ,CAAC8hB,EAAKvZ,KACvB6oI,EAAgBjxI,IAAIoI,EAAKw0B,EAAOkqC,QAAQpsE,QACxC,MAAMw2B,EAAI,IAAIssG,GACdtsG,EAAEz3B,KAAOkoB,EACTib,EAAOkqC,QAAQj0D,KAAKqe,EAAE,IAGxButB,EAAQD,MAAM3+C,SAASma,IACD,MAAhBA,EAAK8sD,SAAmB9sD,EAAK8sD,QAAQpsE,OAAS,GAAKu2I,EAAgBloF,IAAI/uC,EAAK8sD,QAAQ,KACtFlqC,EAAOwnG,oBAAoBvxH,KAAK,CAC9B+pB,EAAOg2C,QAAQl4E,OACfu2I,EAAgB/+H,IAAI8H,EAAK8sD,QAAQ,MAIrC,MAAM7P,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBtsH,EAAKgmC,OAC1CiX,EAAOnU,SAAW9oC,EAAK8oC,SAAW,EAER,MAAtB9oC,EAAKq3H,eAAwC,MAAfr3H,EAAKypC,QAAkBzpC,EAAKypC,OAAO/oD,OAAS,IAEjC,IAAzCsf,EAAKq3H,cAAcvyI,QAAQ,WACiB,IAA5Ckb,EAAKq3H,cAAcvyI,QAAQ,aAE3B7G,KAAKq5I,aAAar6E,EAAQj9C,EAAKypC,QACwB,IAA9CzpC,EAAKq3H,cAAcvyI,QAAQ,eACpC7G,KAAKs3I,YAAYt4E,EAAQj9C,EAAKypC,QAE9BzpC,EAAKq3H,cAAcvyI,QAAQ,aAAe,GAC1Ckb,EAAKypC,OAAO4F,MAAMn4B,GAAiB,aAAXA,EAAE3rB,OAAwBtN,KAAK0G,mBAAmBuyB,EAAEnpB,SAE5E9P,KAAKq5I,aAAar6E,EAAQj9C,EAAKypC,QAE/BxrD,KAAKm3I,YAAYn4E,EAAQj9C,EAAKypC,SAIlCwT,EAAOlU,OAAS,KAAO9qD,KAAKquI,kBAAkBtsH,EAAK0pG,KAAM,IACzDzrH,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEQ,YAAA00G,CAAar6E,EAAoBxT,GACvC,MAAMorB,EAAiB,GACvBprB,EAAO5jD,SAASosD,IACd,IAAIh0D,KAAK0G,mBAAmBstD,EAAMlkD,QAAyB,YAAfkkD,EAAM1mD,KAIlD,GACkB,aAAf0mD,EAAM1mD,MAAsC,UAAf0mD,EAAM1mD,OACpCtN,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,UAGhC,GAAmB,aAAfmwC,EAAM1mD,MAAuBtN,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,UAC3Ek7C,EAAO9T,MAAMpnC,SAAWkwC,EAAMlkD,WACzB,GAAmB,SAAfkkD,EAAM1mD,MAAmBtN,KAAK0G,mBAAmBs4D,EAAO9T,MAAMnB,MACvEiV,EAAO9T,MAAMnB,KAAOiK,EAAMlkD,WACrB,GAAmB,QAAfkkD,EAAM1mD,KACfspE,EAAKh8D,KAAKo5C,EAAMlkD,YACX,GAAmB,cAAfkkD,EAAM1mD,KAAsB,CACrC,IAAIgsI,EAAetlF,EAAMlkD,MAAMlJ,WAAW,iBACtCotD,EAAMlkD,MACN,gBAAkBkkD,EAAMlkD,MAC5BwpI,EAAeA,EAAap1I,QAAQ,aAAc,IAClDo1I,EAAeA,EAAap1I,QAAQ20I,GAAiB,iBACrDjiE,EAAKh8D,KAAK0+H,E,MAEVt5I,KAAKmvI,WACHnwE,EACAhL,EAAMq8E,MACNr8E,EAAMlkD,MACc,IAApBkkD,EAAMulF,UAAkBzyF,GAAU25E,OAAS35E,GAAU0vD,WAnBvDx3C,EAAO9T,MAAMrnC,SAAWmwC,EAAMlkD,K,IAuBlCkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAar3D,EACxC,CAEQ,WAAA0gE,CAAYt4E,EAAoBxT,GACtCwT,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1xD,KAAOs5C,GAAWyE,KACzBG,EAAO5jD,SAASosD,IAEZh0D,KAAK0G,mBAAmBstD,EAAMlkD,QACf,YAAfkkD,EAAM1mD,MACS,WAAf0mD,EAAM1mD,OAKW,WAAf0mD,EAAM1mD,MAAqBtN,KAAK0G,mBAAmBs4D,EAAO1T,KAAK/D,gBACjEyX,EAAO1T,KAAK/D,eAAiByM,EAAMlkD,MACX,aAAfkkD,EAAM1mD,MAAuBtN,KAAK0G,mBAAmBs4D,EAAO1T,KAAK7D,SAC1EuX,EAAO1T,KAAK7D,OAASuM,EAAMlkD,MAC3BkvD,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,SACxC,UAAfuM,EAAM1mD,MAAoBtN,KAAK0G,mBAAmBs4D,EAAO1T,KAAKthC,MACvEg1C,EAAO1T,KAAKthC,KAAOgqC,EAAMlkD,MACD,aAAfkkD,EAAM1mD,MAAuBtN,KAAK0G,mBAAmBs4D,EAAO1T,KAAK3D,UACrE3nD,KAAKsuI,kBAAkBtvE,EAAQhL,EAAMlkD,QAS1C9P,KAAKmvI,WACHnwE,EACAhL,EAAMq8E,MACNr8E,EAAMlkD,MACc,IAApBkkD,EAAMulF,UAAkBzyF,GAAU25E,OAAS35E,GAAU0vD,M,GAI7D,CAEQ,WAAA2gC,CAAYn4E,EAAoBxT,GACtCA,EAAO5jD,SAASosD,IACVh0D,KAAK0G,mBAAmBstD,EAAMlkD,QAAyB,YAAfkkD,EAAM1mD,MAGlDtN,KAAKmvI,WACHnwE,EACAhL,EAAMq8E,MACNr8E,EAAMlkD,MACc,IAApBkkD,EAAMulF,UAAkBzyF,GAAU25E,OAAS35E,GAAU0vD,KACtD,GAEL,CAEQ,eAAA0iC,CAAgBrqE,GACtB,GAAe,MAAXA,EACF,MAAO,GAET,MAAMoqE,EAAqC,GACrCx0I,EAAM,IAAI7E,IAAkC,IAYlD,OAXAivE,EAAQjnE,SAASe,IACflE,EAAIsD,IAAIY,EAAI6wI,KAAM7wI,GAClBA,EAAIm6H,SAAW,EAAE,IAEnBj0D,EAAQjnE,SAASe,IACQ,MAAnBA,EAAI8wI,aAA2C,KAApB9wI,EAAI8wI,aAAsBh1I,EAAIqsD,IAAInoD,EAAI8wI,aACnEh1I,EAAIwV,IAAItR,EAAI8wI,aAAa3W,SAASloH,KAAKjS,GAEvCswI,EAAWr+H,KAAKjS,E,IAGbswI,CACT,CAEQ,iBAAAE,CACNO,EACAC,EACAl1I,GAEY,MAARk1I,GAGJA,EAAK/xI,SAASqxB,IACZ,GAAe,MAAXA,EAAE8uB,OAAoC,KAAnB9uB,EAAE8uB,MAAMphD,OAAe,CAC5C,IAAIohD,EAAQ9uB,EAAE8uB,MAAMphD,OACD,MAAf+yI,GAA8C,KAAvBA,EAAY/yI,SACrCohD,EAAQ2xF,EAAc,IAAM3xF,GAE9BtjD,EAAIsD,IAAIkxB,EAAEugH,KAAMzxF,GACE,MAAd9uB,EAAE6pG,UAA0C,IAAtB7pG,EAAE6pG,SAASrgI,QACnCzC,KAAKm5I,kBAAkBpxF,EAAO9uB,EAAE6pG,SAAUr+H,E,IAIlD,ECvMK,MAAMm1I,WAA2B,GACtC,KAAAlrG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EACG9mD,QAAQoQ,GACc,6BAAdA,EAAM7I,MAEdW,SAASkI,IACR,MAAMkvD,EAASh/D,KAAKivI,kBACdhoI,EAAMjH,KAAKquI,kBAAkBv+H,EAAM7I,IAAKjH,KAAKquI,kBAAkBv+H,EAAMhJ,WAC3Ek4D,EAAOx9D,KAAOxB,KAAKquI,kBAAkBruI,KAAKouI,YAAYnnI,GAAM,MAC5D+3D,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAahnI,GACtCjH,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG/Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECvBF,IAAYk1G,IAAZ,SAAYA,GACV,qBACA,8BACD,CAHD,CAAYA,KAAAA,GAAiB,KCEtB,MAAMC,WAA2B,GACtC,KAAAprG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAmB/7B,KAAKikB,MAAMl8B,GACpC,GAAe,MAAXg0C,GAAmC,MAAhBA,EAAQh0C,KAE7B,OADAmyB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAK,MAAMx0B,KAAOq2C,EAAQh0C,KAAM,CAE9B,IAAKg0C,EAAQh0C,KAAKoP,eAAezR,GAC/B,SAGF,MAAML,EAAQ02C,EAAQh0C,KAAKrC,GACrB6uD,EAASh/D,KAAK+5I,WAAWjqI,GAC/B60B,EAAOg2C,QAAQ//D,KAAKokD,E,CAItB,OADAr6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEQ,UAAAo1G,CAAWzF,GACjB,MAAMt1E,EAASh/D,KAAKivI,kBAKpB,OAJAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBiG,EAAM94H,SAC3CwjD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBiG,EAAMxpF,OAC5CkU,EAAOnU,SAAWypF,EAAMzpF,SAAW,EAE3BypF,EAAMhnI,MACZ,KAAKusI,GAAkB5uF,MACrBjrD,KAAKg6I,iBAAiB1F,EAAOt1E,GAC7B,MACF,KAAK66E,GAAkBI,WACrBj6I,KAAKk6I,sBAAsB5F,EAAOt1E,GAClC,MACF,QACE,OAMJ,OAFAh/D,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACZA,CACT,CAEQ,gBAAAg7E,CAAiB1F,EAAiBt1E,GACxCA,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBiG,EAAMzwH,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBiG,EAAMxwH,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaqG,EAAMrtI,IAC9C,CAEQ,qBAAAizI,CAAsB5F,EAAiBt1E,GAC7CA,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBiG,EAAMzwH,UAC1Dm7C,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBiG,EAAM6F,cAClDn7E,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkBiG,EAAM8F,WAC3Cp6I,KAAK0G,mBAAmB4tI,EAAM+F,eAC5Br6I,KAAKsuI,kBAAkBtvE,EAAQs1E,EAAM+F,eACxCr6I,KAAKmvI,WAAWnwE,EAAQ,aAAcs1E,EAAM+F,cAG3Cr6I,KAAK0G,mBAAmB4tI,EAAMxwH,WACjC9jB,KAAKmvI,WAAWnwE,EAAQ,MAAOs1E,EAAMxwH,SAEzC,ECzEK,MAAMw2H,WAA0B,GACrC,KAAA5rG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAU/7B,KAAKikB,MAAMl8B,GAC3B,GAAe,MAAXg0C,GAAmD,IAAhCv9C,OAAOE,KAAKq9C,GAAS/jD,OAE1C,OADAkiC,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAK,MAAM41G,KAAW/zF,EAEjBA,EAAQ5kC,eAAe24H,KACxBv6I,KAAK0G,mBAAmB6zI,IACI,IAA5B/zF,EAAQ+zF,GAAS93I,QAKnB+jD,EAAQ+zF,GAAS3yI,SAASkI,IACxB,GACE9P,KAAK0G,mBAAmBoJ,EAAM0qI,eACS,IAAvC1qI,EAAM0qI,aAAa3zI,QAAQ,QAE3B,OAGF7G,KAAKovI,cAAczqG,EAAQ41G,GAC3B,MAAMv7E,EAASh/D,KAAKivI,kBAQpB,GAPAjwE,EAAOx9D,KAAOsO,EAAM0qI,aAAat2I,QAAQ,UAAW,IAAIA,QAAQ,WAAY,IACxE86D,EAAOx9D,KAAKiB,OAAS,KACvBu8D,EAAOx9D,KAAOw9D,EAAOx9D,KAAKyI,UAAU,EAAG,KAEzC+0D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMqiC,QACrD6sB,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM0qI,cAEpB,MAApB1qI,EAAM2qI,WAAoB,CAC5Bz7E,EAAO9T,MAAMrnC,SACS,MAApB/T,EAAM2qI,WACFz6I,KAAKquI,kBAAkBv+H,EAAM2qI,WAAWC,gBACxC,KACN,IAAK,MAAMC,KAAQ7qI,EAAM2qI,WAEpB3qI,EAAM2qI,WAAW74H,eAAe+4H,IACxB,mBAATA,GACS,eAATA,GAIF36I,KAAKmvI,WAAWnwE,EAAQ27E,EAAM7qI,EAAM2qI,WAAWE,G,CAInD36I,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAS/B,OALIh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EChEF,MAAMi2G,GAAc,YACdC,GAAqB,mBACrBC,GAAiB,eACjBC,GAAY,UAEX,MAAMC,WAA6B,GACxC,KAAAtsG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GAEnB,IAAIs2G,EACAC,EACAC,EACAC,EAAcp7I,KAAK2tI,aAAan7H,GAAM3N,KAAK,MAE/C,IAA0C,IAAtCu2I,EAAYv0I,QAAQ+zI,IAAqB,CAC3C,MAAM9yI,EAAQszI,EAAYzzI,MAAMizI,IAC5B9yI,EAAMrF,OAAS,IACjB24I,EAActzI,EAAM,GACpBmzI,EAAYnzI,EAAM,G,CAGtB,IAAiD,IAA7CszI,EAAYv0I,QAAQg0I,IAA4B,CAClD,MAAM/yI,EAAQszI,EAAYzzI,MAAMkzI,IAC5B/yI,EAAMrF,OAAS,IACjB24I,EAActzI,EAAM,GACpBozI,EAAmBpzI,EAAM,G,CAG7B,GAA4C,IAAxCszI,EAAYv0I,QAAQi0I,IAAuB,CAC7C,MAAMhzI,EAAQszI,EAAYzzI,MAAMmzI,IAC5BhzI,EAAMrF,OAAS,IACjB24I,EAActzI,EAAM,GACpBqzI,EAAerzI,EAAM,G,CAIzB,MAAMgjD,EAAQ9qD,KAAKq7I,kBAAkBJ,GAC/BK,EAAet7I,KAAKq7I,kBAAkBH,GACtCK,EAAWv7I,KAAKq7I,kBAAkBF,GA+BxC,OA7BArwF,EAAMljD,SAAS8pD,IACb,MAAMsN,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkB38E,EAAEz3C,IAAI,SAC3C+kD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkB38E,EAAEz3C,IAAI,SAC5Cja,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Bu8E,EAASjlC,OAAOglC,GAAc1zI,SAAS4zI,IACrC,MAAMx8E,EAASh/D,KAAKivI,kBACdwM,EAAUD,EAAE1qF,IAAI,gBAAkB,eAAiB,cACzDkO,EAAOx9D,KAAOxB,KAAKquI,kBAAkBmN,EAAEvhI,IAAIwhI,GAAU,IAChDz7I,KAAK0G,mBAAmB80I,EAAEvhI,IAAI,iBAC5Bja,KAAK0G,mBAAmBs4D,EAAOx9D,QAClCw9D,EAAOx9D,MAAQ,MAEjBw9D,EAAOx9D,MAAQg6I,EAAEvhI,IAAI,eAEvB+kD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBmN,EAAEvhI,IAAI,YACxCuhI,EAAE1qF,IAAI,iBACRkO,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAauN,EAAEvhI,IAAI,iBAE9C+kD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBmN,EAAEvhI,IAAI,UACrD+kD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBmN,EAAEvhI,IAAI,aACrDja,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEQ,iBAAA02G,CAAkB7oI,GACxB,GAAIxS,KAAK0G,mBAAmB8L,KAAsC,IAA7BA,EAAK3L,QAAQk0I,IAChD,MAAO,GAET,MAAMx0F,EAA+B,GAwCrC,OAvCA/zC,EAAK7K,MAAMozI,IAAWnzI,SAAS2hB,IAC7B,IAAyB,IAArBA,EAAE1iB,QAAQ,MACZ,OAEF,MAAMkb,EAAO,IAAIniB,IACjB,IAAI87I,EACAC,EACJpyH,EAAE5hB,MAAM,MAAMC,SAASqpD,IACrB,GAAmB,MAAfyqF,EAEF,YADAA,GAAe,KAAOzqF,GAGxB,MAAM2qF,EAAa3qF,EAAEpqD,QAAQ,KAC7B,IAAIsJ,EACAuZ,GACgB,IAAhBkyH,IAGFzrI,EAAM8gD,EAAEhnD,UAAU,EAAG2xI,GACjB3qF,EAAExuD,OAASm5I,EAAa,IAC1BlyH,EAAMunC,EAAEhnD,UAAU2xI,EAAa,IAGxB,MAAPzrI,GACF4R,EAAKha,IAAIoI,EAAKuZ,GAEJ,YAARvZ,GAA6B,SAARA,IACvBurI,EAAchyH,EACdiyH,EAAiBxrI,G,IAGF,MAAfurI,GAAyC,MAAlBC,GACzB55H,EAAKha,IAAI4zI,EAAgBD,GAET,IAAd35H,EAAK88B,MAGT0H,EAAM3rC,KAAKmH,EAAK,IAEXwkC,CACT,EClHK,MAAMs1F,WAA4B,GAAzC,c,oBACE,KAAAl3G,OAAS,IAAI,EA4Gf,CA1GE,KAAA+J,CAAMl8B,GACJ,MAAM46H,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAptI,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,QAI9B,MAAMm3G,EAAkB1O,EAAIG,cAAc,eAE1C,GAAuB,MAAnBuO,EAGF,OAFA97I,KAAK2kC,OAAO9oB,aAAe,8BAC3B7b,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,QAG9B,MAAMo3G,EAAWD,EAAgBvO,cAAc,QAC/C,GAAgB,MAAZwO,EAGF,OAFA/7I,KAAK2kC,OAAO9oB,aAAe,qCAC3B7b,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,QAG9B,MAAMq3G,EAAYD,EAASxO,cAAc,SACzC,OAAiB,MAAbyO,GACFh8I,KAAK2kC,OAAO9oB,aAAe,6CAC3B7b,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,UAG9B3kC,KAAKi8I,SAASD,GAAW,EAAM,IAE3Bh8I,KAAK82B,cACP92B,KAAKyuI,yBAAyBzuI,KAAK2kC,QAGrC3kC,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,QAC9B,CAEA,QAAAs3G,CAASrZ,EAAesZ,EAAqBC,GAC3C,MAAM5M,EAAcvvI,KAAK2kC,OAAOkqC,QAAQpsE,OACxC,IAAI25I,EAAYD,EAEhB,IAAKD,EAAY,CACG,KAAdE,IACFA,GAAa,KAEf,MAAMC,EAASr8I,KAAK0uI,yBAAyB9L,EAAM,QACnDwZ,GAAuB,MAAVC,EAAiB,IAAMA,EAAOhI,YAC3C,MAAMrY,EAAS,IAAIuJ,GACnBvJ,EAAOx6H,KAAO46I,EACdp8I,KAAK2kC,OAAOkqC,QAAQj0D,KAAKohH,E,CAG3Bh8H,KAAK6uI,4BAA4BjM,EAAM,SAASh7H,SAAS0sI,IACvD,MAAMgI,EAAct8I,KAAK2kC,OAAOg2C,QAAQl4E,OAElCu8D,EAASh/D,KAAKivI,kBACpBjvI,KAAK6uI,4BAA4ByF,EAAO,UAAU1sI,SAAS20I,IACzD,MAAMC,EAAUx8I,KAAK0uI,yBAAyB6N,EAAa,SACrDzsI,EAAmB,MAAX0sI,EAAkBA,EAAQnI,YAAc,KACtD,GAAIr0I,KAAK0G,mBAAmBoJ,GAC1B,OAEF,MAAM2sI,EAAQz8I,KAAK0uI,yBAAyB6N,EAAa,OACnDpsI,EAAe,MAATssI,EAAgBA,EAAMpI,YAAc,KAEhD,GAAY,QAARlkI,EACF6uD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,QACjC,GAAY,aAARK,EACT6uD,EAAO9T,MAAMrnC,SAAW/T,OACnB,GAAY,aAARK,EACT6uD,EAAO9T,MAAMpnC,SAAWhU,OACnB,GAAY,QAARK,EACT6uD,EAAO9T,MAAMnB,KAAOj6C,EAAM5L,QAAQ,OAAQ,SACrC,GAAY,UAARiM,EACT6uD,EAAOx9D,KAAOsO,OACT,GAAY,UAARK,EACT6uD,EAAOlU,OAASh7C,EAAQ,SACnB,CACL,IAAIxC,EAAOw5C,GAAU0vD,KACrB,MAAMkmC,EAAQF,EAAQ/B,WAEpBiC,EAAMj6I,OAAS,GACU,MAAzBi6I,EAAMC,iBAC0B,SAAhCD,EAAMC,gBAAgB7sI,QAEtBxC,EAAOw5C,GAAU25E,QAEnBzgI,KAAKmvI,WAAWnwE,EAAQ7uD,EAAKL,EAAOxC,E,KAIxCtN,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,GAEpBk9E,GACHl8I,KAAK2kC,OAAOwnG,oBAAoBvxH,KAAK,CAAC0hI,EAAa/M,G,IAIvDvvI,KAAK6uI,4BAA4BjM,EAAM,SAASh7H,SAASg1I,IACvD58I,KAAKi8I,SAASW,GAAO,EAAOR,EAAU,GAE1C,EC/GK,MAAMS,WAA4B,GACvC,KAAAnuG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAI9P,KAAK0G,mBAAmBoJ,EAAMs+C,OAChC,OAGFt+C,EAAMgtI,OACH98I,KAAK0G,mBAAmBoJ,EAAMgtI,QAAUhtI,EAAMgtI,MAAMl2I,WAAW,SAC5DkJ,EAAMgtI,MAAM54I,QAAQ,QAAS,IAC7B4L,EAAMgtI,MACZ,MAAMV,EAAap8I,KAAK0G,mBAAmBoJ,EAAMgtI,OAAuB,KAAdhtI,EAAMgtI,MAChE98I,KAAKovI,cAAczqG,EAAQy3G,GAE3B,MAAMp9E,EAASh/D,KAAKivI,kBACpBjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,OAC5Cn5E,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMs+C,MAAO,MAClD4Q,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm/C,UACrD+P,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMjD,KAC5C7M,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECtCK,MAAMo4G,WAA0B,GACrC,KAAAruG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAGFzC,KAAKovI,cAAczqG,EAAQ70B,EAAM,IACjC,MAAMkvD,EAASh/D,KAAKivI,kBAEdnkF,EAAQ9qD,KAAKquI,kBAAkBv+H,EAAM,IAU3C,GATIg7C,IACFkU,EAAOlU,MAAQ,GAAGA,OAGpBkU,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAC/CkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,IAExCA,EAAMrN,OAAS,EAEjB,IAAK,IAAIC,EAAI,EAAGA,EAAIoN,EAAMrN,OAAQC,GAAQ,EACxB,cAAZoN,EAAMpN,GACRs8D,EAAO9T,MAAMnB,KAAOj6C,EAAMpN,EAAI,GAE9B1C,KAAKmvI,WAAWnwE,EAAQlvD,EAAMpN,GAAIoN,EAAMpN,EAAI,IAKlD1C,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECvCK,MAAMq4G,WAA4B,GACvC,KAAAtuG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMwsI,EAAc33G,EAAOg2C,QAAQl4E,OACnC,IAAI8sI,EAAc5qG,EAAOkqC,QAAQpsE,OAC7BouI,EAAW/gI,EAAM+gI,SACL,MAAZA,IAEFA,EAAWA,EAAS3sI,QAAQ,MAAO,KAAKA,QAAQ,wBAAyB,KAE3E,MAAM+4I,EAA2D,WAA/Cj9I,KAAKquI,kBAAkBwC,EAAU,UACnD,IAAIrB,EAAYyN,EAEhB,GAAIA,EACF,IAAK,IAAIv6I,EAAI,EAAGA,EAAIiiC,EAAOkqC,QAAQpsE,OAAQC,IACzC,GAAIiiC,EAAOkqC,QAAQnsE,GAAGlB,OAASqvI,EAAU,CACvCrB,GAAY,EACZD,EAAc7sI,EACd,K,CAKN,MAAMs8D,EAASh/D,KAAKk9I,gBAAgBptI,GACpC,GAAIkvD,EAAO1xD,OAASs5C,GAAWqE,MAC7B+T,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMihI,OAC5C/xE,EAAO9T,MAAQ,IAAI8F,GACnBgO,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5C+3D,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAMi6C,WAC5C,GAAIiV,EAAO1xD,OAASs5C,GAAWuE,WACpCnrD,KAAKm9I,gBAAgBrtI,EAAOkvD,QACvB,GAAIA,EAAO1xD,OAASs5C,GAAWyE,KACpC2T,EAAO1T,KAAOtrD,KAAKo9I,UAAUttI,GAC7BkvD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMg7C,YACvC,GAAIkU,EAAO1xD,OAASs5C,GAAW2E,WACpCyT,EAAO7e,SAAWngD,KAAKq9I,cAAcvtI,GACrCkvD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMg7C,QACvC9qD,KAAK0G,mBAAmBoJ,EAAMwtI,QAAQ,CAEzC,MAAMC,EAAav9I,KAAKk9I,gBAAgBptI,GACxCytI,EAAWp9F,SAAW,KACtBo9F,EAAWjwI,KAAOs5C,GAAWyE,KAC7BkyF,EAAWjyF,KAAOtrD,KAAKo9I,UAAUttI,GACjC60B,EAAOg2C,QAAQ//D,KAAK2iI,E,CAMxB,GAFA54G,EAAOg2C,QAAQ//D,KAAKokD,GAEhBwwE,EAAW,CACb,MAAMv2G,EAAI,IAAIssG,GACdtsG,EAAEz3B,KAAOqvI,EACTlsG,EAAOkqC,QAAQj0D,KAAKqe,E,CAElBgkH,GACFt4G,EAAOwnG,oBAAoBvxH,KAAK,CAAC0hI,EAAa/M,G,IAI9CvvI,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,eAAAu4G,CAAgBptI,GACtB,MAAMkvD,EAAS,IAAIrN,GAyBnB,OAvBI7hD,EAAM8R,eAAe,gBAAkB9R,EAAM8R,eAAe,oBAE9Do9C,EAAOnU,UAAW,EAClBmU,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM0tI,YAAa,MACxDx+E,EAAO1xD,KAAOs5C,GAAWyE,KAGtBrrD,KAAK0G,mBAAmBoJ,EAAMi4C,QAC9B/nD,KAAK0G,mBAAmBoJ,EAAM2tI,YAC9Bz9I,KAAK0G,mBAAmBoJ,EAAM4tI,WAC9B19I,KAAK0G,mBAAmBoJ,EAAMq4C,WAC9BnoD,KAAK0G,mBAAmBoJ,EAAM44C,QAC9B1oD,KAAK0G,mBAAmBoJ,EAAM+T,WAC9B7jB,KAAK0G,mBAAmBoJ,EAAMe,SAE/BmuD,EAAO1xD,KAAOs5C,GAAW2E,YAI3ByT,EAAOnU,UAAY7qD,KAAK82B,cAA2D,MAA3C92B,KAAKquI,kBAAkBv+H,EAAMghI,IAAK,KAC1E9xE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,KAAM,MACjDw9D,EAAO1xD,KAAqB,cAAdwC,EAAM7I,IAAsB2/C,GAAWuE,WAAavE,GAAWqE,OAExE+T,CACT,CAEQ,SAAAo+E,CAAUttI,GAChB,MAAMw7C,EAAO,IAAIc,GAMjB,GALAd,EAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAM6tI,QACnDryF,EAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAMwtI,OAC3ChyF,EAAKthC,KAAOhqB,KAAKquI,kBAAkBv+H,EAAM8tI,OACzCtyF,EAAK9D,MAAQ4E,GAASY,uBAAuB1B,EAAK7D,SAE7CznD,KAAK0G,mBAAmBoJ,EAAM+tI,QAAU/tI,EAAM+tI,MAAMh3I,QAAQ,MAAQ,EAAG,CAC1E,MAAMi3I,EAAchuI,EAAM+tI,MAAiBl2I,MAAM,KAC7Cm2I,EAAWr7I,OAAS,IACtB6oD,EAAK3D,QAAUm2F,EAAW,GAC1BxyF,EAAK5D,SAAWo2F,EAAW,GACE,IAAzBxyF,EAAK5D,SAASjlD,QAAqC,MAArB6oD,EAAK5D,SAAS,KAC9C4D,EAAK5D,SAAW4D,EAAK5D,SAAS,I,CAKpC,OAAO4D,CACT,CAEQ,aAAA+xF,CAAcvtI,GACpB,MAAMqwC,EAAW,IAAI0N,GAsBrB,OArBA1N,EAAS4H,MAAQ/nD,KAAKquI,kBAAkBv+H,EAAMi4C,OAC9C5H,EAAS6H,UAAYhoD,KAAKquI,kBAAkBv+H,EAAM2tI,WAClDt9F,EAAS8H,WAAajoD,KAAKquI,kBAAkBv+H,EAAMiuI,YACnD59F,EAAS+H,SAAWloD,KAAKquI,kBAAkBv+H,EAAM4tI,UACjDv9F,EAASt8B,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACjDs8B,EAASsI,QAAUzoD,KAAKquI,kBAAkBv+H,EAAM24C,SAChDtI,EAASwI,IAAM3oD,KAAKquI,kBAAkBv+H,EAAM64C,KAC5CxI,EAASgI,SAAWnoD,KAAKquI,kBAAkBv+H,EAAMq4C,UACjDhI,EAASiI,SAAWpoD,KAAKquI,kBAAkBv+H,EAAMs4C,UACjDjI,EAASkI,SAAWroD,KAAKquI,kBAAkBv+H,EAAMu4C,UACjDlI,EAASmI,KAAOtoD,KAAKquI,kBAAkBv+H,EAAMw4C,MAC7CnI,EAAS3lC,MAAQxa,KAAKquI,kBAAkBv+H,EAAM0K,OAC9C2lC,EAASoI,WAAavoD,KAAKquI,kBAAkBv+H,EAAMu+F,KACnDluD,EAASqI,QAAUxoD,KAAKquI,kBAAkBv+H,EAAM04C,SAChDrI,EAAStvC,MAAQ7Q,KAAKquI,kBAAkBv+H,EAAMe,OAC9CsvC,EAASuI,MAAQ1oD,KAAKquI,kBAAkBv+H,EAAM44C,OAEzC1oD,KAAK0G,mBAAmBy5C,EAAS4H,SACpC5H,EAAS4H,MAAQ5H,EAAS4H,MAAMr+C,OAAO,GAAGC,cAAgBw2C,EAAS4H,MAAMnjD,MAAM,IAG1Eu7C,CACT,CAEQ,eAAAg9F,CAAgBrtI,EAAYkvD,GAClC,MAAMg/E,EAAah+I,KAAK2tI,aAAa79H,EAAMihI,OAC3C,IAAIkN,GAAgB,EAEpB,GAAID,EAAWv7I,OAAQ,CACrB,MAAMy7I,EAAYF,EAAW,GAAGr2I,MAAM,KACtC,GACEu2I,EAAUz7I,OAAS,GACF,aAAjBy7I,EAAU,KACQ,gBAAjBA,EAAU,IAAyC,YAAjBA,EAAU,IAC7C,CACA,GAAqB,gBAAjBA,EAAU,GAAsB,CAClC,MAAMC,EAAan+I,KAAKo+I,uBAAiCp/E,EAAQg/E,EAAY,CAC3E30I,OAAQ,SACR,eAAgB,iBAChB,gBAAiB,OAGjB,kBAAmB,aAGrB,GAAIrJ,KAAK0G,mBAAmBy3I,EAAWz2F,WAAqC,MAAxBy2F,EAAWz2F,SAE7Dy2F,EAAWz2F,cAAW9+C,MACjB,CACL,MAAOy1I,EAAatxF,GAAQoxF,EAAWz2F,SAAS//C,MAAM,KAEtD,GAAK3H,KAAK0G,mBAAmB23I,GAQ3BF,EAAWz2F,cAAW9+C,MARmB,CACzC,MAAMogE,EAAQ,IAAIx8D,KAAKA,KAAKkiC,MAAM2vG,EAAY13I,OAAS,aAAa23I,WAAa,EAC7Eh1I,MAAM0/D,GACRm1E,EAAWz2F,cAAW9+C,EAEtBu1I,EAAWz2F,SAAWshB,EAAMvlE,U,CAK3BzD,KAAK0G,mBAAmBqmD,KAC3BoxF,EAAWx2F,QAAUoF,E,CAIzBiS,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO6yF,C,MACT,GAAqB,YAAjBD,EAAU,GAAkB,CACrC,MAAMC,EAAan+I,KAAKo+I,uBAAqCp/E,EAAQg/E,EAAY,CAC/E5vF,MAAO,QACP,aAAc,YACd,YAAa,WACb,cAAe,aACfS,QAAS,UACT,YAAa,WACb,YAAa,WACb,YAAa,WACb,cAAe,OACfH,MAAO,QACP,oBAAqB,aACrBE,QAAS,UACT,gBAAiB,QACjBK,SAAU,aAEZ+P,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAWg+F,C,CAEpBF,GAAgB,C,EAIfA,IACHj/E,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMihI,OAEhD,CAEQ,sBAAAqN,CAA0Bp/E,EAAoBg/E,EAAsBv5I,GAC1E,MAAMqkB,EAAe,CAAC,EAEtB,IAAIy1H,GAAkB,EAuCtB,OAtCAP,EAAWp2I,SAAS42I,IAClB,IAAIruI,EAAc,KACduZ,EAAc,KAClB,IAAK60H,EAAiB,CACpB,GAAIv+I,KAAK0G,mBAAmB83I,GAC1B,OAEF,MAAM5C,EAAa4C,EAAU33I,QAAQ,KASrC,IARoB,IAAhB+0I,EACFzrI,EAAMquI,GAENruI,EAAMquI,EAAUv0I,UAAU,EAAG2xI,GACzB4C,EAAU/7I,OAASm5I,IACrBlyH,EAAM80H,EAAUv0I,UAAU2xI,EAAa,KAGvC57I,KAAK0G,mBAAmByJ,IAAQnQ,KAAK0G,mBAAmBgjB,IAAgB,aAARvZ,EAClE,M,CAIAouI,EACFv/E,EAAOlU,OAAS,KAAO0zF,EACN,UAARruI,GACJnQ,KAAK0G,mBAAmBs4D,EAAOlU,OAGlCkU,EAAOlU,MAAQphC,EAFfs1C,EAAOlU,OAAS,KAAOphC,EAIzB60H,GAAkB,GAET95I,EAAImd,eAAezR,GAC5B2Y,EAAQrkB,EAAI0L,IAAQuZ,EAEpB1pB,KAAKmvI,WAAWnwE,EAAQ7uD,EAAKuZ,E,IAI1BZ,CACT,ECtRK,MAAM21H,WAA6B,GACxC,KAAA/vG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAEF,MAAMu8D,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAC/CkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,IAC5C9P,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECxBK,MAAM+5G,WAA2B,GACtC,KAAAhwG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM6uI,YAAa,MACxD3/E,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,OAC5Cn5E,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM8uI,UACrD5/E,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM+uI,KAC5C7+I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECnBK,MAAMm6G,WAA2B,GACtC,KAAApwG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAGF,MAAM4sI,EAC+C,eAAnDrvI,KAAKquI,kBAAkBv+H,EAAM,GAAI,cAAiCA,EAAM,GAAK,KAC/E9P,KAAKovI,cAAczqG,EAAQ0qG,GAE3B,MAAMrwE,EAASh/D,KAAKivI,kBAGpB,GAFAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAE9B,eAAbA,EAAM,IAAoC,UAAbA,EAAM,GACrCkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,IAC5CkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAOlU,MAAS9qD,KAAK0G,mBAAmBoJ,EAAM,IAAyC,KAAnCA,EAAM,GAAGnI,MAAM,OAAO9C,KAAK,WAC1E,GAAIiL,EAAMrN,OAAS,EAAG,CAC3Bu8D,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC,IAAK,IAAIhtI,EAAI,EAAGA,EAAIoN,EAAMrN,OAAQC,IAC3B1C,KAAK0G,mBAAmBoJ,EAAMpN,MACjCs8D,EAAOlU,OAASh7C,EAAMpN,GAAK,K,CAK5B1C,KAAK0G,mBAAmBoJ,EAAM,KAAOkvD,EAAO1xD,OAASs5C,GAAWqE,QACnE+T,EAAOx9D,KAAOsO,EAAM,GAAK,KAAOkvD,EAAOx9D,MAGzCxB,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EChDF,MAAMo6G,GAAoB,CAAC,WAAY,kBACjCC,GAA4B,IAAI9xI,IACpC6xI,GAAkBzoC,OAAO,CAAC,MAAO,WAAY,WAAY,iBAErD2oC,GAA2B,IAAI/xI,IACnC6xI,GAAkBzoC,OAAO,CAAC,aAAc,WAAY,YAAa,WAAY,SAGzE4oC,GAAyB,IAAIhyI,IACjC6xI,GAAkBzoC,OAAO,CACvB,QACA,YACA,aACA,WACA,QACA,mBACA,oBACA,OACA,UACA,aAIE6oC,GAAuB,IAAIjyI,IAAI6xI,GAAkBzoC,OAAO,CAAC,SAAU,WAAY,eAE/E8oC,GAAsB,IAAIlyI,IAAI6xI,GAAkBzoC,OAAO,CAAC,eAExD+oC,GAAyB,IAAInyI,IAAI6xI,GAAkBzoC,OAAO,CAAC,aAE1D,MAAMgpC,WAAwB,GACnC,KAAA5wG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBAIpB,GAHAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMyvI,SAAU,MACrDvgF,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM0vI,qBAE1B52I,IAAdkH,EAAM7I,IAER+3D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5C+3D,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAM2vI,aAEjDz/I,KAAK81I,qBAAqB92E,EAAQlvD,EAAOkvI,SACpC,QAAwBp2I,IAApBkH,EAAM4vI,UAEf1gF,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAM4vI,WAEjD1/I,KAAK81I,qBAAqB92E,EAAQlvD,EAAOsvI,SACpC,QAAyBx2I,IAArBkH,EAAM0gI,WAEfxxE,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAM6vI,UAC1D3gF,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAM0gI,YAClDxxE,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAK5D,SAAW1nD,KAAKquI,kBAAkBv+H,EAAM8vI,WACpD5gF,EAAO1T,KAAK3D,QAAU3nD,KAAKquI,kBAAkBv+H,EAAM+vI,UACnD7gF,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkBv+H,EAAM2gI,KAEhDzwI,KAAK81I,qBAAqB92E,EAAQlvD,EAAOmvI,SACpC,QAAwBr2I,IAApBkH,EAAMk4C,UAEfgX,EAAO7e,SAAW,IAAI0N,GACtBmR,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAS4H,MAAQ/nD,KAAKquI,kBAAkBv+H,EAAMi4C,OACrDiX,EAAO7e,SAAS6H,UAAYhoD,KAAKquI,kBAAkBv+H,EAAMk4C,WACzDgX,EAAO7e,SAAS8H,WAAajoD,KAAKquI,kBAAkBv+H,EAAMm4C,YAC1D+W,EAAO7e,SAAS+H,SAAWloD,KAAKquI,kBAAkBv+H,EAAMo4C,UACxD8W,EAAO7e,SAASuI,MAAQ1oD,KAAKquI,kBAAkBv+H,EAAM23C,QACrDuX,EAAO7e,SAAStvC,MAAQ7Q,KAAKquI,kBAAkBv+H,EAAMe,OACrDmuD,EAAO7e,SAASgI,SAAWnoD,KAAKquI,kBAAkBv+H,EAAMgwI,kBACxD9gF,EAAO7e,SAASiI,SAAWpoD,KAAKquI,kBAAkBv+H,EAAMiwI,mBACxD/gF,EAAO7e,SAASmI,KAAOtoD,KAAKquI,kBAAkBv+H,EAAMw4C,MACpD0W,EAAO7e,SAASqI,QAAUxoD,KAAKquI,kBAAkBv+H,EAAM04C,SACvDwW,EAAO7e,SAASoI,WAAavoD,KAAKquI,kBAAkBv+H,EAAMkwI,SAE1DhgJ,KAAK81I,qBAAqB92E,EAAQlvD,EAAOovI,SACpC,QAAqBt2I,IAAjBkH,EAAMmwI,OAAsB,CAQrC,OALAjhF,EAAO7e,SAAW,IAAI0N,GACtBmR,EAAO1xD,KAAOs5C,GAAW2E,SACzBvrD,KAAK2vI,gBAAgB3wE,EAAQlvD,EAAMowI,QACnClhF,EAAO7e,SAASqI,QAAUxoD,KAAKquI,kBAAkBv+H,EAAMqwI,WAE/CrwI,EAAMmwI,QAaZ,IAAK,WACHjhF,EAAO7e,SAASyI,eAAiB94C,EAAMswI,SACvC,MACF,IAAK,kBACHphF,EAAO7e,SAASwI,IAAM74C,EAAMswI,SAC5B,MACF,QACEphF,EAAO7e,SAAS0I,cAAgB/4C,EAAMswI,SAI1CpgJ,KAAK81I,qBAAqB92E,EAAQlvD,EAAOqvI,G,KACpC,SAAsBv2I,IAAlBkH,EAAMuwI,QASf,OAPArhF,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMuwI,SAE5CrgJ,KAAK81I,qBAAqB92E,EAAQlvD,EAAOuvI,G,CAK3Cr/I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEA,oBAAAmxG,CAAqB92E,EAAoB6uE,EAAUmI,GAC1B/sI,OAAOE,KAAK0kI,GAAKnuI,QAAQiF,IAAOqxI,EAAallF,IAAInsD,KACzDiD,SAASuI,IACtB,MAAM4R,EAAO8rH,EACb7tI,KAAKmvI,WAAWnwE,EAAQ7uD,EAAK4R,EAAK5R,GAAK,GAE3C,EC3HK,MAAMmwI,WAA4B,GACvC,KAAA5xG,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAA+BxmD,KAAKwtI,SAASh7H,GAAM,GACzD,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAAS+C,IACf,MAAM41I,EAAavgJ,KAAKwgJ,aAAa71I,GACrC,QAAmB/B,IAAf23I,EACF,OAGGvgJ,KAAK82B,cACR92B,KAAKovI,cAAczqG,EAAQh6B,EAAOqxH,QAGpC,MAAMh9D,EAAS,IAAIrN,GAInB,OAHAqN,EAAOx9D,KAAOxB,KAAKquI,kBAAkB1jI,EAAOnJ,KAAM,MAClDw9D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkB1jI,EAAO8gH,MAErC80B,GACN,KAAK35F,GAAWqE,MACd+T,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAO9T,MAAQ,IAAI8F,GACnBgO,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkB1jI,EAAOkZ,UACtDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkB1jI,EAAOmZ,UACtDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAatjI,EAAO1D,KAC7C,MACF,KAAK2/C,GAAWyE,KACd2T,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkB1jI,EAAO81I,gBAC3DzhF,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkB1jI,EAAO+1I,YACnD1hF,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkB1jI,EAAOg2I,KACjD3hF,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEznD,KAAKsuI,kBAAkBtvE,EAAQr0D,EAAOi2I,YACtC,MAEF,KAAKh6F,GAAW2E,SACdyT,EAAO1xD,KAAOs5C,GAAW2E,SAEzBvrD,KAAK2vI,gBAAgB3wE,EAAQh/D,KAAKquI,kBAAkB1jI,EAAOk2I,YAC3D7hF,EAAO7e,SAASgI,SAAWnoD,KAAKquI,kBAAkB1jI,EAAOw9C,UACzD6W,EAAO7e,SAASiI,SAAWpoD,KAAKquI,kBAAkB1jI,EAAOy9C,UACzD4W,EAAO7e,SAASmI,KAAOtoD,KAAKquI,kBAAkB1jI,EAAO29C,MACrD0W,EAAO7e,SAAS3lC,MAAQxa,KAAKquI,kBAAkB1jI,EAAO6P,OACtDwkD,EAAO7e,SAASoI,WAAavoD,KAAKquI,kBAAkB1jI,EAAOktI,SAC3D74E,EAAO7e,SAASqI,QAAUxoD,KAAKquI,kBAAkB1jI,EAAO69C,SACzB,MAA3BwW,EAAO7e,SAASqI,UAClBwW,EAAO7e,SAASqI,QAAUwW,EAAO7e,SAASqI,QAAQ7+C,eAEpDq1D,EAAO7e,SAAStvC,MAAQ7Q,KAAKquI,kBAAkB1jI,EAAOkG,OACtDmuD,EAAO7e,SAASuI,MAAQ1oD,KAAKquI,kBAAkB1jI,EAAOgsI,cACtD,MACF,KAAK/vF,GAAWuE,WACd6T,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QAM5C1vI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,YAAA67G,CAAa71I,GACnB,OAAK3K,KAAK0G,mBAAmBiE,EAAOkZ,UAI/B7jB,KAAK0G,mBAAmBiE,EAAO+1I,YAI/B1gJ,KAAK0G,mBAAmBiE,EAAOk2I,WAI/B7gJ,KAAK0G,mBAAmBiE,EAAO8gH,WAApC,EACS7kE,GAAWuE,WAJXvE,GAAW2E,SAJX3E,GAAWyE,KAJXzE,GAAWqE,KAgBtB,ECnHK,MAAM61F,WAAgC,GAA7C,c,oBACE,KAAAn8G,OAAS,IAAI,EAsQf,CApQE,KAAA+J,CAAMl8B,GAuBJ,OAtBAA,EAAK7K,MAAM3H,KAAK0sI,cAAc9kI,SAASm5I,IACrC,GAAI/gJ,KAAK0G,mBAAmBq6I,IAAqB,MAAZA,EAAK,GACxC,OAEF,MAAMh/H,EAAO0I,KAAKikB,MAAMqyG,GACxB,IAAqB,IAAjBh/H,EAAKi/H,QACP,OAEF,MAAMhiF,EAASh/D,KAAKivI,kBAEhBjvI,KAAK0G,mBAAmBqb,EAAKokC,MAC/BnmD,KAAKihJ,oBAAoBl/H,EAAMi9C,GAE/Bh/D,KAAKkhJ,sBAAsBn/H,EAAMi9C,GAGnCh/D,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGlCh/D,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,OAC9B,CAEQ,qBAAAu8G,CAAsBn/H,EAAWi9C,GACvC,GAAqB,MAAjBj9C,EAAKo/H,WACPniF,EAAOx9D,KAAOxB,KAAKquI,kBAAkBtsH,EAAKo/H,SAASp5F,OACzB,MAAtBhmC,EAAKo/H,SAASC,MAAc,CAC9B,MAAMxqE,EAAiB,GACvB70D,EAAKo/H,SAASC,KAAKx5I,SAASX,IACrBjH,KAAK0G,mBAAmBO,EAAIijD,IAC/B0sB,EAAKh8D,KAAK3T,EAAIijD,E,IAGlB8U,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAar3D,E,CAItB,MAAhB70D,EAAK6yE,UAC6B,MAAhC7yE,EAAK6yE,QAAQlpC,iBACf1rD,KAAKqhJ,qBAAqBt/H,EAAK6yE,QAAQlpC,gBAAiBsT,GAGvDh/D,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ0oD,QACrCt9I,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ67C,KAKrCzwI,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ6oD,YACrCz9I,KAAK0G,mBAAmBqb,EAAK6yE,QAAQzsC,YAEtC6W,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,KAPtBmR,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,IAQhB4S,EAAO1xD,OAASs5C,GAAWqE,OAAUjrD,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ9wE,YAC5Ek7C,EAAO9T,MAAMpnC,SAAW/B,EAAK6yE,QAAQ9wE,UAElC9jB,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ0sD,cACxCtiF,EAAOlU,MAAQ/oC,EAAK6yE,QAAQ0sD,WAAW35I,MAAM3H,KAAK0sI,cAAc7nI,KAAK,MAAQ,MAEpD,MAAvBkd,EAAK6yE,QAAQppC,QACfxrD,KAAKuhJ,YAAYx/H,EAAK6yE,QAAQppC,OAAQwT,EAAQ,cAAe,QAAS,QAE3C,MAAzBj9C,EAAK6yE,QAAQ4sD,UACfz/H,EAAK6yE,QAAQ4sD,SAAS55I,SAAS65I,IACP,MAAlBA,EAAQj2F,QACVxrD,KAAKuhJ,YAAYE,EAAQj2F,OAAQwT,EAAQ,IAAK,IAAK,I,IAK7D,CAEQ,mBAAAiiF,CAAoBl/H,EAAWi9C,GAkBrC,GAjBAA,EAAOnU,YAAW9oC,EAAK2/H,eAAgB3/H,EAAK2/H,aAAaC,WACzD3iF,EAAOx9D,KAAOxB,KAAKquI,kBAAkBtsH,EAAKgmC,OAEpB,2BAAlBhmC,EAAK6/H,UACP5iF,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,SACb,gCAAlB3tH,EAAK6/H,UACd5iF,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,IACS,wBAAlBrqC,EAAK6/H,UACd5iF,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,IAEtBmR,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAalsH,EAAKtH,UAGlB,MAAvBsH,EAAK8/H,eAAwB,CAO/B,GAN2C,MAAvC9/H,EAAK8/H,eAAen2F,iBACtB1rD,KAAKqhJ,qBAAqBt/H,EAAK8/H,eAAen2F,gBAAiBsT,GAE5Dh/D,KAAK0G,mBAAmBqb,EAAK8/H,eAAeP,cAC/CtiF,EAAOlU,MAAQ/oC,EAAK8/H,eAAeP,WAAW35I,MAAM3H,KAAK0sI,cAAc7nI,KAAK,MAAQ,MAElFm6D,EAAO1xD,OAASs5C,GAAWqE,QACxBjrD,KAAK0G,mBAAmBqb,EAAK8/H,eAAe/9H,YAC/Ck7C,EAAO9T,MAAMpnC,SAAW/B,EAAK8/H,eAAe/9H,UAEd,MAA5B/B,EAAK8/H,eAAeT,MAAc,CACpC,MAAMxqE,EAAiB,GACvB70D,EAAK8/H,eAAeT,KAAKx5I,SAASsiD,IAC3BlqD,KAAK0G,mBAAmBwjD,EAAEjjD,MAC7B2vE,EAAKh8D,KAAKsvC,EAAEjjD,I,IAGZ2vE,EAAKn0E,OAAS,IAChBu8D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAar3D,G,CAIV,MAA9B70D,EAAK8/H,eAAer2F,QACtBxrD,KAAKuhJ,YAAYx/H,EAAK8/H,eAAer2F,OAAQwT,EAAQ,cAAe,QAAS,QAE3C,MAAhCj9C,EAAK8/H,eAAeL,UACtBz/H,EAAK8/H,eAAeL,SAAS55I,SAAS65I,IACd,MAAlBA,EAAQj2F,QACVxrD,KAAKuhJ,YAAYE,EAAQj2F,OAAQwT,EAAQ,IAAK,IAAK,I,IAK7D,CAEQ,oBAAAqiF,CAAqB96F,EAAcyY,GACzC,MAAM8iF,EAAUv7F,EAAM9jD,OAAS,EAAI,EAAI8jD,EAAM9jD,OAC7Cu8D,EAAOtT,gBAAkBnF,EACtB7mD,QAAQuvF,IAAYjvF,KAAK0G,mBAAmBuoF,EAAEn/E,QAAoB,MAAVm/E,EAAElL,OAC1D3mD,MAAK,CAACh1B,EAAGC,IAAMA,EAAE07E,KAAO37E,EAAE27E,OAC1Bn/E,MAAM,EAAGk9I,GACTr9I,KAAKwqF,IACJ,MAAMtjC,EAAK,IAAI6F,GAGf,OAFA7F,EAAG7nC,SAAWmrE,EAAEn/E,MAChB67C,EAAGtB,aAAe,IAAI79C,MAAM,GAAKyiF,EAAElL,MAAMthF,QAAU,GAAKwsF,EAAElL,KAAgB,IAATkL,EAAElL,MAC5Dp4B,CAAE,GAEf,CAEQ,WAAA41F,CACN/1F,EACAwT,EACA+iF,EACAC,EACAvG,GAEAjwF,EAAO5jD,SAASosD,IACd,GAAuB,MAAnBA,EAAMguF,IAA2D,KAAtChuF,EAAMguF,GAAUv+I,WAAWkD,OACxD,OAIF,MAAM+xI,EACQ,SAAZ1kF,EAAM5qD,EACF,IAAIoD,KAAuB,IAAlBwnD,EAAMguF,IAAkB/6E,cACjCjT,EAAMguF,GAAUv+I,WAChBw+I,EACqB,MAAzBjuF,EAAM+tF,GAA0B/tF,EAAM+tF,GAAgBt+I,WAAa,KAErE,GAAIu7D,EAAO1xD,OAASs5C,GAAWqE,MAAO,CACpC,GAAIjrD,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,WAAkC,aAArBo+H,EAEpD,YADAjjF,EAAO9T,MAAMrnC,SAAW60H,GAEnB,GACL14I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,WAChB,aAArBm+H,EAGA,YADAjjF,EAAO9T,MAAMpnC,SAAW40H,GAEnB,GACL14I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMnB,OACjB,MAApBk4F,GACAA,EAAiBr7I,WAAW,SAG5B,YADAo4D,EAAO9T,MAAMnB,KAAO2uF,E,MAGjB,GAAI15E,EAAO1xD,OAASs5C,GAAWyE,KAAM,CAC1C,GAAIrrD,KAAK0G,mBAAmBs4D,EAAO1T,KAAK7D,SAAgC,UAArBw6F,EAGjD,OAFAjjF,EAAO1T,KAAK7D,OAASixF,OACrB15E,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,SAE3D,GAAIznD,KAAK0G,mBAAmBs4D,EAAO1T,KAAKthC,OAA8B,QAArBi4H,EAEtD,YADAjjF,EAAO1T,KAAKthC,KAAO0uH,GAEd,GACL14I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK/D,iBACf,eAArB06F,EAGA,YADAjjF,EAAO1T,KAAK/D,eAAiBmxF,GAExB,GACL14I,KAAK0G,mBAAmBs4D,EAAO1T,KAAKuB,aACf,WAArBo1F,GACsB,IAAtBvJ,EAAWj2I,OAOX,OALAu8D,EAAO1T,KAAK5D,SAAYgxF,EAAsB11I,OAAO,EAAG,GACxB,MAA5Bg8D,EAAO1T,KAAK5D,SAAS,KACvBsX,EAAO1T,KAAK5D,SAAWsX,EAAO1T,KAAK5D,SAAS1kD,OAAO,EAAG,SAExDg8D,EAAO1T,KAAK3D,QAAW+wF,EAAsB11I,OAAO,EAAG,IAElD,GAAyB,SAArBi/I,EAET,M,MAEG,GAAIjjF,EAAO1xD,OAASs5C,GAAW2E,SAAU,CAC9C,MAAMpL,EAAW6e,EAAO7e,SACxB,GAAIngD,KAAK0G,mBAAmBy5C,EAAS6H,YAAmC,cAArBi6F,EAEjD,YADA9hG,EAAS6H,UAAY0wF,GAEhB,GAAI14I,KAAK0G,mBAAmBy5C,EAAS+H,WAAkC,aAArB+5F,EAEvD,YADA9hG,EAAS+H,SAAWwwF,GAEf,GAAI14I,KAAK0G,mBAAmBy5C,EAAS8H,aAAoC,YAArBg6F,EAEzD,YADA9hG,EAAS8H,WAAaywF,GAEjB,GAAI14I,KAAK0G,mBAAmBy5C,EAASuI,QAA+B,aAArBu5F,EAEpD,YADA9hG,EAASuI,MAAQgwF,GAEZ,GAAI14I,KAAK0G,mBAAmBy5C,EAASsI,UAAiC,YAArBw5F,EAEtD,YADA9hG,EAASsI,QAAUiwF,GAEd,GAAI14I,KAAK0G,mBAAmBy5C,EAAStvC,QAA+B,UAArBoxI,EAEpD,YADA9hG,EAAStvC,MAAQ6nI,GAEZ,GAAI14I,KAAK0G,mBAAmBy5C,EAASt8B,WAAkC,aAArBo+H,EAEvD,YADA9hG,EAASt8B,SAAW60H,GAEf,GAAyB,YAArBuJ,EAAgC,CAEzC,MAAM,OAAEC,EAAM,KAAE55F,EAAI,QAAEE,EAAO,IAAE6lD,GAAQr6C,EAAMguF,GAO7C,OANA7hG,EAASgI,SAAWnoD,KAAKquI,kBAAkB6T,GAC3C/hG,EAASmI,KAAOtoD,KAAKquI,kBAAkB/lF,GAClCtoD,KAAK0G,mBAAmB8hD,KAC3BrI,EAASqI,QAAUA,EAAQ7+C,oBAE7Bw2C,EAASoI,WAAavoD,KAAKquI,kBAAkBhgC,G,EAKjD,MAAMsqC,EAAY34I,KAAK0G,mBAAmBstD,EAAMynF,IAAY,UAAYznF,EAAMynF,GAC9E,GACgB,aAAd9C,GAC0B,MAA1B35E,EAAOtT,iBACPsT,EAAOtT,gBAAgB0F,MAAM69B,GAAMA,EAAEnrE,WAAa40H,IAElD,OAGF,MAAMyJ,EAAwB,cAAZnuF,EAAM5qD,EAAoB09C,GAAU25E,OAAS35E,GAAU0vD,KACzEx2G,KAAKmvI,WAAWnwE,EAAQ25E,EAAWD,EAAYyJ,EAAU,GAE7D,ECtPF,IAAYC,GA0CAC,IA1CZ,SAAYD,GACV,cACA,mBACA,mBACA,iBACA,iBACA,iBACA,wBACA,oBACA,iBACA,uBACA,uBACA,mBACA,iBACA,uBACA,6BACA,uBACA,eACA,qBACA,uBACA,qBACD,CArBD,CAAYA,KAAAA,GAAY,KA0CxB,SAAYC,GACV,iBACA,mBACA,UACA,aACA,eACA,eACA,oBACA,cACD,CATD,CAAYA,KAAAA,GAAkB,KCzCvB,MAAMC,WAAgC,GAA7C,c,oBACE,KAAA39G,OAAS,IAAI,EAqmBf,CAnmBE,KAAA+J,CAAMl8B,GAgFJ,OA/E+BiY,KAAKikB,MAAMl8B,GAEfiL,SAAS,GAG5B8kI,OAAO36I,SAASq4C,IACtBA,EAAMsG,MAAM3+C,SAASma,IACnB,IAAqB,IAAjBA,EAAKi/H,QACP,OAGF,MAAMhiF,EAASh/D,KAAKivI,kBAEdzzB,EAAWz5F,EAAKygI,aACtB,OAAQhnC,GACN,KAAK4mC,GAAan3F,MAClB,KAAKm3F,GAAaK,SAClB,KAAKL,GAAa7wF,SAClB,KAAK6wF,GAAaM,eAClB,KAAKN,GAAaO,OAClB,KAAKP,GAAaQ,eAChB5jF,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAO9T,MAAQ,IAAI8F,GACnB,MACF,KAAKoxF,GAAanI,WAClB,KAAKmI,GAAaS,YAChB7jF,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB,MACF,KAAKg2F,GAAaj3F,WAClB,KAAKi3F,GAAaU,gBAClB,KAAKV,GAAaW,aAClB,KAAKX,GAAaY,cAEhBhkF,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC,MACF,KAAK0S,GAAa72F,SAClB,KAAK62F,GAAaa,eAClB,KAAKb,GAAac,eAClB,KAAKd,GAAae,WAClB,KAAKf,GAAagB,SAClB,KAAKhB,GAAaiB,eAClB,KAAKjB,GAAakB,qBAChBtkF,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,GAM1BmR,EAAOnU,SAA6B,IAAlB9oC,EAAKwhI,SAEvBvjJ,KAAKwjJ,gBAAgBzhI,EAAKo/H,SAAUniF,GAEpCh/D,KAAKyjJ,mBAAmB1hI,EAAMi9C,GAE9Bh/D,KAAK0jJ,eAAeloC,EAAUz5F,EAAK6yE,QAAS51B,GAE5Ch/D,KAAKqhJ,qBAAqBt/H,EAAK6yE,QAAQlpC,gBAAiBsT,GAExDh/D,KAAK2jJ,gBAAgBnoC,EAAUz5F,EAAK6yE,QAAQ4sD,SAAUxiF,GAEjDh/D,KAAK0G,mBAAmBqb,EAAK6yE,QAAQ0sD,cACxCtiF,EAAOlU,MAAQ/oC,EAAK6yE,QAAQ0sD,WAAW35I,MAAM3H,KAAK0sI,cAAc7nI,KAAK,MAAQ,MAG/E7E,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBh/D,KAAK2kC,OAAOg2C,QAAQ//D,KAAKokD,EAAO,GAChC,IAGAh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyBzuI,KAAK2kC,QAGrC3kC,KAAK2kC,OAAOwxD,SAAU,EACfvqF,QAAQC,QAAQ7L,KAAK2kC,OAC9B,CAEQ,eAAA6+G,CAAgBrC,EAAoBniF,GAC1C,GAAgB,MAAZmiF,EAAJ,CAMA,GAFAniF,EAAOx9D,KAAOxB,KAAKquI,kBAAkB8S,EAASp5F,OAEzB,MAAjBo5F,EAASvqE,KAAc,CACzB,MAAMA,EAAiB,GACvBuqE,EAASvqE,KAAKhvE,SAASX,IAChBjH,KAAK0G,mBAAmBO,EAAIA,MAC/B2vE,EAAKh8D,KAAK3T,EAAIA,I,IAGlB+3D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAar3D,E,CAGxC,GAAqB,MAAjBuqE,EAASyC,MAAgBzC,EAASyC,KAAKnhJ,OAAS,EAAG,CACrD,MAAM4sI,EAAarvI,KAAK4+E,WAAWuiE,EAASyC,KAAK,IACjD5jJ,KAAKovI,cAAcpvI,KAAK2kC,OAAQ0qG,E,EAEpC,CAEQ,UAAAzwD,CAAWilE,GACjB,OAAOA,EAAYl9I,OAAOzC,QAAQ,UAAWs3I,GAAMA,EAAEt3I,QAAQ,OAAQ6B,GAAMA,EAAE4D,iBAC/E,CAEQ,kBAAA85I,CAAmB1hI,EAAYi9C,GACjB,MAAhBj9C,EAAK6yE,SAIuB,MAA5B7yE,EAAK6yE,QAAQkvD,aAA2D,IAApC/hI,EAAK6yE,QAAQkvD,YAAYrhJ,QAIjEsf,EAAK6yE,QAAQkvD,YAAYl8I,SAASm8I,IAChC,GAA+B,aAA3BA,EAAWC,aAAmD,KAArBD,EAAWj0I,MAGtD,OAFAkvD,EAAO1xD,KAAOs5C,GAAWqE,WACzB+T,EAAO9T,MAAMrnC,SAAWkgI,EAAWj0I,OAIrC,GAA+B,aAA3Bi0I,EAAWC,aAAmD,KAArBD,EAAWj0I,MAGtD,OAFAkvD,EAAO1xD,KAAOs5C,GAAWqE,WACzB+T,EAAO9T,MAAMpnC,SAAWigI,EAAWj0I,OAIrC,IAAI4oI,EAAaqL,EAAWj0I,MACxBqyI,EAAuBr7F,GAAU0vD,KACrC,OAAQutC,EAAW5B,WACjB,KAAKE,GAAmB9wF,SACtB4wF,EAAYr7F,GAAU25E,OACtB,MACF,KAAK4hB,GAAmB4B,SACtBvL,EAAkC,KAArBqL,EAAWj0I,MAAe,OAAS,QAChDqyI,EAAYr7F,GAAU1b,QAK1BprC,KAAKmvI,WAAWnwE,EAAQ+kF,EAAWviJ,KAAMk3I,EAAYyJ,EAAU,GAEnE,CAEQ,cAAAuB,CAAeloC,EAAwB5mB,EAAkB51B,GAC3Dw8C,IAAa4mC,GAAa7wF,UAIf,MAAXqjC,IAGJ51B,EAAO9T,MAAMpnC,SAAW8wE,EAAQ9wE,SAClC,CAEQ,eAAA6/H,CAAgBnoC,EAAwBgmC,EAA4BxiF,GAC1D,MAAZwiF,GAAwC,IAApBA,EAAS/+I,QAIjC++I,EAAS55I,SAAS65I,IACM,MAAlBA,EAAQj2F,QAIZxrD,KAAKkkJ,mBAAmB1oC,EAAUimC,EAAQj2F,OAAQwT,EAAQyiF,EAAQ15F,MAAM,GAE5E,CAEQ,kBAAAm8F,CACN1oC,EACAhwD,EACAwT,EACAmlF,GAEA34F,EAAO5jD,SAASosD,IACd,MAAMguF,EAAW/4I,OAAOE,KAAK6qD,EAAMlkD,OAAO,GACpCs0I,EAAWpwF,EAEjB,GACoB,MAAlBowF,EAASt0I,OACmB,MAA5Bs0I,EAASt0I,MAAMkyI,IACc,KAA7BoC,EAASt0I,MAAMkyI,GAEf,OAGF,MAAMrJ,EAAY34I,KAAKqkJ,aAAarwF,EAAMjM,MAAOo8F,GAC3CzL,EAAa14I,KAAKskJ,aAAatwF,EAAMlkD,MAAOkyI,GAElD,GAAIhjF,EAAO1xD,OAASs5C,GAAWqE,MAAO,CACpC,GAAIjrD,KAAKukJ,UAAUvwF,EAAO0kF,EAAY15E,GACpC,OAGF,OAAQw8C,GACN,KAAK4mC,GAAan3F,MAClB,KAAKm3F,GAAaK,SAClB,KAAKL,GAAaW,aAClB,KAAKX,GAAaM,eAChB,MAEF,KAAKN,GAAaO,OAChB,GAAI3iJ,KAAK0G,mBAAmBs4D,EAAO9T,MAAMvB,MAAqB,QAAbqK,EAAM5tD,GAErD,YADA44D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAayK,IAGxC,MAEF,KAAK0J,GAAaQ,eAChB,GAAI5iJ,KAAKwkJ,mBAAmBxwF,EAAO0kF,EAAY15E,GAC7C,O,MAMD,GAAIA,EAAO1xD,OAASs5C,GAAWyE,KAAM,CAC1C,GAAIrrD,KAAKykJ,eAAezwF,EAAO0kF,EAAY15E,GACzC,OAGF,GAAIw8C,IAAa4mC,GAAaS,aACxB7iJ,KAAK0kJ,gBAAgB1wF,EAAO0kF,EAAY15E,GAC1C,M,MAGC,GAAIA,EAAO1xD,OAASs5C,GAAW2E,SAAU,CAC9C,GAAIvrD,KAAK2kJ,aAAa3wF,EAAO0kF,EAAY15E,EAAQgjF,GAC/C,OAEF,GAAiB,YAAbA,EAAwB,CAE1B,MAAM,OAAEE,EAAM,KAAE55F,EAAI,QAAEE,EAAO,IAAE6lD,EAAG,MAAE7zF,GAAUw5C,EAAMlkD,MAAMm+C,QAQ1D,OAPA+Q,EAAO7e,SAASgI,SAAWnoD,KAAKquI,kBAAkB6T,GAClDljF,EAAO7e,SAASmI,KAAOtoD,KAAKquI,kBAAkB/lF,GACzCtoD,KAAK0G,mBAAmB8hD,KAC3BwW,EAAO7e,SAASqI,QAAUA,EAAQ7+C,eAEpCq1D,EAAO7e,SAASoI,WAAavoD,KAAKquI,kBAAkBhgC,QACpDrvC,EAAO7e,SAAS3lC,MAAQxa,KAAKquI,kBAAkB7zH,G,CAIjD,OAAQghG,GACN,KAAK4mC,GAAa72F,SAChB,MACF,KAAK62F,GAAaa,eAChB,GAAIjjJ,KAAK4kJ,mBAAmB5wF,EAAO0kF,EAAY15E,GAC7C,OAEF,MACF,KAAKojF,GAAac,eAChB,GAAIljJ,KAAK6kJ,mBAAmB7wF,EAAO0kF,EAAY15E,GAC7C,OAEF,MACF,KAAKojF,GAAae,WAChB,GAAInjJ,KAAK8kJ,eAAe9wF,EAAO0kF,EAAY15E,GACzC,OAEF,MACF,KAAKojF,GAAagB,SAChB,GAAIpjJ,KAAK+kJ,aAAa/wF,EAAO0kF,EAAY15E,GACvC,OAEF,MACF,KAAKojF,GAAaiB,eAChB,GAAIrjJ,KAAKglJ,mBAAmBhxF,EAAO0kF,EAAY15E,GAC7C,OAEF,MACF,KAAKojF,GAAakB,qBAChB,GAAItjJ,KAAKilJ,QAAQjxF,EAAO0kF,EAAY15E,GAClC,O,CAQR,GAAiB,UAAbgjF,EAAsB,CAExB,MAAM,cAAEkD,EAAa,SAAEpkJ,GAAakzD,EAAMlkD,MAAMe,MAGhD,OAFA7Q,KAAKmvI,WAAWnwE,EAAQ25E,EAAWuM,EAAep+F,GAAU0vD,WAC5Dx2G,KAAKmvI,WAAWnwE,EAAQ,WAAYl+D,EAAUgmD,GAAU0vD,K,CAK1D,GACkB,aAAhBxiD,EAAMjM,OACoB,MAA1BiX,EAAOtT,iBACPsT,EAAOtT,gBAAgB0F,MAAM69B,GAAMA,EAAEnrE,WAAa40H,IAElD,OAIE1kF,EAAMmxF,SAAWnmF,EAAOhU,WAAanE,GAAmB98B,OAC1Di1C,EAAOhU,SAAWnE,GAAmB0K,UAGvC,MAAM4wF,EAAyB,cAAbH,EAA2Bl7F,GAAU25E,OAAS35E,GAAU0vD,KAC1Ex2G,KAAKmvI,WAAWnwE,EAAQ25E,EAAWD,EAAYyJ,EAAU,GAE7D,CAIQ,YAAAkC,CAAat8F,EAAeo8F,GAClC,OAAKnkJ,KAAK0G,mBAAmBqhD,GAIxB/nD,KAAK0G,mBAAmBy9I,GAItB,GAHEA,EAJAp8F,CAQX,CAEQ,YAAAu8F,CAAax0I,EAAckyI,GACjC,MAAiB,SAAbA,EACK,IAAIx1I,KAAkB,IAAbsD,EAAMs/B,MAAa63B,cAGpB,cAAb+6E,EACKlyI,EAAMs1I,UAAU3hJ,WAGjBqM,EAAckyI,EACxB,CAEQ,SAAAuC,CAAUvwF,EAAqB0kF,EAAoB15E,GACzD,MAAM25E,EAAY34I,KAAKqkJ,aAAarwF,EAAMjM,OAE1C,OAAI/nD,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,WAA2B,aAAd80H,GACpD35E,EAAO9T,MAAMrnC,SAAW60H,GACjB,GAGL14I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,WAA2B,aAAd60H,GACpD35E,EAAO9T,MAAMpnC,SAAW40H,GACjB,MAIP14I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMnB,OACzB,MAAZiK,EAAM5tD,KACN4tD,EAAM5tD,GAAGQ,WAAW,YAEpBo4D,EAAO9T,MAAMnB,KAAO2uF,GACb,EAIX,CAEQ,kBAAA8L,CAAmBxwF,EAAqB0kF,EAAoB15E,GAClE,MAAM25E,EAAY34I,KAAKqkJ,aAAarwF,EAAMjM,OAE1C,OAAI/nD,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,WAA2B,eAAd60H,GACpD35E,EAAO9T,MAAMpnC,SAAW40H,GACjB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMvB,MAAsB,aAAdgvF,KAC/C35E,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAayK,IAC/B,EAIX,CAEQ,cAAA+L,CAAezwF,EAAqB0kF,EAAoB15E,GAC9D,GAAIh/D,KAAK0G,mBAAmBs4D,EAAO1T,KAAK7D,SAAwB,UAAbuM,EAAM5tD,GAGvD,OAFA44D,EAAO1T,KAAK7D,OAASixF,EACrB15E,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,SACzD,EAGT,GAAIznD,KAAK0G,mBAAmBs4D,EAAO1T,KAAKthC,OAAsB,QAAbgqC,EAAM5tD,GAErD,OADA44D,EAAO1T,KAAKthC,KAAO0uH,GACZ,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO1T,KAAK/D,iBAAgC,eAAbyM,EAAM5tD,GAE/D,OADA44D,EAAO1T,KAAK/D,eAAiBmxF,GACtB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO1T,KAAKuB,aAA4B,WAAbmH,EAAM5tD,GAAiB,CAC5E,MAAMg/I,EAAoB1M,EAAWj1I,WAAWkD,OAMhD,OALAq4D,EAAO1T,KAAK5D,SAAW09F,EAAUn7I,UAAU,EAAG,GACd,MAA5B+0D,EAAO1T,KAAK5D,SAAS,KACvBsX,EAAO1T,KAAK5D,SAAWsX,EAAO1T,KAAK5D,SAASz9C,UAAU,EAAG,IAE3D+0D,EAAO1T,KAAK3D,QAAUy9F,EAAUn7I,UAAU,EAAG,IACtC,C,CAGT,MAAiB,SAAb+pD,EAAM5tD,EAMZ,CAEQ,eAAAs+I,CAAgB1wF,EAAqB0kF,EAAoB15E,GAC/D,SAAIh/D,KAAK0G,mBAAmBs4D,EAAO1T,KAAK/D,iBAAgC,UAAbyM,EAAM5tD,MAC/D44D,EAAO1T,KAAK/D,eAAiBmxF,GACtB,EAIX,CAEQ,YAAAiM,CACN3wF,EACA0kF,EACA15E,EACAgjF,GAEA,GAAIhiJ,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,cAAbgM,EAAM5tD,GAE9D,OADA44D,EAAO7e,SAAS6H,UAAY0wF,GACrB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAS+H,WAA0B,aAAb8L,EAAM5tD,GAE7D,OADA44D,EAAO7e,SAAS+H,SAAWwwF,GACpB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAS8H,aAA4B,YAAb+L,EAAM5tD,GAE/D,OADA44D,EAAO7e,SAAS8H,WAAaywF,GACtB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASuI,QAAuB,aAAbsL,EAAM5tD,GAE1D,OADA44D,EAAO7e,SAASuI,MAAQgwF,GACjB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASsI,UAAyB,YAAbuL,EAAM5tD,GAE5D,OADA44D,EAAO7e,SAASsI,QAAUiwF,GACnB,EAGT,GAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAStvC,OAAQ,CAClD,GAAiB,UAAbmxI,EAAsB,CACxB,MAAM,cAAEkD,EAAa,SAAEpkJ,GAAakzD,EAAMlkD,MAAMe,MAGhD,OAFAmuD,EAAO7e,SAAStvC,MAAQ7Q,KAAKquI,kBAAkB6W,GAC/CllJ,KAAKmvI,WAAWnwE,EAAQ,WAAYl+D,EAAUgmD,GAAU0vD,OACjD,C,CAGT,GAAiB,UAAbxiD,EAAM5tD,GAER,OADA44D,EAAO7e,SAAStvC,MAAQ6nI,GACjB,C,CAIX,SAAI14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASt8B,WAA0B,aAAbmwC,EAAM5tD,MAC7D44D,EAAO7e,SAASt8B,SAAW60H,GACpB,EAGX,CAEQ,kBAAAkM,CAAmB5wF,EAAqB0kF,EAAoB15E,GAClE,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,aAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,GAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASgI,WAA0B,YAAb6L,EAAM5tD,IAC7D44D,EAAO7e,SAASgI,SAAWuwF,GACpB,GAIL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASqI,UAAyB,YAAbwL,EAAM5tD,IAC5D44D,EAAO7e,SAASqI,QAAUkwF,GACnB,GAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAS3lC,QAAuB,UAAbw5C,EAAM5tD,IAC1D44D,EAAO7e,SAAS3lC,MAAQk+H,GACjB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAS0I,gBAA+B,WAAbmL,EAAM5tD,MAClE44D,EAAO7e,SAAS0I,cAAgB6vF,GACzB,EAIX,CAEQ,kBAAAmM,CAAmB7wF,EAAqB0kF,EAAoB15E,GAClE,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,SAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,GAIL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASqI,UAAyB,YAAbwL,EAAM5tD,IAC5D44D,EAAO7e,SAASqI,QAAUkwF,GACnB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAAS3lC,QAAuB,UAAbw5C,EAAM5tD,MAC1D44D,EAAO7e,SAAS3lC,MAAQk+H,GACjB,EAIX,CAEQ,cAAAoM,CAAe9wF,EAAqB0kF,EAAoB15E,GAC9D,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,gBAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,GAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASsI,UAAyB,aAAbuL,EAAM5tD,IAC5D44D,EAAO7e,SAASsI,QAAUiwF,GACnB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASuI,QAAuB,UAAbsL,EAAM5tD,MAC1D44D,EAAO7e,SAASuI,MAAQgwF,GACjB,EAIX,CAEQ,YAAAqM,CAAa/wF,EAAqB0kF,EAAoB15E,GAC5D,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,aAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,GAIL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASqI,UAAyB,oBAAbwL,EAAM5tD,IAC5D44D,EAAO7e,SAASqI,QAAUkwF,GACnB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASyI,iBAAgC,WAAboL,EAAM5tD,MACnE44D,EAAO7e,SAASyI,eAAiB8vF,GAC1B,EAIX,CAEQ,kBAAAsM,CAAmBhxF,EAAqB0kF,EAAoB15E,GAClE,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,gBAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASsI,UAAyB,iBAAbuL,EAAM5tD,MAC5D44D,EAAO7e,SAASsI,QAAUiwF,GACnB,EAIX,CAEQ,OAAAuM,CAAQjxF,EAAqB0kF,EAAoB15E,GACvD,OAAIh/D,KAAK0G,mBAAmBs4D,EAAO7e,SAAS6H,YAA2B,SAAbgM,EAAM5tD,IAC9DpG,KAAK2vI,gBAAgB3wE,EAAQ05E,IACtB,MAGL14I,KAAK0G,mBAAmBs4D,EAAO7e,SAASwI,MAAqB,WAAbqL,EAAM5tD,MACxD44D,EAAO7e,SAASwI,IAAM+vF,GACf,EAIX,CAEQ,oBAAA2I,CAAqBgE,EAAuCrmF,GAClE,GAAoB,MAAhBqmF,GAAgD,IAAxBA,EAAa5iJ,OACvC,OAGF,MAAMq/I,EAAUuD,EAAa5iJ,OAAS,EAAI,EAAI4iJ,EAAa5iJ,OAC3Du8D,EAAOtT,gBAAkB25F,EACtB3lJ,QAAQuvF,IAAYjvF,KAAK0G,mBAAmBuoF,EAAEn/E,QAAoB,MAAVm/E,EAAElL,OAC1D3mD,MAAK,CAACh1B,EAAGC,IAAMA,EAAE07E,KAAO37E,EAAE27E,OAC1Bn/E,MAAM,EAAGk9I,GACTr9I,KAAKwqF,IACJ,MAAMtjC,EAAK,IAAI6F,GAGf,OAFA7F,EAAG7nC,SAAWmrE,EAAEn/E,MAChB67C,EAAGtB,aAAe,IAAI79C,MAAM,GAAKyiF,EAAElL,MAAMthF,QAAU,GAAKwsF,EAAElL,KAAgB,IAATkL,EAAElL,MAC5Dp4B,CAAE,GAEf,EC/nBK,MAAM25F,GAEX,WAAA9lJ,CACS+lJ,EACAhR,EACAv1E,GAFA,KAAAumF,aAAAA,EACA,KAAAhR,SAAAA,EACA,KAAAv1E,OAAAA,EAEPh/D,KAAKwlJ,cAAgBjR,EAASvsI,aAChC,ECAK,MAAMy9I,GAAoB,CAC/B,QACA,aACA,aACA,KACA,QACA,OACA,QACA,OACA,SAGK,MAAeC,WAA+B,GAArD,c,oBACY,KAAAC,qBAAuB,CAC/B3lJ,KAAK4lJ,iBACL5lJ,KAAK6lJ,iBACL7lJ,KAAK8lJ,cAEG,KAAAC,0BAA4B,CACpC/lJ,KAAKgmJ,oBACLhmJ,KAAKimJ,0BACLjmJ,KAAKkmJ,4BACLlmJ,KAAKmmJ,qBAEG,KAAAC,wBAA0B,CAClCpmJ,KAAKqmJ,qBACLrmJ,KAAKsmJ,mBACLtmJ,KAAKumJ,oBACLvmJ,KAAKwmJ,oBACLxmJ,KAAKymJ,iBACLzmJ,KAAK0mJ,iBACL1mJ,KAAK2mJ,mBAsVT,CAjVE,KAAAj4G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,EAAM,CACxCo0I,UAAW,IACXC,WAAY,OAEd,OAAe,MAAXrgG,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAI9P,KAAK0G,mBAAmB1G,KAAK8mJ,QAAQh3I,EAAO,UAC9C,OAGF,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBruI,KAAK8mJ,QAAQh3I,EAAO,SAAU,MAEnE9P,KAAK+mJ,SAASj3I,EAAOkvD,GAErBh/D,KAAKgnJ,cAAcl3I,EAAOkvD,GAE1B,IAAIioF,EAAsB,KAC1B,IAAK,MAAM1S,KAAYzkI,EAAO,CAE5B,IAAKA,EAAM8R,eAAe2yH,IAAav0I,KAAK0G,mBAAmBoJ,EAAMykI,IACnE,SAGF,MAAM2S,EAAU,IAAI5B,GAAoBx1I,EAAOykI,EAAUv1E,GACrDA,EAAO1xD,OAASs5C,GAAWqE,OAASjrD,KAAKmnJ,mBAAmBD,KAErDloF,EAAO1xD,OAASs5C,GAAWyE,MAAQrrD,KAAKonJ,wBAAwBF,IAEhEloF,EAAO1xD,OAASs5C,GAAW2E,UAAYvrD,KAAKqnJ,sBAAsBH,KAI7ED,EAAcjnJ,KAAKsnJ,gBAAgBJ,EAASD,I,CAI5CjoF,EAAO1xD,OAASs5C,GAAWqE,QAC1BjrD,KAAK0G,mBAAmBugJ,IACzBjnJ,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,YACL,IAAhCojI,EAAYpgJ,QAAQ,SAEpBm4D,EAAO9T,MAAMrnC,SAAWojI,GAG1BjnJ,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEU,OAAAmiH,CAAQn+I,EAAUnH,GAK1B,OAJiByH,OAAO2B,QAAQjC,GAAKs2B,QAAO,CAAC08C,EAAU24D,KACrD34D,EAAI24D,EAAM,GAAGtsI,eAAiBssI,EAAM,GAC7B34D,IACN,CAAC,GACYn6E,EAAKwG,cACvB,CAEU,eAAAu/I,CAAgB5+I,EAAU6+I,GAClC,MAAMC,EAAex+I,OAAOE,KAAKR,GAAKs2B,QAAO,CAAC08C,EAAexrE,KACvDA,EAAI1E,MAAM+7I,IACZ7rE,EAAI/gE,KAAKzK,GAEJwrE,IACN,IACH,OAA4B,IAAxB8rE,EAAahlJ,OACR,KAEAkG,EAAI8+I,EAAa,GAE5B,CAEU,gBAAAC,CAAiB/+I,EAAUnH,GACnC,MAAMmmJ,EAAc1+I,OAAOE,KAAKR,GAAKs2B,QAAO,CAAC08C,EAAe24D,KACtDA,EAAMtsI,cAAckoC,SAAS1uC,EAAKwG,gBACpC2zE,EAAI/gE,KAAK05H,GAEJ34D,IACN,IACH,OAA2B,IAAvBgsE,EAAYllJ,OACP,KAEAkG,EAAIg/I,EAAY,GAE3B,CAEU,QAAAZ,CAASxB,EAAmBvmF,GACpCA,EAAOlU,MACL9qD,KAAKquI,kBAAkBruI,KAAK8mJ,QAAQvB,EAAc,cAAe,IACjE,KACAvlJ,KAAKquI,kBAAkBruI,KAAK8mJ,QAAQvB,EAAc,SAAU,IAC5D,KACFvmF,EAAOlU,MAAMnkD,MACf,CAEU,kBAAAwgJ,CAAmBD,GAC3B,OAAOlnJ,KAAK2lJ,qBAAqB1mH,QAAO,CAAC08C,EAAcisE,KAChDjsE,IACHA,EAAMisE,EAAK57E,KAAKhsE,KAAV4nJ,CAAgBV,IAEjBvrE,KACN,EACL,CAEU,uBAAAyrE,CAAwBF,GAChC,OAAOlnJ,KAAK+lJ,0BAA0B9mH,QAAO,CAAC08C,EAAcisE,KACrDjsE,IACHA,EAAMisE,EAAK57E,KAAKhsE,KAAV4nJ,CAAgBV,IAEjBvrE,KACN,EACL,CAEU,qBAAA0rE,CAAsBH,GAC9B,OAAOlnJ,KAAKomJ,wBAAwBnnH,QAAO,CAAC08C,EAAcisE,KACnDjsE,IACHA,EAAMisE,EAAK57E,KAAKhsE,KAAV4nJ,CAAgBV,IAEjBvrE,KACN,EACL,CAEU,eAAA2rE,CAAgBJ,EAA8BD,GACtD,IACwD,IAAtDxB,GAAkB5+I,QAAQqgJ,EAAQ1B,iBACjC0B,EAAQ1B,cAAc5+I,WAAW,cACjCsgJ,EAAQ1B,cAAc5+I,WAAW,YAClC,CACA,GAAmB,MAAfqgJ,GAAiD,UAA1BC,EAAQ1B,cACjC,OAAO0B,EAAQ3B,aAAa2B,EAAQ3S,UAC/B,GACqB,iBAA1B2S,EAAQ1B,eACkB,kBAA1B0B,EAAQ1B,cACR,CACA,MAAMqC,EAAe,IAAIr7I,KACgC,IAAvDzJ,SAASmkJ,EAAQ3B,aAAa2B,EAAQ3S,UAAW,KACjDttE,cAEF,OADAjnE,KAAKmvI,WAAW+X,EAAQloF,OAAQ,aAAekoF,EAAQ3S,SAAUsT,GAC1D,I,CAGPX,EAAQ1B,cAAct1G,SAAS,aAC/Bg3G,EAAQ1B,cAAct1G,SAAS,QAC/Bg3G,EAAQ1B,cAAct1G,SAAS,UAE/BlwC,KAAKmvI,WACH+X,EAAQloF,OACRkoF,EAAQ3S,SACR2S,EAAQ3B,aAAa2B,EAAQ3S,UAC7BztF,GAAU25E,QAGZzgI,KAAKmvI,WAAW+X,EAAQloF,OAAQkoF,EAAQ3S,SAAU2S,EAAQ3B,aAAa2B,EAAQ3S,U,CAGnF,OAAO,IACT,CAEU,oBAAA8R,CAAqBa,GAC7B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAAS6H,aAChDk/F,EAAQ1B,cAAct1G,SAAS,iBAE/Bg3G,EAAQloF,OAAO7e,SAAS6H,UAAYk/F,EAAQ3B,aAAa2B,EAAQ3S,WAC1D,EAGX,CAEU,kBAAA+R,CAAmBY,GAC3B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAAS8H,cAChDi/F,EAAQ1B,cAAct1G,SAAS,cAE/Bg3G,EAAQloF,OAAO7e,SAAS8H,WAAai/F,EAAQ3B,aAAa2B,EAAQ3S,WAC3D,EAGX,CAEU,mBAAAgS,CAAoBW,GAC5B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAAS+H,YAChDg/F,EAAQ1B,cAAct1G,SAAS,gBAE/Bg3G,EAAQloF,OAAO7e,SAAS+H,SAAWg/F,EAAQ3B,aAAa2B,EAAQ3S,WACzD,EAGX,CAEU,mBAAAiS,CAAoBU,GAC5B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAASt8B,YAChDqjI,EAAQ1B,cAAct1G,SAAS,eAE/Bg3G,EAAQloF,OAAO7e,SAASt8B,SAAWqjI,EAAQ3B,aAAa2B,EAAQ3S,WACzD,EAGX,CAEU,kBAAAoS,CAAmBO,GAC3B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAASsI,WAChDy+F,EAAQ1B,cAAct1G,SAAS,cAE/Bg3G,EAAQloF,OAAO7e,SAASsI,QAAUy+F,EAAQ3B,aAAa2B,EAAQ3S,WACxD,EAGX,CAEU,gBAAAmS,CAAiBQ,GACzB,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAASuI,SAChDw+F,EAAQ1B,cAAct1G,SAAS,oBAE/Bg3G,EAAQloF,OAAO7e,SAASuI,MAAQw+F,EAAQ3B,aAAa2B,EAAQ3S,WACtD,EAGX,CAEU,gBAAAkS,CAAiBS,GACzB,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO7e,SAAStvC,SAChDq2I,EAAQ1B,cAAct1G,SAAS,YAE/Bg3G,EAAQloF,OAAO7e,SAAStvC,MAAQq2I,EAAQ3B,aAAa2B,EAAQ3S,WACtD,EAGX,CAEU,mBAAAyR,CAAoBkB,GAC5B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO1T,KAAK7D,UAC5Cy/F,EAAQ1B,cAAct1G,SAAS,aAE/Bg3G,EAAQloF,OAAO1T,KAAK7D,OAASy/F,EAAQ3B,aAAa2B,EAAQ3S,UAC1D2S,EAAQloF,OAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBk6F,EAAQloF,OAAO1T,KAAK7D,SACzE,EAGX,CAEU,yBAAAw+F,CAA0BiB,GAClC,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO1T,KAAKthC,QAC5Ck9H,EAAQ1B,cAAct1G,SAAS,0BAE/Bg3G,EAAQloF,OAAO1T,KAAKthC,KAAOk9H,EAAQ3B,aAAa2B,EAAQ3S,WACjD,EAGX,CAEU,2BAAA2R,CAA4BgB,GACpC,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO1T,KAAK/D,kBAC5C2/F,EAAQ1B,cAAct1G,SAAS,sBAE/Bg3G,EAAQloF,OAAO1T,KAAK/D,eAAiB2/F,EAAQ3B,aAAa2B,EAAQ3S,WAC3D,EAGX,CAEU,mBAAA4R,CAAoBe,GAC5B,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO1T,KAAKuB,cAC5Cq6F,EAAQ1B,cAAct1G,SAAS,gBACmB,IAAlDg3G,EAAQ3B,aAAa2B,EAAQ3S,UAAU9xI,UAEvCykJ,EAAQloF,OAAO1T,KAAK5D,SAAYw/F,EAAQ3B,aAAa2B,EAAQ3S,UAAqBvxI,OAChF,EACA,GAEsC,MAApCkkJ,EAAQloF,OAAO1T,KAAK5D,SAAS,KAC/Bw/F,EAAQloF,OAAO1T,KAAK5D,SAAWw/F,EAAQloF,OAAO1T,KAAK5D,SAAS1kD,OAAO,EAAG,IAExEkkJ,EAAQloF,OAAO1T,KAAK3D,QAAWu/F,EAAQ3B,aAAa2B,EAAQ3S,UAAqBvxI,OAAO,EAAG,IACpF,EAGX,CAEU,gBAAA6iJ,CAAiBqB,GACzB,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO9T,MAAMpnC,WACnB,aAA1BojI,EAAQ1B,iBAER0B,EAAQloF,OAAO9T,MAAMpnC,SAAWojI,EAAQ3B,aAAa2B,EAAQ3S,WACtD,EAGX,CAEU,gBAAAqR,CAAiBsB,GACzB,SACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO9T,MAAMrnC,WACnB,aAA1BqjI,EAAQ1B,iBAER0B,EAAQloF,OAAO9T,MAAMrnC,SAAWqjI,EAAQ3B,aAAa2B,EAAQ3S,WACtD,EAGX,CAEU,YAAAuR,CAAaoB,GACrB,IACgC,MAA7BA,EAAQloF,OAAO9T,MAAMjB,MAAqD,IAArCi9F,EAAQloF,OAAO9T,MAAMjB,KAAKxnD,SACtC,SAA1BykJ,EAAQ1B,cACR,CACA,MAAM5uE,EAAOswE,EAAQ3B,aAAa2B,EAAQ3S,UAAU5sI,MAAM3H,KAAK0sI,cAE/D,OADAwa,EAAQloF,OAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAar3D,IACvC,C,CACF,MAA8B,QAA1BswE,EAAQ1B,gBACgB,MAA7B0B,EAAQloF,OAAO9T,MAAMjB,OACvBi9F,EAAQloF,OAAO9T,MAAMjB,KAAO,IAE9Bi9F,EAAQloF,OAAO9T,MAAMjB,KAAKqsD,OAAOt2G,KAAKiuI,aAAaiZ,EAAQ3B,aAAa2B,EAAQ3S,aACzE,EAGX,ECrXK,MAAMuT,WAAkCpC,GAC7C,aAAAsB,CAAcl3I,EAAYkvD,GAExB,OADoBh/D,KAAKquI,kBAAkBruI,KAAK8mJ,QAAQh3I,EAAO,QAAS,UAEtE,IAAK,cACHkvD,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClBq5F,GAAkB7qI,KAAK,QACvB,MACF,IAAK,WACHokD,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,GACtB43F,GAAkB7qI,KAAK,QACvB,MACF,IAAK,QACL,IAAK,cACH6qI,GAAkB7qI,KAAK,QAK7B,ECnBK,MAAMmtI,WAAkCrC,GAC7C,WAAAlmJ,GACEiO,QACAzN,KAAKomJ,wBAAwBxrI,KAAK5a,KAAKgoJ,mBACzC,CAEA,aAAAhB,CAAcl3I,EAAYkvD,GACxBA,EAAO1xD,KAAOs5C,GAAWqE,MACzB+T,EAAO9T,MAAQ,IAAI8F,GAGhBhxD,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,kBACpD9P,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,wBAErDkvD,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,IAIjBpsD,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,2BACpD9P,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,wBACpD9P,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,0BACpD9P,KAAK0G,mBAAmB1G,KAAKunJ,gBAAgBz3I,EAAO,2BAErDkvD,EAAO1xD,KAAOs5C,GAAW2E,SACzByT,EAAO7e,SAAW,IAAI0N,GAE1B,CAEA,kBAAAm6F,CAAmBd,GACjB,QAAIA,EAAQ1B,cAAc/5I,MAAM,2BAC9BzL,KAAKmvI,WAAW+X,EAAQloF,OAAQ,UAAWkoF,EAAQ3B,aAAa2B,EAAQ3S,YACjE,EAGX,CAEA,mBAAA4R,CAAoBe,GAClB,GACElnJ,KAAK0G,mBAAmBwgJ,EAAQloF,OAAO1T,KAAKuB,aAC5Cq6F,EAAQ1B,cAAct1G,SAAS,eAC/B,CACA,MAAM+3G,EAAYf,EAAQ3B,aAAa2B,EAAQ3S,UAAqB5sI,MAAM,KAM1E,OALAu/I,EAAQloF,OAAO1T,KAAK5D,SAAWugG,EAAS,GACA,MAApCf,EAAQloF,OAAO1T,KAAK5D,SAAS,IAAsD,IAAxCw/F,EAAQloF,OAAO1T,KAAK5D,SAASjlD,SAC1EykJ,EAAQloF,OAAO1T,KAAK5D,SAAWw/F,EAAQloF,OAAO1T,KAAK5D,SAAS1kD,OAAO,EAAG,IAExEkkJ,EAAQloF,OAAO1T,KAAK3D,QAAUsgG,EAAS,GAAGxlJ,OAAS,EAAIwlJ,EAAS,GAAGjlJ,OAAO,EAAG,GAAKilJ,EAAS,IACpF,C,CAET,OAAO,CACT,ECvDK,MAAMC,WAA2B,GACtC,KAAAx5G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAI/hB,EAAoB,KAmExB,OAlEA4jC,EAAQ5+C,SAASkI,IACf,GAAe,MAAX8S,EAEF,YADAA,EAAU9S,EAAMrL,KAAKgR,GAAcA,KAIrC,GAAI3F,EAAMrN,OAAS,GAAKqN,EAAMrN,SAAWmgB,EAAQngB,OAC/C,OAGF,IAAKzC,KAAK0G,mBAAmBoJ,EAAM,IACjC,GAAI9P,KAAK82B,aAAc,CACPhnB,EAAM,GAAcnI,MAAM,KACnCC,SAAS+tD,IACZA,EAAMA,EAAIhvD,OACV,IAAIyqI,GAAgB,EAChBC,EAAkB1sG,EAAO8rC,YAAYhuE,OAEzC,IAAK,IAAIC,EAAI,EAAGA,EAAIiiC,EAAO8rC,YAAYhuE,OAAQC,IAC7C,GAAIiiC,EAAO8rC,YAAY/tE,GAAGlB,OAASm0D,EAAK,CACtCy7E,GAAgB,EAChBC,EAAkB3uI,EAClB,K,CAIJ,GAAI0uI,EAAe,CACjB,MAAMzN,EAAa,IAAI3B,GACvB2B,EAAWniI,KAAOm0D,EAClBhxB,EAAO8rC,YAAY71D,KAAK+oH,E,CAG1Bh/F,EAAO0nG,wBAAwBzxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQ4uI,GAAiB,G,KAE1E,CACL,MAAMuS,EAAQ9zI,EAAM,GAAcnI,MAAM,KAClCguD,EAAMiuF,EAAKnhJ,OAAS,EAAImhJ,EAAK,GAAGj9I,OAAS,KAC/C3G,KAAKovI,cAAczqG,EAAQgxB,E,CAI/B,MAAMqJ,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAE/C,IAAK,IAAIpN,EAAI,EAAGA,EAAIoN,EAAMrN,OAAQC,IAAK,CACrC,MAAM+qI,EAAS7qH,EAAQlgB,GAAGiE,OAAOqB,cAC7BhI,KAAK0G,mBAAmBoJ,EAAMpN,KAAO1C,KAAK0G,mBAAmB+mI,KAI7DztI,KAAK4sI,mBAAmB/lI,QAAQ4mI,IAAW,EAC7CzuE,EAAO9T,MAAMrnC,SAAW/T,EAAMpN,GACrB1C,KAAK2sI,mBAAmB9lI,QAAQ4mI,IAAW,EACpDzuE,EAAO9T,MAAMpnC,SAAWhU,EAAMpN,GACrB1C,KAAK8sI,cAAcjmI,QAAQ4mI,IAAW,EAC/CzuE,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMpN,IAE5C1C,KAAKmvI,WAAWnwE,EAAQp8C,EAAQlgB,GAAIoN,EAAMpN,I,CAI9C1C,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EC/EK,MAAMwjH,WAA4B,GACvC,KAAAz5G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf9P,KAAKovI,cAAczqG,EAAQ3kC,KAAKooJ,SAAS,WAAYt4I,IACrD,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOlU,MAAQ9qD,KAAKooJ,SAAS,cAAet4I,GAC5CkvD,EAAOx9D,KAAOxB,KAAKquI,kBAAkBruI,KAAKooJ,SAAS,QAASt4I,GAAQ,MACpEkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKooJ,SAAS,WAAYt4I,GAClDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKooJ,SAAS,WAAYt4I,GAClDkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAajuI,KAAKooJ,SAAS,OAAQt4I,IAC5D9P,KAAKmvI,WAAWnwE,EAAQ,aAAch/D,KAAKooJ,SAAS,YAAat4I,IACjE9P,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,QAAAyjH,CAASj4I,EAAaL,GAC5B,OAAO9P,KAAKquI,kBAAkBv+H,EAAMK,GAAMnQ,KAAKquI,kBAAkBv+H,EAAM,IAAMK,IAC/E,EC/BK,MAAMk4I,WAA2B,GACtC,KAAA35G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb2jH,EAAiC79H,KAAKikB,MAAMl8B,GAClD,OACkB,MAAhB81I,GAC0B,MAA1BA,EAAa1hC,WACqB,IAAlC0hC,EAAa1hC,UAAUnkH,QAEvBkiC,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,IAGK,GAA1B2jH,EAAa3gI,WACfgd,EAAOwxD,SAAU,EACjBxxD,EAAO9oB,aAAe,+CACfjQ,QAAQC,QAAQ84B,KAGzB2jH,EAAa1hC,UAAUh/G,SAAS+C,IAC9B,MAAMq0D,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOmJ,EAAOw+G,QACrBnqD,EAAO9T,MAAMrnC,SAAWlZ,EAAOkZ,SAC/Bm7C,EAAO9T,MAAMpnC,SAAWnZ,EAAOmZ,SAE/Bk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAatjI,EAAOw+G,SAC7CnqD,EAAOlU,MAAQngD,EAAO7K,QAEtBE,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECpCK,MAAM4jH,WAA4B,GACvC,KAAA75G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAU/7B,KAAKikB,MAAMl8B,GAC3B,OAAe,MAAXg0C,GAAsC,IAAnBA,EAAQ/jD,QAC7BkiC,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASwF,IACf,GAAuB,MAAnBA,EAAWw2I,MAAgBx2I,EAAWw2I,KAAKnhJ,OAAS,EAAG,CACzD,MAAM4sI,EAAajiI,EAAWw2I,KAAK,GAAGlmD,KACtC19F,KAAKovI,cAAczqG,EAAQ0qG,E,CAG7B,MAAMrwE,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAO4L,EAAWijI,MAEzBrxE,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBjhI,EAAWyW,UACtD7jB,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,UACvCm7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBjhI,EAAWyD,OAChD7Q,KAAK0G,mBAAmB0G,EAAWyD,SAC7CmuD,EAAOlU,MAAQ,UAAY19C,EAAWyD,MAAQ,MAGhDmuD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBjhI,EAAW0W,UAC1Dk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAa7gI,EAAWnG,KACjD+3D,EAAOlU,OAAS9qD,KAAKquI,kBAAkBjhI,EAAW4mF,YAAa,IACzC,MAAlB5mF,EAAWykC,MACbmtB,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBjhI,EAAWykC,IAAIM,SAG5B,MAA5B/kC,EAAWo7I,eACbp7I,EAAWo7I,cAAc5gJ,SAAS6gJ,IAChC,OAAQA,EAAYC,YAClB,IAAK,OACL,IAAK,WACH1oJ,KAAKmvI,WAAWnwE,EAAQypF,EAAYpY,MAAOoY,EAAY34I,O,IAM/D9P,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECpDK,MAAMgkH,WAA4B,GACvC,KAAAj6G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAM84I,EAAY5oJ,KAAK0G,mBAAmBoJ,EAAM+4I,MAAiC,KAAzBp+H,KAAKikB,MAAM5+B,EAAM+4I,MACnEjF,EACQ,MAAZgF,GAAqC,MAAjBA,EAAShF,MAAgBgF,EAAShF,KAAKnhJ,OAAS,EAChEmmJ,EAAShF,KACNn/I,KAAKqkJ,IACJ,IACE,MAAMxxH,EAAI7M,KAAKikB,MAAMo6G,GACrB,OAAO9oJ,KAAKquI,kBAAkB/2G,EAAEq+B,I,CAChC,S,CAGF,OAAO,IAAI,IAEZj2D,QAAQ43B,IAAet3B,KAAK0G,mBAAmB4wB,KAClD,KAEFt3B,KAAK82B,cAAwB,MAAR8sH,GAAgBA,EAAKnhJ,OAAS,EACrDmhJ,EAAKh8I,SAAS+tD,IACZ,IAAIy7E,GAAgB,EAChBC,EAAkB1sG,EAAO8rC,YAAYhuE,OAEzC,IAAK,IAAIC,EAAI,EAAGA,EAAIiiC,EAAO8rC,YAAYhuE,OAAQC,IAC7C,GAAIiiC,EAAO8rC,YAAY/tE,GAAGlB,OAASm0D,EAAK,CACtCy7E,GAAgB,EAChBC,EAAkB3uI,EAClB,K,CAIJ,GAAI0uI,EAAe,CACjB,MAAMzN,EAAa,IAAI3B,GACvB2B,EAAWniI,KAAOm0D,EAClBhxB,EAAO8rC,YAAY71D,KAAK+oH,E,CAG1Bh/F,EAAO0nG,wBAAwBzxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQ4uI,GAAiB,KAErErxI,KAAK82B,cAAwB,MAAR8sH,GAAgBA,EAAKnhJ,OAAS,GAC7DzC,KAAKovI,cAAczqG,EAAQi/G,EAAK,IAGlC,MAAM5kF,EAASh/D,KAAKivI,kBACpBjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,MAAO,IACnDn5E,EAAOlU,OAAS,OAAS9qD,KAAKquI,kBAAkBv+H,EAAM,gBAAiB,IAAM,KAC7EkvD,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,cAAe,MAC1DkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,YACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMjD,KAEhB,MAAxBiD,EAAMi5I,gBAA0Bj5I,EAAMi5I,eAAetmJ,OAAS,GAChEqN,EAAMi5I,eAAenhJ,SAASmpI,IACvB/wI,KAAK0G,mBAAmBqqI,KAC3B/xE,EAAOlU,OAAS,KAAOimF,E,IAK7B,MAAMiY,EAAchpJ,KAAK0G,mBAAmBoJ,EAAM,iBAE9C,KADA2a,KAAKikB,MAAM5+B,EAAM,iBAEf07C,EACU,MAAdw9F,GAAgD,MAA1BA,EAAWC,aAAuBD,EAAWC,YAAYxmJ,OAAS,EACpFumJ,EAAWC,YAAYxkJ,KAAKykJ,IAC1B,IACE,OAAOz+H,KAAKikB,MAAMw6G,E,CAClB,S,CAGF,OAAO,IAAI,IAEb,KACQ,MAAV19F,GACFA,EAAO5jD,SAASqxB,IACL,MAALA,GACFj5B,KAAKmvI,WAAWnwE,EAAQ/lC,EAAEz3B,KAAMy3B,EAAEzmB,K,IAKxCxS,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECjGK,MAAMwkH,WAAiC,GAC5C,KAAAz6G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAIykH,GAAa,EAmCjB,OAlCA5iG,EAAQ5+C,SAASkI,IACf,GAAqB,IAAjBA,EAAMrN,QAAgBqN,EAAMrN,OAAS,EACvC,OAEF,MAAM4mJ,EAA6B,KAAjBv5I,EAAMrN,QAA8B,MAAbqN,EAAM,GACzCkvD,EAASh/D,KAAKivI,kBAIpB,GAHAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMu5I,EAAY,EAAI,GAAI,MAC/DrqF,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMu5I,EAAY,EAAI,IACrErqF,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMu5I,EAAY,EAAI,IAChD,IAAjBv5I,EAAMrN,OACR2mJ,GAAa,EACbpqF,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM,IAC5CkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,QACvC,CACL,MAAMksH,EAASh8H,KAAKquI,kBAAkBv+H,EAAMu5I,EAAY,EAAI,GAAI,UAChE,IAAIha,EAAwB,WAAXrT,EAAsBA,EAAOr0H,MAAM,MAAM9C,KAAK,KAAO,KACpD,MAAdwqI,IACFA,EAAarT,EAAOr0H,MAAM,OAAO9C,KAAK,KACtCwqI,EAAarT,EAAOr0H,MAAM,KAAK9C,KAAK,MAEtC7E,KAAKovI,cAAczqG,EAAQ0qG,GAC3BrwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMu5I,EAAY,EAAI,IAC5DrqF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,G,CAE9C9P,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBoqF,GAAcppJ,KAAK82B,cACrB92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,ECzCK,MAAM2kH,WAAiC,GAC5C,KAAA56G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAU/7B,KAAKikB,MAAMl8B,GAC3B,GAAe,MAAXg0C,GAAoC,MAAjBA,EAAQD,MAE7B,OADA5hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMo0G,EAAa,IAAIn5I,IACvB4mD,EAAQqoB,QAAQjnE,SAASkI,IACvBipI,EAAWhxI,IAAI+H,EAAM1J,GAAI0J,EAAMtO,KAAK,IAEtC,MAAMw3I,EAAkB,IAAIp5I,IA0G5B,OAzGAm5I,EAAWnxI,SAAQ,CAAC8hB,EAAKvZ,KACvB6oI,EAAgBjxI,IAAIoI,EAAKw0B,EAAOkqC,QAAQpsE,QACxC,MAAMw2B,EAAI,IAAIssG,GACdtsG,EAAEz3B,KAAOkoB,EACTib,EAAOkqC,QAAQj0D,KAAKqe,EAAE,IAGxButB,EAAQD,MAAM3+C,SAASkI,IACrB,MAAMkvD,EAASh/D,KAAKivI,kBAQpB,GAPAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,KAAM,MACjDw9D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMy5I,WAExB,MAAhBz5I,EAAMksH,QAAkBgd,EAAgBloF,IAAIhhD,EAAMksH,SACpDr3F,EAAOwnG,oBAAoBvxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQu2I,EAAgB/+H,IAAInK,EAAMksH,UAG3D,MAArBlsH,EAAM05I,YAAV,CAIKxpJ,KAAK0G,mBAAmBoJ,EAAM05I,YAAY1+F,SAC7CkU,EAAOlU,MAAQh7C,EAAM05I,YAAY1+F,MAAMnjD,MAAM,UAAU9C,KAAK,MAAM8C,MAAM,OAAO9C,KAAK,OAGnE,eAAfiL,EAAMxC,OACR0xD,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1xD,KAAOs5C,GAAWyE,MAG3B,IAAK,MAAMkpF,KAAYzkI,EAAM05I,YAAa,CAExC,IAAK15I,EAAM05I,YAAY5nI,eAAe2yH,GACpC,SAEF,MAAMkV,EAAS35I,EAAM05I,YAAYjV,GAC3B7qH,EAAgB,MAAV+/H,EAAiBA,EAAOhmJ,WAAa,KACjD,IACEzD,KAAK0G,mBAAmBgjB,IACX,UAAb6qH,GACa,8BAAbA,EAKF,GAAiB,kBAAbA,EAAJ,CAOA,GAAIv1E,EAAO1xD,OAASs5C,GAAWyE,KAAM,CACnC,GAAiB,eAAbkpF,EAA2B,CAC7Bv1E,EAAO1T,KAAK7D,OAAS/9B,EACrBs1C,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChE,Q,CACK,GAAiB,eAAb8sF,EAA2B,CACpCv1E,EAAO1T,KAAK/D,eAAiB79B,EAC7B,Q,CACK,GAAiB,kBAAb6qH,EAA8B,CACvCv1E,EAAO1T,KAAKthC,KAAON,EACnB,Q,CACK,GAAiB,YAAb6qH,EAAwB,CACjC,IACE,MAAMmV,EAAU,IAAIl9I,KAAKkd,GACzBs1C,EAAO1T,KAAK3D,QAAU+hG,EAAQC,cAAclmJ,WAC5Cu7D,EAAO1T,KAAK5D,UAAYgiG,EAAQpL,WAAa,GAAG76I,U,CAChD,S,CAGF,Q,CACK,GAAiB,aAAb8wI,EACT,Q,KAEG,CACL,IACgB,aAAbA,GAAwC,UAAbA,IAC5Bv0I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,UACrC,CACAm7C,EAAO9T,MAAMrnC,SAAW6F,EACxB,Q,CACK,GAAiB,aAAb6qH,EAAyB,CAClCv1E,EAAO9T,MAAMpnC,SAAW4F,EACxB,Q,CACK,GAAiB,SAAb6qH,EAAqB,CAC9Bv1E,EAAO9T,MAAMnB,KAAOrgC,EACpB,Q,CACK,IACiB,MAArBs1C,EAAO9T,MAAMjB,MAA6C,IAA7B+U,EAAO9T,MAAMjB,KAAKxnD,SAChDzC,KAAK8sI,cAAcjmI,QAAQ0tI,IAAa,EACxC,CACAv1E,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAavkH,GACtC,Q,EAIJ1pB,KAAKmvI,WAAWnwE,EAAQu1E,EAAU7qH,E,MAnDhC+/H,EAAO7hJ,SAASgiJ,IACd5pJ,KAAKmvI,WAAWnwE,EAAQ4qF,EAAGpoJ,KAAMooJ,EAAG95I,MAAM,G,CAqDhD9P,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,E,CAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EC5HK,MAAMklH,WAAkC,GAC7C,KAAAn7G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACbyoG,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAzoG,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMmlH,EAAU1c,EAAI0B,iBAAiB,4BA8CrC,OA7CAvqI,MAAMlC,KAAKynJ,GAASliJ,SAAS+C,IAC3B,MAAM6wG,EAAWx7G,KAAK0uI,yBAAyB/jI,EAAQ,YACjDo/I,EACQ,MAAZvuC,GACCx7G,KAAK0G,mBAAmB80G,EAAS64B,cACT,YAAzB74B,EAAS64B,YAEL,KADA74B,EAAS64B,YAEfr0I,KAAKovI,cAAczqG,EAAQolH,GAE3B,MAAMC,EAAchqJ,KAAK0uI,yBAAyB/jI,EAAQ,gBACpDwL,EAASnW,KAAK0uI,yBAAyB/jI,EAAQ,WAC/CmZ,EAAW9jB,KAAK0uI,yBAAyB/jI,EAAQ,YACjD1D,EAAMjH,KAAK0uI,yBAAyB/jI,EAAQ,OAC5CmgD,EAAQ9qD,KAAK0uI,yBAAyB/jI,EAAQ,SAC9Cq0D,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KACU,MAAfwoJ,EAAsBhqJ,KAAKquI,kBAAkB2b,EAAY3V,YAAa,MAAQ,KAChFr1E,EAAOlU,MAAiB,MAATA,EAAgB9qD,KAAKquI,kBAAkBvjF,EAAMupF,aAAe,GAC3Er1E,EAAO9T,MAAMrnC,SAAqB,MAAV1N,EAAiBnW,KAAKquI,kBAAkBl4H,EAAOk+H,aAAe,KACtFr1E,EAAO9T,MAAMpnC,SACC,MAAZA,EAAmB9jB,KAAKquI,kBAAkBvqH,EAASuwH,aAAe,KACpEr1E,EAAO9T,MAAMjB,KAAc,MAAPhjD,EAAcjH,KAAKiuI,aAAahnI,EAAIotI,aAAe,KAEvE,MAAMoG,EAAuB,GAC7B,IAAK,IAAI/3I,EAAI,EAAGA,GAAK,GAAIA,IACvB+3I,EAAW7/H,KAAK,aAAelY,GAGjC1C,KAAK6uI,4BAA4BlkI,EAAQ8vI,EAAW51I,KAAK,MAAM+C,SAAS+yI,IAClE36I,KAAK0G,mBAAmBi0I,EAAKtG,cAAqC,SAArBsG,EAAKtG,aAGtDr0I,KAAKmvI,WAAWnwE,EAAQ27E,EAAKsP,QAAStP,EAAKtG,YAAY,IAGzDr0I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,ECvDK,MAAMulH,WAAgC,GAC3C,KAAAx7G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACbyoG,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAzoG,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMwlH,EAAe/c,EAAIG,cAAc,gBACvC,GAAoB,MAAhB4c,EAGF,OAFAxlH,EAAO9oB,aAAe,+BACtB8oB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMylH,EAAiBD,EAAaE,aAAa,aAC3Cz/I,EAAUwiI,EAAI0B,iBAAiB,wBA4CrC,OA3CAvqI,MAAMlC,KAAKuI,GAAShD,SAAS0sI,IAC3B,MAAMsI,EAAQ58I,KAAK0uI,yBAAyB4F,EAAO,SAC7CgW,EACK,MAAT1N,GAAkB58I,KAAK0G,mBAAmBk2I,EAAMvI,aAE5C,KADAuI,EAAMvI,YAAY1sI,MAAM,KAAK9C,KAAK,KAExC7E,KAAKovI,cAAczqG,EAAQ2lH,GAE3B,MAAMviG,EAAQ/nD,KAAK0uI,yBAAyB4F,EAAO,SAC7CzwH,EAAW7jB,KAAK0uI,yBAAyB4F,EAAO,YAChDzjI,EAAQ7Q,KAAK0uI,yBAAyB4F,EAAO,SAC7CxwH,EAAW9jB,KAAK0uI,yBAAyB4F,EAAO,YAChDrtI,EAAMjH,KAAK0uI,yBAAyB4F,EAAO,OAC3CxpF,EAAQ9qD,KAAK0uI,yBAAyB4F,EAAO,SAC7Ct1E,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAgB,MAATumD,EAAgB/nD,KAAKquI,kBAAkBtmF,EAAMssF,YAAa,MAAQ,KAChFr1E,EAAOlU,MACI,MAATA,EACI9qD,KAAKquI,kBAAkBvjF,EAAMupF,YAAa,IAAI1sI,MAAMyiJ,GAAgBvlJ,KAAK,MACzE,KACNm6D,EAAO9T,MAAMrnC,SACC,MAAZA,EAAmB7jB,KAAKquI,kBAAkBxqH,EAASwwH,aAAe,KACpEr1E,EAAO9T,MAAMpnC,SACC,MAAZA,EAAmB9jB,KAAKquI,kBAAkBvqH,EAASuwH,aAAe,KACpEr1E,EAAO9T,MAAMjB,KAAc,MAAPhjD,EAAcjH,KAAKiuI,aAAahnI,EAAIotI,aAAe,KAEnEr0I,KAAK0G,mBAAmBs4D,EAAO9T,MAAMrnC,WAAsB,MAAThT,EACpDmuD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBx9H,EAAMwjI,aACnC,MAATxjI,GAAkB7Q,KAAK0G,mBAAmBmK,EAAMwjI,eACzDr1E,EAAOlU,MAAQ9qD,KAAK0G,mBAAmBs4D,EAAOlU,OAC1C,UAAYj6C,EAAMwjI,YAClBr1E,EAAOlU,MAAPkU,YAAkCnuD,EAAMwjI,aAG9Cr0I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EC/DK,MAAM4lH,WAAkC,GAC7C,KAAA77G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAEEqN,EAAMrN,OAAS,GACjBzC,KAAKovI,cAAczqG,EAAQ70B,EAAM,IAEnC,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAC3CA,EAAMrN,OAAS,IACjBu8D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM,GAAI,IAAInI,MAAM,KAAK9C,KAAK,OAElEiL,EAAMrN,OAAS,IACjBu8D,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,KAEnDA,EAAMrN,OAAS,IACjBu8D,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,KAEnDA,EAAMrN,OAAS,IACjBu8D,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,KAE9C9P,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECjBF,IAAY6lH,IAAZ,SAAYA,GACV,uBACA,wBACD,CAHD,CAAYA,KAAAA,GAAmB,KCZxB,MAAMC,WAA+B,GAC1C,WAAAjrJ,CAAoB0I,GAClBuF,QADkB,KAAAvF,YAAAA,CAEpB,CAEA,KAAAwmC,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAA8B/7B,KAAKikB,MAAMl8B,GAC/C,GAAe,MAAXg0C,GAAqC,MAAlBA,EAAQ+7F,OAE7B,OADA59G,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,GAAI6hB,EAAQ7+B,UAGV,OAFAgd,EAAOwxD,SAAU,EACjBxxD,EAAO9oB,aAAe7b,KAAKkI,YAAYovB,EAAE,8BAClC1rB,QAAQC,QAAQ84B,GAGzB,IAAK,MAAO,CAAEsb,KAAUh3C,OAAO2B,QAAQ47C,EAAQ+7F,QAC7C,IAAK,MAAMxgI,KAAQk+B,EAAMsG,MAAO,CAC9B,GAAIxkC,EAAKvH,OAASgwI,GAAoBE,QACpC,SAEF1qJ,KAAKovI,cAAczqG,EAAQsb,EAAMz+C,MAEjC,MAAMw9D,EAASh/D,KAAKivI,kBAIpB,OAHAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBtsH,EAAKvP,KAAKokG,SAASp1G,KAAM,MAC9Dw9D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBtsH,EAAKvP,KAAKokG,SAAS6U,MAEjD1pG,EAAKvP,KAAKlF,MAChB,IAAK,QAAS,CACZ,MAAMq9I,EAAe5oI,EAAKvP,KAAK6tI,QAC/BrhF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAa0c,EAAa/zE,MACnD5X,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBsc,EAAa9mI,UAC5Dm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBsc,EAAa7mI,UAC5Dk7C,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBsc,EAAaC,SACxD,IAAK,MAAMC,KAAc9oI,EAAKvP,KAAKy2I,YACjCjpJ,KAAKmvI,WACHnwE,EACA6rF,EAAWlS,UACQ,QAAnBkS,EAAWv9I,KAAiBu9I,EAAWr4I,KAAKo4I,QAAUC,EAAWr4I,KAAK6tI,QACnD,QAAnBwK,EAAWv9I,KAAiBw5C,GAAU0vD,KAAO1vD,GAAU25E,QAG3D,K,CAEF,IAAK,OACHzhE,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC,MACF,IAAK,aAAc,CACjB,MAAMob,EAAoB/oI,EAAKvP,KAAK6tI,QACpCrhF,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkByc,EAAkBvjG,gBACtEyX,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkByc,EAAkBrjG,QAC9DuX,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuB89F,EAAkBrjG,QACtEuX,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkByc,EAAkBC,oBAEvD/qJ,KAAK0G,mBAAmBokJ,EAAkB97G,kBAC7CgwB,EAAO1T,KAAK5D,SAAWojG,EAAkB97G,eAAe/kC,UAAU,EAAG,GACrE+0D,EAAO1T,KAAK5D,SAAWsX,EAAO1T,KAAK5D,SAASxjD,QAAQ,MAAO,IAC3D86D,EAAO1T,KAAK3D,QAAUmjG,EAAkB97G,eAAe/kC,UAAU,EAAG,IAGjEjK,KAAK0G,mBAAmBokJ,EAAkBxtI,MAC7Ctd,KAAKmvI,WAAWnwE,EAAQ,MAAO8rF,EAAkBxtI,IAAKwpC,GAAU25E,QAGlE,K,EAIJzgI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,E,CAOxB,OAJIh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAEhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EC9EK,MAAMqmH,WAA0B,GAAvC,c,oBA+FW,KAAAC,qBAAuB,IAAI/9I,IAAI,CACtC,OACA,OACA,yBACA,yBACA,4BACA,4BACA,uBACA,aACA,+BACA,YACA,gCA2BO,KAAAg+I,qBAAuB,IAAIh+I,IAAI,CACtC,OACA,OACA,6BACA,6BACA,gCACA,kCAgBO,KAAAi+I,sBAAwB,IAAIj+I,IAAI,CACvC,OACA,OACA,iBACA,iBACA,iBAeO,KAAAk+I,mBAAqB,IAAIl+I,IAAI,CAAC,OAAQ,OAAQ,aAAc,eAc5D,KAAAm+I,kBAAoB,IAAIn+I,IAAI,CAAC,OAAQ,OAAQ,aAAc,aAAc,cAczE,KAAAo+I,2BAA6B,IAAIp+I,IAAI,CAC5C,OACA,OACA,8BACA,8BACA,oCAoBO,KAAAq+I,iBAAmB,IAAIr+I,IAAI,CAClC,OACA,OACA,yBACA,0BACA,wBACA,yBACA,4BAoCJ,CA9QE,KAAAwhC,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6mH,EAA+B/gI,KAAKikB,MAAMl8B,GAChD,OAAmB,MAAfg5I,GACF7mH,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB3kC,KAAKozI,aAAazuG,EAAQ6mH,EAAY38E,SACtC7uE,KAAKyrJ,kBAAkB9mH,EAAQ6mH,EAAYjlG,OAEvCvmD,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,YAAAyuG,CAAazuG,EAAsBkqC,EAA0B68E,GACpD,MAAX78E,GAAsC,IAAnBA,EAAQpsE,QAI/BosE,EAAQjnE,SAASo0H,IACf,MAAM2vB,EAAiC,MAAhB3vB,EAAOz1E,OAAiBy1E,EAAOz1E,MAAM9jD,OAAS,EAC/DmpJ,EAAwC,MAAlB5vB,EAAOntD,SAAmBmtD,EAAOntD,QAAQpsE,OAAS,GAEzEkpJ,GAAmBC,KAInB,EAAMllJ,mBAAmBglJ,KAC5B1vB,EAAOx6H,KAAOkqJ,EAAa,IAAM1vB,EAAOx6H,MAGtCoqJ,GACF5rJ,KAAKozI,aAAazuG,EAAQq3F,EAAOntD,QAASmtD,EAAOx6H,MAG9CmqJ,EAGH3rJ,KAAKyrJ,kBAAkB9mH,EAAQq3F,EAAOz1E,MAAOy1E,EAAOx6H,MAFpDxB,KAAKovI,cAAczqG,EAAQq3F,EAAOx6H,KAAMmqJ,G,GAK9C,CAEQ,iBAAAF,CAAkB9mH,EAAsB4hB,EAA0B8oF,GAC3D,MAAT9oF,GAAkC,IAAjBA,EAAM9jD,QAI3B8jD,EAAM3+C,SAAS+C,IACb,MAAMq0D,EAASh/D,KAAK6rJ,eAAelhJ,GACnC3K,KAAKovI,cAAczqG,EAAQ0qG,GAAY,GACvCrvI,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,GAE/B,CAEQ,cAAA6sF,CAAe9pI,GACrB,MAAMi9C,EAASh/D,KAAKivI,kBAEpB,OAAQltH,EAAKzU,MACX,IAAK,mBACHtN,KAAK8rJ,mBAAmB/pI,EAAMi9C,GAC9B,MACF,IAAK,uBACHh/D,KAAK+rJ,0BAA0BhqI,EAAMi9C,GACrC,MACF,IAAK,wBACHh/D,KAAKgsJ,0BAA0BjqI,EAAMi9C,GACrC,MACF,IAAK,OACHh/D,KAAKisJ,UAAUlqI,EAAMi9C,GACrB,MACF,IAAK,WACHh/D,KAAKksJ,eAAenqI,EAAMi9C,GAC1B,MAKF,IAAK,OACHh/D,KAAKmsJ,WAAWpqI,EAAMi9C,GAM1B,OAAOA,CACT,CAeQ,kBAAA8sF,CAAmBxX,EAA6Bt1E,G,MACzC,MAATs1E,GAA+B,oBAAdA,EAAMhnI,OAI3B0xD,EAAOx9D,KAAO8yI,EAAM8X,uBACpBptF,EAAOlU,MAAQwpF,EAAM+X,uBAErBrtF,EAAO9T,MAAMrnC,SAAWywH,EAAMgY,0BAC9BttF,EAAO9T,MAAMpnC,SAAWwwH,EAAMiY,0BAE9BvtF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaqG,EAAMkY,sBAE5CxsJ,KAAKmvI,WACHnwE,EACA,+BACkC,QAAlC,EAAAs1E,EAAMmY,oCAA4B,eAAEhpJ,WACpCqjD,GAAU1b,SAGZprC,KAAKmvI,WAAWnwE,EAAQ,8BAA+Bs1E,EAAMoY,6BAE7D1sJ,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKirJ,sBAChD,CAUQ,yBAAAc,CAA0BzX,EAAyBt1E,GAC5C,MAATs1E,GAA+B,wBAAdA,EAAMhnI,OAI3B0xD,EAAOx9D,KAAO8yI,EAAMqY,2BACpB3tF,EAAOlU,MAAQwpF,EAAMsY,2BAErB5tF,EAAO9T,MAAMrnC,SAAWywH,EAAMuY,8BAC9B7tF,EAAO9T,MAAMpnC,SAAWwwH,EAAMwY,8BAE9B9sJ,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKkrJ,sBAChD,CASQ,cAAAgB,CAAe5X,EAAsBt1E,GAC9B,MAATs1E,GAA+B,YAAdA,EAAMhnI,OAI3B0xD,EAAOx9D,KAAO8yI,EAAMyY,eACpB/tF,EAAOlU,MAAQwpF,EAAM0Y,eAErBhuF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAaqG,EAAM2Y,cAE5CjtJ,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKmrJ,uBAChD,CAGQ,UAAAgB,CAAW7X,EAAmBt1E,GACvB,MAATs1E,GAA+B,QAAdA,EAAMhnI,OAG3B0xD,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOx9D,KAAO8yI,EAAM4Y,WACpBluF,EAAOlU,MAAQwpF,EAAM6Y,WAErBntJ,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKorJ,oBAChD,CAGQ,SAAAa,CAAU3X,EAAkBt1E,GACrB,MAATs1E,GAA+B,QAAdA,EAAMhnI,OAI3B0xD,EAAOx9D,KAAO8yI,EAAM8Y,WACpBpuF,EAAOlU,MAAQwpF,EAAM+Y,WAErBruF,EAAO9T,MAAMnB,KAAOuqF,EAAMgZ,UAE1BttJ,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKqrJ,mBAChD,CASQ,yBAAAW,CAA0B1X,EAAkCt1E,GACrD,MAATs1E,GAA+B,yBAAdA,EAAMhnI,OAI3B0xD,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOx9D,KAAO8yI,EAAMiZ,4BACpBvuF,EAAOlU,MAAQwpF,EAAMkZ,4BAErBlZ,EAAMmZ,gCAAgC7lJ,SAAS8lJ,IAC7C1tJ,KAAKmvI,WAAWnwE,EAAQ0uF,EAAOv9I,IAAKu9I,EAAO59I,MAAM,IAGnD9P,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKsrJ,4BAChD,CAWQ,QAAAqC,CAASrZ,EAAiBt1E,GACnB,MAATs1E,GAA+B,oBAAdA,EAAMhnI,OAI3B0xD,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACxC1wE,EAAOx9D,KAAO8yI,EAAMsZ,uBACpB5uF,EAAOlU,MAAQwpF,EAAMuZ,wBAErB7tJ,KAAKmvI,WAAWnwE,EAAQ,wBAAyBs1E,EAAMwZ,uBACvD9tJ,KAAKmvI,WAAWnwE,EAAQ,yBAA0Bs1E,EAAMyZ,wBACxD/tJ,KAAKmvI,WACHnwE,EACA,2BACAs1E,EAAM0Z,yBACNlnG,GAAU25E,QAGZzgI,KAAK81I,qBAAqB92E,EAAQs1E,EAAOt0I,KAAKurJ,kBAChD,CAEQ,oBAAAzV,CACN92E,EACAs1E,EACA0B,GAEuB/sI,OAAOE,KAAKmrI,GAAO50I,QAAQiF,IAAOqxI,EAAallF,IAAInsD,KAC3DiD,SAASuI,IACtB,MAAM4R,EAAOuyH,EACbt0I,KAAKmvI,WAAWnwE,EAAQ7uD,EAAK4R,EAAK5R,GAAK1M,WAAW,GAEtD,EC5RK,MAAMwqJ,WAA6B,GACxC,KAAAv/G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAoB,SAAhBA,EAAMo+I,MACR,OAEF,MAAMlvF,EAASh/D,KAAKivI,kBAGpB,GAFAjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,MAC3Cw9D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMg7C,OACzB,cAAfh7C,EAAMxC,KACR0xD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMq5G,SAC5CnqD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,eAChD,GAAmB,mBAAf/T,EAAMxC,KAA2B,CAC1C0xD,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAMq+I,YAC1DnvF,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAM23C,QAClDuX,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,QAChEuX,EAAO1T,KAAKthC,KAAOhqB,KAAKquI,kBAAkBv+H,EAAMiiC,cAEhD,IACE,MAAM2V,EAAW1nD,KAAKquI,kBAAkBv+H,EAAMs+I,aAC9C,GAAgB,MAAZ1mG,EAAkB,CACpB,MAAM2mG,EAAiBtrJ,SAAS2kD,EAAU,MACpB,MAAlB2mG,GAA0BA,GAAkB,GAAKA,GAAkB,KACrErvF,EAAO1T,KAAK5D,SAAW2mG,EAAe5qJ,W,EAG1C,S,CAGF,IACE,MAAMkkD,EAAU3nD,KAAKquI,kBAAkBv+H,EAAMw+I,YAC7C,GAAe,MAAX3mG,EAAiB,CACnB,MAAM4mG,EAAgBxrJ,SAAS4kD,EAAS,MACnB,MAAjB4mG,IACFvvF,EAAO1T,KAAK3D,QAAU4mG,EAAc9qJ,W,EAGxC,S,CAIF,MAAM6Z,EAAMtd,KAAKquI,kBAAkBv+H,EAAMwN,KAC9B,MAAPA,GACFtd,KAAKmvI,WAAWnwE,EAAQ,MAAO1hD,GAEjC,MAAM+wF,EAAMruG,KAAKquI,kBAAkBv+H,EAAMkwI,SAC9B,MAAP3xC,GACFruG,KAAKmvI,WAAWnwE,EAAQ,WAAYqvC,E,CAGxCruG,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECrEK,MAAM6pH,WAA4B,GACvC,KAAA9/G,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,IAAIjiC,EAAI,EAoDR,OAnDA8jD,EAAQ5+C,SAASkI,IACf,MAAMksH,GACHh8H,KAAK0G,mBAAmBoJ,EAAM01H,SAAW11H,EAAM01H,OAAO5+H,WAAW,KAC9DkJ,EAAM01H,OAAOthI,QAAQ,IAAK,IAC1B4L,EAAM01H,OACN6J,EAAcrvI,KAAK0G,mBAAmBs1H,GAAmB,KAATA,EACtDh8H,KAAKovI,cAAczqG,EAAQ0qG,GAE3B,MAAMrwE,EAASh/D,KAAKivI,kBAOpB,GANAjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMglI,MAC5C91E,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM2+I,KAAM,MACjDzvF,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm7C,OACrD+T,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM4+I,KACrD1vF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM+uI,MAEvC7+I,KAAK0G,mBAAmBoJ,EAAM6+I,WAAY,CAC7C,IAAInjG,EAAmB,CAAC17C,EAAM6+I,WACF,MAAxB7+I,EAAMi5I,gBAA0Bj5I,EAAMi5I,eAAetmJ,OAAS,IAChE+oD,EAASA,EAAO8qD,OAAOxmG,EAAMi5I,iBAE/Bv9F,EAAO5jD,SAASosD,IACd,MAAMlsD,EAAQksD,EAAMrsD,MAAM,KAC1B,GAAIG,EAAMrF,OAAS,EACjB,OAEF,MAAM0N,EAAmB,cAAbrI,EAAM,GAAqB,KAAOA,EAAM,GAC9C4hB,EAAuB,IAAjB5hB,EAAMrF,QAA6B,QAAbqF,EAAM,GAAeA,EAAM,GAAKA,EAAM,GACxE9H,KAAKmvI,WAAWnwE,EAAQ7uD,EAAKuZ,EAAI,G,CAIrC1pB,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GAGjBt8D,IAAM8jD,EAAQ/jD,QACE,OAAhBu8D,EAAOx9D,MACPxB,KAAK0G,mBAAmBs4D,EAAO9T,MAAMpnC,YAKvC6gB,EAAOg2C,QAAQ//D,KAAKokD,GACpBt8D,IAAG,IAGD1C,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,EC9DK,MAAMiqH,WAA0B,GACrC,KAAAlgH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,I,MACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMs+C,MAAO,MAClD4Q,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm/C,UACrD+P,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAsB,QAAT,EAAAn+H,EAAM+uI,WAAG,QAAI/uI,EAAMjD,KACzDmyD,EAAO9T,MAAMnB,KAAO/pD,KAAKquI,kBAAkBv+H,EAAM++I,SACjD7vF,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,OAC5Cn4I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECjBK,MAAMmqH,WAA+B,GAC1C,KAAApgH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACbyoG,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAzoG,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAIzB,GAAU,MADCyoG,EAAIG,cAAc,YAI3B,OAFA5oG,EAAO9oB,aAAe,2BACtB8oB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMo0G,EAAa,IAAIn5I,IA6EvB,OA3EA2E,MAAMlC,KAAK+qI,EAAI0B,iBAAiB,qBAAqBlnI,SAASmnJ,IAC5D,MAAMvtJ,EAAOutJ,EAAQ1E,aAAa,QAC5BjkJ,EAAK2oJ,EAAQ1E,aAAa,MAChC,IAAKrqJ,KAAK0G,mBAAmBlF,KAAUxB,KAAK0G,mBAAmBN,GAAK,CAClE2yI,EAAWhxI,IAAI3B,EAAIu+B,EAAOkqC,QAAQpsE,QAClC,MAAMu5H,EAAS,IAAIuJ,GACnBvJ,EAAOx6H,KAAOA,EACdmjC,EAAOkqC,QAAQj0D,KAAKohH,E,KAIxBz3H,MAAMlC,KAAK+qI,EAAI0B,iBAAiB,oBAAoBlnI,SAASonJ,IAC3D,GAAwC,SAApCA,EAAO3E,aAAa,aAA6D,SAAnC2E,EAAO3E,aAAa,WACpE,OAGF,MAAM4E,EAAYjvJ,KAAK0uI,yBAAyBsgB,EAAQ,YACxD,GAAiB,MAAbC,EAAmB,CACrB,MAAMC,EAAUD,EAAU5a,aACrBr0I,KAAK0G,mBAAmBwoJ,IAAYnW,EAAWjoF,IAAIo+F,IACtDvqH,EAAOwnG,oBAAoBvxH,KAAK,CAAC+pB,EAAOg2C,QAAQl4E,OAAQs2I,EAAW9+H,IAAIi1I,I,CAI3E,MAAMlwF,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkB2gB,EAAO3E,aAAa,SAAU,MAE/B,SAAhC2E,EAAO3E,aAAa,UACtBrrF,EAAOnU,UAAW,GAIH,SADAmkG,EAAO3E,aAAa,SAEnCrrF,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,SAExCnrI,MAAMlC,KAAKrC,KAAK6uI,4BAA4BmgB,EAAQ,UAAUpnJ,SAASunJ,IACrE,MAAMzxD,EAAOyxD,EAAQ9a,YACrB,GAAIr0I,KAAK0G,mBAAmBg3F,GAC1B,OAEF,MAAMl8F,EAAO2tJ,EAAQ9E,aAAa,QAC5BlI,EAAYniJ,KAAKquI,kBAAkB8gB,EAAQ9E,aAAa,QAAS,IAAIriJ,cACzD,UAAdm6I,EACFnjF,EAAO9T,MAAMrnC,SAAW65E,EACD,aAAdykD,GAA0C,WAAdA,EAErCniJ,KAAKmvI,WAAWnwE,EAAQx9D,EAAMk8F,EAAM52C,GAAU25E,QACvB,sBAAd0hB,EACTnjF,EAAO9T,MAAMnB,KAAO2zC,EACG,UAAdykD,EACTnjF,EAAOlU,OAAS4yC,EAAO,KACA,aAAdykD,GAA0C,YAAdA,EACrCnjF,EAAO9T,MAAMjB,KAAKrvC,QAAQ5a,KAAKiuI,aAAavwC,IAE5C19F,KAAKmvI,WAAWnwE,EAAQx9D,EAAMk8F,E,IAKpCn5F,MAAMlC,KAAKrC,KAAK6uI,4BAA4BmgB,EAAQ,UAAUpnJ,SAASwnJ,IACrEpwF,EAAOlU,OAASskG,EAAQ/a,YAAc,IAAI,IAG5Cr0I,KAAKmhG,YAAYniC,GACjBh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAIA,WAAAw8D,CAAYniC,GACV,MAAMqwF,EAAarwF,EAAOxT,OAAO9rD,QAAQs0D,GAAUA,EAAM1mD,OAASw5C,GAAU25E,SAC5E,IAAK4uB,EAAW5sJ,OACd,OAGF,IAAI6sJ,EACJ,IAAK,MAAMt7F,KAASq7F,EAClB,GAAIrvJ,KAAK2sI,mBAAmBz8F,SAAS8jB,EAAMxyD,KAAKwG,eAAgB,CAC9DsnJ,EAASt7F,EACTgL,EAAOxT,OAASwT,EAAOxT,OAAO9rD,QAAQu5B,GAAMA,IAAMq2H,IAClD,K,CAICA,IACHA,EAASD,EAAW,IAGtBrwF,EAAO9T,MAAMpnC,SAAWwrI,EAAOx/I,KACjC,EC5HK,MAAMy/I,WAA6B,GACxC,KAAA7gH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBruI,KAAKouI,YAAYt+H,EAAM7I,KAAM,MAClE+3D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMg7C,OAC5CkU,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM+T,UACrDm7C,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAC5CjH,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECtBK,MAAM6qH,WAA8B,GACzC,KAAA9gH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,GAAe,MAAXg0C,EAEF,OADA7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAIzB,MAAM8qH,EAAWxmJ,OAAOE,KAAKq9C,EAAQ,IAAItwB,MAAM9sB,GAAM,OAAO7C,KAAK6C,KAajE,OAZAo9C,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMs+C,OAC3C4Q,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM4/I,SAC5C1wF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM2/I,IAC5CzwF,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMm/C,UACrDjvD,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,ECtBK,MAAMgrH,WAA4B,GACvC,KAAAjhH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAIA,EAAMrN,OAAS,EACjB,OAGFzC,KAAKovI,cAAczqG,EAAQ3kC,KAAKquI,kBAAkBv+H,EAAMA,EAAMrN,OAAS,KACvE,MAAMu8D,EAASh/D,KAAKivI,kBACpBjwE,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMA,EAAMrN,OAAS,GAAI,IAC/Du8D,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAE9B,eAAbA,EAAM,IAAoC,YAAbA,EAAM,IAAiC,mBAAbA,EAAM,IAC/DkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,IAC5C9P,KAAK4vJ,mBAAmB5wF,EAAQ,EAAGlvD,IAEnC9P,KAAK4vJ,mBAAmB5wF,EAAQ,EAAGlvD,GAGrC9P,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,kBAAAirH,CAAmB5wF,EAAoB6wF,EAAoB//I,GAEjE,IAAK,IAAIpN,EAAImtJ,EAAYntJ,EAAIoN,EAAMrN,OAAS,EAAGC,IACzC1C,KAAK0G,mBAAmBoJ,EAAMpN,MAGlCs8D,EAAOlU,OAASh7C,EAAMpN,GAAK,KAE/B,ECnDK,MAAMotJ,WAAkC,GAC7C,KAAAphH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACbyoG,EAAMptI,KAAKktI,SAAS16H,GAC1B,GAAW,MAAP46H,EAEF,OADAzoG,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GAGzB,MAAMorH,EAAa3iB,EAAI0B,iBAAiB,oCAsDxC,OArDAvqI,MAAMlC,KAAK0tJ,GAAYnoJ,SAASooJ,IAC9B,MAAM7lC,EAAY6lC,EAAU3F,aAAa,MACzC,GAAIrqJ,KAAK0G,mBAAmByjH,GAC1B,OAGF,MAAM8lC,EAAeD,EAAU3F,aAAa,QACtC6F,EAAeF,EAAU3F,aAAa,YAC5C,IAAI8F,EAAoB,KACpBC,EAAmB,KACnBC,EAAoB,KACpB/zD,EAAkB,KAClBguD,EAAoB,KAExB,MAAMgG,EAAeljB,EAAIG,cACvB,4EAEEpjB,EACA,MAEJ,GAAoB,MAAhBmmC,EAAsB,CACxB,MAAMzxH,EAAUyxH,EAAaC,cAAcA,cAC5B,MAAX1xH,IACFsxH,EAAYtxH,EAAQwrH,aAAa,QACjC+F,EAAWvxH,EAAQwrH,aAAa,QAChC/tD,EAAUz9D,EAAQwrH,aAAa,YAC/BgG,EAAYxxH,EAAQwrH,aAAa,YAC5BrqJ,KAAK0G,mBAAmB2pJ,KAC3BA,EAAYA,EAAU1oJ,MAAM,MAAM9C,KAAK,O,CAKxC7E,KAAK0G,mBAAmB41F,KAC3BguD,EAAYtqJ,KAAKwwJ,eAAepjB,EAAK9wC,EAAS,IAC9Ct8F,KAAKovI,cAAczqG,EAAQ2lH,IAG7B,MAAMtrF,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkB8hB,EAAW,MAChDnxF,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBgiB,GACtCrxF,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkB4hB,GAC/CjxF,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkB6hB,GAC/ClxF,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAamiB,GACtCpwJ,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,EACzB,CAEA,cAAA6rH,CAAepjB,EAAe9wC,EAAiBguD,GAC7C,MAAM1N,EAAQxP,EAAIG,cAAc,wCAA0CjxC,EAAU,MACpF,OAAa,MAATsgD,EACK0N,GAEJtqJ,KAAK0G,mBAAmB4jJ,KAC3BA,EAAY,IAAMA,GAEpBA,EAAY1N,EAAMyN,aAAa,QAAUC,EAClCtqJ,KAAKwwJ,eAAepjB,EAAKwP,EAAMyN,aAAa,YAAaC,GAClE,ECxEF,MAAMmG,GAAqB,CACzB,OACA,YACA,WACA,WACA,wBACA,gBACA,OACA,oBACA,OACA,QACA,oBAGK,MAAMC,WAA2B,GACtC,KAAAhiH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBAapB,GAZAjwE,EAAOnU,SAAwE,SAA7D7qD,KAAKquI,kBAAkBv+H,EAAM+6C,SAAU,IAAI7iD,cAC7Dg3D,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMtO,KAAM,MACjDw9D,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM6gJ,KAAM,IAClD3xF,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAMo7C,OACrD8T,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMgU,UACrDk7C,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM7I,KAEzB,UAAf6I,EAAM8gJ,OACR5xF,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAMi4C,MAAO,MAClDiX,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM27G,KAAM,KAGjC,OAAf37G,EAAM8gJ,MAMR,GALA5xF,EAAO1xD,KAAOs5C,GAAWyE,KACzB2T,EAAO1T,KAAO,IAAIc,GAClB4S,EAAO1T,KAAK/D,eAAiBvnD,KAAKquI,kBAAkBv+H,EAAMq+I,YAC1DnvF,EAAO1T,KAAK7D,OAASznD,KAAKquI,kBAAkBv+H,EAAM23C,QAClDuX,EAAO1T,KAAK9D,MAAQ4E,GAASY,uBAAuBgS,EAAO1T,KAAK7D,SAC3DznD,KAAK0G,mBAAmBoJ,EAAM+gJ,YACjC,IACE,MAAMnH,EAAU,IAAIl9I,KAAKsD,EAAM+gJ,YAC/B7xF,EAAO1T,KAAK3D,QAAU+hG,EAAQC,cAAclmJ,WAC5Cu7D,EAAO1T,KAAK5D,UAAYgiG,EAAQpL,WAAa,GAAG76I,U,CAChD,S,OAIC,GAAmB,UAAfqM,EAAM8gJ,KAAkB,CACjC5xF,EAAO1xD,KAAOs5C,GAAWuE,WACzB6T,EAAO5T,WAAa,IAAIqG,GACxBuN,EAAO5T,WAAW99C,KAAO45C,GAAewoF,QACnC1vI,KAAK0G,mBAAmBs4D,EAAOlU,SAClCkU,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMghJ,iBAAkB,KAEhE,IAAK,MAAMvc,KAAYzkI,EAEnBA,EAAM8R,eAAe2yH,IACrBkc,GAAmB5pJ,QAAQ0tI,EAASvsI,eAAiB,IACpDhI,KAAK0G,mBAAmBoJ,EAAMykI,KAE/Bv0I,KAAKmvI,WAAWnwE,EAAQu1E,EAAUzkI,EAAMykI,G,CAK9Cv0I,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,EChFK,MAAMosH,WAAuB,GAClC,KAAAriH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GAAqB,IAAjBA,EAAMrN,OACR,OAEF,MAAMu8D,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM,GAAI,MAC/CkvD,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAM,IAC5CkvD,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAM,IACrDkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAM,IAC5C9P,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECzBK,MAAMqsH,WAAwB,GACnC,KAAAtiH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,MAAMkvD,EAASh/D,KAAKivI,kBACpBjwE,EAAOx9D,KAAOxB,KAAKquI,kBAAkBv+H,EAAM2+I,KAAM,MACjDzvF,EAAO9T,MAAMrnC,SAAW7jB,KAAKquI,kBAAkBv+H,EAAM,cACrDkvD,EAAO9T,MAAMpnC,SAAW9jB,KAAKquI,kBAAkBv+H,EAAMyhD,UACrDyN,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aAAan+H,EAAMjD,KAC5C7M,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAG7Br6B,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,ECnBK,MAAMssH,WAA6B,GACxC,KAAAviH,CAAMl8B,GACJ,MAAMmyB,EAAS,IAAI,GACb6hB,EAAUxmD,KAAKwtI,SAASh7H,GAAM,GACpC,OAAe,MAAXg0C,GACF7hB,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,KAGzB6hB,EAAQ5+C,SAASkI,IACf,GACE9P,KAAK0G,mBAAmBoJ,EAAM,mBAC9B9P,KAAK0G,mBAAmBoJ,EAAM,gBAE9B,OAEF9P,KAAKovI,cAAczqG,EAAQ3kC,KAAKquI,kBAAkBv+H,EAAMohJ,cACxD,MAAMlyF,EAASh/D,KAAKivI,kBACpBjwE,EAAOnU,SAA2D,MAAhD7qD,KAAKquI,kBAAkBv+H,EAAM8kI,SAAU,KACzD51E,EAAOlU,MAAQ9qD,KAAKquI,kBAAkBv+H,EAAMqoI,OAC5Cn5E,EAAOx9D,KAAOxB,KAAKquI,kBACjBv+H,EAAM,iBACN9P,KAAKquI,kBAAkBv+H,EAAM,eAAgB,OAE/CkvD,EAAO9T,MAAMjB,KAAOjqD,KAAKiuI,aACvBjuI,KAAKquI,kBAAkBv+H,EAAM,gBAAiB9P,KAAKquI,kBAAkBv+H,EAAM,iBAE7E9P,KAAKmxJ,UAAUnyF,EAAQlvD,EAAMshJ,YAC7BpxJ,KAAKmxJ,UAAUnyF,EAAQlvD,EAAMuhJ,YAC7BrxJ,KAAKyvI,sBAAsBzwE,GAC3Bh/D,KAAKkvI,cAAclwE,GACnBr6B,EAAOg2C,QAAQ//D,KAAKokD,EAAO,IAGzBh/D,KAAK82B,cACP92B,KAAKyuI,yBAAyB9pG,GAGhCA,EAAOwxD,SAAU,EACVvqF,QAAQC,QAAQ84B,GACzB,CAEQ,SAAAwsH,CAAUnyF,EAAoBxsD,GACpC,GAAIxS,KAAK0G,mBAAmB8L,GAC1B,OAEgBxS,KAAK2tI,aAAan7H,GAC1B5K,SAASm5I,IACjB,MAAMzP,EAAgByP,EAAKl6I,QAAQ,KACnC,GAAIyqI,EAAgB,EAClB,OAEF,MAAMt9E,EAAQ+sF,EAAK92I,UAAU,EAAGqnI,GAC1BxhI,EAAQixI,EAAKt+I,OAAS6uI,EAAgByP,EAAK92I,UAAUqnI,EAAgB,GAAK,KAChF,GACEtxI,KAAK0G,mBAAmBstD,IACxBh0D,KAAK0G,mBAAmBoJ,IACd,eAAVkkD,EAEA,OAEF,MAAM87E,EAAa97E,EAAMhsD,cACI,MAAzBg3D,EAAO9T,MAAMrnC,UAAoB7jB,KAAK4sI,mBAAmB/lI,QAAQipI,IAAe,EAClF9wE,EAAO9T,MAAMrnC,SAAW/T,EAEC,MAAzBkvD,EAAO9T,MAAMpnC,UACb9jB,KAAK2sI,mBAAmB9lI,QAAQipI,IAAe,EAE/C9wE,EAAO9T,MAAMpnC,SAAWhU,EAExB9P,KAAKmvI,WAAWnwE,EAAQhL,EAAOlkD,E,GAGrC,EC3EK,MAAMwhJ,GAAwB,CACnC,CAAElrJ,GAAI,gBAAiB5E,KAAM,oBAC7B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,YAAa5E,KAAM,gBACzB,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,cAAe5E,KAAM,mBAC3B,CAAE4E,GAAI,cAAe5E,KAAM,YAC3B,CAAE4E,GAAI,YAAa5E,KAAM,0BACzB,CAAE4E,GAAI,gBAAiB5E,KAAM,0BAGlB+vJ,GAAuB,CAClC,CAAEnrJ,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,gBAAiB5E,KAAM,oBAC7B,CAAE4E,GAAI,kBAAmB5E,KAAM,mCAC/B,CAAE4E,GAAI,kBAAmB5E,KAAM,+BAC/B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,YAAa5E,KAAM,gBAGzB,CAAE4E,GAAI,YAAa5E,KAAM,gBACzB,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,aAAc5E,KAAM,yBAC1B,CAAE4E,GAAI,iBAAkB5E,KAAM,qBAC9B,CAAE4E,GAAI,YAAa5E,KAAM,oCACzB,CAAE4E,GAAI,oBAAqB5E,KAAM,yBACjC,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,aAAc5E,KAAM,kBAC1B,CAAE4E,GAAI,mBAAoB5E,KAAM,wBAChC,CAAE4E,GAAI,eAAgB5E,KAAM,oBAC5B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,oBAAqB5E,KAAM,yBACjC,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,WAAY5E,KAAM,eACxB,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,SAAU5E,KAAM,oCACtB,CAAE4E,GAAI,aAAc5E,KAAM,2BAC1B,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,WAAY5E,KAAM,eACxB,CAAE4E,GAAI,aAAc5E,KAAM,iBAC1B,CAAE4E,GAAI,YAAa5E,KAAM,4CACzB,CAAE4E,GAAI,UAAW5E,KAAM,cACvB,CAAE4E,GAAI,mBAAoB5E,KAAM,wBAChC,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,WAAY5E,KAAM,yBACxB,CAAE4E,GAAI,YAAa5E,KAAM,0BACzB,CAAE4E,GAAI,aAAc5E,KAAM,sBAC1B,CAAE4E,GAAI,eAAgB5E,KAAM,oCAC5B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,oBAAqB5E,KAAM,wBACjC,CAAE4E,GAAI,UAAW5E,KAAM,cACvB,CAAE4E,GAAI,gBAAiB5E,KAAM,oBAC7B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,gBAAiB5E,KAAM,oCAC7B,CAAE4E,GAAI,eAAgB5E,KAAM,mBAC5B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,UAAW5E,KAAM,cACvB,CAAE4E,GAAI,cAAe5E,KAAM,kBAC3B,CAAE4E,GAAI,YAAa5E,KAAM,gBACzB,CAAE4E,GAAI,aAAc5E,KAAM,kB,2SCoBrB,MAAMgwJ,GAKX,WAAAhyJ,CACUg+D,EACA2nE,EACAssB,EACAvpJ,EACA07H,EACA9vH,EACAg9B,GANA,KAAA0sB,cAAAA,EACA,KAAA2nE,cAAAA,EACA,KAAAssB,iBAAAA,EACA,KAAAvpJ,YAAAA,EACA,KAAA07H,kBAAAA,EACA,KAAA9vH,cAAAA,EACA,KAAAg9B,WAAAA,EAXV,KAAAwgH,sBAAwBA,GAExB,KAAAC,qBAAuBA,EAUpB,CAEH,gBAAAG,GACE,OAAO1xJ,KAAKsxJ,sBAAsBh7C,OAAOt2G,KAAKuxJ,qBAChD,CAEM,MAAAI,CACJC,EACAC,EACA57H,EAAyB,KACzB67H,EAAoD,KACpDj/H,G,0CAEA,IAAIk/H,EACJ,IACEA,QAAqBH,EAASljH,MAAMmjH,E,CACpC,MAAOtxJ,GACP,GAAIA,aAAiByxJ,YACnB,MAAM,IAAIxxJ,MAAMR,KAAKkI,YAAYovB,EAAE,sBAErC,MAAM/2B,C,CAGR,IAAKwxJ,EAAa57D,QAAS,CACzB,IAAK,EAAMzvF,mBAAmBqrJ,EAAal2I,cACzC,MAAM,IAAIrb,MAAMuxJ,EAAal2I,cAE/B,MAAM,IAAIrb,MAAMR,KAAKkI,YAAYovB,EAAE,qB,CAGrC,GAAoC,IAAhCy6H,EAAaljF,QAAQpsE,QAAgD,IAAhCsvJ,EAAap3E,QAAQl4E,OAC5D,MAAM,IAAIjC,MAAMR,KAAKkI,YAAYovB,EAAE,uBAGrC,GAAIy6H,EAAap3E,QAAQl4E,OAAS,EAAG,CACnC,MAAMwvJ,EAAUhsJ,KAAK0G,MAAMolJ,EAAap3E,QAAQl4E,OAAS,GACnDyvJ,EAAOH,EAAap3E,QAAQl4E,OAAS,EAE3C,GACEzC,KAAKmyJ,QAAQJ,EAAap3E,QAAQ,KAClC36E,KAAKmyJ,QAAQJ,EAAap3E,QAAQs3E,KAClCjyJ,KAAKmyJ,QAAQJ,EAAap3E,QAAQu3E,IAElC,MAAM,IAAI1xJ,MAAMR,KAAKkI,YAAYovB,EAAE,qB,CAIvC,GAAIrB,IAAmB67H,IAAyBj/H,EAAuB,CAGrE,GADEk/H,EAAa1lB,wBAAwB5pI,OAASsvJ,EAAap3E,QAAQl4E,OAEnE,MAAM,IAAIjC,MAAMR,KAAKkI,YAAYovB,EAAE,8B,CAIvC,UACQt3B,KAAKoyJ,gBAAgBL,EAAc97H,EAAgB67H,GACnC,MAAlB77H,QACIj2B,KAAKqyJ,2BAA2BN,EAAc97H,SAE9Cj2B,KAAKsyJ,uBAAuBP,E,CAEpC,MAAOxxJ,GACP,MAAMgyJ,EAAgB,IAAI,GAAchyJ,EAAO,KAC/C,MAAMP,KAAKwyJ,kBAAkBD,EAAeR,E,CAE9C,OAAOA,CACT,G,CAEA,WAAAU,CACEC,EACAlf,EACAv9G,EAAyB,MAEzB,GAAkC,MAA9Bu9G,EACF,OAAO,KAGT,MAAMoe,EAAW5xJ,KAAK2yJ,oBAAoBD,EAAQlf,GAClD,OAAgB,MAAZoe,EACK,MAETA,EAAS37H,eAAiBA,EACnB27H,EACT,CAEQ,mBAAAe,CACND,EACAlf,GAEA,GAAc,MAAVkf,EACF,OAAO,KAGT,OAAQA,GACN,IAAK,eACH,OAAO,IAAIxhB,GACb,IAAK,gBACL,IAAK,6BACH,OAAO,IAAIqC,GACTvzI,KAAK8T,cACL9T,KAAKkI,YACLlI,KAAKw9D,cACLx9D,KAAK8wC,WACL0iG,GAEJ,IAAK,cACL,IAAK,cACH,OAAO,IAAIwJ,GACb,IAAK,cACH,OAAO,IAAIH,GACb,IAAK,WACH,OAAO,IAAInM,GACb,IAAK,UACH,OAAO,IAAIqD,GACb,IAAK,iBACH,OAAO,IAAI+a,GACb,IAAK,aACH,OAAO,IAAI5G,GACb,IAAK,cACH,OAAO,IAAIrM,GACb,IAAK,YACL,IAAK,WACL,IAAK,aACH,OAAO,IAAI7K,GACb,IAAK,aACH,OAAO,IAAI4I,GACb,IAAK,SACH,OAAO,IAAImX,GACb,IAAK,eACH,OAAO,IAAIxB,GACb,IAAK,YACH,OAAO,IAAIX,GACb,IAAK,aACH,OAAO,IAAIlQ,GACb,IAAK,gBACH,OAAO,IAAIoC,GACb,IAAK,gBACH,OAAO,IAAIwB,GACb,IAAK,kBACH,OAAO,IAAIyF,GACb,IAAK,kBACH,OAAO,IAAID,GACb,IAAK,YACH,OAAO,IAAI/K,GAGb,IAAK,oBACH,OAAO,IAAI8M,GACb,IAAK,YACH,OAAO,IAAItR,GACb,IAAK,aACH,OAAO,IAAIO,GACb,IAAK,YACH,OAAO,IAAIoR,GACb,IAAK,cACH,OAAO,IAAI7U,GACb,IAAK,eACH,OAAO,IAAIwB,GACb,IAAK,aACH,OAAO,IAAIiI,GACb,IAAK,oBACH,OAAO,IAAIgR,GACb,IAAK,aACH,OAAO,IAAIY,GACb,IAAK,eACH,OAAO,IAAIvc,GACb,IAAK,cACH,OAAO,IAAIqa,GACb,IAAK,aACH,OAAO,IAAI3e,GACb,IAAK,mBACH,OAAO,IAAIyZ,GACb,IAAK,eACH,OAAO,IAAI2H,GACb,IAAK,cACH,OAAO,IAAItB,GACb,IAAK,cACH,OAAO,IAAIxH,GACb,IAAK,YACH,OAAO,IAAI7N,GACb,IAAK,mBACH,OAAO,IAAI6O,GACb,IAAK,cACH,OAAO,IAAIR,GACb,IAAK,cACH,OAAO,IAAIJ,GACb,IAAK,WACH,OAAO,IAAIxY,GACb,IAAK,YACH,OAAO,IAAIC,GACb,IAAK,aACH,OAAO,IAAI8J,GACb,IAAK,eACH,OAAO,IAAIkB,GACb,IAAK,eACH,OAAO,IAAIiT,GACb,IAAK,oBACH,OAAO,IAAI1D,GACb,IAAK,UACH,OAAO,IAAIjL,GACb,IAAK,gBACH,OAAO,IAAIkQ,GACb,IAAK,eACH,OAAO,IAAI/Q,GACb,IAAK,gBACH,OAAO,IAAI7N,GACb,IAAK,eACH,OAAO,IAAIqD,GACb,IAAK,cACH,OAAO,IAAIS,GACb,IAAK,cACH,OAAO,IAAIuD,GACb,IAAK,UACH,OAAO,IAAI+Y,GACb,IAAK,cACH,OAAO,IAAI1Q,GACb,IAAK,YACH,OAAO,IAAI0K,GACb,IAAK,aACH,OAAO,IAAI3C,GACb,IAAK,aACH,OAAO,IAAIoC,GAAuBzqJ,KAAKkI,aACzC,QACE,OAAO,KAEb,CAEc,sBAAAoqJ,CAAuBP,G,0CACnC,MAAMn5H,EAAU,IAAIszG,GACpB,IAAK,IAAIxpI,EAAI,EAAGA,EAAIqvJ,EAAap3E,QAAQl4E,OAAQC,IAAK,CACpD,MAAMqD,QAAU/F,KAAKw9D,cAAc1/C,QAAQi0I,EAAap3E,QAAQj4E,IAChEk2B,EAAQ+hD,QAAQ//D,KAAK,IAAIs8G,GAAcnxH,G,CAEzC,GAA4B,MAAxBgsJ,EAAaljF,QACf,IAAK,IAAInsE,EAAI,EAAGA,EAAIqvJ,EAAaljF,QAAQpsE,OAAQC,IAAK,CACpD,MAAMu2B,QAAUj5B,KAAKmlI,cAAcrnH,QAAQi0I,EAAaljF,QAAQnsE,IAChEk2B,EAAQi2C,QAAQj0D,KAAK,IAAI6xH,GAAoBxzG,G,CAQjD,OALwC,MAApC84H,EAAa5lB,qBACf4lB,EAAa5lB,oBAAoBvkI,SAAS5B,GACxC4yB,EAAQuzG,oBAAoBvxH,KAAK,IAAI0xH,GAAWtmI,EAAE,GAAIA,EAAE,aAG/ChG,KAAKyxJ,iBAAiBzlB,kBAAkBpzG,EACvD,G,CAEc,0BAAAy5H,CAA2BN,EAA4B97H,G,0CACnE,MAAM2C,EAAU,IAAIwzG,GACpB,IAAK,IAAI1pI,EAAI,EAAGA,EAAIqvJ,EAAap3E,QAAQl4E,OAAQC,IAAK,CACpDqvJ,EAAap3E,QAAQj4E,GAAGuzB,eAAiBA,EACzC,MAAMlwB,QAAU/F,KAAKw9D,cAAc1/C,QAAQi0I,EAAap3E,QAAQj4E,IAChEk2B,EAAQ+hD,QAAQ//D,KAAK,IAAIs8G,GAAcnxH,G,CAEzC,GAAgC,MAA5BgsJ,EAAathF,YACf,IAAK,IAAI/tE,EAAI,EAAGA,EAAIqvJ,EAAathF,YAAYhuE,OAAQC,IAAK,CACxDqvJ,EAAathF,YAAY/tE,GAAGuzB,eAAiBA,EAC7C,MAAMlwB,QAAU/F,KAAK4jI,kBAAkB9lH,QAAQi0I,EAAathF,YAAY/tE,IACxEk2B,EAAQ63C,YAAY71D,KAAK,IAAI4xH,GAAwBzmI,G,CAQzD,OAL4C,MAAxCgsJ,EAAa1lB,yBACf0lB,EAAa1lB,wBAAwBzkI,SAAS5B,GAC5C4yB,EAAQyzG,wBAAwBzxH,KAAK,IAAI0xH,GAAWtmI,EAAE,GAAIA,EAAE,aAGnDhG,KAAKyxJ,iBAAiBxlB,8BAA8Bh2G,EAAgB2C,EACnF,G,CAEQ,OAAAu5H,CAAQpsJ,GACd,OACa,MAAVA,EAAEvE,MAA2B,OAAXuE,EAAEvE,OACrBuE,EAAEuH,OAASs5C,GAAWqE,OACX,MAAXllD,EAAEmlD,OACF,EAAMxkD,mBAAmBX,EAAEmlD,MAAMpnC,SAErC,CAEQ,iBAAA0uI,CAAkBD,EAA8BR,GACtD,GAAsC,MAAlCQ,EAAcjxI,iBAChB,OAAO,IAAI9gB,MAAM+xJ,EAAczyJ,SAGjC,IAAI+b,EAAe,GAmCnB,OAjCA5S,OAAO2B,QAAQ2nJ,EAAcjxI,kBAAkB1Z,SAAQ,EAAEuI,EAAKL,GAAQskG,KACpE,IAAIryF,EACA6wI,EACJ,MAAMlwJ,EAAI2G,OAAO8G,EAAI1E,MAAM,UAAU,IAErC,OAAQ0E,EAAI1E,MAAM,QAAQ,IACxB,IAAK,UACHsW,EAAOgwI,EAAap3E,QAAQj4E,GAC5BkwJ,EAAWhsG,GAAW7kC,EAAKzU,MAC3B,MACF,IAAK,UACHyU,EAAOgwI,EAAaljF,QAAQnsE,GAC5BkwJ,EAAW,SACX,MACF,IAAK,cACH7wI,EAAOgwI,EAAathF,YAAY/tE,GAChCkwJ,EAAW,aACX,MACF,QACE,OAGAx+C,EAAQ,IACVv4F,GAAgB,QAGD,WAAb+2I,GAAsC,eAAbA,IAC3B/2I,GAAgB,KAAOnZ,EAAI,GAAK,MAGlCmZ,GAAgB,IAAM+2I,EAAW,MAAQ7wI,EAAKvgB,KAAO,MAAQsO,CAAK,IAG7D,IAAItP,MAAMqb,EACnB,CAEc,eAAAu2I,CACZL,EACA97H,EACA48H,G,0CAEA,IAAKA,EACH,OAGF,GAAI58H,EAAgB,CAClB,KAAM48H,aAAwB7wB,IAC5B,MAAM,IAAIxhI,MAAMR,KAAKkI,YAAYovB,EAAE,mCAGrC,MAAMw7H,EAAgD,GACtDf,EAAap3E,QAAQ/yE,SAAQ,CAAC7B,EAAGquG,KAE5B7vG,MAAMyQ,QAAQ+8I,EAAa1lB,0BAC3B0lB,EAAa1lB,wBAAwBj7E,MAAK,EAAE2hG,KAAeA,IAAc3+C,KAE1E0+C,EAA0Bl4I,KAAK,CAACw5F,EAAO,G,IAI3C,MAAM3jC,EAAgC,IAAIshF,EAAathF,aACvDshF,EAAathF,YAAc,CAACoiF,GAC5BpiF,EAAYhsE,KAAKE,IACf,MAAMs0B,EAAI,IAAI+oG,GACd/oG,EAAEz3B,KAAO,GAAGqxJ,EAAarxJ,QAAQmD,EAAEnD,OACnCuwJ,EAAathF,YAAY71D,KAAKqe,EAAE,IAGlC,MAAM+5H,EAAoC,IAAIjB,EAAa1lB,yBAM3D,OALA0lB,EAAa1lB,wBAA0B,IAAIymB,QAC3CE,EAAcvuJ,KAAKE,IACjBotJ,EAAa1lB,wBAAwBzxH,KAAK,CAACjW,EAAE,GAAIA,EAAE,GAAK,GAAG,G,CAM/D,KAAMkuJ,aAAwBttB,IAC5B,MAAM,IAAI/kI,MAAMR,KAAKkI,YAAYovB,EAAE,+BAGrC,MAAM27H,EAA4C,GAClDlB,EAAap3E,QAAQ/yE,SAAQ,CAAC7B,EAAGquG,KAC3B,EAAM3rG,cAAc1C,EAAE0kD,YACxB1kD,EAAE0kD,SAAWooG,EAAazsJ,GAC1B6sJ,EAAsBr4I,KAAK,CAACw5F,EAAO,I,IAIvC,MAAMvlC,EAAwB,IAAIkjF,EAAaljF,SAC/CkjF,EAAaljF,QAAU,CAACgkF,GACxBhkF,EAAQpqE,KAAKE,IACX,MAAMuuJ,EAAgB,GAAGL,EAAarxJ,QAAQmD,EAAEnD,OAC1Cy3B,EAAI,IAAIssG,GACdtsG,EAAEz3B,KAAO0xJ,EACTnB,EAAaljF,QAAQj0D,KAAKqe,EAAE,IAG9B,MAAM+5H,EAAoC,IAAIjB,EAAa5lB,qBAC3D4lB,EAAa5lB,oBAAsB,IAAI8mB,GACvCD,EAAcvuJ,KAAKE,IACjBotJ,EAAa5lB,oBAAoBvxH,KAAK,CAACjW,EAAE,GAAIA,EAAE,GAAK,GAAG,GAE3D,G,EC7eK,MAAMwuJ,GACX,kBAAOC,CAAYpxI,EAAiB,KAAMqxI,EAAY,OACpD,MAAM5mJ,EAAM,IAAID,KAYhB,MAAO,aAAewV,EAAS,IAAMA,EAAS,IAAM,YAVlDvV,EAAIk9I,cACJ,GACA3pJ,KAAKszJ,UAAU7mJ,EAAI6xI,WAAa,EAAG,GAEnCt+I,KAAKszJ,UAAU7mJ,EAAI+kF,UAAW,GAC9BxxF,KAAKszJ,UAAU7mJ,EAAI8mJ,WAAY,GAE/BvzJ,KAAKszJ,UAAU7mJ,EAAI+mJ,aAAc,GACjCxzJ,KAAKszJ,UAAU7mJ,EAAIgnJ,aAAc,IAE2C,IAAMJ,CACtF,CAEQ,gBAAOC,CAAUnyC,EAAayL,EAAe8mC,EAAe,KAClE,MAAMC,EAAYxyC,EAAI19G,WACtB,OAAOkwJ,EAAUlxJ,QAAUmqH,EACvB+mC,EACA,IAAIpvJ,MAAMqoH,EAAQ+mC,EAAUlxJ,OAAS,GAAGoC,KAAK6uJ,GAAgBC,CACnE,E,2SCfK,MAAMC,GACX,WAAAp0J,CACUq0J,EACAC,GADA,KAAAD,6BAAAA,EACA,KAAAC,+BAAAA,CACP,CAEG,SAAAC,CAAUrB,EAAuB,MAAO5uI,G,0CAC5C,IAAK,EAAMpd,mBAAmBod,GAAW,CACvC,GAAc,OAAV4uI,EACF,MAAM,IAAIlyJ,MAAM,kDAGlB,OAAOR,KAAK6zJ,6BAA6BG,2BAA2BlwI,E,CAEtE,OAAO9jB,KAAK6zJ,6BAA6BE,UAAUrB,EACrD,G,CAEM,qBAAAnoD,CACJt0E,EACAy8H,EACA5uI,EACAmwI,GAAyB,G,0CAEzB,IAAK,EAAMvtJ,mBAAmBod,GAAW,CACvC,GAAc,OAAV4uI,EACF,MAAM,IAAIlyJ,MAAM,kDAGlB,OAAOR,KAAK8zJ,+BAA+BE,2BACzC/9H,EACAnS,EACAmwI,E,CAIJ,OAAOj0J,KAAK8zJ,+BAA+BvpD,sBACzCt0E,EACAy8H,EACAuB,EAEJ,G,CAEA,WAAAb,CAAYpxI,EAAiB,KAAMqxI,EAAY,OAC7C,OAAOF,GAAaC,YAAYpxI,EAAQqxI,EAC1C,E,2SCxCK,MAAMa,GACX,WAAA10J,CACYsxC,EACAh9B,EACFsI,EACAC,GAHE,KAAAy0B,WAAAA,EACA,KAAAh9B,cAAAA,EACF,KAAAsI,sBAAAA,EACA,KAAAC,iBAAAA,CACP,CAEa,mBAAA83I,CAAoBC,EAAmBtwI,G,0CACrD,MAAMpG,QAA6B1d,KAAKqc,iBAAiBsB,eAEnDa,EAAO,EAAMjb,sBAAsBvD,KAAKoc,sBAAsBsqC,YAAY,KAC1Ev2C,QAAYnQ,KAAK8wC,WAAWjzB,WAAWiG,EAAUtF,EAAMd,GAEvDu1H,QAAyBjzI,KAAK8T,cAAcgK,QAAQ,EAAMhY,UAAWqK,GACrEkkJ,QAAgBr0J,KAAK8T,cAAcgK,QAAQs2I,EAAWjkJ,GAEtDmkJ,EAAgD,CACpD3sI,WAAW,EACX+rH,mBAAmB,EACnBl1H,KAAMA,EACNxP,QAAS0O,EAAU1O,QACnBiX,cAAevI,EAAU3O,WACzBikI,6BAA8BC,EAAiBjgI,gBAC/CR,KAAM6hJ,EAAQrhJ,iBAQhB,OALI0K,EAAU1O,UAAY,EAAQS,WAChC6kJ,EAAQpuI,UAAYxI,EAAUnO,OAC9B+kJ,EAAQnuI,eAAiBzI,EAAUlO,aAG9Bib,KAAKC,UAAU4pI,EAAS,KAAM,KACvC,G,CAEU,iBAAAC,CACRv1F,EACAj5D,GAyBA,OAvBAi5D,EAAO1xD,KAAO,KACd0xD,EAAOx9D,KAAOuE,EAAEvE,KAChBw9D,EAAOlU,MAAQ/kD,EAAE+kD,MACjBkU,EAAOxT,OAAS,KAChBwT,EAAOhU,SAAWjlD,EAAEilD,SAEpBgU,EAAO0yE,UAAY,KACnB1yE,EAAOwyE,eAAiB,KACxBxyE,EAAOyyE,eAAiB,KACxBzyE,EAAOuyE,WAAa,KAEhBxrI,EAAEylD,QACJzlD,EAAEylD,OAAO5jD,SAASqxB,IACX+lC,EAAOxT,OAGVwT,EAAOxT,QAAU,KAFjBwT,EAAOxT,OAAS,GAKlBwT,EAAOxT,SAAWvyB,EAAEz3B,MAAQ,IAAM,KAAOy3B,EAAEnpB,KAAK,IAI5C/J,EAAEuH,MACR,KAAKs5C,GAAWqE,MACd+T,EAAO1xD,KAAO,QACd0xD,EAAOwyE,eAAiBzrI,EAAEmlD,MAAMrnC,SAChCm7C,EAAOyyE,eAAiB1rI,EAAEmlD,MAAMpnC,SAChCk7C,EAAOuyE,WAAaxrI,EAAEmlD,MAAMnB,KAExBhkD,EAAEmlD,MAAMjB,OACV+U,EAAO0yE,UAAY,GACnB3rI,EAAEmlD,MAAMjB,KAAKriD,SAASsiD,IACpB8U,EAAO0yE,UAAU92H,KAAKsvC,EAAEP,IAAI,KAGhC,MACF,KAAK/C,GAAWuE,WACd6T,EAAO1xD,KAAO,OACd,MACF,QACE,OAGJ,OAAO0xD,CACT,E,2SC/DK,MAAMw1F,WACHN,GAGR,WAAA10J,CACUg+D,EACAvxC,EACR6kB,EACAh9B,EACAsI,EACQwnH,EACRvnH,GAEA5O,MAAMqjC,EAAYh9B,EAAesI,EAAuBC,GARhD,KAAAmhD,cAAAA,EACA,KAAAvxC,WAAAA,EAIA,KAAA23G,kBAAAA,CAIV,CAEM,0BAAAowB,CACJ/9H,EACAnS,EACAmwI,G,0CAEA,MAAMG,QAAkBp0J,KAAKuqG,sBAC3Bt0E,EACA,OACAg+H,GAGF,OAAOj0J,KAAKm0J,oBAAoBC,EAAWtwI,EAC7C,G,CAEM,qBAAAymF,CACJt0E,EACAy8H,EAAuB,MACvBuB,G,0CAEA,GAAI,EAAMvtJ,mBAAmBuvB,GAC3B,MAAM,IAAIz1B,MAAM,8BAGlB,MAAe,mBAAXkyJ,EACKuB,EACHj0J,KAAKy0J,0BAA0Bx+H,GAC/Bj2B,KAAK00J,+BAA+Bz+H,GAGnCg+H,EACHj0J,KAAK20J,0BAA0B1+H,EAAgBy8H,GAC/C1yJ,KAAK40J,+BAA+B3+H,EAAgBy8H,EAC1D,G,CAEc,8BAAAkC,CACZ3+H,EACAy8H,G,0CAEA,MAAMruB,EAAmC,GACnChJ,EAA2B,GAC3BhyG,EAAW,GAwCjB,OAtCAA,EAASzO,KACP5a,KAAKisB,WAAWs+E,sBAAsBt0E,GAAgBzM,MAAMqrI,IAC1D,MAAMC,EAAsB,GA8B5B,OA7BkB,MAAdD,IAC4B,MAA1BA,EAAWpkF,aAAuBokF,EAAWpkF,YAAYhuE,OAAS,GACpEoyJ,EAAWpkF,YAAY7oE,SAAS7B,IAC9B,MAAM49H,EAAa,IAAI1B,GAAW,IAAIF,GAAeh8H,IACrD+uJ,EAAel6I,MACb,OAAe5a,KAAK8T,cAAcwwH,oBAC/B96G,MAAMrgB,GAASw6H,EAAWpwH,QAAQpK,EAAK8sB,MACvCzM,MAAMurI,IACL1wB,EAAezpH,KAAKm6I,EAAO,IAEhC,IAGqB,MAAtBF,EAAWl6E,SAAmBk6E,EAAWl6E,QAAQl4E,OAAS,GAC5DoyJ,EAAWl6E,QACRj7E,QAAQqG,GAAwB,OAAlBA,EAAEglD,cAChBnjD,SAAe7B,GAAM,mCACpB,MAAMi5D,EAAS,IAAIrL,GAAO,IAAIpJ,GAAWxkD,IACzC+uJ,EAAel6I,KACb5a,KAAKw9D,cACF0C,6BAA6BlB,GAC7Bx1C,MAAMrZ,GAAQ6uD,EAAOzrD,QAAQpD,KAC7BqZ,MAAMwrI,IACL35B,EAAWzgH,KAAKo6I,EAAU,IAGlC,OAGCppJ,QAAQ+d,IAAImrI,EAAe,WAIhClpJ,QAAQ+d,IAAIN,GAEH,QAAXqpI,EACK1yJ,KAAKi1J,eAAe5wB,EAAgBhJ,GAEtCr7H,KAAKk1J,gBAAgB7wB,EAAgBhJ,EAC9C,G,CAEc,8BAAAq5B,CAA+Bz+H,G,0CAC3C,MAAMw6C,EAA4B,GAC5BkK,EAAoB,GACpBtxD,EAAW,GA4BjB,OA1BAA,EAASzO,KACP5a,KAAKisB,WAAWk5E,eAAelvE,GAAgBzM,MAAMzjB,IAC1C,MAALA,GAAuB,MAAVA,EAAEyM,MAAgBzM,EAAEyM,KAAK/P,OAAS,GACjDsD,EAAEyM,KAAK5K,SAAS5B,IACd,MAAM29H,EAAa,IAAI1B,GAAW,IAAIF,GAAe/7H,IACrDyqE,EAAY71D,KAAK+oH,EAAW,G,KAMpCt6G,EAASzO,KACP5a,KAAKisB,WAAW62E,uBAAuB7sE,GAAgBzM,MAAMzjB,IAClD,MAALA,GAAuB,MAAVA,EAAEyM,MAAgBzM,EAAEyM,KAAK/P,OAAS,GACjDsD,EAAEyM,KACC9S,QAAQqiB,GAA8B,OAArBA,EAAKgpC,cACtBnjD,SAASma,IACR,MAAMi9C,EAAS,IAAIrL,GAAO,IAAIpJ,GAAWxoC,IACzC44D,EAAQ//D,KAAKokD,EAAO,G,WAMxBpzD,QAAQ+d,IAAIN,GAEXrpB,KAAKm1J,qBAAqBl/H,EAAgBw6C,EAAakK,EAChE,G,CAEc,yBAAAg6E,CACZ1+H,EACAy8H,G,0CAEA,IAAIr3B,EAA2B,GAC3B+5B,EAA8B,GAC9B/wB,EAAmC,GACvC,MAAMh7G,EAAW,GAsBjB,OApBAA,EAASzO,KACP5a,KAAK4jI,kBAAkB3hE,kBAAkBz4C,MAAYinD,GAAgB,mCACnE4zD,EAAiB5zD,EAAY/wE,QAAQqG,GAAMA,EAAEkwB,gBAAkBA,GAAkBlwB,EAAEspF,QACrF,OAGFhmE,EAASzO,KACP5a,KAAKw9D,cAAcyE,kBAAkBz4C,MAAMmxD,IACzCy6E,EAAgBz6E,CAAO,WAGrB/uE,QAAQ+d,IAAIN,GAElBgyG,EAAa+5B,EAAc11J,QACxBu5B,GACkB,MAAjBA,EAAE8xB,aACF9xB,EAAEhD,gBAAkBA,GACpBouG,EAAejzE,MAAMikG,GAAOp8H,EAAEuxB,cAAc4G,MAAMg1E,GAAQivB,EAAGjvJ,KAAOggI,QAGzD,QAAXssB,EACK1yJ,KAAKi1J,eAAe5wB,EAAgBhJ,GAEtCr7H,KAAKk1J,gBAAgB7wB,EAAgBhJ,EAC9C,G,CAEc,yBAAAo5B,CAA0Bx+H,G,0CACtC,IAAI6nG,EAAuB,GACvBw3B,EAAuB,GACvBC,EAA+B,GACnC,MAAMlsI,EAAW,GAuBjB,OArBAA,EAASzO,KACP5a,KAAK4jI,kBAAkBjtG,SAASnN,MAAMinD,IACpC8kF,EAAiB9kF,EAAY/wE,QAAQqG,GAAMA,EAAEkwB,gBAAkBA,GAAkBlwB,EAAEspF,QAAO,KAI9FhmE,EAASzO,KACP5a,KAAKw9D,cAAc7mC,SAASnN,MAAMmxD,IAChC26E,EAAa36E,CAAO,WAIlB/uE,QAAQ+d,IAAIN,GAElBy0G,EAAaw3B,EAAW51J,QACrBu5B,GACkB,MAAjBA,EAAE8xB,aACF9xB,EAAEhD,gBAAkBA,GACpBs/H,EAAenkG,MAAMokG,GAAOv8H,EAAEuxB,cAAc4G,MAAMg1E,GAAQovB,EAAGpvJ,KAAOggI,QAGjEpmI,KAAKm1J,qBAAqBl/H,EAAgBs/H,EAAgBz3B,EACnE,G,CAEc,oBAAAq3B,CACZl/H,EACAw6C,EACAkK,G,0CAEA,MAAM+nD,QAAe1iI,KAAK8T,cAAcE,UAAUiiB,GAG5Cq+H,EAA2C,CAC/C3sI,WAAW,EACXqrH,oCAJ6BhzI,KAAK8T,cAAcgK,QAAQ,EAAMhY,UAAW48H,IAI1B1vH,gBAC/Cy9D,YAAa,GACblqB,MAAO,IAcT,OAXAkqB,EAAY7oE,SAAS7B,IACnB,MAAM49H,EAAa,IAAI+O,GACvB/O,EAAW/gD,MAAM78E,GACjBuuJ,EAAQ7jF,YAAY71D,KAAK+oH,EAAW,IAGtChpD,EAAQ/yE,SAAS7B,IACf,MAAMi5D,EAAS,IAAIwzE,GACnBxzE,EAAO4jB,MAAM78E,GACbuuJ,EAAQ/tG,MAAM3rC,KAAKokD,EAAO,IAErBv0C,KAAKC,UAAU4pI,EAAS,KAAM,KACvC,G,CAEQ,cAAAW,CAAe5wB,EAAkChJ,GACvD,MAAMo6B,EAAiB,IAAI71J,IAC3BykI,EAAez8H,SAAS7B,IACtB0vJ,EAAe1tJ,IAAIhC,EAAEK,GAAIL,EAAE,IAG7B,MAAM2vJ,EAA6C,GAkBnD,OAjBAr6B,EAAWzzH,SAAS7B,IAElB,GAAIA,EAAEuH,OAASs5C,GAAWqE,OAASllD,EAAEuH,OAASs5C,GAAWuE,WACvD,OAGF,MAAM6T,EAAS,CACfA,YAAqB,IACE,MAAnBj5D,EAAEykD,gBACJwU,EAAOyR,YAAc1qE,EAAEykD,cACpB9qD,QAAQ0G,GAAOqvJ,EAAe3kG,IAAI1qD,KAClC3B,KAAK2B,GAAOqvJ,EAAex7I,IAAI7T,GAAI5E,QAExCxB,KAAKu0J,kBAAkBv1F,EAAQj5D,GAC/B2vJ,EAAc96I,KAAKokD,EAAO,IAGrB,WAAa02F,EACtB,CAEQ,eAAAR,CAAgB7wB,EAAkChJ,GACxD,MAAMi5B,EAA6C,CACjD3sI,WAAW,EACX8oD,YAAa,GACblqB,MAAO,IAcT,OAXA89E,EAAez8H,SAAS7B,IACtB,MAAM49H,EAAa,IAAI+O,GACvB/O,EAAW/gD,MAAM78E,GACjBuuJ,EAAQ7jF,YAAY71D,KAAK+oH,EAAW,IAGtCtI,EAAWzzH,SAAS7B,IAClB,MAAMi5D,EAAS,IAAIwzE,GACnBxzE,EAAO4jB,MAAM78E,GACbuuJ,EAAQ/tG,MAAM3rC,KAAKokD,EAAO,IAErBv0C,KAAKC,UAAU4pI,EAAS,KAAM,KACvC,E,2SC1RK,MAAMqB,WACHzB,GAGR,WAAA10J,CACU2lI,EACA3nE,EACR1sB,EACAh9B,EACAsI,EACAC,GAEA5O,MAAMqjC,EAAYh9B,EAAesI,EAAuBC,GAPhD,KAAA8oH,cAAAA,EACA,KAAA3nE,cAAAA,CAOV,CAEM,SAAAu2F,CAAUrB,EAAuB,O,0CACrC,MAAe,mBAAXA,EACK1yJ,KAAK41J,qBAEP51J,KAAK61J,mBAAmBnD,EACjC,G,CAEM,0BAAAsB,CAA2BlwI,G,0CAC/B,MAAMswI,QAAkBp0J,KAAK+zJ,UAAU,QACvC,OAAO/zJ,KAAKm0J,oBAAoBC,EAAWtwI,EAC7C,G,CAEc,kBAAA+xI,CAAmBnD,G,0CAC/B,IAAIoD,EAA2B,GAC3Bz6B,EAA2B,GAC/B,MAAMhyG,EAAW,GAgBjB,OAdAA,EAASzO,KACP5a,KAAKmlI,cAAcpQ,2BAA2BvrG,MAAMqlD,IAClDinF,EAAajnF,CAAO,KAIxBxlD,EAASzO,KACP5a,KAAKw9D,cAAcyE,kBAAkBz4C,MAAMmxD,IACzC0gD,EAAa1gD,EAAQj7E,QAAQu5B,GAAuB,MAAjBA,EAAE8xB,aAAoB,WAIvDn/C,QAAQ+d,IAAIN,GAEH,QAAXqpI,EACK1yJ,KAAKi1J,eAAea,EAAYz6B,GAGlCr7H,KAAKk1J,gBAAgBY,EAAYz6B,EAC1C,G,CAEc,kBAAAu6B,G,0CACZ,IAAI/mF,EAAoB,GACpB8L,EAAoB,GACxB,MAAMtxD,EAAW,GAEjBA,EAASzO,KACP5a,KAAKmlI,cAAce,kBAAkB18G,MAAMyP,IACzC41C,EAAU51C,CAAC,KAIf5P,EAASzO,KACP5a,KAAKw9D,cAAc7mC,SAASnN,MAAMzjB,IAChC40E,EAAU50E,EAAErG,QAAQu5B,GAAuB,MAAjBA,EAAE8xB,aAAoB,WAI9Cn/C,QAAQ+d,IAAIN,GAElB,MAEMirI,EAAkD,CACtD3sI,WAAW,EACXqrH,oCAJ6BhzI,KAAK8T,cAAcgK,QAAQ,EAAMhY,YAIfkN,gBAC/C67D,QAAS,GACTtoB,MAAO,IAsBT,OAnBAsoB,EAAQjnE,SAASqxB,IACf,GAAY,MAARA,EAAE7yB,GACJ,OAEF,MAAM41H,EAAS,IAAI4W,GACnB5W,EAAOp5C,MAAM3pD,GACbq7H,EAAQzlF,QAAQj0D,KAAKohH,EAAO,IAG9BrhD,EAAQ/yE,SAAS7B,IACf,GAAwB,MAApBA,EAAEkwB,eACJ,OAEF,MAAM+oC,EAAS,IAAIwzE,GACnBxzE,EAAO4jB,MAAM78E,GACbi5D,EAAOxU,cAAgB,KACvB8pG,EAAQ/tG,MAAM3rC,KAAKokD,EAAO,IAGrBv0C,KAAKC,UAAU4pI,EAAS,KAAM,KACvC,G,CAEQ,cAAAW,CAAea,EAA0Bz6B,GAC/C,MAAM0d,EAAa,IAAIn5I,IACvBk2J,EAAWluJ,SAASqxB,IACN,MAARA,EAAE7yB,IACJ2yI,EAAWhxI,IAAIkxB,EAAE7yB,GAAI6yB,E,IAIzB,MAAMy8H,EAAoD,GAkB1D,OAjBAr6B,EAAWzzH,SAAS7B,IAElB,GAAIA,EAAEuH,OAASs5C,GAAWqE,OAASllD,EAAEuH,OAASs5C,GAAWuE,WACvD,OAEF,GAAwB,MAApBplD,EAAEkwB,eACJ,OAGF,MAAM+oC,EAAS,CAAC,EAChBA,EAAOg9D,OACS,MAAdj2H,EAAE0kD,UAAoBsuF,EAAWjoF,IAAI/qD,EAAE0kD,UAAYsuF,EAAW9+H,IAAIlU,EAAE0kD,UAAUjpD,KAAO,KACvFw9D,EAAOnU,SAAW9kD,EAAE8kD,SAAW,EAAI,KACnC7qD,KAAKu0J,kBAAkBv1F,EAAQj5D,GAC/B2vJ,EAAc96I,KAAKokD,EAAO,IAGrB,WAAa02F,EACtB,CAEQ,eAAAR,CAAgBY,EAA0Bz6B,GAChD,MAAMi5B,EAAoD,CACxD3sI,WAAW,EACXknD,QAAS,GACTtoB,MAAO,IAsBT,OAnBAuvG,EAAWluJ,SAASqxB,IAClB,GAAY,MAARA,EAAE7yB,GACJ,OAEF,MAAM41H,EAAS,IAAI4W,GACnB5W,EAAOp5C,MAAM3pD,GACbq7H,EAAQzlF,QAAQj0D,KAAKohH,EAAO,IAG9BX,EAAWzzH,SAAS7B,IAClB,GAAwB,MAApBA,EAAEkwB,eACJ,OAEF,MAAM+oC,EAAS,IAAIwzE,GACnBxzE,EAAO4jB,MAAM78E,GACbi5D,EAAOxU,cAAgB,KACvB8pG,EAAQ/tG,MAAM3rC,KAAKokD,EAAO,IAGrBv0C,KAAKC,UAAU4pI,EAAS,KAAM,KACvC,E,gBCvLK,MAAMyB,GACX,uBAAOC,CAAiBj5G,EAAiBvqC,EAAY,KAAMyjJ,GAAa,GACtE,OAAK,GAAWC,YAGT,IAAItqJ,SAASC,IAClB,MACMsqJ,GADM,IAAI3pJ,MAEVD,UAAU9I,WAAa,IAAMwC,KAAK0G,MAAM1G,KAAKC,SAAWmD,OAAO+sJ,kBACpEn9I,QAAgBo9I,QAAQC,kBACvB,wBACA,CACElwJ,GAAI+vJ,EACJp5G,QAASA,EACTvqC,KAAMA,EACN+jJ,aAAc,OAEf7oJ,IACC7B,EAAQ6B,EAAS,GAEpB,IAjBM9B,QAAQC,QAAQ,KAmB3B,E,2SCtBF,MAAM2qJ,GASJ,WAAaC,CAAK3wE,EAAuB4X,G,0CACvC,GAAK84D,GAAwBE,wBAAwB5wE,EAAe,aAKpE,UACQA,EAAcz6E,UAAUsrJ,UAAUC,UAAUl5D,E,CAClD,MAAOn9F,GACPi2J,GAAwBK,kBAAkBh3J,MACxC,iFAAiFU,KAGnFP,KAAK82J,oBAAoBhxE,EAAe4X,E,MAXxC19F,KAAK82J,oBAAoBhxE,EAAe4X,EAa5C,G,CAOA,WAAaq5D,CAAKjxE,G,0CAChB,IAAK0wE,GAAwBE,wBAAwB5wE,EAAe,YAClE,OAAO9lF,KAAKg3J,oBAAoBlxE,GAGlC,IACE,aAAaA,EAAcz6E,UAAUsrJ,UAAUM,U,CAC/C,MAAO12J,GAKP,OAJAi2J,GAAwBK,kBAAkBh3J,MACxC,mFAAmFU,KAG9EP,KAAKg3J,oBAAoBlxE,E,CAEpC,G,CASQ,0BAAOgxE,CAAoBhxE,EAAuB4X,GACxD,IAAK84D,GAAwBU,iCAAiCpxE,EAAe,QAE3E,YADA0wE,GAAwBK,kBAAkBx2J,QAAQ,oCAIpD,MAAM82J,EAAkBrxE,EAAcsxE,SAASC,cAAc,YAC7DF,EAAgB9iB,YAAe32C,GAAO,IACtCy5D,EAAgBG,MAAMC,SAAW,QACjCzxE,EAAcsxE,SAAShwF,KAAKowF,YAAYL,GACxCA,EAAgBM,SAEhB,IACE3xE,EAAcsxE,SAASM,YAAY,O,CACnC,MAAOn3J,GACPi2J,GAAwBK,kBAAkBx2J,QAAQ,+BAA+BE,I,SAEjFulF,EAAcsxE,SAAShwF,KAAKuwF,YAAYR,E,CAE5C,CAQQ,0BAAOH,CAAoBlxE,GACjC,IAAK0wE,GAAwBU,iCAAiCpxE,EAAe,SAE3E,OADA0wE,GAAwBK,kBAAkBx2J,QAAQ,qCAC3C,GAGT,MAAM82J,EAAkBrxE,EAAcsxE,SAASC,cAAc,YAC7DF,EAAgBG,MAAMC,SAAW,QACjCzxE,EAAcsxE,SAAShwF,KAAKowF,YAAYL,GACxCA,EAAgBS,QAEhB,IACE,OAAO9xE,EAAcsxE,SAASM,YAAY,SAAWP,EAAgBrnJ,MAAQ,E,CAC7E,MAAOvP,GACPi2J,GAAwBK,kBAAkBx2J,QAAQ,iCAAiCE,I,SAEnFulF,EAAcsxE,SAAShwF,KAAKuwF,YAAYR,E,CAG1C,MAAO,EACT,CAQQ,8BAAOT,CAAwB5wE,EAAuBze,GAC5D,MAAO,cAAeye,EAAcz6E,WAAag8D,KAAUye,EAAcz6E,UAAUsrJ,SACrF,CAQQ,uCAAOO,CAAiCpxE,EAAuBze,GACrE,MACE,0BAA2Bye,EAAcsxE,UACzCtxE,EAAcsxE,SAASS,sBAAsBxwF,EAEjD,EA3He,GAAAwvF,kBAAuC,IAAIt3J,GAAkB,GA8H9E,U,uSCtHO,MAAeu4J,GAGpB,WAAAt4J,CACUu4J,EACAC,EACAlyE,EACAmyE,GAHA,KAAAF,uBAAAA,EACA,KAAAC,kBAAAA,EACA,KAAAlyE,cAAAA,EACA,KAAAmyE,yBAAAA,CACP,CAEH,gBAAO51I,CAAUyjE,GACf,OAAI9lF,KAAKk4J,cAILJ,GAA4BK,YAC9Bn4J,KAAKk4J,YAAcn0I,GAAWq0I,iBACrBN,GAA4BO,QAAQvyE,GAC7C9lF,KAAKk4J,YAAcn0I,GAAWu0I,eACrBR,GAA4BS,SACrCv4J,KAAKk4J,YAAcn0I,GAAWy0I,cACrBV,GAA4BW,YACrCz4J,KAAKk4J,YAAcn0I,GAAW20I,iBACrBZ,GAA4Ba,SAAS7yE,GAC9C9lF,KAAKk4J,YAAcn0I,GAAW60I,gBACrBd,GAA4Be,SAAS/yE,KAC9C9lF,KAAKk4J,YAAcn0I,GAAW+0I,kBAdvB94J,KAAKk4J,WAkBhB,CAEA,SAAA71I,GACE,OAAOy1I,GAA4Bz1I,UAAUriB,KAAK8lF,cACpD,CAEA,eAAAxjE,GAEE,OADeyB,GAAW/jB,KAAKqiB,aAAara,cAC9B9D,QAAQ,YAAa,GACrC,CAEA,aAAAo7F,GACE,OAAO,GAAWy5D,OACpB,CAKA,gBAAOZ,GACL,OACgD,IAA9C9sJ,UAAUC,UAAUzE,QAAQ,eACgB,IAA5CwE,UAAUC,UAAUzE,QAAQ,UAEhC,CAEA,SAAAsxJ,GACE,OAAOn4J,KAAKqiB,cAAgB0B,GAAWq0I,gBACzC,CAKQ,eAAOO,CAAS7yE,GACtB,OAAOA,EAAckzE,SAAuD,IAA7C3tJ,UAAUC,UAAUzE,QAAQ,WAC7D,CAEA,QAAA8xJ,GACE,OAAO34J,KAAKqiB,cAAgB0B,GAAW60I,eACzC,CAKQ,aAAOL,GACb,OAAiD,IAA1CltJ,UAAUC,UAAUzE,QAAQ,QACrC,CAEA,MAAA0xJ,GACE,OAAOv4J,KAAKqiB,cAAgB0B,GAAWy0I,aACzC,CAKQ,cAAOH,CAAQvyE,G,MACrB,SACqB,QAAjB,EAAAA,EAAcmzE,WAAG,eAAEC,WACnBpzE,EAAct6E,OAChBH,UAAUC,UAAUzE,QAAQ,UAAY,CAE5C,CAEA,OAAAwxJ,GACE,OAAOr4J,KAAKqiB,cAAgB0B,GAAWu0I,cACzC,CAKQ,gBAAOG,GACb,OAAqD,IAA9CptJ,UAAUC,UAAUzE,QAAQ,YACrC,CAEA,SAAA4xJ,GACE,OAAOz4J,KAAKqiB,cAAgB0B,GAAW20I,gBACzC,CAKA,eAAOG,CAAS/yE,GAEd,OACGgyE,GAA4BO,QAAQvyE,KACQ,IAA7Cz6E,UAAUC,UAAUzE,QAAQ,WAEhC,CAEQ,oBAAOsyJ,G,MACb,OAAqD,QAA9C,EAAA9tJ,UAAUC,UAAUG,MAAM,4BAAoB,eAAG,EAC1D,CAMA,iCAAO2tJ,CAA2BtzE,G,MAChC,GAAIgyE,GAA4Bz1I,UAAUyjE,KAAmB/hE,GAAW+0I,gBACtE,OAAO,EAGT,MAAMn5G,EAAUm4G,GAA4BqB,gBACtCrxJ,EAA2B,QAAnB,EAAA63C,aAAO,EAAPA,EAASh4C,MAAM,YAAI,eAAElD,KAAKgR,GAAMpM,OAAOoM,KACrD,OAAO3N,aAAK,EAALA,EAAQ,IAAK,IAAsB,MAAfA,aAAK,EAALA,EAAQ,KAA4B,KAAfA,aAAK,EAALA,EAAQ,GAC1D,CAEA,QAAA+wJ,GACE,OAAO74J,KAAKqiB,cAAgB0B,GAAW+0I,eACzC,CAEA,IAAAO,GACE,OAAO,CACT,CAEA,aAAAC,GACE,OAAO,CACT,CAOM,UAAAC,G,0CACJ,OAAIv5J,KAAK64J,WAEA,GAAWW,cAEbpuH,cAAc,GAAWquH,wBAAwB,4BAC1D,G,CAEA,WAAAC,GACE,OAAO,IACT,CAEA,SAAAtpG,CAAUzG,EAAaj4C,GAGrB,GAAWioJ,aAAahwG,EAAKj4C,IAAqC,IAA1BA,EAAQkoJ,cAClD,CAEA,qBAAAC,G,MACE,MAAMC,EAAWd,OAAO3C,QAAQ0D,cAChC,OAAOnuJ,QAAQC,QAA6B,QAArB,EAAAiuJ,EAASE,oBAAY,QAAIF,EAASn6G,QAC3D,CAEA,2BAAA6qD,GACE,MAAMsvD,EAAWd,OAAO3C,QAAQ0D,cAChC,OAAOnuJ,QAAQC,QAAQiuJ,EAASn6G,QAAQh4C,MAAMtB,OAAO,UAAU,GAAGM,OACpE,CAEA,gBAAAszJ,CAAiB9uJ,GACf,MAAsC,oBAAxB+uJ,mBAChB,CAEA,WAAAC,GACE,OAAO,CACT,CASA,KAAA16J,GACE,OAAO,CACT,CAEA,UAAAorG,GACE,OAAO,CACT,CAYA,eAAAxlB,CAAgBqY,EAAchsF,GAC5B,MAAM0oJ,GAAgB1oJ,aAAO,EAAPA,EAAShQ,SAAW1B,KAAK8lF,cACzCR,EAAWl6C,QAAQ15B,aAAO,EAAPA,EAAS4zE,UAC5B+0E,GAAkB3oJ,aAAO,EAAPA,EAAS2oJ,UAAW,KACtCC,EAA+B,KAC9Bh1E,GAA2C,MAA/BtlF,KAAK+3J,wBACpB/3J,KAAK+3J,uBAAuBr6D,EAAM28D,E,EAIlCr6J,KAAK64J,WACF9C,GAAUC,iBAAiB,kBAAmBt4D,GAAMl0E,KAAK8wI,IAK5Dt6J,KAAK24J,YAAuB,KAATj7D,IACrBA,EAAO,MAGL,GAAW68D,kBAAkB,IAAMv6J,KAAKi4J,yBAAyBuC,wBAC9Dx6J,KAAKy6J,gCAAgC/8D,GAAMl0E,KAAK8wI,GAKlD,GAAwB7D,KAAK2D,EAAe18D,GAAMl0E,KAAK8wI,GAC9D,CAWM,iBAAAl1E,CAAkB1zE,G,0CACtB,MAAM0oJ,GAAgB1oJ,aAAO,EAAPA,EAAShQ,SAAW1B,KAAK8lF,cAE/C,OAAI9lF,KAAK64J,iBACM9C,GAAUC,iBAAiB,qBAGtC,GAAWuE,kBAAkB,IAAMv6J,KAAKi4J,yBAAyBuC,8BACtDx6J,KAAK06J,0CAGP,GAAwB3D,KAAKqD,EAC5C,G,CAEM,iBAAAO,G,0CACJ,MAAMC,QAAqB,GAAWC,kBACtC,MAAwB,QAApBD,EAAaE,IAAoC,QAApBF,EAAaE,EAIhD,G,CAEA,qBAAAC,GACE,OAAO/6J,KAAKg4J,mBACd,CAEA,qBAAA/2H,GACE,OAAO,CACT,CAEM,2BAAA+5H,G,0CACJ,IAAIC,EAuBJ,OArBIj7J,KAAK64J,WACPoC,EAAkB,cACTj7J,KAAKm4J,aACd8C,SAAyBhiJ,QAAQiiJ,SAASvkI,UAAUT,MACjDnwB,GAAiB,mBAAXA,EAAEvE,OACT25J,SAIiD,eAA1CliJ,QAAQo9I,QAAQwE,mBAAmBC,IACtB,iBAApBG,IAEAA,EAAkB,sBAGd,IAAIrvJ,SAASC,GACjBmtJ,OAAOkC,SAASvkI,QAAQ5wB,GACtB8F,EAASovJ,EAAkBl1J,EAAEmwB,MAAMnwB,GAAiB,mBAAXA,EAAEvE,OAA2B25J,cAIrEF,CACT,G,CAKc,+BAAAR,CAAgC/8D,G,gDACtC19F,KAAKi4J,yBAAyBmD,aAClC,CAACpC,OAAOqC,UAAUC,OAAOC,WACzB,gCACA,IAAY,yCACJ,GAAW9B,wBAAwB,2BAA4B,CAAE/7D,QACzE,KAEJ,G,CAKc,iCAAAg9D,G,0CACZ,MAAMhtJ,QAAiB1N,KAAKi4J,yBAAyBmD,aACnD,CAACpC,OAAOqC,UAAUC,OAAOC,WACzB,iCACA,IAAY,mCACV,aAAa,GAAW9B,wBAAwB,6BAClD,MAEF,MAAwB,iBAAb/rJ,EACFA,EAGF,EACT,G,EAjVe,GAAAwqJ,YAA0B,K,2SCM3C,IAAIsD,GAIG,SAAeC,GACpBC,EACA/7H,G,0CAMA,OAJK67H,KACHA,GAMJ,W,QACE,MAAMj/I,EAAa,IAAIhd,GAAkB,GACnCo8J,EAAc3+F,WAAWg8F,QAAU4C,EAAsC5+F,WAAWg8F,QACpF6C,EACJ,+HACI1D,EAAgC,QAApB,EAAAn7F,WAAW3xD,iBAAS,eAAEC,UAAU4kC,SAAS,YACrD4rH,EAAe1wH,QAAyB,QAAjB,EAAA4xB,WAAWg8F,cAAM,eAAE+C,WAC1CC,EAAkC,iBAAXhD,QAAuB,kBAAmBA,OAEvE,SAAS4C,EAA8B7yJ,GACrC,OAAO,IAAIkzJ,MAAMlzJ,EAAQ,CACvB,GAAAkR,CAAIlR,EAAQZ,GACV,GAAKY,EAAOZ,GAIZ,MAAuC,mBAA5BY,EAAOZ,GACTyzJ,EAAY7yJ,EAAOZ,IAGrB,IAAI+zJ,IACT,IAAItwJ,SAAQ,CAACC,EAASi0F,KACpB/2F,EAAOZ,MAAoB+zJ,GAAav3H,IAClCq0H,OAAO3C,QAAQ8F,UACjBr8D,EAAO,IAAIt/F,MAAMw4J,OAAO3C,QAAQ8F,UAAUr8J,UAE1C+L,EAAQ84B,E,GAEV,GAER,GAEJ,CAEA,SAASy3H,EAAmBC,GAC1B,IAAKC,EAAeD,GAClB,MAAM,IAAI77J,MACR,GAAG67J,0CAAqDz4J,OAAOi4J,KAGrE,CAEA,SAASS,EAAeD,GACtB,MAAwB,eAAjBA,GAAiCR,EAAuBt1J,KAAK81J,EACtE,CAEA,SAASE,EAAmBF,GAC1BD,EAAmBC,GACnB,IAAK,CAAEG,EAAUr1J,EAAO,GAAIs1J,GAAYJ,EAAa10J,MAAM,2BAmB3D,OAlBA60J,EAAWA,EACRt4J,QAAQ,IAAKi0J,EAAY,gBAAkB,UAC3CuE,WAAW,OAAQ,OAET,MAATv1J,EACFA,EAAO,QACEA,IACTA,EAAOA,EACJjD,QAAQ,UAAW,aACnBw4J,WAAW,OAAQ,OACnBx4J,QAAQ,OAAQ,UAGrBu4J,EAAWA,EACRC,WAAW,OAAQ,OACnBA,WAAW,OAAQ,OACnBA,WAAW,OAAQ,MAEf,IAAMF,EAAWr1J,EAAO,IAAMs1J,EAAW,KAClD,CAEA,SAASE,KAAkBC,GACzB,OAA6B,IAAzBA,EAAcn6J,OACT,KAGLm6J,EAAc1sH,SAAS,cAElB,0BAGL0sH,EAAc1sH,SAAS,WAElBioH,EAAY,sCAAwC,+BAGtD,IAAI9xJ,OAAOu2J,EAAcn4J,KAAKE,GAAM43J,EAAmB53J,KAAIE,KAAK,KACzE,CAEA,SAASg4J,EAAoB9zJ,GAC3B,MAAsB,iBAAXA,EACF,OAAP,wBAAYA,GAAM,CAAE+zJ,WAAW,IAG1B,CACLC,MAAOh0J,EACPi0J,aAASp0J,EACTk0J,WAAW,EAEf,CAEA,SAASG,EAAUC,GACjB,OAAI34J,MAAMyQ,QAAQkoJ,GACTA,EAGF,CAACA,EACV,CAEA,SAASC,EAAiBrtJ,GACxB,YAAiBlH,IAAVkH,OAAsBlH,EAAY,CAACkH,EAC5C,CAEA,SAAestJ,GACb,MACEL,EAAK,QACLC,EAAO,MACPK,EAAK,UACLP,EAAS,gBACTQ,EAAe,MACfC,IASF,mBAAEC,GAAyD,CAAC,G,0CAE5D,MAAMC,EAAiB7xJ,QAAQ+d,IAC7B0zI,EAAM54J,KAAW47I,GAAY,mCAK3B,MAJuB,iBAAZA,IACTA,EAAU,CAAEliD,KAAMkiD,IAGhByb,EACK9C,OAAO+C,UAAUqB,UAAU,CAChCr0J,OAAQ,CACNg0J,QACAW,SAAUP,EAAiBH,GAC3BF,eAAuBl0J,IAAZo0J,EAAwBF,OAAYl0J,GAEjDy0J,MAAO,SAAUhd,EAAU,CAACA,EAAQliD,WAAQv1F,EAC5C+0J,IAAK,SAAUtd,EAAUA,EAAQr2H,UAAOphB,IAIrC+yJ,EAAYiC,KAAKR,UAAUL,EAAO,OAAF,wBAClC1c,GAAO,CACVid,kBACAR,YACAE,UACAO,MAAOA,QAAAA,EAAS,mBAEpB,OAGEC,QACIK,EAA2BJ,SAE3BA,CAEV,G,CACA,SAASK,EAAaT,GACpB,GAAIA,EAAMjsG,MAAMivF,GAAY,SAAUA,IACpC,MAAM,IAAI7/I,MAAM,gEAEpB,CAEA,SAAeu9J,GACb,MACEhB,EAAK,QACLC,EAAO,MACPK,EAAK,UACLP,EAAS,gBACTQ,EAAe,MACfC,IASF,mBAAEC,GAAyD,CAAC,G,0CAE5D,MAAMQ,EAAkBX,EAAM54J,KAAK05F,GAA0B,iBAATA,EAAoB,CAAEA,QAASA,IAEnF,GAAI29D,EAAc,CAChBgC,EAAaE,GACb,MAAMC,EAAYjF,OAAO+C,UAAUgC,cAAc,CAC/Ch1J,OAAQ,CACNg0J,QACAW,SAAUP,EAAiBH,GAC3BF,eAAuBl0J,IAAZo0J,EAAwBF,OAAYl0J,GAEjDy0J,MAAOW,EAAgBv5J,KAAI,EAAG05F,UAA6BA,MAS7D,YANIq/D,QACIK,EAA2BI,SAE3BA,E,CAMV,MAAMC,EAAa,GACnB,IAAK,MAAM7d,KAAW2d,EAChB,SAAU3d,UACN6d,EAAWpkI,IAAI,IAGvBokI,EAAWtjJ,KACT+gJ,EAAYiC,KAAKG,cAAchB,EAAO,OAAF,wBAC/B1c,GAAO,CACVid,kBACAR,YACAE,UACAO,YAKFC,QACIK,EAA2BjyJ,QAAQ+d,IAAIu0I,UAEvCtyJ,QAAQ+d,IAAIu0I,EAEtB,G,CAEA,SAAeC,EACbC,EACAC,EAMA3sJ,EAAU,CAAC,G,0CAEX,MAAM4sJ,EAAUrB,EAAUmB,SACpBxyJ,QAAQ+d,IACZ20I,EAAQ75J,KAAWsE,GAAU,mCAC3B,OAAAw1J,EAAoC1B,EAAoB9zJ,GAASs1J,EAAS3sJ,EAAQ,MAGxF,G,CAEA,SAAe6sJ,GACb,QAAEvB,EAAO,MAAED,EAAK,UAAED,GAClBuB,EAMA3sJ,EAAU,CAAC,G,0CAEX,MAAM8sJ,EAAavB,EAAUoB,GAASI,SAASC,I,gBAAW,OACxDtB,EACE,CACEL,QACAC,UACAF,YACAO,MAAiB,QAAV,EAAAqB,EAAOf,WAAG,QAAI,GACrBL,gBAAuC,QAAtB,EAAAoB,EAAOpB,uBAAe,QAAIoB,EAAOC,kBAClDpB,MAAmB,QAAZ,EAAAmB,EAAOnB,aAAK,QAAImB,EAAOE,QAEhCltJ,GAEFqsJ,EACE,CACEhB,QACAC,UACAF,YACAO,MAAgB,QAAT,EAAAqB,EAAOG,UAAE,QAAI,GACpBvB,gBAAuC,QAAtB,EAAAoB,EAAOpB,uBAAe,QAAIoB,EAAOC,kBAClDpB,MAAmB,QAAZ,EAAAmB,EAAOnB,aAAK,QAAImB,EAAOE,QAEhCltJ,GAEH,UACK9F,QAAQ+d,IAAI60I,EACpB,G,CAEA,SAAeX,EAA2BhqG,G,0CACxC,UACQA,C,CACN,MAAOtzD,GAGP,IADE,2GACgBgG,KAAKhG,aAAK,EAALA,EAAOT,SAC5B,MAAMS,C,CAGZ,G,CAEA,SAAeu+J,EAAkB73J,G,0CAC/B,OAAO00J,EAAYtrI,YAAY0uI,SAAS,CACtCC,QAAS,CAAC,IAAInyJ,IAAI5F,GAAKo8D,OAAS,OAEpC,G,CAEA,MAAO,CACLq4F,EACA/7H,IACG,mCACH,MAAM,GACJk/H,EAAK,GAAE,IACPlB,EAAM,GAAE,gBACRL,EAAe,QACf2B,EAAU,GAAE,eACZC,EAAc,MACd3B,GACE7B,EACJ,IAAI,UAAEoB,GAAcpB,EAUpB,GARIM,EACFc,GAAY,EACHA,GACTvgJ,EAAWlc,QACT,0JAImB,IAAnB4+J,EAAQx8J,OACV,MAAM,IAAIjC,MACR,4JAIEoL,QAAQ+d,IACZs1I,EAAQx6J,KAAW06J,GAAoB,mCACrC,WAAYxD,EAAYtrI,YAAY0uI,SAAS,CAAEC,QAAS,CAACG,MACvD,MAAM,IAAI3+J,MAAM,sDAAsD2+J,IAE1E,OAGF,MAAMC,EAAezC,KAAkBsC,GACjCI,EAAsB1C,KACtBuC,QAAuDA,EAAiB,IAExEI,EAAS,CAAOr4J,EAAa81J,EAAeC,EAAU,IAAM,mCAE7DoC,EAAa74J,KAAKU,KACnBo4J,EAAoB94J,KAAKU,WACjB63J,EAAkB73J,YAKtBk3J,EACJ,CAAEpB,QAAOC,WACT,CAAEW,MAAKkB,KAAIvB,kBAAiBC,SAC5B,CAAEC,oBAAoB,IAE1B,IACM+B,EAAc,CAClBxC,GACE77I,WACAja,SACC,mCACY,YAAXia,GAAwBja,GACrBq4J,EAAOr4J,EAAK81J,EAErB,IACMyC,EAAc,EAClBzC,QACAC,UACA/1J,SACiE,mCAC5Dq4J,EAAOr4J,EAAK81J,EAAOC,EAC1B,IAEIhB,EACF,GAAWyD,YAAYzG,OAAO0G,cAAcC,YAAaH,GAEzD,GAAWC,YAAYzG,OAAO4E,KAAKgC,UAAWL,GAGhD,MAAMM,EAA0B,CACxB,UAAAC,G,0CACA9D,EACFhD,OAAO0G,cAAcC,YAAYI,eAAeP,GAEhDxG,OAAO4E,KAAKgC,UAAUG,eAAeR,EAEzC,G,GAOF,MAJwB,mBAAb5/H,GACTA,EAASkgI,GAGJA,CACT,GACF,CAvZ6BG,IAGpBxE,GAAuBE,EAAsB/7H,EACtD,G,4SCtBO,MAAM,GAUX,0BAAWsgI,GACT,OAAOjH,OAAO3C,QAAQ0D,cAAcmG,gBACtC,CAOA,wBAAO3F,CAAkB4F,GACvB,OAAO,GAAWF,kBAAoBE,CACxC,CAOA,gBAAaC,CAAUC,G,0CACrB,OAAKA,QAIQ,GAAWC,cAAcD,GAH7B,GAAWE,kBAItB,G,CAKA,uBAAaA,G,0CACX,OAAO,IAAI30J,SAASC,GAAYmtJ,OAAOwH,QAAQC,WAAW,CAAEC,UAAU,GAAQ70J,IAChF,G,CAOA,oBAAay0J,CAAcD,G,0CACzB,OAAO,IAAIz0J,SAASC,GAAYmtJ,OAAOwH,QAAQvmJ,IAAIomJ,EAAU,CAAEK,UAAU,GAAQ70J,IACnF,G,CAEA,mBAAa80J,CAAajvJ,G,0CACxB,OAAO,IAAI9F,SAASC,GAClBmtJ,OAAOwH,QAAQtyJ,OAAOwD,GAAUhQ,IAC9BmK,EAAQnK,EAAO,KAGrB,G,CAOA,mBAAak/J,CAAaP,G,0CACxB,OAAO,IAAIz0J,SAASC,GAAYmtJ,OAAOwH,QAAQ7kJ,OAAO0kJ,GAAU,IAAMx0J,OACxE,G,CAQA,6BAAag1J,CACXR,EACA3uJ,G,0CAEA,OAAO,IAAI9F,SAASC,GAClBmtJ,OAAOwH,QAAQ9lJ,OAAO2lJ,EAAU3uJ,GAAS,KACvC7F,GAAS,KAGf,G,CAOA,kBAAai1J,CAAYT,G,gDACjB,GAAWQ,uBAAuBR,EAAU,CAAEU,SAAS,GAC/D,G,CAEA,gCAAaC,G,0CACX,aAAa,GAAWC,eAAe,CACrCC,QAAQ,EACRb,SAAUrH,OAAOwH,QAAQW,mBAE7B,G,CAOA,aAAaC,CAAOrE,G,0CAClB,OAAKA,EAID,GAAWxC,kBAAkB,SAClBvB,OAAO4E,KAAK3jJ,IAAI8iJ,GAGxB,IAAInxJ,SAASC,GAClBmtJ,OAAO4E,KAAK3jJ,IAAI8iJ,GAAQl/F,IACtBhyD,EAAQgyD,EAAI,MATP,IAYX,G,CAEA,8BAAawjG,G,0CACX,aAAa,GAAWJ,eAAe,CACrCC,QAAQ,EACRI,eAAe,GAEnB,G,CAEA,oBAAaC,G,0CACX,aAAa,GAAWC,UAAU,CAChCN,QAAQ,GAEZ,G,CAEA,gBAAaM,CAAU9vJ,G,0CACrB,OAAO,IAAI9F,SAASC,IAClBmtJ,OAAO4E,KAAK1pD,MAAMxiG,GAAUksJ,IAC1B/xJ,EAAQ+xJ,EAAK,GACb,GAEN,G,CAEA,qBAAaqD,CAAevvJ,G,0CAC1B,MAAMksJ,QAAa,GAAW4D,UAAU9vJ,GACxC,OAAIksJ,EAAKn7J,OAAS,EACTm7J,EAAK,GAGP,IACT,G,CAEA,yBAAO6D,CACL5jG,EACA9gB,EACAvqC,EAAY,MAEZ,MAAM7J,EAAW,CACfo0C,QAASA,GAOX,OAJY,MAARvqC,IACF7J,EAAI6J,KAAOA,GAGN,GAAWkvJ,eAAe7jG,EAAKl1D,EACxC,CAEA,qBAAa+4J,CACX7jG,EACAl1D,EACA+I,EAA0C,M,0CAE1C,GAAKmsD,GAAQA,EAAIz3D,GAIjB,OAAO,IAAIwF,SAAeC,IACxBmtJ,OAAO4E,KAAK+D,YAAY9jG,EAAIz3D,GAAIuC,EAAK+I,GAAS,KACxCsnJ,OAAO3C,QAAQ8F,UAGnBtwJ,GAAS,GACT,GAEN,G,CAEA,sBAAO+1J,CACL7E,EACAj9J,EACA4R,EACAmwJ,GAEA7I,OAAO4E,KAAK+D,YAA2B5E,EAAOj9J,EAAS4R,EAASmwJ,EAClE,CAEA,sBAAaC,CAAgBniI,G,0CAI3B,OAAOq5H,OAAOwH,QAAQuB,UAAUtC,YAAY9/H,EAC9C,G,CAOA,wBAAOqiI,GACL,YAAkD,IAAvChJ,OAAO3F,UAAU2O,kBACnB,KAGFhJ,OAAO3F,UAAU2O,mBAC1B,CAQA,uBAAOC,CAAiBvgK,GACtB,YAAyB,IAAXA,GAA0BA,IAAW,GAAWsgK,mBAChE,CASA,wBAAOE,CAAkBC,GACvB,YAAyC,IAA9BnJ,OAAO3F,UAAU+O,SACnB,GAGFpJ,OAAO3F,UAAU+O,SAASD,EACnC,CAMA,kBAAa3I,G,0CACX,OAAO5tJ,QAAQC,QAAQ,GAAWq2J,kBAAkB,CAAE50J,KAAM,UAAW7K,OAAS,EAClF,G,CAEA,mBAAOk3J,CAAa1yJ,EAAai6J,GAAS,GACxC,OAAO,IAAIt1J,SAASC,GAClBmtJ,OAAO4E,KAAK1vJ,OAAO,CAAEjH,IAAKA,EAAKi6J,OAAQA,IAAWrjG,GAAQhyD,EAAQgyD,MAEtE,CASA,sBAAOwkG,CACL7gK,EACAm+B,GAMA,GAAW8/H,YAAYzG,OAAO3C,QAAQiM,UAAW3iI,EACnD,CAEA,uBAAO4iI,GACL,OAAO,IAAIC,GAAA,GAAqBC,IAC9B,MAAMC,EAAW5iK,IACf2iK,EAAW5zI,KAAK/uB,EAAQ,EAK1B,OAFA,GAAW2/J,YAAYzG,OAAO3C,QAAQiM,UAAWI,GAE1C,IAAM,GAAW3C,eAAe/G,OAAO3C,QAAQiM,UAAWI,EAAQ,GAE7E,CAEA,4BAAOC,CACLhjI,GAEA,GAAW8/H,YAAYzG,OAAOhuE,QAAQ43E,UAAWjjI,EACnD,CAWA,kBAAO8/H,CACLtkJ,EACAwkB,GAEAxkB,EAAMskJ,YAAY9/H,GAEd,GAAWu2H,cAAgB,GAAW+L,iBAAiB/gK,QACzD,GAAW2hK,4BAA4BjoJ,KAAK,CAACO,EAAOwkB,IACpD,GAAWmjI,uBAEf,CAOA,qBAAO/C,CACL5kJ,EACAwkB,GAIA,GAFAxkB,EAAM4kJ,eAAepgI,GAEjB,GAAWu2H,cAAgB,GAAW+L,iBAAiB/gK,MAAO,CAChE,MAAMkzG,EAAQ,GAAWyuD,4BAA4B9nJ,WAAU,EAAEgoJ,EAAQC,KAChEA,GAAiBrjI,KAEX,IAAXy0E,GACF,GAAWyuD,4BAA4Bt1D,OAAO6G,EAAO,E,CAG3D,CAGQ,2BAAO0uD,GAGb5hK,KAAK+hK,iBAAiB,YAAY,KAChC,IAAK,MAAO9nJ,EAAOwkB,KAAa,GAAWkjI,4BACzC1nJ,EAAM4kJ,eAAepgI,E,GAG3B,CAEA,kBAAOgiI,CAAYc,EAAoBS,EAAW,CAAC,GACjD,MAAMpjK,EAAUmJ,OAAOH,OAAO,CAAC,EAAG,CAAEi0C,QAAS0lH,GAAcS,GAC3D,OAAOlK,OAAO3C,QAAQsL,YAAY7hK,EACpC,CAEA,8BAAO25J,CAAmCgJ,EAAoBS,EAAW,CAAC,GACxE,MAAMpjK,EAAUmJ,OAAOH,OAAO,CAAC,EAAG,CAAEi0C,QAAS0lH,GAAcS,GAC3D,OAAO,IAAIt3J,SAAoBC,GAAYmtJ,OAAO3C,QAAQsL,YAAY7hK,EAAS+L,IACjF,CAEA,eAAas3J,CAASpG,G,0CAGpB/D,OAAO4E,KAAKljJ,OAAOqiJ,EAAO,CAAEmE,QAAQ,EAAMkC,aAAa,GACzD,G,CAEA,iBAAOC,CAAWl4J,GACZ,GAAWm4J,oBAAsB,GAAWC,mBAM9CtqJ,QAAQ2kJ,KAAKljJ,OAAO,CAAEwmJ,QAAQ,IAAQsC,QAAQr4J,EAAI21D,OAElD31D,EAAI21D,OAER,CAEA,eAAO2iG,GACL,OAAO,CACT,CAEA,oBAAOC,GACL,OAAO1K,OAAO2K,KAAKD,eACrB,CAQA,sBAAOE,CAAgB99E,G,MAGrB,MAA+C,mBAAb,QAAvB,EAAAA,aAAa,EAAbA,EAAerrE,gBAAQ,eAAEopJ,QAC1B/9E,EAAsBrrE,SAASopJ,QAAO,GAGzC7K,OAAO3C,QAAQwN,QACxB,CAQA,wBAAOC,CAAkBC,GAAoB,GAC3C,MAAMvrC,EAAQ,GAAW0pC,oBACzB,IAAK1pC,EAAM/1H,OACT,OAGF,MAAMuhK,EAAc9iK,KAAKuZ,SAASwpJ,KAClCzrC,EACG94H,QAAQ87I,GAAyB,MAAnBA,EAAE/gI,SAASwpJ,OAAiBzoB,EAAE/gI,SAASwpJ,KAAK/zH,SAAS,qBACnExwC,QAAQ87I,IAAOuoB,GAAqBvoB,EAAE/gI,SAASwpJ,OAASD,IACxDp8J,SAAS4zI,GAAMA,EAAE/gI,SAASopJ,UAC/B,CAEA,oBAAOK,CAAcC,GACnB,OAAI,GAAWb,mBACNrqJ,QAAQo9I,QAAQ6N,cAAcC,GAC5B,GAAWC,YACbpL,OAAO3C,QAAQ6N,cAAcC,QAD/B,CAGT,CAEA,wBAAOE,CAAkBC,GACvB,OAAI,GAAWhB,mBACNrqJ,QAAQoX,YAAYuI,QAAQ0rI,GAE9B,IAAI14J,SAASC,IAClBmtJ,OAAO3oI,YAAYuI,QAAQ0rI,EAAYz4J,EAAQ,GAEnD,CAOA,yBAAa04J,CAAmBl0I,G,0CAC9B,OAAO,IAAIzkB,SAASC,GAClBmtJ,OAAO3oI,YAAY0uI,SAAS,CAAE1uI,gBAAgBsU,GAAW94B,EAAQ84B,MAErE,G,CAEA,sBAAOk2H,GACL,OAAI,GAAWyI,mBACNrqJ,QAAQo9I,QAAQwE,kBAElB,IAAIjvJ,SAASC,IAClBmtJ,OAAO3C,QAAQwE,gBAAgBhvJ,EAAQ,GAE3C,CAKA,uBAAO24J,GACL,OAAO,GAAWjK,kBAAkB,GAAKvB,OAAO/hD,OAAS+hD,OAAOyL,aAClE,CAEA,uBAAOC,CACLv5J,G,MAEA,MAAMiY,EAAa00I,GAA4Bz1I,UAAUlX,GACzD,OAAIiY,IAAeW,GAAWq0I,kBAAoBh1I,IAAeW,GAAWu0I,eACnE,MAEK,QAAP,EAAAntJ,EAAI8tJ,WAAG,eAAE0L,gBAAiB1rJ,QAAQ0rJ,aAC3C,CAEA,wBAAOC,GACL,OAAO,IAAIh5J,SAASC,IAClBmtJ,OAAO4E,KAAKgH,kBAAkB,KAAM,CAAElS,OAAQ,OAAS7mJ,EAAQ,GAEnE,CAUA,yBAAOg5J,CACL9H,EACAnoE,EACAkwE,GAIA,OAAI,GAAWvK,kBAAkB,GACxBvB,OAAO+C,UAAUgC,cAAc,CACpCh1J,OAAQ,CACNg0J,MAAOA,EACPD,UAAWloE,EAAQkoE,UACnBY,SAAU9oE,EAAQooE,QAAU,CAACpoE,EAAQooE,SAAW,MAElDK,MAAOzoE,EAAQuJ,KAAO,CAACvJ,EAAQuJ,MAAQ,KACvC4mE,kBAAqC,mBAAlBnwE,EAAQ2oE,MAC3ByH,OAAOF,aAAmB,EAAnBA,EAAqBE,QAAS,aAIlC,IAAIp5J,SAASC,IAClBmtJ,OAAO4E,KAAKG,cAAchB,EAAOnoE,GAAUjwD,IACzC94B,EAAQ84B,EAAO,GACf,GAEN,CAKA,wCAAasgI,G,0CACX,MAAMC,EAAuBtwE,GACA,iCAA3BA,EAAQuwE,iBAAsDvwE,EAAQ9kF,MAElEs1J,QAA2C,IAAIx5J,SAASC,GAC5DmtJ,OAAOqM,QAAQC,SAASC,uBAAuBtrJ,IAAI,CAAC,GAAI26E,GACtD/oF,EAAQq5J,EAAoBtwE,QAI1B4wE,QAA8C,IAAI55J,SAASC,GAC/DmtJ,OAAOqM,QAAQC,SAASG,0BAA0BxrJ,IAAI,CAAC,GAAI26E,GACzD/oF,EAAQq5J,EAAoBtwE,QAI1B8wE,QAA0C,IAAI95J,SAASC,GAC3DmtJ,OAAOqM,QAAQC,SAASK,sBAAsB1rJ,IAAI,CAAC,GAAI26E,GACrD/oF,EAAQq5J,EAAoBtwE,QAIhC,OAAOwwE,GAA6BI,GAAgCE,CACtE,G,CAOA,2CAAOE,CAAqC91J,GAC1CkpJ,OAAOqM,QAAQC,SAASC,uBAAuBx9J,IAAI,CAAE+H,UACrDkpJ,OAAOqM,QAAQC,SAASG,0BAA0B19J,IAAI,CAAE+H,UACxDkpJ,OAAOqM,QAAQC,SAASK,sBAAsB59J,IAAI,CAAE+H,SACtD,CAOA,gCAAa+1J,CACXnK,G,gDAEA,MAAuB,oBAAZziJ,UAAmD,QAAtB,EAAAA,QAAQ6sJ,sBAAc,eAAEC,gBACjD9sJ,QAAQ6sJ,eAAeC,SAASrK,SAGlCD,GAA+BC,E,IAQ9C,gCAAasK,CACX3H,G,gDAEMrF,OAAO+C,UAAUP,uBAAuB6C,EAChD,G,CAOA,kCAAa4H,CACXvmK,G,gDAEMs5J,OAAO+C,UAAUmK,yBAAyBxmK,EAClD,G,EAzkBO,GAAA4jK,mBAAiD,oBAAZrqJ,QACrC,GAAAi9I,aACwC,IAA7C7qJ,UAAUC,UAAUzE,QAAQ,cACiB,IAA7CwE,UAAUC,UAAUzE,QAAQ,cACmB,IAA/CwE,UAAUC,UAAUzE,QAAQ,cACvB,GAAAu9J,aAAwB,GAAWlO,aAAiC,oBAAX8C,OACzD,GAAAuK,oBACwC,IAA7Cl4J,UAAUC,UAAUzE,QAAQ,cAAkE,IAA5CwE,UAAUC,UAAUzE,QAAQ,WA0PjE,GAAAg8J,4BAGT,GCzQO,MAAMsD,GAGnB,WAAA3mK,CAAoB4mK,GAAA,KAAAA,0BAAAA,EAClBpmK,KAAKqmK,aAAerN,OAAOqN,YAC7B,CAEA,IAAAllK,GACOnB,KAAKqmK,eAIVrmK,KAAKqmK,aAAaC,UAAU7G,aAAY,CAACt/J,EAAM09D,IAC7C79D,KAAKomK,0BAA0B3iF,IAAItjF,EAAM09D,KAG3C,GAAWwkG,gBACT,2BACA,CACEvlH,EACAypH,KAEoB,oBAAhBzpH,EAAIC,SAAqD,4BAApBD,EAAItqC,KAAKzJ,QAGhD/I,KAAKomK,0BACFI,aACC1pH,EAAItqC,KAAKi0J,eAAe3mK,QAAQ4mK,uBAChC5pH,EAAItqC,KAAKi0J,eAAeF,OAAO1oG,KAEhCr0C,MAAK,KAGJ,GAAWi4I,mBAAmB8E,EAAO1oG,IAAK,uBAAuB,G,IAK7E,E,2SCvCF,MAAM,GAMJ,gBAAO8oG,CAAUx7J,GACf,OAAO,GAAkBy7J,wBAAwBz7J,EAAK,aAAc,UACtE,CAOA,eAAO07J,CAAS17J,GACd,OAAO,GAAkBy7J,wBAAwBz7J,EAAK,aAAc,SACtE,CAQA,2BAAO27J,CAAqB37J,EAAa47J,GACvC,OAAO,GAAkBH,wBAAwBz7J,EAAK,qBAAsB47J,EAC9E,CAOA,cAAOC,CAAQ77J,GACb,OACgD,IAA9CA,EAAIsP,SAASwpJ,KAAKp9J,QAAQ,gBAC1BsE,EAAIsP,SAASwpJ,KAAKp9J,QAAQ,qBAAuB,CAErD,CAQA,wBAAOogK,CAAkB97J,EAAa+7J,EAAqB,QAEzD,OADgB/7J,EAAIisJ,SAAS+P,qBAAqBD,GAAoB,GACvDE,SACjB,CASA,wBAAaC,CACXl8J,EACAm8J,EACA51J,EAAyB,CACvBhG,MAAO,EACP67J,kBAAmB,S,0CAGrB,MAAM,MAAE77J,EAAK,kBAAE67J,GAAsB71J,EACrC,OAAO,IAAI9F,SAAeC,GACxBV,EAAIW,YAAW,KACb,MAAM07J,EAAYr8J,EAAIisJ,SAAS7pB,cAAcg6B,IACxCj+J,MAAMg+J,IAAkBE,IAC3BA,EAAUJ,UAAYE,GAGxBz7J,GAAS,GACRH,IAEP,G,CAKA,uCAAO+7J,GACL,OAAQ,GAAWzF,mBACrB,CAQA,iBAAa0F,CACXC,EACAj2J,EAKI,CAAC,G,0CAEL,MAAM,eAAEk2J,EAAc,gBAAEC,EAAe,0BAAEC,EAAyB,cAAEC,GAAkBr2J,EAChFs2J,EAAwD,CAC5D16J,KAAM,QACNyzJ,SAAS,EACTn0C,MAAO,IACPq7C,OAAQ,KAIJC,EAAaF,EAA2Bp7C,MACxCu7C,QAAqB,GAAW/H,UAAUwH,GAC1CQ,EAAsB,OAAH,oCACvBC,KAAMF,EAAaE,KAAOF,EAAav7C,MAAQs7C,EAL7B,GAMlBI,IAAKH,EAAaG,IALF,IAMbN,GACAD,GAAa,CAChB9gK,IAAK,GAAkBshK,eAAeZ,EAAkBE,KAG1D,WACS,GAAkBW,yBACvBX,EACAO,EACAN,KAEDA,EAKH,aAAa,GAAWnH,aAAayH,EACvC,G,CAQA,8BAAaK,CAAwB1B,EAAmB2B,EAAa,G,0CACnE,MAAMC,EAAe3P,OAAO3C,QAAQuS,OAAO,oBACrChL,QAAa,GAAW4D,UAAU,CAAEv6J,IAAK,GAAG0hK,OAClD,IAAK,MAAM9qG,KAAO+/F,EACX//F,EAAI52D,IAAIipC,SAAS,sBAAsB62H,MAI5Cj7J,YAAW,IAAM,GAAW80J,aAAa/iG,EAAIwiG,WAAWqI,EAE5D,G,CAUA,4BAAaG,CAAsB19J,EAAa84J,EAAe,M,0CAC7D,MAAM6E,EAAY7E,GAAQ94J,EAAIsP,SAASwpJ,KACjC8E,EAAY,IAAIl8J,IAAIi8J,GAC1B,IAAIE,EAAYD,EAAU5+J,KACtB6+J,EAAUpiK,WAAW,oBACvBoiK,EAAY,sBAGR,GAAkBtB,WAAW,GAAGqB,EAAUtM,WAAWuM,KAEvD,GAAkBhC,QAAQ77J,IAC5B,GAAWk4J,WAAWl4J,EAE1B,G,CAWQ,+BAAaq9J,CACnBzB,EACAkC,EACAnB,GAA4B,G,0CAE5B,IAAKf,EACH,OAAO,EAGT,MAAM4B,EAAe3P,OAAO3C,QAAQuS,OAAO,oBACrCM,SAAoB,GAAW1H,UAAU,CAAEv6J,IAAK,GAAG0hK,QAAoBjpK,QAAQm+D,GACnFA,EAAI52D,IAAIipC,SAAS,sBAAsB62H,OAEzC,GAA0B,IAAtBmC,EAAWzmK,OACb,OAAO,EAGT,IAAKqlK,EAA2B,CAE9B,MAAMjqG,EAAMqrG,EAAWC,cACjB,GAAWtI,uBAAuBhjG,EAAIwiG,SAAU,CACpDU,SAAS,EACTn0C,MAAOq8C,EAAWr8C,MAClBq7C,OAAQgB,EAAWhB,OACnBK,IAAKW,EAAWX,IAChBD,KAAMY,EAAWZ,M,CAMrB,OAFAa,EAAWthK,SAASi2D,GAAQ,GAAW+iG,aAAa/iG,EAAIwiG,aAEjD,CACT,G,CASQ,8BAAOuG,CACbz7J,EACAi+J,EACAC,GAEA,OAAOl+J,EAAIsP,SAASwpJ,KAAKp9J,QAAQ,GAAGuiK,KAAeC,MAAkB,CACvE,CASQ,qBAAOd,CAAeZ,EAA0BE,GACtD,MAAMkB,EAAY,IAAIl8J,IAAImsJ,OAAO3C,QAAQuS,OAAOjB,IAOhD,OANAoB,EAAU7hG,aAAan/D,IAAI,aAAc,UAErC8/J,GACFkB,EAAU7hG,aAAan/D,IAAI,qBAAsB8/J,GAG5CkB,EAAUtlK,UACnB,EAGF,U,uSC9PA,MAAM6lK,GACa,uBADbA,GAEW,qBAFXA,GAGW,qBAEXC,GAAsB,IAAIr8J,IAAI,CAClC8rJ,OAAO3C,QAAQuS,OAAO,0BACtB5P,OAAO3C,QAAQuS,OAAO,4BASxB,SAAeY,GAAiBC,EAA4BC,GAAmB,G,iDACtC,GAAWlI,UAAU,CAAEmI,WAAY,WACjD/hK,SAASi2D,IAC5B0rG,GAAoBz4G,IAAI+M,EAAI52D,MAG9B,GAAW25J,aAAa/iG,EAAIwiG,S,UAI1B,GAAkBqH,WAAW,mBAAoB,CACrDG,gBAAiByB,GACjB1B,eAAgB6B,EAAUpJ,iBAEtB,GAAWoB,mBAAmBgI,EAAW,uBAAwB,CAAEC,oBAC3E,G,4SC7BA,MAAME,GAAkB,CACtBC,cAAe,sBACfC,iBAAkB,yBAClBC,YAAa,qBASf,SAAeC,GACbP,EACAzoG,G,0CAMA,MAAM,SAAErB,EAAQ,OAAEs3C,EAAM,0BAAE6wD,GAA8B9mG,EACxD,IAAIipG,EAAmB,gCACnBC,EAAkB,IACtB,MAAMC,EAAoB,CAACh6J,EAAaL,KACtC,MAAMs6J,EAAc,GAAGF,IAAkB/5J,KAAOL,IAEhD,OADAo6J,EAAkB,IACXE,CAAW,EAGhBzqG,IACFsqG,GAAoBE,EAAkB,WAAYxqG,IAEhD8pG,EAAUrjK,KACZ6jK,GAAoBE,EAAkB,cAAevmK,OAAO6lK,EAAUrjK,MAEpE6wG,IACFgzD,GAAoBE,EAAkB,SAAUlzD,UAG5C,GAAkBywD,WAAWuC,EAAkB,CACnDpC,gBAAiB,GAAG+B,GAAgBC,iBAAiBlqG,IACrDioG,eAAgB6B,EAAUpJ,SAC1ByH,6BAEJ,G,CAmBA,SAAeuC,GACbZ,EACAzoG,G,gDAKMgpG,GAAwBP,EAAW,OAAF,QACrC3B,2BAA2B,GACxB9mG,UAEC,GAAWygG,mBAAmBgI,EAAW,kCACjD,G,CAQA,SAAea,GACbb,EACAzoG,EAAgE,CAAC,G,0CAEjE,MAAM,SAAErB,EAAQ,WAAE4qG,GAAevpG,GAC3B,IAAE/5D,EAAG,SAAEo5J,GAAaoJ,EAC1B,IAAI5B,EAAkB+B,GAAgBE,iBAClCU,EAAmB,gCACnBN,EAAkB,IACtB,MAAMC,EAAoB,CAACh6J,EAAaL,KACtC,MAAMs6J,EAAc,GAAGF,IAAkB/5J,KAAOL,IAEhD,OADAo6J,EAAkB,IACXE,CAAW,EAGhBzqG,IAAa4qG,IACf1C,GAAmB,IAAIloG,IACvB6qG,GAAoBL,EAAkB,WAAYxqG,IAEhD4qG,IAAe5qG,IACjBkoG,GAAmB,IAAI0C,IACvBC,GAAoBL,EAAkB,OAAQvmK,OAAO2mK,KAEnDd,EAAUxiK,MACZujK,GAAoBL,EAAkB,MAAOljK,UAGzC,GAAkBygK,WAAW8C,EAAkB,CACnD3C,kBACAD,eAAgBvH,GAEpB,G,CCvHA,MAAMoK,GACM,MADNA,GAEY,SAFZA,GAGS,SAHTA,GAImB,kB,2SCwCV,MAAMC,GA4BnB,WAAAlrK,CACUmrK,EACAntG,EACAoG,EACA5rC,EACAmtG,EACAzoH,EACAkuJ,EACA9mG,EACAnhB,EACApmC,EACAsuJ,EACAlnG,GAXA,KAAAgnG,gBAAAA,EACA,KAAAntG,cAAAA,EACA,KAAAoG,YAAAA,EACA,KAAA5rC,cAAAA,EACA,KAAAmtG,cAAAA,EACA,KAAAzoH,aAAAA,EACA,KAAAkuJ,gCAAAA,EACA,KAAA9mG,sBAAAA,EACA,KAAAnhB,mBAAAA,EACA,KAAApmC,WAAAA,EACA,KAAAsuJ,kBAAAA,EACA,KAAAlnG,cAAAA,EAvCF,KAAA6lG,iBAAmBA,GACnB,KAAAc,2BAA6BA,GAC7B,KAAAQ,kBAAoD,GAC3C,KAAAC,yBAA2E,CAC1FC,gBAAiB,EAAGlrK,UAASymK,YAAavmK,KAAKirK,sBAAsBnrK,EAASymK,GAC9E2E,gBAAiB,IAAMlrK,KAAKmrK,gBAC5BC,uBAAwB,EAAG7E,YAAavmK,KAAKqrK,kCAAkC9E,GAC/E+E,wBAAyB,EAAGxrK,UAASymK,YACnCvmK,KAAKurK,mCAAmCzrK,EAASymK,GACnDiF,WAAY,EAAG1rK,UAASymK,YAAavmK,KAAKyrK,SAAS3rK,EAASymK,GAC5DmF,kBAAmB,EAAG5rK,UAASymK,YAAavmK,KAAK2rK,gBAAgB7rK,EAASymK,GAC1EqF,iCAAkC,EAAGrF,YACnCvmK,KAAK6rK,+BAA+BtF,EAAO1oG,KAC7CiuG,aAAc,EAAGhsK,UAASymK,YAAavmK,KAAK+rK,wBAAwBjsK,EAASymK,GAC7EyF,YAAa,EAAGzF,YAAavmK,KAAKisK,UAAU1F,EAAO1oG,KACnDquG,2BAA4B,EAAGpsK,aAC7BE,KAAKmsK,wCAAwCrsK,GAC/CssK,qBAAsB,EAAGtsK,UAASymK,YAAavmK,KAAKqsK,YAAYvsK,EAASymK,EAAO1oG,KAChFyuG,uBAAwB,EAAG/F,YAAavmK,KAAKssK,uBAAuB/F,EAAO1oG,KAC3E0uG,qBAAsB,EAAGhG,YAAavmK,KAAKwpK,iBAAiBjD,EAAO1oG,KACnE2uG,iCAAkC,IAAMxsK,KAAKysK,iCAC7CC,4BAA6B,IAAM1sK,KAAK2sK,4BACxCC,qBAAsB,IAAM5sK,KAAK6sK,qBACjCC,4BAA6B,IAAM9sK,KAAK+sK,4BACxCC,8BAA+B,IAAMhtK,KAAKitK,kBA0rBpC,KAAAC,uBAAyB,CAC/BptK,EACAymK,EACA11C,KAEA,MAAM6xC,EAAwC1iK,KAAK+qK,yBAAyBjrK,aAAO,EAAPA,EAASi9C,SACrF,IAAK2lH,EACH,OAGF,MAAMyK,EAAkBzK,EAAQ,CAAE5iK,UAASymK,WAC3C,OAAK4G,GAILvhK,QAAQC,QAAQshK,GACb3jJ,MAAM9b,GAAamjH,EAAanjH,KAChCoxC,OAAOv+C,GAAUP,KAAKuc,WAAWhc,MAAMA,MACnC,QAPP,CAOW,CA5rBV,CAEG,IAAAY,G,0CACkB,MAAlB63J,OAAO3C,UAIXr2J,KAAKotK,gCAELptK,KAAKqtK,2BACP,G,CAKM,8BAAAZ,G,0CACJ,aAAa,OAAezsK,KAAK4qK,gCAAgCryH,6BACnE,G,CAKM,yBAAAo0H,G,0CACJ,aAAa,OAAe3sK,KAAK4qK,gCAAgCvyH,wBACnE,G,CAKM,kBAAAw0H,G,0CACJ,aAAa,OAAe7sK,KAAK8jE,sBAAsB3sB,cACzD,G,CAKM,yBAAA41H,G,0CACJ,aAAa,OAAe/sK,KAAK2jE,cAAc3gB,cACjD,G,CAQM,sBAAAspH,CAAuBzuG,EAAuB,M,0CAClD,GAAsC,IAAlC79D,KAAK8qK,kBAAkBroK,OACzB,OAGF,GAAW,MAAPo7D,EAEF,kBADM79D,KAAKstK,yBAAyBzvG,IAItC,MAAM0vG,QAAmB,GAAWlM,0BAClB,MAAdkM,UACIvtK,KAAKstK,yBAAyBC,GAExC,G,CAEQ,wBAAAF,GACN,IAAK,IAAI3qK,EAAI1C,KAAK8qK,kBAAkBroK,OAAS,EAAGC,GAAK,EAAGA,IAClD1C,KAAK8qK,kBAAkBpoK,GAAG8qK,QAAU,IAAIhhK,OAC1C,GAAWi1J,mBAAmBzhK,KAAK8qK,kBAAkBpoK,GAAGm7D,IAAK,wBAAwB/e,OAClFv+C,GAAUP,KAAKuc,WAAWhc,MAAMA,KAEnCP,KAAK8qK,kBAAkBv9D,OAAO7qG,EAAG,IAGrCoJ,YAAW,IAAM9L,KAAKqtK,4BAA4B,IACpD,CAEc,wBAAAC,CAAyBzvG,G,0CACrC,MAAM4vG,EAAY,EAAMrmK,UAAUy2D,aAAG,EAAHA,EAAK52D,KACvC,IAAKwmK,EACH,OAGF,MAAMC,EAAe1tK,KAAK8qK,kBAAkB50I,MACzCp2B,GAAYA,EAAQ+9D,IAAIz3D,KAAOy3D,EAAIz3D,IAAMtG,EAAQ0H,SAAWimK,IAE3DC,UACI1tK,KAAK2tK,6BAA6B9vG,EAAK6vG,GAEjD,G,CAEc,4BAAAC,CACZ9vG,EACA+vG,G,0CAEA,MAAMC,EAAmBD,EAAyBtgK,KAE5CwgK,EAAgC,CACpCC,cAAeH,EAAyBI,eACxCr6F,YAAa,OAAe3zE,KAAK6qK,kBAAkB58E,iBAGrD,OAAQ4/E,GACN,KAAKpD,GACHqD,EAASG,4BAA8BjuK,KAAKiuK,wBAC5C,MACF,KAAKxD,GACHqD,EAASI,WACPN,EACAM,iBAIA,GAAWzM,mBAAmB5jG,EAAK,sBAAuB,CAC9DvwD,KAAMugK,EACNC,YAEJ,G,CAQQ,8BAAAjC,CAA+BhuG,GACrC,IAAK,IAAIn7D,EAAI1C,KAAK8qK,kBAAkBroK,OAAS,EAAGC,GAAK,EAAGA,IAClD1C,KAAK8qK,kBAAkBpoK,GAAGm7D,IAAIz3D,KAAOy3D,EAAIz3D,IAC3CpG,KAAK8qK,kBAAkBv9D,OAAO7qG,EAAG,EAGvC,CAUc,QAAA+oK,CACZ3rK,EACAymK,G,0CAEA,MAAMp4D,QAAmBnuG,KAAK4jE,YAAYnkC,gBAC1C,GAAI0uE,IAAejyE,GAAqBsD,UACtC,OAGF,MAAM2uI,EAAYruK,EAAQorD,MACpBkjH,EAAqBD,EAAUtqJ,SAAWsqJ,EAAUtqJ,SAAS7b,cAAgB,GAC7EqmK,EAAc,EAAMjnK,UAAU+mK,EAAUlnK,KAC9C,GAAmB,MAAfonK,EACF,OAGF,MAAMC,QAA0BtuK,KAAK2sK,4BAErC,GAAIx+D,IAAejyE,GAAqBqD,OAKtC,YAJI+uI,UACItuK,KAAKuuK,oBAAoBF,EAAaF,EAAW5H,EAAO1oG,KAAK,KAMvE,MACM2wG,SADgBxuK,KAAKw9D,cAAcy+D,sBAAsBkyC,EAAUlnK,MACzCvH,QAC7BqG,GAA0B,MAApBA,EAAEmlD,MAAMrnC,UAAoB9d,EAAEmlD,MAAMrnC,SAAS7b,gBAAkBomK,IAExE,GAAIE,GAAgD,IAA3BE,EAAgB/rK,OAEvC,kBADMzC,KAAKuuK,oBAAoBF,EAAaF,EAAW5H,EAAO1oG,aAI1B79D,KAAKysK,mCAId,IAA3B+B,EAAgB/rK,QAChB+rK,EAAgB,GAAGtjH,MAAMpnC,WAAaqqJ,EAAUrqJ,iBAE1C9jB,KAAKyuK,0BACTD,EAAgB,GAAGpoK,GACnBioK,EACAF,EAAUrqJ,SACVyiJ,EAAO1oG,KAGb,G,CAEc,mBAAA0wG,CACZF,EACAF,EACAtwG,EACAkwG,GAAgB,G,0CAGhB/tK,KAAK6rK,+BAA+BhuG,GACpC,MAAM/9D,EAAgC,CACpCwN,KAAMm9J,GACN5mJ,SAAUsqJ,EAAUtqJ,SACpBC,SAAUqqJ,EAAUrqJ,SACpBtc,OAAQ6mK,EACR1kH,IAAKwkH,EAAUlnK,IACf42D,IAAKA,EACL2vG,QAAS,IAAIhhK,MAAK,IAAIA,MAAOD,UAAYwnC,IACzCi6H,eAAgBD,GAElB/tK,KAAK8qK,kBAAkBlwJ,KAAK9a,SACtBE,KAAKssK,uBAAuBzuG,EACpC,G,CASc,eAAA8tG,CACZ7rK,EACAymK,G,0CAEA,MAAMmI,EAAa5uK,EAAQ0S,KACrB67J,EAAc,EAAMjnK,UAAUsnK,EAAWznK,KAC/C,GAAmB,MAAfonK,EACF,OAGF,UAAWruK,KAAK4jE,YAAYnkC,iBAAmBvD,GAAqBoD,SAQlE,kBAPMt/B,KAAKyuK,0BACT,KACAJ,EACAK,EAAW/zI,YACX4rI,EAAO1oG,KACP,IAKJ,IAAIz3D,EAAa,KACjB,MAAMu0E,QAAgB36E,KAAKw9D,cAAcy+D,sBAAsByyC,EAAWznK,KAC1E,GAAkC,MAA9BynK,EAAWC,gBAAyB,CACtC,MAAMC,EAAkBj0F,EAAQj7E,QAC7BqG,GAAMA,EAAEmlD,MAAMpnC,WAAa4qJ,EAAWC,kBAEV,IAA3BC,EAAgBnsK,SAClB2D,EAAKwoK,EAAgB,GAAGxoK,G,MAEE,IAAnBu0E,EAAQl4E,SACjB2D,EAAKu0E,EAAQ,GAAGv0E,IAER,MAANA,UACIpG,KAAKyuK,0BAA0BroK,EAAIioK,EAAaK,EAAW/zI,YAAa4rI,EAAO1oG,KAEzF,G,CAQc,uCAAAsuG,CACZrsK,G,0CAEA,GAAuB,oBAAnBA,EAAQymK,OACV,OAGF,MAAMsI,EAAQ7uK,KAAK2qK,gBAAgBmE,2BAA2BhvK,EAAQ80F,eAChE,GAAW6sE,mBAAmB3hK,EAAQ+9D,IAAK,6BAA8B,CAC7E+2B,QAAS90F,EAAQ80F,QACjBi6E,MAAOA,GAEX,G,CASc,WAAAxC,CAAYvsK,EAAiD+9D,G,gDACzE,GAAgB,QAAZ,EAAA/9D,EAAQ0S,YAAI,eAAEk3J,iBAChB,OAIF,UADgC1pK,KAAK4jE,YAAYnkC,mBACvBvD,GAAqBqD,QAAUv/B,KAAK8qK,kBAAkBroK,OAC9E,OAGF,MAAM4rK,EAAc,EAAMjnK,UAAUy2D,EAAI52D,KACpConK,UACIruK,KAAK+uK,uBAAuBV,EAAaxwG,G,IAW7C,qBAAAmxG,CAAsBnxG,EAAsBqwG,G,0CAEhD,UADgCluK,KAAK4jE,YAAYnkC,mBACvBvD,GAAqBoD,UAAYt/B,KAAK8qK,kBAAkBroK,OAChF,OAGF,MAAM4rK,EAAc,EAAMjnK,UAAUy2D,EAAI52D,KACpConK,UACIruK,KAAKivK,iCAAiCZ,EAAaxwG,EAAKqwG,GAElE,G,CAEc,yBAAAO,CACZ9uG,EACA0uG,EACA1zI,EACAkjC,EACAkwG,GAAgB,G,0CAGhB/tK,KAAK6rK,+BAA+BhuG,GACpC,MAAM/9D,EAAyC,CAC7CwN,KAAMm9J,GACN9qG,SAAUA,EACVhlC,YAAaA,EACbnzB,OAAQ6mK,EACRxwG,IAAKA,EACL2vG,QAAS,IAAIhhK,MAAK,IAAIA,MAAOD,UAAYwnC,IACzCi6H,eAAgBD,GAElB/tK,KAAK8qK,kBAAkBlwJ,KAAK9a,SACtBE,KAAKssK,uBAAuBzuG,EACpC,G,CAEc,sBAAAkxG,CAAuBV,EAAqBxwG,G,0CACxD79D,KAAK6rK,+BAA+BhuG,GACpC,MAAM/9D,EAAsC,CAC1CwN,KAAMm9J,GACNjjK,OAAQ6mK,EACRxwG,IAAKA,EACL2vG,QAAS,IAAIhhK,MAAK,IAAIA,MAAOD,UAAY,KACzCyhK,gBAAgB,SAEZhuK,KAAK2tK,6BAA6B9vG,EAAK/9D,EAC/C,G,CAWc,gCAAAmvK,CACZZ,EACAxwG,EACAqwG,G,0CAEAluK,KAAK6rK,+BAA+BhuG,GACpC,MAAM/9D,EAAgD,CACpDwN,KAAMm9J,GACNjjK,OAAQ6mK,EACRxwG,MACA2vG,QAAS,IAAIhhK,MAAK,IAAIA,MAAOD,UAAY,KACzCyhK,gBAAgB,EAChBE,cAEFluK,KAAK8qK,kBAAkBlwJ,KAAK9a,SACtBE,KAAKssK,uBAAuBzuG,GAClC79D,KAAK6rK,+BAA+BhuG,EACtC,G,CAUc,uBAAAkuG,CACZjsK,EACAymK,G,0CAEA,UAAWvmK,KAAK4jE,YAAYnkC,iBAAmBvD,GAAqBoD,SAalE,aAZM,GAAWmiI,mBAAmB8E,EAAO1oG,IAAK,uCAAwC,CACtF4oG,eAAgB,CACd3mK,QAAS,CACPi9C,QAASj9C,EAAQi9C,QACjB2N,KAAM5qD,EAAQ4qD,KACdsxE,OAAQl8H,EAAQk8H,QAElBuqC,OAAQA,GAEVx9J,OAAQ,uCAEJ/I,KAAKwpK,iBAAiBjD,EAAO1oG,YAI/B79D,KAAKkvK,wBAAwB3I,EAAO1oG,IAAK/9D,EAAQ4qD,KAAM5qD,EAAQk8H,OACvE,G,CAUc,uBAAAkzC,CAAwBrxG,EAAsBnT,EAAeD,G,0CACzE,IAAK,IAAI/nD,EAAI1C,KAAK8qK,kBAAkBroK,OAAS,EAAGC,GAAK,EAAGA,IAAK,CAC3D,MAAMgrK,EAAe1tK,KAAK8qK,kBAAkBpoK,GAC5C,GACEgrK,EAAa7vG,IAAIz3D,KAAOy3D,EAAIz3D,IAC3BsnK,EAAapgK,OAASm9J,IACrBiD,EAAapgK,OAASm9J,GAExB,SAGF,MAAMgD,EAAY,EAAMrmK,UAAUy2D,EAAI52D,KACtC,GAAiB,MAAbwmK,GAAqBA,IAAcC,EAAalmK,OAClD,SAKF,GAFAxH,KAAK8qK,kBAAkBv9D,OAAO7qG,EAAG,GAE7BgrK,EAAapgK,OAASm9J,GAA6C,CACrE,MAAM0E,QAAmBnvK,KAAKovK,uBAAuB1B,EAAa/tG,UAElE,kBADM3/D,KAAKqvK,eAAeF,EAAYzB,EAAa/yI,YAAa+vB,EAAMmT,G,CAKxE,GAAI6vG,EAAaM,eAAgB,CAC/B,MACMztC,SADmBvgI,KAAKw9D,cAAcy+D,sBAAsByxC,EAAa/jH,MAC7CzzB,MAC/BnwB,GACqB,MAApBA,EAAEmlD,MAAMrnC,UAAoB9d,EAAEmlD,MAAMrnC,SAAS7b,gBAAkB0lK,EAAa7pJ,WAGhF,GAAsB,MAAlB08G,EAEF,kBADMvgI,KAAKqvK,eAAe9uC,EAAgBmtC,EAAa5pJ,SAAU4mC,EAAMmT,G,CAK3EpT,SAAkBzqD,KAAKsvK,aAAa7kH,IAAaA,EAAW,KAC5D,MAAM8kH,EAAYvvK,KAAKwvK,wCAAwC9B,EAAcjjH,GAE7E,GAAIC,EAGF,aAFM1qD,KAAKyvK,SAASF,EAAW1xG,cACzB,GAAW6jG,eAAe7jG,EAAK,CAAE9gB,QAAS,0BAIlD,MAAMiiB,QAAeh/D,KAAKw9D,cAAc1/C,QAAQyxJ,GAChD,UACQvvK,KAAKw9D,cAAc6/D,iBAAiBr+D,SACpC,GAAW0iG,eAAe7jG,EAAK,CAAE9gB,QAAS,qCAC1C,GAAW2kH,eAAe7jG,EAAK,CAAE9gB,QAAS,e,CAChD,MAAOx8C,SACD,GAAWkhK,mBAAmB5jG,EAAK,6BAA8B,CACrEt9D,MAAOqD,OAAOrD,EAAMT,U,EAI5B,G,CAYc,cAAAuvK,CACZF,EACAx0I,EACA+vB,EACAmT,G,0CAIA,GAFAsxG,EAAWjkH,MAAMpnC,SAAW6W,EAExB+vB,EAIF,aAHM1qD,KAAKyvK,SAASN,EAAYtxG,SAC1B,GAAW6jG,eAAe7jG,EAAK,CAAE9gB,QAAS,oCAC1C,GAAW2kH,eAAe7jG,EAAK,CAAE9gB,QAAS,kBAIlD,MAAMiiB,QAAeh/D,KAAKw9D,cAAc1/C,QAAQqxJ,GAChD,UAEQnvK,KAAKw9D,cAAc8C,iBAAiBtB,SACpC,GAAW0iG,eAAe7jG,EAAK,CAAE9gB,QAAS,8B,CAChD,MAAOx8C,SACD,GAAWkhK,mBAAmB5jG,EAAK,6BAA8B,CACrEt9D,MAAOqD,OAAOrD,EAAMT,U,CAG1B,G,CASc,QAAA2vK,CAASN,EAAwB1F,G,gDACvCzpK,KAAKw9D,cAAc8iE,qBAAqB,CAC5CthE,OAAQmwG,EACR3kH,cAAe2kH,EAAW3kH,sBAGtBxqD,KAAKsqK,2BAA2Bb,EAAW,CAAE9pG,SAAUwvG,EAAW/oK,IAC1E,G,CAEc,YAAAkpK,CAAa7kH,G,0CACzB,GAAI,EAAM/jD,mBAAmB+jD,IAA0B,SAAbA,EACxC,OAAO,EAIT,aADsB,OAAezqD,KAAKmlI,cAAcc,eACzC70E,MAAMzsD,GAAMA,EAAEyB,KAAOqkD,GACtC,G,CAEc,sBAAA2kH,CAAuBzvG,G,0CACnC,MAAMX,QAAeh/D,KAAKw9D,cAAcvjD,IAAI0lD,GAC5C,OAAc,MAAVX,GAAkBA,EAAO1xD,OAASs5C,GAAWqE,YAClC+T,EAAOzrD,cAAcvT,KAAKw9D,cAAc0C,6BAA6BlB,IAE7E,IACT,G,CAOc,SAAAitG,CAAUpuG,G,0CACtB,IAAK,IAAIn7D,EAAI1C,KAAK8qK,kBAAkBroK,OAAS,EAAGC,GAAK,EAAGA,IAAK,CAC3D,MAAMgrK,EAAe1tK,KAAK8qK,kBAAkBpoK,GAC5C,GACEgrK,EAAa7vG,IAAIz3D,KAAOy3D,EAAIz3D,IAC5BsnK,EAAapgK,OAASm9J,GAEtB,SAGF,MAAMgD,EAAY,EAAMrmK,UAAUy2D,EAAI52D,KACtC,GAAiB,MAAbwmK,GAAqBA,IAAcC,EAAalmK,OAClD,SAGFxH,KAAK8qK,kBAAkBv9D,OAAO7qG,EAAG,SAC3B,GAAW++J,mBAAmB5jG,EAAK,wBAEzC,MAAM/2D,EAAW,EAAMN,YAAYq3D,EAAI52D,WACjCjH,KAAKw9D,cAAc4/D,gBAAgBt2H,E,CAE7C,G,CAKc,aAAAqkK,G,0CACZ,aAAa,OAAenrK,KAAKmlI,cAAcc,aACjD,G,CAEc,cAAAgnC,G,0CAEZ,aADkB,OAAejtK,KAAK2iD,mBAAmBG,eAC9CmqH,gBACb,G,CAEc,qBAAAgB,G,0CACZ,aAAa,OACXjuK,KAAKg4B,cAAc+B,2BAA2BnI,GAAW89I,mBAE7D,G,CAUc,qBAAAzE,CACZnrK,EACAymK,G,0CAEA,MAAMoJ,EAAc7vK,EAAQ0S,KACtBo9J,EAAeD,EAAYlJ,eAAe3mK,QAAQi9C,QAKxD,GAJqB,mBAAjB6yH,UACI,GAAWnO,mBAAmB8E,EAAO1oG,IAAK,yBAGvB,4BAAvB8xG,EAAY5mK,OACd,OAGF,MAAM8mK,EAA6C7vK,KAAK+qK,yBAAyB6E,GAC7EC,GACFA,EAAa,CACX/vK,QAAS6vK,EAAYlJ,eAAe3mK,QACpCymK,OAAQoJ,EAAYlJ,eAAeF,QAGzC,G,CAQc,iCAAA8E,CAAkC9E,G,gDACxC,GAAW9E,mBAAmB8E,EAAO1oG,IAAK,uBAClD,G,CASc,kCAAA0tG,CACZzrK,EACAymK,G,gDAEM,GAAW9E,mBAAmB8E,EAAO1oG,IAAK,wBAAyB/9D,EAAQ0S,KACnF,G,CASQ,uCAAAg9J,CACN1vK,EACA2qD,GAEA,MAAMqlH,EAAU,IAAIngH,GACpBmgH,EAAQnmH,IAAM7pD,EAAQ6pD,IAEtB,MAAMomH,EAAY,IAAI/+G,GACtB++G,EAAU9lH,KAAO,CAAC6lH,GAClBC,EAAUlsJ,SAAW/jB,EAAQ+jB,SAC7BksJ,EAAUjsJ,SAAWhkB,EAAQgkB,SAE7B,MAAMqrJ,EAAa,IAAIx9G,GAMvB,OALAw9G,EAAW3tK,MAAQ,EAAMgF,YAAY1G,EAAQ6pD,MAAQ7pD,EAAQ0H,QAAQtD,QAAQ,SAAU,IACvFirK,EAAW1kH,SAAWA,EACtB0kH,EAAW7hK,KAAOs5C,GAAWqE,MAC7BkkH,EAAWjkH,MAAQ6kH,EAEZZ,CACT,CAEQ,6BAAA/B,GACN,GAAW/K,gBAAgB,0BAA2BriK,KAAKktK,uBAC7D,ECzvBK,SAAS8C,GAAgBC,EAAwBjxG,EAAoBkxG,GAC1E,IAAIC,EACAC,EACAC,EAAgB,GACpB,MAAMC,EAAoC,CACxCC,KAAM,YACNC,WAAY,kBACZC,KAAM,YACNC,SAAU,gBACV,cAAe,mBACfC,IAAK,WACLC,QAAS,eACTC,SAAU,iBACVC,MAAO,eAGT,OAAQ9xG,EAAO1xD,MACb,KAAKs5C,GAAWqE,MAGd,GAFAklH,EAAO,YAEHnxG,EAAO9T,MAAMvB,IAAK,CACpB,IAAIonH,EAAc/xG,EAAO9T,MAAMvB,IAC3BwG,GAAY,EAmBhB,GAjB6C,IAAzC4gH,EAAYlqK,QAAQ,kBACtBspK,EAAO,cACPC,EAAQ,MACsC,IAArCW,EAAYlqK,QAAQ,cAC7BspK,EAAO,YACPC,EAAQ,MAERF,IACgC,IAAhCa,EAAYlqK,QAAQ,QACpBkqK,EAAYlqK,QAAQ,MAAQ,GAE5BkqK,EAAc,UAAUA,IACxB5gH,GAAY,GACH+/G,IACT//G,EAA4C,IAAhC4gH,EAAYlqK,QAAQ,SAAiBkqK,EAAYlqK,QAAQ,MAAQ,GAG3EqpK,GAAe//G,EACjB,IACEigH,EAAQ,GAAGH,KAAkB,EAAMzpK,YAAYuqK,cAC/CV,EAAgB,sB,CAChB,MAAOxlK,G,OAKXulK,EAAQ,KAEV,MACF,KAAKxpH,GAAWuE,WACdglH,EAAO,kBACP,MACF,KAAKvpH,GAAWyE,KACd8kH,EAAO,kBACHD,GAAelxG,EAAO1T,KAAK9D,SAAS8oH,IACtCH,EAAO,oBAAoBG,EAAUtxG,EAAO1T,KAAK9D,UAEnD,MACF,KAAKZ,GAAW2E,SACd4kH,EAAO,cAMX,MAAO,CACLa,aAAcd,EACdE,QACAC,gBACAF,OAEJ,CC/EA,MAAMc,GACI,0BADJA,GAEE,wBAGFC,GACI,+BADJA,GAEE,6B,2SCsxBR,OAjvBA,MAmDE,WAAA1xK,CACUg+D,EACAmtG,EACA/mG,EACAjhB,EACAmhB,EACApnD,EACA0nE,EACAl8E,EACAka,EACAyoJ,GATA,KAAArtG,cAAAA,EACA,KAAAmtG,gBAAAA,EACA,KAAA/mG,YAAAA,EACA,KAAAjhB,mBAAAA,EACA,KAAAmhB,sBAAAA,EACA,KAAApnD,aAAAA,EACA,KAAA0nE,wBAAAA,EACA,KAAAl8E,YAAAA,EACA,KAAAka,qBAAAA,EACA,KAAAyoJ,kBAAAA,EA5DO,KAAArB,iBAAmBA,GACnB,KAAAQ,wBAA0BA,GAC1B,KAAAM,2BAA6BA,GACtC,KAAA6G,oBAA+C,IAAIvxK,IACnD,KAAAwxK,kBAGJ,CAAC,EACG,KAAAC,eAAuCn1I,GAAqBsD,UAG5D,KAAA8xI,aAAsC,GAI7B,KAAAvG,yBAAsE,CACrFwG,oBAAqB,IAAMvxK,KAAKwxK,aAAY,GAC5CC,6BAA8B,EAAG3xK,UAASymK,YACxCvmK,KAAK0xK,qBAAqB5xK,EAASymK,GACrCoL,+BAAgC,EAAG7xK,UAASymK,YAAavmK,KAAK4xK,gBAAgB9xK,EAASymK,GACvFsL,6BAA8B,IAAM7xK,KAAK8xK,uBACzCC,4BAA6B,IAAM/xK,KAAKgyK,sBACxCC,yBAA0B,IAAMjyK,KAAKkyK,mBACrCC,8BAA+B,EAAGryK,UAASymK,YACzCvmK,KAAKoyK,sBAAsBtyK,EAASymK,GACtC8L,4BAA6B,EAAGvyK,aAAcE,KAAKsyK,oBAAoBxyK,GACvEyyK,uBAAwB,EAAGzyK,UAASymK,YAAavmK,KAAKwyK,oBAAoB1yK,EAASymK,GACnF2F,2BAA4B,EAAGpsK,UAASymK,YAAavmK,KAAKyyK,iBAAiB3yK,EAASymK,GACpFyE,gBAAiB,EAAGlrK,aAAcE,KAAKgrK,gBAAgBlrK,GACvD4yK,uBAAwB,IAAM1yK,KAAK2yK,uBACnCC,cAAe,IAAM5yK,KAAK2yK,wBAEX,KAAAE,iCAAqE,CACpFC,qBAAsB,EAAGC,UAAW/yK,KAAKgzK,2BAA2BD,GACpEE,qBAAsB,EAAGF,UAAW/yK,KAAKkzK,aAAaH,GACtDI,0BAA2B,EAAGJ,UAAW/yK,KAAKkzK,aAAaH,GAAM,GACjEK,mBAAoB,IAAMpzK,KAAKqzK,0BAC/BC,wBAAyB,EAAGxzK,UAASizK,UAAW/yK,KAAKszK,wBAAwBxzK,EAASizK,IAEvE,KAAAQ,+BAAiE,CAChFC,kCAAmC,IAAMxzK,KAAKyzK,4BAC9CN,0BAA2B,EAAGJ,UAAW/yK,KAAKkzK,aAAaH,GAAM,GACjEK,mBAAoB,IAAMpzK,KAAKyzK,4BAC/BpH,YAAa,EAAG0G,UAAW/yK,KAAKqsK,YAAY0G,GAC5CW,qBAAsB,EAAG5zK,UAASizK,UAAW/yK,KAAK2zK,4BAA4B7zK,EAASizK,GACvFnB,gBAAiB,EAAGmB,UAAW/yK,KAAK4zK,uBAAuBb,GAC3Dc,mBAAoB,EAAG/zK,UAASizK,UAAW/yK,KAAK6zK,mBAAmB/zK,EAASizK,GAC5EO,wBAAyB,EAAGxzK,UAASizK,UAAW/yK,KAAKszK,wBAAwBxzK,EAASizK,IAglBhF,KAAA7F,uBAAyB,CAC/BptK,EACAymK,EACA11C,KAEA,MAAM6xC,EAAwC1iK,KAAK+qK,yBAAyBjrK,aAAO,EAAPA,EAASi9C,SACrF,IAAK2lH,EACH,OAGF,MAAMyK,EAAkBzK,EAAQ,CAAE5iK,UAASymK,WAC3C,OAAK4G,GAMLvhK,QAAQC,QAAQshK,GAAiB3jJ,MAAM9b,GAAamjH,EAAanjH,MAC1D,QAPP,CAOW,EAQL,KAAAomK,oBAA6Bf,GAA8B,mCACjE,MAAMgB,EAAoBhB,EAAKvxK,OAAS0vK,GAClC8C,EAAsBjB,EAAKvxK,OAAS0vK,IACrC6C,GAAsBC,KAI3Bh0K,KAAKi0K,iBAAiBlB,GACtBA,EAAKzQ,UAAU7C,YAAYz/J,KAAKk0K,iCAChCnB,EAAKr+G,YAAY,CACf3X,QAAS,uBAAsBg3H,EAAoB,OAAS,UAC5D5lE,iBAAkBnuG,KAAKy/B,gBACvB00I,cAAenb,OAAO3C,QAAQuS,OAAO,WAAWmL,EAAoB,OAAS,gBAC7EpgG,YAAa,OAAe3zE,KAAK6qK,kBAAkB58E,gBACnDmmF,aAAcp0K,KAAKq0K,kBACnB15F,QAASo5F,QAA0B/zK,KAAKs0K,uBAAyB,OAEnEt0K,KAAKoyK,sBACH,CACEmC,eAAgBR,EACZ9C,GACAA,IAEN8B,EAAKxM,QAET,IAuCQ,KAAA2N,gCAAkC,CACxCp0K,EACAizK,KAEA,MAAMh2H,EAAUj9C,aAAO,EAAPA,EAASi9C,QACzB,IAAI2lH,EAEAqQ,EAAKvxK,OAAS0vK,KAChBxO,EAAU1iK,KAAK6yK,iCAAiC91H,IAG9Cg2H,EAAKvxK,OAAS0vK,KAChBxO,EAAU1iK,KAAKuzK,+BAA+Bx2H,IAG3C2lH,GAILA,EAAQ,CAAE5iK,UAASizK,QAAO,CA/qBzB,CAQH,iBAAAyB,CAAkBzX,GACX/8J,KAAKoxK,kBAAkBrU,KAI5B/8J,KAAKoxK,kBAAkBrU,GAAO/nG,eACvBh1D,KAAKoxK,kBAAkBrU,GAChC,CAMM,IAAA57J,G,0CACJnB,KAAKy0K,iCACL,MAAMl1E,QAAY,OAAev/F,KAAK2iD,mBAAmBG,cACzD9iD,KAAKiwK,eAAiB1wE,EAAIm1E,oBACpB10K,KAAK8xK,6BACL9xK,KAAKy/B,eACb,G,CAOM,oBAAAkzI,G,gDAEJ,UADyB,OAAe3yK,KAAK4jE,YAAYhlC,yBACtC1C,GAAqBoD,SACtC,OAGF,MAAMiuI,QAAmB,GAAWvM,4BACpC,KAAKuM,aAAU,EAAVA,EAAYtmK,KACf,OAGFjH,KAAKmxK,oBAAsB,IAAIvxK,IAC/B,MAAM+0K,SAAsB30K,KAAKw9D,cAAcy+D,sBAAsBsxC,EAAWtmK,MAAMm2B,MACpF,CAACh1B,EAAGC,IAAMrI,KAAKw9D,cAAckiE,8BAA8Bt3H,EAAGC,KAEhE,IAAK,IAAIi0I,EAAc,EAAGA,EAAcq4B,EAAalyK,OAAQ65I,IAC3Dt8I,KAAKmxK,oBAAoBppK,IAAI,kBAAkBu0I,IAAeq4B,EAAar4B,IAG7E,MAAM3hE,QAAgB36E,KAAKs0K,uBACP,QAApB,EAAAt0K,KAAK40K,uBAAe,SAAElgH,YAAY,CAAE3X,QAAS,2BAA4B49B,kBACnE,GAAW8mF,mBAAmB8L,EAAY,kCAAmC,CACjFsH,0BAA2BzpI,QAAQuvC,EAAQl4E,S,IAQjC,oBAAA6xK,G,0CACZ,MAAMn+F,QAAqB,OAAen2E,KAAK8jE,sBAAsB7sB,eAC/D69H,EAAsBvwK,MAAMlC,KAAKrC,KAAKmxK,qBACtC4D,EAAyC,GAC/C,IAAIC,EAEJ,IAAK,IAAI14B,EAAc,EAAGA,EAAcw4B,EAAoBryK,OAAQ65I,IAAe,CACjF,MAAO24B,EAAiBj2G,GAAU81G,EAAoBx4B,GACjD04B,GAAmBh2G,EAAO1xD,OAASs5C,GAAWqE,QACjD+pH,EAAkBhF,GAAgBhwK,KAAKiwK,eAAgBjxG,EAAQmX,IAGjE4+F,EAAkBn6J,KAAK,CACrBxU,GAAI6uK,EACJzzK,KAAMw9D,EAAOx9D,KACb8L,KAAM0xD,EAAO1xD,KACb09C,SAAUgU,EAAOhU,SACjBH,SAAUmU,EAAOnU,SACjBslH,KACEnxG,EAAO1xD,OAASs5C,GAAWqE,MACvB+pH,EACAhF,GAAgBhwK,KAAKiwK,eAAgBjxG,EAAQmX,GACnDjrB,MAAO8T,EAAO1xD,OAASs5C,GAAWqE,MAAQ,CAAEpnC,SAAUm7C,EAAO9T,MAAMrnC,UAAa,KAChFynC,KAAM0T,EAAO1xD,OAASs5C,GAAWyE,KAAO2T,EAAO1T,KAAKqB,SAAW,M,CAInE,OAAOooH,CACT,G,CASQ,gBAAAtC,CACN3yK,EACAymK,GAEA,MAAM2O,EAAc,CAClBlY,QAASuJ,EAAOvJ,QAChBn/F,IAAK0oG,EAAO1oG,IACZ+2B,QAAS90F,EAAQ80F,SAGbugF,EAAiBn1K,KAAKoxK,kBAAkB7K,EAAO1oG,IAAIz3D,IACpD+uK,EAKLA,EAAeptK,IAAIw+J,EAAOvJ,QAASkY,GAJjCl1K,KAAKoxK,kBAAkB7K,EAAO1oG,IAAIz3D,IAAM,IAAIxG,IAAI,CAAC,CAAC2mK,EAAOvJ,QAASkY,IAKtE,CASc,2BAAAvB,EACZ,gBAAEsB,IACF,OAAE1O,I,0CAEF,MAAM2O,EAAcl1K,KAAKoxK,kBAAkB7K,EAAO1oG,IAAIz3D,IACtD,IAAK6uK,KAAoBC,aAAW,EAAXA,EAAar2H,MACpC,OAGF,MAAMmgB,EAASh/D,KAAKmxK,oBAAoBl3J,IAAIg7J,GAE5C,SAAUj1K,KAAK2qK,gBAAgByK,2BAA2Bp2G,EAAQunG,EAAO1oG,KACvE,OAEF,MAAMw3G,QAAiBr1K,KAAK2qK,gBAAgB2K,WAAW,CACrDz3G,IAAK0oG,EAAO1oG,IACZmB,OAAQA,EACRk2G,YAAa3wK,MAAMlC,KAAK6yK,EAAY99I,UACpCm+I,iBAAiB,EACjBC,mBAAmB,IAGjBH,GACFr1K,KAAKoiB,qBAAqBijE,gBAAgBgwF,GAG5Cr1K,KAAKmxK,oBAAsB,IAAIvxK,IAAI,CAAC,CAACq1K,EAAiBj2G,MAAYh/D,KAAKmxK,qBACzE,G,CAMQ,mBAAAa,GACFhyK,KAAK40K,gBACP50K,KAAKqzK,0BAKPrzK,KAAKyzK,2BACP,CAKQ,yBAAAA,G,MACgB,QAAtB,EAAAzzK,KAAKy1K,yBAAiB,SAAE/gH,YAAY,CAAE3X,QAAS,qCACjD,CAKQ,uBAAAs2H,G,MACc,QAApB,EAAArzK,KAAK40K,uBAAe,SAAElgH,YAAY,CAAE3X,QAAS,mCAC/C,CAQQ,YAAAm2H,EAAa,OAAE3M,GAA+BmP,GAAoB,GAGxE,GAAWjU,mBAAmB8E,EAAO1oG,IAAK,uBAAwB,CAAE63G,qBACtE,CASQ,oBAAAhE,EACN,eAAE6C,GACFhO,G,UAEA,OAAIA,EAAO1oG,IAAIz3D,MAA4B,QAArB,EAAApG,KAAK21K,wBAAgB,eAAE5Y,QAC3C/8J,KAAKsxK,aAAa1pK,SAASmrK,GAASA,EAAK6C,oBACzC51K,KAAKsxK,aAAe,KAIlBiD,IAAmBtD,IACC,QAAtB,EAAAjxK,KAAKy1K,yBAAiB,SAAEG,kBACxB51K,KAAKy1K,kBAAoB,QAKP,QAApB,EAAAz1K,KAAK40K,uBAAe,SAAEgB,kBACtB51K,KAAK40K,gBAAkB,MACzB,CASQ,qBAAAxC,EACN,eAAEmC,GACFhO,G,UAEKgO,GAAkBhO,EAAO1oG,IAAIz3D,MAA4B,QAArB,EAAApG,KAAK21K,wBAAgB,eAAE5Y,SAI5DwX,IAAmBtD,GASH,QAApB,EAAAjxK,KAAK40K,uBAAe,SAAElgH,YAAY,CAChC3X,QAAS,uBACT84H,OAAQ71K,KAAK81K,2BAVS,QAAtB,EAAA91K,KAAKy1K,yBAAiB,SAAE/gH,YAAY,CAClC3X,QAAS,uBACT84H,OAAQ71K,KAAK+1K,6BAUnB,CAMQ,wBAAAA,GACN,IAAK/1K,KAAK21K,iBACR,OAGF,MAAM,IAAErN,EAAG,KAAED,EAAI,MAAEz7C,EAAK,OAAEq7C,GAAWjoK,KAAK21K,iBAAiBK,mBACrD,aAAEC,EAAY,YAAEC,GAAgBl2K,KAAK21K,iBAAiBQ,mBAC5D,IAAIC,EAAyB,IAATnO,EAChBA,GAAU,KACZmO,EAAgBnO,GAAU,GAAc,IAATA,EAAyB,IAATA,GAGjD,MAAMoO,EAAgBpO,EAASmO,EACzBE,EAAqBhO,EAAM8N,EAAgB,EACjD,IAAIG,EAAsBlO,EAAOz7C,EAAQq7C,EAASmO,EAAgB,EAElE,MAAMI,EAAoBzzK,SAASkzK,EAAc,IAMjD,OAJIO,EADqBzzK,SAASmzK,EAAa,MAE7CK,EAAsBlO,EAAOz7C,EAAQq7C,GAAUuO,EAAoBJ,EAAgB,IAG9E,CACL9N,IAAK,GAAGriK,KAAKspC,MAAM+mI,OACnBjO,KAAM,GAAGpiK,KAAKspC,MAAMgnI,OACpBtO,OAAQ,GAAGhiK,KAAKspC,MAAM8mI,OACtBzpD,MAAO,GAAG3mH,KAAKspC,MAAM8mI,OAEzB,CAMQ,sBAAAP,GACN,IAAK91K,KAAK21K,iBACR,OAGF,MAAM,IAAErN,EAAG,KAAED,EAAI,MAAEz7C,EAAK,OAAEq7C,GAAWjoK,KAAK21K,iBAAiBK,kBAC3D,MAAO,CACLppD,MAAO,GAAG3mH,KAAKspC,MAAMq9E,OACrB07C,IAAK,GAAGriK,KAAKspC,MAAM+4H,EAAML,OACzBI,KAAM,GAAGpiK,KAAKspC,MAAM84H,OAExB,CAQQ,mBAAAmK,EACN,iBAAEmD,GACFpP,GAEAvmK,KAAK21K,iBAAmB,OAAH,wBAAQA,GAAgB,CAAE5Y,MAAOwJ,EAAO1oG,IAAIz3D,IACnE,CAOQ,mBAAAksK,EAAoB,QAAEmE,I,QAC5B,IAAKA,EACH,OAGF,MAAMC,EAAc,CAAE35H,QAAS,sBAAuB84H,OAAQ,CAAEY,YAE1C,QAAtB,EAAAz2K,KAAKy1K,yBAAiB,SAAE/gH,YAAYgiH,GAChB,QAApB,EAAA12K,KAAK40K,uBAAe,SAAElgH,YAAYgiH,EACpC,CAQc,WAAAlF,CAAYmF,GAAyB,EAAOC,GAAuB,G,0CAC/E,MAAMrJ,QAAmB,GAAWvM,kCAE9B,GAAWS,mBAAmB8L,EAAY,sBAAuB,CACrEoJ,yBACAC,uBACAzoE,iBAAkBnuG,KAAKy/B,iBAE3B,G,CAKc,oBAAAqyI,G,0CACZ,aAAa,OAAe9xK,KAAKokF,wBAAwB7uC,sBAC3D,G,CAOc,aAAA9V,G,0CACZ,MAAMo3I,EAAmB72K,KAAKqxK,eAW9B,OAVArxK,KAAKqxK,qBAAuBrxK,KAAK4jE,YAAYnkC,gBAG3Cz/B,KAAKqxK,iBAAmBwF,GACxB72K,KAAKqxK,iBAAmBn1I,GAAqBoD,WAE7Ct/B,KAAK82K,sCACC92K,KAAK2yK,wBAGN3yK,KAAKqxK,cACd,G,CAKQ,6BAAAyF,G,MACgB,QAAtB,EAAA92K,KAAKy1K,yBAAiB,SAAE/gH,YAAY,CAClC3X,QAAS,gCACToxD,WAAYnuG,KAAKqxK,gBAErB,CASQ,0BAAA2B,CAA2BD,GAC7B/yK,KAAKqxK,iBAAmBn1I,GAAqBoD,SASjDt/B,KAAKwxK,aAAY,GAAO,GANtBxxK,KAAKqsK,YAAY0G,EAOrB,CAOc,WAAA1G,CAAY0G,G,0CACxB,MAAM,OAAExM,GAAWwM,EAEnB/yK,KAAKkzK,aAAaH,GAClB,MAAMgE,EAAoD,CACxDtQ,eAAgB,CAAE3mK,QAAS,CAAEi9C,QAAS,uBAAyBwpH,UAC/Dx9J,OAAQ,4BAEJ,GAAW04J,mBACf8E,EAAO1oG,IACP,uCACAk5G,SAEI/2K,KAAKwpK,iBAAiBjD,EAAO1oG,KAAK,EAC1C,G,CAQc,kBAAAg2G,EACZ,gBAAEoB,IACF,OAAE1O,I,0CAEF,MAAMvnG,EAASh/D,KAAKmxK,oBAAoBl3J,IAAIg7J,GACvCj2G,UAICh/D,KAAKgqK,wBAAwBzD,EAAO1oG,IAAK,CAC7C8B,SAAUX,EAAO54D,GACjB6wG,OvdlgB8B,yBudogBlC,G,CAKQ,gBAAAi7D,G,MACc,QAApB,EAAAlyK,KAAK40K,uBAAe,SAAElgH,YAAY,CAAE3X,QAAS,oBAC/C,CAQc,eAAAiuH,CAAgBlrK,G,0DACtBE,KAAKy/B,gBAE4C,yBAAd,QAArC,EAA4B,QAA5B,EAAY,QAAZ,EAAA3/B,EAAQ0S,YAAI,eAAEi0J,sBAAc,eAAE3mK,eAAO,eAAEi9C,iBACnC/8C,KAAKwxK,aAAY,G,IAOnB,eAAA6C,GAmBN,OAlBKr0K,KAAKg3K,0BACRh3K,KAAKg3K,wBAA0B,CAC7BlkG,OAAQ,GAAW4wF,gBACnBuT,kBAAmBj3K,KAAKkI,YAAYgvK,UAAU,qBAC9CC,gBAAiBn3K,KAAKkI,YAAYgvK,UAAU,0BAC5CE,4BAA6Bp3K,KAAKkI,YAAYgvK,UAAU,+BACxDG,cAAer3K,KAAKkI,YAAYgvK,UAAU,kBAC1CI,kBAAmBt3K,KAAKkI,YAAYgvK,UAAU,yCAC9CK,cAAev3K,KAAKkI,YAAYgvK,UAAU,iBAC1CM,mBAAoBx3K,KAAKkI,YAAYgvK,UAAU,sBAC/CO,gBAAiBz3K,KAAKkI,YAAYgvK,UAAU,mBAC5C3kH,KAAMvyD,KAAKkI,YAAYgvK,UAAU,QACjCQ,cAAe13K,KAAKkI,YAAYgvK,UAAU,iBAC1CS,QAAS33K,KAAKkI,YAAYgvK,UAAU,WACpCtF,gBAAiB5xK,KAAKkI,YAAYgvK,UAAU,qBAIzCl3K,KAAKg3K,uBACd,CASQ,uBAAA1D,EACN,UAAE1nG,IACF,OAAE26F,IAEG36F,GAML,GAAW61F,mBAAmB8E,EAAO1oG,IAAK,0BAA2B,CAAE+N,aACzE,CAQQ,sBAAAgoG,EAAuB,OAAErN,IAC1B,GAAW7E,eAAe6E,EAAO1oG,IAAK,CAAE9gB,QAAS,8BACxD,CASc,eAAA60H,EACZ,MAAE1mH,GACFq7G,G,0CAEA,IAAKr7G,EACH,OAGF,MAAM4kH,EAAU,IAAIngH,GACpBmgH,EAAQnmH,IAAMuB,EAAMvB,IAEpB,MAAMomH,EAAY,IAAI/+G,GACtB++G,EAAU9lH,KAAO,CAAC6lH,GAClBC,EAAUlsJ,SAAWqnC,EAAMrnC,UAAY,GACvCksJ,EAAUjsJ,SAAWonC,EAAMpnC,UAAY,GAEvC,MAAMqrJ,EAAa,IAAIx9G,GACvBw9G,EAAW3tK,MAAQ,EAAMgF,YAAY0kD,EAAMvB,MAAQuB,EAAMpkD,UAAU5C,QAAQ,SAAU,IACrFirK,EAAW1kH,SAAW,KACtB0kH,EAAW7hK,KAAOs5C,GAAWqE,MAC7BkkH,EAAWjkH,MAAQ6kH,QAEb/vK,KAAKw9D,cAAc8iE,qBAAqB,CAC5CthE,OAAQmwG,EACR3kH,cAAe2kH,EAAW3kH,sBAGtBxqD,KAAKsqK,2BAA2B/D,EAAO1oG,IAAK,CAAE8B,SAAUwvG,EAAW/oK,WACnE,GAAWu7J,YAAY,yCAC/B,G,CAKQ,8BAAA8S,GACN,GAAWpS,gBAAgB,qBAAsBriK,KAAKktK,wBACtD,GAAWzN,YAAYzG,OAAO3C,QAAQuhB,UAAW53K,KAAK8zK,oBACxD,CAmEQ,gBAAAG,CAAiBlB,GACvB,GAAIA,EAAKvxK,OAAS0vK,GAGhB,OAFAlxK,KAAK63K,wBAAwB73K,KAAK40K,sBAClC50K,KAAK40K,gBAAkB7B,GAIrBA,EAAKvxK,OAAS0vK,KAChBlxK,KAAK63K,wBAAwB73K,KAAKy1K,mBAClCz1K,KAAKy1K,kBAAoB1C,EAE7B,CASQ,uBAAA8E,CAAwB9E,GAC1BA,GACF/yK,KAAKsxK,aAAa12J,KAAKm4J,EAE3B,G,uSCzvBa,MAAM+E,GACnB,WAAAt4K,CACUu4K,EACAC,EACAC,GAFA,KAAAF,KAAAA,EACA,KAAAC,uBAAAA,EACA,KAAAC,kBAAAA,EAmCF,KAAAC,2BAAoC7X,GAAqB,mCAC/C,MAAZA,GAAoBA,EAAW,IAInCrgK,KAAKm4K,gBAAkB9X,QACjBrgK,KAAKo4K,uBACXp4K,KAAK+3K,KAAKn7I,iBAAiB1E,KAAK,iBAClC,IAKQ,KAAAmgJ,qBAAuB,IAAY,yCACnCr4K,KAAKo4K,uBACXp4K,KAAK+3K,KAAKn7I,iBAAiB1E,KAAK,aAClC,IAKQ,KAAAogJ,oBAAsB,IAAY,mCACpCt4K,KAAK+3K,KAAKQ,gBAGdv4K,KAAK+3K,KAAKQ,eAAgB,QAEpBv4K,KAAKg4K,uBAAuB1L,+BAC5BtsK,KAAKo4K,uBACXp4K,KAAK+3K,KAAKn7I,iBAAiB1E,KAAK,cAClC,IASQ,KAAAsgJ,mBAAqB,CAC3Bzb,EACA0b,EACA56G,IACG,mCAC6B,IAAI3wD,IAAI,CAAC,UAAW,aACxB4jD,IAAI2nH,EAAWv3J,SACzClhB,KAAKi4K,kBAAkBzD,kBAAkBzX,GAGvC/8J,KAAKm4K,gBAAkB,GAAKt6G,EAAIwiG,WAAargK,KAAKm4K,iBAIjDt6G,EAAIqjG,eAIHlhK,KAAKi4K,kBAAkBtF,uBAEzB3yK,KAAK+3K,KAAKW,eAGd14K,KAAK+3K,KAAKW,cAAe,QAEnB14K,KAAKg4K,uBAAuB1L,uBAAuBzuG,SACnD79D,KAAK+3K,KAAKY,qBACV34K,KAAK+3K,KAAKa,cAChB54K,KAAK+3K,KAAKn7I,iBAAiB1E,KAAK,eAClC,IAOQ,KAAA2gJ,mBAA4B9b,GAAkB,mCACpD/8J,KAAKi4K,kBAAkBzD,kBAAkBzX,EAC3C,IAMQ,KAAAqb,qBAAuB,IAAY,yCACnCxsK,QAAQ+d,IAAI,CAChB3pB,KAAK+3K,KAAKY,eACV34K,KAAK+3K,KAAKa,cACV54K,KAAKi4K,kBAAkBtF,wBAE3B,GA3HG,CAOG,IAAAxxK,G,0CACC63J,OAAO4E,MAAS5E,OAAOwH,UAM5BxgK,KAAKo4K,uBACLp4K,KAAK84K,yBACP,G,CAKQ,sBAAAA,GACN9f,OAAOwH,QAAQuY,eAAetZ,YAAYz/J,KAAKk4K,4BAC/Clf,OAAO4E,KAAKob,YAAYvZ,YAAYz/J,KAAKq4K,sBACzCrf,OAAO4E,KAAKqb,WAAWxZ,YAAYz/J,KAAKs4K,qBACxCtf,OAAO4E,KAAKgC,UAAUH,YAAYz/J,KAAKw4K,oBACvCxf,OAAO4E,KAAKsb,UAAUzZ,YAAYz/J,KAAK64K,mBACzC,E,2SC/Ba,MAAMM,GAInB,WAAA35K,CACE4iB,EACQo7C,EACAoG,EACSw1G,GAFT,KAAA57G,cAAAA,EACA,KAAAoG,YAAAA,EACS,KAAAw1G,WAAAA,EAPX,KAAAC,oBAAmC,IAAInsK,IAAY,IASzDlN,KAAKm4J,UAAY/1I,EAAqB+1I,WACxC,CAEA,cAAAmhB,GACEt5K,KAAKo5K,WAAWG,eAAe9Z,aAC7B,CAAO7qE,EAASj1D,IAAa,mCAC3B,GAAKi1D,EAAQ3tF,MAAOjH,KAAKq5K,oBAAoBvoH,IAAI8jC,EAAQ4kF,WAAzD,CAOA,GADAx5K,KAAKq5K,oBAAoB1oH,IAAIikC,EAAQ4kF,WACjCx5K,KAAKm4J,UAEP,OAAO,IAAIvsJ,SAAQ,CAAOC,EAASi0F,IAAW,yCACtC9/F,KAAKy5K,uBAAuB7kF,EAAQ3tF,IAAK4E,EAASi0F,EAC1D,YAEM9/F,KAAKy5K,uBAAuB7kF,EAAQ3tF,IAAK04B,EAAUA,E,MAZrDA,GACFA,EAAS,KAaf,KACA,CAAEi3C,KAAM,CAAC,aAAc,gBACvB,CAAC52E,KAAKm4J,UAAY,WAAa,kBAGjCn4J,KAAKo5K,WAAWM,YAAYja,aAAa7qE,GAAY50F,KAAK25K,oBAAoB/kF,IAAU,CACtFhe,KAAM,CAAC,gBAET52E,KAAKo5K,WAAWQ,gBAAgBna,aAC7B7qE,GAAiB50F,KAAK25K,oBAAoB/kF,IAC3C,CACEhe,KAAM,CAAC,eAGb,CAGc,sBAAA6iG,CAAuBjyK,EAAgB2uF,EAAmB51F,G,0CACtE,UAAWP,KAAK4jE,YAAYnkC,iBAAmBvD,GAAqBoD,SAClE/+B,SAIF,IACE,MAAMo6E,QAAgB36E,KAAKw9D,cAAcy+D,sBACvCz0H,EACA,KACAkvC,IAEF,GAAe,MAAXikC,GAAsC,IAAnBA,EAAQl4E,OAE7B,YADAlC,IAIF41F,EAAQ,CACN0jF,gBAAiB,CACfh2J,SAAU82D,EAAQ,GAAGzvB,MAAMrnC,SAC3BC,SAAU62D,EAAQ,GAAGzvB,MAAMpnC,W,CAG/B,SACAvjB,G,CAEJ,G,CAEQ,mBAAAo5K,CAAoB/kF,GAC1B50F,KAAKq5K,oBAAoBz6H,OAAOg2C,EAAQ4kF,UAC1C,E,2SCtDK,MAAMM,GAkHX,WAAAt6K,CACUkd,EACA0nE,EACAl8E,EACAqU,EACA0rH,GAJA,KAAAvrH,aAAAA,EACA,KAAA0nE,wBAAAA,EACA,KAAAl8E,YAAAA,EACA,KAAAqU,WAAAA,EACA,KAAA0rH,kCAAAA,EAtHV,KAAA8xC,aAAc,EACN,KAAAC,qBAA+C,CACrD,CACE5zK,GAAIytC,GACJkU,MAAO,aAET,CACE3hD,GAAI8sC,GACJ+mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,kBAE5B,CACElxB,GAAIktC,GACJ2mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,iBAE5B,CACElxB,GAAIitC,GACJ4mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,iBAE5B,CACElxB,GAAImtC,GACJ0mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,wBAC1B4iJ,oBAAoB,GAEtB,CACE9zK,GAAI0tC,GAAe,EACnBxmC,KAAM,YACN2sK,SAAUpmI,IAEZ,CACEztC,GAAI+sC,GACJ8mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,qBAE5B,CACElxB,GAAI6sC,GACJgnI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,iBAE5B,CACElxB,GAAI0tC,GAAe,EACnBxmC,KAAM,YACN2sK,SAAUpmI,IAEZ,CACEztC,GAAIutC,GACJsmI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,2BAE5B,CACElxB,GAAIgtC,GACJ6mI,SAAUpmI,GACVkU,MAAO/nD,KAAKkI,YAAYovB,EAAE,2BAGtB,KAAA6iJ,wBAAkE,CACxE,CACE/zK,GAAI,GAAG6sC,YACPlkB,SAAS,EACTkrJ,SAAUhnI,GACV8U,MAAO/nD,KAAKkI,YAAYovB,EAAE,WAC1BhqB,KAAM,UAER,CACElH,GAAI,GAAG6sC,MAAoBa,KAC3BmmI,SAAUhnI,GACV3lC,KAAM,aAER,CACElH,GAAI,GAAG6sC,MAAoBO,KAC3BymI,SAAUhnI,GACV8U,MAAO/nD,KAAKkI,YAAYovB,EAAE,eAC1BhqB,KAAM,WAGF,KAAA8sK,6BAAuE,CAC7E,CACEh0K,GAAI,GAAG+sC,YACPpkB,SAAS,EACTkrJ,SAAU9mI,GACV4U,MAAO/nD,KAAKkI,YAAYovB,EAAE,gBAC1BhqB,KAAM,UAER,CACElH,GAAI,GAAG+sC,MAAwBW,KAC/BmmI,SAAU9mI,GACV7lC,KAAM,aAER,CACElH,GAAI,GAAG+sC,MAAwBM,KAC/BwmI,SAAU9mI,GACV4U,MAAO/nD,KAAKkI,YAAYovB,EAAE,mBAC1BhqB,KAAM,WAGF,KAAA+sK,yBAAmE,CACzE,CACEj0K,GAAI,GAAG8sC,YACPnkB,SAAS,EACTkrJ,SAAU/mI,GACV6U,MAAO/nD,KAAKkI,YAAYovB,EAAE,oBAC1BhqB,KAAM,UAER,CACElH,GAAI,GAAG8sC,MAAeY,MACtBmmI,SAAU/mI,GACV5lC,KAAM,aAUP,CAMG,IAAAnM,G,0CAEJ,WAD0B,OAAenB,KAAKokF,wBAAwB3uC,qBAGpE,aADMqkI,GAAuBQ,aACtB,EAGT,GAAIt6K,KAAK+5K,YACP,OAAO,EAET/5K,KAAK+5K,aAAc,EAEnB,IACE,IAAK,MAAMroK,KAAW1R,KAAKg6K,qBAEvBtoK,EAAQwoK,4BACA,OAAel6K,KAAKioI,kCAAkC9uF,oCAKzDznC,EAAQwoK,yBACTJ,GAAuB5rK,OAAO,OAAD,wBAAMwD,GAAO,CAAE6oK,SAAU,CAAC,U,CAE/D,MAAOh6K,GACPP,KAAKuc,WAAWlc,QAAQE,EAAMT,Q,SAE9BE,KAAK+5K,aAAc,C,CAErB,OAAO,CACT,G,CAsBA,gBAAaO,G,0CACX,OAAO,IAAI1uK,SAAc,CAACC,EAASi0F,KACjCk5D,OAAOqN,aAAaiU,WAAU,KACxBthB,OAAO3C,QAAQ8F,UACjBr8D,EAAOk5D,OAAO3C,QAAQ8F,WAIxBtwJ,GAAS,GACT,GAEN,G,CAEA,aAAO8P,CAAO6+J,GACZ,OAAO,IAAI5uK,SAAc,CAACC,EAASi0F,KACjCk5D,OAAOqN,aAAa1qJ,OAAO6+J,GAAY,KACjCxhB,OAAO3C,QAAQ8F,UACjBr8D,EAAOk5D,OAAO3C,QAAQ8F,WAIxBtwJ,GAAS,GACT,GAEN,CAEM,WAAA4uK,CAAY1yH,EAAe2yH,EAAkB17G,G,sDACjD,IACE,MAAM27G,EAAiBb,GAAuBc,yBAAyB7yH,GAEjE8yH,EAAyBZ,GAAqB,mCAClD,MAAMO,EAAa,GAAGP,KAAYS,IAElC,aAAaZ,GAAuB5rK,OAAO,CACzCZ,KAAM,SACNlH,GAAIo0K,EACJP,WACAlyH,MAAO4yH,EACPJ,SAAU,CAAC,QAEf,IAGGv7G,IACAA,EAAO1xD,OAASs5C,GAAWqE,OAAU,EAAMxiD,cAA0B,QAAZ,EAAAu2D,EAAO9T,aAAK,eAAEpnC,mBAElE+2J,EAAgB3nI,KAEE,QAApB,EAAA8rB,aAAM,EAANA,EAAQrU,oBAAY,kBAChBkwH,EAAgBxnI,MAKvB2rB,IACAA,EAAO1xD,OAASs5C,GAAWqE,OAAU,EAAMxiD,cAA0B,QAAZ,EAAAu2D,EAAO9T,aAAK,eAAErnC,mBAElEg3J,EAAgBvnI,aAGO,OAC7BtzC,KAAKioI,kCAAkC9uF,4BAEf6lB,GAAW,EAAMv2D,cAA0B,QAAZ,EAAAu2D,EAAO9T,aAAK,eAAEnB,cAC/D8wH,EAAgBtnI,KAGlByrB,GAAUA,EAAO1xD,OAASs5C,GAAWyE,MAASqvH,IAAahnI,WACzDmnI,EAAgB5nI,KAGlB+rB,GAAUA,EAAO1xD,OAASs5C,GAAW2E,UAAamvH,IAAahnI,WAC7DmnI,EAAgB1nI,I,CAExB,MAAO5yC,GACPP,KAAKuc,WAAWlc,QAAQE,EAAMT,Q,KAIlC,+BAAO86K,CAAyB7yH,GAC9B,OAAOA,EAAM7jD,QAAQ,KAAM,KAC7B,CAEM,QAAA42K,G,0CACJ,SAAU96K,KAAKmB,OAAQ,CACrB,MAAMm/C,QAAetgD,KAAK0c,aAAao1F,qBACvC9xG,KAAKy6K,YACHz6K,KAAKkI,YAAYovB,EAAEgpB,EAAS,kBAAoB,oBAChD1M,IACAkL,OAAOv+C,GAAUP,KAAKuc,WAAWlc,QAAQE,EAAMT,U,CAErD,G,CAEM,OAAAi7K,G,0CACJ,IACE,IAAK,MAAMC,KAAUh7K,KAAKm6K,8BAClBL,GAAuB5rK,OAAO8sK,E,CAEtC,MAAOz6K,GACPP,KAAKuc,WAAWlc,QAAQE,EAAMT,Q,CAElC,G,CAEM,YAAAm7K,G,0CACJ,IACE,IAAK,MAAMD,KAAUh7K,KAAKo6K,mCAClBN,GAAuB5rK,OAAO8sK,E,CAEtC,MAAOz6K,GACPP,KAAKuc,WAAWlc,QAAQE,EAAMT,Q,CAElC,G,CAEM,QAAAo7K,G,0CACJ,IACE,IAAK,MAAMF,KAAUh7K,KAAKq6K,+BAClBP,GAAuB5rK,OAAO8sK,SAGhCh7K,KAAKy6K,YAAYz6K,KAAKkI,YAAYovB,EAAE,gBAAiBoc,G,CAC3D,MAAOnzC,GACPP,KAAKuc,WAAWlc,QAAQE,EAAMT,Q,CAElC,G,EA1Ie,GAAAoO,OAAgBwD,GAAkD,qCAC/E,GAAKsnJ,OAAOqN,aAIZ,OAAO,IAAIz6J,SAAc,CAACC,EAASi0F,KACjCk5D,OAAOqN,aAAan4J,OAAOwD,GAAS,KAClC,GAAIsnJ,OAAO3C,QAAQ8F,UACjB,OAAOr8D,EAAOk5D,OAAO3C,QAAQ8F,WAE/BtwJ,GAAS,GACT,GAEN,I,2SCnMK,MAAMsvK,GACX,WAAA37K,CACU47K,EACAx3G,EACApG,GAFA,KAAA49G,uBAAAA,EACA,KAAAx3G,YAAAA,EACA,KAAApG,cAAAA,CACP,CAEG,MAAA9iD,CAAOzT,G,0CACX,GAAIjH,KAAKo7K,uBAAuBrB,YAC9B,OAGF,MAAM5rE,QAAmBnuG,KAAK4jE,YAAYnkC,gBAE1C,SADMq6I,GAAuBQ,YACzBnsE,IAAejyE,GAAqBoD,SAItC,kBADMt/B,KAAKo7K,uBAAuBN,YAKpC,WAD0B96K,KAAKo7K,uBAAuBj6K,QAEpD,OAGF,MAAMw5E,QAAgB36E,KAAKw9D,cAAcy+D,sBAAsBh1H,EAAK,CAClE2/C,GAAWyE,KACXzE,GAAW2E,WAEbovB,EAAQv9C,MAAK,CAACh1B,EAAGC,IAAMrI,KAAKw9D,cAAckiE,8BAA8Bt3H,EAAGC,KAE3E,MAAMuzH,EAA6DjhD,EAAQ17C,QACzE,CAACo8I,EAAer8G,KACd,KAAKA,aAAM,EAANA,EAAQ1xD,MACX,OAAO+tK,EAGT,MAAMC,EAAwBD,EAAcr8G,EAAO1xD,OAAiC,GAEpF,OAAO,OAAP,wBACK+tK,GAAa,CAChB,CAACr8G,EAAO1xD,MAAO,IAAIguK,EAAuBt8G,IAAO,GAGrD,CACE,CAACpY,GAAWqE,OAAQ,GACpB,CAACrE,GAAWyE,MAAO,GACnB,CAACzE,GAAW2E,UAAW,KAIqB,IAA5CqwE,EAAeh1E,GAAWqE,OAAOxoD,eAC7BzC,KAAKo7K,uBAAuBF,YAGe,IAA/Ct/C,EAAeh1E,GAAW2E,UAAU9oD,eAChCzC,KAAKo7K,uBAAuBH,gBAGW,IAA3Cr/C,EAAeh1E,GAAWyE,MAAM5oD,eAC5BzC,KAAKo7K,uBAAuBL,WAGpC,IAAK,MAAM/7G,KAAU2b,QACb36E,KAAKu7K,gBAAgBv8G,EAE/B,G,CAEc,eAAAu8G,CAAgBv8G,G,kDAC5B,GACY,MAAVA,IACC,IAAI9xD,IAAI,CAAC05C,GAAWqE,MAAOrE,GAAWyE,KAAMzE,GAAW2E,WAAWuF,IAAIkO,EAAO1xD,MAE9E,OAGF,IAAIy6C,EAAQiX,EAAOx9D,KAEfw9D,EAAO1xD,OAASs5C,GAAWqE,QAAU,EAAMxiD,cAAcs/C,KAAsB,QAAZ,EAAAiX,EAAO9T,aAAK,eAAErnC,YACnFkkC,GAAS,KAAKiX,EAAO9T,MAAMrnC,aAGzBm7C,EAAO1xD,OAASs5C,GAAWyE,OAAmB,QAAX,EAAA2T,EAAO1T,YAAI,eAAEqB,YAClD5E,GAAS,IAAIiX,EAAO1T,KAAKqB,kBAGrB3sD,KAAKo7K,uBAAuBX,YAAY1yH,EAAOiX,EAAO54D,GAAI44D,E,gTCvD7D,MAAMw8G,GACX,WAAAh8K,CACU6lF,EACAo2F,EACAC,EACA93G,EACApG,EACAm+G,EACAC,EACAC,EACA1/J,GARA,KAAAkpE,gBAAAA,EACA,KAAAo2F,4BAAAA,EACA,KAAAC,eAAAA,EACA,KAAA93G,YAAAA,EACA,KAAApG,cAAAA,EACA,KAAAm+G,YAAAA,EACA,KAAAC,uBAAAA,EACA,KAAAC,wBAAAA,EACA,KAAA1/J,eAAAA,CACP,CAEG,GAAAsnE,CAAItjF,EAAuC09D,G,0CAC/C,GAAKA,EAIL,OAAQ19D,EAAKq6K,YACX,KAAK7mI,SACG3zC,KAAKy7K,4BAA4B59G,GACvC,MACF,KAAKzqB,GACHpzC,KAAKqlF,gBAAgB,CAAEqY,WAAY19F,KAAK87K,cAAcj+G,EAAK19D,GAAO09D,IAAKA,IACvE,MACF,cACQ79D,KAAKwmK,aAAarmK,EAAM09D,GAEpC,G,CAEM,YAAA2oG,CAAarmK,EAAuC09D,G,0CACxD,IAAKA,EACH,OAGF,UAAW79D,KAAK4jE,YAAYnkC,iBAAmBvD,GAAqBoD,SAAU,CAC5E,MAAMy3I,EAAoD,CACxDtQ,eAAgB,CACd3mK,QAAS,CAAEi9C,QAASnJ,GAAqB8yH,uBAAwBvmK,GACjEomK,OAAQ,CAAE1oG,IAAKA,IAEjB90D,OAAQ,2BASV,aAPM,GAAW04J,mBACf5jG,EACA,uCACAk5G,cAGIvN,GAAiB3rG,G,CAMzB,MAAM28G,EAAcr6K,EAAKq6K,WAAsB7yK,MAAM,KAAK,GAC1D,IAAIq3D,EACJ,MAAM+8G,EAAuB,CAACroI,GAAiBD,GAAoBD,IAAgBtD,SACjFsqI,GAGF,GAAIuB,QAEG,GAAIvB,IAAe5mI,GAAqB,CAC7C,MAAMooI,EACJ77K,EAAK87K,mBAAqB9oI,GACtB,CAACyT,GAAW2E,UACZprD,EAAK87K,mBAAqBhpI,GACxB,CAAC2T,GAAWyE,MACZ,GAUR2T,SALsBh/D,KAAKw9D,cAAcy+D,sBACvCp+D,EAAI52D,IACJ+0K,IAGe,E,KACZ,CAELh9G,SADsBh/D,KAAKw9D,cAAcyE,mBACxB/rC,MAAK,EAAG9vB,QAASA,IAAOo0K,G,CAG3C,IAAKx7G,IAAW+8G,EACd,OAGF,MAAMvgI,QAAqB,OACzBx7C,KAAKmc,eAAe6Q,eAAe9gB,MAAK,QAAK9D,GAAMA,aAAC,EAADA,EAAGhC,OAGxD,aADMpG,KAAKmc,eAAewhB,mBAAmB6d,EAAc,IAAIhvC,MACvDrM,EAAK87K,kBACX,KAAK/oI,GACL,KAAKC,GACL,KAAKF,GAAkB,CACrB,MAAMs3H,EAAavqK,KAAKk8K,sBAAsB1B,GAE9C,GAAIjQ,EAAY,OACRD,GAA2BzsG,EAAK,CAAE0sG,eACxC,K,QAGQvqK,KAAKo1K,2BAA2Bp2G,UAClCqrG,GAAoCxsG,EAAK,CAC7C8B,SAAUX,EAAO54D,GAEjB6wG,OAAQ/jE,WAGJlzC,KAAK07K,eAAe79G,EAAKmB,GAGjC,K,CAEF,KAAK1rB,GACH,GAAIknI,IAAe9mI,GAAiB,OAC5B42H,GAA2BzsG,EAAK,CAAE0sG,WAAY3jH,GAAWqE,QAC/D,K,CAGFjrD,KAAKqlF,gBAAgB,CAAEqY,KAAM1+B,EAAO9T,MAAMrnC,SAAUg6C,IAAKA,IACzD,MACF,KAAKxqB,GACH,GAAImnI,IAAe9mI,GAAiB,OAC5B42H,GAA2BzsG,EAAK,CAAE0sG,WAAY3jH,GAAWqE,QAC/D,K,QAGQjrD,KAAKo1K,2BAA2Bp2G,UAClCqrG,GAAoCxsG,EAAK,CAC7C8B,SAAUX,EAAO54D,GACjB6wG,OAAQ5jE,MAGVrzC,KAAKqlF,gBAAgB,CAAEqY,KAAM1+B,EAAO9T,MAAMpnC,SAAU+5C,IAAKA,IAGzD79D,KAAK47K,uBAAuBjuE,QAAQvmF,GAAU+0J,4BAA6Bn9G,EAAO54D,KAGpF,MACF,KAAKmtC,GACH,GAAIinI,IAAe9mI,GAAiB,OAC5B42H,GAA2BzsG,EAAK,CAAE0sG,WAAY3jH,GAAWqE,QAC/D,K,QAGQjrD,KAAKo1K,2BAA2Bp2G,UAClCqrG,GAAoCxsG,EAAK,CAC7C8B,SAAUX,EAAO54D,GACjB6wG,OAAQ1jE,KAGVvzC,KAAKqlF,gBAAgB,CACnBqY,WAAY19F,KAAK27K,YAAYjyC,QAAQ1qE,EAAO9T,MAAMnB,MAClD8T,IAAKA,IAMf,G,CAEc,0BAAAu3G,CAA2Bp2G,G,0CACvC,OACEA,EAAOhU,WAAanE,GAAmB0K,iBAChCvxD,KAAK67K,wBAAwBxqI,oCAExC,G,CAEQ,qBAAA6qI,CAAsB1B,GAC5B,OAAOA,IAAe/mI,GAClBmT,GAAW2E,SACXivH,IAAehnI,GACboT,GAAWyE,KACXmvH,IAAe9mI,GACbkT,GAAWqE,MACX,IACV,CAEc,aAAA6wH,CAAcj+G,EAAsB19D,G,0CAChD,OAAO,IAAIyL,SAAgB,CAACC,EAASi0F,KACnC,GAAW8hE,gBACT/jG,EAAIz3D,GACJ,CAAE22C,QAAS,qBACX,CAAEigH,QAAS78J,EAAK68J,UACfz6I,IACKy2I,OAAO3C,QAAQ8F,UACjBr8D,EAAOk5D,OAAO3C,QAAQ8F,WAIxBtwJ,EAAQ0W,EAAW,GAEtB,GAEL,G,kBCjPF,MAAM65J,GACY,gCCcH,MAAMC,GAArB,cACE,KAAA3d,OAAuB,GACvB,KAAA4d,WAAuC,CAAC,EACxC,KAAA1lE,SAAgB,CAAC,EACjB,KAAA2lE,WAAkB,IAIpB,ECvBO,MAAMC,IACK,GAAAC,mBAA+B,CAE7C,WACA,YACA,QACA,gBACA,SACA,iBACA,SACA,UACA,cACA,WACA,QAEA,eACA,gBACA,gBACA,iBACA,aACA,eAGc,GAAAC,eAA2B,CACzC,OACA,MACA,MACA,WACA,UACA,iBACA,OACA,UACA,MACA,WACA,WACA,UACA,MACA,gBACA,YACA,QACA,gBACA,oBAGc,GAAAC,iBAA6B,CAAC,SAAU,QAAS,OAAQ,MAEzD,GAAAC,gBAA4B,CAAC,UAAW,eAAgB,UAExD,GAAAC,yBAAqC,IAChDL,GAAkBI,gBACrB,mBAGc,GAAAE,2BAAuC,CACrD,SACA,OACA,SACA,QACA,QACA,UAGc,GAAAC,sBAAkC,CAChD,QACA,cACGP,GAAkBM,4BAGP,GAAAE,qBAAiC,CAC/C,cACGR,GAAkBO,uBAIlB,MAAME,IACK,GAAAC,eAA2B,CACzC,mBACA,cACA,WACA,SACA,YACA,cACA,aACA,YACA,gBAGc,GAAAC,uBAAmC,IAC9CF,GAA4BC,eAC/B,eAGc,GAAAE,qBAAiC,CAC/C,UACA,YACA,kBACA,aACA,OACA,OAGc,GAAAC,0BAAsC,CACpD,UACA,YACA,kBACA,aACA,UAGc,GAAAC,qBAAiC,CAC/C,YACA,SACA,cACA,WACA,SACA,KACA,QACA,UACA,cACA,eACA,QACA,eACA,YACA,SACA,YAGc,GAAAC,0BAAsC,CACpD,YACA,SACA,cACA,WACA,QACA,UACA,eACA,YACA,UAGc,GAAAC,qBAAiC,CAC/C,SACA,WACA,gBACA,kBACA,QACA,UACA,cACA,cACA,WACA,aACA,SACA,QACA,UACA,QACA,UACA,kBACA,0BACA,mBAGc,GAAAC,0BAAsC,CACpD,QACA,UACA,QACA,UACA,kBACA,2BAGc,GAAAC,sBAAkC,CAChD,YACA,eACA,WACA,aACA,QACA,UACA,SACA,cACA,YACA,wBACA,mBACA,QACA,OACA,UACA,SACA,cACA,YACA,SACA,QACA,eACA,YACA,eACA,YACA,oBACA,iBACA,oBACA,iBACA,gBACA,kBACA,aACA,eACA,0BACA,wBACA,qBACA,UACA,cACA,cACA,eACA,UAGc,GAAAC,qBAAiC,CAC/C,WACA,cACA,UACA,YACA,QACA,UACA,SACA,cACA,YACA,uBACA,kBACA,QACA,OACA,UACA,SACA,cACA,YACA,SACA,QACA,UACA,YACA,gBACA,cACA,cACA,YACA,cACA,YACA,mBACA,iBACA,mBACA,iBACA,cACA,gBACA,iBACA,mBACA,yBACA,uBACA,cACA,qBACA,uBACA,gBACA,gBACA,UAGc,GAAAC,cAA0B,CACxC,MACA,MACA,OACA,SACA,SACA,WACA,WACA,MACA,MACA,OACA,MACA,OACA,UACA,YACA,gBACA,gBACA,SACA,aACA,oBACA,MACA,OAGc,GAAAC,oBAAgC,CAC9C,UACA,YACA,aACA,WACA,WAKc,GAAAC,UAAY,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3C,GAAAC,cAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/C,GAAAC,aAAe,CAAC,OAAQ,OAAQ,OAAQ,KAAM,OAAQ,QAGjE,MAAMC,IACK,GAAAC,mBAA+B,CAC7C,mBACA,cACA,WACA,SACA,YACA,cACA,aACA,YACA,gBAGc,GAAAC,mBAA+B,CAAC,OAAQ,YAAa,aAErD,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","sources":["webpack:///webpack/runtime/chunk loaded","webpack:///webpack/runtime/create fake namespace object","webpack:///../../libs/common/src/platform/enums/log-level-type.enum.ts","webpack:///../../libs/common/src/platform/services/console-log.service.ts","webpack:///../../libs/common/src/auth/enums/authentication-type.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/token-two-factor.request.ts","webpack:///../../libs/common/src/platform/misc/utils.ts","webpack:///../../libs/common/src/auth/services/webauthn-login/request/webauthn-login-response.request.ts","webpack:///../../libs/common/src/auth/services/webauthn-login/request/webauthn-login-assertion-response.request.ts","webpack:///../../libs/common/src/platform/enums/encryption-type.enum.ts","webpack:///../../libs/common/src/platform/enums/file-upload-type.enum.ts","webpack:///../../libs/common/src/platform/enums/hash-purpose.enum.ts","webpack:///../../libs/common/src/platform/enums/html-storage-location.enum.ts","webpack:///../../libs/common/src/platform/enums/kdf-type.enum.ts","webpack:///../../libs/common/src/auth/models/domain/kdf-config.ts","webpack:///../../libs/common/src/platform/misc/range-with-default.ts","webpack:///../../libs/common/src/platform/enums/key-suffix-options.enum.ts","webpack:///../../libs/common/src/platform/enums/storage-location.enum.ts","webpack:///../../libs/common/src/platform/enums/theme-type.enum.ts","webpack:///../../libs/common/src/platform/models/domain/symmetric-crypto-key.ts","webpack:///../../libs/auth/src/common/models/domain/login-credentials.ts","webpack:///../../libs/auth/src/common/models/domain/user-decryption-options.ts","webpack:///../../libs/common/src/platform/models/domain/enc-string.ts","webpack:///../../libs/common/src/platform/state/derive-definition.ts","webpack:///../../libs/common/src/platform/state/state.provider.ts","webpack:///../../libs/common/src/platform/state/deserialization-helpers.ts","webpack:///../../libs/common/src/platform/state/key-definition.ts","webpack:///../../libs/common/src/platform/state/user-key-definition.ts","webpack:///../../libs/common/src/platform/state/state-definition.ts","webpack:///../../libs/common/src/platform/state/state-definitions.ts","webpack:///../../libs/common/src/platform/state/state-event-registrar.service.ts","webpack:///../../libs/common/src/platform/state/state-event-runner.service.ts","webpack:///../../libs/auth/src/common/services/pin/pin.service.implementation.ts","webpack:///../../libs/auth/src/common/services/login-email/login-email.service.ts","webpack:///../../libs/common/src/models/response/base.response.ts","webpack:///../../libs/common/src/models/response/error.response.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/device.request.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/token.request.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/password-token.request.ts","webpack:///../../libs/common/src/auth/enums/two-factor-provider-type.ts","webpack:///../../libs/common/src/auth/models/domain/force-set-password-reason.ts","webpack:///../../libs/common/src/enums/client-type.enum.ts","webpack:///../../libs/common/src/enums/device-type.enum.ts","webpack:///../../libs/common/src/auth/models/response/master-password-policy.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/key-connector-user-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/trusted-device-user-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/webauthn-prf-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/user-decryption-options.response.ts","webpack:///../../libs/common/src/auth/models/response/identity-token.response.ts","webpack:///../../libs/common/src/enums/event-system-user.enum.ts","webpack:///../../libs/common/src/enums/event-type.enum.ts","webpack:///../../libs/common/src/enums/http-status-code.enum.ts","webpack:///../../libs/common/src/enums/integration-type.enum.ts","webpack:///../../libs/common/src/enums/native-messaging-version.enum.ts","webpack:///../../libs/common/src/enums/notification-type.enum.ts","webpack:///../../libs/common/src/enums/product-type.enum.ts","webpack:///../../libs/common/src/platform/models/domain/account.ts","webpack:///../../libs/auth/src/common/login-strategies/auth-request-login.strategy.ts","webpack:///../../libs/common/src/platform/models/domain/domain-base.ts","webpack:///../../libs/common/src/admin-console/models/domain/master-password-policy-options.ts","webpack:///../../libs/auth/src/common/login-strategies/password-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/sso-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/sso-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/user-api-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/user-api-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/webauthn-login-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/webauthn-login.strategy.ts","webpack:///../../libs/auth/src/common/services/login-strategies/login-strategy.state.ts","webpack:///../../libs/auth/src/common/services/user-decryption-options/user-decryption-options.service.ts","webpack:///../../libs/common/src/auth/models/domain/admin-auth-req-storable.ts","webpack:///../../libs/common/src/auth/models/request/passwordless-auth.request.ts","webpack:///../../libs/auth/src/common/services/auth-request/auth-request.service.ts","webpack:///../../libs/common/src/admin-console/models/data/organization.data.ts","webpack:///../../libs/common/src/admin-console/enums/organization-api-key-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-connection-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-user-status-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-user-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/policy-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-user-status-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-user-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/scim-provider-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-status-type.enum.ts","webpack:///../../libs/common/src/admin-console/models/domain/organization.ts","webpack:///../../libs/common/src/admin-console/services/organization/organization.service.ts","webpack:///../../libs/common/src/models/response/list.response.ts","webpack:///../../libs/common/src/admin-console/models/data/policy.data.ts","webpack:///../../libs/common/src/admin-console/models/domain/policy.ts","webpack:///../../libs/common/src/admin-console/models/response/policy.response.ts","webpack:///../../libs/common/src/admin-console/services/policy/policy-api.service.ts","webpack:///../../libs/common/src/admin-console/models/domain/reset-password-policy-options.ts","webpack:///../../libs/common/src/admin-console/services/policy/policy.service.ts","webpack:///../../libs/common/src/admin-console/models/domain/provider.ts","webpack:///../../libs/common/src/admin-console/services/provider.service.ts","webpack:///../../libs/common/src/auth/enums/authentication-status.ts","webpack:///../../libs/common/src/auth/abstractions/account.service.ts","webpack:///../../libs/common/src/auth/services/account.service.ts","webpack:///../../libs/common/src/auth/services/auth.service.ts","webpack:///../../libs/common/src/models/request/update-avatar.request.ts","webpack:///../../libs/common/src/auth/services/avatar.service.ts","webpack:///../../libs/common/src/auth/models/request/secret-verification.request.ts","webpack:///../../libs/common/src/auth/models/request/update-devices-trust.request.ts","webpack:///../../libs/common/src/auth/services/device-trust.service.implementation.ts","webpack:///../../libs/common/src/auth/abstractions/devices/views/device.view.ts","webpack:///../../libs/common/src/auth/services/devices/devices.service.implementation.ts","webpack:///../../libs/common/src/auth/abstractions/devices/responses/device.response.ts","webpack:///../../libs/common/src/auth/models/response/protected-device.response.ts","webpack:///../../libs/common/src/auth/services/devices/requests/trusted-device-keys.request.ts","webpack:///../../libs/common/src/auth/services/devices-api.service.implementation.ts","webpack:///../../libs/common/src/auth/services/kdf-config.service.ts","webpack:///../../libs/common/src/models/request/keys.request.ts","webpack:///../../libs/common/src/auth/models/request/key-connector-user-key.request.ts","webpack:///../../libs/common/src/auth/models/request/set-key-connector-key.request.ts","webpack:///../../libs/common/src/auth/services/key-connector.service.ts","webpack:///../../libs/common/src/auth/services/master-password/master-password.service.ts","webpack:///../../libs/common/src/auth/services/sso-login.service.ts","webpack:///../../libs/common/src/enums/vault-timeout-action.enum.ts","webpack:///../../libs/common/src/types/vault-timeout.type.ts","webpack:///../../libs/common/src/auth/services/token.state.ts","webpack:///../../libs/common/src/auth/services/token.service.ts","webpack:///../../libs/auth/src/common/utilities/decode-jwt-token-to-json.utility.ts","webpack:///../../libs/common/src/auth/enums/verification-type.ts","webpack:///../../libs/common/src/auth/services/user-verification/user-verification-api.service.ts","webpack:///../../libs/common/src/auth/models/request/verify-otp.request.ts","webpack:///../../libs/common/src/auth/services/user-verification/user-verification.service.ts","webpack:///../../libs/common/src/auth/types/verification.ts","webpack:///../../libs/common/src/autofill/constants/index.ts","webpack:///../../libs/common/src/autofill/services/autofill-settings.service.ts","webpack:///../../libs/common/src/autofill/services/badge-settings.service.ts","webpack:///../../libs/common/src/models/domain/domain-service.ts","webpack:///../../libs/common/src/autofill/services/domain-settings.service.ts","webpack:///../../libs/common/src/autofill/services/user-notification-settings.service.ts","webpack:///../../libs/common/src/billing/services/account/billing-account-profile-state.service.ts","webpack:///../../libs/common/src/platform/biometrics/biometric.state.ts","webpack:///../../libs/common/src/platform/biometrics/biometric-state.service.ts","webpack:///../../libs/common/src/platform/factories/account-factory.ts","webpack:///../../libs/common/src/platform/factories/global-state-factory.ts","webpack:///../../libs/common/src/platform/factories/state-factory.ts","webpack:///../../libs/common/src/platform/messaging/message.listener.ts","webpack:///../../libs/common/src/platform/messaging/message.sender.ts","webpack:///../../libs/common/src/platform/messaging/types.ts","webpack:///../../libs/common/src/platform/messaging/helpers.ts","webpack:///../../libs/common/src/platform/messaging/subject-message.sender.ts","webpack:///../../libs/common/src/platform/misc/lazy.ts","webpack:///../../libs/common/src/platform/misc/sequentialize.ts","webpack:///../../libs/common/src/platform/models/domain/global-state.ts","webpack:///../../libs/common/src/platform/services/app-id.service.ts","webpack:///../../libs/common/src/platform/models/response/server-config.response.ts","webpack:///../../libs/common/src/platform/services/config/config-api.service.ts","webpack:///../../libs/common/src/enums/feature-flag.enum.ts","webpack:///../../libs/common/src/platform/abstractions/config/server-config.ts","webpack:///../../libs/common/src/platform/abstractions/environment.service.ts","webpack:///../../libs/common/src/platform/misc/flags.ts","webpack:///../../libs/common/src/platform/models/data/server-config.data.ts","webpack:///../../libs/common/src/platform/services/config/default-config.service.ts","webpack:///../../libs/common/src/platform/services/container.service.ts","webpack:///../../libs/common/src/platform/models/domain/enc-array-buffer.ts","webpack:///../../libs/common/src/platform/models/domain/encrypted-object.ts","webpack:///../../libs/common/src/platform/services/cryptography/encrypt.service.implementation.ts","webpack:///../../libs/common/src/platform/services/cryptography/initializer-key.ts","webpack:///../../libs/common/src/vault/enums/cipher-type.ts","webpack:///../../libs/common/src/vault/enums/cipher-reprompt-type.ts","webpack:///../../libs/common/src/vault/enums/field-type.enum.ts","webpack:///../../libs/common/src/vault/enums/linked-id-type.enum.ts","webpack:///../../libs/common/src/vault/enums/secure-note-type.enum.ts","webpack:///../../libs/common/src/vault/models/data/attachment.data.ts","webpack:///../../libs/common/src/vault/models/data/card.data.ts","webpack:///../../libs/common/src/vault/models/data/field.data.ts","webpack:///../../libs/common/src/vault/models/data/identity.data.ts","webpack:///../../libs/common/src/vault/models/data/fido2-credential.data.ts","webpack:///../../libs/common/src/vault/models/data/login-uri.data.ts","webpack:///../../libs/common/src/vault/models/data/login.data.ts","webpack:///../../libs/common/src/vault/models/data/password-history.data.ts","webpack:///../../libs/common/src/vault/models/data/secure-note.data.ts","webpack:///../../libs/common/src/vault/models/data/cipher.data.ts","webpack:///../../libs/common/src/vault/models/view/attachment.view.ts","webpack:///../../libs/common/src/vault/linked-field-option.decorator.ts","webpack:///../../libs/common/src/vault/models/view/item.view.ts","webpack:///../../libs/common/src/vault/models/view/card.view.ts","webpack:///../../libs/common/src/vault/models/view/field.view.ts","webpack:///../../libs/common/src/vault/models/view/identity.view.ts","webpack:///../../libs/common/src/vault/models/view/fido2-credential.view.ts","webpack:///../../libs/common/src/platform/misc/safe-urls.ts","webpack:///../../libs/common/src/vault/models/view/login-uri.view.ts","webpack:///../../libs/common/src/vault/models/view/login.view.ts","webpack:///../../libs/common/src/vault/models/view/password-history.view.ts","webpack:///../../libs/common/src/vault/models/view/secure-note.view.ts","webpack:///../../libs/common/src/vault/models/view/cipher.view.ts","webpack:///../../libs/common/src/vault/models/domain/attachment.ts","webpack:///../../libs/common/src/vault/models/domain/card.ts","webpack:///../../libs/common/src/vault/models/domain/field.ts","webpack:///../../libs/common/src/vault/models/domain/identity.ts","webpack:///../../libs/common/src/vault/models/domain/fido2-credential.ts","webpack:///../../libs/common/src/vault/models/domain/login-uri.ts","webpack:///../../libs/common/src/vault/models/domain/login.ts","webpack:///../../libs/common/src/vault/models/domain/password.ts","webpack:///../../libs/common/src/vault/models/domain/secure-note.ts","webpack:///../../libs/common/src/vault/models/domain/cipher.ts","webpack:///../../libs/common/src/platform/services/cryptography/get-class-initializer.ts","webpack:///../../libs/common/src/platform/services/cryptography/multithread-encrypt.service.implementation.ts","webpack:///../../libs/common/src/platform/abstractions/fido2/fido2-authenticator.service.abstraction.ts","webpack:///../../libs/common/src/platform/services/fido2/cbor.ts","webpack:///../../libs/common/src/platform/services/fido2/ecdsa-utils.ts","webpack:///../../libs/common/src/platform/services/fido2/fido2-utils.ts","webpack:///../../libs/common/src/platform/services/fido2/guid-utils.ts","webpack:///../../libs/common/src/platform/services/fido2/fido2-authenticator.service.ts","webpack:///../../libs/common/src/platform/abstractions/fido2/fido2-client.service.abstraction.ts","webpack:///../../libs/common/src/platform/services/fido2/domain-utils.ts","webpack:///../../libs/common/src/platform/services/fido2/fido2-client.service.ts","webpack:///../../libs/common/src/platform/services/file-upload/azure-file-upload.service.ts","webpack:///../../libs/common/src/platform/services/file-upload/bitwarden-file-upload.service.ts","webpack:///../../libs/common/src/platform/services/file-upload/file-upload.service.ts","webpack:///../../libs/common/src/platform/services/key-generation.service.ts","webpack:///../../libs/common/src/state-migrations/migration-builder.ts","webpack:///../../libs/common/src/state-migrations/migrator.ts","webpack:///../../libs/common/src/state-migrations/migrations/10-move-ever-had-user-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/11-move-org-keys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/12-move-environment-state-to-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/13-move-provider-keys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/14-move-biometric-client-key-half-state-to-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/15-move-folder-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/16-move-last-sync-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/17-move-enable-passkeys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/18-move-autofill-settings-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/19-migrate-require-password-on-start.ts","webpack:///../../libs/common/src/state-migrations/migrations/20-move-private-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/21-move-collections-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/22-move-collapsed-groupings-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/23-move-biometric-prompts-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/24-move-sm-onboarding-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/25-move-clear-clipboard-to-autofill-settings-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/26-revert-move-last-sync-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/27-move-badge-settings-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/28-move-biometric-unlock-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/29-move-user-notification-settings-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/30-move-policy-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/31-move-enable-context-menu-to-autofill-settings-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/32-move-preferred-language.ts","webpack:///../../libs/common/src/state-migrations/migrations/33-move-app-id-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/34-move-domain-settings-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/35-move-theme-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/36-move-show-card-and-identity-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/37-move-avatar-color-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/38-migrate-token-svc-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/39-move-billing-account-profile-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/4-remove-ever-been-unlocked.ts","webpack:///../../libs/common/src/state-migrations/migrations/40-move-organization-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/41-move-event-collection-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/42-move-enable-favicon-to-domain-settings-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/43-move-auto-confirm-finger-prints-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/44-move-user-decryption-options-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/45-merge-environment-state.ts","webpack:///../../libs/common/src/state-migrations/migrations/46-delete-orphaned-biometric-prompt-data.ts","webpack:///../../libs/common/src/state-migrations/migrations/47-move-desktop-settings.ts","webpack:///../../libs/common/src/state-migrations/migrations/48-move-ddg-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/49-move-account-server-configs.ts","webpack:///../../libs/common/src/state-migrations/migrations/5-add-key-type-to-org-keys.ts","webpack:///../../libs/common/src/state-migrations/migrations/50-move-key-connector-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/51-move-remembered-email-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/52-delete-installed-version.ts","webpack:///../../libs/common/src/state-migrations/migrations/53-migrate-device-trust-svc-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/54-move-encrypted-sends.ts","webpack:///../../libs/common/src/state-migrations/migrations/55-move-master-key-state-to-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/56-move-auth-requests.ts","webpack:///../../libs/common/src/state-migrations/migrations/57-move-cipher-service-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/58-remove-refresh-token-migrated-state-provider-flag.ts","webpack:///../../libs/common/src/state-migrations/migrations/59-move-kdf-config-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/6-remove-legacy-etm-key.ts","webpack:///../../libs/common/src/state-migrations/migrations/60-known-accounts.ts","webpack:///../../libs/common/src/state-migrations/migrations/61-move-pin-state-to-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/62-migrate-vault-timeout-settings-svc-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/63-migrate-password-settings.ts","webpack:///../../libs/common/src/state-migrations/migrations/64-migrate-generator-history.ts","webpack:///../../libs/common/src/state-migrations/migrations/65-migrate-forwarder-settings.ts","webpack:///../../libs/common/src/state-migrations/migrations/7-move-biometric-auto-prompt-to-account.ts","webpack:///../../libs/common/src/state-migrations/migrations/8-move-state-version.ts","webpack:///../../libs/common/src/state-migrations/migrations/9-move-browser-settings-to-global.ts","webpack:///../../libs/common/src/state-migrations/migrations/min-version.ts","webpack:///../../libs/common/src/state-migrations/migrate.ts","webpack:///../../libs/common/src/platform/services/migration-builder.service.ts","webpack:///../../libs/common/src/state-migrations/migration-helper.ts","webpack:///../../libs/common/src/platform/services/migration-runner.ts","webpack:///../../libs/common/src/platform/services/system.service.ts","webpack:///../../libs/common/src/platform/services/user-auto-unlock-key.service.ts","webpack:///../../libs/common/src/platform/models/domain/decrypt-parameters.ts","webpack:///../../libs/common/src/platform/services/web-crypto-function.service.ts","webpack:///../../libs/common/src/platform/state/user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-active-user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-active-user-state.provider.ts","webpack:///../../libs/common/src/platform/state/state-update-options.ts","webpack:///../../libs/common/src/platform/state/implementations/util.ts","webpack:///../../libs/common/src/platform/state/implementations/state-base.ts","webpack:///../../libs/common/src/platform/state/implementations/default-global-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-global-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/default-single-user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-single-user-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/default-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/inline-derived-state.ts","webpack:///../../libs/common/src/platform/theming/theme-state.service.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-connection.response.ts","webpack:///../../libs/common/src/vault/models/api/card.api.ts","webpack:///../../libs/common/src/vault/models/api/field.api.ts","webpack:///../../libs/common/src/vault/models/api/identity.api.ts","webpack:///../../libs/common/src/vault/models/api/fido2-credential.api.ts","webpack:///../../libs/common/src/vault/models/api/login-uri.api.ts","webpack:///../../libs/common/src/vault/models/api/login.api.ts","webpack:///../../libs/common/src/vault/models/api/secure-note.api.ts","webpack:///../../libs/common/src/vault/models/response/attachment.response.ts","webpack:///../../libs/common/src/vault/models/response/password-history.response.ts","webpack:///../../libs/common/src/vault/models/response/cipher.response.ts","webpack:///../../libs/common/src/admin-console/models/response/selection-read-only.response.ts","webpack:///../../libs/common/src/vault/models/response/collection.response.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-export.response.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-sponsorship-sync-status.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-organization.response.ts","webpack:///../../libs/common/src/admin-console/abstractions/organization-user/responses/organization-user-bulk-public-key.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user-bulk-public-key.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user-bulk.response.ts","webpack:///../../libs/common/src/admin-console/models/api/permissions.api.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user.response.ts","webpack:///../../libs/common/src/auth/models/response/api-key.response.ts","webpack:///../../libs/common/src/auth/models/response/auth-request.response.ts","webpack:///../../libs/common/src/auth/models/response/device-verification.response.ts","webpack:///../../libs/common/src/auth/models/response/identity-captcha.response.ts","webpack:///../../libs/common/src/auth/models/response/identity-two-factor.response.ts","webpack:///../../libs/common/src/auth/models/response/key-connector-user-key.response.ts","webpack:///../../libs/common/src/auth/models/response/prelogin.response.ts","webpack:///../../libs/common/src/auth/models/response/register.response.ts","webpack:///../../libs/common/src/auth/models/response/sso-pre-validate.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-authenticator.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-duo.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-email.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-provider.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-recover.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-web-authn.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-yubi-key.response.ts","webpack:///../../libs/common/src/billing/models/response/billing.response.ts","webpack:///../../libs/common/src/billing/models/response/billing-history.response.ts","webpack:///../../libs/common/src/billing/models/response/billing-payment.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-organization.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-provider-organization.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-provider.response.ts","webpack:///../../libs/common/src/models/response/profile.response.ts","webpack:///../../libs/common/src/billing/models/response/payment.response.ts","webpack:///../../libs/common/src/billing/models/response/plan.response.ts","webpack:///../../libs/common/src/billing/models/response/subscription.response.ts","webpack:///../../libs/common/src/billing/models/response/tax-info.response.ts","webpack:///../../libs/common/src/billing/models/response/tax-rate.response.ts","webpack:///../../libs/common/src/models/request/collection-bulk-delete.request.ts","webpack:///../../libs/common/src/models/response/breach-account.response.ts","webpack:///../../libs/common/src/models/response/global-domain.response.ts","webpack:///../../libs/common/src/models/response/domains.response.ts","webpack:///../../libs/common/src/models/response/event.response.ts","webpack:///../../libs/common/src/models/response/user-key.response.ts","webpack:///../../libs/common/src/vault/models/response/attachment-upload-data.response.ts","webpack:///../../libs/common/src/vault/models/response/optional-cipher.response.ts","webpack:///../../libs/common/src/tools/send/models/api/send-file.api.ts","webpack:///../../libs/common/src/tools/send/models/api/send-text.api.ts","webpack:///../../libs/common/src/tools/send/models/response/send.response.ts","webpack:///../../libs/common/src/vault/models/response/folder.response.ts","webpack:///../../libs/common/src/vault/models/response/sync.response.ts","webpack:///../../libs/common/src/services/api.service.ts","webpack:///../../libs/common/src/services/audit.service.ts","webpack:///../../libs/common/src/platform/misc/throttle.ts","webpack:///../../libs/common/src/models/data/event.data.ts","webpack:///../../libs/common/src/services/event/key-definitions.ts","webpack:///../../libs/common/src/services/event/event-collection.service.ts","webpack:///../../libs/common/src/models/request/event.request.ts","webpack:///../../libs/common/src/services/event/event-upload.service.ts","webpack:///../../libs/common/src/models/response/notification.response.ts","webpack:///../../libs/common/src/services/notifications.service.ts","webpack:///../../libs/common/src/services/search.service.ts","webpack:///../../libs/common/src/services/vault-timeout/vault-timeout-settings.state.ts","webpack:///../../libs/common/src/services/vault-timeout/vault-timeout-settings.service.ts","webpack:///../../libs/common/src/tools/generator/password/password-generator-options-evaluator.ts","webpack:///../../libs/common/src/tools/generator/password/password-generation-options.ts","webpack:///../../libs/common/src/tools/state/buffered-key-definition.ts","webpack:///../../libs/common/src/tools/state/secret-classifier.ts","webpack:///../../libs/common/src/tools/state/secret-key-definition.ts","webpack:///../../libs/common/src/tools/generator/history/generated-credential.ts","webpack:///../../libs/common/src/tools/generator/password/generated-password-history.ts","webpack:///../../libs/common/src/tools/generator/key-definitions.ts","webpack:///../../libs/common/src/tools/generator/rx-operators.ts","webpack:///../../libs/common/src/tools/generator/password/password-generator-policy.ts","webpack:///../../libs/common/src/tools/generator/password/password-generator-strategy.ts","webpack:///../../libs/common/src/admin-console/models/domain/password-generator-policy-options.ts","webpack:///../../libs/common/src/platform/misc/wordlist.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generation-options.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generator-options-evaluator.ts","webpack:///../../libs/common/src/tools/generator/password/password-generation.service.ts","webpack:///../../libs/common/src/tools/generator/default-generator.service.ts","webpack:///../../libs/common/src/tools/state/buffered-state.ts","webpack:///../../libs/common/src/tools/state/data-packer.abstraction.ts","webpack:///../../libs/common/src/tools/state/padded-data-packer.ts","webpack:///../../libs/common/src/tools/state/secret-state.ts","webpack:///../../libs/common/src/tools/state/user-encryptor.abstraction.ts","webpack:///../../libs/common/src/tools/state/user-key-encryptor.ts","webpack:///../../libs/common/src/tools/generator/abstractions/generator-history.abstraction.ts","webpack:///../../libs/common/src/tools/generator/history/legacy-password-history-decryptor.ts","webpack:///../../libs/common/src/tools/generator/history/local-generator-history.service.ts","webpack:///../../libs/common/src/tools/generator/navigation/generator-navigation.ts","webpack:///../../libs/common/src/tools/generator/navigation/generator-navigation-evaluator.ts","webpack:///../../libs/common/src/tools/generator/navigation/generator-navigation-policy.ts","webpack:///../../libs/common/src/tools/generator/navigation/default-generator-navigation.service.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generator-policy.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generator-strategy.ts","webpack:///../../libs/common/src/tools/generator/legacy-password-generation.service.ts","webpack:///../../libs/common/src/tools/generator/default-policy-evaluator.ts","webpack:///../../libs/common/src/tools/generator/username/eff-username-generator-options.ts","webpack:///../../libs/common/src/tools/generator/username/eff-username-generator-strategy.ts","webpack:///../../libs/common/src/tools/generator/username/catchall-generator-options.ts","webpack:///../../libs/common/src/tools/generator/username/catchall-generator-strategy.ts","webpack:///../../libs/common/src/tools/generator/username/subaddress-generator-options.ts","webpack:///../../libs/common/src/tools/generator/username/subaddress-generator-strategy.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/anon-addy-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/duck-duck-go-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/fastmail-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/firefox-relay-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/forwarder-options.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/simple-login-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/forward-email-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/username-generation.service.ts","webpack:///../../libs/common/src/tools/generator/abstractions/generator-strategy.abstraction.ts","webpack:///../../libs/common/src/tools/generator/username/forwarder-generator-strategy.ts","webpack:///../../libs/common/src/tools/generator/username/options/constants.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/addy-io.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/duck-duck-go.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/fastmail.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/firefox-relay.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/forward-email.ts","webpack:///../../libs/common/src/tools/generator/username/forwarders/simple-login.ts","webpack:///../../libs/common/src/tools/generator/legacy-username-generation.service.ts","webpack:///../../libs/common/src/tools/send/enums/send-type.ts","webpack:///../../libs/common/src/tools/password-strength/password-strength.service.ts","webpack:///../../libs/common/src/tools/send/models/data/send-file.data.ts","webpack:///../../libs/common/src/tools/send/models/data/send-text.data.ts","webpack:///../../libs/common/src/tools/send/models/data/send.data.ts","webpack:///../../libs/common/src/tools/send/models/request/send.request.ts","webpack:///../../libs/common/src/tools/send/models/response/send-access.response.ts","webpack:///../../libs/common/src/tools/send/models/response/send-file-download-data.response.ts","webpack:///../../libs/common/src/tools/send/models/response/send-file-upload-data.response.ts","webpack:///../../libs/common/src/tools/send/services/send-api.service.ts","webpack:///../../libs/common/src/tools/send/services/key-definitions.ts","webpack:///../../libs/common/src/tools/send/services/send-state.provider.ts","webpack:///../../libs/common/src/tools/send/models/view/send-file.view.ts","webpack:///../../libs/common/src/tools/send/models/view/send-text.view.ts","webpack:///../../libs/common/src/tools/send/models/view/send.view.ts","webpack:///../../libs/common/src/tools/send/models/domain/send-file.ts","webpack:///../../libs/common/src/tools/send/models/domain/send-text.ts","webpack:///../../libs/common/src/tools/send/models/domain/send.ts","webpack:///../../libs/common/src/tools/send/models/request/send-with-id.request.ts","webpack:///../../libs/common/src/tools/send/services/send.service.ts","webpack:///../../libs/common/src/tools/send/send-kdf.ts","webpack:///../../libs/common/src/vault/models/domain/sorted-ciphers-cache.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-delete.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-move.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-restore.request.ts","webpack:///../../libs/common/src/vault/models/request/attachment.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-with-id.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-share.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-update-collections.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-collections.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-create.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-partial.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-share.request.ts","webpack:///../../libs/common/src/vault/services/key-state/ciphers.state.ts","webpack:///../../libs/common/src/vault/services/cipher.service.ts","webpack:///../../libs/common/src/vault/models/data/collection.data.ts","webpack:///../../libs/common/src/vault/models/view/collection.view.ts","webpack:///../../libs/common/src/vault/models/domain/collection.ts","webpack:///../../libs/common/src/vault/models/domain/tree-node.ts","webpack:///../../libs/common/src/vault/service-utils.ts","webpack:///../../libs/common/src/vault/services/collection.service.ts","webpack:///../../libs/common/src/vault/services/file-upload/cipher-file-upload.service.ts","webpack:///../../libs/common/src/vault/models/data/folder.data.ts","webpack:///../../libs/common/src/vault/models/request/folder.request.ts","webpack:///../../libs/common/src/vault/services/folder/folder-api.service.ts","webpack:///../../libs/common/src/vault/models/view/folder.view.ts","webpack:///../../libs/common/src/vault/models/domain/folder.ts","webpack:///../../libs/common/src/vault/services/key-state/folder.state.ts","webpack:///../../libs/common/src/vault/services/folder/folder.service.ts","webpack:///../../libs/common/src/vault/services/sync/sync-notifier.service.ts","webpack:///../../libs/common/src/admin-console/models/data/provider.data.ts","webpack:///../../libs/common/src/platform/sync/core-sync.service.ts","webpack:///../../libs/common/src/vault/services/sync/sync.service.ts","webpack:///../../libs/common/src/vault/services/totp.service.ts","webpack:///../../libs/common/src/vault/services/key-state/vault-settings.state.ts","webpack:///../../libs/common/src/vault/services/vault-settings/vault-settings.service.ts","webpack:///../../libs/importer/src/services/import-api.service.ts","webpack:///../../libs/common/src/models/request/import-ciphers.request.ts","webpack:///../../libs/common/src/models/request/import-organization-ciphers.request.ts","webpack:///../../libs/common/src/models/request/kvp.request.ts","webpack:///../../libs/common/src/vault/models/request/collection.request.ts","webpack:///../../libs/common/src/vault/models/request/collection-with-id.request.ts","webpack:///../../libs/common/src/vault/models/request/folder-with-id.request.ts","webpack:///../../libs/importer/src/models/import-result.ts","webpack:///../../libs/importer/src/importers/base-importer.ts","webpack:///../../libs/importer/src/importers/ascendo-csv-importer.ts","webpack:///../../libs/importer/src/importers/avast/avast-csv-importer.ts","webpack:///../../libs/importer/src/importers/avast/avast-json-importer.ts","webpack:///../../libs/importer/src/importers/avira-csv-importer.ts","webpack:///../../libs/importer/src/importers/blackberry-csv-importer.ts","webpack:///../../libs/importer/src/importers/chrome-csv-importer.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-csv-importer.ts","webpack:///../../libs/common/src/models/export/utils.ts","webpack:///../../libs/common/src/models/export/card.export.ts","webpack:///../../libs/common/src/models/export/field.export.ts","webpack:///../../libs/common/src/models/export/identity.export.ts","webpack:///../../libs/common/src/models/export/fido2-credential.export.ts","webpack:///../../libs/common/src/models/export/login-uri.export.ts","webpack:///../../libs/common/src/models/export/login.export.ts","webpack:///../../libs/common/src/models/export/password-history.export.ts","webpack:///../../libs/common/src/models/export/secure-note.export.ts","webpack:///../../libs/common/src/models/export/cipher.export.ts","webpack:///../../libs/common/src/models/export/cipher-with-ids.export.ts","webpack:///../../libs/common/src/models/export/collection.export.ts","webpack:///../../libs/common/src/models/export/collection-with-id.export.ts","webpack:///../../libs/common/src/models/export/folder.export.ts","webpack:///../../libs/common/src/models/export/folder-with-id.export.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-json-importer.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-password-protected-importer.ts","webpack:///../../libs/importer/src/importers/blur-csv-importer.ts","webpack:///../../libs/importer/src/importers/buttercup-csv-importer.ts","webpack:///../../libs/importer/src/importers/clipperz-html-importer.ts","webpack:///../../libs/importer/src/importers/codebook-csv-importer.ts","webpack:///../../libs/importer/src/importers/dashlane/dashlane-csv-importer.ts","webpack:///../../libs/importer/src/importers/dashlane/dashlane-json-importer.ts","webpack:///../../libs/importer/src/importers/encryptr-csv-importer.ts","webpack:///../../libs/importer/src/importers/enpass/enpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/enpass/enpass-json-importer.ts","webpack:///../../libs/importer/src/importers/firefox-csv-importer.ts","webpack:///../../libs/importer/src/importers/fsecure/fsecure-fsk-types.ts","webpack:///../../libs/importer/src/importers/fsecure/fsecure-fsk-importer.ts","webpack:///../../libs/importer/src/importers/gnome-json-importer.ts","webpack:///../../libs/importer/src/importers/kaspersky-txt-importer.ts","webpack:///../../libs/importer/src/importers/keepass2-xml-importer.ts","webpack:///../../libs/importer/src/importers/keepassx-csv-importer.ts","webpack:///../../libs/importer/src/importers/keeper/keeper-csv-importer.ts","webpack:///../../libs/importer/src/importers/lastpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/logmeonce-csv-importer.ts","webpack:///../../libs/importer/src/importers/meldium-csv-importer.ts","webpack:///../../libs/importer/src/importers/msecure-csv-importer.ts","webpack:///../../libs/importer/src/importers/myki-csv-importer.ts","webpack:///../../libs/importer/src/importers/nordpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-1pif-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/types/onepassword-1pux-importer-types.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-1pux-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/cipher-import-context.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-mac-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-win-csv-importer.ts","webpack:///../../libs/importer/src/importers/padlock-csv-importer.ts","webpack:///../../libs/importer/src/importers/passkeep-csv-importer.ts","webpack:///../../libs/importer/src/importers/passky/passky-json-importer.ts","webpack:///../../libs/importer/src/importers/passman-json-importer.ts","webpack:///../../libs/importer/src/importers/passpack-csv-importer.ts","webpack:///../../libs/importer/src/importers/passwordagent-csv-importer.ts","webpack:///../../libs/importer/src/importers/passwordboss-json-importer.ts","webpack:///../../libs/importer/src/importers/passworddragon-xml-importer.ts","webpack:///../../libs/importer/src/importers/passwordsafe-xml-importer.ts","webpack:///../../libs/importer/src/importers/passwordwallet-txt-importer.ts","webpack:///../../libs/importer/src/importers/protonpass/types/protonpass-json-type.ts","webpack:///../../libs/importer/src/importers/protonpass/protonpass-json-importer.ts","webpack:///../../libs/importer/src/importers/psono/psono-json-importer.ts","webpack:///../../libs/importer/src/importers/remembear-csv-importer.ts","webpack:///../../libs/importer/src/importers/roboform-csv-importer.ts","webpack:///../../libs/importer/src/importers/safari-csv-importer.ts","webpack:///../../libs/importer/src/importers/safeincloud-xml-importer.ts","webpack:///../../libs/importer/src/importers/saferpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/securesafe-csv-importer.ts","webpack:///../../libs/importer/src/importers/splashid-csv-importer.ts","webpack:///../../libs/importer/src/importers/stickypassword-xml-importer.ts","webpack:///../../libs/importer/src/importers/truekey-csv-importer.ts","webpack:///../../libs/importer/src/importers/upm-csv-importer.ts","webpack:///../../libs/importer/src/importers/yoti-csv-importer.ts","webpack:///../../libs/importer/src/importers/zohovault-csv-importer.ts","webpack:///../../libs/importer/src/models/import-options.ts","webpack:///../../libs/importer/src/services/import.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/export-helper.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/base-vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/org-vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/individual-vault-export.service.ts","webpack:///./src/browser/safariApp.ts","webpack:///./src/platform/services/browser-clipboard.service.ts","webpack:///./src/platform/services/platform-utils/browser-platform-utils.service.ts","webpack:///./src/platform/browser/browser-api.register-content-scripts-polyfill.ts","webpack:///./src/platform/browser/browser-api.ts","webpack:///./src/autofill/background/context-menus.background.ts","webpack:///./src/platform/popup/browser-popup-utils.ts","webpack:///./src/auth/popup/utils/auth-popout-window.ts","webpack:///./src/vault/popup/utils/vault-popout-window.ts","webpack:///./src/autofill/enums/notification-queue-message-type.enum.ts","webpack:///./src/autofill/background/notification.background.ts","webpack:///../../libs/common/src/vault/icon/build-cipher-icon.ts","webpack:///./src/autofill/utils/autofill-overlay.enum.ts","webpack:///./src/autofill/background/overlay.background.ts","webpack:///./src/autofill/background/tabs.background.ts","webpack:///./src/autofill/background/web-request.background.ts","webpack:///./src/autofill/browser/main-context-menu-handler.ts","webpack:///./src/autofill/browser/cipher-context-menu-handler.ts","webpack:///./src/autofill/browser/context-menu-clicked-handler.ts","webpack:///./src/autofill/enums/autofill-port.enums.ts","webpack:///./src/autofill/models/autofill-script.ts","webpack:///./src/autofill/services/autofill-constants.ts","webpack:///./src/autofill/services/autofill.service.ts","webpack:///./src/models/browserComponentState.ts","webpack:///./src/models/browserGroupingsComponentState.ts","webpack:///./src/models/browserSendComponentState.ts","webpack:///./src/models/account.ts","webpack:///./src/platform/flags.ts","webpack:///./src/platform/listeners/update-badge.ts","webpack:///./src/platform/messaging/chrome-message.sender.ts","webpack:///./src/platform/offscreen-document/offscreen-document.service.ts","webpack:///../../libs/common/src/admin-console/models/domain/encrypted-organization-key.ts","webpack:///../../libs/common/src/platform/services/key-state/org-keys.state.ts","webpack:///../../libs/common/src/platform/services/key-state/provider-keys.state.ts","webpack:///../../libs/common/src/platform/services/key-state/user-key.state.ts","webpack:///../../libs/common/src/platform/services/crypto.service.ts","webpack:///../../libs/common/src/platform/misc/convert-values.ts","webpack:///./src/platform/services/browser-crypto.service.ts","webpack:///../../libs/common/src/platform/services/default-environment.service.ts","webpack:///./src/platform/services/browser-environment.service.ts","webpack:///./src/platform/browser/from-chrome-event.ts","webpack:///./src/platform/services/abstractions/abstract-chrome-storage-api.service.ts","webpack:///./src/platform/services/browser-local-storage.service.ts","webpack:///./src/platform/services/browser-memory-storage.service.ts","webpack:///./src/platform/services/abstractions/script-injector.service.ts","webpack:///./src/platform/services/browser-script-injector.service.ts","webpack:///../../libs/common/src/platform/models/domain/state.ts","webpack:///../../libs/common/src/platform/services/state.service.ts","webpack:///./src/platform/services/default-browser-state.service.ts","webpack:///../../libs/common/src/platform/services/translation.service.ts","webpack:///../../libs/common/src/platform/services/i18n.service.ts","webpack:///./src/platform/services/i18n.service.ts","webpack:///../../libs/common/src/platform/abstractions/storage.service.ts","webpack:///./src/platform/storage/port-name.ts","webpack:///./src/platform/services/local-backed-session-storage.service.ts","webpack:///./src/platform/services/platform-utils/background-platform-utils.service.ts","webpack:///../../libs/common/src/platform/state/storage/memory-storage.service.ts","webpack:///./src/platform/storage/background-memory-storage.service.ts","webpack:///../../libs/common/src/platform/services/storage-service.provider.ts","webpack:///./src/platform/storage/browser-storage-service.provider.ts","webpack:///./src/platform/storage/foreground-memory-storage.service.ts","webpack:///./src/platform/sync/sync-service.listener.ts","webpack:///./src/platform/sync/foreground-sync.service.ts","webpack:///./src/platform/utils/from-chrome-runtime-messaging.ts","webpack:///../../libs/common/src/services/vault-timeout/vault-timeout.service.ts","webpack:///./src/services/vault-timeout/vault-timeout.service.ts","webpack:///./src/tools/config/fileless-importer-injected-scripts.ts","webpack:///./src/tools/enums/fileless-import.enums.ts","webpack:///./src/tools/background/fileless-importer.background.ts","webpack:///./src/vault/background/abort-manager.ts","webpack:///./src/vault/fido2/enums/fido2-content-script.enum.ts","webpack:///./src/vault/fido2/enums/fido2-port-name.enum.ts","webpack:///./src/vault/fido2/background/fido2.background.ts","webpack:///./src/vault/fido2/browser-fido2-user-interface.service.ts","webpack:///../../libs/angular/src/vault/vault-filter/models/vault-filter.model.ts","webpack:///../../libs/common/src/admin-console/abstractions/organization/organization.service.abstraction.ts","webpack:///../../libs/angular/src/vault/vault-filter/models/dynamic-tree-node.model.ts","webpack:///../../libs/common/src/vault/services/key-state/collapsed-groupings.state.ts","webpack:///../../libs/common/src/vault/abstractions/folder/folder.service.abstraction.ts","webpack:///../../libs/common/src/vault/abstractions/cipher.service.ts","webpack:///../../libs/common/src/vault/abstractions/collection.service.ts","webpack:///../../libs/common/src/admin-console/abstractions/policy/policy.service.abstraction.ts","webpack:///../../libs/angular/src/vault/vault-filter/services/vault-filter.service.ts","webpack:///./src/vault/services/vault-filter.service.ts","webpack:///./src/background/commands.background.ts","webpack:///./src/background/idle.background.ts","webpack:///./src/background/nativeMessaging.background.ts","webpack:///./src/background/runtime.background.ts","webpack:///./src/platform/background.ts","webpack:///./src/background/main.background.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/get javascript chunk filename","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/node module decorator","webpack:///webpack/runtime/publicPath","webpack:///webpack/runtime/jsonp chunk loading","webpack:///webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var getProto = Object.getPrototypeOf ? function(obj) { return Object.getPrototypeOf(obj); } : function(obj) { return obj.__proto__; };\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach(function(key) { def[key] = function() { return value[key]; }; });\n\t}\n\tdef['default'] = function() { return value; };\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","export enum LogLevelType {\n  Debug,\n  Info,\n  Warning,\n  Error,\n}\n","import { LogService as LogServiceAbstraction } from \"../abstractions/log.service\";\nimport { LogLevelType } from \"../enums/log-level-type.enum\";\n\nexport class ConsoleLogService implements LogServiceAbstraction {\n  protected timersMap: Map<string, [number, number]> = new Map();\n\n  constructor(\n    protected isDev: boolean,\n    protected filter: (level: LogLevelType) => boolean = null,\n  ) {}\n\n  debug(message?: any, ...optionalParams: any[]) {\n    if (!this.isDev) {\n      return;\n    }\n    this.write(LogLevelType.Debug, message, ...optionalParams);\n  }\n\n  info(message?: any, ...optionalParams: any[]) {\n    this.write(LogLevelType.Info, message, ...optionalParams);\n  }\n\n  warning(message?: any, ...optionalParams: any[]) {\n    this.write(LogLevelType.Warning, message, ...optionalParams);\n  }\n\n  error(message?: any, ...optionalParams: any[]) {\n    this.write(LogLevelType.Error, message, ...optionalParams);\n  }\n\n  write(level: LogLevelType, message?: any, ...optionalParams: any[]) {\n    if (this.filter != null && this.filter(level)) {\n      return;\n    }\n\n    switch (level) {\n      case LogLevelType.Debug:\n        // eslint-disable-next-line\n        console.log(message, ...optionalParams);\n        break;\n      case LogLevelType.Info:\n        // eslint-disable-next-line\n        console.log(message, ...optionalParams);\n        break;\n      case LogLevelType.Warning:\n        // eslint-disable-next-line\n        console.warn(message, ...optionalParams);\n        break;\n      case LogLevelType.Error:\n        // eslint-disable-next-line\n        console.error(message, ...optionalParams);\n        break;\n      default:\n        break;\n    }\n  }\n}\n","export enum AuthenticationType {\n  Password = 0,\n  Sso = 1,\n  UserApiKey = 2,\n  AuthRequest = 3,\n  WebAuthn = 4,\n}\n","import { TwoFactorProviderType } from \"../../../enums/two-factor-provider-type\";\n\nexport class TokenTwoFactorRequest {\n  constructor(\n    public provider: TwoFactorProviderType = null,\n    public token: string = null,\n    public remember: boolean = false,\n  ) {}\n}\n","/* eslint-disable no-useless-escape */\nimport * as path from \"path\";\n\nimport { Buffer as BufferLib } from \"buffer/\";\nimport { Observable, of, switchMap } from \"rxjs\";\nimport { getHostname, parse } from \"tldts\";\nimport { Merge } from \"type-fest\";\n\nimport { CryptoService } from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\nimport { I18nService } from \"../abstractions/i18n.service\";\n\nconst nodeURL = typeof self === \"undefined\" ? require(\"url\") : null;\n\ndeclare global {\n  /* eslint-disable-next-line no-var */\n  var bitwardenContainerService: BitwardenContainerService;\n}\n\ninterface BitwardenContainerService {\n  getCryptoService: () => CryptoService;\n  getEncryptService: () => EncryptService;\n}\n\nexport class Utils {\n  static inited = false;\n  static isNode = false;\n  static isBrowser = true;\n  static isMobileBrowser = false;\n  static isAppleMobileBrowser = false;\n  static global: typeof global = null;\n  // Transpiled version of /\\p{Emoji_Presentation}/gu using https://mothereff.in/regexpu. Used for compatability in older browsers.\n  static regexpEmojiPresentation =\n    /(?:[\\u231A\\u231B\\u23E9-\\u23EC\\u23F0\\u23F3\\u25FD\\u25FE\\u2614\\u2615\\u2648-\\u2653\\u267F\\u2693\\u26A1\\u26AA\\u26AB\\u26BD\\u26BE\\u26C4\\u26C5\\u26CE\\u26D4\\u26EA\\u26F2\\u26F3\\u26F5\\u26FA\\u26FD\\u2705\\u270A\\u270B\\u2728\\u274C\\u274E\\u2753-\\u2755\\u2757\\u2795-\\u2797\\u27B0\\u27BF\\u2B1B\\u2B1C\\u2B50\\u2B55]|\\uD83C[\\uDC04\\uDCCF\\uDD8E\\uDD91-\\uDD9A\\uDDE6-\\uDDFF\\uDE01\\uDE1A\\uDE2F\\uDE32-\\uDE36\\uDE38-\\uDE3A\\uDE50\\uDE51\\uDF00-\\uDF20\\uDF2D-\\uDF35\\uDF37-\\uDF7C\\uDF7E-\\uDF93\\uDFA0-\\uDFCA\\uDFCF-\\uDFD3\\uDFE0-\\uDFF0\\uDFF4\\uDFF8-\\uDFFF]|\\uD83D[\\uDC00-\\uDC3E\\uDC40\\uDC42-\\uDCFC\\uDCFF-\\uDD3D\\uDD4B-\\uDD4E\\uDD50-\\uDD67\\uDD7A\\uDD95\\uDD96\\uDDA4\\uDDFB-\\uDE4F\\uDE80-\\uDEC5\\uDECC\\uDED0-\\uDED2\\uDED5-\\uDED7\\uDEEB\\uDEEC\\uDEF4-\\uDEFC\\uDFE0-\\uDFEB]|\\uD83E[\\uDD0C-\\uDD3A\\uDD3C-\\uDD45\\uDD47-\\uDD78\\uDD7A-\\uDDCB\\uDDCD-\\uDDFF\\uDE70-\\uDE74\\uDE78-\\uDE7A\\uDE80-\\uDE86\\uDE90-\\uDEA8\\uDEB0-\\uDEB6\\uDEC0-\\uDEC2\\uDED0-\\uDED6])/g;\n  static readonly validHosts: string[] = [\"localhost\"];\n  static readonly originalMinimumPasswordLength = 8;\n  static readonly minimumPasswordLength = 12;\n  static readonly DomainMatchBlacklist = new Map<string, Set<string>>([\n    [\"google.com\", new Set([\"script.google.com\"])],\n  ]);\n\n  static init() {\n    if (Utils.inited) {\n      return;\n    }\n\n    Utils.inited = true;\n    Utils.isNode =\n      typeof process !== \"undefined\" &&\n      (process as any).release != null &&\n      (process as any).release.name === \"node\";\n    Utils.isBrowser = typeof window !== \"undefined\";\n\n    Utils.isMobileBrowser = Utils.isBrowser && this.isMobile(window);\n    Utils.isAppleMobileBrowser = Utils.isBrowser && this.isAppleMobile(window);\n\n    if (Utils.isNode) {\n      Utils.global = global;\n    } else if (Utils.isBrowser) {\n      Utils.global = window;\n    } else {\n      // If it's not browser or node then it must be a service worker\n      Utils.global = self;\n    }\n  }\n\n  static fromB64ToArray(str: string): Uint8Array {\n    if (str == null) {\n      return null;\n    }\n\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"base64\"));\n    } else {\n      const binaryString = Utils.global.atob(str);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      return bytes;\n    }\n  }\n\n  static fromUrlB64ToArray(str: string): Uint8Array {\n    return Utils.fromB64ToArray(Utils.fromUrlB64ToB64(str));\n  }\n\n  static fromHexToArray(str: string): Uint8Array {\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"hex\"));\n    } else {\n      const bytes = new Uint8Array(str.length / 2);\n      for (let i = 0; i < str.length; i += 2) {\n        bytes[i / 2] = parseInt(str.substr(i, 2), 16);\n      }\n      return bytes;\n    }\n  }\n\n  static fromUtf8ToArray(str: string): Uint8Array {\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"utf8\"));\n    } else {\n      const strUtf8 = unescape(encodeURIComponent(str));\n      const arr = new Uint8Array(strUtf8.length);\n      for (let i = 0; i < strUtf8.length; i++) {\n        arr[i] = strUtf8.charCodeAt(i);\n      }\n      return arr;\n    }\n  }\n\n  static fromByteStringToArray(str: string): Uint8Array {\n    if (str == null) {\n      return null;\n    }\n    const arr = new Uint8Array(str.length);\n    for (let i = 0; i < str.length; i++) {\n      arr[i] = str.charCodeAt(i);\n    }\n    return arr;\n  }\n\n  static fromBufferToB64(buffer: ArrayBuffer): string {\n    if (buffer == null) {\n      return null;\n    }\n    if (Utils.isNode) {\n      return Buffer.from(buffer).toString(\"base64\");\n    } else {\n      let binary = \"\";\n      const bytes = new Uint8Array(buffer);\n      for (let i = 0; i < bytes.byteLength; i++) {\n        binary += String.fromCharCode(bytes[i]);\n      }\n      return Utils.global.btoa(binary);\n    }\n  }\n\n  static fromBufferToUrlB64(buffer: ArrayBuffer): string {\n    return Utils.fromB64toUrlB64(Utils.fromBufferToB64(buffer));\n  }\n\n  static fromB64toUrlB64(b64Str: string) {\n    return b64Str.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n  }\n\n  static fromBufferToUtf8(buffer: ArrayBuffer): string {\n    return BufferLib.from(buffer).toString(\"utf8\");\n  }\n\n  static fromBufferToByteString(buffer: ArrayBuffer): string {\n    return String.fromCharCode.apply(null, new Uint8Array(buffer));\n  }\n\n  // ref: https://stackoverflow.com/a/40031979/1090359\n  static fromBufferToHex(buffer: ArrayBuffer): string {\n    if (Utils.isNode) {\n      return Buffer.from(buffer).toString(\"hex\");\n    } else {\n      const bytes = new Uint8Array(buffer);\n      return Array.prototype.map\n        .call(bytes, (x: number) => (\"00\" + x.toString(16)).slice(-2))\n        .join(\"\");\n    }\n  }\n\n  /**\n   * Converts a hex string to an ArrayBuffer.\n   * Note: this doesn't need any Node specific code as parseInt() / ArrayBuffer / Uint8Array\n   * work the same in Node and the browser.\n   * @param {string} hexString - A string of hexadecimal characters.\n   * @returns {ArrayBuffer} The ArrayBuffer representation of the hex string.\n   */\n  static hexStringToArrayBuffer(hexString: string): ArrayBuffer {\n    // Check if the hexString has an even length, as each hex digit represents half a byte (4 bits),\n    // and it takes two hex digits to represent a full byte (8 bits).\n    if (hexString.length % 2 !== 0) {\n      throw \"HexString has to be an even length\";\n    }\n\n    // Create an ArrayBuffer with a length that is half the length of the hex string,\n    // because each pair of hex digits will become a single byte.\n    const arrayBuffer = new ArrayBuffer(hexString.length / 2);\n\n    // Create a Uint8Array view on top of the ArrayBuffer (each position represents a byte)\n    // as ArrayBuffers cannot be edited directly.\n    const uint8Array = new Uint8Array(arrayBuffer);\n\n    // Loop through the bytes\n    for (let i = 0; i < uint8Array.length; i++) {\n      // Extract two hex characters (1 byte)\n      const hexByte = hexString.substr(i * 2, 2);\n\n      // Convert hexByte into a decimal value from base 16. (ex: ff --> 255)\n      const byteValue = parseInt(hexByte, 16);\n\n      // Place the byte value into the uint8Array\n      uint8Array[i] = byteValue;\n    }\n\n    return arrayBuffer;\n  }\n\n  static fromUrlB64ToB64(urlB64Str: string): string {\n    let output = urlB64Str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += \"==\";\n        break;\n      case 3:\n        output += \"=\";\n        break;\n      default:\n        throw new Error(\"Illegal base64url string!\");\n    }\n\n    return output;\n  }\n\n  static fromUrlB64ToUtf8(urlB64Str: string): string {\n    return Utils.fromB64ToUtf8(Utils.fromUrlB64ToB64(urlB64Str));\n  }\n\n  static fromUtf8ToB64(utfStr: string): string {\n    if (Utils.isNode) {\n      return Buffer.from(utfStr, \"utf8\").toString(\"base64\");\n    } else {\n      return decodeURIComponent(escape(Utils.global.btoa(utfStr)));\n    }\n  }\n\n  static fromUtf8ToUrlB64(utfStr: string): string {\n    return Utils.fromBufferToUrlB64(Utils.fromUtf8ToArray(utfStr));\n  }\n\n  static fromB64ToUtf8(b64Str: string): string {\n    if (Utils.isNode) {\n      return Buffer.from(b64Str, \"base64\").toString(\"utf8\");\n    } else {\n      return decodeURIComponent(escape(Utils.global.atob(b64Str)));\n    }\n  }\n\n  // ref: http://stackoverflow.com/a/2117523/1090359\n  static newGuid(): string {\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c === \"x\" ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n  }\n\n  static guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/;\n\n  static isGuid(id: string) {\n    return RegExp(Utils.guidRegex, \"i\").test(id);\n  }\n\n  static getHostname(uriString: string): string {\n    if (Utils.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    if (uriString.startsWith(\"data:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"about:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"file:\")) {\n      return null;\n    }\n\n    // Does uriString contain invalid characters\n    // TODO Needs to possibly be extended, although '!' is a reserved character\n    if (uriString.indexOf(\"!\") > 0) {\n      return null;\n    }\n\n    try {\n      const hostname = getHostname(uriString, { validHosts: this.validHosts });\n      if (hostname != null) {\n        return hostname;\n      }\n    } catch {\n      return null;\n    }\n    return null;\n  }\n\n  static getHost(uriString: string): string {\n    const url = Utils.getUrl(uriString);\n    try {\n      return url != null && url.host !== \"\" ? url.host : null;\n    } catch {\n      return null;\n    }\n  }\n\n  static getDomain(uriString: string): string {\n    if (Utils.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    if (uriString.startsWith(\"data:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"about:\")) {\n      return null;\n    }\n\n    try {\n      const parseResult = parse(uriString, {\n        validHosts: this.validHosts,\n        allowPrivateDomains: true,\n      });\n      if (parseResult != null && parseResult.hostname != null) {\n        if (parseResult.hostname === \"localhost\" || parseResult.isIp) {\n          return parseResult.hostname;\n        }\n\n        if (parseResult.domain != null) {\n          return parseResult.domain;\n        }\n        return null;\n      }\n    } catch {\n      return null;\n    }\n    return null;\n  }\n\n  static getQueryParams(uriString: string): Map<string, string> {\n    const url = Utils.getUrl(uriString);\n    if (url == null || url.search == null || url.search === \"\") {\n      return null;\n    }\n    const map = new Map<string, string>();\n    const pairs = (url.search[0] === \"?\" ? url.search.substr(1) : url.search).split(\"&\");\n    pairs.forEach((pair) => {\n      const parts = pair.split(\"=\");\n      if (parts.length < 1) {\n        return;\n      }\n      map.set(\n        decodeURIComponent(parts[0]).toLowerCase(),\n        parts[1] == null ? \"\" : decodeURIComponent(parts[1]),\n      );\n    });\n    return map;\n  }\n\n  static getSortFunction<T>(\n    i18nService: I18nService,\n    prop: { [K in keyof T]: T[K] extends string ? K : never }[keyof T],\n  ): (a: T, b: T) => number {\n    return (a, b) => {\n      if (a[prop] == null && b[prop] != null) {\n        return -1;\n      }\n      if (a[prop] != null && b[prop] == null) {\n        return 1;\n      }\n      if (a[prop] == null && b[prop] == null) {\n        return 0;\n      }\n\n      // The `as unknown as string` here is unfortunate because typescript doesn't property understand that the return of T[prop] will be a string\n      return i18nService.collator\n        ? i18nService.collator.compare(a[prop] as unknown as string, b[prop] as unknown as string)\n        : (a[prop] as unknown as string).localeCompare(b[prop] as unknown as string);\n    };\n  }\n\n  static isNullOrWhitespace(str: string): boolean {\n    return str == null || typeof str !== \"string\" || str.trim() === \"\";\n  }\n\n  static isNullOrEmpty(str: string): boolean {\n    return str == null || typeof str !== \"string\" || str == \"\";\n  }\n\n  static isPromise(obj: any): obj is Promise<unknown> {\n    return (\n      obj != undefined && typeof obj[\"then\"] === \"function\" && typeof obj[\"catch\"] === \"function\"\n    );\n  }\n\n  static nameOf<T>(name: string & keyof T) {\n    return name;\n  }\n\n  static assign<T>(target: T, source: Partial<T>): T {\n    return Object.assign(target, source);\n  }\n\n  static iterateEnum<O extends object, K extends keyof O = keyof O>(obj: O) {\n    return (Object.keys(obj).filter((k) => Number.isNaN(+k)) as K[]).map((k) => obj[k]);\n  }\n\n  static getUrl(uriString: string): URL {\n    if (this.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    return Utils.getUrlObject(uriString);\n  }\n\n  static camelToPascalCase(s: string) {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n  }\n\n  /**\n   * There are a few ways to calculate text color for contrast, this one seems to fit accessibility guidelines best.\n   * https://stackoverflow.com/a/3943023/6869691\n   *\n   * @param {string} bgColor\n   * @param {number} [threshold] see stackoverflow link above\n   * @param {boolean} [svgTextFill]\n   * Indicates if this method is performed on an SVG <text> 'fill' attribute (e.g. <text fill=\"black\"></text>).\n   * This check is necessary because the '!important' tag cannot be used in a 'fill' attribute.\n   */\n  static pickTextColorBasedOnBgColor(bgColor: string, threshold = 186, svgTextFill = false) {\n    const bgColorHexNums = bgColor.charAt(0) === \"#\" ? bgColor.substring(1, 7) : bgColor;\n    const r = parseInt(bgColorHexNums.substring(0, 2), 16); // hexToR\n    const g = parseInt(bgColorHexNums.substring(2, 4), 16); // hexToG\n    const b = parseInt(bgColorHexNums.substring(4, 6), 16); // hexToB\n    const blackColor = svgTextFill ? \"black\" : \"black !important\";\n    const whiteColor = svgTextFill ? \"white\" : \"white !important\";\n    return r * 0.299 + g * 0.587 + b * 0.114 > threshold ? blackColor : whiteColor;\n  }\n\n  static stringToColor(str: string): string {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    let color = \"#\";\n    for (let i = 0; i < 3; i++) {\n      const value = (hash >> (i * 8)) & 0xff;\n      color += (\"00\" + value.toString(16)).substr(-2);\n    }\n    return color;\n  }\n\n  /**\n   * @throws Will throw an error if the ContainerService has not been attached to the window object\n   */\n  static getContainerService(): BitwardenContainerService {\n    if (this.global.bitwardenContainerService == null) {\n      throw new Error(\"global bitwardenContainerService not initialized.\");\n    }\n    return this.global.bitwardenContainerService;\n  }\n\n  static validateHexColor(color: string) {\n    return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color);\n  }\n\n  /**\n   * Converts map to a Record<string, V> with the same data. Inverse of recordToMap\n   * Useful in toJSON methods, since Maps are not serializable\n   * @param map\n   * @returns\n   */\n  static mapToRecord<K extends string | number, V>(map: Map<K, V>): Record<string, V> {\n    if (map == null) {\n      return null;\n    }\n    if (!(map instanceof Map)) {\n      return map;\n    }\n    return Object.fromEntries(map);\n  }\n\n  /**\n   * Converts record to a Map<string, V> with the same data. Inverse of mapToRecord\n   * Useful in fromJSON methods, since Maps are not serializable\n   *\n   * Warning: If the record has string keys that are numbers, they will be converted to numbers in the map\n   * @param record\n   * @returns\n   */\n  static recordToMap<K extends string | number, V>(record: Record<K, V>): Map<K, V> {\n    if (record == null) {\n      return null;\n    } else if (record instanceof Map) {\n      return record;\n    }\n\n    const entries = Object.entries(record);\n    if (entries.length === 0) {\n      return new Map();\n    }\n\n    if (isNaN(Number(entries[0][0]))) {\n      return new Map(entries) as Map<K, V>;\n    } else {\n      return new Map(entries.map((e) => [Number(e[0]), e[1]])) as Map<K, V>;\n    }\n  }\n\n  /** Applies Object.assign, but converts the type nicely using Type-Fest Merge<Destination, Source> */\n  static merge<Destination, Source>(\n    destination: Destination,\n    source: Source,\n  ): Merge<Destination, Source> {\n    return Object.assign(destination, source) as unknown as Merge<Destination, Source>;\n  }\n\n  /**\n   * encodeURIComponent escapes all characters except the following:\n   * alphabetic, decimal digits, - _ . ! ~ * ' ( )\n   * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent#encoding_for_rfc3986\n   */\n  static encodeRFC3986URIComponent(str: string): string {\n    return encodeURIComponent(str).replace(\n      /[!'()*]/g,\n      (c) => `%${c.charCodeAt(0).toString(16).toUpperCase()}`,\n    );\n  }\n\n  /**\n   * Normalizes a path for defense against attacks like traversals\n   * @param denormalizedPath\n   * @returns\n   */\n  static normalizePath(denormalizedPath: string): string {\n    return path.normalize(decodeURIComponent(denormalizedPath)).replace(/^(\\.\\.(\\/|\\\\|$))+/, \"\");\n  }\n\n  private static isMobile(win: Window) {\n    let mobile = false;\n    ((a) => {\n      if (\n        /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(\n          a,\n        ) ||\n        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n          a.substr(0, 4),\n        )\n      ) {\n        mobile = true;\n      }\n    })(win.navigator.userAgent || win.navigator.vendor || (win as any).opera);\n    return mobile || win.navigator.userAgent.match(/iPad/i) != null;\n  }\n\n  static delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Generate an observable from a function that returns a promise.\n   * Similar to the rxjs function {@link from} with one big exception:\n   * {@link from} will not re-execute the function when observers resubscribe.\n   * {@link Util.asyncToObservable} will execute `generator` for every\n   * subscribe, making it ideal if the value ever needs to be refreshed.\n   * */\n  static asyncToObservable<T>(generator: () => Promise<T>): Observable<T> {\n    return of(undefined).pipe(switchMap(() => generator()));\n  }\n\n  /**\n   * Return the number of days remaining before a target date arrives.\n   * Returns 0 if the day has already passed.\n   */\n  static daysRemaining(targetDate: Date): number {\n    const diffTime = targetDate.getTime() - Date.now();\n    const msPerDay = 86400000;\n    return Math.max(0, Math.floor(diffTime / msPerDay));\n  }\n\n  private static isAppleMobile(win: Window) {\n    return (\n      win.navigator.userAgent.match(/iPhone/i) != null ||\n      win.navigator.userAgent.match(/iPad/i) != null\n    );\n  }\n\n  private static getUrlObject(uriString: string): URL {\n    // All the methods below require a protocol to properly parse a URL string\n    // Assume http if no other protocol is present\n    const hasProtocol = uriString.indexOf(\"://\") > -1;\n    if (!hasProtocol && uriString.indexOf(\".\") > -1) {\n      uriString = \"http://\" + uriString;\n    } else if (!hasProtocol) {\n      return null;\n    }\n\n    try {\n      if (nodeURL != null) {\n        return new nodeURL.URL(uriString);\n      }\n\n      return new URL(uriString);\n    } catch (e) {\n      // Ignore error\n    }\n\n    return null;\n  }\n}\n\nUtils.init();\n","import { Utils } from \"../../../../platform/misc/utils\";\n\nexport abstract class WebAuthnLoginResponseRequest {\n  id: string;\n  rawId: string;\n  type: string;\n  extensions: Record<string, unknown>;\n\n  constructor(credential: PublicKeyCredential) {\n    this.id = credential.id;\n    this.rawId = Utils.fromBufferToUrlB64(credential.rawId);\n    this.type = credential.type;\n\n    // WARNING: do not add PRF information here by mapping\n    // credential.getClientExtensionResults() into the extensions property,\n    // as it will be sent to the server (leaking credentials).\n    this.extensions = {}; // Extensions are handled client-side\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../../platform/misc/utils\";\n\nimport { WebAuthnLoginResponseRequest } from \"./webauthn-login-response.request\";\n\n// base 64 strings\nexport interface WebAuthnLoginAssertionResponseData {\n  authenticatorData: string;\n  signature: string;\n  clientDataJSON: string;\n  userHandle: string;\n}\n\nexport class WebAuthnLoginAssertionResponseRequest extends WebAuthnLoginResponseRequest {\n  response: WebAuthnLoginAssertionResponseData;\n\n  constructor(credential: PublicKeyCredential) {\n    super(credential);\n\n    if (!(credential.response instanceof AuthenticatorAssertionResponse)) {\n      throw new Error(\"Invalid authenticator response\");\n    }\n\n    this.response = {\n      authenticatorData: Utils.fromBufferToUrlB64(credential.response.authenticatorData),\n      signature: Utils.fromBufferToUrlB64(credential.response.signature),\n      clientDataJSON: Utils.fromBufferToUrlB64(credential.response.clientDataJSON),\n      userHandle: Utils.fromBufferToUrlB64(credential.response.userHandle),\n    };\n  }\n\n  static fromJSON(json: Jsonify<WebAuthnLoginAssertionResponseRequest>) {\n    return Object.assign(Object.create(WebAuthnLoginAssertionResponseRequest.prototype), json);\n  }\n}\n","export enum EncryptionType {\n  AesCbc256_B64 = 0,\n  AesCbc128_HmacSha256_B64 = 1,\n  AesCbc256_HmacSha256_B64 = 2,\n  Rsa2048_OaepSha256_B64 = 3,\n  Rsa2048_OaepSha1_B64 = 4,\n  Rsa2048_OaepSha256_HmacSha256_B64 = 5,\n  Rsa2048_OaepSha1_HmacSha256_B64 = 6,\n}\n\n/** The expected number of parts to a serialized EncString of the given encryption type.\n * For example, an EncString of type AesCbc256_B64 will have 2 parts, and an EncString of type\n * AesCbc128_HmacSha256_B64 will have 3 parts.\n *\n * Example of annotated serialized EncStrings:\n * 0.iv|data\n * 1.iv|data|mac\n * 2.iv|data|mac\n * 3.data\n * 4.data\n *\n * @see EncString\n * @see EncryptionType\n * @see EncString.parseEncryptedString\n */\nexport const EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE = {\n  [EncryptionType.AesCbc256_B64]: 2,\n  [EncryptionType.AesCbc128_HmacSha256_B64]: 3,\n  [EncryptionType.AesCbc256_HmacSha256_B64]: 3,\n  [EncryptionType.Rsa2048_OaepSha256_B64]: 1,\n  [EncryptionType.Rsa2048_OaepSha1_B64]: 1,\n  [EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64]: 2,\n  [EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64]: 2,\n};\n","export enum FileUploadType {\n  Direct = 0,\n  Azure = 1,\n}\n","export enum HashPurpose {\n  ServerAuthorization = 1,\n  LocalAuthorization = 2,\n}\n","export enum HtmlStorageLocation {\n  Local = \"local\",\n  Memory = \"memory\",\n  Session = \"session\",\n}\n","import { PBKDF2KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { RangeWithDefault } from \"../misc/range-with-default\";\n\nexport enum KdfType {\n  PBKDF2_SHA256 = 0,\n  Argon2id = 1,\n}\n\nexport const ARGON2_MEMORY = new RangeWithDefault(16, 1024, 64);\nexport const ARGON2_PARALLELISM = new RangeWithDefault(1, 16, 4);\nexport const ARGON2_ITERATIONS = new RangeWithDefault(2, 10, 3);\n\nexport const DEFAULT_KDF_TYPE = KdfType.PBKDF2_SHA256;\nexport const PBKDF2_ITERATIONS = new RangeWithDefault(600_000, 2_000_000, 600_000);\nexport const DEFAULT_KDF_CONFIG = new PBKDF2KdfConfig(PBKDF2_ITERATIONS.defaultValue);\n","import { Jsonify } from \"type-fest\";\n\nimport {\n  ARGON2_ITERATIONS,\n  ARGON2_MEMORY,\n  ARGON2_PARALLELISM,\n  KdfType,\n  PBKDF2_ITERATIONS,\n} from \"../../../platform/enums/kdf-type.enum\";\n\n/**\n * Represents a type safe KDF configuration.\n */\nexport type KdfConfig = PBKDF2KdfConfig | Argon2KdfConfig;\n\n/**\n * Password-Based Key Derivation Function 2 (PBKDF2) KDF configuration.\n */\nexport class PBKDF2KdfConfig {\n  kdfType: KdfType.PBKDF2_SHA256 = KdfType.PBKDF2_SHA256;\n  iterations: number;\n\n  constructor(iterations?: number) {\n    this.iterations = iterations ?? PBKDF2_ITERATIONS.defaultValue;\n  }\n\n  /**\n   * Validates the PBKDF2 KDF configuration.\n   * A Valid PBKDF2 KDF configuration has KDF iterations between the 600_000 and 2_000_000.\n   */\n  validateKdfConfig(): void {\n    if (!PBKDF2_ITERATIONS.inRange(this.iterations)) {\n      throw new Error(\n        `PBKDF2 iterations must be between ${PBKDF2_ITERATIONS.min} and ${PBKDF2_ITERATIONS.max}`,\n      );\n    }\n  }\n\n  static fromJSON(json: Jsonify<PBKDF2KdfConfig>): PBKDF2KdfConfig {\n    return new PBKDF2KdfConfig(json.iterations);\n  }\n}\n\n/**\n * Argon2 KDF configuration.\n */\nexport class Argon2KdfConfig {\n  kdfType: KdfType.Argon2id = KdfType.Argon2id;\n  iterations: number;\n  memory: number;\n  parallelism: number;\n\n  constructor(iterations?: number, memory?: number, parallelism?: number) {\n    this.iterations = iterations ?? ARGON2_ITERATIONS.defaultValue;\n    this.memory = memory ?? ARGON2_MEMORY.defaultValue;\n    this.parallelism = parallelism ?? ARGON2_PARALLELISM.defaultValue;\n  }\n\n  /**\n   * Validates the Argon2 KDF configuration.\n   * A Valid Argon2 KDF configuration has iterations between 2 and 10, memory between 16mb and 1024mb, and parallelism between 1 and 16.\n   */\n  validateKdfConfig(): void {\n    if (!ARGON2_ITERATIONS.inRange(this.iterations)) {\n      throw new Error(\n        `Argon2 iterations must be between ${ARGON2_ITERATIONS.min} and ${ARGON2_ITERATIONS.max}`,\n      );\n    }\n\n    if (!ARGON2_MEMORY.inRange(this.memory)) {\n      throw new Error(\n        `Argon2 memory must be between ${ARGON2_MEMORY.min}mb and ${ARGON2_MEMORY.max}mb`,\n      );\n    }\n\n    if (!ARGON2_PARALLELISM.inRange(this.parallelism)) {\n      throw new Error(\n        `Argon2 parallelism must be between ${ARGON2_PARALLELISM.min} and ${ARGON2_PARALLELISM.max}.`,\n      );\n    }\n  }\n\n  static fromJSON(json: Jsonify<Argon2KdfConfig>): Argon2KdfConfig {\n    return new Argon2KdfConfig(json.iterations, json.memory, json.parallelism);\n  }\n}\n","/**\n * A range with a default value.\n *\n * Enforces constraints to ensure min > default > max.\n */\nexport class RangeWithDefault {\n  constructor(\n    readonly min: number,\n    readonly max: number,\n    readonly defaultValue: number,\n  ) {\n    if (min > max) {\n      throw new Error(`${min} is greater than ${max}.`);\n    }\n\n    if (this.inRange(defaultValue) === false) {\n      throw new Error(\"Default value is not in range.\");\n    }\n  }\n\n  inRange(value: number): boolean {\n    return value >= this.min && value <= this.max;\n  }\n}\n","export enum KeySuffixOptions {\n  Auto = \"auto\",\n  Biometric = \"biometric\",\n  Pin = \"pin\",\n}\n","export enum StorageLocation {\n  Both = \"both\",\n  Disk = \"disk\",\n  Memory = \"memory\",\n}\n","export enum ThemeType {\n  System = \"system\",\n  Light = \"light\",\n  Dark = \"dark\",\n  Nord = \"nord\",\n  SolarizedDark = \"solarizedDark\",\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncryptionType } from \"../../enums\";\n\nexport class SymmetricCryptoKey {\n  key: Uint8Array;\n  encKey?: Uint8Array;\n  macKey?: Uint8Array;\n  encType: EncryptionType;\n\n  keyB64: string;\n  encKeyB64: string;\n  macKeyB64: string;\n\n  meta: any;\n\n  constructor(key: Uint8Array, encType?: EncryptionType) {\n    if (key == null) {\n      throw new Error(\"Must provide key\");\n    }\n\n    if (encType == null) {\n      if (key.byteLength === 32) {\n        encType = EncryptionType.AesCbc256_B64;\n      } else if (key.byteLength === 64) {\n        encType = EncryptionType.AesCbc256_HmacSha256_B64;\n      } else {\n        throw new Error(\"Unable to determine encType.\");\n      }\n    }\n\n    this.key = key;\n    this.encType = encType;\n\n    if (encType === EncryptionType.AesCbc256_B64 && key.byteLength === 32) {\n      this.encKey = key;\n      this.macKey = null;\n    } else if (encType === EncryptionType.AesCbc128_HmacSha256_B64 && key.byteLength === 32) {\n      this.encKey = key.slice(0, 16);\n      this.macKey = key.slice(16, 32);\n    } else if (encType === EncryptionType.AesCbc256_HmacSha256_B64 && key.byteLength === 64) {\n      this.encKey = key.slice(0, 32);\n      this.macKey = key.slice(32, 64);\n    } else {\n      throw new Error(\"Unsupported encType/key length.\");\n    }\n\n    if (this.key != null) {\n      this.keyB64 = Utils.fromBufferToB64(this.key);\n    }\n    if (this.encKey != null) {\n      this.encKeyB64 = Utils.fromBufferToB64(this.encKey);\n    }\n    if (this.macKey != null) {\n      this.macKeyB64 = Utils.fromBufferToB64(this.macKey);\n    }\n  }\n\n  toJSON() {\n    // The whole object is constructed from the initial key, so just store the B64 key\n    return { keyB64: this.keyB64 };\n  }\n\n  static fromString(s: string): SymmetricCryptoKey {\n    if (s == null) {\n      return null;\n    }\n\n    const arrayBuffer = Utils.fromB64ToArray(s);\n    return new SymmetricCryptoKey(arrayBuffer);\n  }\n\n  static fromJSON(obj: Jsonify<SymmetricCryptoKey>): SymmetricCryptoKey {\n    return SymmetricCryptoKey.fromString(obj?.keyB64);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { AuthenticationType } from \"@bitwarden/common/auth/enums/authentication-type\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { WebAuthnLoginAssertionResponseRequest } from \"@bitwarden/common/auth/services/webauthn-login/request/webauthn-login-assertion-response.request\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { UserKey, MasterKey } from \"@bitwarden/common/types/key\";\n\nexport class PasswordLoginCredentials {\n  readonly type = AuthenticationType.Password;\n\n  constructor(\n    public email: string,\n    public masterPassword: string,\n    public captchaToken?: string,\n    public twoFactor?: TokenTwoFactorRequest,\n  ) {}\n}\n\nexport class SsoLoginCredentials {\n  readonly type = AuthenticationType.Sso;\n\n  constructor(\n    public code: string,\n    public codeVerifier: string,\n    public redirectUrl: string,\n    public orgId: string,\n    /**\n     * Optional email address for SSO login.\n     * Used for looking up 2FA token on clients that support remembering 2FA token.\n     */\n    public email?: string,\n    public twoFactor?: TokenTwoFactorRequest,\n  ) {}\n}\n\nexport class UserApiLoginCredentials {\n  readonly type = AuthenticationType.UserApiKey;\n\n  constructor(\n    public clientId: string,\n    public clientSecret: string,\n  ) {}\n}\n\nexport class AuthRequestLoginCredentials {\n  readonly type = AuthenticationType.AuthRequest;\n\n  constructor(\n    public email: string,\n    public accessCode: string,\n    public authRequestId: string,\n    public decryptedUserKey: UserKey,\n    public decryptedMasterKey: MasterKey,\n    public decryptedMasterKeyHash: string,\n    public twoFactor?: TokenTwoFactorRequest,\n  ) {}\n\n  static fromJSON(json: Jsonify<AuthRequestLoginCredentials>) {\n    return Object.assign(\n      new AuthRequestLoginCredentials(\n        json.email,\n        json.accessCode,\n        json.authRequestId,\n        null,\n        null,\n        json.decryptedMasterKeyHash,\n        json.twoFactor\n          ? new TokenTwoFactorRequest(\n              json.twoFactor.provider,\n              json.twoFactor.token,\n              json.twoFactor.remember,\n            )\n          : json.twoFactor,\n      ),\n      {\n        decryptedUserKey: SymmetricCryptoKey.fromJSON(json.decryptedUserKey) as UserKey,\n        decryptedMasterKey: SymmetricCryptoKey.fromJSON(json.decryptedMasterKey) as MasterKey,\n      },\n    );\n  }\n}\n\nexport class WebAuthnLoginCredentials {\n  readonly type = AuthenticationType.WebAuthn;\n\n  constructor(\n    public token: string,\n    public deviceResponse: WebAuthnLoginAssertionResponseRequest,\n    public prfKey?: SymmetricCryptoKey,\n  ) {}\n\n  static fromJSON(json: Jsonify<WebAuthnLoginCredentials>) {\n    return new WebAuthnLoginCredentials(\n      json.token,\n      Object.assign(\n        Object.create(WebAuthnLoginAssertionResponseRequest.prototype),\n        json.deviceResponse,\n      ),\n      SymmetricCryptoKey.fromJSON(json.prfKey),\n    );\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { KeyConnectorUserDecryptionOptionResponse } from \"@bitwarden/common/auth/models/response/user-decryption-options/key-connector-user-decryption-option.response\";\nimport { TrustedDeviceUserDecryptionOptionResponse } from \"@bitwarden/common/auth/models/response/user-decryption-options/trusted-device-user-decryption-option.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/src/auth/models/response/identity-token.response\";\n\n/**\n * Key Connector decryption options. Intended to be sent to the client for use after authentication.\n * @see {@link UserDecryptionOptions}\n */\nexport class KeyConnectorUserDecryptionOption {\n  /** The URL of the key connector configured for this user. */\n  keyConnectorUrl: string;\n\n  /**\n   * Initializes a new instance of the KeyConnectorUserDecryptionOption from a response object.\n   * @param response The key connector user decryption option response object.\n   * @returns A new instance of the KeyConnectorUserDecryptionOption or undefined if `response` is nullish.\n   */\n  static fromResponse(\n    response: KeyConnectorUserDecryptionOptionResponse,\n  ): KeyConnectorUserDecryptionOption | undefined {\n    if (response == null) {\n      return undefined;\n    }\n    const options = new KeyConnectorUserDecryptionOption();\n    options.keyConnectorUrl = response?.keyConnectorUrl ?? null;\n    return options;\n  }\n\n  /**\n   * Initializes a new instance of a KeyConnectorUserDecryptionOption from a JSON object.\n   * @param obj JSON object to deserialize.\n   * @returns A new instance of the KeyConnectorUserDecryptionOption or undefined if `obj` is nullish.\n   */\n  static fromJSON(\n    obj: Jsonify<KeyConnectorUserDecryptionOption>,\n  ): KeyConnectorUserDecryptionOption | undefined {\n    if (obj == null) {\n      return undefined;\n    }\n    return Object.assign(new KeyConnectorUserDecryptionOption(), obj);\n  }\n}\n\n/**\n * Trusted device decryption options. Intended to be sent to the client for use after authentication.\n * @see {@link UserDecryptionOptions}\n */\nexport class TrustedDeviceUserDecryptionOption {\n  /** True if an admin has approved an admin auth request previously made from this device. */\n  hasAdminApproval: boolean;\n  /** True if the user has a device capable of approving an auth request. */\n  hasLoginApprovingDevice: boolean;\n  /** True if the user has manage reset password permission, as these users must be forced to have a master password. */\n  hasManageResetPasswordPermission: boolean;\n\n  /**\n   * Initializes a new instance of the TrustedDeviceUserDecryptionOption from a response object.\n   * @param response The trusted device user decryption option response object.\n   * @returns A new instance of the TrustedDeviceUserDecryptionOption or undefined if `response` is nullish.\n   */\n  static fromResponse(\n    response: TrustedDeviceUserDecryptionOptionResponse,\n  ): TrustedDeviceUserDecryptionOption | undefined {\n    if (response == null) {\n      return undefined;\n    }\n    const options = new TrustedDeviceUserDecryptionOption();\n    options.hasAdminApproval = response?.hasAdminApproval ?? false;\n    options.hasLoginApprovingDevice = response?.hasLoginApprovingDevice ?? false;\n    options.hasManageResetPasswordPermission = response?.hasManageResetPasswordPermission ?? false;\n    return options;\n  }\n\n  /**\n   * Initializes a new instance of the TrustedDeviceUserDecryptionOption from a JSON object.\n   * @param obj JSON object to deserialize.\n   * @returns A new instance of the TrustedDeviceUserDecryptionOption or undefined if `obj` is nullish.\n   */\n  static fromJSON(\n    obj: Jsonify<TrustedDeviceUserDecryptionOption>,\n  ): TrustedDeviceUserDecryptionOption | undefined {\n    if (obj == null) {\n      return undefined;\n    }\n    return Object.assign(new TrustedDeviceUserDecryptionOption(), obj);\n  }\n}\n\n/**\n * Represents the decryption options the user has configured on the server. This is intended to be sent\n * to the client on authentication, and can be used to determine how to decrypt the user's vault.\n */\nexport class UserDecryptionOptions {\n  /** True if the user has a master password configured on the server. */\n  hasMasterPassword: boolean;\n  /** {@link TrustedDeviceUserDecryptionOption} */\n  trustedDeviceOption?: TrustedDeviceUserDecryptionOption;\n  /** {@link KeyConnectorUserDecryptionOption} */\n  keyConnectorOption?: KeyConnectorUserDecryptionOption;\n\n  /**\n   * Initializes a new instance of the UserDecryptionOptions from a response object.\n   * @param response user decryption options response object\n   * @returns A new instance of the UserDecryptionOptions.\n   * @throws If the response is nullish, this method will throw an error. User decryption options\n   * are required for client initialization.\n   */\n  // TODO: Change response type to `UserDecryptionOptionsResponse` after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n  static fromResponse(response: IdentityTokenResponse): UserDecryptionOptions {\n    if (response == null) {\n      throw new Error(\"User Decryption Options are required for client initialization.\");\n    }\n\n    const decryptionOptions = new UserDecryptionOptions();\n\n    if (response.userDecryptionOptions) {\n      // If the response has userDecryptionOptions, this means it's on a post-TDE server version and can interrogate\n      // the new decryption options.\n      const responseOptions = response.userDecryptionOptions;\n      decryptionOptions.hasMasterPassword = responseOptions.hasMasterPassword;\n\n      decryptionOptions.trustedDeviceOption = TrustedDeviceUserDecryptionOption.fromResponse(\n        responseOptions.trustedDeviceOption,\n      );\n\n      decryptionOptions.keyConnectorOption = KeyConnectorUserDecryptionOption.fromResponse(\n        responseOptions.keyConnectorOption,\n      );\n    } else {\n      // If the response does not have userDecryptionOptions, this means it's on a pre-TDE server version and so\n      // we must base our decryption options on the presence of the keyConnectorUrl.\n      // Note that the presence of keyConnectorUrl implies that the user does not have a master password, as in pre-TDE\n      // server versions, a master password short-circuited the addition of the keyConnectorUrl to the response.\n      // TODO: remove this check after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n      const usingKeyConnector = response.keyConnectorUrl != null;\n      decryptionOptions.hasMasterPassword = !usingKeyConnector;\n      if (usingKeyConnector) {\n        decryptionOptions.keyConnectorOption = new KeyConnectorUserDecryptionOption();\n        decryptionOptions.keyConnectorOption.keyConnectorUrl = response.keyConnectorUrl;\n      }\n    }\n    return decryptionOptions;\n  }\n\n  /**\n   * Initializes a new instance of the UserDecryptionOptions from a JSON object.\n   * @param obj JSON object to deserialize.\n   * @returns A new instance of the UserDecryptionOptions. Will initialize even if the JSON object is nullish.\n   */\n  static fromJSON(obj: Jsonify<UserDecryptionOptions>): UserDecryptionOptions {\n    const decryptionOptions = Object.assign(new UserDecryptionOptions(), obj);\n\n    decryptionOptions.trustedDeviceOption = TrustedDeviceUserDecryptionOption.fromJSON(\n      obj?.trustedDeviceOption,\n    );\n\n    decryptionOptions.keyConnectorOption = KeyConnectorUserDecryptionOption.fromJSON(\n      obj?.keyConnectorOption,\n    );\n\n    return decryptionOptions;\n  }\n}\n","import { Jsonify, Opaque } from \"type-fest\";\n\nimport { EncryptionType, EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE } from \"../../enums\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\nimport { Utils } from \"../../misc/utils\";\n\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\nexport class EncString implements Encrypted {\n  encryptedString?: EncryptedString;\n  encryptionType?: EncryptionType;\n  decryptedValue?: string;\n  data?: string;\n  iv?: string;\n  mac?: string;\n\n  constructor(\n    encryptedStringOrType: string | EncryptionType,\n    data?: string,\n    iv?: string,\n    mac?: string,\n  ) {\n    if (data != null) {\n      this.initFromData(encryptedStringOrType as EncryptionType, data, iv, mac);\n    } else {\n      this.initFromEncryptedString(encryptedStringOrType as string);\n    }\n  }\n\n  get ivBytes(): Uint8Array {\n    return this.iv == null ? null : Utils.fromB64ToArray(this.iv);\n  }\n\n  get macBytes(): Uint8Array {\n    return this.mac == null ? null : Utils.fromB64ToArray(this.mac);\n  }\n\n  get dataBytes(): Uint8Array {\n    return this.data == null ? null : Utils.fromB64ToArray(this.data);\n  }\n\n  toJSON() {\n    return this.encryptedString as string;\n  }\n\n  static fromJSON(obj: Jsonify<EncString>): EncString {\n    if (obj == null) {\n      return null;\n    }\n\n    return new EncString(obj);\n  }\n\n  private initFromData(encType: EncryptionType, data: string, iv: string, mac: string) {\n    if (iv != null) {\n      this.encryptedString = (encType + \".\" + iv + \"|\" + data) as EncryptedString;\n    } else {\n      this.encryptedString = (encType + \".\" + data) as EncryptedString;\n    }\n\n    // mac\n    if (mac != null) {\n      this.encryptedString = (this.encryptedString + \"|\" + mac) as EncryptedString;\n    }\n\n    this.encryptionType = encType;\n    this.data = data;\n    this.iv = iv;\n    this.mac = mac;\n  }\n\n  private initFromEncryptedString(encryptedString: string) {\n    this.encryptedString = encryptedString as EncryptedString;\n    if (!this.encryptedString) {\n      return;\n    }\n\n    const { encType, encPieces } = EncString.parseEncryptedString(this.encryptedString);\n\n    this.encryptionType = encType;\n\n    if (encPieces.length !== EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE[encType]) {\n      return;\n    }\n\n    switch (encType) {\n      case EncryptionType.AesCbc128_HmacSha256_B64:\n      case EncryptionType.AesCbc256_HmacSha256_B64:\n        this.iv = encPieces[0];\n        this.data = encPieces[1];\n        this.mac = encPieces[2];\n        break;\n      case EncryptionType.AesCbc256_B64:\n        this.iv = encPieces[0];\n        this.data = encPieces[1];\n        break;\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n        this.data = encPieces[0];\n        break;\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        this.data = encPieces[0];\n        this.mac = encPieces[1];\n        break;\n      default:\n        return;\n    }\n  }\n\n  private static parseEncryptedString(encryptedString: string): {\n    encType: EncryptionType;\n    encPieces: string[];\n  } {\n    const headerPieces = encryptedString.split(\".\");\n    let encType: EncryptionType;\n    let encPieces: string[] = null;\n\n    if (headerPieces.length === 2) {\n      try {\n        encType = parseInt(headerPieces[0], null);\n        encPieces = headerPieces[1].split(\"|\");\n      } catch (e) {\n        return { encType: NaN, encPieces: [] };\n      }\n    } else {\n      encPieces = encryptedString.split(\"|\");\n      encType =\n        encPieces.length === 3\n          ? EncryptionType.AesCbc128_HmacSha256_B64\n          : EncryptionType.AesCbc256_B64;\n    }\n\n    return {\n      encType,\n      encPieces,\n    };\n  }\n\n  static isSerializedEncString(s: string): boolean {\n    if (s == null) {\n      return false;\n    }\n\n    const { encType, encPieces } = this.parseEncryptedString(s);\n\n    if (isNaN(encType) || encPieces.length === 0) {\n      return false;\n    }\n\n    return EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE[encType] === encPieces.length;\n  }\n\n  async decrypt(orgId: string, key: SymmetricCryptoKey = null): Promise<string> {\n    if (this.decryptedValue != null) {\n      return this.decryptedValue;\n    }\n\n    try {\n      if (key == null) {\n        key = await this.getKeyForDecryption(orgId);\n      }\n      if (key == null) {\n        throw new Error(\"No key to decrypt EncString with orgId \" + orgId);\n      }\n\n      const encryptService = Utils.getContainerService().getEncryptService();\n      this.decryptedValue = await encryptService.decryptToUtf8(this, key);\n    } catch (e) {\n      this.decryptedValue = \"[error: cannot decrypt]\";\n    }\n    return this.decryptedValue;\n  }\n\n  private async getKeyForDecryption(orgId: string) {\n    const cryptoService = Utils.getContainerService().getCryptoService();\n    return orgId != null\n      ? await cryptoService.getOrgKey(orgId)\n      : await cryptoService.getUserKeyWithLegacySupport();\n  }\n}\n\nexport type EncryptedString = Opaque<string, \"EncString\">;\n","import { Jsonify } from \"type-fest\";\n\nimport { UserId } from \"../../types/guid\";\nimport { DerivedStateDependencies, StorageKey } from \"../../types/state\";\n\nimport { KeyDefinition } from \"./key-definition\";\nimport { StateDefinition } from \"./state-definition\";\nimport { UserKeyDefinition } from \"./user-key-definition\";\n\ndeclare const depShapeMarker: unique symbol;\n/**\n * A set of options for customizing the behavior of a {@link DeriveDefinition}\n */\ntype DeriveDefinitionOptions<TFrom, TTo, TDeps extends DerivedStateDependencies = never> = {\n  /**\n   * A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   *\n   * @param from Populated with the latest emission from the parent state observable.\n   * @param deps Populated with the dependencies passed into the constructor of the derived state.\n   * These are constant for the lifetime of the derived state.\n   * @returns  The derived state value or a Promise that resolves to the derived state value.\n   */\n  derive: (from: TFrom, deps: TDeps) => TTo | Promise<TTo>;\n  /**\n   * A function to use to safely convert your type from json to your expected type.\n   *\n   * **Important:** Your data may be serialized/deserialized at any time and this\n   *  callback needs to be able to faithfully re-initialize from the JSON object representation of your type.\n   *\n   * @param jsonValue The JSON object representation of your state.\n   * @returns The fully typed version of your state.\n   */\n  deserializer: (serialized: Jsonify<TTo>) => TTo;\n  /**\n   * An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   *\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   */\n  [depShapeMarker]?: TDeps;\n  /**\n   * The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   */\n  cleanupDelayMs?: number;\n  /**\n   * Whether or not to clear the derived state when cleanup occurs. Defaults to true.\n   */\n  clearOnCleanup?: boolean;\n};\n\n/**\n * DeriveDefinitions describe state derived from another observable, the value type of which is given by `TFrom`.\n *\n * The StateDefinition is used to describe the domain of the state, and the DeriveDefinition\n * sub-divides that domain into specific keys. These keys are used to cache data in memory and enables derived state to\n * be calculated once regardless of multiple execution contexts.\n */\n\nexport class DeriveDefinition<TFrom, TTo, TDeps extends DerivedStateDependencies> {\n  /**\n   * Creates a new instance of a DeriveDefinition. Derived state is always stored in memory, so the storage location\n   * defined in @link{StateDefinition} is ignored.\n   *\n   * @param stateDefinition The state definition for which this key belongs to.\n   * @param uniqueDerivationName The name of the key, this should be unique per domain.\n   * @param options A set of options to customize the behavior of {@link DeriveDefinition}.\n   * @param options.derive A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   * @param options.cleanupDelayMs The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   * @param options.dependencyShape An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   *\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   */\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly uniqueDerivationName: string,\n    readonly options: DeriveDefinitionOptions<TFrom, TTo, TDeps>,\n  ) {}\n\n  /**\n   * Factory that produces a {@link DeriveDefinition} from a {@link KeyDefinition} or {@link DeriveDefinition} and new name.\n   *\n   * If a `KeyDefinition` is passed in, the returned definition will have the same key as the given key definition, but\n   * will not collide with it in storage, even if they both reside in memory.\n   *\n   * If a `DeriveDefinition` is passed in, the returned definition will instead use the name given in the second position\n   * of the tuple. It is up to you to ensure this is unique within the domain of derived state.\n   *\n   * @param options A set of options to customize the behavior of {@link DeriveDefinition}.\n   * @param options.derive A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   * @param options.cleanupDelayMs The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   * @param options.dependencyShape An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   *\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   * @param definition\n   * @param options\n   * @returns\n   */\n  static from<TFrom, TTo, TDeps extends DerivedStateDependencies = never>(\n    definition:\n      | KeyDefinition<TFrom>\n      | UserKeyDefinition<TFrom>\n      | [DeriveDefinition<unknown, TFrom, DerivedStateDependencies>, string],\n    options: DeriveDefinitionOptions<TFrom, TTo, TDeps>,\n  ) {\n    if (isFromDeriveDefinition(definition)) {\n      return new DeriveDefinition(definition[0].stateDefinition, definition[1], options);\n    } else {\n      return new DeriveDefinition(definition.stateDefinition, definition.key, options);\n    }\n  }\n\n  static fromWithUserId<TKeyDef, TTo, TDeps extends DerivedStateDependencies = never>(\n    definition:\n      | KeyDefinition<TKeyDef>\n      | UserKeyDefinition<TKeyDef>\n      | [DeriveDefinition<unknown, TKeyDef, DerivedStateDependencies>, string],\n    options: DeriveDefinitionOptions<[UserId, TKeyDef], TTo, TDeps>,\n  ) {\n    if (isFromDeriveDefinition(definition)) {\n      return new DeriveDefinition(definition[0].stateDefinition, definition[1], options);\n    } else {\n      return new DeriveDefinition(definition.stateDefinition, definition.key, options);\n    }\n  }\n\n  get derive() {\n    return this.options.derive;\n  }\n\n  deserialize(serialized: Jsonify<TTo>): TTo {\n    return this.options.deserializer(serialized);\n  }\n\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  get clearOnCleanup() {\n    return this.options.clearOnCleanup ?? true;\n  }\n\n  buildCacheKey(): string {\n    return `derived_${this.stateDefinition.name}_${this.uniqueDerivationName}`;\n  }\n\n  /**\n   * Creates a {@link StorageKey} that points to the data for the given derived definition.\n   * @returns A key that is ready to be used in a storage service to get data.\n   */\n  get storageKey(): StorageKey {\n    return `derived_${this.stateDefinition.name}_${this.uniqueDerivationName}` as StorageKey;\n  }\n}\n\nfunction isFromDeriveDefinition(\n  definition:\n    | KeyDefinition<unknown>\n    | UserKeyDefinition<unknown>\n    | [DeriveDefinition<unknown, unknown, DerivedStateDependencies>, string],\n): definition is [DeriveDefinition<unknown, unknown, DerivedStateDependencies>, string] {\n  return Array.isArray(definition);\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { DerivedStateDependencies } from \"../../types/state\";\n\nimport { DeriveDefinition } from \"./derive-definition\";\nimport { DerivedState } from \"./derived-state\";\nimport { GlobalState } from \"./global-state\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- used in docs\nimport { GlobalStateProvider } from \"./global-state.provider\";\nimport { KeyDefinition } from \"./key-definition\";\nimport { UserKeyDefinition } from \"./user-key-definition\";\nimport { ActiveUserState, SingleUserState } from \"./user-state\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- used in docs\nimport { ActiveUserStateProvider, SingleUserStateProvider } from \"./user-state.provider\";\n\n/** Convenience wrapper class for {@link ActiveUserStateProvider}, {@link SingleUserStateProvider},\n * and {@link GlobalStateProvider}.\n */\nexport abstract class StateProvider {\n  /** @see{@link ActiveUserStateProvider.activeUserId$} */\n  abstract activeUserId$: Observable<UserId | undefined>;\n\n  /**\n   * Gets a state observable for a given key and userId.\n   *\n   * @remarks If userId is falsy the observable returned will attempt to point to the currently active user _and not update if the active user changes_.\n   * This is different to how `getActive` works and more similar to `getUser` for whatever user happens to be active at the time of the call.\n   * If no user happens to be active at the time this method is called with a falsy userId then this observable will not emit a value until\n   * a user becomes active. If you are not confident a user is active at the time this method is called, you may want to pipe a call to `timeout`\n   * or instead call {@link getUserStateOrDefault$} and supply a value you would rather have given in the case of no passed in userId and no active user.\n   *\n   * @note consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   *\n   * @param keyDefinition - The key definition for the state you want to get.\n   * @param userId - The userId for which you want the state for. If not provided, the state for the currently active user will be returned.\n   */\n  abstract getUserState$<T>(keyDefinition: KeyDefinition<T>, userId?: UserId): Observable<T>;\n\n  /**\n   * Gets a state observable for a given key and userId.\n   *\n   * @remarks If userId is falsy the observable returned will attempt to point to the currently active user _and not update if the active user changes_.\n   * This is different to how `getActive` works and more similar to `getUser` for whatever user happens to be active at the time of the call.\n   * If no user happens to be active at the time this method is called with a falsy userId then this observable will not emit a value until\n   * a user becomes active. If you are not confident a user is active at the time this method is called, you may want to pipe a call to `timeout`\n   * or instead call {@link getUserStateOrDefault$} and supply a value you would rather have given in the case of no passed in userId and no active user.\n   *\n   * @param keyDefinition - The key definition for the state you want to get.\n   * @param userId - The userId for which you want the state for. If not provided, the state for the currently active user will be returned.\n   */\n  abstract getUserState$<T>(keyDefinition: UserKeyDefinition<T>, userId?: UserId): Observable<T>;\n\n  /**\n   * Gets a state observable for a given key and userId\n   *\n   * @remarks If userId is falsy the observable return will first attempt to point to the currently active user but will not follow subsequent active user changes,\n   * if there is no immediately available active user, then it will fallback to returning a default value in an observable that immediately completes.\n   *\n   * @note consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   *\n   * @param keyDefinition - The key definition for the state you want to get.\n   * @param config.userId - The userId for which you want the state for. If not provided, the state for the currently active user will be returned.\n   * @param config.defaultValue - The default value that should be wrapped in an observable if no active user is immediately available and no truthy userId is passed in.\n   */\n  abstract getUserStateOrDefault$<T>(\n    keyDefinition: KeyDefinition<T>,\n    config: { userId: UserId | undefined; defaultValue?: T },\n  ): Observable<T>;\n\n  /**\n   * Gets a state observable for a given key and userId\n   *\n   * @remarks If userId is falsy the observable return will first attempt to point to the currently active user but will not follow subsequent active user changes,\n   * if there is no immediately available active user, then it will fallback to returning a default value in an observable that immediately completes.\n   *\n   * @param keyDefinition - The key definition for the state you want to get.\n   * @param config.userId - The userId for which you want the state for. If not provided, the state for the currently active user will be returned.\n   * @param config.defaultValue - The default value that should be wrapped in an observable if no active user is immediately available and no truthy userId is passed in.\n   */\n  abstract getUserStateOrDefault$<T>(\n    keyDefinition: UserKeyDefinition<T>,\n    config: { userId: UserId | undefined; defaultValue?: T },\n  ): Observable<T>;\n\n  /**\n   * Sets the state for a given key and userId.\n   *\n   * @overload\n   * @param keyDefinition - The key definition for the state you want to set.\n   * @param value - The value to set the state to.\n   * @param userId - The userId for which you want to set the state for. If not provided, the state for the currently active user will be set.\n   */\n  abstract setUserState<T>(\n    keyDefinition: UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  /**\n   * Sets the state for a given key and userId.\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   *\n   * @overload\n   * @param keyDefinition - The key definition for the state you want to set.\n   * @param value - The value to set the state to.\n   * @param userId - The userId for which you want to set the state for. If not provided, the state for the currently active user will be set.\n   */\n  abstract setUserState<T>(\n    keyDefinition: KeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  abstract setUserState<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  /** @see{@link ActiveUserStateProvider.get} */\n  abstract getActive<T>(keyDefinition: UserKeyDefinition<T>): ActiveUserState<T>;\n\n  /**\n   * @see{@link ActiveUserStateProvider.get}\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   */\n  abstract getActive<T>(keyDefinition: KeyDefinition<T>): ActiveUserState<T>;\n\n  /** @see{@link ActiveUserStateProvider.get} */\n  abstract getActive<T>(keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>): ActiveUserState<T>;\n\n  /** @see{@link SingleUserStateProvider.get} */\n  abstract getUser<T>(userId: UserId, keyDefinition: UserKeyDefinition<T>): SingleUserState<T>;\n\n  /**\n   * @see{@link SingleUserStateProvider.get}\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   */\n  abstract getUser<T>(userId: UserId, keyDefinition: KeyDefinition<T>): SingleUserState<T>;\n\n  /** @see{@link SingleUserStateProvider.get} */\n  abstract getUser<T>(\n    userId: UserId,\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n  ): SingleUserState<T>;\n\n  /** @see{@link GlobalStateProvider.get} */\n  abstract getGlobal<T>(keyDefinition: KeyDefinition<T>): GlobalState<T>;\n  abstract getDerived<TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ): DerivedState<TTo>;\n}\n","import { Jsonify } from \"type-fest\";\n\n/**\n *\n * @param elementDeserializer\n * @returns\n */\nexport function array<T>(\n  elementDeserializer: (element: Jsonify<T>) => T,\n): (array: Jsonify<T[]>) => T[] {\n  return (array) => {\n    if (array == null) {\n      return null;\n    }\n\n    return array.map((element) => elementDeserializer(element));\n  };\n}\n\n/**\n *\n * @param valueDeserializer\n */\nexport function record<T, TKey extends string | number = string>(\n  valueDeserializer: (value: Jsonify<T>) => T,\n): (record: Jsonify<Record<TKey, T>>) => Record<TKey, T> {\n  return (jsonValue: Jsonify<Record<TKey, T> | null>) => {\n    if (jsonValue == null) {\n      return null;\n    }\n\n    const output: Record<TKey, T> = {} as any;\n    Object.entries(jsonValue).forEach(([key, value]) => {\n      output[key as TKey] = valueDeserializer(value);\n    });\n    return output;\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { StorageKey } from \"../../types/state\";\n\nimport { array, record } from \"./deserialization-helpers\";\nimport { StateDefinition } from \"./state-definition\";\n\n/**\n * A set of options for customizing the behavior of a {@link KeyDefinition}\n */\nexport type KeyDefinitionOptions<T> = {\n  /**\n   * A function to use to safely convert your type from json to your expected type.\n   *\n   * **Important:** Your data may be serialized/deserialized at any time and this\n   *  callback needs to be able to faithfully re-initialize from the JSON object representation of your type.\n   *\n   * @param jsonValue The JSON object representation of your state.\n   * @returns The fully typed version of your state.\n   */\n  readonly deserializer: (jsonValue: Jsonify<T>) => T;\n  /**\n   * The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   */\n  readonly cleanupDelayMs?: number;\n};\n\n/**\n * KeyDefinitions describe the precise location to store data for a given piece of state.\n * The StateDefinition is used to describe the domain of the state, and the KeyDefinition\n * sub-divides that domain into specific keys.\n */\nexport class KeyDefinition<T> {\n  /**\n   * Creates a new instance of a KeyDefinition\n   * @param stateDefinition The state definition for which this key belongs to.\n   * @param key The name of the key, this should be unique per domain.\n   * @param options A set of options to customize the behavior of {@link KeyDefinition}. All options are required.\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   */\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    private readonly options: KeyDefinitionOptions<T>,\n  ) {\n    if (options.deserializer == null) {\n      throw new Error(`'deserializer' is a required property on key ${this.errorKeyName}`);\n    }\n\n    if (options.cleanupDelayMs <= 0) {\n      throw new Error(\n        `'cleanupDelayMs' must be greater than 0. Value of ${options.cleanupDelayMs} passed to key ${this.errorKeyName} `,\n      );\n    }\n  }\n\n  /**\n   * Gets the deserializer configured for this {@link KeyDefinition}\n   */\n  get deserializer() {\n    return this.options.deserializer;\n  }\n\n  /**\n   * Gets the number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   */\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  /**\n   * Creates a {@link KeyDefinition} for state that is an array.\n   * @param stateDefinition The state definition to be added to the KeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link KeyDefinition}.\n   * @returns A {@link KeyDefinition} initialized for arrays, the options run\n   * the deserializer on the provided options for each element of an array.\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = KeyDefinition.array<MyArrayElement>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonElement) => convertToElement(myJsonElement),\n   * });\n   * ```\n   */\n  static array<T>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the element of the array, depending on future options we add, this could get a little weird.\n    options: KeyDefinitionOptions<T>, // The array helper forces  an initialValue of an empty array\n  ) {\n    return new KeyDefinition<T[]>(stateDefinition, key, {\n      ...options,\n      deserializer: array((e) => options.deserializer(e)),\n    });\n  }\n\n  /**\n   * Creates a {@link KeyDefinition} for state that is a record.\n   * @param stateDefinition The state definition to be added to the KeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link KeyDefinition}.\n   * @returns A {@link KeyDefinition} that contains a serializer that will run the provided deserializer for each\n   * value in a record and returns every key as a string.\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = KeyDefinition.record<MyRecordValue>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonValue) => convertToValue(myJsonValue),\n   * });\n   * ```\n   */\n  static record<T, TKey extends string | number = string>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the value of the record, depending on future options we add, this could get a little weird.\n    options: KeyDefinitionOptions<T>, // The array helper forces an initialValue of an empty record\n  ) {\n    return new KeyDefinition<Record<TKey, T>>(stateDefinition, key, {\n      ...options,\n      deserializer: record((v) => options.deserializer(v)),\n    });\n  }\n\n  get fullName() {\n    return `${this.stateDefinition.name}_${this.key}`;\n  }\n\n  protected get errorKeyName() {\n    return `${this.stateDefinition.name} > ${this.key}`;\n  }\n}\n\n/**\n * Creates a {@link StorageKey}\n * @param keyDefinition The key definition of which data the key should point to.\n * @returns A key that is ready to be used in a storage service to get data.\n */\nexport function globalKeyBuilder(keyDefinition: KeyDefinition<unknown>): StorageKey {\n  return `global_${keyDefinition.stateDefinition.name}_${keyDefinition.key}` as StorageKey;\n}\n","import { UserId } from \"../../types/guid\";\nimport { StorageKey } from \"../../types/state\";\nimport { Utils } from \"../misc/utils\";\n\nimport { array, record } from \"./deserialization-helpers\";\nimport { KeyDefinition, KeyDefinitionOptions } from \"./key-definition\";\nimport { StateDefinition } from \"./state-definition\";\n\nexport type ClearEvent = \"lock\" | \"logout\";\n\nexport type UserKeyDefinitionOptions<T> = KeyDefinitionOptions<T> & {\n  clearOn: ClearEvent[];\n};\n\nconst USER_KEY_DEFINITION_MARKER: unique symbol = Symbol(\"UserKeyDefinition\");\n\nexport function isUserKeyDefinition<T>(\n  keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n): keyDefinition is UserKeyDefinition<T> {\n  return (\n    USER_KEY_DEFINITION_MARKER in keyDefinition &&\n    keyDefinition[USER_KEY_DEFINITION_MARKER] === true\n  );\n}\n\nexport class UserKeyDefinition<T> {\n  readonly [USER_KEY_DEFINITION_MARKER] = true;\n  /**\n   * A unique array of events that the state stored at this key should be cleared on.\n   */\n  readonly clearOn: ClearEvent[];\n\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    private readonly options: UserKeyDefinitionOptions<T>,\n  ) {\n    if (options.deserializer == null) {\n      throw new Error(`'deserializer' is a required property on key ${this.errorKeyName}`);\n    }\n\n    if (options.cleanupDelayMs <= 0) {\n      throw new Error(\n        `'cleanupDelayMs' must be greater than 0. Value of ${options.cleanupDelayMs} passed to key ${this.errorKeyName} `,\n      );\n    }\n\n    // Filter out repeat values\n    this.clearOn = Array.from(new Set(options.clearOn));\n  }\n\n  /**\n   * Gets the deserializer configured for this {@link KeyDefinition}\n   */\n  get deserializer() {\n    return this.options.deserializer;\n  }\n\n  /**\n   * Gets the number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   */\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  /**\n   *\n   * @param keyDefinition\n   * @returns\n   *\n   * @deprecated You should not use this to convert, just create a {@link UserKeyDefinition}\n   */\n  static fromBaseKeyDefinition<T>(keyDefinition: KeyDefinition<T>) {\n    return new UserKeyDefinition<T>(keyDefinition.stateDefinition, keyDefinition.key, {\n      ...keyDefinition[\"options\"],\n      clearOn: [], // Default to not clearing\n    });\n  }\n\n  /**\n   * Creates a {@link UserKeyDefinition} for state that is an array.\n   * @param stateDefinition The state definition to be added to the UserKeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link UserKeyDefinition}.\n   * @returns A {@link UserKeyDefinition} initialized for arrays, the options run\n   * the deserializer on the provided options for each element of an array\n   * **unless that array is null, in which case it will return an empty list.**\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = UserKeyDefinition.array<MyArrayElement>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonElement) => convertToElement(myJsonElement),\n   * });\n   * ```\n   */\n  static array<T>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the element of the array, depending on future options we add, this could get a little weird.\n    options: UserKeyDefinitionOptions<T>,\n  ) {\n    return new UserKeyDefinition<T[]>(stateDefinition, key, {\n      ...options,\n      deserializer: array((e) => options.deserializer(e)),\n    });\n  }\n\n  /**\n   * Creates a {@link UserKeyDefinition} for state that is a record.\n   * @param stateDefinition The state definition to be added to the UserKeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link UserKeyDefinition}.\n   * @returns A {@link UserKeyDefinition} that contains a serializer that will run the provided deserializer for each\n   * value in a record and returns every key as a string **unless that record is null, in which case it will return an record.**\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = UserKeyDefinition.record<MyRecordValue>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonValue) => convertToValue(myJsonValue),\n   * });\n   * ```\n   */\n  static record<T, TKey extends string | number = string>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the value of the record, depending on future options we add, this could get a little weird.\n    options: UserKeyDefinitionOptions<T>, // The array helper forces an initialValue of an empty record\n  ) {\n    return new UserKeyDefinition<Record<TKey, T>>(stateDefinition, key, {\n      ...options,\n      deserializer: record((v) => options.deserializer(v)),\n    });\n  }\n\n  get fullName() {\n    return `${this.stateDefinition.name}_${this.key}`;\n  }\n\n  buildKey(userId: UserId) {\n    if (!Utils.isGuid(userId)) {\n      throw new Error(\n        `You cannot build a user key without a valid UserId, building for key ${this.fullName}`,\n      );\n    }\n    return `user_${userId}_${this.stateDefinition.name}_${this.key}` as StorageKey;\n  }\n\n  private get errorKeyName() {\n    return `${this.stateDefinition.name} > ${this.key}`;\n  }\n}\n","/**\n * Default storage location options.\n *\n * `disk` generally means state that is accessible between restarts of the application,\n * with the exception of the web client. In web this means `sessionStorage`. The data\n * persists through refreshes of the page but not available once that tab is closed or\n * from any other tabs.\n *\n * `memory` means that the information stored there goes away during application\n * restarts.\n */\nexport type StorageLocation = \"disk\" | \"memory\";\n\n/**\n * *Note*: The property names of this object should match exactly with the string values of the {@link ClientType} enum\n */\nexport type ClientLocations = {\n  /**\n   * Overriding storage location for the web client.\n   *\n   * Includes an extra storage location to store data in `localStorage`\n   * that is available from different tabs and after a tab has closed.\n   */\n  web: StorageLocation | \"disk-local\";\n  /**\n   * Overriding storage location for browser clients.\n   *\n   * \"memory-large-object\" is used to store non-countable objects in memory. This exists due to limited persistent memory available to browser extensions.\n   */\n  browser: StorageLocation | \"memory-large-object\";\n  /**\n   * Overriding storage location for desktop clients.\n   */\n  //desktop: StorageLocation;\n  /**\n   * Overriding storage location for CLI clients.\n   */\n  //cli: StorageLocation;\n};\n\n/**\n * Defines the base location and instruction of where this state is expected to be located.\n */\nexport class StateDefinition {\n  readonly storageLocationOverrides: Partial<ClientLocations>;\n\n  /**\n   * Creates a new instance of {@link StateDefinition}, the creation of which is owned by the platform team.\n   * @param name The name of the state, this needs to be unique from all other {@link StateDefinition}'s.\n   * @param defaultStorageLocation The location of where this state should be stored.\n   */\n  constructor(\n    readonly name: string,\n    readonly defaultStorageLocation: StorageLocation,\n    storageLocationOverrides?: Partial<ClientLocations>,\n  ) {\n    this.storageLocationOverrides = storageLocationOverrides ?? {};\n  }\n}\n","import { StateDefinition } from \"./state-definition\";\n\n/**\n * `StateDefinition`s comes with some rules, to facilitate a quick review from\n * platform of this file, ensure you follow these rules, the ones marked with (tested)\n * have unit tests that you can run locally.\n *\n * 1. (tested) Names should not be null or undefined\n * 2. (tested) Name and storage location should be unique\n * 3. (tested) Name and storage location can't differ from another export by only casing\n * 4. (tested) Name should be longer than 3 characters. It should be descriptive, but brief.\n * 5. (tested) Name should not contain spaces or underscores\n * 6. Name should be human readable\n * 7. Name should be in camelCase format (unit tests ensure the first character is lowercase)\n * 8. Teams should only use state definitions they have created\n * 9. StateDefinitions should only be used for keys relating to the state name they chose\n *\n */\n\n// Admin Console\n\nexport const ORGANIZATIONS_DISK = new StateDefinition(\"organizations\", \"disk\");\nexport const POLICIES_DISK = new StateDefinition(\"policies\", \"disk\");\nexport const PROVIDERS_DISK = new StateDefinition(\"providers\", \"disk\");\nexport const ORGANIZATION_MANAGEMENT_PREFERENCES_DISK = new StateDefinition(\n  \"organizationManagementPreferences\",\n  \"disk\",\n  {\n    web: \"disk-local\",\n  },\n);\n\n// Billing\nexport const BILLING_DISK = new StateDefinition(\"billing\", \"disk\");\n\n// Auth\n\nexport const ACCOUNT_DISK = new StateDefinition(\"account\", \"disk\");\nexport const ACCOUNT_MEMORY = new StateDefinition(\"account\", \"memory\");\nexport const AUTH_REQUEST_DISK_LOCAL = new StateDefinition(\"authRequestLocal\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const AVATAR_DISK = new StateDefinition(\"avatar\", \"disk\", { web: \"disk-local\" });\nexport const DEVICE_TRUST_DISK_LOCAL = new StateDefinition(\"deviceTrust\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const KDF_CONFIG_DISK = new StateDefinition(\"kdfConfig\", \"disk\");\nexport const KEY_CONNECTOR_DISK = new StateDefinition(\"keyConnector\", \"disk\");\nexport const LOGIN_EMAIL_DISK = new StateDefinition(\"loginEmail\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const LOGIN_STRATEGY_MEMORY = new StateDefinition(\"loginStrategy\", \"memory\");\nexport const MASTER_PASSWORD_DISK = new StateDefinition(\"masterPassword\", \"disk\");\nexport const MASTER_PASSWORD_MEMORY = new StateDefinition(\"masterPassword\", \"memory\");\nexport const PIN_DISK = new StateDefinition(\"pinUnlock\", \"disk\");\nexport const PIN_MEMORY = new StateDefinition(\"pinUnlock\", \"memory\");\nexport const ROUTER_DISK = new StateDefinition(\"router\", \"disk\");\nexport const SSO_DISK = new StateDefinition(\"ssoLogin\", \"disk\");\nexport const TOKEN_DISK = new StateDefinition(\"token\", \"disk\");\nexport const TOKEN_DISK_LOCAL = new StateDefinition(\"tokenDiskLocal\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const TOKEN_MEMORY = new StateDefinition(\"token\", \"memory\");\nexport const TWO_FACTOR_MEMORY = new StateDefinition(\"twoFactor\", \"memory\");\nexport const USER_DECRYPTION_OPTIONS_DISK = new StateDefinition(\"userDecryptionOptions\", \"disk\");\nexport const ORGANIZATION_INVITE_DISK = new StateDefinition(\"organizationInvite\", \"disk\");\nexport const VAULT_TIMEOUT_SETTINGS_DISK_LOCAL = new StateDefinition(\n  \"vaultTimeoutSettings\",\n  \"disk\",\n  {\n    web: \"disk-local\",\n  },\n);\n\n// Autofill\n\nexport const BADGE_SETTINGS_DISK = new StateDefinition(\"badgeSettings\", \"disk\");\nexport const USER_NOTIFICATION_SETTINGS_DISK = new StateDefinition(\n  \"userNotificationSettings\",\n  \"disk\",\n);\n\nexport const DOMAIN_SETTINGS_DISK = new StateDefinition(\"domainSettings\", \"disk\");\nexport const AUTOFILL_SETTINGS_DISK = new StateDefinition(\"autofillSettings\", \"disk\");\nexport const AUTOFILL_SETTINGS_DISK_LOCAL = new StateDefinition(\"autofillSettingsLocal\", \"disk\", {\n  web: \"disk-local\",\n});\n\n// Components\n\nexport const NEW_WEB_LAYOUT_BANNER_DISK = new StateDefinition(\"newWebLayoutBanner\", \"disk\", {\n  web: \"disk-local\",\n});\n\nexport const UNASSIGNED_ITEMS_BANNER_DISK = new StateDefinition(\"unassignedItemsBanner\", \"disk\", {\n  web: \"disk-local\",\n});\n\n// Platform\n\nexport const APPLICATION_ID_DISK = new StateDefinition(\"applicationId\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const BIOMETRIC_SETTINGS_DISK = new StateDefinition(\"biometricSettings\", \"disk\");\nexport const CLEAR_EVENT_DISK = new StateDefinition(\"clearEvent\", \"disk\");\nexport const CONFIG_DISK = new StateDefinition(\"config\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const CRYPTO_DISK = new StateDefinition(\"crypto\", \"disk\");\nexport const CRYPTO_MEMORY = new StateDefinition(\"crypto\", \"memory\");\nexport const DESKTOP_SETTINGS_DISK = new StateDefinition(\"desktopSettings\", \"disk\");\nexport const ENVIRONMENT_DISK = new StateDefinition(\"environment\", \"disk\");\nexport const ENVIRONMENT_MEMORY = new StateDefinition(\"environment\", \"memory\");\nexport const THEMING_DISK = new StateDefinition(\"theming\", \"disk\", { web: \"disk-local\" });\nexport const TRANSLATION_DISK = new StateDefinition(\"translation\", \"disk\");\n\n// Secrets Manager\n\nexport const SM_ONBOARDING_DISK = new StateDefinition(\"smOnboarding\", \"disk\", {\n  web: \"disk-local\",\n});\n\n// Tools\n\nexport const GENERATOR_DISK = new StateDefinition(\"generator\", \"disk\");\nexport const GENERATOR_MEMORY = new StateDefinition(\"generator\", \"memory\");\nexport const BROWSER_SEND_MEMORY = new StateDefinition(\"sendBrowser\", \"memory\");\nexport const EVENT_COLLECTION_DISK = new StateDefinition(\"eventCollection\", \"disk\");\nexport const SEND_DISK = new StateDefinition(\"encryptedSend\", \"disk\", {\n  web: \"memory\",\n});\nexport const SEND_MEMORY = new StateDefinition(\"decryptedSend\", \"memory\", {\n  browser: \"memory-large-object\",\n});\n\n// Vault\n\nexport const COLLECTION_DATA = new StateDefinition(\"collection\", \"disk\", {\n  web: \"memory\",\n});\nexport const FOLDER_DISK = new StateDefinition(\"folder\", \"disk\", { web: \"memory\" });\nexport const VAULT_FILTER_DISK = new StateDefinition(\"vaultFilter\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const VAULT_ONBOARDING = new StateDefinition(\"vaultOnboarding\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const VAULT_SETTINGS_DISK = new StateDefinition(\"vaultSettings\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const VAULT_BROWSER_MEMORY = new StateDefinition(\"vaultBrowser\", \"memory\", {\n  browser: \"memory-large-object\",\n});\nexport const VAULT_SEARCH_MEMORY = new StateDefinition(\"vaultSearch\", \"memory\", {\n  browser: \"memory-large-object\",\n});\nexport const CIPHERS_DISK = new StateDefinition(\"ciphers\", \"disk\", { web: \"memory\" });\nexport const CIPHERS_DISK_LOCAL = new StateDefinition(\"ciphersLocal\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const CIPHERS_MEMORY = new StateDefinition(\"ciphersMemory\", \"memory\", {\n  browser: \"memory-large-object\",\n});\nexport const PREMIUM_BANNER_DISK_LOCAL = new StateDefinition(\"premiumBannerReprompt\", \"disk\", {\n  web: \"disk-local\",\n});\nexport const BANNERS_DISMISSED_DISK = new StateDefinition(\"bannersDismissed\", \"disk\");\n","import { PossibleLocation, StorageServiceProvider } from \"../services/storage-service.provider\";\n\nimport { GlobalState } from \"./global-state\";\nimport { GlobalStateProvider } from \"./global-state.provider\";\nimport { KeyDefinition } from \"./key-definition\";\nimport { CLEAR_EVENT_DISK } from \"./state-definitions\";\nimport { ClearEvent, UserKeyDefinition } from \"./user-key-definition\";\n\nexport type StateEventInfo = {\n  state: string;\n  key: string;\n  location: PossibleLocation;\n};\n\nexport const STATE_LOCK_EVENT = KeyDefinition.array<StateEventInfo>(CLEAR_EVENT_DISK, \"lock\", {\n  deserializer: (e) => e,\n});\n\nexport const STATE_LOGOUT_EVENT = KeyDefinition.array<StateEventInfo>(CLEAR_EVENT_DISK, \"logout\", {\n  deserializer: (e) => e,\n});\n\nexport class StateEventRegistrarService {\n  private readonly stateEventStateMap: { [Prop in ClearEvent]: GlobalState<StateEventInfo[]> };\n\n  constructor(\n    globalStateProvider: GlobalStateProvider,\n    private storageServiceProvider: StorageServiceProvider,\n  ) {\n    this.stateEventStateMap = {\n      lock: globalStateProvider.get(STATE_LOCK_EVENT),\n      logout: globalStateProvider.get(STATE_LOGOUT_EVENT),\n    };\n  }\n\n  async registerEvents(keyDefinition: UserKeyDefinition<unknown>) {\n    for (const clearEvent of keyDefinition.clearOn) {\n      const eventState = this.stateEventStateMap[clearEvent];\n      // Determine the storage location for this\n      const [storageLocation] = this.storageServiceProvider.get(\n        keyDefinition.stateDefinition.defaultStorageLocation,\n        keyDefinition.stateDefinition.storageLocationOverrides,\n      );\n\n      const newEvent: StateEventInfo = {\n        state: keyDefinition.stateDefinition.name,\n        key: keyDefinition.key,\n        location: storageLocation,\n      };\n\n      // Only update the event state if the existing list doesn't have a matching entry\n      await eventState.update(\n        (existingTickets) => {\n          existingTickets ??= [];\n          existingTickets.push(newEvent);\n          return existingTickets;\n        },\n        {\n          shouldUpdate: (currentTickets) => {\n            return (\n              // If the current tickets are null, then it will for sure be added\n              currentTickets == null ||\n              // If an existing match couldn't be found, we also need to add one\n              currentTickets.findIndex(\n                (e) =>\n                  e.state === newEvent.state &&\n                  e.key === newEvent.key &&\n                  e.location === newEvent.location,\n              ) === -1\n            );\n          },\n        },\n      );\n    }\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { StorageServiceProvider } from \"../services/storage-service.provider\";\n\nimport { GlobalState } from \"./global-state\";\nimport { GlobalStateProvider } from \"./global-state.provider\";\nimport { StateDefinition, StorageLocation } from \"./state-definition\";\nimport {\n  STATE_LOCK_EVENT,\n  STATE_LOGOUT_EVENT,\n  StateEventInfo,\n} from \"./state-event-registrar.service\";\nimport { ClearEvent, UserKeyDefinition } from \"./user-key-definition\";\n\nexport class StateEventRunnerService {\n  private readonly stateEventMap: { [Prop in ClearEvent]: GlobalState<StateEventInfo[]> };\n\n  constructor(\n    globalStateProvider: GlobalStateProvider,\n    private storageServiceProvider: StorageServiceProvider,\n  ) {\n    this.stateEventMap = {\n      lock: globalStateProvider.get(STATE_LOCK_EVENT),\n      logout: globalStateProvider.get(STATE_LOGOUT_EVENT),\n    };\n  }\n\n  async handleEvent(event: ClearEvent, userId: UserId) {\n    let tickets = await firstValueFrom(this.stateEventMap[event].state$);\n    tickets ??= [];\n\n    const failures: string[] = [];\n\n    for (const ticket of tickets) {\n      try {\n        const [, service] = this.storageServiceProvider.get(\n          ticket.location,\n          {}, // The storage location is already the computed storage location for this client\n        );\n\n        const ticketStorageKey = this.storageKeyFor(userId, ticket);\n\n        // Evaluate current value so we can avoid writing to state if we don't need to\n        const currentValue = await service.get(ticketStorageKey);\n        if (currentValue != null) {\n          await service.remove(ticketStorageKey);\n        }\n      } catch (err: unknown) {\n        let errorMessage = \"Unknown Error\";\n        if (typeof err === \"object\" && \"message\" in err && typeof err.message === \"string\") {\n          errorMessage = err.message;\n        }\n\n        failures.push(\n          `${errorMessage} in ${ticket.state} > ${ticket.key} located ${ticket.location}`,\n        );\n      }\n    }\n\n    if (failures.length > 0) {\n      // Throw aggregated error\n      throw new Error(\n        `One or more errors occurred while handling event '${event}' for user ${userId}.\\n${failures.join(\"\\n\")}`,\n      );\n    }\n  }\n\n  private storageKeyFor(userId: UserId, ticket: StateEventInfo) {\n    const userKey = new UserKeyDefinition<unknown>(\n      new StateDefinition(ticket.state, ticket.location as unknown as StorageLocation),\n      ticket.key,\n      {\n        deserializer: (v) => v,\n        clearOn: [],\n      },\n    );\n    return userKey.buildKey(userId);\n  }\n}\n","import { firstValueFrom, map } from \"rxjs\";\n\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { MasterPasswordServiceAbstraction } from \"@bitwarden/common/auth/abstractions/master-password.service.abstraction\";\nimport { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { EncString, EncryptedString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport {\n  PIN_DISK,\n  PIN_MEMORY,\n  StateProvider,\n  UserKeyDefinition,\n} from \"@bitwarden/common/platform/state\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { MasterKey, PinKey, UserKey } from \"@bitwarden/common/types/key\";\n\nimport { PinServiceAbstraction } from \"../../abstractions/pin.service.abstraction\";\n\n/**\n * - DISABLED   : No PIN set.\n * - PERSISTENT : PIN is set and persists through client reset.\n * - EPHEMERAL  : PIN is set, but does NOT persist through client reset. This means that\n *                after client reset the master password is required to unlock.\n */\nexport type PinLockType = \"DISABLED\" | \"PERSISTENT\" | \"EPHEMERAL\";\n\n/**\n * The persistent (stored on disk) version of the UserKey, encrypted by the PinKey.\n *\n * @remarks Persists through a client reset. Used when `requireMasterPasswordOnClientRestart` is disabled.\n * @see SetPinComponent.setPinForm.requireMasterPasswordOnClientRestart\n */\nexport const PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT = new UserKeyDefinition<EncryptedString>(\n  PIN_DISK,\n  \"pinKeyEncryptedUserKeyPersistent\",\n  {\n    deserializer: (jsonValue) => jsonValue,\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * The ephemeral (stored in memory) version of the UserKey, encrypted by the PinKey.\n *\n * @remarks Does NOT persist through a client reset. Used when `requireMasterPasswordOnClientRestart` is enabled.\n * @see SetPinComponent.setPinForm.requireMasterPasswordOnClientRestart\n */\nexport const PIN_KEY_ENCRYPTED_USER_KEY_EPHEMERAL = new UserKeyDefinition<EncryptedString>(\n  PIN_MEMORY,\n  \"pinKeyEncryptedUserKeyEphemeral\",\n  {\n    deserializer: (jsonValue) => jsonValue,\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * The PIN, encrypted by the UserKey.\n */\nexport const USER_KEY_ENCRYPTED_PIN = new UserKeyDefinition<EncryptedString>(\n  PIN_DISK,\n  \"userKeyEncryptedPin\",\n  {\n    deserializer: (jsonValue) => jsonValue,\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * The old MasterKey, encrypted by the PinKey (formerly called `pinProtected`).\n * Deprecated and used for migration purposes only.\n */\nexport const OLD_PIN_KEY_ENCRYPTED_MASTER_KEY = new UserKeyDefinition<EncryptedString>(\n  PIN_DISK,\n  \"oldPinKeyEncryptedMasterKey\",\n  {\n    deserializer: (jsonValue) => jsonValue,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport class PinService implements PinServiceAbstraction {\n  constructor(\n    private accountService: AccountService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private encryptService: EncryptService,\n    private kdfConfigService: KdfConfigService,\n    private keyGenerationService: KeyGenerationService,\n    private logService: LogService,\n    private masterPasswordService: MasterPasswordServiceAbstraction,\n    private stateProvider: StateProvider,\n    private stateService: StateService,\n  ) {}\n\n  async getPinKeyEncryptedUserKeyPersistent(userId: UserId): Promise<EncString> {\n    this.validateUserId(userId, \"Cannot get pinKeyEncryptedUserKeyPersistent.\");\n\n    return EncString.fromJSON(\n      await firstValueFrom(\n        this.stateProvider.getUserState$(PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT, userId),\n      ),\n    );\n  }\n\n  /**\n   * Sets the persistent (stored on disk) version of the UserKey, encrypted by the PinKey.\n   */\n  private async setPinKeyEncryptedUserKeyPersistent(\n    pinKeyEncryptedUserKey: EncString,\n    userId: UserId,\n  ): Promise<void> {\n    this.validateUserId(userId, \"Cannot set pinKeyEncryptedUserKeyPersistent.\");\n\n    if (pinKeyEncryptedUserKey == null) {\n      throw new Error(\n        \"No pinKeyEncryptedUserKey provided. Cannot set pinKeyEncryptedUserKeyPersistent.\",\n      );\n    }\n\n    await this.stateProvider.setUserState(\n      PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT,\n      pinKeyEncryptedUserKey?.encryptedString,\n      userId,\n    );\n  }\n\n  async clearPinKeyEncryptedUserKeyPersistent(userId: UserId): Promise<void> {\n    this.validateUserId(userId, \"Cannot clear pinKeyEncryptedUserKeyPersistent.\");\n\n    await this.stateProvider.setUserState(PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT, null, userId);\n  }\n\n  async getPinKeyEncryptedUserKeyEphemeral(userId: UserId): Promise<EncString> {\n    this.validateUserId(userId, \"Cannot get pinKeyEncryptedUserKeyEphemeral.\");\n\n    return EncString.fromJSON(\n      await firstValueFrom(\n        this.stateProvider.getUserState$(PIN_KEY_ENCRYPTED_USER_KEY_EPHEMERAL, userId),\n      ),\n    );\n  }\n\n  /**\n   * Sets the ephemeral (stored in memory) version of the UserKey, encrypted by the PinKey.\n   */\n  private async setPinKeyEncryptedUserKeyEphemeral(\n    pinKeyEncryptedUserKey: EncString,\n    userId: UserId,\n  ): Promise<void> {\n    this.validateUserId(userId, \"Cannot set pinKeyEncryptedUserKeyEphemeral.\");\n\n    if (pinKeyEncryptedUserKey == null) {\n      throw new Error(\n        \"No pinKeyEncryptedUserKey provided. Cannot set pinKeyEncryptedUserKeyEphemeral.\",\n      );\n    }\n\n    await this.stateProvider.setUserState(\n      PIN_KEY_ENCRYPTED_USER_KEY_EPHEMERAL,\n      pinKeyEncryptedUserKey?.encryptedString,\n      userId,\n    );\n  }\n\n  async clearPinKeyEncryptedUserKeyEphemeral(userId: UserId): Promise<void> {\n    this.validateUserId(userId, \"Cannot clear pinKeyEncryptedUserKeyEphemeral.\");\n\n    await this.stateProvider.setUserState(PIN_KEY_ENCRYPTED_USER_KEY_EPHEMERAL, null, userId);\n  }\n\n  async createPinKeyEncryptedUserKey(\n    pin: string,\n    userKey: UserKey,\n    userId: UserId,\n  ): Promise<EncString> {\n    this.validateUserId(userId, \"Cannot create pinKeyEncryptedUserKey.\");\n\n    if (!userKey) {\n      throw new Error(\"No UserKey provided. Cannot create pinKeyEncryptedUserKey.\");\n    }\n\n    const email = await firstValueFrom(\n      this.accountService.accounts$.pipe(map((accounts) => accounts[userId].email)),\n    );\n    const kdfConfig = await this.kdfConfigService.getKdfConfig();\n\n    const pinKey = await this.makePinKey(pin, email, kdfConfig);\n\n    return await this.encryptService.encrypt(userKey.key, pinKey);\n  }\n\n  async storePinKeyEncryptedUserKey(\n    pinKeyEncryptedUserKey: EncString,\n    storeAsEphemeral: boolean,\n    userId: UserId,\n  ): Promise<void> {\n    this.validateUserId(userId, \"Cannot store pinKeyEncryptedUserKey.\");\n\n    if (storeAsEphemeral) {\n      await this.setPinKeyEncryptedUserKeyEphemeral(pinKeyEncryptedUserKey, userId);\n    } else {\n      await this.setPinKeyEncryptedUserKeyPersistent(pinKeyEncryptedUserKey, userId);\n    }\n  }\n\n  async getUserKeyEncryptedPin(userId: UserId): Promise<EncString> {\n    this.validateUserId(userId, \"Cannot get userKeyEncryptedPin.\");\n\n    return EncString.fromJSON(\n      await firstValueFrom(this.stateProvider.getUserState$(USER_KEY_ENCRYPTED_PIN, userId)),\n    );\n  }\n\n  async setUserKeyEncryptedPin(userKeyEncryptedPin: EncString, userId: UserId): Promise<void> {\n    this.validateUserId(userId, \"Cannot set userKeyEncryptedPin.\");\n\n    await this.stateProvider.setUserState(\n      USER_KEY_ENCRYPTED_PIN,\n      userKeyEncryptedPin?.encryptedString,\n      userId,\n    );\n  }\n\n  async clearUserKeyEncryptedPin(userId: UserId): Promise<void> {\n    this.validateUserId(userId, \"Cannot clear userKeyEncryptedPin.\");\n\n    await this.stateProvider.setUserState(USER_KEY_ENCRYPTED_PIN, null, userId);\n  }\n\n  async createUserKeyEncryptedPin(pin: string, userKey: UserKey): Promise<EncString> {\n    if (!userKey) {\n      throw new Error(\"No UserKey provided. Cannot create userKeyEncryptedPin.\");\n    }\n\n    return await this.encryptService.encrypt(pin, userKey);\n  }\n\n  async getOldPinKeyEncryptedMasterKey(userId: UserId): Promise<EncryptedString> {\n    this.validateUserId(userId, \"Cannot get oldPinKeyEncryptedMasterKey.\");\n\n    return await firstValueFrom(\n      this.stateProvider.getUserState$(OLD_PIN_KEY_ENCRYPTED_MASTER_KEY, userId),\n    );\n  }\n\n  async clearOldPinKeyEncryptedMasterKey(userId: UserId): Promise<void> {\n    this.validateUserId(userId, \"Cannot clear oldPinKeyEncryptedMasterKey.\");\n\n    await this.stateProvider.setUserState(OLD_PIN_KEY_ENCRYPTED_MASTER_KEY, null, userId);\n  }\n\n  async makePinKey(pin: string, salt: string, kdfConfig: KdfConfig): Promise<PinKey> {\n    const pinKey = await this.keyGenerationService.deriveKeyFromPassword(pin, salt, kdfConfig);\n    return (await this.keyGenerationService.stretchKey(pinKey)) as PinKey;\n  }\n\n  async getPinLockType(userId: UserId): Promise<PinLockType> {\n    this.validateUserId(userId, \"Cannot get PinLockType.\");\n\n    /**\n     * We can't check the `userKeyEncryptedPin` (formerly called `protectedPin`) for both because old\n     * accounts only used it for MP on Restart\n     */\n    const aUserKeyEncryptedPinIsSet = !!(await this.getUserKeyEncryptedPin(userId));\n    const aPinKeyEncryptedUserKeyPersistentIsSet =\n      !!(await this.getPinKeyEncryptedUserKeyPersistent(userId));\n    const anOldPinKeyEncryptedMasterKeyIsSet =\n      !!(await this.getOldPinKeyEncryptedMasterKey(userId));\n\n    if (aPinKeyEncryptedUserKeyPersistentIsSet || anOldPinKeyEncryptedMasterKeyIsSet) {\n      return \"PERSISTENT\";\n    } else if (\n      aUserKeyEncryptedPinIsSet &&\n      !aPinKeyEncryptedUserKeyPersistentIsSet &&\n      !anOldPinKeyEncryptedMasterKeyIsSet\n    ) {\n      return \"EPHEMERAL\";\n    } else {\n      return \"DISABLED\";\n    }\n  }\n\n  async isPinSet(userId: UserId): Promise<boolean> {\n    this.validateUserId(userId, \"Cannot determine if PIN is set.\");\n\n    return (await this.getPinLockType(userId)) !== \"DISABLED\";\n  }\n\n  async decryptUserKeyWithPin(pin: string, userId: UserId): Promise<UserKey | null> {\n    this.validateUserId(userId, \"Cannot decrypt user key with PIN.\");\n\n    try {\n      const pinLockType = await this.getPinLockType(userId);\n      const requireMasterPasswordOnClientRestart = pinLockType === \"EPHEMERAL\";\n\n      const { pinKeyEncryptedUserKey, oldPinKeyEncryptedMasterKey } =\n        await this.getPinKeyEncryptedKeys(pinLockType, userId);\n\n      const email = await firstValueFrom(\n        this.accountService.accounts$.pipe(map((accounts) => accounts[userId].email)),\n      );\n      const kdfConfig = await this.kdfConfigService.getKdfConfig();\n\n      let userKey: UserKey;\n\n      if (oldPinKeyEncryptedMasterKey) {\n        userKey = await this.decryptAndMigrateOldPinKeyEncryptedMasterKey(\n          userId,\n          pin,\n          email,\n          kdfConfig,\n          requireMasterPasswordOnClientRestart,\n          oldPinKeyEncryptedMasterKey,\n        );\n      } else {\n        userKey = await this.decryptUserKey(userId, pin, email, kdfConfig, pinKeyEncryptedUserKey);\n      }\n\n      if (!userKey) {\n        this.logService.warning(`User key null after pin key decryption.`);\n        return null;\n      }\n\n      if (!(await this.validatePin(userKey, pin, userId))) {\n        this.logService.warning(`Pin key decryption successful but pin validation failed.`);\n        return null;\n      }\n\n      return userKey;\n    } catch (error) {\n      this.logService.error(`Error decrypting user key with pin: ${error}`);\n      return null;\n    }\n  }\n\n  /**\n   * Decrypts the UserKey with the provided PIN.\n   */\n  private async decryptUserKey(\n    userId: UserId,\n    pin: string,\n    salt: string,\n    kdfConfig: KdfConfig,\n    pinKeyEncryptedUserKey?: EncString,\n  ): Promise<UserKey> {\n    this.validateUserId(userId, \"Cannot decrypt user key.\");\n\n    pinKeyEncryptedUserKey ||= await this.getPinKeyEncryptedUserKeyPersistent(userId);\n    pinKeyEncryptedUserKey ||= await this.getPinKeyEncryptedUserKeyEphemeral(userId);\n\n    if (!pinKeyEncryptedUserKey) {\n      throw new Error(\"No pinKeyEncryptedUserKey found.\");\n    }\n\n    const pinKey = await this.makePinKey(pin, salt, kdfConfig);\n    const userKey = await this.encryptService.decryptToBytes(pinKeyEncryptedUserKey, pinKey);\n\n    return new SymmetricCryptoKey(userKey) as UserKey;\n  }\n\n  /**\n   * Creates a new `pinKeyEncryptedUserKey` and clears the `oldPinKeyEncryptedMasterKey`.\n   * @returns UserKey\n   */\n  private async decryptAndMigrateOldPinKeyEncryptedMasterKey(\n    userId: UserId,\n    pin: string,\n    email: string,\n    kdfConfig: KdfConfig,\n    requireMasterPasswordOnClientRestart: boolean,\n    oldPinKeyEncryptedMasterKey: EncString,\n  ): Promise<UserKey> {\n    this.validateUserId(userId, \"Cannot decrypt and migrate oldPinKeyEncryptedMasterKey.\");\n\n    const masterKey = await this.decryptMasterKeyWithPin(\n      userId,\n      pin,\n      email,\n      kdfConfig,\n      oldPinKeyEncryptedMasterKey,\n    );\n\n    const encUserKey = await this.stateService.getEncryptedCryptoSymmetricKey({ userId: userId });\n\n    const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(\n      masterKey,\n      encUserKey ? new EncString(encUserKey) : undefined,\n    );\n\n    const pinKeyEncryptedUserKey = await this.createPinKeyEncryptedUserKey(pin, userKey, userId);\n    await this.storePinKeyEncryptedUserKey(\n      pinKeyEncryptedUserKey,\n      requireMasterPasswordOnClientRestart,\n      userId,\n    );\n\n    const userKeyEncryptedPin = await this.createUserKeyEncryptedPin(pin, userKey);\n    await this.setUserKeyEncryptedPin(userKeyEncryptedPin, userId);\n\n    await this.clearOldPinKeyEncryptedMasterKey(userId);\n\n    // This also clears the old Biometrics key since the new Biometrics key will be created when the user key is set.\n    await this.stateService.setCryptoMasterKeyBiometric(null, { userId: userId });\n\n    return userKey;\n  }\n\n  // Only for migration purposes\n  private async decryptMasterKeyWithPin(\n    userId: UserId,\n    pin: string,\n    salt: string,\n    kdfConfig: KdfConfig,\n    oldPinKeyEncryptedMasterKey?: EncString,\n  ): Promise<MasterKey> {\n    this.validateUserId(userId, \"Cannot decrypt master key with PIN.\");\n\n    if (!oldPinKeyEncryptedMasterKey) {\n      const oldPinKeyEncryptedMasterKeyString = await this.getOldPinKeyEncryptedMasterKey(userId);\n\n      if (oldPinKeyEncryptedMasterKeyString == null) {\n        throw new Error(\"No oldPinKeyEncrytedMasterKey found.\");\n      }\n\n      oldPinKeyEncryptedMasterKey = new EncString(oldPinKeyEncryptedMasterKeyString);\n    }\n\n    const pinKey = await this.makePinKey(pin, salt, kdfConfig);\n    const masterKey = await this.encryptService.decryptToBytes(oldPinKeyEncryptedMasterKey, pinKey);\n\n    return new SymmetricCryptoKey(masterKey) as MasterKey;\n  }\n\n  /**\n   * Gets the user's `pinKeyEncryptedUserKey` (persistent or ephemeral) and `oldPinKeyEncryptedMasterKey`\n   * (if one exists) based on the user's PinLockType.\n   *\n   * @remarks The `oldPinKeyEncryptedMasterKey` (formerly `pinProtected`) is only used for migration and\n   *          will be null for all migrated accounts.\n   * @throws If PinLockType is 'DISABLED' or if userId is not provided\n   */\n  private async getPinKeyEncryptedKeys(\n    pinLockType: PinLockType,\n    userId: UserId,\n  ): Promise<{ pinKeyEncryptedUserKey: EncString; oldPinKeyEncryptedMasterKey?: EncString }> {\n    this.validateUserId(userId, \"Cannot get PinKey encrypted keys.\");\n\n    switch (pinLockType) {\n      case \"PERSISTENT\": {\n        const pinKeyEncryptedUserKey = await this.getPinKeyEncryptedUserKeyPersistent(userId);\n        const oldPinKeyEncryptedMasterKey = await this.getOldPinKeyEncryptedMasterKey(userId);\n\n        return {\n          pinKeyEncryptedUserKey,\n          oldPinKeyEncryptedMasterKey: oldPinKeyEncryptedMasterKey\n            ? new EncString(oldPinKeyEncryptedMasterKey)\n            : undefined,\n        };\n      }\n      case \"EPHEMERAL\": {\n        const pinKeyEncryptedUserKey = await this.getPinKeyEncryptedUserKeyEphemeral(userId);\n\n        return {\n          pinKeyEncryptedUserKey,\n          oldPinKeyEncryptedMasterKey: undefined, // Going forward, we only migrate non-ephemeral version\n        };\n      }\n      case \"DISABLED\":\n        throw new Error(\"Pin is disabled\");\n      default: {\n        // Compile-time check for exhaustive switch\n        const _exhaustiveCheck: never = pinLockType;\n        return _exhaustiveCheck;\n      }\n    }\n  }\n\n  private async validatePin(userKey: UserKey, pin: string, userId: UserId): Promise<boolean> {\n    this.validateUserId(userId, \"Cannot validate PIN.\");\n\n    const userKeyEncryptedPin = await this.getUserKeyEncryptedPin(userId);\n    const decryptedPin = await this.encryptService.decryptToUtf8(userKeyEncryptedPin, userKey);\n\n    const isPinValid = this.cryptoFunctionService.compareFast(decryptedPin, pin);\n    return isPinValid;\n  }\n\n  /**\n   * Throws a custom error message if user ID is not provided.\n   */\n  private validateUserId(userId: UserId, errorMessage: string = \"\") {\n    if (!userId) {\n      throw new Error(`User ID is required. ${errorMessage}`);\n    }\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport {\n  GlobalState,\n  KeyDefinition,\n  LOGIN_EMAIL_DISK,\n  StateProvider,\n} from \"../../../../../common/src/platform/state\";\nimport { LoginEmailServiceAbstraction } from \"../../abstractions/login-email.service\";\n\nconst STORED_EMAIL = new KeyDefinition<string>(LOGIN_EMAIL_DISK, \"storedEmail\", {\n  deserializer: (value: string) => value,\n});\n\nexport class LoginEmailService implements LoginEmailServiceAbstraction {\n  private email: string;\n  private rememberEmail: boolean;\n\n  private readonly storedEmailState: GlobalState<string>;\n  storedEmail$: Observable<string>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.storedEmailState = this.stateProvider.getGlobal(STORED_EMAIL);\n    this.storedEmail$ = this.storedEmailState.state$;\n  }\n\n  getEmail() {\n    return this.email;\n  }\n\n  setEmail(email: string) {\n    this.email = email;\n  }\n\n  getRememberEmail() {\n    return this.rememberEmail;\n  }\n\n  setRememberEmail(value: boolean) {\n    this.rememberEmail = value;\n  }\n\n  clearValues() {\n    this.email = null;\n    this.rememberEmail = null;\n  }\n\n  async saveEmailSettings() {\n    await this.storedEmailState.update(() => (this.rememberEmail ? this.email : null));\n    this.clearValues();\n  }\n}\n","export abstract class BaseResponse {\n  private response: any;\n\n  constructor(response: any) {\n    this.response = response;\n  }\n\n  protected getResponseProperty(\n    propertyName: string,\n    response: any = null,\n    exactName = false,\n  ): any {\n    if (propertyName == null || propertyName === \"\") {\n      throw new Error(\"propertyName must not be null/empty.\");\n    }\n    if (response == null && this.response != null) {\n      response = this.response;\n    }\n    if (response == null) {\n      return null;\n    }\n    if (!exactName && response[propertyName] === undefined) {\n      let otherCasePropertyName: string = null;\n      if (propertyName.charAt(0) === propertyName.charAt(0).toUpperCase()) {\n        otherCasePropertyName = propertyName.charAt(0).toLowerCase();\n      } else {\n        otherCasePropertyName = propertyName.charAt(0).toUpperCase();\n      }\n      if (propertyName.length > 1) {\n        otherCasePropertyName += propertyName.slice(1);\n      }\n\n      propertyName = otherCasePropertyName;\n      if (response[propertyName] === undefined) {\n        propertyName = propertyName.toLowerCase();\n      }\n      if (response[propertyName] === undefined) {\n        propertyName = propertyName.toUpperCase();\n      }\n    }\n    return response[propertyName];\n  }\n}\n","import { Utils } from \"../../platform/misc/utils\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class ErrorResponse extends BaseResponse {\n  message: string;\n  validationErrors: { [key: string]: string[] };\n  statusCode: number;\n  captchaRequired: boolean;\n  captchaSiteKey: string;\n\n  constructor(response: any, status: number, identityResponse?: boolean) {\n    super(response);\n    let errorModel = null;\n    if (response != null) {\n      const responseErrorModel = this.getResponseProperty(\"ErrorModel\");\n      if (responseErrorModel && identityResponse) {\n        errorModel = responseErrorModel;\n      } else {\n        errorModel = response;\n      }\n    }\n\n    if (status === 429) {\n      this.message = \"Rate limit exceeded. Try again later.\";\n    } else if (errorModel) {\n      this.message = this.getResponseProperty(\"Message\", errorModel);\n      this.validationErrors = this.getResponseProperty(\"ValidationErrors\", errorModel);\n      this.captchaSiteKey = this.validationErrors?.HCaptcha_SiteKey?.[0];\n      this.captchaRequired = !Utils.isNullOrWhitespace(this.captchaSiteKey);\n    }\n    this.statusCode = status;\n  }\n\n  getSingleMessage(): string {\n    if (this.validationErrors == null) {\n      return this.message;\n    }\n    for (const key in this.validationErrors) {\n      // eslint-disable-next-line\n      if (!this.validationErrors.hasOwnProperty(key)) {\n        continue;\n      }\n      if (this.validationErrors[key].length) {\n        return this.validationErrors[key][0];\n      }\n    }\n    return this.message;\n  }\n\n  getAllMessages(): string[] {\n    const messages: string[] = [];\n    if (this.validationErrors == null) {\n      return messages;\n    }\n    for (const key in this.validationErrors) {\n      // eslint-disable-next-line\n      if (!this.validationErrors.hasOwnProperty(key)) {\n        continue;\n      }\n      this.validationErrors[key].forEach((item: string) => {\n        let prefix = \"\";\n        if (key.indexOf(\"[\") > -1 && key.indexOf(\"]\") > -1) {\n          const lastSep = key.lastIndexOf(\".\");\n          prefix = key.substr(0, lastSep > -1 ? lastSep : key.length) + \": \";\n        }\n        messages.push(prefix + item);\n      });\n    }\n    return messages;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { DeviceType } from \"../../../../enums\";\nimport { PlatformUtilsService } from \"../../../../platform/abstractions/platform-utils.service\";\n\nexport class DeviceRequest {\n  type: DeviceType;\n  name: string;\n  identifier: string;\n  pushToken?: string;\n\n  constructor(appId: string, platformUtilsService: PlatformUtilsService) {\n    this.type = platformUtilsService.getDevice();\n    this.name = platformUtilsService.getDeviceString();\n    this.identifier = appId;\n    this.pushToken = null;\n  }\n\n  static fromJSON(json: Jsonify<DeviceRequest>) {\n    return Object.assign(Object.create(DeviceRequest.prototype), json);\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\n\nexport abstract class TokenRequest {\n  protected device?: DeviceRequest;\n  protected authRequest: string;\n\n  constructor(\n    protected twoFactor?: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    this.device = device != null ? device : null;\n  }\n\n  // eslint-disable-next-line\n  alterIdentityTokenHeaders(headers: Headers) {\n    // Implemented in subclass if required\n  }\n\n  setTwoFactor(twoFactor: TokenTwoFactorRequest | undefined) {\n    this.twoFactor = twoFactor;\n  }\n\n  setAuthRequestAccessCode(accessCode: string) {\n    this.authRequest = accessCode;\n  }\n\n  protected toIdentityToken(clientId: string) {\n    const obj: any = {\n      scope: \"api offline_access\",\n      client_id: clientId,\n    };\n\n    if (this.device) {\n      obj.deviceType = this.device.type;\n      obj.deviceIdentifier = this.device.identifier;\n      obj.deviceName = this.device.name;\n      // no push tokens for browser apps yet\n      // obj.devicePushToken = this.device.pushToken;\n    }\n\n    //passswordless login\n    if (this.authRequest) {\n      obj.authRequest = this.authRequest;\n    }\n\n    if (this.twoFactor) {\n      if (this.twoFactor.token && this.twoFactor.provider != null) {\n        obj.twoFactorToken = this.twoFactor.token;\n        obj.twoFactorProvider = this.twoFactor.provider;\n        obj.twoFactorRemember = this.twoFactor.remember ? \"1\" : \"0\";\n      }\n    }\n\n    return obj;\n  }\n}\n","import { ClientType } from \"../../../../enums\";\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport { CaptchaProtectedRequest } from \"../captcha-protected.request\";\n\nimport { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class PasswordTokenRequest extends TokenRequest implements CaptchaProtectedRequest {\n  constructor(\n    public email: string,\n    public masterPasswordHash: string,\n    public captchaResponse: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken(clientId: ClientType) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"password\";\n    obj.username = this.email;\n    obj.password = this.masterPasswordHash;\n\n    if (this.captchaResponse != null) {\n      obj.captchaResponse = this.captchaResponse;\n    }\n\n    return obj;\n  }\n\n  alterIdentityTokenHeaders(headers: Headers) {\n    headers.set(\"Auth-Email\", Utils.fromUtf8ToUrlB64(this.email));\n  }\n\n  static fromJSON(json: any) {\n    return Object.assign(Object.create(PasswordTokenRequest.prototype), json, {\n      device: json.device ? DeviceRequest.fromJSON(json.device) : undefined,\n      twoFactor: json.twoFactor\n        ? Object.assign(new TokenTwoFactorRequest(), json.twoFactor)\n        : undefined,\n    });\n  }\n}\n","export enum TwoFactorProviderType {\n  Authenticator = 0,\n  Email = 1,\n  Duo = 2,\n  Yubikey = 3,\n  U2f = 4,\n  Remember = 5,\n  OrganizationDuo = 6,\n  WebAuthn = 7,\n}\n","/*\n * This enum is used to determine if a user should be forced to initially set or reset their password\n * on login (server flag) or unlock via MP (client evaluation).\n */\nexport enum ForceSetPasswordReason {\n  /**\n   * A password reset should not be forced.\n   */\n  None,\n\n  /**\n   * Occurs when an organization admin forces a user to reset their password.\n   * Communicated via server flag.\n   */\n  AdminForcePasswordReset,\n\n  /**\n   * Occurs when a user logs in / unlocks their vault with a master password that does not meet an organization's\n   * master password policy that is enforced on login/unlock.\n   * Only set client side b/c server can't evaluate MP.\n   */\n  WeakMasterPassword,\n\n  /**\n   * Occurs when a TDE user without a password obtains the password reset permission.\n   * Set post login & decryption client side and by server in sync (to catch logged in users).\n   */\n  TdeUserWithoutPasswordHasPasswordResetPermission,\n}\n","export enum ClientType {\n  Web = \"web\",\n  Browser = \"browser\",\n  Desktop = \"desktop\",\n  // Mobile = \"mobile\",\n  Cli = \"cli\",\n  // DirectoryConnector = \"connector\",\n}\n","export enum DeviceType {\n  Android = 0,\n  iOS = 1,\n  ChromeExtension = 2,\n  FirefoxExtension = 3,\n  OperaExtension = 4,\n  EdgeExtension = 5,\n  WindowsDesktop = 6,\n  MacOsDesktop = 7,\n  LinuxDesktop = 8,\n  ChromeBrowser = 9,\n  FirefoxBrowser = 10,\n  OperaBrowser = 11,\n  EdgeBrowser = 12,\n  IEBrowser = 13,\n  UnknownBrowser = 14,\n  AndroidAmazon = 15,\n  UWP = 16,\n  SafariBrowser = 17,\n  VivaldiBrowser = 18,\n  VivaldiExtension = 19,\n  SafariExtension = 20,\n  SDK = 21,\n  Server = 22,\n  WindowsCLI = 23,\n  MacOsCLI = 24,\n  LinuxCLI = 25,\n}\n\nexport const MobileDeviceTypes: Set<DeviceType> = new Set([\n  DeviceType.Android,\n  DeviceType.iOS,\n  DeviceType.AndroidAmazon,\n]);\n\nexport const DesktopDeviceTypes: Set<DeviceType> = new Set([\n  DeviceType.WindowsDesktop,\n  DeviceType.MacOsDesktop,\n  DeviceType.LinuxDesktop,\n  DeviceType.UWP,\n  DeviceType.WindowsCLI,\n  DeviceType.MacOsCLI,\n  DeviceType.LinuxCLI,\n]);\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class MasterPasswordPolicyResponse extends BaseResponse {\n  minComplexity: number;\n  minLength: number;\n  requireUpper: boolean;\n  requireLower: boolean;\n  requireNumbers: boolean;\n  requireSpecial: boolean;\n\n  /**\n   * Flag to indicate if the policy should be enforced on login.\n   * If true, and the user's password does not meet the policy requirements,\n   * the user will be forced to update their password.\n   */\n  enforceOnLogin: boolean;\n\n  constructor(response: any) {\n    super(response);\n\n    this.minComplexity = this.getResponseProperty(\"MinComplexity\");\n    this.minLength = this.getResponseProperty(\"MinLength\");\n    this.requireUpper = this.getResponseProperty(\"RequireUpper\");\n    this.requireLower = this.getResponseProperty(\"RequireLower\");\n    this.requireNumbers = this.getResponseProperty(\"RequireNumbers\");\n    this.requireSpecial = this.getResponseProperty(\"RequireSpecial\");\n    this.enforceOnLogin = this.getResponseProperty(\"EnforceOnLogin\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport interface IKeyConnectorUserDecryptionOptionServerResponse {\n  KeyConnectorUrl: string;\n}\n\nexport class KeyConnectorUserDecryptionOptionResponse extends BaseResponse {\n  keyConnectorUrl: string;\n\n  constructor(response: IKeyConnectorUserDecryptionOptionServerResponse) {\n    super(response);\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\n\nexport interface ITrustedDeviceUserDecryptionOptionServerResponse {\n  HasAdminApproval: boolean;\n  HasLoginApprovingDevice: boolean;\n  HasManageResetPasswordPermission: boolean;\n  EncryptedPrivateKey?: string;\n  EncryptedUserKey?: string;\n}\n\nexport class TrustedDeviceUserDecryptionOptionResponse extends BaseResponse {\n  hasAdminApproval: boolean;\n  hasLoginApprovingDevice: boolean;\n  hasManageResetPasswordPermission: boolean;\n  encryptedPrivateKey: EncString;\n  encryptedUserKey: EncString;\n\n  constructor(response: any) {\n    super(response);\n    this.hasAdminApproval = this.getResponseProperty(\"HasAdminApproval\");\n\n    this.hasLoginApprovingDevice = this.getResponseProperty(\"HasLoginApprovingDevice\");\n    this.hasManageResetPasswordPermission = this.getResponseProperty(\n      \"HasManageResetPasswordPermission\",\n    );\n\n    if (response.EncryptedPrivateKey) {\n      this.encryptedPrivateKey = new EncString(this.getResponseProperty(\"EncryptedPrivateKey\"));\n    }\n    if (response.EncryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"EncryptedUserKey\"));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\n\nexport interface IWebAuthnPrfDecryptionOptionServerResponse {\n  EncryptedPrivateKey: string;\n  EncryptedUserKey: string;\n}\n\nexport class WebAuthnPrfDecryptionOptionResponse extends BaseResponse {\n  encryptedPrivateKey: EncString;\n  encryptedUserKey: EncString;\n\n  constructor(response: IWebAuthnPrfDecryptionOptionServerResponse) {\n    super(response);\n    if (response.EncryptedPrivateKey) {\n      this.encryptedPrivateKey = new EncString(this.getResponseProperty(\"EncryptedPrivateKey\"));\n    }\n    if (response.EncryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"EncryptedUserKey\"));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nimport {\n  IKeyConnectorUserDecryptionOptionServerResponse,\n  KeyConnectorUserDecryptionOptionResponse,\n} from \"./key-connector-user-decryption-option.response\";\nimport {\n  ITrustedDeviceUserDecryptionOptionServerResponse,\n  TrustedDeviceUserDecryptionOptionResponse,\n} from \"./trusted-device-user-decryption-option.response\";\nimport {\n  IWebAuthnPrfDecryptionOptionServerResponse,\n  WebAuthnPrfDecryptionOptionResponse,\n} from \"./webauthn-prf-decryption-option.response\";\n\nexport interface IUserDecryptionOptionsServerResponse {\n  HasMasterPassword: boolean;\n  TrustedDeviceOption?: ITrustedDeviceUserDecryptionOptionServerResponse;\n  KeyConnectorOption?: IKeyConnectorUserDecryptionOptionServerResponse;\n  WebAuthnPrfOption?: IWebAuthnPrfDecryptionOptionServerResponse;\n}\n\nexport class UserDecryptionOptionsResponse extends BaseResponse {\n  hasMasterPassword: boolean;\n  trustedDeviceOption?: TrustedDeviceUserDecryptionOptionResponse;\n  keyConnectorOption?: KeyConnectorUserDecryptionOptionResponse;\n  webAuthnPrfOption?: WebAuthnPrfDecryptionOptionResponse;\n\n  constructor(response: IUserDecryptionOptionsServerResponse) {\n    super(response);\n\n    this.hasMasterPassword = this.getResponseProperty(\"HasMasterPassword\");\n\n    if (response.TrustedDeviceOption) {\n      this.trustedDeviceOption = new TrustedDeviceUserDecryptionOptionResponse(\n        this.getResponseProperty(\"TrustedDeviceOption\"),\n      );\n    }\n    if (response.KeyConnectorOption) {\n      this.keyConnectorOption = new KeyConnectorUserDecryptionOptionResponse(\n        this.getResponseProperty(\"KeyConnectorOption\"),\n      );\n    }\n    if (response.WebAuthnPrfOption) {\n      this.webAuthnPrfOption = new WebAuthnPrfDecryptionOptionResponse(\n        this.getResponseProperty(\"WebAuthnPrfOption\"),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { KdfType } from \"../../../platform/enums\";\n\nimport { MasterPasswordPolicyResponse } from \"./master-password-policy.response\";\nimport { UserDecryptionOptionsResponse } from \"./user-decryption-options/user-decryption-options.response\";\n\nexport class IdentityTokenResponse extends BaseResponse {\n  accessToken: string;\n  expiresIn: number;\n  refreshToken: string;\n  tokenType: string;\n\n  resetMasterPassword: boolean;\n  privateKey: string;\n  key: string;\n  twoFactorToken: string;\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  forcePasswordReset: boolean;\n  masterPasswordPolicy: MasterPasswordPolicyResponse;\n  apiUseKeyConnector: boolean;\n  keyConnectorUrl: string;\n\n  userDecryptionOptions: UserDecryptionOptionsResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.accessToken = response.access_token;\n    this.expiresIn = response.expires_in;\n    this.refreshToken = response.refresh_token;\n    this.tokenType = response.token_type;\n\n    this.resetMasterPassword = this.getResponseProperty(\"ResetMasterPassword\");\n    this.privateKey = this.getResponseProperty(\"PrivateKey\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.twoFactorToken = this.getResponseProperty(\"TwoFactorToken\");\n    this.kdf = this.getResponseProperty(\"Kdf\");\n    this.kdfIterations = this.getResponseProperty(\"KdfIterations\");\n    this.kdfMemory = this.getResponseProperty(\"KdfMemory\");\n    this.kdfParallelism = this.getResponseProperty(\"KdfParallelism\");\n    this.forcePasswordReset = this.getResponseProperty(\"ForcePasswordReset\");\n    this.apiUseKeyConnector = this.getResponseProperty(\"ApiUseKeyConnector\");\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n    this.masterPasswordPolicy = new MasterPasswordPolicyResponse(\n      this.getResponseProperty(\"MasterPasswordPolicy\"),\n    );\n\n    if (response.UserDecryptionOptions) {\n      this.userDecryptionOptions = new UserDecryptionOptionsResponse(\n        this.getResponseProperty(\"UserDecryptionOptions\"),\n      );\n    }\n  }\n}\n","// Note: the enum key is used to describe the EventSystemUser in the UI. Be careful about changing it.\nexport enum EventSystemUser {\n  SCIM = 1,\n  DomainVerification = 2,\n}\n","// Increment by 100 for each new set of events\nexport enum EventType {\n  User_LoggedIn = 1000,\n  User_ChangedPassword = 1001,\n  User_Updated2fa = 1002,\n  User_Disabled2fa = 1003,\n  User_Recovered2fa = 1004,\n  User_FailedLogIn = 1005,\n  User_FailedLogIn2fa = 1006,\n  User_ClientExportedVault = 1007,\n  User_UpdatedTempPassword = 1008,\n  User_MigratedKeyToKeyConnector = 1009,\n  User_RequestedDeviceApproval = 1010,\n\n  Cipher_Created = 1100,\n  Cipher_Updated = 1101,\n  Cipher_Deleted = 1102,\n  Cipher_AttachmentCreated = 1103,\n  Cipher_AttachmentDeleted = 1104,\n  Cipher_Shared = 1105,\n  Cipher_UpdatedCollections = 1106,\n  Cipher_ClientViewed = 1107,\n  Cipher_ClientToggledPasswordVisible = 1108,\n  Cipher_ClientToggledHiddenFieldVisible = 1109,\n  Cipher_ClientToggledCardCodeVisible = 1110,\n  Cipher_ClientCopiedPassword = 1111,\n  Cipher_ClientCopiedHiddenField = 1112,\n  Cipher_ClientCopiedCardCode = 1113,\n  Cipher_ClientAutofilled = 1114,\n  Cipher_SoftDeleted = 1115,\n  Cipher_Restored = 1116,\n  Cipher_ClientToggledCardNumberVisible = 1117,\n  Cipher_ClientToggledTOTPSeedVisible = 1118,\n\n  Collection_Created = 1300,\n  Collection_Updated = 1301,\n  Collection_Deleted = 1302,\n\n  Group_Created = 1400,\n  Group_Updated = 1401,\n  Group_Deleted = 1402,\n\n  OrganizationUser_Invited = 1500,\n  OrganizationUser_Confirmed = 1501,\n  OrganizationUser_Updated = 1502,\n  OrganizationUser_Removed = 1503,\n  OrganizationUser_UpdatedGroups = 1504,\n  OrganizationUser_UnlinkedSso = 1505,\n  OrganizationUser_ResetPassword_Enroll = 1506,\n  OrganizationUser_ResetPassword_Withdraw = 1507,\n  OrganizationUser_AdminResetPassword = 1508,\n  OrganizationUser_ResetSsoLink = 1509,\n  OrganizationUser_FirstSsoLogin = 1510,\n  OrganizationUser_Revoked = 1511,\n  OrganizationUser_Restored = 1512,\n  OrganizationUser_ApprovedAuthRequest = 1513,\n  OrganizationUser_RejectedAuthRequest = 1514,\n\n  Organization_Updated = 1600,\n  Organization_PurgedVault = 1601,\n  Organization_ClientExportedVault = 1602,\n  Organization_VaultAccessed = 1603,\n  Organization_EnabledSso = 1604,\n  Organization_DisabledSso = 1605,\n  Organization_EnabledKeyConnector = 1606,\n  Organization_DisabledKeyConnector = 1607,\n  Organization_SponsorshipsSynced = 1608,\n  Organization_CollectionManagementUpdated = 1609,\n\n  Policy_Updated = 1700,\n\n  ProviderUser_Invited = 1800,\n  ProviderUser_Confirmed = 1801,\n  ProviderUser_Updated = 1802,\n  ProviderUser_Removed = 1803,\n\n  ProviderOrganization_Created = 1900,\n  ProviderOrganization_Added = 1901,\n  ProviderOrganization_Removed = 1902,\n  ProviderOrganization_VaultAccessed = 1903,\n\n  OrganizationDomain_Added = 2000,\n  OrganizationDomain_Removed = 2001,\n  OrganizationDomain_Verified = 2002,\n  OrganizationDomain_NotVerified = 2003,\n\n  Secret_Retrieved = 2100,\n}\n","/**\n * Hypertext Transfer Protocol (HTTP) response status codes.\n *\n * @see {@link https://en.wikipedia.org/wiki/List_of_HTTP_status_codes}\n * src: https://gist.github.com/RWOverdijk/6cef816cfdf5722228e01cc05fd4b094\n */\nexport enum HttpStatusCode {\n  /**\n   * The server has received the request headers and the client should proceed to send the request body\n   * (in the case of a request for which a body needs to be sent; for example, a POST request).\n   * Sending a large request body to a server after a request has been rejected for inappropriate headers would be inefficient.\n   * To have a server check the request's headers, a client must send Expect: 100-continue as a header in its initial request\n   * and receive a 100 Continue status code in response before sending the body. The response 417 Expectation Failed indicates the request should not be continued.\n   */\n  Continue = 100,\n\n  /**\n   * The requester has asked the server to switch protocols and the server has agreed to do so.\n   */\n  SwitchingProtocols = 101,\n\n  /**\n   * A WebDAV request may contain many sub-requests involving file operations, requiring a long time to complete the request.\n   * This code indicates that the server has received and is processing the request, but no response is available yet.\n   * This prevents the client from timing out and assuming the request was lost.\n   */\n  Processing = 102,\n\n  // **********************************************************************************************************\n  // 200s - SUCCESS\n  // **********************************************************************************************************\n\n  /**\n   * Standard response for successful HTTP requests.\n   * The actual response will depend on the request method used.\n   * In a GET request, the response will contain an entity corresponding to the requested resource.\n   * In a POST request, the response will contain an entity describing or containing the result of the action.\n   */\n  Ok = 200,\n\n  /**\n   * The request has been fulfilled, resulting in the creation of a new resource.\n   */\n  Created = 201,\n\n  /**\n   * The request has been accepted for processing, but the processing has not been completed.\n   * The request might or might not be eventually acted upon, and may be disallowed when processing occurs.\n   */\n  Accepted = 202,\n\n  /**\n   * SINCE HTTP/1.1\n   * The server is a transforming proxy that received a 200 OK from its origin,\n   * but is returning a modified version of the origin's response.\n   */\n  NonAuthoritativeInformation = 203,\n\n  /**\n   * The server successfully processed the request and is not returning any content.\n   */\n  NoContent = 204,\n\n  /**\n   * The server successfully processed the request, but is not returning any content.\n   * Unlike a 204 response, this response requires that the requester reset the document view.\n   */\n  ResetContent = 205,\n\n  /**\n   * The server is delivering only part of the resource (byte serving) due to a range header sent by the client.\n   * The range header is used by HTTP clients to enable resuming of interrupted downloads,\n   * or split a download into multiple simultaneous streams.\n   */\n  PartialContent = 206,\n\n  /**\n   * The message body that follows is an XML message and can contain a number of separate response codes,\n   * depending on how many sub-requests were made.\n   */\n  MultiStatus = 207,\n\n  /**\n   * The members of a DAV binding have already been enumerated in a preceding part of the (multistatus) response,\n   * and are not being included again.\n   */\n  AlreadyReported = 208,\n\n  /**\n   * The server has fulfilled a request for the resource,\n   * and the response is a representation of the result of one or more instance-manipulations applied to the current instance.\n   */\n  ImUsed = 226,\n\n  // **********************************************************************************************************\n  // 300s - Redirections\n  // **********************************************************************************************************\n\n  /**\n   * Indicates multiple options for the resource from which the client may choose (via agent-driven content negotiation).\n   * For example, this code could be used to present multiple video format options,\n   * to list files with different filename extensions, or to suggest word-sense disambiguation.\n   */\n  MultipleChoices = 300,\n\n  /**\n   * This and all future requests should be directed to the given URI.\n   */\n  MovedPermanently = 301,\n\n  /**\n   * This is an example of industry practice contradicting the standard.\n   * The HTTP/1.0 specification (RFC 1945) required the client to perform a temporary redirect\n   * (the original describing phrase was \"Moved Temporarily\"), but popular browsers implemented 302\n   * with the functionality of a 303 See Other. Therefore, HTTP/1.1 added status codes 303 and 307\n   * to distinguish between the two behaviours. However, some Web applications and frameworks\n   * use the 302 status code as if it were the 303.\n   */\n  Found = 302,\n\n  /**\n   * SINCE HTTP/1.1\n   * The response to the request can be found under another URI using a GET method.\n   * When received in response to a POST (or PUT/DELETE), the client should presume that\n   * the server has received the data and should issue a redirect with a separate GET message.\n   */\n  SeeOther = 303,\n\n  /**\n   * Indicates that the resource has not been modified since the version specified by the request headers If-Modified-Since or If-None-Match.\n   * In such case, there is no need to retransmit the resource since the client still has a previously-downloaded copy.\n   */\n  NotModified = 304,\n\n  /**\n   * SINCE HTTP/1.1\n   * The requested resource is available only through a proxy, the address for which is provided in the response.\n   * Many HTTP clients (such as Mozilla and Internet Explorer) do not correctly handle responses with this status code, primarily for security reasons.\n   */\n  UseProxy = 305,\n\n  /**\n   * No longer used. Originally meant \"Subsequent requests should use the specified proxy.\"\n   */\n  SwitchProxy = 306,\n\n  /**\n   * SINCE HTTP/1.1\n   * In this case, the request should be repeated with another URI; however, future requests should still use the original URI.\n   * In contrast to how 302 was historically implemented, the request method is not allowed to be changed when reissuing the original request.\n   * For example, a POST request should be repeated using another POST request.\n   */\n  TemporaryRedirect = 307,\n\n  /**\n   * The request and all future requests should be repeated using another URI.\n   * 307 and 308 parallel the behaviors of 302 and 301, but do not allow the HTTP method to change.\n   * So, for example, submitting a form to a permanently redirected resource may continue smoothly.\n   */\n  PermanentRedirect = 308,\n\n  // **********************************************************************************************************\n  // 400s - Client / User messed up\n  // **********************************************************************************************************\n\n  /**\n   * The server cannot or will not process the request due to an apparent client error\n   * (e.g., malformed request syntax, too large size, invalid request message framing, or deceptive request routing).\n   */\n  BadRequest = 400,\n\n  /**\n   * Similar to 403 Forbidden, but specifically for use when authentication is required and has failed or has not yet\n   * been provided. The response must include a WWW-Authenticate header field containing a challenge applicable to the\n   * requested resource. See Basic access authentication and Digest access authentication. 401 semantically means\n   * \"unauthenticated\",i.e. the user does not have the necessary credentials.\n   */\n  Unauthorized = 401,\n\n  /**\n   * Reserved for future use. The original intention was that this code might be used as part of some form of digital\n   * cash or micro payment scheme, but that has not happened, and this code is not usually used.\n   * Google Developers API uses this status if a particular developer has exceeded the daily limit on requests.\n   */\n  PaymentRequired = 402,\n\n  /**\n   * The request was valid, but the server is refusing action.\n   * The user might not have the necessary permissions for a resource.\n   */\n  Forbidden = 403,\n\n  /**\n   * The requested resource could not be found but may be available in the future.\n   * Subsequent requests by the client are permissible.\n   */\n  NotFound = 404,\n\n  /**\n   * A request method is not supported for the requested resource;\n   * for example, a GET request on a form that requires data to be presented via POST, or a PUT request on a read-only resource.\n   */\n  MethodNotAllowed = 405,\n\n  /**\n   * The requested resource is capable of generating only content not acceptable according to the Accept headers sent in the request.\n   */\n  NotAcceptable = 406,\n\n  /**\n   * The client must first authenticate itself with the proxy.\n   */\n  ProxyAuthenticationRequired = 407,\n\n  /**\n   * The server timed out waiting for the request.\n   * According to HTTP specifications:\n   * \"The client did not produce a request within the time that the server was prepared to wait. The client MAY repeat the request without modifications at any later time.\"\n   */\n  RequestTimeout = 408,\n\n  /**\n   * Indicates that the request could not be processed because of conflict in the request,\n   * such as an edit conflict between multiple simultaneous updates.\n   */\n  Conflict = 409,\n\n  /**\n   * Indicates that the resource requested is no longer available and will not be available again.\n   * This should be used when a resource has been intentionally removed and the resource should be purged.\n   * Upon receiving a 410 status code, the client should not request the resource in the future.\n   * Clients such as search engines should remove the resource from their indices.\n   * Most use cases do not require clients and search engines to purge the resource, and a \"404 Not Found\" may be used instead.\n   */\n  Gone = 410,\n\n  /**\n   * The request did not specify the length of its content, which is required by the requested resource.\n   */\n  LengthRequired = 411,\n\n  /**\n   * The server does not meet one of the preconditions that the requester put on the request.\n   */\n  PreconditionFailed = 412,\n\n  /**\n   * The request is larger than the server is willing or able to process. Previously called \"Request Entity Too Large\".\n   */\n  PayloadTooLarge = 413,\n\n  /**\n   * The URI provided was too long for the server to process. Often the result of too much data being encoded as a query-string of a GET request,\n   * in which case it should be converted to a POST request.\n   * Called \"Request-URI Too Long\" previously.\n   */\n  UriTooLong = 414,\n\n  /**\n   * The request entity has a media type which the server or resource does not support.\n   * For example, the client uploads an image as image/svg+xml, but the server requires that images use a different format.\n   */\n  UnsupportedMediaType = 415,\n\n  /**\n   * The client has asked for a portion of the file (byte serving), but the server cannot supply that portion.\n   * For example, if the client asked for a part of the file that lies beyond the end of the file.\n   * Called \"Requested Range Not Satisfiable\" previously.\n   */\n  RangeNotSatisfiable = 416,\n\n  /**\n   * The server cannot meet the requirements of the Expect request-header field.\n   */\n  ExpectationFailed = 417,\n\n  /**\n   * This code was defined in 1998 as one of the traditional IETF April Fools' jokes, in RFC 2324, Hyper Text Coffee Pot Control Protocol,\n   * and is not expected to be implemented by actual HTTP servers. The RFC specifies this code should be returned by\n   * teapots requested to brew coffee. This HTTP status is used as an Easter egg in some websites, including Google.com.\n   */\n  IAmATeapot = 418,\n\n  /**\n   * The request was directed at a server that is not able to produce a response (for example because a connection reuse).\n   */\n  MisdirectedRequest = 421,\n\n  /**\n   * The request was well-formed but was unable to be followed due to semantic errors.\n   */\n  UnprocessableEntity = 422,\n\n  /**\n   * The resource that is being accessed is locked.\n   */\n  Locked = 423,\n\n  /**\n   * The request failed due to failure of a previous request (e.g., a PROPPATCH).\n   */\n  FailedDependency = 424,\n\n  /**\n   * The client should switch to a different protocol such as TLS/1.0, given in the Upgrade header field.\n   */\n  UpgradeRequired = 426,\n\n  /**\n   * The origin server requires the request to be conditional.\n   * Intended to prevent \"the 'lost update' problem, where a client\n   * GETs a resource's state, modifies it, and PUTs it back to the server,\n   * when meanwhile a third party has modified the state on the server, leading to a conflict.\"\n   */\n  PreconditionRequired = 428,\n\n  /**\n   * The user has sent too many requests in a given amount of time. Intended for use with rate-limiting schemes.\n   */\n  TooManyRequests = 429,\n\n  /**\n   * The server is unwilling to process the request because either an individual header field,\n   * or all the header fields collectively, are too large.\n   */\n  RequestHeaderFieldsTooLarge = 431,\n\n  /**\n   * A server operator has received a legal demand to deny access to a resource or to a set of resources\n   * that includes the requested resource. The code 451 was chosen as a reference to the novel Fahrenheit 451.\n   */\n  UnavailableForLegalReasons = 451,\n\n  // **********************************************************************************************************\n  // 500s - Server messed up\n  // **********************************************************************************************************\n\n  /**\n   * A generic error message, given when an unexpected condition was encountered and no more specific message is suitable.\n   */\n  InternalServerError = 500,\n\n  /**\n   * The server either does not recognize the request method, or it lacks the ability to fulfill the request.\n   * Usually this implies future availability (e.g., a new feature of a web-service API).\n   */\n  NotImplemented = 501,\n\n  /**\n   * The server was acting as a gateway or proxy and received an invalid response from the upstream server.\n   */\n  BadGateway = 502,\n\n  /**\n   * The server is currently unavailable (because it is overloaded or down for maintenance).\n   * Generally, this is a temporary state.\n   */\n  ServiceUnavailable = 503,\n\n  /**\n   * The server was acting as a gateway or proxy and did not receive a timely response from the upstream server.\n   */\n  GatewayTimeout = 504,\n\n  /**\n   * The server does not support the HTTP protocol version used in the request\n   */\n  HttpVersionNotSupported = 505,\n\n  /**\n   * Transparent content negotiation for the request results in a circular reference.\n   */\n  VariantAlsoNegotiates = 506,\n\n  /**\n   * The server is unable to store the representation needed to complete the request.\n   */\n  InsufficientStorage = 507,\n\n  /**\n   * The server detected an infinite loop while processing the request.\n   */\n  LoopDetected = 508,\n\n  /**\n   * Further extensions to the request are required for the server to fulfill it.\n   */\n  NotExtended = 510,\n\n  /**\n   * The client needs to authenticate to gain network access.\n   * Intended for use by intercepting proxies used to control access to the network (e.g., \"captive portals\" used\n   * to require agreement to Terms of Service before granting full Internet access via a Wi-Fi hotspot).\n   */\n  NetworkAuthenticationRequired = 511,\n}\n","export enum IntegrationType {\n  Integration = \"integration\",\n  SDK = \"sdk\",\n}\n","export enum NativeMessagingVersion {\n  One = 1, // Original implementation\n  Latest = One,\n}\n","export enum NotificationType {\n  SyncCipherUpdate = 0,\n  SyncCipherCreate = 1,\n  SyncLoginDelete = 2,\n  SyncFolderDelete = 3,\n  SyncCiphers = 4,\n\n  SyncVault = 5,\n  SyncOrgKeys = 6,\n  SyncFolderCreate = 7,\n  SyncFolderUpdate = 8,\n  SyncCipherDelete = 9,\n  SyncSettings = 10,\n\n  LogOut = 11,\n\n  SyncSendCreate = 12,\n  SyncSendUpdate = 13,\n  SyncSendDelete = 14,\n\n  AuthRequest = 15,\n  AuthRequestResponse = 16,\n\n  SyncOrganizations = 17,\n}\n","export enum ProductType {\n  Free = 0,\n  Families = 1,\n  Teams = 2,\n  Enterprise = 3,\n  TeamsStarter = 4,\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { GeneratorOptions } from \"../../../tools/generator/generator-options\";\nimport {\n  GeneratedPasswordHistory,\n  PasswordGeneratorOptions,\n} from \"../../../tools/generator/password\";\nimport { UsernameGeneratorOptions } from \"../../../tools/generator/username/username-generation-options\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { KdfType } from \"../../enums\";\nimport { Utils } from \"../../misc/utils\";\n\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\nexport class EncryptionPair<TEncrypted, TDecrypted> {\n  encrypted?: TEncrypted;\n  decrypted?: TDecrypted;\n\n  toJSON() {\n    return {\n      encrypted: this.encrypted,\n      decrypted:\n        this.decrypted instanceof ArrayBuffer\n          ? Utils.fromBufferToByteString(this.decrypted)\n          : this.decrypted,\n    };\n  }\n\n  static fromJSON<TEncrypted, TDecrypted>(\n    obj: { encrypted?: Jsonify<TEncrypted>; decrypted?: string | Jsonify<TDecrypted> },\n    decryptedFromJson?: (decObj: Jsonify<TDecrypted> | string) => TDecrypted,\n    encryptedFromJson?: (encObj: Jsonify<TEncrypted>) => TEncrypted,\n  ) {\n    if (obj == null) {\n      return null;\n    }\n\n    const pair = new EncryptionPair<TEncrypted, TDecrypted>();\n    if (obj?.encrypted != null) {\n      pair.encrypted = encryptedFromJson\n        ? encryptedFromJson(obj.encrypted)\n        : (obj.encrypted as TEncrypted);\n    }\n    if (obj?.decrypted != null) {\n      pair.decrypted = decryptedFromJson\n        ? decryptedFromJson(obj.decrypted)\n        : (obj.decrypted as TDecrypted);\n    }\n    return pair;\n  }\n}\n\nexport class DataEncryptionPair<TEncrypted, TDecrypted> {\n  encrypted?: Record<string, TEncrypted>;\n  decrypted?: TDecrypted[];\n}\n\nexport class AccountData {\n  passwordGenerationHistory?: EncryptionPair<\n    GeneratedPasswordHistory[],\n    GeneratedPasswordHistory[]\n  > = new EncryptionPair<GeneratedPasswordHistory[], GeneratedPasswordHistory[]>();\n\n  static fromJSON(obj: DeepJsonify<AccountData>): AccountData {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountData(), obj);\n  }\n}\n\nexport class AccountKeys {\n  publicKey?: Uint8Array;\n\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoMasterKeyAuto?: string;\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoMasterKeyBiometric?: string;\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoSymmetricKey?: EncryptionPair<string, SymmetricCryptoKey> = new EncryptionPair<\n    string,\n    SymmetricCryptoKey\n  >();\n\n  toJSON() {\n    // If you pass undefined into fromBufferToByteString, you will get an empty string back\n    // which will cause all sorts of headaches down the line when you try to getPublicKey\n    // and expect a Uint8Array and get an empty string instead.\n    return Utils.merge(this, {\n      publicKey: this.publicKey ? Utils.fromBufferToByteString(this.publicKey) : undefined,\n    });\n  }\n\n  static fromJSON(obj: DeepJsonify<AccountKeys>): AccountKeys {\n    if (obj == null) {\n      return null;\n    }\n    return Object.assign(new AccountKeys(), obj, {\n      cryptoSymmetricKey: EncryptionPair.fromJSON(\n        obj?.cryptoSymmetricKey,\n        SymmetricCryptoKey.fromJSON,\n      ),\n      publicKey: Utils.fromByteStringToArray(obj?.publicKey),\n    });\n  }\n\n  static initRecordEncryptionPairsFromJSON(obj: any) {\n    return EncryptionPair.fromJSON(obj, (decObj: any) => {\n      if (obj == null) {\n        return null;\n      }\n\n      const record: Record<string, SymmetricCryptoKey> = {};\n      for (const id in decObj) {\n        record[id] = SymmetricCryptoKey.fromJSON(decObj[id]);\n      }\n      return record;\n    });\n  }\n}\n\nexport class AccountProfile {\n  name?: string;\n  email?: string;\n  emailVerified?: boolean;\n  lastSync?: string;\n  userId?: string;\n  kdfIterations?: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  kdfType?: KdfType;\n\n  static fromJSON(obj: Jsonify<AccountProfile>): AccountProfile {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountProfile(), obj);\n  }\n}\n\nexport class AccountSettings {\n  defaultUriMatch?: UriMatchStrategySetting;\n  minimizeOnCopyToClipboard?: boolean;\n  passwordGenerationOptions?: PasswordGeneratorOptions;\n  usernameGenerationOptions?: UsernameGeneratorOptions;\n  generatorOptions?: GeneratorOptions;\n\n  static fromJSON(obj: Jsonify<AccountSettings>): AccountSettings {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountSettings(), obj);\n  }\n}\n\nexport class Account {\n  data?: AccountData = new AccountData();\n  keys?: AccountKeys = new AccountKeys();\n  profile?: AccountProfile = new AccountProfile();\n  settings?: AccountSettings = new AccountSettings();\n\n  constructor(init: Partial<Account>) {\n    Object.assign(this, {\n      data: {\n        ...new AccountData(),\n        ...init?.data,\n      },\n      keys: {\n        ...new AccountKeys(),\n        ...init?.keys,\n      },\n      profile: {\n        ...new AccountProfile(),\n        ...init?.profile,\n      },\n      settings: {\n        ...new AccountSettings(),\n        ...init?.settings,\n      },\n    });\n  }\n\n  static fromJSON(json: Jsonify<Account>): Account {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Account({}), json, {\n      keys: AccountKeys.fromJSON(json?.keys),\n      data: AccountData.fromJSON(json?.data),\n      profile: AccountProfile.fromJSON(json?.profile),\n      settings: AccountSettings.fromJSON(json?.settings),\n    });\n  }\n}\n","import { firstValueFrom, Observable, map, BehaviorSubject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { DeviceTrustServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust.service.abstraction\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { PasswordTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/password-token.request\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\n\nimport { AuthRequestLoginCredentials } from \"../models/domain/login-credentials\";\nimport { CacheData } from \"../services/login-strategies/login-strategy.state\";\n\nimport { LoginStrategy, LoginStrategyData } from \"./login.strategy\";\n\nexport class AuthRequestLoginStrategyData implements LoginStrategyData {\n  tokenRequest: PasswordTokenRequest;\n  captchaBypassToken: string;\n  authRequestCredentials: AuthRequestLoginCredentials;\n\n  static fromJSON(obj: Jsonify<AuthRequestLoginStrategyData>): AuthRequestLoginStrategyData {\n    const data = Object.assign(new AuthRequestLoginStrategyData(), obj, {\n      tokenRequest: PasswordTokenRequest.fromJSON(obj.tokenRequest),\n      authRequestCredentials: AuthRequestLoginCredentials.fromJSON(obj.authRequestCredentials),\n    });\n    return data;\n  }\n}\n\nexport class AuthRequestLoginStrategy extends LoginStrategy {\n  email$: Observable<string>;\n  accessCode$: Observable<string>;\n  authRequestId$: Observable<string>;\n\n  protected cache: BehaviorSubject<AuthRequestLoginStrategyData>;\n\n  constructor(\n    data: AuthRequestLoginStrategyData,\n    private deviceTrustService: DeviceTrustServiceAbstraction,\n    ...sharedDeps: ConstructorParameters<typeof LoginStrategy>\n  ) {\n    super(...sharedDeps);\n\n    this.cache = new BehaviorSubject(data);\n    this.email$ = this.cache.pipe(map((data) => data.tokenRequest.email));\n    this.accessCode$ = this.cache.pipe(map((data) => data.authRequestCredentials.accessCode));\n    this.authRequestId$ = this.cache.pipe(map((data) => data.authRequestCredentials.authRequestId));\n  }\n\n  override async logIn(credentials: AuthRequestLoginCredentials) {\n    const data = new AuthRequestLoginStrategyData();\n    data.tokenRequest = new PasswordTokenRequest(\n      credentials.email,\n      credentials.accessCode,\n      null,\n      await this.buildTwoFactor(credentials.twoFactor, credentials.email),\n      await this.buildDeviceRequest(),\n    );\n    data.tokenRequest.setAuthRequestAccessCode(credentials.authRequestId);\n    data.authRequestCredentials = credentials;\n    this.cache.next(data);\n\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  override async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string,\n  ): Promise<AuthResult> {\n    const data = this.cache.value;\n    data.tokenRequest.captchaResponse = captchaResponse ?? data.captchaBypassToken;\n    this.cache.next(data);\n\n    return super.logInTwoFactor(twoFactor);\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse, userId: UserId) {\n    const authRequestCredentials = this.cache.value.authRequestCredentials;\n    if (\n      authRequestCredentials.decryptedMasterKey &&\n      authRequestCredentials.decryptedMasterKeyHash\n    ) {\n      await this.masterPasswordService.setMasterKey(\n        authRequestCredentials.decryptedMasterKey,\n        userId,\n      );\n      await this.masterPasswordService.setMasterKeyHash(\n        authRequestCredentials.decryptedMasterKeyHash,\n        userId,\n      );\n    }\n  }\n\n  protected override async setUserKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    const authRequestCredentials = this.cache.value.authRequestCredentials;\n    // User now may or may not have a master password\n    // but set the master key encrypted user key if it exists regardless\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n\n    if (authRequestCredentials.decryptedUserKey) {\n      await this.cryptoService.setUserKey(authRequestCredentials.decryptedUserKey);\n    } else {\n      await this.trySetUserKeyWithMasterKey(userId);\n\n      // Establish trust if required after setting user key\n      await this.deviceTrustService.trustDeviceIfRequired(userId);\n    }\n  }\n\n  private async trySetUserKeyWithMasterKey(userId: UserId): Promise<void> {\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    if (masterKey) {\n      const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(masterKey);\n      await this.cryptoService.setUserKey(userKey);\n    }\n  }\n\n  protected override async setPrivateKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount(userId)),\n      userId,\n    );\n  }\n\n  exportCache(): CacheData {\n    return {\n      authRequest: this.cache.value,\n    };\n  }\n}\n","import { View } from \"../../../models/view/view\";\n\nimport { EncString } from \"./enc-string\";\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\n// https://contributing.bitwarden.com/architecture/clients/data-model#domain\nexport default class Domain {\n  protected buildDomainModel<D extends Domain>(\n    domain: D,\n    dataObj: any,\n    map: any,\n    notEncList: any[] = [],\n  ) {\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      const objProp = dataObj[map[prop] || prop];\n      if (notEncList.indexOf(prop) > -1) {\n        (domain as any)[prop] = objProp ? objProp : null;\n      } else {\n        (domain as any)[prop] = objProp ? new EncString(objProp) : null;\n      }\n    }\n  }\n  protected buildDataModel<D extends Domain>(\n    domain: D,\n    dataObj: any,\n    map: any,\n    notEncStringList: any[] = [],\n  ) {\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      const objProp = (domain as any)[map[prop] || prop];\n      if (notEncStringList.indexOf(prop) > -1) {\n        (dataObj as any)[prop] = objProp != null ? objProp : null;\n      } else {\n        (dataObj as any)[prop] = objProp != null ? (objProp as EncString).encryptedString : null;\n      }\n    }\n  }\n\n  protected async decryptObj<T extends View>(\n    viewModel: T,\n    map: any,\n    orgId: string,\n    key: SymmetricCryptoKey = null,\n  ): Promise<T> {\n    const promises = [];\n    const self: any = this;\n\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      (function (theProp) {\n        const p = Promise.resolve()\n          .then(() => {\n            const mapProp = map[theProp] || theProp;\n            if (self[mapProp]) {\n              return self[mapProp].decrypt(orgId, key);\n            }\n            return null;\n          })\n          .then((val: any) => {\n            (viewModel as any)[theProp] = val;\n          });\n        promises.push(p);\n      })(prop);\n    }\n\n    await Promise.all(promises);\n    return viewModel;\n  }\n}\n","import { MasterPasswordPolicyResponse } from \"../../../auth/models/response/master-password-policy.response\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\n\nexport class MasterPasswordPolicyOptions extends Domain {\n  minComplexity = 0;\n  minLength = 0;\n  requireUpper = false;\n  requireLower = false;\n  requireNumbers = false;\n  requireSpecial = false;\n\n  /**\n   * Flag to indicate if the policy should be enforced on login.\n   * If true, and the user's password does not meet the policy requirements,\n   * the user will be forced to update their password.\n   */\n  enforceOnLogin = false;\n\n  static fromResponse(policy: MasterPasswordPolicyResponse): MasterPasswordPolicyOptions {\n    if (policy == null) {\n      return null;\n    }\n    const options = new MasterPasswordPolicyOptions();\n    options.minComplexity = policy.minComplexity;\n    options.minLength = policy.minLength;\n    options.requireUpper = policy.requireUpper;\n    options.requireLower = policy.requireLower;\n    options.requireNumbers = policy.requireNumbers;\n    options.requireSpecial = policy.requireSpecial;\n    options.enforceOnLogin = policy.enforceOnLogin;\n    return options;\n  }\n}\n","import { BehaviorSubject, firstValueFrom, map, Observable } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { MasterPasswordPolicyOptions } from \"@bitwarden/common/admin-console/models/domain/master-password-policy-options\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { PasswordTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/password-token.request\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { IdentityCaptchaResponse } from \"@bitwarden/common/auth/models/response/identity-captcha.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { IdentityTwoFactorResponse } from \"@bitwarden/common/auth/models/response/identity-two-factor.response\";\nimport { HashPurpose } from \"@bitwarden/common/platform/enums\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { PasswordStrengthServiceAbstraction } from \"@bitwarden/common/tools/password-strength\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { MasterKey } from \"@bitwarden/common/types/key\";\n\nimport { LoginStrategyServiceAbstraction } from \"../abstractions\";\nimport { PasswordLoginCredentials } from \"../models/domain/login-credentials\";\nimport { CacheData } from \"../services/login-strategies/login-strategy.state\";\n\nimport { LoginStrategy, LoginStrategyData } from \"./login.strategy\";\n\nexport class PasswordLoginStrategyData implements LoginStrategyData {\n  tokenRequest: PasswordTokenRequest;\n\n  /** User's entered email obtained pre-login. Always present in MP login. */\n  userEnteredEmail: string;\n  /** If 2fa is required, token is returned to bypass captcha */\n  captchaBypassToken?: string;\n  /** The local version of the user's master key hash */\n  localMasterKeyHash: string;\n  /** The user's master key */\n  masterKey: MasterKey;\n  /**\n   * Tracks if the user needs to update their password due to\n   * a password that does not meet an organization's master password policy.\n   */\n  forcePasswordResetReason: ForceSetPasswordReason = ForceSetPasswordReason.None;\n\n  static fromJSON(obj: Jsonify<PasswordLoginStrategyData>): PasswordLoginStrategyData {\n    const data = Object.assign(new PasswordLoginStrategyData(), obj, {\n      tokenRequest: PasswordTokenRequest.fromJSON(obj.tokenRequest),\n      masterKey: SymmetricCryptoKey.fromJSON(obj.masterKey),\n    });\n    return data;\n  }\n}\n\nexport class PasswordLoginStrategy extends LoginStrategy {\n  /** The email address of the user attempting to log in. */\n  email$: Observable<string>;\n  /** The master key hash used for authentication */\n  serverMasterKeyHash$: Observable<string>;\n  /** The local master key hash we store client side */\n  localMasterKeyHash$: Observable<string | null>;\n\n  protected cache: BehaviorSubject<PasswordLoginStrategyData>;\n\n  constructor(\n    data: PasswordLoginStrategyData,\n    private passwordStrengthService: PasswordStrengthServiceAbstraction,\n    private policyService: PolicyService,\n    private loginStrategyService: LoginStrategyServiceAbstraction,\n    ...sharedDeps: ConstructorParameters<typeof LoginStrategy>\n  ) {\n    super(...sharedDeps);\n\n    this.cache = new BehaviorSubject(data);\n    this.email$ = this.cache.pipe(map((state) => state.tokenRequest.email));\n    this.serverMasterKeyHash$ = this.cache.pipe(\n      map((state) => state.tokenRequest.masterPasswordHash),\n    );\n    this.localMasterKeyHash$ = this.cache.pipe(map((state) => state.localMasterKeyHash));\n  }\n\n  override async logIn(credentials: PasswordLoginCredentials) {\n    const { email, masterPassword, captchaToken, twoFactor } = credentials;\n\n    const data = new PasswordLoginStrategyData();\n    data.masterKey = await this.loginStrategyService.makePreloginKey(masterPassword, email);\n    data.userEnteredEmail = email;\n\n    // Hash the password early (before authentication) so we don't persist it in memory in plaintext\n    data.localMasterKeyHash = await this.cryptoService.hashMasterKey(\n      masterPassword,\n      data.masterKey,\n      HashPurpose.LocalAuthorization,\n    );\n    const serverMasterKeyHash = await this.cryptoService.hashMasterKey(\n      masterPassword,\n      data.masterKey,\n    );\n\n    data.tokenRequest = new PasswordTokenRequest(\n      email,\n      serverMasterKeyHash,\n      captchaToken,\n      await this.buildTwoFactor(twoFactor, email),\n      await this.buildDeviceRequest(),\n    );\n\n    this.cache.next(data);\n\n    const [authResult, identityResponse] = await this.startLogIn();\n\n    if (identityResponse instanceof IdentityCaptchaResponse) {\n      return authResult;\n    }\n\n    const masterPasswordPolicyOptions =\n      this.getMasterPasswordPolicyOptionsFromResponse(identityResponse);\n\n    // The identity result can contain master password policies for the user's organizations\n    if (masterPasswordPolicyOptions?.enforceOnLogin) {\n      // If there is a policy active, evaluate the supplied password before its no longer in memory\n      const meetsRequirements = this.evaluateMasterPassword(\n        credentials,\n        masterPasswordPolicyOptions,\n      );\n      if (meetsRequirements) {\n        return authResult;\n      }\n\n      if (identityResponse instanceof IdentityTwoFactorResponse) {\n        // Save the flag to this strategy for use in 2fa login as the master password is about to pass out of scope\n        this.cache.next({\n          ...this.cache.value,\n          forcePasswordResetReason: ForceSetPasswordReason.WeakMasterPassword,\n        });\n      } else {\n        // Authentication was successful, save the force update password options with the state service\n        await this.masterPasswordService.setForceSetPasswordReason(\n          ForceSetPasswordReason.WeakMasterPassword,\n          authResult.userId, // userId is only available on successful login\n        );\n        authResult.forcePasswordReset = ForceSetPasswordReason.WeakMasterPassword;\n      }\n    }\n    return authResult;\n  }\n\n  override async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string,\n  ): Promise<AuthResult> {\n    const data = this.cache.value;\n    data.tokenRequest.captchaResponse = captchaResponse ?? data.captchaBypassToken;\n    this.cache.next(data);\n\n    const result = await super.logInTwoFactor(twoFactor);\n\n    // 2FA was successful, save the force update password options with the state service if defined\n    const forcePasswordResetReason = this.cache.value.forcePasswordResetReason;\n    if (\n      !result.requiresTwoFactor &&\n      !result.requiresCaptcha &&\n      forcePasswordResetReason != ForceSetPasswordReason.None\n    ) {\n      await this.masterPasswordService.setForceSetPasswordReason(\n        forcePasswordResetReason,\n        result.userId,\n      );\n      result.forcePasswordReset = forcePasswordResetReason;\n    }\n\n    return result;\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse, userId: UserId) {\n    const { masterKey, localMasterKeyHash } = this.cache.value;\n    await this.masterPasswordService.setMasterKey(masterKey, userId);\n    await this.masterPasswordService.setMasterKeyHash(localMasterKeyHash, userId);\n  }\n\n  protected override async setUserKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    // If migration is required, we won't have a user key to set yet.\n    if (this.encryptionKeyMigrationRequired(response)) {\n      return;\n    }\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key, userId);\n\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    if (masterKey) {\n      const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(masterKey);\n      await this.cryptoService.setUserKey(userKey, userId);\n    }\n  }\n\n  protected override async setPrivateKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount(userId)),\n      userId,\n    );\n  }\n\n  protected override encryptionKeyMigrationRequired(response: IdentityTokenResponse): boolean {\n    return !response.key;\n  }\n\n  private getMasterPasswordPolicyOptionsFromResponse(\n    response: IdentityTokenResponse | IdentityTwoFactorResponse,\n  ): MasterPasswordPolicyOptions {\n    if (response == null) {\n      return null;\n    }\n    return MasterPasswordPolicyOptions.fromResponse(response.masterPasswordPolicy);\n  }\n\n  private evaluateMasterPassword(\n    { masterPassword, email }: PasswordLoginCredentials,\n    options: MasterPasswordPolicyOptions,\n  ): boolean {\n    const passwordStrength = this.passwordStrengthService.getPasswordStrength(\n      masterPassword,\n      email,\n    )?.score;\n\n    return this.policyService.evaluateMasterPassword(passwordStrength, masterPassword, options);\n  }\n\n  exportCache(): CacheData {\n    return {\n      password: this.cache.value,\n    };\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class SsoTokenRequest extends TokenRequest {\n  constructor(\n    public code: string,\n    public codeVerifier: string,\n    public redirectUri: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken(clientId: string) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"authorization_code\";\n    obj.code = this.code;\n    obj.code_verifier = this.codeVerifier;\n    obj.redirect_uri = this.redirectUri;\n\n    return obj;\n  }\n\n  static fromJSON(json: any) {\n    return Object.assign(Object.create(SsoTokenRequest.prototype), json, {\n      device: json.device ? DeviceRequest.fromJSON(json.device) : undefined,\n      twoFactor: json.twoFactor\n        ? Object.assign(new TokenTwoFactorRequest(), json.twoFactor)\n        : undefined,\n    });\n  }\n}\n","import { firstValueFrom, Observable, map, BehaviorSubject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { DeviceTrustServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust.service.abstraction\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { SsoTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/sso-token.request\";\nimport { AuthRequestResponse } from \"@bitwarden/common/auth/models/response/auth-request.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { HttpStatusCode } from \"@bitwarden/common/enums\";\nimport { ErrorResponse } from \"@bitwarden/common/models/response/error.response\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\n\nimport { AuthRequestServiceAbstraction } from \"../abstractions\";\nimport { SsoLoginCredentials } from \"../models/domain/login-credentials\";\nimport { CacheData } from \"../services/login-strategies/login-strategy.state\";\n\nimport { LoginStrategyData, LoginStrategy } from \"./login.strategy\";\n\nexport class SsoLoginStrategyData implements LoginStrategyData {\n  captchaBypassToken: string;\n  tokenRequest: SsoTokenRequest;\n  /**\n   * User's entered email obtained pre-login. Present in most SSO flows, but not CLI + SSO Flow.\n   */\n  userEnteredEmail?: string;\n  /**\n   * User email address. Only available after authentication.\n   */\n  email?: string;\n  /**\n   * The organization ID that the user is logging into. Used for Key Connector\n   * purposes after authentication.\n   */\n  orgId: string;\n  /**\n   * A token provided by the server as an authentication factor for sending\n   * email OTPs to the user's configured 2FA email address. This is required\n   * as we don't have a master password hash or other verifiable secret when using SSO.\n   */\n  ssoEmail2FaSessionToken?: string;\n\n  static fromJSON(obj: Jsonify<SsoLoginStrategyData>): SsoLoginStrategyData {\n    return Object.assign(new SsoLoginStrategyData(), obj, {\n      tokenRequest: SsoTokenRequest.fromJSON(obj.tokenRequest),\n    });\n  }\n}\n\nexport class SsoLoginStrategy extends LoginStrategy {\n  /**\n   * @see {@link SsoLoginStrategyData.email}\n   */\n  email$: Observable<string | null>;\n  /**\n   * @see {@link SsoLoginStrategyData.orgId}\n   */\n  orgId$: Observable<string>;\n  /**\n   * @see {@link SsoLoginStrategyData.ssoEmail2FaSessionToken}\n   */\n  ssoEmail2FaSessionToken$: Observable<string | null>;\n\n  protected cache: BehaviorSubject<SsoLoginStrategyData>;\n\n  constructor(\n    data: SsoLoginStrategyData,\n    private keyConnectorService: KeyConnectorService,\n    private deviceTrustService: DeviceTrustServiceAbstraction,\n    private authRequestService: AuthRequestServiceAbstraction,\n    private i18nService: I18nService,\n    ...sharedDeps: ConstructorParameters<typeof LoginStrategy>\n  ) {\n    super(...sharedDeps);\n\n    this.cache = new BehaviorSubject(data);\n    this.email$ = this.cache.pipe(map((state) => state.email));\n    this.orgId$ = this.cache.pipe(map((state) => state.orgId));\n    this.ssoEmail2FaSessionToken$ = this.cache.pipe(map((state) => state.ssoEmail2FaSessionToken));\n  }\n\n  async logIn(credentials: SsoLoginCredentials): Promise<AuthResult> {\n    const data = new SsoLoginStrategyData();\n    data.orgId = credentials.orgId;\n\n    data.userEnteredEmail = credentials.email;\n\n    data.tokenRequest = new SsoTokenRequest(\n      credentials.code,\n      credentials.codeVerifier,\n      credentials.redirectUrl,\n      await this.buildTwoFactor(credentials.twoFactor, credentials.email),\n      await this.buildDeviceRequest(),\n    );\n\n    this.cache.next(data);\n\n    const [ssoAuthResult] = await this.startLogIn();\n\n    const email = ssoAuthResult.email;\n    const ssoEmail2FaSessionToken = ssoAuthResult.ssoEmail2FaSessionToken;\n\n    // Auth guard currently handles redirects for this.\n    if (ssoAuthResult.forcePasswordReset == ForceSetPasswordReason.AdminForcePasswordReset) {\n      await this.masterPasswordService.setForceSetPasswordReason(\n        ssoAuthResult.forcePasswordReset,\n        ssoAuthResult.userId,\n      );\n    }\n\n    this.cache.next({\n      ...this.cache.value,\n      email,\n      ssoEmail2FaSessionToken,\n    });\n\n    return ssoAuthResult;\n  }\n\n  protected override async setMasterKey(tokenResponse: IdentityTokenResponse, userId: UserId) {\n    // The only way we can be setting a master key at this point is if we are using Key Connector.\n    // First, check to make sure that we should do so based on the token response.\n    if (this.shouldSetMasterKeyFromKeyConnector(tokenResponse)) {\n      // If we're here, we know that the user should use Key Connector (they have a KeyConnectorUrl) and does not have a master password.\n      // We can now check the key on the token response to see whether they are a brand new user or an existing user.\n      // The presence of a masterKeyEncryptedUserKey indicates that the user has already been provisioned in Key Connector.\n      const newSsoUser = tokenResponse.key == null;\n      if (newSsoUser) {\n        await this.keyConnectorService.convertNewSsoUserToKeyConnector(\n          tokenResponse,\n          this.cache.value.orgId,\n          userId,\n        );\n      } else {\n        const keyConnectorUrl = this.getKeyConnectorUrl(tokenResponse);\n        await this.keyConnectorService.setMasterKeyFromUrl(keyConnectorUrl, userId);\n      }\n    }\n  }\n\n  /**\n   * Determines if it is possible set the `masterKey` from Key Connector.\n   * @param tokenResponse\n   * @returns `true` if the master key can be set from Key Connector, `false` otherwise\n   */\n  private shouldSetMasterKeyFromKeyConnector(tokenResponse: IdentityTokenResponse): boolean {\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n\n    if (userDecryptionOptions != null) {\n      const userHasMasterPassword = userDecryptionOptions.hasMasterPassword;\n      const userHasKeyConnectorUrl =\n        userDecryptionOptions.keyConnectorOption?.keyConnectorUrl != null;\n\n      // In order for us to set the master key from Key Connector, we need to have a Key Connector URL\n      // and the user must not have a master password.\n      return userHasKeyConnectorUrl && !userHasMasterPassword;\n    } else {\n      // In pre-TDE versions of the server, the userDecryptionOptions will not be present.\n      // In this case, we can determine if the user has a master password and has a Key Connector URL by\n      // just checking the keyConnectorUrl property. This is because the server short-circuits on the response\n      // and will not pass back the URL in the response if the user has a master password.\n      // TODO: remove compatibility check after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n      return tokenResponse.keyConnectorUrl != null;\n    }\n  }\n\n  private getKeyConnectorUrl(tokenResponse: IdentityTokenResponse): string {\n    // TODO: remove tokenResponse.keyConnectorUrl reference after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n    return (\n      tokenResponse.keyConnectorUrl ?? userDecryptionOptions?.keyConnectorOption?.keyConnectorUrl\n    );\n  }\n\n  // TODO: future passkey login strategy will need to support setting user key (decrypting via TDE or admin approval request)\n  // so might be worth moving this logic to a common place (base login strategy or a separate service?)\n  protected override async setUserKey(\n    tokenResponse: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    const masterKeyEncryptedUserKey = tokenResponse.key;\n\n    // Note: masterKeyEncryptedUserKey is undefined for SSO JIT provisioned users\n    // on account creation and subsequent logins (confirmed or unconfirmed)\n    // but that is fine for TDE so we cannot return if it is undefined\n\n    if (masterKeyEncryptedUserKey) {\n      // set the master key encrypted user key if it exists\n      await this.cryptoService.setMasterKeyEncryptedUserKey(masterKeyEncryptedUserKey, userId);\n    }\n\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n\n    // Note: TDE and key connector are mutually exclusive\n    if (userDecryptionOptions?.trustedDeviceOption) {\n      await this.trySetUserKeyWithApprovedAdminRequestIfExists(userId);\n\n      const hasUserKey = await this.cryptoService.hasUserKey(userId);\n\n      // Only try to set user key with device key if admin approval request was not successful\n      if (!hasUserKey) {\n        await this.trySetUserKeyWithDeviceKey(tokenResponse, userId);\n      }\n    } else if (\n      masterKeyEncryptedUserKey != null &&\n      this.getKeyConnectorUrl(tokenResponse) != null\n    ) {\n      // Key connector enabled for user\n      await this.trySetUserKeyWithMasterKey(userId);\n    }\n\n    // Note: In the traditional SSO flow with MP without key connector, the lock component\n    // is responsible for deriving master key from MP entry and then decrypting the user key\n  }\n\n  private async trySetUserKeyWithApprovedAdminRequestIfExists(userId: UserId): Promise<void> {\n    // At this point a user could have an admin auth request that has been approved\n    const adminAuthReqStorable = await this.authRequestService.getAdminAuthRequest(userId);\n\n    if (!adminAuthReqStorable) {\n      return;\n    }\n\n    // Call server to see if admin auth request has been approved\n    let adminAuthReqResponse: AuthRequestResponse;\n\n    try {\n      adminAuthReqResponse = await this.apiService.getAuthRequest(adminAuthReqStorable.id);\n    } catch (error) {\n      if (error instanceof ErrorResponse && error.statusCode === HttpStatusCode.NotFound) {\n        // if we get a 404, it means the auth request has been deleted so clear it from storage\n        await this.authRequestService.clearAdminAuthRequest(userId);\n      }\n\n      // Always return on an error here as we don't want to block the user from logging in\n      return;\n    }\n\n    if (adminAuthReqResponse?.requestApproved) {\n      // if masterPasswordHash has a value, we will always receive authReqResponse.key\n      // as authRequestPublicKey(masterKey) + authRequestPublicKey(masterPasswordHash)\n      if (adminAuthReqResponse.masterPasswordHash) {\n        await this.authRequestService.setKeysAfterDecryptingSharedMasterKeyAndHash(\n          adminAuthReqResponse,\n          adminAuthReqStorable.privateKey,\n        );\n      } else {\n        // if masterPasswordHash is null, we will always receive authReqResponse.key\n        // as authRequestPublicKey(userKey)\n        await this.authRequestService.setUserKeyAfterDecryptingSharedUserKey(\n          adminAuthReqResponse,\n          adminAuthReqStorable.privateKey,\n        );\n      }\n\n      if (await this.cryptoService.hasUserKey()) {\n        // Now that we have a decrypted user key in memory, we can check if we\n        // need to establish trust on the current device\n        await this.deviceTrustService.trustDeviceIfRequired(userId);\n\n        // if we successfully decrypted the user key, we can delete the admin auth request out of state\n        // TODO: eventually we post and clean up DB as well once consumed on client\n        await this.authRequestService.clearAdminAuthRequest(userId);\n\n        this.platformUtilsService.showToast(\"success\", null, this.i18nService.t(\"loginApproved\"));\n      }\n    }\n  }\n\n  private async trySetUserKeyWithDeviceKey(\n    tokenResponse: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    const trustedDeviceOption = tokenResponse.userDecryptionOptions?.trustedDeviceOption;\n\n    const deviceKey = await this.deviceTrustService.getDeviceKey(userId);\n    const encDevicePrivateKey = trustedDeviceOption?.encryptedPrivateKey;\n    const encUserKey = trustedDeviceOption?.encryptedUserKey;\n\n    if (!deviceKey || !encDevicePrivateKey || !encUserKey) {\n      return;\n    }\n\n    const userKey = await this.deviceTrustService.decryptUserKeyWithDeviceKey(\n      userId,\n      encDevicePrivateKey,\n      encUserKey,\n      deviceKey,\n    );\n\n    if (userKey) {\n      await this.cryptoService.setUserKey(userKey);\n    }\n  }\n\n  private async trySetUserKeyWithMasterKey(userId: UserId): Promise<void> {\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n\n    // There is a scenario in which the master key is not set here. That will occur if the user\n    // has a master password and is using Key Connector. In that case, we cannot set the master key\n    // because the user hasn't entered their master password yet.\n    // Instead, we'll return here and let the migration to Key Connector handle setting the master key.\n    if (!masterKey) {\n      return;\n    }\n\n    const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(masterKey);\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  protected override async setPrivateKey(\n    tokenResponse: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    const newSsoUser = tokenResponse.key == null;\n\n    if (!newSsoUser) {\n      await this.cryptoService.setPrivateKey(\n        tokenResponse.privateKey ?? (await this.createKeyPairForOldAccount(userId)),\n        userId,\n      );\n    }\n  }\n\n  exportCache(): CacheData {\n    return {\n      sso: this.cache.value,\n    };\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class UserApiTokenRequest extends TokenRequest {\n  constructor(\n    public clientId: string,\n    public clientSecret: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken() {\n    const obj = super.toIdentityToken(this.clientId);\n\n    obj.scope = this.clientId.startsWith(\"organization\") ? \"api.organization\" : \"api\";\n    obj.grant_type = \"client_credentials\";\n    obj.client_secret = this.clientSecret;\n\n    return obj;\n  }\n\n  static fromJSON(json: any) {\n    return Object.assign(Object.create(UserApiTokenRequest.prototype), json, {\n      device: json.device ? DeviceRequest.fromJSON(json.device) : undefined,\n      twoFactor: json.twoFactor\n        ? Object.assign(new TokenTwoFactorRequest(), json.twoFactor)\n        : undefined,\n    });\n  }\n}\n","import { firstValueFrom, BehaviorSubject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { KeyConnectorService } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { UserApiTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/user-api-token.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { VaultTimeoutAction } from \"@bitwarden/common/enums/vault-timeout-action.enum\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\n\nimport { UserApiLoginCredentials } from \"../models/domain/login-credentials\";\nimport { CacheData } from \"../services/login-strategies/login-strategy.state\";\n\nimport { LoginStrategy, LoginStrategyData } from \"./login.strategy\";\n\nexport class UserApiLoginStrategyData implements LoginStrategyData {\n  tokenRequest: UserApiTokenRequest;\n  captchaBypassToken: string;\n\n  static fromJSON(obj: Jsonify<UserApiLoginStrategyData>): UserApiLoginStrategyData {\n    return Object.assign(new UserApiLoginStrategyData(), obj, {\n      tokenRequest: UserApiTokenRequest.fromJSON(obj.tokenRequest),\n    });\n  }\n}\n\nexport class UserApiLoginStrategy extends LoginStrategy {\n  protected cache: BehaviorSubject<UserApiLoginStrategyData>;\n\n  constructor(\n    data: UserApiLoginStrategyData,\n    private environmentService: EnvironmentService,\n    private keyConnectorService: KeyConnectorService,\n    ...sharedDeps: ConstructorParameters<typeof LoginStrategy>\n  ) {\n    super(...sharedDeps);\n\n    this.cache = new BehaviorSubject(data);\n  }\n\n  override async logIn(credentials: UserApiLoginCredentials) {\n    const data = new UserApiLoginStrategyData();\n    data.tokenRequest = new UserApiTokenRequest(\n      credentials.clientId,\n      credentials.clientSecret,\n      await this.buildTwoFactor(),\n      await this.buildDeviceRequest(),\n    );\n    this.cache.next(data);\n\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse, userId: UserId) {\n    if (response.apiUseKeyConnector) {\n      const env = await firstValueFrom(this.environmentService.environment$);\n      const keyConnectorUrl = env.getKeyConnectorUrl();\n      await this.keyConnectorService.setMasterKeyFromUrl(keyConnectorUrl, userId);\n    }\n  }\n\n  protected override async setUserKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n\n    if (response.apiUseKeyConnector) {\n      const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n      if (masterKey) {\n        const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(masterKey);\n        await this.cryptoService.setUserKey(userKey, userId);\n      }\n    }\n  }\n\n  protected override async setPrivateKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount(userId)),\n      userId,\n    );\n  }\n\n  // Overridden to save client ID and secret to token service\n  protected async saveAccountInformation(tokenResponse: IdentityTokenResponse): Promise<UserId> {\n    const userId = await super.saveAccountInformation(tokenResponse);\n\n    const vaultTimeoutAction = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutActionByUserId$(userId),\n    );\n    const vaultTimeout = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n    );\n\n    const tokenRequest = this.cache.value.tokenRequest;\n\n    await this.tokenService.setClientId(\n      tokenRequest.clientId,\n      vaultTimeoutAction as VaultTimeoutAction,\n      vaultTimeout,\n    );\n    await this.tokenService.setClientSecret(\n      tokenRequest.clientSecret,\n      vaultTimeoutAction as VaultTimeoutAction,\n      vaultTimeout,\n    );\n    return userId;\n  }\n\n  exportCache(): CacheData {\n    return {\n      userApiKey: this.cache.value,\n    };\n  }\n}\n","import { WebAuthnLoginAssertionResponseRequest } from \"../../../services/webauthn-login/request/webauthn-login-assertion-response.request\";\n\nimport { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class WebAuthnLoginTokenRequest extends TokenRequest {\n  constructor(\n    public token: string,\n    public deviceResponse: WebAuthnLoginAssertionResponseRequest,\n    device?: DeviceRequest,\n  ) {\n    super(undefined, device);\n  }\n\n  toIdentityToken(clientId: string) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"webauthn\";\n    obj.token = this.token;\n    // must be a string b/c sending as form encoded data\n    obj.deviceResponse = JSON.stringify(this.deviceResponse);\n\n    return obj;\n  }\n\n  static fromJSON(json: any) {\n    return Object.assign(Object.create(WebAuthnLoginTokenRequest.prototype), json, {\n      deviceResponse: WebAuthnLoginAssertionResponseRequest.fromJSON(json.deviceResponse),\n      device: json.device ? DeviceRequest.fromJSON(json.device) : undefined,\n      twoFactor: json.twoFactor\n        ? Object.assign(new TokenTwoFactorRequest(), json.twoFactor)\n        : undefined,\n    });\n  }\n}\n","import { BehaviorSubject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { WebAuthnLoginTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/webauthn-login-token.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { UserKey } from \"@bitwarden/common/types/key\";\n\nimport { WebAuthnLoginCredentials } from \"../models/domain/login-credentials\";\nimport { CacheData } from \"../services/login-strategies/login-strategy.state\";\n\nimport { LoginStrategy, LoginStrategyData } from \"./login.strategy\";\n\nexport class WebAuthnLoginStrategyData implements LoginStrategyData {\n  tokenRequest: WebAuthnLoginTokenRequest;\n  captchaBypassToken?: string;\n  credentials: WebAuthnLoginCredentials;\n\n  static fromJSON(obj: Jsonify<WebAuthnLoginStrategyData>): WebAuthnLoginStrategyData {\n    return Object.assign(new WebAuthnLoginStrategyData(), obj, {\n      tokenRequest: WebAuthnLoginTokenRequest.fromJSON(obj.tokenRequest),\n      credentials: WebAuthnLoginCredentials.fromJSON(obj.credentials),\n    });\n  }\n}\n\nexport class WebAuthnLoginStrategy extends LoginStrategy {\n  protected cache: BehaviorSubject<WebAuthnLoginStrategyData>;\n\n  constructor(\n    data: WebAuthnLoginStrategyData,\n    ...sharedDeps: ConstructorParameters<typeof LoginStrategy>\n  ) {\n    super(...sharedDeps);\n\n    this.cache = new BehaviorSubject(data);\n  }\n\n  async logIn(credentials: WebAuthnLoginCredentials) {\n    const data = new WebAuthnLoginStrategyData();\n    data.credentials = credentials;\n    data.tokenRequest = new WebAuthnLoginTokenRequest(\n      credentials.token,\n      credentials.deviceResponse,\n      await this.buildDeviceRequest(),\n    );\n    this.cache.next(data);\n\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  async logInTwoFactor(): Promise<AuthResult> {\n    throw new Error(\"2FA not supported yet for WebAuthn Login.\");\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse, userId: UserId) {\n    return Promise.resolve();\n  }\n\n  protected override async setUserKey(idTokenResponse: IdentityTokenResponse, userId: UserId) {\n    const masterKeyEncryptedUserKey = idTokenResponse.key;\n\n    if (masterKeyEncryptedUserKey) {\n      // set the master key encrypted user key if it exists\n      await this.cryptoService.setMasterKeyEncryptedUserKey(masterKeyEncryptedUserKey, userId);\n    }\n\n    const userDecryptionOptions = idTokenResponse?.userDecryptionOptions;\n\n    if (userDecryptionOptions?.webAuthnPrfOption) {\n      const webAuthnPrfOption = idTokenResponse.userDecryptionOptions?.webAuthnPrfOption;\n\n      const credentials = this.cache.value.credentials;\n      // confirm we still have the prf key\n      if (!credentials.prfKey) {\n        return;\n      }\n\n      // decrypt prf encrypted private key\n      const privateKey = await this.cryptoService.decryptToBytes(\n        webAuthnPrfOption.encryptedPrivateKey,\n        credentials.prfKey,\n      );\n\n      // decrypt user key with private key\n      const userKey = await this.cryptoService.rsaDecrypt(\n        webAuthnPrfOption.encryptedUserKey.encryptedString,\n        privateKey,\n      );\n\n      if (userKey) {\n        await this.cryptoService.setUserKey(new SymmetricCryptoKey(userKey) as UserKey, userId);\n      }\n    }\n  }\n\n  protected override async setPrivateKey(\n    response: IdentityTokenResponse,\n    userId: UserId,\n  ): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount(userId)),\n      userId,\n    );\n  }\n\n  exportCache(): CacheData {\n    return {\n      webAuthn: this.cache.value,\n    };\n  }\n}\n","import { AuthenticationType } from \"@bitwarden/common/auth/enums/authentication-type\";\nimport { KeyDefinition, LOGIN_STRATEGY_MEMORY } from \"@bitwarden/common/platform/state\";\n\nimport { AuthRequestLoginStrategyData } from \"../../login-strategies/auth-request-login.strategy\";\nimport { PasswordLoginStrategyData } from \"../../login-strategies/password-login.strategy\";\nimport { SsoLoginStrategyData } from \"../../login-strategies/sso-login.strategy\";\nimport { UserApiLoginStrategyData } from \"../../login-strategies/user-api-login.strategy\";\nimport { WebAuthnLoginStrategyData } from \"../../login-strategies/webauthn-login.strategy\";\n\n/**\n * The current login strategy in use.\n */\nexport const CURRENT_LOGIN_STRATEGY_KEY = new KeyDefinition<AuthenticationType | null>(\n  LOGIN_STRATEGY_MEMORY,\n  \"currentLoginStrategy\",\n  {\n    deserializer: (data) => data,\n  },\n);\n\n/**\n * The expiration date for the login strategy cache.\n * Used as a backup to the timer set on the service.\n */\nexport const CACHE_EXPIRATION_KEY = new KeyDefinition<Date | null>(\n  LOGIN_STRATEGY_MEMORY,\n  \"loginStrategyCacheExpiration\",\n  {\n    deserializer: (data) => (data ? null : new Date(data)),\n  },\n);\n\n/**\n * Auth Request notification for all instances of the login strategy service.\n * Note: this isn't an ideal approach, but allows both a background and\n * foreground instance to send out the notification.\n * TODO: Move to Auth Request service.\n */\nexport const AUTH_REQUEST_PUSH_NOTIFICATION_KEY = new KeyDefinition<string>(\n  LOGIN_STRATEGY_MEMORY,\n  \"authRequestPushNotification\",\n  {\n    deserializer: (data) => data,\n  },\n);\n\nexport type CacheData = {\n  password?: PasswordLoginStrategyData;\n  sso?: SsoLoginStrategyData;\n  userApiKey?: UserApiLoginStrategyData;\n  authRequest?: AuthRequestLoginStrategyData;\n  webAuthn?: WebAuthnLoginStrategyData;\n};\n\n/**\n * A cache for login strategies to use for data persistence through\n * the login process.\n */\nexport const CACHE_KEY = new KeyDefinition<CacheData | null>(\n  LOGIN_STRATEGY_MEMORY,\n  \"loginStrategyCache\",\n  {\n    deserializer: (data) => {\n      if (data == null) {\n        return null;\n      }\n      return {\n        password: data.password ? PasswordLoginStrategyData.fromJSON(data.password) : undefined,\n        sso: data.sso ? SsoLoginStrategyData.fromJSON(data.sso) : undefined,\n        userApiKey: data.userApiKey\n          ? UserApiLoginStrategyData.fromJSON(data.userApiKey)\n          : undefined,\n        authRequest: data.authRequest\n          ? AuthRequestLoginStrategyData.fromJSON(data.authRequest)\n          : undefined,\n        webAuthn: data.webAuthn ? WebAuthnLoginStrategyData.fromJSON(data.webAuthn) : undefined,\n      };\n    },\n  },\n);\n","import { map } from \"rxjs\";\n\nimport {\n  ActiveUserState,\n  StateProvider,\n  USER_DECRYPTION_OPTIONS_DISK,\n  UserKeyDefinition,\n} from \"@bitwarden/common/platform/state\";\nimport { UserId } from \"@bitwarden/common/src/types/guid\";\n\nimport { InternalUserDecryptionOptionsServiceAbstraction } from \"../../abstractions/user-decryption-options.service.abstraction\";\nimport { UserDecryptionOptions } from \"../../models\";\n\nexport const USER_DECRYPTION_OPTIONS = new UserKeyDefinition<UserDecryptionOptions>(\n  USER_DECRYPTION_OPTIONS_DISK,\n  \"decryptionOptions\",\n  {\n    deserializer: (decryptionOptions) => UserDecryptionOptions.fromJSON(decryptionOptions),\n    clearOn: [\"logout\"],\n  },\n);\n\nexport class UserDecryptionOptionsService\n  implements InternalUserDecryptionOptionsServiceAbstraction\n{\n  private userDecryptionOptionsState: ActiveUserState<UserDecryptionOptions>;\n\n  userDecryptionOptions$;\n  hasMasterPassword$;\n\n  constructor(private stateProvider: StateProvider) {\n    this.userDecryptionOptionsState = this.stateProvider.getActive(USER_DECRYPTION_OPTIONS);\n\n    this.userDecryptionOptions$ = this.userDecryptionOptionsState.state$;\n    this.hasMasterPassword$ = this.userDecryptionOptions$.pipe(\n      map((options) => options?.hasMasterPassword ?? false),\n    );\n  }\n\n  userDecryptionOptionsById$(userId: UserId) {\n    return this.stateProvider.getUser(userId, USER_DECRYPTION_OPTIONS).state$;\n  }\n\n  async setUserDecryptionOptions(userDecryptionOptions: UserDecryptionOptions): Promise<void> {\n    await this.userDecryptionOptionsState.update((_) => userDecryptionOptions);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\n\nexport class AdminAuthRequestStorable {\n  id: string;\n  privateKey: Uint8Array;\n\n  constructor(init?: Partial<AdminAuthRequestStorable>) {\n    if (init) {\n      Object.assign(this, init);\n    }\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      privateKey: Utils.fromBufferToByteString(this.privateKey),\n    };\n  }\n\n  static fromJSON(obj: Jsonify<AdminAuthRequestStorable>): AdminAuthRequestStorable {\n    if (obj == null) {\n      return null;\n    }\n\n    let privateKeyBuffer = null;\n    if (obj.privateKey) {\n      privateKeyBuffer = Utils.fromByteStringToArray(obj.privateKey);\n    }\n\n    return new AdminAuthRequestStorable({\n      id: obj.id,\n      privateKey: privateKeyBuffer,\n    });\n  }\n}\n","export class PasswordlessAuthRequest {\n  constructor(\n    readonly key: string,\n    readonly masterPasswordHash: string,\n    readonly deviceIdentifier: string,\n    readonly requestApproved: boolean,\n  ) {}\n}\n","import { Observable, Subject, firstValueFrom } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"@bitwarden/common/auth/abstractions/master-password.service.abstraction\";\nimport { AdminAuthRequestStorable } from \"@bitwarden/common/auth/models/domain/admin-auth-req-storable\";\nimport { PasswordlessAuthRequest } from \"@bitwarden/common/auth/models/request/passwordless-auth.request\";\nimport { AuthRequestResponse } from \"@bitwarden/common/auth/models/response/auth-request.response\";\nimport { AuthRequestPushNotification } from \"@bitwarden/common/models/response/notification.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport {\n  AUTH_REQUEST_DISK_LOCAL,\n  StateProvider,\n  UserKeyDefinition,\n} from \"@bitwarden/common/platform/state\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { MasterKey, UserKey } from \"@bitwarden/common/types/key\";\n\nimport { AuthRequestServiceAbstraction } from \"../../abstractions/auth-request.service.abstraction\";\n\n/**\n * Disk-local to maintain consistency between tabs (even though\n * approvals are currently only available on desktop). We don't\n * want to clear this on logout as it's a user preference.\n */\nexport const ACCEPT_AUTH_REQUESTS_KEY = new UserKeyDefinition<boolean>(\n  AUTH_REQUEST_DISK_LOCAL,\n  \"acceptAuthRequests\",\n  {\n    deserializer: (value) => value ?? false,\n    clearOn: [],\n  },\n);\n\n/**\n * Disk-local to maintain consistency between tabs. We don't want to\n * clear this on logout since admin auth requests are long-lived.\n */\nexport const ADMIN_AUTH_REQUEST_KEY = new UserKeyDefinition<Jsonify<AdminAuthRequestStorable>>(\n  AUTH_REQUEST_DISK_LOCAL,\n  \"adminAuthRequest\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\nexport class AuthRequestService implements AuthRequestServiceAbstraction {\n  private authRequestPushNotificationSubject = new Subject<string>();\n  authRequestPushNotification$: Observable<string>;\n\n  constructor(\n    private appIdService: AppIdService,\n    private accountService: AccountService,\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    private cryptoService: CryptoService,\n    private apiService: ApiService,\n    private stateProvider: StateProvider,\n  ) {\n    this.authRequestPushNotification$ = this.authRequestPushNotificationSubject.asObservable();\n  }\n\n  async getAcceptAuthRequests(userId: UserId): Promise<boolean> {\n    if (userId == null) {\n      throw new Error(\"User ID is required\");\n    }\n\n    const value = await firstValueFrom(\n      this.stateProvider.getUser(userId, ACCEPT_AUTH_REQUESTS_KEY).state$,\n    );\n    return value;\n  }\n\n  async setAcceptAuthRequests(accept: boolean, userId: UserId): Promise<void> {\n    if (userId == null) {\n      throw new Error(\"User ID is required\");\n    }\n\n    await this.stateProvider.setUserState(ACCEPT_AUTH_REQUESTS_KEY, accept, userId);\n  }\n\n  async getAdminAuthRequest(userId: UserId): Promise<AdminAuthRequestStorable | null> {\n    if (userId == null) {\n      throw new Error(\"User ID is required\");\n    }\n\n    const authRequestSerialized = await firstValueFrom(\n      this.stateProvider.getUser(userId, ADMIN_AUTH_REQUEST_KEY).state$,\n    );\n    const adminAuthRequestStorable = AdminAuthRequestStorable.fromJSON(authRequestSerialized);\n    return adminAuthRequestStorable;\n  }\n\n  async setAdminAuthRequest(authRequest: AdminAuthRequestStorable, userId: UserId): Promise<void> {\n    if (userId == null) {\n      throw new Error(\"User ID is required\");\n    }\n    if (authRequest == null) {\n      throw new Error(\"Auth request is required\");\n    }\n\n    await this.stateProvider.setUserState(ADMIN_AUTH_REQUEST_KEY, authRequest.toJSON(), userId);\n  }\n\n  async clearAdminAuthRequest(userId: UserId): Promise<void> {\n    if (userId == null) {\n      throw new Error(\"User ID is required\");\n    }\n\n    await this.stateProvider.setUserState(ADMIN_AUTH_REQUEST_KEY, null, userId);\n  }\n\n  async approveOrDenyAuthRequest(\n    approve: boolean,\n    authRequest: AuthRequestResponse,\n  ): Promise<AuthRequestResponse> {\n    if (!authRequest.id) {\n      throw new Error(\"Auth request has no id\");\n    }\n    if (!authRequest.publicKey) {\n      throw new Error(\"Auth request has no public key\");\n    }\n    const pubKey = Utils.fromB64ToArray(authRequest.publicKey);\n\n    const userId = (await firstValueFrom(this.accountService.activeAccount$)).id;\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    const masterKeyHash = await firstValueFrom(this.masterPasswordService.masterKeyHash$(userId));\n    let encryptedMasterKeyHash;\n    let keyToEncrypt;\n\n    if (masterKey && masterKeyHash) {\n      // Only encrypt the master password hash if masterKey exists as\n      // we won't have a masterKeyHash without a masterKey\n      encryptedMasterKeyHash = await this.cryptoService.rsaEncrypt(\n        Utils.fromUtf8ToArray(masterKeyHash),\n        pubKey,\n      );\n      keyToEncrypt = masterKey.encKey;\n    } else {\n      const userKey = await this.cryptoService.getUserKey();\n      keyToEncrypt = userKey.key;\n    }\n\n    const encryptedKey = await this.cryptoService.rsaEncrypt(keyToEncrypt, pubKey);\n\n    const response = new PasswordlessAuthRequest(\n      encryptedKey.encryptedString,\n      encryptedMasterKeyHash?.encryptedString,\n      await this.appIdService.getAppId(),\n      approve,\n    );\n    return await this.apiService.putAuthRequest(authRequest.id, response);\n  }\n\n  async setUserKeyAfterDecryptingSharedUserKey(\n    authReqResponse: AuthRequestResponse,\n    authReqPrivateKey: Uint8Array,\n  ) {\n    const userKey = await this.decryptPubKeyEncryptedUserKey(\n      authReqResponse.key,\n      authReqPrivateKey,\n    );\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  async setKeysAfterDecryptingSharedMasterKeyAndHash(\n    authReqResponse: AuthRequestResponse,\n    authReqPrivateKey: Uint8Array,\n  ) {\n    const { masterKey, masterKeyHash } = await this.decryptPubKeyEncryptedMasterKeyAndHash(\n      authReqResponse.key,\n      authReqResponse.masterPasswordHash,\n      authReqPrivateKey,\n    );\n\n    // Decrypt and set user key in state\n    const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(masterKey);\n\n    // Set masterKey + masterKeyHash in state after decryption (in case decryption fails)\n    const userId = (await firstValueFrom(this.accountService.activeAccount$)).id;\n    await this.masterPasswordService.setMasterKey(masterKey, userId);\n    await this.masterPasswordService.setMasterKeyHash(masterKeyHash, userId);\n\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  // Decryption helpers\n  async decryptPubKeyEncryptedUserKey(\n    pubKeyEncryptedUserKey: string,\n    privateKey: Uint8Array,\n  ): Promise<UserKey> {\n    const decryptedUserKeyBytes = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedUserKey,\n      privateKey,\n    );\n\n    return new SymmetricCryptoKey(decryptedUserKeyBytes) as UserKey;\n  }\n\n  async decryptPubKeyEncryptedMasterKeyAndHash(\n    pubKeyEncryptedMasterKey: string,\n    pubKeyEncryptedMasterKeyHash: string,\n    privateKey: Uint8Array,\n  ): Promise<{ masterKey: MasterKey; masterKeyHash: string }> {\n    const decryptedMasterKeyArrayBuffer = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedMasterKey,\n      privateKey,\n    );\n\n    const decryptedMasterKeyHashArrayBuffer = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedMasterKeyHash,\n      privateKey,\n    );\n\n    const masterKey = new SymmetricCryptoKey(decryptedMasterKeyArrayBuffer) as MasterKey;\n    const masterKeyHash = Utils.fromBufferToUtf8(decryptedMasterKeyHashArrayBuffer);\n\n    return {\n      masterKey,\n      masterKeyHash,\n    };\n  }\n\n  sendAuthRequestPushNotification(notification: AuthRequestPushNotification): void {\n    if (notification.id != null) {\n      this.authRequestPushNotificationSubject.next(notification.id);\n    }\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ProductType } from \"../../../enums\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\nimport { ProfileOrganizationResponse } from \"../response/profile-organization.response\";\n\nexport class OrganizationData {\n  id: string;\n  name: string;\n  status: OrganizationUserStatusType;\n  type: OrganizationUserType;\n  enabled: boolean;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  hasPublicAndPrivateKeys: boolean;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  isProviderUser: boolean;\n  isMember: boolean;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  limitCollectionCreationDeletion: boolean;\n  allowAdminAccessToAllCollectionItems: boolean;\n  flexibleCollections: boolean;\n\n  constructor(\n    response?: ProfileOrganizationResponse,\n    options?: {\n      isMember: boolean;\n      isProviderUser: boolean;\n    },\n  ) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.name = response.name;\n    this.status = response.status;\n    this.type = response.type;\n    this.enabled = response.enabled;\n    this.usePolicies = response.usePolicies;\n    this.useGroups = response.useGroups;\n    this.useDirectory = response.useDirectory;\n    this.useEvents = response.useEvents;\n    this.useTotp = response.useTotp;\n    this.use2fa = response.use2fa;\n    this.useApi = response.useApi;\n    this.useSso = response.useSso;\n    this.useKeyConnector = response.useKeyConnector;\n    this.useScim = response.useScim;\n    this.useCustomPermissions = response.useCustomPermissions;\n    this.useResetPassword = response.useResetPassword;\n    this.useSecretsManager = response.useSecretsManager;\n    this.usePasswordManager = response.usePasswordManager;\n    this.useActivateAutofillPolicy = response.useActivateAutofillPolicy;\n    this.selfHost = response.selfHost;\n    this.usersGetPremium = response.usersGetPremium;\n    this.seats = response.seats;\n    this.maxCollections = response.maxCollections;\n    this.maxStorageGb = response.maxStorageGb;\n    this.ssoBound = response.ssoBound;\n    this.identifier = response.identifier;\n    this.permissions = response.permissions;\n    this.resetPasswordEnrolled = response.resetPasswordEnrolled;\n    this.userId = response.userId;\n    this.hasPublicAndPrivateKeys = response.hasPublicAndPrivateKeys;\n    this.providerId = response.providerId;\n    this.providerName = response.providerName;\n    this.providerType = response.providerType;\n    this.familySponsorshipFriendlyName = response.familySponsorshipFriendlyName;\n    this.familySponsorshipAvailable = response.familySponsorshipAvailable;\n    this.planProductType = response.planProductType;\n    this.keyConnectorEnabled = response.keyConnectorEnabled;\n    this.keyConnectorUrl = response.keyConnectorUrl;\n    this.familySponsorshipLastSyncDate = response.familySponsorshipLastSyncDate;\n    this.familySponsorshipValidUntil = response.familySponsorshipValidUntil;\n    this.familySponsorshipToDelete = response.familySponsorshipToDelete;\n    this.accessSecretsManager = response.accessSecretsManager;\n    this.limitCollectionCreationDeletion = response.limitCollectionCreationDeletion;\n    this.allowAdminAccessToAllCollectionItems = response.allowAdminAccessToAllCollectionItems;\n    this.flexibleCollections = response.flexibleCollections;\n\n    this.isMember = options.isMember;\n    this.isProviderUser = options.isProviderUser;\n  }\n\n  static fromJSON(obj: Jsonify<OrganizationData>) {\n    return Object.assign(new OrganizationData(), obj, {\n      familySponsorshipLastSyncDate:\n        obj.familySponsorshipLastSyncDate != null\n          ? new Date(obj.familySponsorshipLastSyncDate)\n          : obj.familySponsorshipLastSyncDate,\n      familySponsorshipValidUntil:\n        obj.familySponsorshipValidUntil != null\n          ? new Date(obj.familySponsorshipValidUntil)\n          : obj.familySponsorshipValidUntil,\n    });\n  }\n}\n","export enum OrganizationApiKeyType {\n  Default = 0,\n  BillingSync = 1,\n  Scim = 2,\n}\n","export enum OrganizationConnectionType {\n  CloudBillingSync = 1,\n  Scim = 2,\n}\n","export enum OrganizationUserStatusType {\n  Invited = 0,\n  Accepted = 1,\n  Confirmed = 2,\n  Revoked = -1,\n}\n","export enum OrganizationUserType {\n  Owner = 0,\n  Admin = 1,\n  User = 2,\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   */\n  Manager = 3,\n  Custom = 4,\n}\n","export enum PolicyType {\n  TwoFactorAuthentication = 0, // Requires users to have 2fa enabled\n  MasterPassword = 1, // Sets minimum requirements for master password complexity\n  PasswordGenerator = 2, // Sets minimum requirements/default type for generated passwords/passphrases\n  SingleOrg = 3, // Allows users to only be apart of one organization\n  RequireSso = 4, // Requires users to authenticate with SSO\n  PersonalOwnership = 5, // Disables personal vault ownership for adding/cloning items\n  DisableSend = 6, // Disables the ability to create and edit Bitwarden Sends\n  SendOptions = 7, // Sets restrictions or defaults for Bitwarden Sends\n  ResetPassword = 8, // Allows orgs to use reset password : also can enable auto-enrollment during invite flow\n  MaximumVaultTimeout = 9, // Sets the maximum allowed vault timeout\n  DisablePersonalVaultExport = 10, // Disable personal vault export\n  ActivateAutofill = 11, // Activates autofill with page load on the browser extension\n}\n","export enum ProviderType {\n  Msp = 0,\n  Reseller = 1,\n}\n","export enum ProviderUserStatusType {\n  Invited = 0,\n  Accepted = 1,\n  Confirmed = 2,\n  Revoked = -1, // Not used, compile-time support only\n}\n","export enum ProviderUserType {\n  ProviderAdmin = 0,\n  ServiceUser = 1,\n}\n","export enum ScimProviderType {\n  Default = 0,\n  AzureAd = 1,\n  Okta = 2,\n  OneLogin = 3,\n  JumpCloud = 4,\n  GoogleWorkspace = 5,\n  Rippling = 6,\n}\n","export enum ProviderStatusType {\n  Pending = 0,\n  Created = 1,\n  Billable = 2,\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ProductType } from \"../../../enums\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\nimport { OrganizationData } from \"../data/organization.data\";\n\nexport class Organization {\n  id: string;\n  name: string;\n  status: OrganizationUserStatusType;\n\n  /**\n   * The member's role in the organization.\n   * Avoid using this for permission checks - use the getters instead (e.g. isOwner, isAdmin, canManageX), because they\n   * properly handle permission inheritance and relationships.\n   */\n  type: OrganizationUserType;\n\n  enabled: boolean;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  hasPublicAndPrivateKeys: boolean;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  /**\n   * Indicates that a user is a ProviderUser for the organization\n   */\n  isProviderUser: boolean;\n  /**\n   * Indicates that a user is a member for the organization (may be `false` if they have access via a Provider only)\n   */\n  isMember: boolean;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  /**\n   * Refers to the ability for an organization to limit collection creation and deletion to owners and admins only\n   */\n  limitCollectionCreationDeletion: boolean;\n  /**\n   * Refers to the ability for an owner/admin to access all collection items, regardless of assigned collections\n   */\n  allowAdminAccessToAllCollectionItems: boolean;\n  /**\n   * Returns true if this organization has enabled Flexible Collections (MVP) and their data has been migrated.\n   * Generally, you should use this as the feature flag to gate Flexible Collections features.\n   */\n  flexibleCollections: boolean;\n\n  constructor(obj?: OrganizationData) {\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.name = obj.name;\n    this.status = obj.status;\n    this.type = obj.type;\n    this.enabled = obj.enabled;\n    this.usePolicies = obj.usePolicies;\n    this.useGroups = obj.useGroups;\n    this.useDirectory = obj.useDirectory;\n    this.useEvents = obj.useEvents;\n    this.useTotp = obj.useTotp;\n    this.use2fa = obj.use2fa;\n    this.useApi = obj.useApi;\n    this.useSso = obj.useSso;\n    this.useKeyConnector = obj.useKeyConnector;\n    this.useScim = obj.useScim;\n    this.useCustomPermissions = obj.useCustomPermissions;\n    this.useResetPassword = obj.useResetPassword;\n    this.useSecretsManager = obj.useSecretsManager;\n    this.usePasswordManager = obj.usePasswordManager;\n    this.useActivateAutofillPolicy = obj.useActivateAutofillPolicy;\n    this.selfHost = obj.selfHost;\n    this.usersGetPremium = obj.usersGetPremium;\n    this.seats = obj.seats;\n    this.maxCollections = obj.maxCollections;\n    this.maxStorageGb = obj.maxStorageGb;\n    this.ssoBound = obj.ssoBound;\n    this.identifier = obj.identifier;\n    this.permissions = obj.permissions;\n    this.resetPasswordEnrolled = obj.resetPasswordEnrolled;\n    this.userId = obj.userId;\n    this.hasPublicAndPrivateKeys = obj.hasPublicAndPrivateKeys;\n    this.providerId = obj.providerId;\n    this.providerName = obj.providerName;\n    this.providerType = obj.providerType;\n    this.isProviderUser = obj.isProviderUser;\n    this.isMember = obj.isMember;\n    this.familySponsorshipFriendlyName = obj.familySponsorshipFriendlyName;\n    this.familySponsorshipAvailable = obj.familySponsorshipAvailable;\n    this.planProductType = obj.planProductType;\n    this.keyConnectorEnabled = obj.keyConnectorEnabled;\n    this.keyConnectorUrl = obj.keyConnectorUrl;\n    this.familySponsorshipLastSyncDate = obj.familySponsorshipLastSyncDate;\n    this.familySponsorshipValidUntil = obj.familySponsorshipValidUntil;\n    this.familySponsorshipToDelete = obj.familySponsorshipToDelete;\n    this.accessSecretsManager = obj.accessSecretsManager;\n    this.limitCollectionCreationDeletion = obj.limitCollectionCreationDeletion;\n    this.allowAdminAccessToAllCollectionItems = obj.allowAdminAccessToAllCollectionItems;\n    this.flexibleCollections = obj.flexibleCollections;\n  }\n\n  get canAccess() {\n    if (this.isOwner) {\n      return true;\n    }\n    return this.enabled && this.status === OrganizationUserStatusType.Confirmed;\n  }\n\n  /**\n   * Whether a user has Manager permissions or greater\n   *\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   */\n  get isManager() {\n    return this.type === OrganizationUserType.Manager || this.isAdmin;\n  }\n\n  /**\n   * Whether a user has Admin permissions or greater\n   */\n  get isAdmin() {\n    return this.type === OrganizationUserType.Admin || this.isOwner;\n  }\n\n  /**\n   * Whether a user has Owner permissions (including ProviderUsers)\n   */\n  get isOwner() {\n    return this.type === OrganizationUserType.Owner || this.isProviderUser;\n  }\n\n  get canAccessEventLogs() {\n    return (this.isAdmin || this.permissions.accessEventLogs) && this.useEvents;\n  }\n\n  get canAccessImportExport() {\n    return this.isAdmin || this.permissions.accessImportExport;\n  }\n\n  get canAccessReports() {\n    return this.isAdmin || this.permissions.accessReports;\n  }\n\n  get canCreateNewCollections() {\n    if (this.flexibleCollections) {\n      return (\n        !this.limitCollectionCreationDeletion ||\n        this.isAdmin ||\n        this.permissions.createNewCollections\n      );\n    }\n\n    return this.isManager || this.permissions.createNewCollections;\n  }\n\n  canEditAnyCollection(flexibleCollectionsV1Enabled: boolean) {\n    if (!this.flexibleCollections || !flexibleCollectionsV1Enabled) {\n      // Pre-Flexible Collections v1 logic\n      return this.isAdmin || this.permissions.editAnyCollection;\n    }\n\n    // Post Flexible Collections V1, the allowAdminAccessToAllCollectionItems flag can restrict admins\n    // Providers and custom users with canEditAnyCollection are not affected by allowAdminAccessToAllCollectionItems flag\n    return (\n      this.isProviderUser ||\n      (this.type === OrganizationUserType.Custom && this.permissions.editAnyCollection) ||\n      (this.allowAdminAccessToAllCollectionItems && this.isAdmin)\n    );\n  }\n\n  canEditUnmanagedCollections() {\n    // Any admin or custom user with editAnyCollection permission can edit unmanaged collections\n    return this.isAdmin || this.permissions.editAnyCollection;\n  }\n\n  canEditUnassignedCiphers(restrictProviderAccessFlagEnabled: boolean) {\n    if (this.isProviderUser) {\n      return !restrictProviderAccessFlagEnabled;\n    }\n    return this.isAdmin || this.permissions.editAnyCollection;\n  }\n\n  canEditAllCiphers(\n    flexibleCollectionsV1Enabled: boolean,\n    restrictProviderAccessFlagEnabled: boolean,\n  ) {\n    // Before Flexible Collections, any admin or anyone with editAnyCollection permission could edit all ciphers\n    if (!this.flexibleCollections || !flexibleCollectionsV1Enabled || !this.flexibleCollections) {\n      return this.isAdmin || this.permissions.editAnyCollection;\n    }\n\n    if (this.isProviderUser) {\n      return !restrictProviderAccessFlagEnabled;\n    }\n\n    // Post Flexible Collections V1, the allowAdminAccessToAllCollectionItems flag can restrict admins\n    // Custom users with canEditAnyCollection are not affected by allowAdminAccessToAllCollectionItems flag\n    return (\n      (this.type === OrganizationUserType.Custom && this.permissions.editAnyCollection) ||\n      (this.allowAdminAccessToAllCollectionItems &&\n        (this.type === OrganizationUserType.Admin || this.type === OrganizationUserType.Owner))\n    );\n  }\n\n  /**\n   * @param flexibleCollectionsV1Enabled - Whether or not the V1 Flexible Collection feature flag is enabled\n   * @returns True if the user can delete any collection\n   */\n  canDeleteAnyCollection(flexibleCollectionsV1Enabled: boolean) {\n    // Providers and Users with DeleteAnyCollection permission can always delete collections\n    if (this.isProviderUser || this.permissions.deleteAnyCollection) {\n      return true;\n    }\n\n    // If AllowAdminAccessToAllCollectionItems is true, Owners and Admins can delete any collection, regardless of LimitCollectionCreationDeletion setting\n    // Using explicit type checks because provider users are handled above and this mimics the server's permission checks closely\n    if (!flexibleCollectionsV1Enabled || this.allowAdminAccessToAllCollectionItems) {\n      return this.type == OrganizationUserType.Owner || this.type == OrganizationUserType.Admin;\n    }\n\n    return false;\n  }\n\n  /**\n   * Whether the user can view all collection information, such as collection name and access.\n   * This does not indicate that the user can view items inside any collection - for that, see {@link canEditAllCiphers}\n   */\n  get canViewAllCollections() {\n    // Admins can always see all collections even if collection management settings prevent them from editing them or seeing items\n    return (\n      this.isAdmin || this.permissions.editAnyCollection || this.permissions.deleteAnyCollection\n    );\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canEditAssignedCollections() {\n    return this.isManager || this.permissions.editAssignedCollections;\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canDeleteAssignedCollections() {\n    return this.isManager || this.permissions.deleteAssignedCollections;\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canViewAssignedCollections() {\n    return this.canDeleteAssignedCollections || this.canEditAssignedCollections;\n  }\n\n  get canManageGroups() {\n    return (this.isAdmin || this.permissions.manageGroups) && this.useGroups;\n  }\n\n  get canManageSso() {\n    return (this.isAdmin || this.permissions.manageSso) && this.useSso;\n  }\n\n  get canManageDomainVerification() {\n    return (this.isAdmin || this.permissions.manageSso) && this.useSso;\n  }\n\n  get canManageScim() {\n    return (this.isAdmin || this.permissions.manageScim) && this.useScim;\n  }\n\n  get canManagePolicies() {\n    return (this.isAdmin || this.permissions.managePolicies) && this.usePolicies;\n  }\n\n  get canManageUsers() {\n    return this.isAdmin || this.permissions.manageUsers;\n  }\n\n  get canManageUsersPassword() {\n    return this.isAdmin || this.permissions.manageResetPassword;\n  }\n\n  get canManageDeviceApprovals() {\n    return (this.isAdmin || this.permissions.manageResetPassword) && this.useSso;\n  }\n\n  get isExemptFromPolicies() {\n    return this.canManagePolicies;\n  }\n\n  get canViewSubscription() {\n    if (this.canEditSubscription) {\n      return true;\n    }\n\n    return this.hasProvider && this.providerType === ProviderType.Msp\n      ? this.isProviderUser\n      : this.isOwner;\n  }\n\n  get canEditSubscription() {\n    return this.hasProvider ? this.isProviderUser : this.isOwner;\n  }\n\n  get canEditPaymentMethods() {\n    return this.canEditSubscription;\n  }\n\n  get canViewBillingHistory() {\n    return this.canEditSubscription;\n  }\n\n  get hasProvider() {\n    return this.providerId != null || this.providerName != null;\n  }\n\n  get hasReseller() {\n    return this.hasProvider && this.providerType === ProviderType.Reseller;\n  }\n\n  get canAccessSecretsManager() {\n    return this.useSecretsManager && this.accessSecretsManager;\n  }\n\n  get isFreeOrg() {\n    // return true if organization needs to be upgraded from a free org\n    return !this.useTotp;\n  }\n\n  get canManageSponsorships() {\n    return this.familySponsorshipAvailable || this.familySponsorshipFriendlyName !== null;\n  }\n\n  static fromJSON(json: Jsonify<Organization>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Organization(), json, {\n      familySponsorshipLastSyncDate: new Date(json.familySponsorshipLastSyncDate),\n      familySponsorshipValidUntil: new Date(json.familySponsorshipValidUntil),\n    });\n  }\n}\n","import { map, Observable, firstValueFrom } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { ORGANIZATIONS_DISK, StateProvider, UserKeyDefinition } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { InternalOrganizationServiceAbstraction } from \"../../abstractions/organization/organization.service.abstraction\";\nimport { OrganizationData } from \"../../models/data/organization.data\";\nimport { Organization } from \"../../models/domain/organization\";\n\n/**\n * The `KeyDefinition` for accessing organization lists in application state.\n * @todo Ideally this wouldn't require a `fromJSON()` call, but `OrganizationData`\n * has some properties that contain functions. This should probably get\n * cleaned up.\n */\nexport const ORGANIZATIONS = UserKeyDefinition.record<OrganizationData>(\n  ORGANIZATIONS_DISK,\n  \"organizations\",\n  {\n    deserializer: (obj: Jsonify<OrganizationData>) => OrganizationData.fromJSON(obj),\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * Filter out organizations from an observable that __do not__ offer a\n * families-for-enterprise sponsorship to members.\n * @returns a function that can be used in `Observable<Organization[]>` pipes,\n * like `organizationService.organizations$`\n */\nfunction mapToExcludeOrganizationsWithoutFamilySponsorshipSupport() {\n  return map<Organization[], Organization[]>((orgs) => orgs.filter((o) => o.canManageSponsorships));\n}\n\n/**\n * Filter out organizations from an observable that the organization user\n * __is not__ a direct member of. This will exclude organizations only\n * accessible as a provider.\n * @returns a function that can be used in `Observable<Organization[]>` pipes,\n * like `organizationService.organizations$`\n */\nfunction mapToExcludeProviderOrganizations() {\n  return map<Organization[], Organization[]>((orgs) => orgs.filter((o) => o.isMember));\n}\n\n/**\n * Map an observable stream of organizations down to a boolean indicating\n * if any organizations exist (`orgs.length > 0`).\n * @returns a function that can be used in `Observable<Organization[]>` pipes,\n * like `organizationService.organizations$`\n */\nfunction mapToBooleanHasAnyOrganizations() {\n  return map<Organization[], boolean>((orgs) => orgs.length > 0);\n}\n\n/**\n * Map an observable stream of organizations down to a single organization.\n * @param `organizationId` The ID of the organization you'd like to subscribe to\n * @returns a function that can be used in `Observable<Organization[]>` pipes,\n * like `organizationService.organizations$`\n */\nfunction mapToSingleOrganization(organizationId: string) {\n  return map<Organization[], Organization>((orgs) => orgs?.find((o) => o.id === organizationId));\n}\n\nexport class OrganizationService implements InternalOrganizationServiceAbstraction {\n  organizations$ = this.getOrganizationsFromState$();\n  memberOrganizations$ = this.organizations$.pipe(mapToExcludeProviderOrganizations());\n\n  constructor(private stateProvider: StateProvider) {}\n\n  get$(id: string): Observable<Organization | undefined> {\n    return this.organizations$.pipe(mapToSingleOrganization(id));\n  }\n\n  getAll$(userId?: UserId): Observable<Organization[]> {\n    return this.getOrganizationsFromState$(userId);\n  }\n\n  async getAll(userId?: string): Promise<Organization[]> {\n    return await firstValueFrom(this.getOrganizationsFromState$(userId as UserId));\n  }\n\n  canManageSponsorships$ = this.organizations$.pipe(\n    mapToExcludeOrganizationsWithoutFamilySponsorshipSupport(),\n    mapToBooleanHasAnyOrganizations(),\n  );\n\n  async hasOrganizations(): Promise<boolean> {\n    return await firstValueFrom(this.organizations$.pipe(mapToBooleanHasAnyOrganizations()));\n  }\n\n  async upsert(organization: OrganizationData, userId?: UserId): Promise<void> {\n    await this.stateFor(userId).update((existingOrganizations) => {\n      const organizations = existingOrganizations ?? {};\n      organizations[organization.id] = organization;\n      return organizations;\n    });\n  }\n\n  async get(id: string): Promise<Organization> {\n    return await firstValueFrom(this.organizations$.pipe(mapToSingleOrganization(id)));\n  }\n\n  /**\n   * @deprecated For the CLI only\n   * @param id id of the organization\n   */\n  async getFromState(id: string): Promise<Organization> {\n    return await firstValueFrom(this.organizations$.pipe(mapToSingleOrganization(id)));\n  }\n\n  async replace(organizations: { [id: string]: OrganizationData }, userId?: UserId): Promise<void> {\n    await this.stateFor(userId).update(() => organizations);\n  }\n\n  // Ideally this method would be renamed to organizations$() and the\n  // $organizations observable as it stands would be removed. This will\n  // require updates to callers, and so this method exists as a temporary\n  // workaround until we have time & a plan to update callers.\n  //\n  // It can be thought of as \"organizations$ but with a userId option\".\n  private getOrganizationsFromState$(userId?: UserId): Observable<Organization[] | undefined> {\n    return this.stateFor(userId).state$.pipe(this.mapOrganizationRecordToArray());\n  }\n\n  /**\n   * Accepts a record of `OrganizationData`, which is how we store the\n   * organization list as a JSON object on disk, to an array of\n   * `Organization`, which is how the data is published to callers of the\n   * service.\n   * @returns a function that can be used to pipe organization data from\n   * stored state to an exposed object easily consumable by others.\n   */\n  private mapOrganizationRecordToArray() {\n    return map<Record<string, OrganizationData>, Organization[]>((orgs) =>\n      Object.values(orgs ?? {})?.map((o) => new Organization(o)),\n    );\n  }\n\n  /**\n   * Fetches the organization list from on disk state for the specified user.\n   * @param userId the user ID to fetch the organization list for. Defaults to\n   * the currently active user.\n   * @returns an observable of organization state as it is stored on disk.\n   */\n  private stateFor(userId?: UserId) {\n    return userId\n      ? this.stateProvider.getUser(userId, ORGANIZATIONS)\n      : this.stateProvider.getActive(ORGANIZATIONS);\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class ListResponse<T> extends BaseResponse {\n  data: T[];\n  continuationToken: string;\n\n  constructor(response: any, t: new (dataResponse: any) => T) {\n    super(response);\n    const data = this.getResponseProperty(\"Data\");\n    this.data = data == null ? [] : data.map((dr: any) => new t(dr));\n    this.continuationToken = this.getResponseProperty(\"ContinuationToken\");\n  }\n}\n","import { PolicyId } from \"../../../types/guid\";\nimport { PolicyType } from \"../../enums\";\nimport { Policy } from \"../domain/policy\";\nimport { PolicyResponse } from \"../response/policy.response\";\n\nexport class PolicyData {\n  id: PolicyId;\n  organizationId: string;\n  type: PolicyType;\n  data: Record<string, string | number | boolean>;\n  enabled: boolean;\n\n  constructor(response?: PolicyResponse) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.type = response.type;\n    this.data = response.data;\n    this.enabled = response.enabled;\n  }\n\n  static fromPolicy(policy: Policy): PolicyData {\n    return Object.assign(new PolicyData(), policy);\n  }\n}\n","import { ListResponse } from \"../../../models/response/list.response\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { PolicyId } from \"../../../types/guid\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../data/policy.data\";\nimport { PolicyResponse } from \"../response/policy.response\";\n\nexport class Policy extends Domain {\n  id: PolicyId;\n  organizationId: string;\n  type: PolicyType;\n  data: any;\n\n  /**\n   * Warning: a user can be exempt from a policy even if the policy is enabled.\n   * @see {@link PolicyService} has methods to tell you whether a policy applies to a user.\n   */\n  enabled: boolean;\n\n  constructor(obj?: PolicyData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.organizationId = obj.organizationId;\n    this.type = obj.type;\n    this.data = obj.data;\n    this.enabled = obj.enabled;\n  }\n\n  static fromResponse(response: PolicyResponse): Policy {\n    return new Policy(new PolicyData(response));\n  }\n\n  static fromListResponse(response: ListResponse<PolicyResponse>): Policy[] | undefined {\n    return response.data?.map((d) => Policy.fromResponse(d)) ?? undefined;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { PolicyId } from \"../../../types/guid\";\nimport { PolicyType } from \"../../enums\";\n\nexport class PolicyResponse extends BaseResponse {\n  id: PolicyId;\n  organizationId: string;\n  type: PolicyType;\n  data: any;\n  enabled: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.data = this.getResponseProperty(\"Data\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { ApiService } from \"../../../abstractions/api.service\";\nimport { HttpStatusCode } from \"../../../enums\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { PolicyApiServiceAbstraction } from \"../../abstractions/policy/policy-api.service.abstraction\";\nimport { InternalPolicyService } from \"../../abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { Policy } from \"../../models/domain/policy\";\nimport { PolicyRequest } from \"../../models/request/policy.request\";\nimport { PolicyResponse } from \"../../models/response/policy.response\";\n\nexport class PolicyApiService implements PolicyApiServiceAbstraction {\n  constructor(\n    private policyService: InternalPolicyService,\n    private apiService: ApiService,\n  ) {}\n\n  async getPolicy(organizationId: string, type: PolicyType): Promise<PolicyResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies/\" + type,\n      null,\n      true,\n      true,\n    );\n    return new PolicyResponse(r);\n  }\n\n  async getPolicies(organizationId: string): Promise<ListResponse<PolicyResponse>> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, PolicyResponse);\n  }\n\n  async getPoliciesByToken(\n    organizationId: string,\n    token: string,\n    email: string,\n    organizationUserId: string,\n  ): Promise<Policy[] | undefined> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" +\n        organizationId +\n        \"/policies/token?\" +\n        \"token=\" +\n        encodeURIComponent(token) +\n        \"&email=\" +\n        Utils.encodeRFC3986URIComponent(email) +\n        \"&organizationUserId=\" +\n        organizationUserId,\n      null,\n      false,\n      true,\n    );\n    return Policy.fromListResponse(new ListResponse(r, PolicyResponse));\n  }\n\n  private async getMasterPasswordPolicyResponseForOrgUser(\n    organizationId: string,\n  ): Promise<PolicyResponse> {\n    const response = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies/master-password\",\n      null,\n      true,\n      true,\n    );\n\n    return new PolicyResponse(response);\n  }\n\n  async getMasterPasswordPolicyOptsForOrgUser(\n    orgId: string,\n  ): Promise<MasterPasswordPolicyOptions | null> {\n    try {\n      const masterPasswordPolicyResponse =\n        await this.getMasterPasswordPolicyResponseForOrgUser(orgId);\n\n      const masterPasswordPolicy = Policy.fromResponse(masterPasswordPolicyResponse);\n\n      if (!masterPasswordPolicy) {\n        return null;\n      }\n\n      return await firstValueFrom(\n        this.policyService.masterPasswordPolicyOptions$([masterPasswordPolicy]),\n      );\n    } catch (error) {\n      // If policy not found, return null\n      if (error instanceof ErrorResponse && error.statusCode === HttpStatusCode.NotFound) {\n        return null;\n      }\n      // otherwise rethrow error\n      throw error;\n    }\n  }\n\n  async putPolicy(organizationId: string, type: PolicyType, request: PolicyRequest): Promise<any> {\n    const r = await this.apiService.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/policies/\" + type,\n      request,\n      true,\n      true,\n    );\n    const response = new PolicyResponse(r);\n    const data = new PolicyData(response);\n    await this.policyService.upsert(data);\n  }\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\n\nexport class ResetPasswordPolicyOptions extends Domain {\n  autoEnrollEnabled = false;\n}\n","import { combineLatest, firstValueFrom, map, Observable, of } from \"rxjs\";\n\nimport { UserKeyDefinition, POLICIES_DISK, StateProvider } from \"../../../platform/state\";\nimport { PolicyId, UserId } from \"../../../types/guid\";\nimport { OrganizationService } from \"../../abstractions/organization/organization.service.abstraction\";\nimport { InternalPolicyService as InternalPolicyServiceAbstraction } from \"../../abstractions/policy/policy.service.abstraction\";\nimport { OrganizationUserStatusType, PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { Organization } from \"../../models/domain/organization\";\nimport { Policy } from \"../../models/domain/policy\";\nimport { ResetPasswordPolicyOptions } from \"../../models/domain/reset-password-policy-options\";\n\nconst policyRecordToArray = (policiesMap: { [id: string]: PolicyData }) =>\n  Object.values(policiesMap || {}).map((f) => new Policy(f));\n\nexport const POLICIES = UserKeyDefinition.record<PolicyData, PolicyId>(POLICIES_DISK, \"policies\", {\n  deserializer: (policyData) => policyData,\n  clearOn: [\"logout\"],\n});\n\nexport class PolicyService implements InternalPolicyServiceAbstraction {\n  private activeUserPolicyState = this.stateProvider.getActive(POLICIES);\n  private activeUserPolicies$ = this.activeUserPolicyState.state$.pipe(\n    map((policyData) => policyRecordToArray(policyData)),\n  );\n\n  policies$ = this.activeUserPolicies$;\n\n  constructor(\n    private stateProvider: StateProvider,\n    private organizationService: OrganizationService,\n  ) {}\n\n  get$(policyType: PolicyType) {\n    const filteredPolicies$ = this.activeUserPolicies$.pipe(\n      map((policies) => policies.filter((p) => p.type === policyType)),\n    );\n\n    return combineLatest([filteredPolicies$, this.organizationService.organizations$]).pipe(\n      map(\n        ([policies, organizations]) =>\n          this.enforcedPolicyFilter(policies, organizations)?.at(0) ?? null,\n      ),\n    );\n  }\n\n  getAll$(policyType: PolicyType, userId?: UserId) {\n    const filteredPolicies$ = this.stateProvider.getUserState$(POLICIES, userId).pipe(\n      map((policyData) => policyRecordToArray(policyData)),\n      map((policies) => policies.filter((p) => p.type === policyType)),\n    );\n\n    return combineLatest([filteredPolicies$, this.organizationService.getAll$(userId)]).pipe(\n      map(([policies, organizations]) => this.enforcedPolicyFilter(policies, organizations)),\n    );\n  }\n\n  async getAll(policyType: PolicyType) {\n    return await firstValueFrom(\n      this.policies$.pipe(map((policies) => policies.filter((p) => p.type === policyType))),\n    );\n  }\n\n  policyAppliesToActiveUser$(policyType: PolicyType) {\n    return this.get$(policyType).pipe(map((policy) => policy != null));\n  }\n\n  async policyAppliesToUser(policyType: PolicyType) {\n    return await firstValueFrom(this.policyAppliesToActiveUser$(policyType));\n  }\n\n  private enforcedPolicyFilter(policies: Policy[], organizations: Organization[]) {\n    const orgDict = Object.fromEntries(organizations.map((o) => [o.id, o]));\n    return policies.filter((policy) => {\n      const organization = orgDict[policy.organizationId];\n\n      // This shouldn't happen, i.e. the user should only have policies for orgs they are a member of\n      // But if it does, err on the side of enforcing the policy\n      if (organization == null) {\n        return true;\n      }\n\n      return (\n        policy.enabled &&\n        organization.status >= OrganizationUserStatusType.Accepted &&\n        organization.usePolicies &&\n        !this.isExemptFromPolicy(policy.type, organization)\n      );\n    });\n  }\n\n  masterPasswordPolicyOptions$(policies?: Policy[]): Observable<MasterPasswordPolicyOptions> {\n    const observable = policies ? of(policies) : this.policies$;\n    return observable.pipe(\n      map((obsPolicies) => {\n        let enforcedOptions: MasterPasswordPolicyOptions = null;\n        const filteredPolicies = obsPolicies.filter((p) => p.type === PolicyType.MasterPassword);\n\n        if (filteredPolicies == null || filteredPolicies.length === 0) {\n          return enforcedOptions;\n        }\n\n        filteredPolicies.forEach((currentPolicy) => {\n          if (!currentPolicy.enabled || currentPolicy.data == null) {\n            return;\n          }\n\n          if (enforcedOptions == null) {\n            enforcedOptions = new MasterPasswordPolicyOptions();\n          }\n\n          if (\n            currentPolicy.data.minComplexity != null &&\n            currentPolicy.data.minComplexity > enforcedOptions.minComplexity\n          ) {\n            enforcedOptions.minComplexity = currentPolicy.data.minComplexity;\n          }\n\n          if (\n            currentPolicy.data.minLength != null &&\n            currentPolicy.data.minLength > enforcedOptions.minLength\n          ) {\n            enforcedOptions.minLength = currentPolicy.data.minLength;\n          }\n\n          if (currentPolicy.data.requireUpper) {\n            enforcedOptions.requireUpper = true;\n          }\n\n          if (currentPolicy.data.requireLower) {\n            enforcedOptions.requireLower = true;\n          }\n\n          if (currentPolicy.data.requireNumbers) {\n            enforcedOptions.requireNumbers = true;\n          }\n\n          if (currentPolicy.data.requireSpecial) {\n            enforcedOptions.requireSpecial = true;\n          }\n\n          if (currentPolicy.data.enforceOnLogin) {\n            enforcedOptions.enforceOnLogin = true;\n          }\n        });\n\n        return enforcedOptions;\n      }),\n    );\n  }\n\n  evaluateMasterPassword(\n    passwordStrength: number,\n    newPassword: string,\n    enforcedPolicyOptions: MasterPasswordPolicyOptions,\n  ): boolean {\n    if (enforcedPolicyOptions == null) {\n      return true;\n    }\n\n    if (\n      enforcedPolicyOptions.minComplexity > 0 &&\n      enforcedPolicyOptions.minComplexity > passwordStrength\n    ) {\n      return false;\n    }\n\n    if (\n      enforcedPolicyOptions.minLength > 0 &&\n      enforcedPolicyOptions.minLength > newPassword.length\n    ) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireUpper && newPassword.toLocaleLowerCase() === newPassword) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireLower && newPassword.toLocaleUpperCase() === newPassword) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireNumbers && !/[0-9]/.test(newPassword)) {\n      return false;\n    }\n\n    // eslint-disable-next-line\n    if (enforcedPolicyOptions.requireSpecial && !/[!@#$%\\^&*]/g.test(newPassword)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  getResetPasswordPolicyOptions(\n    policies: Policy[],\n    orgId: string,\n  ): [ResetPasswordPolicyOptions, boolean] {\n    const resetPasswordPolicyOptions = new ResetPasswordPolicyOptions();\n\n    if (policies == null || orgId == null) {\n      return [resetPasswordPolicyOptions, false];\n    }\n\n    const policy = policies.find(\n      (p) => p.organizationId === orgId && p.type === PolicyType.ResetPassword && p.enabled,\n    );\n    resetPasswordPolicyOptions.autoEnrollEnabled = policy?.data?.autoEnrollEnabled ?? false;\n\n    return [resetPasswordPolicyOptions, policy?.enabled ?? false];\n  }\n\n  async upsert(policy: PolicyData): Promise<void> {\n    await this.activeUserPolicyState.update((policies) => {\n      policies ??= {};\n      policies[policy.id] = policy;\n      return policies;\n    });\n  }\n\n  async replace(policies: { [id: string]: PolicyData }): Promise<void> {\n    await this.activeUserPolicyState.update(() => policies);\n  }\n\n  /**\n   * Determines whether an orgUser is exempt from a specific policy because of their role\n   * Generally orgUsers who can manage policies are exempt from them, but some policies are stricter\n   */\n  private isExemptFromPolicy(policyType: PolicyType, organization: Organization) {\n    switch (policyType) {\n      case PolicyType.MaximumVaultTimeout:\n        // Max Vault Timeout applies to everyone except owners\n        return organization.isOwner;\n      case PolicyType.PasswordGenerator:\n        // password generation policy applies to everyone\n        return false;\n      default:\n        return organization.canManagePolicies;\n    }\n  }\n}\n","import { ProviderStatusType, ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { ProviderData } from \"../data/provider.data\";\n\nexport class Provider {\n  id: string;\n  name: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  userId: string;\n  useEvents: boolean;\n  providerStatus: ProviderStatusType;\n\n  constructor(obj?: ProviderData) {\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.name = obj.name;\n    this.status = obj.status;\n    this.type = obj.type;\n    this.enabled = obj.enabled;\n    this.userId = obj.userId;\n    this.useEvents = obj.useEvents;\n    this.providerStatus = obj.providerStatus;\n  }\n\n  get canAccess() {\n    if (this.isProviderAdmin) {\n      return true;\n    }\n    return this.enabled && this.status === ProviderUserStatusType.Confirmed;\n  }\n\n  get canCreateOrganizations() {\n    return this.enabled && this.isProviderAdmin;\n  }\n\n  get canManageUsers() {\n    return this.isProviderAdmin;\n  }\n\n  get canAccessEventLogs() {\n    return this.isProviderAdmin;\n  }\n\n  get isProviderAdmin() {\n    return this.type === ProviderUserType.ProviderAdmin;\n  }\n}\n","import { firstValueFrom, map, Observable, of, switchMap, take } from \"rxjs\";\n\nimport { PROVIDERS_DISK, StateProvider, UserKeyDefinition } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { ProviderService as ProviderServiceAbstraction } from \"../abstractions/provider.service\";\nimport { ProviderData } from \"../models/data/provider.data\";\nimport { Provider } from \"../models/domain/provider\";\n\nexport const PROVIDERS = UserKeyDefinition.record<ProviderData>(PROVIDERS_DISK, \"providers\", {\n  deserializer: (obj: ProviderData) => obj,\n  clearOn: [\"logout\"],\n});\n\nfunction mapToSingleProvider(providerId: string) {\n  return map<Provider[], Provider>((providers) => providers?.find((p) => p.id === providerId));\n}\n\nexport class ProviderService implements ProviderServiceAbstraction {\n  constructor(private stateProvider: StateProvider) {}\n\n  private providers$(userId?: UserId): Observable<Provider[] | undefined> {\n    // FIXME: Can be replaced with `getUserStateOrDefault$` if we weren't trying to pick this.\n    return (\n      userId != null\n        ? this.stateProvider.getUser(userId, PROVIDERS).state$\n        : this.stateProvider.activeUserId$.pipe(\n            take(1),\n            switchMap((userId) =>\n              userId != null ? this.stateProvider.getUser(userId, PROVIDERS).state$ : of(null),\n            ),\n          )\n    ).pipe(this.mapProviderRecordToArray());\n  }\n\n  private mapProviderRecordToArray() {\n    return map<Record<string, ProviderData>, Provider[]>((providers) =>\n      Object.values(providers ?? {})?.map((o) => new Provider(o)),\n    );\n  }\n\n  get$(id: string): Observable<Provider> {\n    return this.providers$().pipe(mapToSingleProvider(id));\n  }\n\n  async get(id: string): Promise<Provider> {\n    return await firstValueFrom(this.providers$().pipe(mapToSingleProvider(id)));\n  }\n\n  async getAll(): Promise<Provider[]> {\n    return await firstValueFrom(this.providers$());\n  }\n\n  async save(providers: { [id: string]: ProviderData }, userId?: UserId) {\n    await this.stateProvider.setUserState(PROVIDERS, providers, userId);\n  }\n}\n","export enum AuthenticationStatus {\n  LoggedOut = 0,\n  Locked = 1,\n  Unlocked = 2,\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\n\n/**\n * Holds information about an account for use in the AccountService\n * if more information is added, be sure to update the equality method.\n */\nexport type AccountInfo = {\n  email: string;\n  emailVerified: boolean;\n  name: string | undefined;\n};\n\nexport function accountInfoEqual(a: AccountInfo, b: AccountInfo) {\n  if (a == null && b == null) {\n    return true;\n  }\n\n  if (a == null || b == null) {\n    return false;\n  }\n\n  const keys = new Set([...Object.keys(a), ...Object.keys(b)]) as Set<keyof AccountInfo>;\n  for (const key of keys) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport abstract class AccountService {\n  accounts$: Observable<Record<UserId, AccountInfo>>;\n  activeAccount$: Observable<{ id: UserId | undefined } & AccountInfo>;\n\n  /**\n   * Observable of the last activity time for each account.\n   */\n  accountActivity$: Observable<Record<UserId, Date>>;\n  /** Account list in order of descending recency */\n  sortedUserIds$: Observable<UserId[]>;\n  /** Next account that is not the current active account */\n  nextUpAccount$: Observable<{ id: UserId } & AccountInfo>;\n  /**\n   * Updates the `accounts$` observable with the new account data.\n   *\n   * @note Also sets the last active date of the account to `now`.\n   * @param userId\n   * @param accountData\n   */\n  abstract addAccount(userId: UserId, accountData: AccountInfo): Promise<void>;\n  /**\n   * updates the `accounts$` observable with the new preferred name for the account.\n   * @param userId\n   * @param name\n   */\n  abstract setAccountName(userId: UserId, name: string): Promise<void>;\n  /**\n   * updates the `accounts$` observable with the new email for the account.\n   * @param userId\n   * @param email\n   */\n  abstract setAccountEmail(userId: UserId, email: string): Promise<void>;\n  /**\n   * updates the `accounts$` observable with the new email verification status for the account.\n   * @param userId\n   * @param emailVerified\n   */\n  abstract setAccountEmailVerified(userId: UserId, emailVerified: boolean): Promise<void>;\n  /**\n   * Updates the `activeAccount$` observable with the new active account.\n   * @param userId\n   */\n  abstract switchAccount(userId: UserId): Promise<void>;\n  /**\n   * Cleans personal information for the given account from the `accounts$` observable. Does not remove the userId from the observable.\n   *\n   * @note Also sets the last active date of the account to `null`.\n   * @param userId\n   */\n  abstract clean(userId: UserId): Promise<void>;\n  /**\n   * Updates the given user's last activity time.\n   * @param userId\n   * @param lastActivity\n   */\n  abstract setAccountActivity(userId: UserId, lastActivity: Date): Promise<void>;\n}\n\nexport abstract class InternalAccountService extends AccountService {\n  abstract delete(): void;\n}\n","import { combineLatestWith, map, distinctUntilChanged, shareReplay, combineLatest } from \"rxjs\";\n\nimport {\n  AccountInfo,\n  InternalAccountService,\n  accountInfoEqual,\n} from \"../../auth/abstractions/account.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { MessagingService } from \"../../platform/abstractions/messaging.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport {\n  ACCOUNT_DISK,\n  GlobalState,\n  GlobalStateProvider,\n  KeyDefinition,\n} from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\n\nexport const ACCOUNT_ACCOUNTS = KeyDefinition.record<AccountInfo, UserId>(\n  ACCOUNT_DISK,\n  \"accounts\",\n  {\n    deserializer: (accountInfo) => accountInfo,\n  },\n);\n\nexport const ACCOUNT_ACTIVE_ACCOUNT_ID = new KeyDefinition(ACCOUNT_DISK, \"activeAccountId\", {\n  deserializer: (id: UserId) => id,\n});\n\nexport const ACCOUNT_ACTIVITY = KeyDefinition.record<Date, UserId>(ACCOUNT_DISK, \"activity\", {\n  deserializer: (activity) => new Date(activity),\n});\n\nconst LOGGED_OUT_INFO: AccountInfo = {\n  email: \"\",\n  emailVerified: false,\n  name: undefined,\n};\n\nexport class AccountServiceImplementation implements InternalAccountService {\n  private accountsState: GlobalState<Record<UserId, AccountInfo>>;\n  private activeAccountIdState: GlobalState<UserId | undefined>;\n\n  accounts$;\n  activeAccount$;\n  accountActivity$;\n  sortedUserIds$;\n  nextUpAccount$;\n\n  constructor(\n    private messagingService: MessagingService,\n    private logService: LogService,\n    private globalStateProvider: GlobalStateProvider,\n  ) {\n    this.accountsState = this.globalStateProvider.get(ACCOUNT_ACCOUNTS);\n    this.activeAccountIdState = this.globalStateProvider.get(ACCOUNT_ACTIVE_ACCOUNT_ID);\n\n    this.accounts$ = this.accountsState.state$.pipe(\n      map((accounts) => (accounts == null ? {} : accounts)),\n    );\n    this.activeAccount$ = this.activeAccountIdState.state$.pipe(\n      combineLatestWith(this.accounts$),\n      map(([id, accounts]) => (id ? { id, ...accounts[id] } : undefined)),\n      distinctUntilChanged((a, b) => a?.id === b?.id && accountInfoEqual(a, b)),\n      shareReplay({ bufferSize: 1, refCount: false }),\n    );\n    this.accountActivity$ = this.globalStateProvider\n      .get(ACCOUNT_ACTIVITY)\n      .state$.pipe(map((activity) => activity ?? {}));\n    this.sortedUserIds$ = this.accountActivity$.pipe(\n      map((activity) => {\n        return Object.entries(activity)\n          .map(([userId, lastActive]: [UserId, Date]) => ({ userId, lastActive }))\n          .sort((a, b) => b.lastActive.getTime() - a.lastActive.getTime()) // later dates first\n          .map((a) => a.userId);\n      }),\n    );\n    this.nextUpAccount$ = combineLatest([\n      this.accounts$,\n      this.activeAccount$,\n      this.sortedUserIds$,\n    ]).pipe(\n      map(([accounts, activeAccount, sortedUserIds]) => {\n        const nextId = sortedUserIds.find((id) => id !== activeAccount?.id && accounts[id] != null);\n        return nextId ? { id: nextId, ...accounts[nextId] } : null;\n      }),\n    );\n  }\n\n  async addAccount(userId: UserId, accountData: AccountInfo): Promise<void> {\n    if (!Utils.isGuid(userId)) {\n      throw new Error(\"userId is required\");\n    }\n\n    await this.accountsState.update((accounts) => {\n      accounts ||= {};\n      accounts[userId] = accountData;\n      return accounts;\n    });\n    await this.setAccountActivity(userId, new Date());\n  }\n\n  async setAccountName(userId: UserId, name: string): Promise<void> {\n    await this.setAccountInfo(userId, { name });\n  }\n\n  async setAccountEmail(userId: UserId, email: string): Promise<void> {\n    await this.setAccountInfo(userId, { email });\n  }\n\n  async setAccountEmailVerified(userId: UserId, emailVerified: boolean): Promise<void> {\n    await this.setAccountInfo(userId, { emailVerified });\n  }\n\n  async clean(userId: UserId) {\n    await this.setAccountInfo(userId, LOGGED_OUT_INFO);\n    await this.removeAccountActivity(userId);\n  }\n\n  async switchAccount(userId: UserId): Promise<void> {\n    let updateActivity = false;\n    await this.activeAccountIdState.update(\n      (_, accounts) => {\n        if (userId == null) {\n          // indicates no account is active\n          return null;\n        }\n\n        if (accounts?.[userId] == null) {\n          throw new Error(\"Account does not exist\");\n        }\n        updateActivity = true;\n        return userId;\n      },\n      {\n        combineLatestWith: this.accounts$,\n        shouldUpdate: (id) => {\n          // update only if userId changes\n          return id !== userId;\n        },\n      },\n    );\n\n    if (updateActivity) {\n      await this.setAccountActivity(userId, new Date());\n    }\n  }\n\n  async setAccountActivity(userId: UserId, lastActivity: Date): Promise<void> {\n    if (!Utils.isGuid(userId)) {\n      // only store for valid userIds\n      return;\n    }\n\n    await this.globalStateProvider.get(ACCOUNT_ACTIVITY).update(\n      (activity) => {\n        activity ||= {};\n        activity[userId] = lastActivity;\n        return activity;\n      },\n      {\n        shouldUpdate: (oldActivity) => oldActivity?.[userId]?.getTime() !== lastActivity?.getTime(),\n      },\n    );\n  }\n\n  async removeAccountActivity(userId: UserId): Promise<void> {\n    await this.globalStateProvider.get(ACCOUNT_ACTIVITY).update(\n      (activity) => {\n        if (activity == null) {\n          return activity;\n        }\n        delete activity[userId];\n        return activity;\n      },\n      { shouldUpdate: (oldActivity) => oldActivity?.[userId] != null },\n    );\n  }\n\n  // TODO: update to use our own account status settings. Requires inverting direction of state service accounts flow\n  async delete(): Promise<void> {\n    try {\n      this.messagingService?.send(\"logout\");\n    } catch (e) {\n      this.logService.error(e);\n      throw e;\n    }\n  }\n\n  private async setAccountInfo(userId: UserId, update: Partial<AccountInfo>): Promise<void> {\n    function newAccountInfo(oldAccountInfo: AccountInfo): AccountInfo {\n      return { ...oldAccountInfo, ...update };\n    }\n    await this.accountsState.update(\n      (accounts) => {\n        accounts[userId] = newAccountInfo(accounts[userId]);\n        return accounts;\n      },\n      {\n        // Avoid unnecessary updates\n        // TODO: Faster comparison, maybe include a hash on the objects?\n        shouldUpdate: (accounts) => {\n          if (accounts?.[userId] == null) {\n            throw new Error(\"Account does not exist\");\n          }\n\n          return !accountInfoEqual(accounts[userId], newAccountInfo(accounts[userId]));\n        },\n      },\n    );\n  }\n}\n","import {\n  Observable,\n  combineLatest,\n  distinctUntilChanged,\n  firstValueFrom,\n  map,\n  of,\n  shareReplay,\n  switchMap,\n} from \"rxjs\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { MessageSender } from \"../../platform/messaging\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { UserId } from \"../../types/guid\";\nimport { AccountService } from \"../abstractions/account.service\";\nimport { AuthService as AuthServiceAbstraction } from \"../abstractions/auth.service\";\nimport { TokenService } from \"../abstractions/token.service\";\nimport { AuthenticationStatus } from \"../enums/authentication-status\";\n\nexport class AuthService implements AuthServiceAbstraction {\n  activeAccountStatus$: Observable<AuthenticationStatus>;\n  authStatuses$: Observable<Record<UserId, AuthenticationStatus>>;\n\n  constructor(\n    protected accountService: AccountService,\n    protected messageSender: MessageSender,\n    protected cryptoService: CryptoService,\n    protected apiService: ApiService,\n    protected stateService: StateService,\n    private tokenService: TokenService,\n  ) {\n    this.activeAccountStatus$ = this.accountService.activeAccount$.pipe(\n      map((account) => account?.id),\n      switchMap((userId) => {\n        return this.authStatusFor$(userId);\n      }),\n    );\n\n    this.authStatuses$ = this.accountService.accounts$.pipe(\n      map((accounts) => Object.keys(accounts) as UserId[]),\n      switchMap((entries) => {\n        if (entries.length === 0) {\n          return of([] as { userId: UserId; status: AuthenticationStatus }[]);\n        }\n        return combineLatest(\n          entries.map((userId) =>\n            this.authStatusFor$(userId).pipe(map((status) => ({ userId, status }))),\n          ),\n        );\n      }),\n      map((statuses) => {\n        return statuses.reduce(\n          (acc, { userId, status }) => {\n            acc[userId] = status;\n            return acc;\n          },\n          {} as Record<UserId, AuthenticationStatus>,\n        );\n      }),\n    );\n  }\n\n  authStatusFor$(userId: UserId): Observable<AuthenticationStatus> {\n    if (!Utils.isGuid(userId)) {\n      return of(AuthenticationStatus.LoggedOut);\n    }\n\n    return combineLatest([\n      this.cryptoService.getInMemoryUserKeyFor$(userId),\n      this.tokenService.hasAccessToken$(userId),\n    ]).pipe(\n      map(([userKey, hasAccessToken]) => {\n        if (!hasAccessToken) {\n          return AuthenticationStatus.LoggedOut;\n        }\n\n        if (!userKey) {\n          return AuthenticationStatus.Locked;\n        }\n\n        return AuthenticationStatus.Unlocked;\n      }),\n      distinctUntilChanged(),\n      shareReplay({ bufferSize: 1, refCount: false }),\n    );\n  }\n\n  async getAuthStatus(userId?: string): Promise<AuthenticationStatus> {\n    userId ??= await firstValueFrom(this.accountService.activeAccount$.pipe(map((a) => a?.id)));\n    return await firstValueFrom(this.authStatusFor$(userId as UserId));\n  }\n\n  logOut(callback: () => void) {\n    callback();\n    this.messageSender.send(\"loggedOut\");\n  }\n}\n","export class UpdateAvatarRequest {\n  avatarColor: string;\n\n  constructor(avatarColor: string) {\n    this.avatarColor = avatarColor;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { UpdateAvatarRequest } from \"../../models/request/update-avatar.request\";\nimport { AVATAR_DISK, StateProvider, UserKeyDefinition } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { AvatarService as AvatarServiceAbstraction } from \"../abstractions/avatar.service\";\n\nconst AVATAR_COLOR = new UserKeyDefinition<string>(AVATAR_DISK, \"avatarColor\", {\n  deserializer: (value) => value,\n  clearOn: [],\n});\n\nexport class AvatarService implements AvatarServiceAbstraction {\n  avatarColor$: Observable<string>;\n\n  constructor(\n    private apiService: ApiService,\n    private stateProvider: StateProvider,\n  ) {\n    this.avatarColor$ = this.stateProvider.getActive(AVATAR_COLOR).state$;\n  }\n\n  async setAvatarColor(color: string): Promise<void> {\n    const { avatarColor } = await this.apiService.putAvatar(new UpdateAvatarRequest(color));\n\n    await this.stateProvider.setUserState(AVATAR_COLOR, avatarColor);\n  }\n\n  async setSyncAvatarColor(userId: UserId, color: string): Promise<void> {\n    await this.stateProvider.getUser(userId, AVATAR_COLOR).update(() => color);\n  }\n\n  getUserAvatarColor$(userId: UserId): Observable<string | null> {\n    return this.stateProvider.getUser(userId, AVATAR_COLOR).state$;\n  }\n}\n","export class SecretVerificationRequest {\n  masterPasswordHash: string;\n  otp: string;\n  authRequestAccessCode: string;\n}\n","import { SecretVerificationRequest } from \"./secret-verification.request\";\n\nexport class UpdateDevicesTrustRequest extends SecretVerificationRequest {\n  currentDevice: DeviceKeysUpdateRequest;\n  otherDevices: OtherDeviceKeysUpdateRequest[];\n}\n\nexport class DeviceKeysUpdateRequest {\n  encryptedPublicKey: string;\n  encryptedUserKey: string;\n}\n\nexport class OtherDeviceKeysUpdateRequest extends DeviceKeysUpdateRequest {\n  id: string;\n}\n","import { firstValueFrom, map, Observable } from \"rxjs\";\n\nimport { UserDecryptionOptionsServiceAbstraction } from \"@bitwarden/auth/common\";\n\nimport { AppIdService } from \"../../platform/abstractions/app-id.service\";\nimport { CryptoFunctionService } from \"../../platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { KeyGenerationService } from \"../../platform/abstractions/key-generation.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"../../platform/abstractions/platform-utils.service\";\nimport { AbstractStorageService } from \"../../platform/abstractions/storage.service\";\nimport { StorageLocation } from \"../../platform/enums\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { StorageOptions } from \"../../platform/models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { DEVICE_TRUST_DISK_LOCAL, StateProvider, UserKeyDefinition } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { UserKey, DeviceKey } from \"../../types/key\";\nimport { DeviceTrustServiceAbstraction } from \"../abstractions/device-trust.service.abstraction\";\nimport { DeviceResponse } from \"../abstractions/devices/responses/device.response\";\nimport { DevicesApiServiceAbstraction } from \"../abstractions/devices-api.service.abstraction\";\nimport { SecretVerificationRequest } from \"../models/request/secret-verification.request\";\nimport {\n  DeviceKeysUpdateRequest,\n  UpdateDevicesTrustRequest,\n} from \"../models/request/update-devices-trust.request\";\n\n/** Uses disk storage so that the device key can persist after log out and tab removal. */\nexport const DEVICE_KEY = new UserKeyDefinition<DeviceKey>(DEVICE_TRUST_DISK_LOCAL, \"deviceKey\", {\n  deserializer: (deviceKey) => SymmetricCryptoKey.fromJSON(deviceKey) as DeviceKey,\n  clearOn: [], // Device key is needed to log back into device, so we can't clear it automatically during lock or logout\n});\n\n/** Uses disk storage so that the shouldTrustDevice bool can persist across login. */\nexport const SHOULD_TRUST_DEVICE = new UserKeyDefinition<boolean>(\n  DEVICE_TRUST_DISK_LOCAL,\n  \"shouldTrustDevice\",\n  {\n    deserializer: (shouldTrustDevice) => shouldTrustDevice,\n    clearOn: [], // Need to preserve the user setting, so we can't clear it automatically during lock or logout\n  },\n);\n\nexport class DeviceTrustService implements DeviceTrustServiceAbstraction {\n  private readonly platformSupportsSecureStorage =\n    this.platformUtilsService.supportsSecureStorage();\n  private readonly deviceKeySecureStorageKey: string = \"_deviceKey\";\n\n  supportsDeviceTrust$: Observable<boolean>;\n\n  constructor(\n    private keyGenerationService: KeyGenerationService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private cryptoService: CryptoService,\n    private encryptService: EncryptService,\n    private appIdService: AppIdService,\n    private devicesApiService: DevicesApiServiceAbstraction,\n    private i18nService: I18nService,\n    private platformUtilsService: PlatformUtilsService,\n    private stateProvider: StateProvider,\n    private secureStorageService: AbstractStorageService,\n    private userDecryptionOptionsService: UserDecryptionOptionsServiceAbstraction,\n    private logService: LogService,\n  ) {\n    this.supportsDeviceTrust$ = this.userDecryptionOptionsService.userDecryptionOptions$.pipe(\n      map((options) => options?.trustedDeviceOption != null ?? false),\n    );\n  }\n\n  /**\n   * @description Retrieves the users choice to trust the device which can only happen after decryption\n   * Note: this value should only be used once and then reset\n   */\n  async getShouldTrustDevice(userId: UserId): Promise<boolean> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot get should trust device.\");\n    }\n\n    const shouldTrustDevice = await firstValueFrom(\n      this.stateProvider.getUserState$(SHOULD_TRUST_DEVICE, userId),\n    );\n\n    return shouldTrustDevice;\n  }\n\n  async setShouldTrustDevice(userId: UserId, value: boolean): Promise<void> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot set should trust device.\");\n    }\n\n    await this.stateProvider.setUserState(SHOULD_TRUST_DEVICE, value, userId);\n  }\n\n  async trustDeviceIfRequired(userId: UserId): Promise<void> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot trust device if required.\");\n    }\n\n    const shouldTrustDevice = await this.getShouldTrustDevice(userId);\n    if (shouldTrustDevice) {\n      await this.trustDevice(userId);\n      // reset the trust choice\n      await this.setShouldTrustDevice(userId, false);\n    }\n  }\n\n  async trustDevice(userId: UserId): Promise<DeviceResponse> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot trust device.\");\n    }\n\n    // Attempt to get user key\n    const userKey: UserKey = await this.cryptoService.getUserKey(userId);\n\n    // If user key is not found, throw error\n    if (!userKey) {\n      throw new Error(\"User symmetric key not found\");\n    }\n\n    // Generate deviceKey\n    const deviceKey = await this.makeDeviceKey();\n\n    // Generate asymmetric RSA key pair: devicePrivateKey, devicePublicKey\n    const [devicePublicKey, devicePrivateKey] =\n      await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n\n    const [\n      devicePublicKeyEncryptedUserKey,\n      userKeyEncryptedDevicePublicKey,\n      deviceKeyEncryptedDevicePrivateKey,\n    ] = await Promise.all([\n      // Encrypt user key with the DevicePublicKey\n      this.cryptoService.rsaEncrypt(userKey.key, devicePublicKey),\n\n      // Encrypt devicePublicKey with user key\n      this.encryptService.encrypt(devicePublicKey, userKey),\n\n      // Encrypt devicePrivateKey with deviceKey\n      this.encryptService.encrypt(devicePrivateKey, deviceKey),\n    ]);\n\n    // Send encrypted keys to server\n    const deviceIdentifier = await this.appIdService.getAppId();\n    const deviceResponse = await this.devicesApiService.updateTrustedDeviceKeys(\n      deviceIdentifier,\n      devicePublicKeyEncryptedUserKey.encryptedString,\n      userKeyEncryptedDevicePublicKey.encryptedString,\n      deviceKeyEncryptedDevicePrivateKey.encryptedString,\n    );\n\n    // store device key in local/secure storage if enc keys posted to server successfully\n    await this.setDeviceKey(userId, deviceKey);\n\n    this.platformUtilsService.showToast(\"success\", null, this.i18nService.t(\"deviceTrusted\"));\n\n    return deviceResponse;\n  }\n\n  async rotateDevicesTrust(\n    userId: UserId,\n    newUserKey: UserKey,\n    masterPasswordHash: string,\n  ): Promise<void> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot rotate device's trust.\");\n    }\n\n    const currentDeviceKey = await this.getDeviceKey(userId);\n    if (currentDeviceKey == null) {\n      // If the current device doesn't have a device key available to it, then we can't\n      // rotate any trust at all, so early return.\n      return;\n    }\n\n    // At this point of rotating their keys, they should still have their old user key in state\n    const oldUserKey = await firstValueFrom(this.cryptoService.userKey$(userId));\n\n    const deviceIdentifier = await this.appIdService.getAppId();\n    const secretVerificationRequest = new SecretVerificationRequest();\n    secretVerificationRequest.masterPasswordHash = masterPasswordHash;\n\n    // Get the keys that are used in rotating a devices keys from the server\n    const currentDeviceKeys = await this.devicesApiService.getDeviceKeys(\n      deviceIdentifier,\n      secretVerificationRequest,\n    );\n\n    // Decrypt the existing device public key with the old user key\n    const decryptedDevicePublicKey = await this.encryptService.decryptToBytes(\n      currentDeviceKeys.encryptedPublicKey,\n      oldUserKey,\n    );\n\n    // Encrypt the brand new user key with the now-decrypted public key for the device\n    const encryptedNewUserKey = await this.cryptoService.rsaEncrypt(\n      newUserKey.key,\n      decryptedDevicePublicKey,\n    );\n\n    // Re-encrypt the device public key with the new user key\n    const encryptedDevicePublicKey = await this.encryptService.encrypt(\n      decryptedDevicePublicKey,\n      newUserKey,\n    );\n\n    const currentDeviceUpdateRequest = new DeviceKeysUpdateRequest();\n    currentDeviceUpdateRequest.encryptedUserKey = encryptedNewUserKey.encryptedString;\n    currentDeviceUpdateRequest.encryptedPublicKey = encryptedDevicePublicKey.encryptedString;\n\n    // TODO: For device management, allow this method to take an array of device ids that can be looped over and individually rotated\n    // then it can be added to trustRequest.otherDevices.\n\n    const trustRequest = new UpdateDevicesTrustRequest();\n    trustRequest.masterPasswordHash = masterPasswordHash;\n    trustRequest.currentDevice = currentDeviceUpdateRequest;\n    trustRequest.otherDevices = [];\n\n    await this.devicesApiService.updateTrust(trustRequest, deviceIdentifier);\n  }\n\n  async getDeviceKey(userId: UserId): Promise<DeviceKey | null> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot get device key.\");\n    }\n\n    try {\n      if (this.platformSupportsSecureStorage) {\n        const deviceKeyB64 = await this.secureStorageService.get<\n          ReturnType<SymmetricCryptoKey[\"toJSON\"]>\n        >(`${userId}${this.deviceKeySecureStorageKey}`, this.getSecureStorageOptions(userId));\n\n        const deviceKey = SymmetricCryptoKey.fromJSON(deviceKeyB64) as DeviceKey;\n\n        return deviceKey;\n      }\n\n      const deviceKey = await firstValueFrom(this.stateProvider.getUserState$(DEVICE_KEY, userId));\n\n      return deviceKey;\n    } catch (e) {\n      this.logService.error(\"Failed to get device key\", e);\n    }\n  }\n\n  private async setDeviceKey(userId: UserId, deviceKey: DeviceKey | null): Promise<void> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot set device key.\");\n    }\n\n    try {\n      if (this.platformSupportsSecureStorage) {\n        await this.secureStorageService.save<DeviceKey>(\n          `${userId}${this.deviceKeySecureStorageKey}`,\n          deviceKey,\n          this.getSecureStorageOptions(userId),\n        );\n        return;\n      }\n\n      await this.stateProvider.setUserState(DEVICE_KEY, deviceKey?.toJSON(), userId);\n    } catch (e) {\n      this.logService.error(\"Failed to set device key\", e);\n    }\n  }\n\n  private async makeDeviceKey(): Promise<DeviceKey> {\n    // Create 512-bit device key\n    const deviceKey = (await this.keyGenerationService.createKey(512)) as DeviceKey;\n\n    return deviceKey;\n  }\n\n  async decryptUserKeyWithDeviceKey(\n    userId: UserId,\n    encryptedDevicePrivateKey: EncString,\n    encryptedUserKey: EncString,\n    deviceKey: DeviceKey,\n  ): Promise<UserKey | null> {\n    if (!userId) {\n      throw new Error(\"UserId is required. Cannot decrypt user key with device key.\");\n    }\n\n    if (!deviceKey) {\n      // User doesn't have a device key anymore so device is untrusted\n      return null;\n    }\n\n    try {\n      // attempt to decrypt encryptedDevicePrivateKey with device key\n      const devicePrivateKey = await this.encryptService.decryptToBytes(\n        encryptedDevicePrivateKey,\n        deviceKey,\n      );\n\n      // Attempt to decrypt encryptedUserDataKey with devicePrivateKey\n      const userKey = await this.cryptoService.rsaDecrypt(\n        encryptedUserKey.encryptedString,\n        devicePrivateKey,\n      );\n\n      return new SymmetricCryptoKey(userKey) as UserKey;\n    } catch (e) {\n      // If either decryption effort fails, we want to remove the device key\n      this.logService.error(\"Failed to decrypt using device key. Removing device key.\");\n      await this.setDeviceKey(userId, null);\n\n      return null;\n    }\n  }\n\n  private getSecureStorageOptions(userId: UserId): StorageOptions {\n    return {\n      storageLocation: StorageLocation.Disk,\n      useSecureStorage: true,\n      userId: userId,\n    };\n  }\n}\n","import { DeviceType } from \"../../../../enums\";\nimport { View } from \"../../../../models/view/view\";\nimport { DeviceResponse } from \"../responses/device.response\";\n\nexport class DeviceView implements View {\n  id: string;\n  userId: string;\n  name: string;\n  identifier: string;\n  type: DeviceType;\n  creationDate: string;\n  revisionDate: string;\n\n  constructor(deviceResponse: DeviceResponse) {\n    Object.assign(this, deviceResponse);\n  }\n}\n","import { Observable, defer, map } from \"rxjs\";\n\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { DevicesServiceAbstraction } from \"../../abstractions/devices/devices.service.abstraction\";\nimport { DeviceResponse } from \"../../abstractions/devices/responses/device.response\";\nimport { DeviceView } from \"../../abstractions/devices/views/device.view\";\nimport { DevicesApiServiceAbstraction } from \"../../abstractions/devices-api.service.abstraction\";\n\n/**\n * @class DevicesServiceImplementation\n * @implements {DevicesServiceAbstraction}\n * @description Observable based data store service for Devices.\n * note: defer is used to convert the promises to observables and to ensure\n * that observables are created for each subscription\n * (i.e., promsise --> observables are cold until subscribed to)\n */\nexport class DevicesServiceImplementation implements DevicesServiceAbstraction {\n  constructor(private devicesApiService: DevicesApiServiceAbstraction) {}\n\n  /**\n   * @description Gets the list of all devices.\n   */\n  getDevices$(): Observable<Array<DeviceView>> {\n    return defer(() => this.devicesApiService.getDevices()).pipe(\n      map((deviceResponses: ListResponse<DeviceResponse>) => {\n        return deviceResponses.data.map((deviceResponse: DeviceResponse) => {\n          return new DeviceView(deviceResponse);\n        });\n      }),\n    );\n  }\n\n  /**\n   * @description Gets the device with the specified identifier.\n   */\n  getDeviceByIdentifier$(deviceIdentifier: string): Observable<DeviceView> {\n    return defer(() => this.devicesApiService.getDeviceByIdentifier(deviceIdentifier)).pipe(\n      map((deviceResponse: DeviceResponse) => new DeviceView(deviceResponse)),\n    );\n  }\n\n  /**\n   * @description Checks if a device is known for a user by user's email and device's identifier.\n   */\n  isDeviceKnownForUser$(email: string, deviceIdentifier: string): Observable<boolean> {\n    return defer(() => this.devicesApiService.getKnownDevice(email, deviceIdentifier));\n  }\n\n  /**\n   * @description Updates the keys for the specified device.\n   */\n\n  updateTrustedDeviceKeys$(\n    deviceIdentifier: string,\n    devicePublicKeyEncryptedUserKey: string,\n    userKeyEncryptedDevicePublicKey: string,\n    deviceKeyEncryptedDevicePrivateKey: string,\n  ): Observable<DeviceView> {\n    return defer(() =>\n      this.devicesApiService.updateTrustedDeviceKeys(\n        deviceIdentifier,\n        devicePublicKeyEncryptedUserKey,\n        userKeyEncryptedDevicePublicKey,\n        deviceKeyEncryptedDevicePrivateKey,\n      ),\n    ).pipe(map((deviceResponse: DeviceResponse) => new DeviceView(deviceResponse)));\n  }\n}\n","import { DeviceType } from \"../../../../enums\";\nimport { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class DeviceResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  name: string;\n  identifier: string;\n  type: DeviceType;\n  creationDate: string;\n  revisionDate: string;\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.identifier = this.getResponseProperty(\"Identifier\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { DeviceType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\n\nexport class ProtectedDeviceResponse extends BaseResponse {\n  constructor(response: Jsonify<ProtectedDeviceResponse>) {\n    super(response);\n    this.id = this.getResponseProperty(\"id\");\n    this.name = this.getResponseProperty(\"name\");\n    this.identifier = this.getResponseProperty(\"identifier\");\n    this.type = this.getResponseProperty(\"type\");\n    this.creationDate = new Date(this.getResponseProperty(\"creationDate\"));\n    if (response.encryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"encryptedUserKey\"));\n    }\n    if (response.encryptedPublicKey) {\n      this.encryptedPublicKey = new EncString(this.getResponseProperty(\"encryptedPublicKey\"));\n    }\n  }\n\n  id: string;\n  name: string;\n  type: DeviceType;\n  identifier: string;\n  creationDate: Date;\n  /**\n   * Intended to be the users symmetric key that is encrypted in some form, the current way to encrypt this is with\n   * the devices public key.\n   */\n  encryptedUserKey: EncString;\n  /**\n   * Intended to be the public key that was generated for a device upon trust and encrypted. Currenly encrypted using\n   * a users symmetric key so that when trusted and unlocked a user can decrypt the public key for all their devices.\n   * This enabled a user to rotate the keys for all of their devices.\n   */\n  encryptedPublicKey: EncString;\n}\n","export class TrustedDeviceKeysRequest {\n  constructor(\n    public encryptedUserKey: string,\n    public encryptedPublicKey: string,\n    public encryptedPrivateKey: string,\n  ) {}\n}\n","import { ApiService } from \"../../abstractions/api.service\";\nimport { ListResponse } from \"../../models/response/list.response\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { DeviceResponse } from \"../abstractions/devices/responses/device.response\";\nimport { DevicesApiServiceAbstraction } from \"../abstractions/devices-api.service.abstraction\";\nimport { SecretVerificationRequest } from \"../models/request/secret-verification.request\";\nimport { UpdateDevicesTrustRequest } from \"../models/request/update-devices-trust.request\";\nimport { ProtectedDeviceResponse } from \"../models/response/protected-device.response\";\n\nimport { TrustedDeviceKeysRequest } from \"./devices/requests/trusted-device-keys.request\";\n\nexport class DevicesApiServiceImplementation implements DevicesApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  async getKnownDevice(email: string, deviceIdentifier: string): Promise<boolean> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/devices/knowndevice\",\n      null,\n      false,\n      true,\n      null,\n      (headers) => {\n        headers.set(\"X-Device-Identifier\", deviceIdentifier);\n        headers.set(\"X-Request-Email\", Utils.fromUtf8ToUrlB64(email));\n      },\n    );\n    return r as boolean;\n  }\n\n  /**\n   * Get device by identifier\n   * @param deviceIdentifier - client generated id (not device id in DB)\n   */\n  async getDeviceByIdentifier(deviceIdentifier: string): Promise<DeviceResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      `/devices/identifier/${deviceIdentifier}`,\n      null,\n      true,\n      true,\n    );\n    return new DeviceResponse(r);\n  }\n\n  async getDevices(): Promise<ListResponse<DeviceResponse>> {\n    const r = await this.apiService.send(\"GET\", \"/devices\", null, true, true, null);\n    return new ListResponse(r, DeviceResponse);\n  }\n\n  async updateTrustedDeviceKeys(\n    deviceIdentifier: string,\n    devicePublicKeyEncryptedUserKey: string,\n    userKeyEncryptedDevicePublicKey: string,\n    deviceKeyEncryptedDevicePrivateKey: string,\n  ): Promise<DeviceResponse> {\n    const request = new TrustedDeviceKeysRequest(\n      devicePublicKeyEncryptedUserKey,\n      userKeyEncryptedDevicePublicKey,\n      deviceKeyEncryptedDevicePrivateKey,\n    );\n\n    const result = await this.apiService.send(\n      \"PUT\",\n      `/devices/${deviceIdentifier}/keys`,\n      request,\n      true,\n      true,\n    );\n\n    return new DeviceResponse(result);\n  }\n\n  async updateTrust(\n    updateDevicesTrustRequestModel: UpdateDevicesTrustRequest,\n    deviceIdentifier: string,\n  ): Promise<void> {\n    await this.apiService.send(\n      \"POST\",\n      \"/devices/update-trust\",\n      updateDevicesTrustRequestModel,\n      true,\n      false,\n      null,\n      (headers) => {\n        headers.set(\"Device-Identifier\", deviceIdentifier);\n      },\n    );\n  }\n\n  async getDeviceKeys(\n    deviceIdentifier: string,\n    secretVerificationRequest: SecretVerificationRequest,\n  ): Promise<ProtectedDeviceResponse> {\n    const result = await this.apiService.send(\n      \"POST\",\n      `/devices/${deviceIdentifier}/retrieve-keys`,\n      secretVerificationRequest,\n      true,\n      true,\n    );\n    return new ProtectedDeviceResponse(result);\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { KdfType } from \"../../platform/enums/kdf-type.enum\";\nimport { KDF_CONFIG_DISK, StateProvider, UserKeyDefinition } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { KdfConfigService as KdfConfigServiceAbstraction } from \"../abstractions/kdf-config.service\";\nimport { Argon2KdfConfig, KdfConfig, PBKDF2KdfConfig } from \"../models/domain/kdf-config\";\n\nexport const KDF_CONFIG = new UserKeyDefinition<KdfConfig>(KDF_CONFIG_DISK, \"kdfConfig\", {\n  deserializer: (kdfConfig: KdfConfig) => {\n    if (kdfConfig == null) {\n      return null;\n    }\n    return kdfConfig.kdfType === KdfType.PBKDF2_SHA256\n      ? PBKDF2KdfConfig.fromJSON(kdfConfig)\n      : Argon2KdfConfig.fromJSON(kdfConfig);\n  },\n  clearOn: [\"logout\"],\n});\n\nexport class KdfConfigService implements KdfConfigServiceAbstraction {\n  constructor(private stateProvider: StateProvider) {}\n  async setKdfConfig(userId: UserId, kdfConfig: KdfConfig) {\n    if (!userId) {\n      throw new Error(\"userId cannot be null\");\n    }\n    if (kdfConfig === null) {\n      throw new Error(\"kdfConfig cannot be null\");\n    }\n    await this.stateProvider.setUserState(KDF_CONFIG, kdfConfig, userId);\n  }\n\n  async getKdfConfig(): Promise<KdfConfig> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    const state = await firstValueFrom(this.stateProvider.getUser(userId, KDF_CONFIG).state$);\n    if (state === null) {\n      throw new Error(\"KdfConfig for active user account state is null\");\n    }\n    return state;\n  }\n}\n","export class KeysRequest {\n  publicKey: string;\n  encryptedPrivateKey: string;\n\n  constructor(publicKey: string, encryptedPrivateKey: string) {\n    this.publicKey = publicKey;\n    this.encryptedPrivateKey = encryptedPrivateKey;\n  }\n}\n","export class KeyConnectorUserKeyRequest {\n  key: string;\n\n  constructor(key: string) {\n    this.key = key;\n  }\n}\n","import { KeysRequest } from \"../../../models/request/keys.request\";\nimport { KdfType } from \"../../../platform/enums\";\nimport { KdfConfig } from \"../domain/kdf-config\";\n\nexport class SetKeyConnectorKeyRequest {\n  key: string;\n  keys: KeysRequest;\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  orgIdentifier: string;\n\n  constructor(key: string, kdfConfig: KdfConfig, orgIdentifier: string, keys: KeysRequest) {\n    this.key = key;\n    this.kdf = kdfConfig.kdfType;\n    this.kdfIterations = kdfConfig.iterations;\n    if (kdfConfig.kdfType === KdfType.Argon2id) {\n      this.kdfMemory = kdfConfig.memory;\n      this.kdfParallelism = kdfConfig.parallelism;\n    }\n    this.orgIdentifier = orgIdentifier;\n    this.keys = keys;\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { LogoutReason } from \"@bitwarden/auth/common\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { OrganizationService } from \"../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { OrganizationUserType } from \"../../admin-console/enums\";\nimport { KeysRequest } from \"../../models/request/keys.request\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { KeyGenerationService } from \"../../platform/abstractions/key-generation.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { KdfType } from \"../../platform/enums/kdf-type.enum\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport {\n  ActiveUserState,\n  KEY_CONNECTOR_DISK,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { MasterKey } from \"../../types/key\";\nimport { AccountService } from \"../abstractions/account.service\";\nimport { KeyConnectorService as KeyConnectorServiceAbstraction } from \"../abstractions/key-connector.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../abstractions/master-password.service.abstraction\";\nimport { TokenService } from \"../abstractions/token.service\";\nimport { Argon2KdfConfig, KdfConfig, PBKDF2KdfConfig } from \"../models/domain/kdf-config\";\nimport { KeyConnectorUserKeyRequest } from \"../models/request/key-connector-user-key.request\";\nimport { SetKeyConnectorKeyRequest } from \"../models/request/set-key-connector-key.request\";\nimport { IdentityTokenResponse } from \"../models/response/identity-token.response\";\n\nexport const USES_KEY_CONNECTOR = new UserKeyDefinition<boolean>(\n  KEY_CONNECTOR_DISK,\n  \"usesKeyConnector\",\n  {\n    deserializer: (usesKeyConnector) => usesKeyConnector,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const CONVERT_ACCOUNT_TO_KEY_CONNECTOR = new UserKeyDefinition<boolean>(\n  KEY_CONNECTOR_DISK,\n  \"convertAccountToKeyConnector\",\n  {\n    deserializer: (convertAccountToKeyConnector) => convertAccountToKeyConnector,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport class KeyConnectorService implements KeyConnectorServiceAbstraction {\n  private usesKeyConnectorState: ActiveUserState<boolean>;\n  private convertAccountToKeyConnectorState: ActiveUserState<boolean>;\n  constructor(\n    private accountService: AccountService,\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    private cryptoService: CryptoService,\n    private apiService: ApiService,\n    private tokenService: TokenService,\n    private logService: LogService,\n    private organizationService: OrganizationService,\n    private keyGenerationService: KeyGenerationService,\n    private logoutCallback: (logoutReason: LogoutReason, userId?: string) => Promise<void>,\n    private stateProvider: StateProvider,\n  ) {\n    this.usesKeyConnectorState = this.stateProvider.getActive(USES_KEY_CONNECTOR);\n    this.convertAccountToKeyConnectorState = this.stateProvider.getActive(\n      CONVERT_ACCOUNT_TO_KEY_CONNECTOR,\n    );\n  }\n\n  async setUsesKeyConnector(usesKeyConnector: boolean) {\n    await this.usesKeyConnectorState.update(() => usesKeyConnector);\n  }\n\n  getUsesKeyConnector(): Promise<boolean> {\n    return firstValueFrom(this.usesKeyConnectorState.state$);\n  }\n\n  async userNeedsMigration() {\n    const loggedInUsingSso = await this.tokenService.getIsExternal();\n    const requiredByOrganization = (await this.getManagingOrganization()) != null;\n    const userIsNotUsingKeyConnector = !(await this.getUsesKeyConnector());\n\n    return loggedInUsingSso && requiredByOrganization && userIsNotUsingKeyConnector;\n  }\n\n  async migrateUser() {\n    const organization = await this.getManagingOrganization();\n    const userId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    const keyConnectorRequest = new KeyConnectorUserKeyRequest(masterKey.encKeyB64);\n\n    try {\n      await this.apiService.postUserKeyToKeyConnector(\n        organization.keyConnectorUrl,\n        keyConnectorRequest,\n      );\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n\n    await this.apiService.postConvertToKeyConnector();\n  }\n\n  // TODO: UserKey should be renamed to MasterKey and typed accordingly\n  async setMasterKeyFromUrl(url: string, userId: UserId) {\n    try {\n      const masterKeyResponse = await this.apiService.getMasterKeyFromKeyConnector(url);\n      const keyArr = Utils.fromB64ToArray(masterKeyResponse.key);\n      const masterKey = new SymmetricCryptoKey(keyArr) as MasterKey;\n      await this.masterPasswordService.setMasterKey(masterKey, userId);\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n  }\n\n  async getManagingOrganization() {\n    const orgs = await this.organizationService.getAll();\n    return orgs.find(\n      (o) =>\n        o.keyConnectorEnabled &&\n        o.type !== OrganizationUserType.Admin &&\n        o.type !== OrganizationUserType.Owner &&\n        !o.isProviderUser,\n    );\n  }\n\n  async convertNewSsoUserToKeyConnector(\n    tokenResponse: IdentityTokenResponse,\n    orgId: string,\n    userId: UserId,\n  ) {\n    // TODO: Remove after tokenResponse.keyConnectorUrl is deprecated in 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n    const {\n      kdf,\n      kdfIterations,\n      kdfMemory,\n      kdfParallelism,\n      keyConnectorUrl: legacyKeyConnectorUrl,\n      userDecryptionOptions,\n    } = tokenResponse;\n    const password = await this.keyGenerationService.createKey(512);\n    const kdfConfig: KdfConfig =\n      kdf === KdfType.PBKDF2_SHA256\n        ? new PBKDF2KdfConfig(kdfIterations)\n        : new Argon2KdfConfig(kdfIterations, kdfMemory, kdfParallelism);\n\n    const masterKey = await this.cryptoService.makeMasterKey(\n      password.keyB64,\n      await this.tokenService.getEmail(),\n      kdfConfig,\n    );\n    const keyConnectorRequest = new KeyConnectorUserKeyRequest(masterKey.encKeyB64);\n    await this.masterPasswordService.setMasterKey(masterKey, userId);\n\n    const userKey = await this.cryptoService.makeUserKey(masterKey);\n    await this.cryptoService.setUserKey(userKey[0], userId);\n    await this.cryptoService.setMasterKeyEncryptedUserKey(userKey[1].encryptedString, userId);\n\n    const [pubKey, privKey] = await this.cryptoService.makeKeyPair(userKey[0]);\n\n    try {\n      const keyConnectorUrl =\n        legacyKeyConnectorUrl ?? userDecryptionOptions?.keyConnectorOption?.keyConnectorUrl;\n      await this.apiService.postUserKeyToKeyConnector(keyConnectorUrl, keyConnectorRequest);\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n\n    const keys = new KeysRequest(pubKey, privKey.encryptedString);\n    const setPasswordRequest = new SetKeyConnectorKeyRequest(\n      userKey[1].encryptedString,\n      kdfConfig,\n      orgId,\n      keys,\n    );\n    await this.apiService.postSetKeyConnectorKey(setPasswordRequest);\n  }\n\n  async setConvertAccountRequired(status: boolean) {\n    await this.convertAccountToKeyConnectorState.update(() => status);\n  }\n\n  getConvertAccountRequired(): Promise<boolean> {\n    return firstValueFrom(this.convertAccountToKeyConnectorState.state$);\n  }\n\n  async removeConvertAccountRequired() {\n    await this.setConvertAccountRequired(null);\n  }\n\n  private handleKeyConnectorError(e: any) {\n    this.logService.error(e);\n    if (this.logoutCallback != null) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.logoutCallback(\"keyConnectorError\");\n    }\n    throw new Error(\"Key Connector error\");\n  }\n}\n","import { firstValueFrom, map, Observable } from \"rxjs\";\n\nimport { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"../../../platform/abstractions/key-generation.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { EncryptionType } from \"../../../platform/enums\";\nimport { EncryptedString, EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport {\n  MASTER_PASSWORD_DISK,\n  MASTER_PASSWORD_MEMORY,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { MasterKey, UserKey } from \"../../../types/key\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../../abstractions/master-password.service.abstraction\";\nimport { ForceSetPasswordReason } from \"../../models/domain/force-set-password-reason\";\n\n/** Memory since master key shouldn't be available on lock */\nconst MASTER_KEY = new UserKeyDefinition<MasterKey>(MASTER_PASSWORD_MEMORY, \"masterKey\", {\n  deserializer: (masterKey) => SymmetricCryptoKey.fromJSON(masterKey) as MasterKey,\n  clearOn: [\"lock\", \"logout\"],\n});\n\n/** Disk since master key hash is used for unlock */\nconst MASTER_KEY_HASH = new UserKeyDefinition<string>(MASTER_PASSWORD_DISK, \"masterKeyHash\", {\n  deserializer: (masterKeyHash) => masterKeyHash,\n  clearOn: [\"logout\"],\n});\n\n/** Disk to persist through lock */\nconst MASTER_KEY_ENCRYPTED_USER_KEY = new UserKeyDefinition<EncryptedString>(\n  MASTER_PASSWORD_DISK,\n  \"masterKeyEncryptedUserKey\",\n  {\n    deserializer: (key) => key,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** Disk to persist through lock and account switches */\nconst FORCE_SET_PASSWORD_REASON = new UserKeyDefinition<ForceSetPasswordReason>(\n  MASTER_PASSWORD_DISK,\n  \"forceSetPasswordReason\",\n  {\n    deserializer: (reason) => reason,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport class MasterPasswordService implements InternalMasterPasswordServiceAbstraction {\n  constructor(\n    private stateProvider: StateProvider,\n    private stateService: StateService,\n    private keyGenerationService: KeyGenerationService,\n    private encryptService: EncryptService,\n  ) {}\n\n  masterKey$(userId: UserId): Observable<MasterKey> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    return this.stateProvider.getUser(userId, MASTER_KEY).state$;\n  }\n\n  masterKeyHash$(userId: UserId): Observable<string> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    return this.stateProvider.getUser(userId, MASTER_KEY_HASH).state$;\n  }\n\n  forceSetPasswordReason$(userId: UserId): Observable<ForceSetPasswordReason> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    return this.stateProvider\n      .getUser(userId, FORCE_SET_PASSWORD_REASON)\n      .state$.pipe(map((reason) => reason ?? ForceSetPasswordReason.None));\n  }\n\n  // TODO: Remove this method and decrypt directly in the service instead\n  async getMasterKeyEncryptedUserKey(userId: UserId): Promise<EncString> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    const key = await firstValueFrom(\n      this.stateProvider.getUser(userId, MASTER_KEY_ENCRYPTED_USER_KEY).state$,\n    );\n    return EncString.fromJSON(key);\n  }\n\n  async setMasterKey(masterKey: MasterKey, userId: UserId): Promise<void> {\n    if (masterKey == null) {\n      throw new Error(\"Master key is required.\");\n    }\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider.getUser(userId, MASTER_KEY).update((_) => masterKey);\n  }\n\n  async clearMasterKey(userId: UserId): Promise<void> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider.getUser(userId, MASTER_KEY).update((_) => null);\n  }\n\n  async setMasterKeyHash(masterKeyHash: string, userId: UserId): Promise<void> {\n    if (masterKeyHash == null) {\n      throw new Error(\"Master key hash is required.\");\n    }\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider.getUser(userId, MASTER_KEY_HASH).update((_) => masterKeyHash);\n  }\n\n  async clearMasterKeyHash(userId: UserId): Promise<void> {\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider.getUser(userId, MASTER_KEY_HASH).update((_) => null);\n  }\n\n  async setMasterKeyEncryptedUserKey(encryptedKey: EncString, userId: UserId): Promise<void> {\n    if (encryptedKey == null) {\n      throw new Error(\"Encrypted Key is required.\");\n    }\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider\n      .getUser(userId, MASTER_KEY_ENCRYPTED_USER_KEY)\n      .update((_) => encryptedKey.toJSON() as EncryptedString);\n  }\n\n  async setForceSetPasswordReason(reason: ForceSetPasswordReason, userId: UserId): Promise<void> {\n    if (reason == null) {\n      throw new Error(\"Reason is required.\");\n    }\n    if (userId == null) {\n      throw new Error(\"User ID is required.\");\n    }\n    await this.stateProvider.getUser(userId, FORCE_SET_PASSWORD_REASON).update((_) => reason);\n  }\n\n  async decryptUserKeyWithMasterKey(\n    masterKey: MasterKey,\n    userKey?: EncString,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    userKey ??= await this.getMasterKeyEncryptedUserKey(userId);\n    masterKey ??= await firstValueFrom(this.masterKey$(userId));\n\n    if (masterKey == null) {\n      throw new Error(\"No master key found.\");\n    }\n\n    // Try one more way to get the user key if it still wasn't found.\n    if (userKey == null) {\n      const deprecatedKey = await this.stateService.getEncryptedCryptoSymmetricKey({\n        userId: userId,\n      });\n\n      if (deprecatedKey == null) {\n        throw new Error(\"No encrypted user key found.\");\n      }\n\n      userKey = new EncString(deprecatedKey);\n    }\n\n    let decUserKey: Uint8Array;\n\n    if (userKey.encryptionType === EncryptionType.AesCbc256_B64) {\n      decUserKey = await this.encryptService.decryptToBytes(userKey, masterKey);\n    } else if (userKey.encryptionType === EncryptionType.AesCbc256_HmacSha256_B64) {\n      const newKey = await this.keyGenerationService.stretchKey(masterKey);\n      decUserKey = await this.encryptService.decryptToBytes(userKey, newKey);\n    } else {\n      throw new Error(\"Unsupported encryption type.\");\n    }\n\n    if (decUserKey == null) {\n      return null;\n    }\n\n    return new SymmetricCryptoKey(decUserKey) as UserKey;\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport {\n  ActiveUserState,\n  GlobalState,\n  KeyDefinition,\n  SSO_DISK,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\nimport { SsoLoginServiceAbstraction } from \"../abstractions/sso-login.service.abstraction\";\n\n/**\n * Uses disk storage so that the code verifier can be persisted across sso redirects.\n */\nconst CODE_VERIFIER = new KeyDefinition<string>(SSO_DISK, \"ssoCodeVerifier\", {\n  deserializer: (codeVerifier) => codeVerifier,\n});\n\n/**\n * Uses disk storage so that the sso state can be persisted across sso redirects.\n */\nconst SSO_STATE = new KeyDefinition<string>(SSO_DISK, \"ssoState\", {\n  deserializer: (state) => state,\n});\n\n/**\n * Uses disk storage so that the organization sso identifier can be persisted across sso redirects.\n */\nconst USER_ORGANIZATION_SSO_IDENTIFIER = new UserKeyDefinition<string>(\n  SSO_DISK,\n  \"organizationSsoIdentifier\",\n  {\n    deserializer: (organizationIdentifier) => organizationIdentifier,\n    clearOn: [\"logout\"], // Used for login, so not needed past logout\n  },\n);\n\n/**\n * Uses disk storage so that the organization sso identifier can be persisted across sso redirects.\n */\nconst GLOBAL_ORGANIZATION_SSO_IDENTIFIER = new KeyDefinition<string>(\n  SSO_DISK,\n  \"organizationSsoIdentifier\",\n  {\n    deserializer: (organizationIdentifier) => organizationIdentifier,\n  },\n);\n\n/**\n * Uses disk storage so that the user's email can be persisted across sso redirects.\n */\nconst SSO_EMAIL = new KeyDefinition<string>(SSO_DISK, \"ssoEmail\", {\n  deserializer: (state) => state,\n});\n\nexport class SsoLoginService implements SsoLoginServiceAbstraction {\n  private codeVerifierState: GlobalState<string>;\n  private ssoState: GlobalState<string>;\n  private orgSsoIdentifierState: GlobalState<string>;\n  private ssoEmailState: GlobalState<string>;\n  private activeUserOrgSsoIdentifierState: ActiveUserState<string>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.codeVerifierState = this.stateProvider.getGlobal(CODE_VERIFIER);\n    this.ssoState = this.stateProvider.getGlobal(SSO_STATE);\n    this.orgSsoIdentifierState = this.stateProvider.getGlobal(GLOBAL_ORGANIZATION_SSO_IDENTIFIER);\n    this.ssoEmailState = this.stateProvider.getGlobal(SSO_EMAIL);\n    this.activeUserOrgSsoIdentifierState = this.stateProvider.getActive(\n      USER_ORGANIZATION_SSO_IDENTIFIER,\n    );\n  }\n\n  getCodeVerifier(): Promise<string> {\n    return firstValueFrom(this.codeVerifierState.state$);\n  }\n\n  async setCodeVerifier(codeVerifier: string): Promise<void> {\n    await this.codeVerifierState.update((_) => codeVerifier);\n  }\n\n  getSsoState(): Promise<string> {\n    return firstValueFrom(this.ssoState.state$);\n  }\n\n  async setSsoState(ssoState: string): Promise<void> {\n    await this.ssoState.update((_) => ssoState);\n  }\n\n  getOrganizationSsoIdentifier(): Promise<string> {\n    return firstValueFrom(this.orgSsoIdentifierState.state$);\n  }\n\n  async setOrganizationSsoIdentifier(organizationIdentifier: string): Promise<void> {\n    await this.orgSsoIdentifierState.update((_) => organizationIdentifier);\n  }\n\n  getSsoEmail(): Promise<string> {\n    return firstValueFrom(this.ssoEmailState.state$);\n  }\n\n  async setSsoEmail(email: string): Promise<void> {\n    await this.ssoEmailState.update((_) => email);\n  }\n\n  getActiveUserOrganizationSsoIdentifier(): Promise<string> {\n    return firstValueFrom(this.activeUserOrgSsoIdentifierState.state$);\n  }\n\n  async setActiveUserOrganizationSsoIdentifier(organizationIdentifier: string): Promise<void> {\n    await this.activeUserOrgSsoIdentifierState.update((_) => organizationIdentifier);\n  }\n}\n","export enum VaultTimeoutAction {\n  Lock = \"lock\",\n  LogOut = \"logOut\",\n}\n","// Note: the below comments are just for documenting what they used to be.\nexport const VaultTimeoutStringType = {\n  Never: \"never\", // null\n  OnRestart: \"onRestart\", // -1\n  OnLocked: \"onLocked\", // -2\n  OnSleep: \"onSleep\", // -3\n  OnIdle: \"onIdle\", // -4\n} as const;\n\nexport type VaultTimeout =\n  | number // 0 or positive numbers only\n  | (typeof VaultTimeoutStringType)[keyof typeof VaultTimeoutStringType];\n\nexport interface VaultTimeoutOption {\n  name: string;\n  value: VaultTimeout;\n}\n","import {\n  KeyDefinition,\n  TOKEN_DISK,\n  TOKEN_DISK_LOCAL,\n  TOKEN_MEMORY,\n  UserKeyDefinition,\n} from \"../../platform/state\";\n\n// Note: all tokens / API key information must be cleared on logout.\n// because we are using secure storage, we must manually call to clean up our tokens.\n// See stateService.deAuthenticateAccount for where we call clearTokens(...)\n\nexport const ACCESS_TOKEN_DISK = new UserKeyDefinition<string>(TOKEN_DISK, \"accessToken\", {\n  deserializer: (accessToken) => accessToken,\n  clearOn: [], // Manually handled\n});\n\nexport const ACCESS_TOKEN_MEMORY = new UserKeyDefinition<string>(TOKEN_MEMORY, \"accessToken\", {\n  deserializer: (accessToken) => accessToken,\n  clearOn: [], // Manually handled\n});\n\nexport const REFRESH_TOKEN_DISK = new UserKeyDefinition<string>(TOKEN_DISK, \"refreshToken\", {\n  deserializer: (refreshToken) => refreshToken,\n  clearOn: [], // Manually handled\n});\n\nexport const REFRESH_TOKEN_MEMORY = new UserKeyDefinition<string>(TOKEN_MEMORY, \"refreshToken\", {\n  deserializer: (refreshToken) => refreshToken,\n  clearOn: [], // Manually handled\n});\n\nexport const EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL = KeyDefinition.record<string, string>(\n  TOKEN_DISK_LOCAL,\n  \"emailTwoFactorTokenRecord\",\n  {\n    deserializer: (emailTwoFactorTokenRecord) => emailTwoFactorTokenRecord,\n  },\n);\n\nexport const API_KEY_CLIENT_ID_DISK = new UserKeyDefinition<string>(TOKEN_DISK, \"apiKeyClientId\", {\n  deserializer: (apiKeyClientId) => apiKeyClientId,\n  clearOn: [], // Manually handled\n});\n\nexport const API_KEY_CLIENT_ID_MEMORY = new UserKeyDefinition<string>(\n  TOKEN_MEMORY,\n  \"apiKeyClientId\",\n  {\n    deserializer: (apiKeyClientId) => apiKeyClientId,\n    clearOn: [], // Manually handled\n  },\n);\n\nexport const API_KEY_CLIENT_SECRET_DISK = new UserKeyDefinition<string>(\n  TOKEN_DISK,\n  \"apiKeyClientSecret\",\n  {\n    deserializer: (apiKeyClientSecret) => apiKeyClientSecret,\n    clearOn: [], // Manually handled\n  },\n);\n\nexport const API_KEY_CLIENT_SECRET_MEMORY = new UserKeyDefinition<string>(\n  TOKEN_MEMORY,\n  \"apiKeyClientSecret\",\n  {\n    deserializer: (apiKeyClientSecret) => apiKeyClientSecret,\n    clearOn: [], // Manually handled\n  },\n);\n\nexport const SECURITY_STAMP_MEMORY = new UserKeyDefinition<string>(TOKEN_MEMORY, \"securityStamp\", {\n  deserializer: (securityStamp) => securityStamp,\n  clearOn: [\"logout\"],\n});\n","import { Observable, combineLatest, firstValueFrom, map } from \"rxjs\";\nimport { Opaque } from \"type-fest\";\n\nimport { LogoutReason, decodeJwtTokenToJson } from \"@bitwarden/auth/common\";\n\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"../../platform/abstractions/key-generation.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { AbstractStorageService } from \"../../platform/abstractions/storage.service\";\nimport { StorageLocation } from \"../../platform/enums\";\nimport { EncString, EncryptedString } from \"../../platform/models/domain/enc-string\";\nimport { StorageOptions } from \"../../platform/models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport {\n  GlobalState,\n  GlobalStateProvider,\n  SingleUserStateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { VaultTimeout, VaultTimeoutStringType } from \"../../types/vault-timeout.type\";\nimport { TokenService as TokenServiceAbstraction } from \"../abstractions/token.service\";\n\nimport { ACCOUNT_ACTIVE_ACCOUNT_ID } from \"./account.service\";\nimport {\n  ACCESS_TOKEN_DISK,\n  ACCESS_TOKEN_MEMORY,\n  API_KEY_CLIENT_ID_DISK,\n  API_KEY_CLIENT_ID_MEMORY,\n  API_KEY_CLIENT_SECRET_DISK,\n  API_KEY_CLIENT_SECRET_MEMORY,\n  EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL,\n  REFRESH_TOKEN_DISK,\n  REFRESH_TOKEN_MEMORY,\n  SECURITY_STAMP_MEMORY,\n} from \"./token.state\";\n\nexport enum TokenStorageLocation {\n  Disk = \"disk\",\n  SecureStorage = \"secureStorage\",\n  Memory = \"memory\",\n}\n\n/**\n * Type representing the structure of a standard Bitwarden decoded access token.\n * src: https://datatracker.ietf.org/doc/html/rfc7519#section-4.1\n * Note: all claims are technically optional so we must verify their existence before using them.\n * Note 2: NumericDate is a number representing a date in seconds since the Unix epoch.\n */\nexport type DecodedAccessToken = {\n  /** Issuer  - the issuer of the token, typically the URL of the authentication server */\n  iss?: string;\n\n  /** Not Before - a timestamp defining when the token starts being valid */\n  nbf?: number;\n\n  /** Issued At - a timestamp of when the token was issued */\n  iat?: number;\n\n  /** Expiration Time - a NumericDate timestamp of when the token will expire */\n  exp?: number;\n\n  /** Scope - the scope of the access request, such as the permissions the token grants */\n  scope?: string[];\n\n  /** Authentication Method Reference - the methods used in the authentication */\n  amr?: string[];\n\n  /** Client ID - the identifier for the client that requested the token */\n  client_id?: string;\n\n  /** Subject - the unique identifier for the user */\n  sub?: string;\n\n  /** Authentication Time - a timestamp of when the user authentication occurred */\n  auth_time?: number;\n\n  /** Identity Provider - the system or service that authenticated the user */\n  idp?: string;\n\n  /** Premium - a boolean flag indicating whether the account is premium */\n  premium?: boolean;\n\n  /** Email - the user's email address */\n  email?: string;\n\n  /** Email Verified - a boolean flag indicating whether the user's email address has been verified */\n  email_verified?: boolean;\n\n  /**\n   * Security Stamp - a unique identifier which invalidates the access token if it changes in the db\n   * (typically after critical account changes like a password change)\n   */\n  sstamp?: string;\n\n  /** Name - the name of the user */\n  name?: string;\n\n  /** Organization Owners - a list of organization owner identifiers */\n  orgowner?: string[];\n\n  /** Device - the identifier of the device used */\n  device?: string;\n\n  /** JWT ID - a unique identifier for the JWT */\n  jti?: string;\n};\n\n/**\n * A symmetric key for encrypting the access token before the token is stored on disk.\n * This key should be stored in secure storage.\n * */\nexport type AccessTokenKey = Opaque<SymmetricCryptoKey, \"AccessTokenKey\">;\n\nexport class TokenService implements TokenServiceAbstraction {\n  private readonly accessTokenKeySecureStorageKey: string = \"_accessTokenKey\";\n\n  private readonly refreshTokenSecureStorageKey: string = \"_refreshToken\";\n\n  private emailTwoFactorTokenRecordGlobalState: GlobalState<Record<string, string>>;\n\n  private activeUserIdGlobalState: GlobalState<UserId>;\n\n  constructor(\n    // Note: we cannot use ActiveStateProvider because if we ever want to inject\n    // this service into the AccountService, we will make a circular dependency\n    private singleUserStateProvider: SingleUserStateProvider,\n    private globalStateProvider: GlobalStateProvider,\n    private readonly platformSupportsSecureStorage: boolean,\n    private secureStorageService: AbstractStorageService,\n    private keyGenerationService: KeyGenerationService,\n    private encryptService: EncryptService,\n    private logService: LogService,\n    private logoutCallback: (logoutReason: LogoutReason, userId?: string) => Promise<void>,\n  ) {\n    this.initializeState();\n  }\n\n  hasAccessToken$(userId: UserId): Observable<boolean> {\n    // FIXME Once once vault timeout action is observable, we can use it to determine storage location\n    // and avoid the need to check both disk and memory.\n    return combineLatest([\n      this.singleUserStateProvider.get(userId, ACCESS_TOKEN_DISK).state$,\n      this.singleUserStateProvider.get(userId, ACCESS_TOKEN_MEMORY).state$,\n    ]).pipe(map(([disk, memory]) => Boolean(disk || memory)));\n  }\n\n  private initializeState(): void {\n    this.emailTwoFactorTokenRecordGlobalState = this.globalStateProvider.get(\n      EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL,\n    );\n\n    this.activeUserIdGlobalState = this.globalStateProvider.get(ACCOUNT_ACTIVE_ACCOUNT_ID);\n  }\n\n  async setTokens(\n    accessToken: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    refreshToken?: string,\n    clientIdClientSecret?: [string, string],\n  ): Promise<void> {\n    if (!accessToken) {\n      throw new Error(\"Access token is required.\");\n    }\n\n    // Can't check for falsey b/c 0 is a valid value\n    if (vaultTimeout == null) {\n      throw new Error(\"Vault Timeout is required.\");\n    }\n\n    if (vaultTimeoutAction == null) {\n      throw new Error(\"Vault Timeout Action is required.\");\n    }\n\n    // get user id the access token\n    const userId: UserId = await this.getUserIdFromAccessToken(accessToken);\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot set tokens.\");\n    }\n\n    await this._setAccessToken(accessToken, vaultTimeoutAction, vaultTimeout, userId);\n\n    if (refreshToken) {\n      await this.setRefreshToken(refreshToken, vaultTimeoutAction, vaultTimeout, userId);\n    }\n\n    if (clientIdClientSecret != null) {\n      await this.setClientId(clientIdClientSecret[0], vaultTimeoutAction, vaultTimeout, userId);\n      await this.setClientSecret(clientIdClientSecret[1], vaultTimeoutAction, vaultTimeout, userId);\n    }\n  }\n\n  private async getAccessTokenKey(userId: UserId): Promise<AccessTokenKey | null> {\n    const accessTokenKeyB64 = await this.secureStorageService.get<\n      ReturnType<SymmetricCryptoKey[\"toJSON\"]>\n    >(`${userId}${this.accessTokenKeySecureStorageKey}`, this.getSecureStorageOptions(userId));\n\n    if (!accessTokenKeyB64) {\n      return null;\n    }\n\n    const accessTokenKey = SymmetricCryptoKey.fromJSON(accessTokenKeyB64) as AccessTokenKey;\n    return accessTokenKey;\n  }\n\n  private async createAndSaveAccessTokenKey(userId: UserId): Promise<AccessTokenKey> {\n    const newAccessTokenKey = (await this.keyGenerationService.createKey(512)) as AccessTokenKey;\n\n    await this.secureStorageService.save<AccessTokenKey>(\n      `${userId}${this.accessTokenKeySecureStorageKey}`,\n      newAccessTokenKey,\n      this.getSecureStorageOptions(userId),\n    );\n\n    // We are having intermittent issues with access token keys not saving into secure storage on windows 10/11.\n    // So, let's add a check to ensure we can read the value after writing it.\n    const accessTokenKey = await this.getAccessTokenKey(userId);\n\n    if (!accessTokenKey) {\n      throw new Error(\"New Access token key unable to be retrieved from secure storage.\");\n    }\n\n    return newAccessTokenKey;\n  }\n\n  private async clearAccessTokenKey(userId: UserId): Promise<void> {\n    await this.secureStorageService.remove(\n      `${userId}${this.accessTokenKeySecureStorageKey}`,\n      this.getSecureStorageOptions(userId),\n    );\n  }\n\n  private async getOrCreateAccessTokenKey(userId: UserId): Promise<AccessTokenKey> {\n    if (!this.platformSupportsSecureStorage) {\n      throw new Error(\"Platform does not support secure storage. Cannot obtain access token key.\");\n    }\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot obtain access token key.\");\n    }\n\n    // First see if we have an accessTokenKey in secure storage and return it if we do\n    // Note: retrieving/saving data from/to secure storage on linux will throw if the\n    // distro doesn't have a secure storage provider\n    let accessTokenKey: AccessTokenKey = await this.getAccessTokenKey(userId);\n\n    if (!accessTokenKey) {\n      // Otherwise, create a new one and save it to secure storage, then return it\n      accessTokenKey = await this.createAndSaveAccessTokenKey(userId);\n    }\n\n    return accessTokenKey;\n  }\n\n  private async encryptAccessToken(accessToken: string, userId: UserId): Promise<EncString> {\n    const accessTokenKey = await this.getOrCreateAccessTokenKey(userId);\n\n    return await this.encryptService.encrypt(accessToken, accessTokenKey);\n  }\n\n  private async decryptAccessToken(\n    accessTokenKey: AccessTokenKey,\n    encryptedAccessToken: EncString,\n  ): Promise<string | null> {\n    if (!accessTokenKey) {\n      throw new Error(\n        \"decryptAccessToken: Access token key required. Cannot decrypt access token.\",\n      );\n    }\n\n    const decryptedAccessToken = await this.encryptService.decryptToUtf8(\n      encryptedAccessToken,\n      accessTokenKey,\n    );\n\n    return decryptedAccessToken;\n  }\n\n  /**\n   * Internal helper for set access token which always requires user id.\n   * This is useful because setTokens always will have a user id from the access token whereas\n   * the public setAccessToken method does not.\n   */\n  private async _setAccessToken(\n    accessToken: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    userId: UserId,\n  ): Promise<void> {\n    const storageLocation = await this.determineStorageLocation(\n      vaultTimeoutAction,\n      vaultTimeout,\n      true,\n    );\n\n    switch (storageLocation) {\n      case TokenStorageLocation.SecureStorage: {\n        // Secure storage implementations have variable length limitations (Windows), so we cannot\n        // store the access token directly. Instead, we encrypt with accessTokenKey and store that\n        // in secure storage.\n\n        try {\n          const encryptedAccessToken: EncString = await this.encryptAccessToken(\n            accessToken,\n            userId,\n          );\n\n          // Save the encrypted access token to disk\n          await this.singleUserStateProvider\n            .get(userId, ACCESS_TOKEN_DISK)\n            .update((_) => encryptedAccessToken.encryptedString);\n\n          // TODO: PM-6408\n          // 2024-02-20: Remove access token from memory so that we migrate to encrypt the access token over time.\n          // Remove this call to remove the access token from memory after 3 months.\n          await this.singleUserStateProvider.get(userId, ACCESS_TOKEN_MEMORY).update((_) => null);\n        } catch (error) {\n          this.logService.error(\n            `SetAccessToken: storing encrypted access token in secure storage failed. Falling back to disk storage.`,\n            error,\n          );\n\n          // Fall back to disk storage for unecrypted access token\n          await this.singleUserStateProvider\n            .get(userId, ACCESS_TOKEN_DISK)\n            .update((_) => accessToken);\n        }\n\n        return;\n      }\n      case TokenStorageLocation.Disk:\n        // Access token stored on disk unencrypted as platform does not support secure storage\n        await this.singleUserStateProvider\n          .get(userId, ACCESS_TOKEN_DISK)\n          .update((_) => accessToken);\n        return;\n      case TokenStorageLocation.Memory:\n        // Access token stored in memory due to vault timeout settings\n        await this.singleUserStateProvider\n          .get(userId, ACCESS_TOKEN_MEMORY)\n          .update((_) => accessToken);\n        return;\n    }\n  }\n\n  async setAccessToken(\n    accessToken: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n  ): Promise<void> {\n    if (!accessToken) {\n      throw new Error(\"Access token is required.\");\n    }\n    const userId: UserId = await this.getUserIdFromAccessToken(accessToken);\n\n    // If we don't have a user id, we can't save the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot save access token.\");\n    }\n\n    // Can't check for falsey b/c 0 is a valid value\n    if (vaultTimeout == null) {\n      throw new Error(\"Vault Timeout is required.\");\n    }\n\n    if (vaultTimeoutAction == null) {\n      throw new Error(\"Vault Timeout Action is required.\");\n    }\n\n    await this._setAccessToken(accessToken, vaultTimeoutAction, vaultTimeout, userId);\n  }\n\n  async clearAccessToken(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    // If we don't have a user id, we can't clear the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot clear access token.\");\n    }\n\n    // TODO: re-eval this implementation once we get shared key definitions for vault timeout and vault timeout action data.\n    // we can't determine storage location w/out vaultTimeoutAction and vaultTimeout\n    // but we can simply clear all locations to avoid the need to require those parameters.\n\n    if (this.platformSupportsSecureStorage) {\n      // Always clear the access token key when clearing the access token\n      // The next set of the access token will create a new access token key\n      await this.clearAccessTokenKey(userId);\n    }\n\n    // Platform doesn't support secure storage, so use state provider implementation\n    await this.singleUserStateProvider.get(userId, ACCESS_TOKEN_DISK).update((_) => null);\n    await this.singleUserStateProvider.get(userId, ACCESS_TOKEN_MEMORY).update((_) => null);\n  }\n\n  async getAccessToken(userId?: UserId): Promise<string | null> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      return null;\n    }\n\n    // Try to get the access token from memory\n    const accessTokenMemory = await this.getStateValueByUserIdAndKeyDef(\n      userId,\n      ACCESS_TOKEN_MEMORY,\n    );\n    if (accessTokenMemory != null) {\n      return accessTokenMemory;\n    }\n\n    // If memory is null, read from disk\n    const accessTokenDisk = await this.getStateValueByUserIdAndKeyDef(userId, ACCESS_TOKEN_DISK);\n    if (!accessTokenDisk) {\n      return null;\n    }\n\n    if (this.platformSupportsSecureStorage) {\n      let accessTokenKey: AccessTokenKey;\n      try {\n        accessTokenKey = await this.getAccessTokenKey(userId);\n      } catch (error) {\n        if (EncString.isSerializedEncString(accessTokenDisk)) {\n          this.logService.error(\n            \"Access token key retrieval failed. Unable to decrypt encrypted access token. Logging user out.\",\n            error,\n          );\n          await this.logoutCallback(\"accessTokenUnableToBeDecrypted\", userId);\n          return null;\n        }\n\n        // If the access token key is not found, but the access token is unencrypted then\n        // this indicates that this is the pre-migration state where the access token\n        // was stored unencrypted on disk. We can return the access token as is.\n        // Note: this is likely to only be hit for linux users who don't\n        // have a secure storage provider configured.\n        return accessTokenDisk;\n      }\n\n      if (!accessTokenKey) {\n        if (EncString.isSerializedEncString(accessTokenDisk)) {\n          // The access token is encrypted but we don't have the key to decrypt it for\n          // whatever reason so we have to log the user out.\n          this.logService.error(\n            \"Access token key not found to decrypt encrypted access token. Logging user out.\",\n          );\n\n          await this.logoutCallback(\"accessTokenUnableToBeDecrypted\", userId);\n\n          return null;\n        }\n\n        // We know this is an unencrypted access token\n        return accessTokenDisk;\n      }\n\n      try {\n        const encryptedAccessTokenEncString = new EncString(accessTokenDisk as EncryptedString);\n\n        const decryptedAccessToken = await this.decryptAccessToken(\n          accessTokenKey,\n          encryptedAccessTokenEncString,\n        );\n        return decryptedAccessToken;\n      } catch (error) {\n        // If an error occurs during decryption, logout and then return null.\n        // We don't try to recover here since we'd like to know\n        // if access token and key are getting out of sync.\n        this.logService.error(`Failed to decrypt access token`, error);\n\n        await this.logoutCallback(\"accessTokenUnableToBeDecrypted\", userId);\n\n        return null;\n      }\n    }\n    return accessTokenDisk;\n  }\n\n  // Private because we only ever set the refresh token when also setting the access token\n  // and we need the user id from the access token to save to secure storage\n  private async setRefreshToken(\n    refreshToken: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    userId: UserId,\n  ): Promise<void> {\n    // If we don't have a user id, we can't save the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot save refresh token.\");\n    }\n\n    // Can't check for falsey b/c 0 is a valid value\n    if (vaultTimeout == null) {\n      throw new Error(\"Vault Timeout is required.\");\n    }\n\n    if (vaultTimeoutAction == null) {\n      throw new Error(\"Vault Timeout Action is required.\");\n    }\n\n    const storageLocation = await this.determineStorageLocation(\n      vaultTimeoutAction,\n      vaultTimeout,\n      true,\n    );\n\n    switch (storageLocation) {\n      case TokenStorageLocation.SecureStorage: {\n        try {\n          await this.saveStringToSecureStorage(\n            userId,\n            this.refreshTokenSecureStorageKey,\n            refreshToken,\n          );\n\n          // Check if the refresh token was able to be saved to secure storage by reading it\n          // immediately after setting it. This is needed due to intermittent silent failures on Windows 10/11.\n          const refreshTokenSecureStorage = await this.getStringFromSecureStorage(\n            userId,\n            this.refreshTokenSecureStorageKey,\n          );\n\n          // Only throw if the refresh token was not saved to secure storage\n          // If we only check for a nullish value out of secure storage without considering the input value,\n          // then we would end up falling back to disk storage if the input value was null.\n          if (refreshToken !== null && !refreshTokenSecureStorage) {\n            throw new Error(\"Refresh token failed to save to secure storage.\");\n          }\n\n          // TODO: PM-6408\n          // 2024-02-20: Remove refresh token from memory and disk so that we migrate to secure storage over time.\n          // Remove these 2 calls to remove the refresh token from memory and disk after 3 months.\n          await this.singleUserStateProvider.get(userId, REFRESH_TOKEN_DISK).update((_) => null);\n          await this.singleUserStateProvider.get(userId, REFRESH_TOKEN_MEMORY).update((_) => null);\n        } catch (error) {\n          // This case could be hit for both Linux users who don't have secure storage configured\n          // or for Windows users who have intermittent issues with secure storage.\n          this.logService.error(\n            `SetRefreshToken: storing refresh token in secure storage failed. Falling back to disk storage.`,\n            error,\n          );\n\n          // Fall back to disk storage for refresh token\n          await this.singleUserStateProvider\n            .get(userId, REFRESH_TOKEN_DISK)\n            .update((_) => refreshToken);\n        }\n\n        return;\n      }\n      case TokenStorageLocation.Disk:\n        await this.singleUserStateProvider\n          .get(userId, REFRESH_TOKEN_DISK)\n          .update((_) => refreshToken);\n        return;\n\n      case TokenStorageLocation.Memory:\n        await this.singleUserStateProvider\n          .get(userId, REFRESH_TOKEN_MEMORY)\n          .update((_) => refreshToken);\n        return;\n    }\n  }\n\n  async getRefreshToken(userId?: UserId): Promise<string | null> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      return null;\n    }\n\n    // pre-secure storage migration:\n    // Always read memory first b/c faster\n    const refreshTokenMemory = await this.getStateValueByUserIdAndKeyDef(\n      userId,\n      REFRESH_TOKEN_MEMORY,\n    );\n\n    if (refreshTokenMemory != null) {\n      return refreshTokenMemory;\n    }\n\n    // if memory is null, read from disk and then secure storage\n    const refreshTokenDisk = await this.getStateValueByUserIdAndKeyDef(userId, REFRESH_TOKEN_DISK);\n\n    if (refreshTokenDisk != null) {\n      // This handles the scenario pre-secure storage migration where the refresh token was stored on disk.\n      return refreshTokenDisk;\n    }\n\n    if (this.platformSupportsSecureStorage) {\n      try {\n        const refreshTokenSecureStorage = await this.getStringFromSecureStorage(\n          userId,\n          this.refreshTokenSecureStorageKey,\n        );\n\n        if (refreshTokenSecureStorage != null) {\n          return refreshTokenSecureStorage;\n        }\n\n        this.logService.error(\n          \"Refresh token not found in secure storage. Access token will fail to refresh upon expiration or manual refresh.\",\n        );\n      } catch (error) {\n        // This case will be hit for Linux users who don't have secure storage configured.\n\n        this.logService.error(`Failed to retrieve refresh token from secure storage`, error);\n\n        await this.logoutCallback(\"refreshTokenSecureStorageRetrievalFailure\", userId);\n      }\n    }\n\n    return null;\n  }\n\n  private async clearRefreshToken(userId: UserId): Promise<void> {\n    // If we don't have a user id, we can't clear the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot clear refresh token.\");\n    }\n\n    // TODO: re-eval this once we get shared key definitions for vault timeout and vault timeout action data.\n    // we can't determine storage location w/out vaultTimeoutAction and vaultTimeout\n    // but we can simply clear all locations to avoid the need to require those parameters\n\n    if (this.platformSupportsSecureStorage) {\n      await this.secureStorageService.remove(\n        `${userId}${this.refreshTokenSecureStorageKey}`,\n        this.getSecureStorageOptions(userId),\n      );\n    }\n\n    // Platform doesn't support secure storage, so use state provider implementation\n    await this.singleUserStateProvider.get(userId, REFRESH_TOKEN_MEMORY).update((_) => null);\n    await this.singleUserStateProvider.get(userId, REFRESH_TOKEN_DISK).update((_) => null);\n  }\n\n  async setClientId(\n    clientId: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    userId?: UserId,\n  ): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    // If we don't have a user id, we can't save the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot save client id.\");\n    }\n\n    // Can't check for falsey b/c 0 is a valid value\n    if (vaultTimeout == null) {\n      throw new Error(\"Vault Timeout is required.\");\n    }\n\n    if (vaultTimeoutAction == null) {\n      throw new Error(\"Vault Timeout Action is required.\");\n    }\n\n    const storageLocation = await this.determineStorageLocation(\n      vaultTimeoutAction,\n      vaultTimeout,\n      false, // don't use secure storage for client id\n    );\n\n    if (storageLocation === TokenStorageLocation.Disk) {\n      await this.singleUserStateProvider\n        .get(userId, API_KEY_CLIENT_ID_DISK)\n        .update((_) => clientId);\n    } else if (storageLocation === TokenStorageLocation.Memory) {\n      await this.singleUserStateProvider\n        .get(userId, API_KEY_CLIENT_ID_MEMORY)\n        .update((_) => clientId);\n    }\n  }\n\n  async getClientId(userId?: UserId): Promise<string | undefined> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      return undefined;\n    }\n\n    // Always read memory first b/c faster\n    const apiKeyClientIdMemory = await this.getStateValueByUserIdAndKeyDef(\n      userId,\n      API_KEY_CLIENT_ID_MEMORY,\n    );\n\n    if (apiKeyClientIdMemory != null) {\n      return apiKeyClientIdMemory;\n    }\n\n    // if memory is null, read from disk\n    return await this.getStateValueByUserIdAndKeyDef(userId, API_KEY_CLIENT_ID_DISK);\n  }\n\n  private async clearClientId(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    // If we don't have a user id, we can't clear the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot clear client id.\");\n    }\n\n    // TODO: re-eval this once we get shared key definitions for vault timeout and vault timeout action data.\n    // we can't determine storage location w/out vaultTimeoutAction and vaultTimeout\n    // but we can simply clear both locations to avoid the need to require those parameters\n\n    // Platform doesn't support secure storage, so use state provider implementation\n    await this.singleUserStateProvider.get(userId, API_KEY_CLIENT_ID_MEMORY).update((_) => null);\n    await this.singleUserStateProvider.get(userId, API_KEY_CLIENT_ID_DISK).update((_) => null);\n  }\n\n  async setClientSecret(\n    clientSecret: string,\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    userId?: UserId,\n  ): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot save client secret.\");\n    }\n\n    // Can't check for falsey b/c 0 is a valid value\n    if (vaultTimeout == null) {\n      throw new Error(\"Vault Timeout is required.\");\n    }\n\n    if (vaultTimeoutAction == null) {\n      throw new Error(\"Vault Timeout Action is required.\");\n    }\n\n    const storageLocation = await this.determineStorageLocation(\n      vaultTimeoutAction,\n      vaultTimeout,\n      false, // don't use secure storage for client secret\n    );\n\n    if (storageLocation === TokenStorageLocation.Disk) {\n      await this.singleUserStateProvider\n        .get(userId, API_KEY_CLIENT_SECRET_DISK)\n        .update((_) => clientSecret);\n    } else if (storageLocation === TokenStorageLocation.Memory) {\n      await this.singleUserStateProvider\n        .get(userId, API_KEY_CLIENT_SECRET_MEMORY)\n        .update((_) => clientSecret);\n    }\n  }\n\n  async getClientSecret(userId?: UserId): Promise<string | undefined> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      return undefined;\n    }\n\n    // Always read memory first b/c faster\n    const apiKeyClientSecretMemory = await this.getStateValueByUserIdAndKeyDef(\n      userId,\n      API_KEY_CLIENT_SECRET_MEMORY,\n    );\n\n    if (apiKeyClientSecretMemory != null) {\n      return apiKeyClientSecretMemory;\n    }\n\n    // if memory is null, read from disk\n    return await this.getStateValueByUserIdAndKeyDef(userId, API_KEY_CLIENT_SECRET_DISK);\n  }\n\n  private async clearClientSecret(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    // If we don't have a user id, we can't clear the value\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot clear client secret.\");\n    }\n\n    // TODO: re-eval this once we get shared key definitions for vault timeout and vault timeout action data.\n    // we can't determine storage location w/out vaultTimeoutAction and vaultTimeout\n    // but we can simply clear both locations to avoid the need to require those parameters\n\n    // Platform doesn't support secure storage, so use state provider implementation\n    await this.singleUserStateProvider\n      .get(userId, API_KEY_CLIENT_SECRET_MEMORY)\n      .update((_) => null);\n    await this.singleUserStateProvider.get(userId, API_KEY_CLIENT_SECRET_DISK).update((_) => null);\n  }\n\n  async setTwoFactorToken(email: string, twoFactorToken: string): Promise<void> {\n    await this.emailTwoFactorTokenRecordGlobalState.update((emailTwoFactorTokenRecord) => {\n      emailTwoFactorTokenRecord ??= {};\n\n      emailTwoFactorTokenRecord[email] = twoFactorToken;\n      return emailTwoFactorTokenRecord;\n    });\n  }\n\n  async getTwoFactorToken(email: string): Promise<string | null> {\n    const emailTwoFactorTokenRecord: Record<string, string> = await firstValueFrom(\n      this.emailTwoFactorTokenRecordGlobalState.state$,\n    );\n\n    if (!emailTwoFactorTokenRecord) {\n      return null;\n    }\n\n    return emailTwoFactorTokenRecord[email];\n  }\n\n  async clearTwoFactorToken(email: string): Promise<void> {\n    await this.emailTwoFactorTokenRecordGlobalState.update((emailTwoFactorTokenRecord) => {\n      emailTwoFactorTokenRecord ??= {};\n      delete emailTwoFactorTokenRecord[email];\n      return emailTwoFactorTokenRecord;\n    });\n  }\n\n  // TODO: stop accepting optional userIds\n  async clearTokens(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot clear tokens.\");\n    }\n\n    await Promise.all([\n      this.clearAccessToken(userId),\n      this.clearRefreshToken(userId),\n      this.clearClientId(userId),\n      this.clearClientSecret(userId),\n    ]);\n  }\n\n  // jwthelper methods\n  // ref https://github.com/auth0/angular-jwt/blob/master/src/angularJwt/services/jwt.js\n\n  async decodeAccessToken(token?: string): Promise<DecodedAccessToken> {\n    token = token ?? (await this.getAccessToken());\n\n    if (token == null) {\n      throw new Error(\"Access token not found.\");\n    }\n\n    return decodeJwtTokenToJson(token) as DecodedAccessToken;\n  }\n\n  // TODO: PM-6678- tech debt - consider consolidating the return types of all these access\n  // token data retrieval methods to return null if something goes wrong instead of throwing an error.\n\n  async getTokenExpirationDate(): Promise<Date | null> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    // per RFC, exp claim is optional but if it exists, it should be a number\n    if (!decoded || typeof decoded.exp !== \"number\") {\n      return null;\n    }\n\n    // The 0 in Date(0) is the key; it sets the date to the epoch\n    const expirationDate = new Date(0);\n    expirationDate.setUTCSeconds(decoded.exp);\n    return expirationDate;\n  }\n\n  async tokenSecondsRemaining(offsetSeconds = 0): Promise<number> {\n    const date = await this.getTokenExpirationDate();\n    if (date == null) {\n      return 0;\n    }\n\n    const msRemaining = date.valueOf() - (new Date().valueOf() + offsetSeconds * 1000);\n    return Math.round(msRemaining / 1000);\n  }\n\n  async tokenNeedsRefresh(minutes = 5): Promise<boolean> {\n    const sRemaining = await this.tokenSecondsRemaining();\n    return sRemaining < 60 * minutes;\n  }\n\n  async getUserId(): Promise<UserId> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.sub !== \"string\") {\n      throw new Error(\"No user id found\");\n    }\n\n    return decoded.sub as UserId;\n  }\n\n  private async getUserIdFromAccessToken(accessToken: string): Promise<UserId> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken(accessToken);\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.sub !== \"string\") {\n      throw new Error(\"No user id found\");\n    }\n\n    return decoded.sub as UserId;\n  }\n\n  async getEmail(): Promise<string> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.email !== \"string\") {\n      throw new Error(\"No email found\");\n    }\n\n    return decoded.email;\n  }\n\n  async getEmailVerified(): Promise<boolean> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.email_verified !== \"boolean\") {\n      throw new Error(\"No email verification found\");\n    }\n\n    return decoded.email_verified;\n  }\n\n  async getName(): Promise<string> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.name !== \"string\") {\n      return null;\n    }\n\n    return decoded.name;\n  }\n\n  async getIssuer(): Promise<string> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    if (!decoded || typeof decoded.iss !== \"string\") {\n      throw new Error(\"No issuer found\");\n    }\n\n    return decoded.iss;\n  }\n\n  async getIsExternal(): Promise<boolean> {\n    let decoded: DecodedAccessToken;\n    try {\n      decoded = await this.decodeAccessToken();\n    } catch (error) {\n      throw new Error(\"Failed to decode access token: \" + error.message);\n    }\n\n    return Array.isArray(decoded.amr) && decoded.amr.includes(\"external\");\n  }\n\n  async getSecurityStamp(userId?: UserId): Promise<string | null> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot get security stamp.\");\n    }\n\n    const securityStamp = await this.getStateValueByUserIdAndKeyDef(userId, SECURITY_STAMP_MEMORY);\n\n    return securityStamp;\n  }\n\n  async setSecurityStamp(securityStamp: string, userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.activeUserIdGlobalState.state$);\n\n    if (!userId) {\n      throw new Error(\"User id not found. Cannot set security stamp.\");\n    }\n\n    await this.singleUserStateProvider\n      .get(userId, SECURITY_STAMP_MEMORY)\n      .update((_) => securityStamp);\n  }\n\n  private async getStateValueByUserIdAndKeyDef(\n    userId: UserId,\n    storageLocation: UserKeyDefinition<string>,\n  ): Promise<string | undefined> {\n    // read from single user state provider\n    return await firstValueFrom(this.singleUserStateProvider.get(userId, storageLocation).state$);\n  }\n\n  private async determineStorageLocation(\n    vaultTimeoutAction: VaultTimeoutAction,\n    vaultTimeout: VaultTimeout,\n    useSecureStorage: boolean,\n  ): Promise<TokenStorageLocation> {\n    if (vaultTimeoutAction == null) {\n      throw new Error(\n        \"TokenService - determineStorageLocation: We expect the vault timeout action to always exist at this point.\",\n      );\n    }\n\n    if (vaultTimeout == null) {\n      throw new Error(\n        \"TokenService - determineStorageLocation: We expect the vault timeout to always exist at this point.\",\n      );\n    }\n\n    if (\n      vaultTimeoutAction === VaultTimeoutAction.LogOut &&\n      vaultTimeout !== VaultTimeoutStringType.Never\n    ) {\n      return TokenStorageLocation.Memory;\n    } else {\n      if (useSecureStorage && this.platformSupportsSecureStorage) {\n        return TokenStorageLocation.SecureStorage;\n      }\n\n      return TokenStorageLocation.Disk;\n    }\n  }\n\n  private async saveStringToSecureStorage(\n    userId: UserId,\n    storageKey: string,\n    value: string,\n  ): Promise<void> {\n    await this.secureStorageService.save<string>(\n      `${userId}${storageKey}`,\n      value,\n      this.getSecureStorageOptions(userId),\n    );\n  }\n\n  private async getStringFromSecureStorage(\n    userId: UserId,\n    storageKey: string,\n  ): Promise<string | null> {\n    // If we have a user ID, read from secure storage.\n    return await this.secureStorageService.get<string>(\n      `${userId}${storageKey}`,\n      this.getSecureStorageOptions(userId),\n    );\n  }\n\n  private getSecureStorageOptions(userId: UserId): StorageOptions {\n    return {\n      storageLocation: StorageLocation.Disk,\n      useSecureStorage: true,\n      userId: userId,\n    };\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nexport function decodeJwtTokenToJson(jwtToken: string): any {\n  if (jwtToken == null) {\n    throw new Error(\"JWT token not found\");\n  }\n\n  const parts = jwtToken.split(\".\");\n  if (parts.length !== 3) {\n    throw new Error(\"JWT must have 3 parts\");\n  }\n\n  // JWT has 3 parts: header, payload, signature separated by '.'\n  // So, grab the payload to decode\n  const encodedPayload = parts[1];\n\n  let decodedPayloadJSON: string;\n  try {\n    // Attempt to decode from URL-safe Base64 to UTF-8\n    decodedPayloadJSON = Utils.fromUrlB64ToUtf8(encodedPayload);\n  } catch (decodingError) {\n    throw new Error(\"Cannot decode the token\");\n  }\n\n  try {\n    // Attempt to parse the JSON payload\n    const decodedToken = JSON.parse(decodedPayloadJSON);\n    return decodedToken;\n  } catch (jsonError) {\n    throw new Error(\"Cannot parse the token's payload into JSON\");\n  }\n}\n","export enum VerificationType {\n  MasterPassword = 0,\n  OTP = 1,\n  PIN = 2,\n  Biometrics = 3,\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { UserVerificationApiServiceAbstraction } from \"../../abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { VerifyOTPRequest } from \"../../models/request/verify-otp.request\";\n\nexport class UserVerificationApiService implements UserVerificationApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  postAccountVerifyOTP(request: VerifyOTPRequest): Promise<void> {\n    return this.apiService.send(\"POST\", \"/accounts/verify-otp\", request, true, false);\n  }\n  async postAccountRequestOTP(): Promise<void> {\n    return this.apiService.send(\"POST\", \"/accounts/request-otp\", null, true, false);\n  }\n}\n","export class VerifyOTPRequest {\n  OTP: string;\n\n  constructor(OTP: string) {\n    this.OTP = OTP;\n  }\n}\n","import { firstValueFrom, map } from \"rxjs\";\n\nimport { UserDecryptionOptionsServiceAbstraction } from \"@bitwarden/auth/common\";\n\nimport { PinServiceAbstraction } from \"../../../../../auth/src/common/abstractions/pin.service.abstraction\";\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"../../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { LogService } from \"../../../platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"../../../platform/abstractions/platform-utils.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { KeySuffixOptions } from \"../../../platform/enums/key-suffix-options.enum\";\nimport { UserId } from \"../../../types/guid\";\nimport { UserKey } from \"../../../types/key\";\nimport { AccountService } from \"../../abstractions/account.service\";\nimport { KdfConfigService } from \"../../abstractions/kdf-config.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../../abstractions/master-password.service.abstraction\";\nimport { UserVerificationApiServiceAbstraction } from \"../../abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { UserVerificationService as UserVerificationServiceAbstraction } from \"../../abstractions/user-verification/user-verification.service.abstraction\";\nimport { VerificationType } from \"../../enums/verification-type\";\nimport { SecretVerificationRequest } from \"../../models/request/secret-verification.request\";\nimport { VerifyOTPRequest } from \"../../models/request/verify-otp.request\";\nimport { UserVerificationOptions } from \"../../types/user-verification-options\";\nimport {\n  MasterPasswordVerification,\n  OtpVerification,\n  PinVerification,\n  ServerSideVerification,\n  Verification,\n  VerificationWithSecret,\n  verificationHasSecret,\n} from \"../../types/verification\";\n\n/**\n * Used for general-purpose user verification throughout the app.\n * Use it to verify the input collected by UserVerificationComponent.\n */\nexport class UserVerificationService implements UserVerificationServiceAbstraction {\n  constructor(\n    private stateService: StateService,\n    private cryptoService: CryptoService,\n    private accountService: AccountService,\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    private i18nService: I18nService,\n    private userVerificationApiService: UserVerificationApiServiceAbstraction,\n    private userDecryptionOptionsService: UserDecryptionOptionsServiceAbstraction,\n    private pinService: PinServiceAbstraction,\n    private logService: LogService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsServiceAbstraction,\n    private platformUtilsService: PlatformUtilsService,\n    private kdfConfigService: KdfConfigService,\n  ) {}\n\n  async getAvailableVerificationOptions(\n    verificationType: keyof UserVerificationOptions,\n  ): Promise<UserVerificationOptions> {\n    if (verificationType === \"client\") {\n      const userId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n      const [userHasMasterPassword, pinLockType, biometricsLockSet, biometricsUserKeyStored] =\n        await Promise.all([\n          this.hasMasterPasswordAndMasterKeyHash(),\n          this.pinService.getPinLockType(userId),\n          this.vaultTimeoutSettingsService.isBiometricLockSet(),\n          this.cryptoService.hasUserKeyStored(KeySuffixOptions.Biometric),\n        ]);\n\n      // note: we do not need to check this.platformUtilsService.supportsBiometric() because\n      // we can just use the logic below which works for both desktop & the browser extension.\n\n      return {\n        client: {\n          masterPassword: userHasMasterPassword,\n          pin: pinLockType !== \"DISABLED\",\n          biometrics:\n            biometricsLockSet &&\n            (biometricsUserKeyStored || !this.platformUtilsService.supportsSecureStorage()),\n        },\n        server: {\n          masterPassword: false,\n          otp: false,\n        },\n      };\n    } else {\n      // server\n      // Don't check if have MP hash locally, because we are going to send the secret to the server to be verified.\n      const userHasMasterPassword = await this.hasMasterPassword();\n\n      return {\n        client: {\n          masterPassword: false,\n          pin: false,\n          biometrics: false,\n        },\n        server: { masterPassword: userHasMasterPassword, otp: !userHasMasterPassword },\n      };\n    }\n  }\n\n  /**\n   * Create a new request model to be used for server-side verification\n   * @param verification User-supplied verification data (Master Password or OTP)\n   * @param requestClass The request model to create\n   * @param alreadyHashed Whether the master password is already hashed\n   */\n  async buildRequest<T extends SecretVerificationRequest>(\n    verification: ServerSideVerification,\n    requestClass?: new () => T,\n    alreadyHashed?: boolean,\n  ) {\n    this.validateSecretInput(verification);\n\n    const request =\n      requestClass != null ? new requestClass() : (new SecretVerificationRequest() as T);\n\n    if (verification.type === VerificationType.OTP) {\n      request.otp = verification.secret;\n    } else {\n      const [userId, email] = await firstValueFrom(\n        this.accountService.activeAccount$.pipe(map((a) => [a?.id, a?.email])),\n      );\n      let masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n      if (!masterKey && !alreadyHashed) {\n        masterKey = await this.cryptoService.makeMasterKey(\n          verification.secret,\n          email,\n          await this.kdfConfigService.getKdfConfig(),\n        );\n      }\n      request.masterPasswordHash = alreadyHashed\n        ? verification.secret\n        : await this.cryptoService.hashMasterKey(verification.secret, masterKey);\n    }\n\n    return request;\n  }\n\n  /**\n   * Used to verify Master Password, PIN, or biometrics client-side, or send the OTP to the server for verification (with no other data)\n   * Generally used for client-side verification only.\n   * @param verification User-supplied verification data (OTP, MP, PIN, or biometrics)\n   */\n  async verifyUser(verification: Verification): Promise<boolean> {\n    if (verification == null) {\n      throw new Error(\"Verification is required.\");\n    }\n\n    const [userId, email] = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((a) => [a?.id, a?.email])),\n    );\n\n    if (verificationHasSecret(verification)) {\n      this.validateSecretInput(verification);\n    }\n\n    switch (verification.type) {\n      case VerificationType.OTP:\n        return this.verifyUserByOTP(verification);\n      case VerificationType.MasterPassword:\n        return this.verifyUserByMasterPassword(verification, userId, email);\n      case VerificationType.PIN:\n        return this.verifyUserByPIN(verification, userId);\n      case VerificationType.Biometrics:\n        return this.verifyUserByBiometrics();\n      default: {\n        // Compile-time check for exhaustive switch\n        const _exhaustiveCheck: never = verification;\n        return _exhaustiveCheck;\n      }\n    }\n  }\n\n  private async verifyUserByOTP(verification: OtpVerification): Promise<boolean> {\n    const request = new VerifyOTPRequest(verification.secret);\n    try {\n      await this.userVerificationApiService.postAccountVerifyOTP(request);\n    } catch (e) {\n      throw new Error(this.i18nService.t(\"invalidVerificationCode\"));\n    }\n    return true;\n  }\n\n  private async verifyUserByMasterPassword(\n    verification: MasterPasswordVerification,\n    userId: UserId,\n    email: string,\n  ): Promise<boolean> {\n    if (!userId) {\n      throw new Error(\"User ID is required. Cannot verify user by master password.\");\n    }\n\n    let masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    if (!masterKey) {\n      masterKey = await this.cryptoService.makeMasterKey(\n        verification.secret,\n        email,\n        await this.kdfConfigService.getKdfConfig(),\n      );\n    }\n    const passwordValid = await this.cryptoService.compareAndUpdateKeyHash(\n      verification.secret,\n      masterKey,\n    );\n    if (!passwordValid) {\n      throw new Error(this.i18nService.t(\"invalidMasterPassword\"));\n    }\n    // TODO: we should re-evaluate later on if user verification should have the side effect of modifying state. Probably not.\n    await this.masterPasswordService.setMasterKey(masterKey, userId);\n    return true;\n  }\n\n  private async verifyUserByPIN(verification: PinVerification, userId: UserId): Promise<boolean> {\n    if (!userId) {\n      throw new Error(\"User ID is required. Cannot verify user by PIN.\");\n    }\n\n    const userKey = await this.pinService.decryptUserKeyWithPin(verification.secret, userId);\n\n    return userKey != null;\n  }\n\n  private async verifyUserByBiometrics(): Promise<boolean> {\n    let userKey: UserKey;\n    // Biometrics crashes and doesn't return a value if the user cancels the prompt\n    try {\n      userKey = await this.cryptoService.getUserKeyFromStorage(KeySuffixOptions.Biometric);\n    } catch (e) {\n      this.logService.error(`Biometrics User Verification failed: ${e.message}`);\n      // So, any failures should be treated as a failed verification\n      return false;\n    }\n\n    return userKey != null;\n  }\n\n  async requestOTP() {\n    await this.userVerificationApiService.postAccountRequestOTP();\n  }\n\n  /**\n   * Check if user has master password or can only use passwordless technologies to log in\n   * Note: This only checks the server, not the local state\n   * @param userId The user id to check. If not provided, the current user is used\n   * @returns True if the user has a master password\n   * @deprecated Use UserDecryptionOptionsService.hasMasterPassword$ instead\n   */\n  async hasMasterPassword(userId?: string): Promise<boolean> {\n    if (userId) {\n      const decryptionOptions = await firstValueFrom(\n        this.userDecryptionOptionsService.userDecryptionOptionsById$(userId),\n      );\n\n      if (decryptionOptions?.hasMasterPassword != undefined) {\n        return decryptionOptions.hasMasterPassword;\n      }\n    }\n    return await firstValueFrom(this.userDecryptionOptionsService.hasMasterPassword$);\n  }\n\n  async hasMasterPasswordAndMasterKeyHash(userId?: string): Promise<boolean> {\n    userId ??= (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    return (\n      (await this.hasMasterPassword(userId)) &&\n      (await firstValueFrom(this.masterPasswordService.masterKeyHash$(userId as UserId))) != null\n    );\n  }\n\n  private validateSecretInput(verification: VerificationWithSecret) {\n    if (verification?.secret == null || verification.secret === \"\") {\n      switch (verification.type) {\n        case VerificationType.OTP:\n          throw new Error(this.i18nService.t(\"verificationCodeRequired\"));\n        case VerificationType.MasterPassword:\n          throw new Error(this.i18nService.t(\"masterPasswordRequired\"));\n        case VerificationType.PIN:\n          throw new Error(this.i18nService.t(\"pinRequired\"));\n      }\n    }\n  }\n}\n","import { VerificationType } from \"../enums/verification-type\";\n\nexport type OtpVerification = { type: VerificationType.OTP; secret: string };\nexport type MasterPasswordVerification = { type: VerificationType.MasterPassword; secret: string };\nexport type PinVerification = { type: VerificationType.PIN; secret: string };\nexport type BiometricsVerification = { type: VerificationType.Biometrics };\n\nexport type VerificationWithSecret = OtpVerification | MasterPasswordVerification | PinVerification;\nexport type VerificationWithoutSecret = BiometricsVerification;\n\nexport type Verification = VerificationWithSecret | VerificationWithoutSecret;\n\nexport function verificationHasSecret(\n  verification: Verification,\n): verification is VerificationWithSecret {\n  return \"secret\" in verification;\n}\n\nexport type ServerSideVerification = OtpVerification | MasterPasswordVerification;\n","export const TYPE_CHECK = {\n  FUNCTION: \"function\",\n  NUMBER: \"number\",\n  STRING: \"string\",\n} as const;\n\nexport const EVENTS = {\n  CHANGE: \"change\",\n  INPUT: \"input\",\n  KEYDOWN: \"keydown\",\n  KEYPRESS: \"keypress\",\n  KEYUP: \"keyup\",\n  BLUR: \"blur\",\n  CLICK: \"click\",\n  FOCUS: \"focus\",\n  SCROLL: \"scroll\",\n  RESIZE: \"resize\",\n  DOMCONTENTLOADED: \"DOMContentLoaded\",\n  LOAD: \"load\",\n  MESSAGE: \"message\",\n  VISIBILITYCHANGE: \"visibilitychange\",\n  FOCUSOUT: \"focusout\",\n} as const;\n\nexport const ClearClipboardDelay = {\n  Never: null as null,\n  TenSeconds: 10,\n  TwentySeconds: 20,\n  ThirtySeconds: 30,\n  OneMinute: 60,\n  TwoMinutes: 120,\n  FiveMinutes: 300,\n} as const;\n\n/* Context Menu item Ids */\nexport const AUTOFILL_CARD_ID = \"autofill-card\";\nexport const AUTOFILL_ID = \"autofill\";\nexport const SHOW_AUTOFILL_BUTTON = \"show-autofill-button\";\nexport const AUTOFILL_IDENTITY_ID = \"autofill-identity\";\nexport const COPY_IDENTIFIER_ID = \"copy-identifier\";\nexport const COPY_PASSWORD_ID = \"copy-password\";\nexport const COPY_USERNAME_ID = \"copy-username\";\nexport const COPY_VERIFICATION_CODE_ID = \"copy-totp\";\nexport const CREATE_CARD_ID = \"create-card\";\nexport const CREATE_IDENTITY_ID = \"create-identity\";\nexport const CREATE_LOGIN_ID = \"create-login\";\nexport const GENERATE_PASSWORD_ID = \"generate-password\";\nexport const NOOP_COMMAND_SUFFIX = \"noop\";\nexport const ROOT_ID = \"root\";\nexport const SEPARATOR_ID = \"separator\";\n\nexport const NOTIFICATION_BAR_LIFESPAN_MS = 150000; // 150 seconds\n\nexport const AutofillOverlayVisibility = {\n  Off: 0,\n  OnButtonClick: 1,\n  OnFieldFocus: 2,\n} as const;\n","import { map, Observable } from \"rxjs\";\n\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../admin-console/enums\";\nimport {\n  AUTOFILL_SETTINGS_DISK,\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  ActiveUserState,\n  GlobalState,\n  KeyDefinition,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\nimport { ClearClipboardDelay, AutofillOverlayVisibility } from \"../constants\";\nimport { ClearClipboardDelaySetting, InlineMenuVisibilitySetting } from \"../types\";\n\nconst AUTOFILL_ON_PAGE_LOAD = new UserKeyDefinition(AUTOFILL_SETTINGS_DISK, \"autofillOnPageLoad\", {\n  deserializer: (value: boolean) => value ?? false,\n  clearOn: [],\n});\n\nconst AUTOFILL_ON_PAGE_LOAD_DEFAULT = new UserKeyDefinition(\n  AUTOFILL_SETTINGS_DISK,\n  \"autofillOnPageLoadDefault\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n    clearOn: [],\n  },\n);\n\nconst AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED = new UserKeyDefinition(\n  AUTOFILL_SETTINGS_DISK,\n  \"autofillOnPageLoadCalloutIsDismissed\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n    clearOn: [],\n  },\n);\n\nconst AUTOFILL_ON_PAGE_LOAD_POLICY_TOAST_HAS_DISPLAYED = new UserKeyDefinition(\n  AUTOFILL_SETTINGS_DISK,\n  \"autofillOnPageLoadPolicyToastHasDisplayed\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n    clearOn: [],\n  },\n);\n\nconst AUTO_COPY_TOTP = new UserKeyDefinition(AUTOFILL_SETTINGS_DISK, \"autoCopyTotp\", {\n  deserializer: (value: boolean) => value ?? true,\n  clearOn: [],\n});\n\nconst INLINE_MENU_VISIBILITY = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  \"inlineMenuVisibility\",\n  {\n    deserializer: (value: InlineMenuVisibilitySetting) => value ?? AutofillOverlayVisibility.Off,\n  },\n);\n\nconst ENABLE_CONTEXT_MENU = new KeyDefinition(AUTOFILL_SETTINGS_DISK, \"enableContextMenu\", {\n  deserializer: (value: boolean) => value ?? true,\n});\n\nconst CLEAR_CLIPBOARD_DELAY = new UserKeyDefinition(\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  \"clearClipboardDelay\",\n  {\n    deserializer: (value: ClearClipboardDelaySetting) => value ?? ClearClipboardDelay.Never,\n    clearOn: [],\n  },\n);\n\nexport abstract class AutofillSettingsServiceAbstraction {\n  autofillOnPageLoad$: Observable<boolean>;\n  setAutofillOnPageLoad: (newValue: boolean) => Promise<void>;\n  autofillOnPageLoadDefault$: Observable<boolean>;\n  setAutofillOnPageLoadDefault: (newValue: boolean) => Promise<void>;\n  autofillOnPageLoadCalloutIsDismissed$: Observable<boolean>;\n  setAutofillOnPageLoadCalloutIsDismissed: (newValue: boolean) => Promise<void>;\n  activateAutofillOnPageLoadFromPolicy$: Observable<boolean>;\n  setAutofillOnPageLoadPolicyToastHasDisplayed: (newValue: boolean) => Promise<void>;\n  autofillOnPageLoadPolicyToastHasDisplayed$: Observable<boolean>;\n  autoCopyTotp$: Observable<boolean>;\n  setAutoCopyTotp: (newValue: boolean) => Promise<void>;\n  inlineMenuVisibility$: Observable<InlineMenuVisibilitySetting>;\n  setInlineMenuVisibility: (newValue: InlineMenuVisibilitySetting) => Promise<void>;\n  enableContextMenu$: Observable<boolean>;\n  setEnableContextMenu: (newValue: boolean) => Promise<void>;\n  clearClipboardDelay$: Observable<ClearClipboardDelaySetting>;\n  setClearClipboardDelay: (newValue: ClearClipboardDelaySetting) => Promise<void>;\n}\n\nexport class AutofillSettingsService implements AutofillSettingsServiceAbstraction {\n  private autofillOnPageLoadState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoad$: Observable<boolean>;\n\n  private autofillOnPageLoadDefaultState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoadDefault$: Observable<boolean>;\n\n  private autofillOnPageLoadCalloutIsDismissedState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoadCalloutIsDismissed$: Observable<boolean>;\n\n  readonly activateAutofillOnPageLoadFromPolicy$: Observable<boolean>;\n\n  private autofillOnPageLoadPolicyToastHasDisplayedState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoadPolicyToastHasDisplayed$: Observable<boolean>;\n\n  private autoCopyTotpState: ActiveUserState<boolean>;\n  readonly autoCopyTotp$: Observable<boolean>;\n\n  private inlineMenuVisibilityState: GlobalState<InlineMenuVisibilitySetting>;\n  readonly inlineMenuVisibility$: Observable<InlineMenuVisibilitySetting>;\n\n  private enableContextMenuState: GlobalState<boolean>;\n  readonly enableContextMenu$: Observable<boolean>;\n\n  private clearClipboardDelayState: ActiveUserState<ClearClipboardDelaySetting>;\n  readonly clearClipboardDelay$: Observable<ClearClipboardDelaySetting>;\n\n  constructor(\n    private stateProvider: StateProvider,\n    private policyService: PolicyService,\n  ) {\n    this.autofillOnPageLoadState = this.stateProvider.getActive(AUTOFILL_ON_PAGE_LOAD);\n    this.autofillOnPageLoad$ = this.autofillOnPageLoadState.state$.pipe(map((x) => x ?? false));\n\n    this.autofillOnPageLoadDefaultState = this.stateProvider.getActive(\n      AUTOFILL_ON_PAGE_LOAD_DEFAULT,\n    );\n    this.autofillOnPageLoadDefault$ = this.autofillOnPageLoadDefaultState.state$.pipe(\n      map((x) => x ?? true),\n    );\n\n    this.autofillOnPageLoadCalloutIsDismissedState = this.stateProvider.getActive(\n      AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED,\n    );\n    this.autofillOnPageLoadCalloutIsDismissed$ =\n      this.autofillOnPageLoadCalloutIsDismissedState.state$.pipe(map((x) => x ?? false));\n\n    this.activateAutofillOnPageLoadFromPolicy$ = this.policyService.policyAppliesToActiveUser$(\n      PolicyType.ActivateAutofill,\n    );\n\n    this.autofillOnPageLoadPolicyToastHasDisplayedState = this.stateProvider.getActive(\n      AUTOFILL_ON_PAGE_LOAD_POLICY_TOAST_HAS_DISPLAYED,\n    );\n    this.autofillOnPageLoadPolicyToastHasDisplayed$ = this.autofillOnPageLoadState.state$.pipe(\n      map((x) => x ?? false),\n    );\n\n    this.autoCopyTotpState = this.stateProvider.getActive(AUTO_COPY_TOTP);\n    this.autoCopyTotp$ = this.autoCopyTotpState.state$.pipe(map((x) => x ?? true));\n\n    this.inlineMenuVisibilityState = this.stateProvider.getGlobal(INLINE_MENU_VISIBILITY);\n    this.inlineMenuVisibility$ = this.inlineMenuVisibilityState.state$.pipe(\n      map((x) => x ?? AutofillOverlayVisibility.Off),\n    );\n\n    this.enableContextMenuState = this.stateProvider.getGlobal(ENABLE_CONTEXT_MENU);\n    this.enableContextMenu$ = this.enableContextMenuState.state$.pipe(map((x) => x ?? true));\n\n    this.clearClipboardDelayState = this.stateProvider.getActive(CLEAR_CLIPBOARD_DELAY);\n    this.clearClipboardDelay$ = this.clearClipboardDelayState.state$.pipe(\n      map((x) => x ?? ClearClipboardDelay.Never),\n    );\n  }\n\n  async setAutofillOnPageLoad(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadState.update(() => newValue);\n  }\n\n  async setAutofillOnPageLoadDefault(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadDefaultState.update(() => newValue);\n  }\n\n  async setAutofillOnPageLoadCalloutIsDismissed(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadCalloutIsDismissedState.update(() => newValue);\n  }\n\n  async setAutofillOnPageLoadPolicyToastHasDisplayed(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadPolicyToastHasDisplayedState.update(() => newValue);\n  }\n\n  async setAutoCopyTotp(newValue: boolean): Promise<void> {\n    await this.autoCopyTotpState.update(() => newValue);\n  }\n\n  async setInlineMenuVisibility(newValue: InlineMenuVisibilitySetting): Promise<void> {\n    await this.inlineMenuVisibilityState.update(() => newValue);\n  }\n\n  async setEnableContextMenu(newValue: boolean): Promise<void> {\n    await this.enableContextMenuState.update(() => newValue);\n  }\n\n  async setClearClipboardDelay(newValue: ClearClipboardDelaySetting): Promise<void> {\n    await this.clearClipboardDelayState.update(() => newValue);\n  }\n}\n","import { map, Observable } from \"rxjs\";\n\nimport {\n  BADGE_SETTINGS_DISK,\n  ActiveUserState,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\n\nconst ENABLE_BADGE_COUNTER = new UserKeyDefinition(BADGE_SETTINGS_DISK, \"enableBadgeCounter\", {\n  deserializer: (value: boolean) => value ?? true,\n  clearOn: [],\n});\n\nexport abstract class BadgeSettingsServiceAbstraction {\n  enableBadgeCounter$: Observable<boolean>;\n  setEnableBadgeCounter: (newValue: boolean) => Promise<void>;\n}\n\nexport class BadgeSettingsService implements BadgeSettingsServiceAbstraction {\n  private enableBadgeCounterState: ActiveUserState<boolean>;\n  readonly enableBadgeCounter$: Observable<boolean>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.enableBadgeCounterState = this.stateProvider.getActive(ENABLE_BADGE_COUNTER);\n    this.enableBadgeCounter$ = this.enableBadgeCounterState.state$.pipe(map((x) => x ?? true));\n  }\n\n  async setEnableBadgeCounter(newValue: boolean): Promise<void> {\n    await this.enableBadgeCounterState.update(() => newValue);\n  }\n}\n","/*\n  See full documentation at:\n    https://bitwarden.com/help/uri-match-detection/#match-detection-options\n\n  Domain: \"the top-level domain and second-level domain of the URI match the detected resource\",\n  Host: \"the hostname and (if specified) port of the URI matches the detected resource\",\n  StartsWith: \"the detected resource starts with the URI, regardless of what follows it\",\n  Exact: \"the URI matches the detected resource exactly\",\n  RegularExpression: \"the detected resource matches a specified regular expression\",\n  Never: \"never offer auto-fill for the item\",\n*/\nexport const UriMatchStrategy = {\n  Domain: 0,\n  Host: 1,\n  StartsWith: 2,\n  Exact: 3,\n  RegularExpression: 4,\n  Never: 5,\n} as const;\n\nexport type UriMatchStrategySetting = (typeof UriMatchStrategy)[keyof typeof UriMatchStrategy];\n\nexport type NeverDomains = { [id: string]: unknown };\nexport type EquivalentDomains = string[][];\n","import { map, Observable } from \"rxjs\";\n\nimport {\n  NeverDomains,\n  EquivalentDomains,\n  UriMatchStrategySetting,\n  UriMatchStrategy,\n} from \"../../models/domain/domain-service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport {\n  DOMAIN_SETTINGS_DISK,\n  ActiveUserState,\n  GlobalState,\n  KeyDefinition,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../platform/state\";\n\nconst SHOW_FAVICONS = new KeyDefinition(DOMAIN_SETTINGS_DISK, \"showFavicons\", {\n  deserializer: (value: boolean) => value ?? true,\n});\n\nconst NEVER_DOMAINS = new KeyDefinition(DOMAIN_SETTINGS_DISK, \"neverDomains\", {\n  deserializer: (value: NeverDomains) => value ?? null,\n});\n\nconst EQUIVALENT_DOMAINS = new UserKeyDefinition(DOMAIN_SETTINGS_DISK, \"equivalentDomains\", {\n  deserializer: (value: EquivalentDomains) => value ?? null,\n  clearOn: [\"logout\"],\n});\n\nconst DEFAULT_URI_MATCH_STRATEGY = new UserKeyDefinition(\n  DOMAIN_SETTINGS_DISK,\n  \"defaultUriMatchStrategy\",\n  {\n    deserializer: (value: UriMatchStrategySetting) => value ?? UriMatchStrategy.Domain,\n    clearOn: [],\n  },\n);\n\nexport abstract class DomainSettingsService {\n  showFavicons$: Observable<boolean>;\n  setShowFavicons: (newValue: boolean) => Promise<void>;\n  neverDomains$: Observable<NeverDomains>;\n  setNeverDomains: (newValue: NeverDomains) => Promise<void>;\n  equivalentDomains$: Observable<EquivalentDomains>;\n  setEquivalentDomains: (newValue: EquivalentDomains) => Promise<void>;\n  defaultUriMatchStrategy$: Observable<UriMatchStrategySetting>;\n  setDefaultUriMatchStrategy: (newValue: UriMatchStrategySetting) => Promise<void>;\n  getUrlEquivalentDomains: (url: string) => Observable<Set<string>>;\n}\n\nexport class DefaultDomainSettingsService implements DomainSettingsService {\n  private showFaviconsState: GlobalState<boolean>;\n  readonly showFavicons$: Observable<boolean>;\n\n  private neverDomainsState: GlobalState<NeverDomains>;\n  readonly neverDomains$: Observable<NeverDomains>;\n\n  private equivalentDomainsState: ActiveUserState<EquivalentDomains>;\n  readonly equivalentDomains$: Observable<EquivalentDomains>;\n\n  private defaultUriMatchStrategyState: ActiveUserState<UriMatchStrategySetting>;\n  readonly defaultUriMatchStrategy$: Observable<UriMatchStrategySetting>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.showFaviconsState = this.stateProvider.getGlobal(SHOW_FAVICONS);\n    this.showFavicons$ = this.showFaviconsState.state$.pipe(map((x) => x ?? true));\n\n    this.neverDomainsState = this.stateProvider.getGlobal(NEVER_DOMAINS);\n    this.neverDomains$ = this.neverDomainsState.state$.pipe(map((x) => x ?? null));\n\n    this.equivalentDomainsState = this.stateProvider.getActive(EQUIVALENT_DOMAINS);\n    this.equivalentDomains$ = this.equivalentDomainsState.state$.pipe(map((x) => x ?? null));\n\n    this.defaultUriMatchStrategyState = this.stateProvider.getActive(DEFAULT_URI_MATCH_STRATEGY);\n    this.defaultUriMatchStrategy$ = this.defaultUriMatchStrategyState.state$.pipe(\n      map((x) => x ?? UriMatchStrategy.Domain),\n    );\n  }\n\n  async setShowFavicons(newValue: boolean): Promise<void> {\n    await this.showFaviconsState.update(() => newValue);\n  }\n\n  async setNeverDomains(newValue: NeverDomains): Promise<void> {\n    await this.neverDomainsState.update(() => newValue);\n  }\n\n  async setEquivalentDomains(newValue: EquivalentDomains): Promise<void> {\n    await this.equivalentDomainsState.update(() => newValue);\n  }\n\n  async setDefaultUriMatchStrategy(newValue: UriMatchStrategySetting): Promise<void> {\n    await this.defaultUriMatchStrategyState.update(() => newValue);\n  }\n\n  getUrlEquivalentDomains(url: string): Observable<Set<string>> {\n    const domains$ = this.equivalentDomains$.pipe(\n      map((equivalentDomains) => {\n        const domain = Utils.getDomain(url);\n        if (domain == null || equivalentDomains == null) {\n          return new Set() as Set<string>;\n        }\n\n        const equivalents = equivalentDomains.filter((ed) => ed.includes(domain)).flat();\n\n        return new Set(equivalents);\n      }),\n    );\n\n    return domains$;\n  }\n}\n","import { map, Observable } from \"rxjs\";\n\nimport {\n  USER_NOTIFICATION_SETTINGS_DISK,\n  GlobalState,\n  KeyDefinition,\n  StateProvider,\n} from \"../../platform/state\";\n\nconst ENABLE_ADDED_LOGIN_PROMPT = new KeyDefinition(\n  USER_NOTIFICATION_SETTINGS_DISK,\n  \"enableAddedLoginPrompt\",\n  {\n    deserializer: (value: boolean) => value ?? true,\n  },\n);\nconst ENABLE_CHANGED_PASSWORD_PROMPT = new KeyDefinition(\n  USER_NOTIFICATION_SETTINGS_DISK,\n  \"enableChangedPasswordPrompt\",\n  {\n    deserializer: (value: boolean) => value ?? true,\n  },\n);\n\nexport abstract class UserNotificationSettingsServiceAbstraction {\n  enableAddedLoginPrompt$: Observable<boolean>;\n  setEnableAddedLoginPrompt: (newValue: boolean) => Promise<void>;\n  enableChangedPasswordPrompt$: Observable<boolean>;\n  setEnableChangedPasswordPrompt: (newValue: boolean) => Promise<void>;\n}\n\nexport class UserNotificationSettingsService implements UserNotificationSettingsServiceAbstraction {\n  private enableAddedLoginPromptState: GlobalState<boolean>;\n  readonly enableAddedLoginPrompt$: Observable<boolean>;\n\n  private enableChangedPasswordPromptState: GlobalState<boolean>;\n  readonly enableChangedPasswordPrompt$: Observable<boolean>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.enableAddedLoginPromptState = this.stateProvider.getGlobal(ENABLE_ADDED_LOGIN_PROMPT);\n    this.enableAddedLoginPrompt$ = this.enableAddedLoginPromptState.state$.pipe(\n      map((x) => x ?? true),\n    );\n\n    this.enableChangedPasswordPromptState = this.stateProvider.getGlobal(\n      ENABLE_CHANGED_PASSWORD_PROMPT,\n    );\n    this.enableChangedPasswordPrompt$ = this.enableChangedPasswordPromptState.state$.pipe(\n      map((x) => x ?? true),\n    );\n  }\n\n  async setEnableAddedLoginPrompt(newValue: boolean): Promise<void> {\n    await this.enableAddedLoginPromptState.update(() => newValue);\n  }\n\n  async setEnableChangedPasswordPrompt(newValue: boolean): Promise<void> {\n    await this.enableChangedPasswordPromptState.update(() => newValue);\n  }\n}\n","import { map, Observable, of, switchMap } from \"rxjs\";\n\nimport {\n  ActiveUserState,\n  BILLING_DISK,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../../../platform/state\";\nimport {\n  BillingAccountProfile,\n  BillingAccountProfileStateService,\n} from \"../../abstractions/account/billing-account-profile-state.service\";\n\nexport const BILLING_ACCOUNT_PROFILE_KEY_DEFINITION = new UserKeyDefinition<BillingAccountProfile>(\n  BILLING_DISK,\n  \"accountProfile\",\n  {\n    deserializer: (billingAccountProfile) => billingAccountProfile,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport class DefaultBillingAccountProfileStateService implements BillingAccountProfileStateService {\n  private billingAccountProfileState: ActiveUserState<BillingAccountProfile>;\n\n  hasPremiumFromAnyOrganization$: Observable<boolean>;\n  hasPremiumPersonally$: Observable<boolean>;\n  hasPremiumFromAnySource$: Observable<boolean>;\n\n  constructor(stateProvider: StateProvider) {\n    this.billingAccountProfileState = stateProvider.getActive(\n      BILLING_ACCOUNT_PROFILE_KEY_DEFINITION,\n    );\n\n    // Setup an observable that will always track the currently active user\n    // but will fallback to emitting null when there is no active user.\n    const billingAccountProfileOrNull = stateProvider.activeUserId$.pipe(\n      switchMap((userId) =>\n        userId != null\n          ? stateProvider.getUser(userId, BILLING_ACCOUNT_PROFILE_KEY_DEFINITION).state$\n          : of(null),\n      ),\n    );\n\n    this.hasPremiumFromAnyOrganization$ = billingAccountProfileOrNull.pipe(\n      map((billingAccountProfile) => !!billingAccountProfile?.hasPremiumFromAnyOrganization),\n    );\n\n    this.hasPremiumPersonally$ = billingAccountProfileOrNull.pipe(\n      map((billingAccountProfile) => !!billingAccountProfile?.hasPremiumPersonally),\n    );\n\n    this.hasPremiumFromAnySource$ = billingAccountProfileOrNull.pipe(\n      map(\n        (billingAccountProfile) =>\n          billingAccountProfile?.hasPremiumFromAnyOrganization === true ||\n          billingAccountProfile?.hasPremiumPersonally === true,\n      ),\n    );\n  }\n\n  async setHasPremium(\n    hasPremiumPersonally: boolean,\n    hasPremiumFromAnyOrganization: boolean,\n  ): Promise<void> {\n    await this.billingAccountProfileState.update((billingAccountProfile) => {\n      return {\n        hasPremiumPersonally: hasPremiumPersonally,\n        hasPremiumFromAnyOrganization: hasPremiumFromAnyOrganization,\n      };\n    });\n  }\n}\n","import { UserId } from \"../../types/guid\";\nimport { EncryptedString } from \"../models/domain/enc-string\";\nimport { KeyDefinition, BIOMETRIC_SETTINGS_DISK, UserKeyDefinition } from \"../state\";\n\n/**\n * Indicates whether the user elected to store a biometric key to unlock their vault.\n */\nexport const BIOMETRIC_UNLOCK_ENABLED = new UserKeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"biometricUnlockEnabled\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [],\n  },\n);\n\n/**\n * Boolean indicating the user has elected to require a password to use their biometric key upon starting the application.\n *\n * A true setting controls whether {@link ENCRYPTED_CLIENT_KEY_HALF} is set.\n */\nexport const REQUIRE_PASSWORD_ON_START = new UserKeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"requirePasswordOnStart\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/**\n * If the user has elected to require a password on first unlock of an application instance, this key will store the\n * encrypted client key half used to unlock the vault.\n *\n * For operating systems without application-level key storage, this key half is concatenated with a signature\n * provided by the OS and used to encrypt the biometric key prior to storage.\n */\nexport const ENCRYPTED_CLIENT_KEY_HALF = new UserKeyDefinition<EncryptedString>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"clientKeyHalf\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * Indicates the user has been warned about the security implications of using biometrics and, depending on the OS,\n * recommended to require a password on first unlock of an application instance.\n */\nexport const DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT = new UserKeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"dismissedBiometricRequirePasswordOnStartCallout\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [],\n  },\n);\n\n/**\n * Stores whether the user has elected to cancel the biometric prompt. This is stored on disk due to process-reload\n * wiping memory state. We don't want to prompt the user again if they've elected to cancel.\n */\nexport const PROMPT_CANCELLED = KeyDefinition.record<boolean, UserId>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"promptCancelled\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\n/**\n * Stores whether the user has elected to automatically prompt for biometric unlock on application start.\n */\nexport const PROMPT_AUTOMATICALLY = new UserKeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"promptAutomatically\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [],\n  },\n);\n\n/**\n * Stores whether or not IPC handshake has been validated this session.\n */\nexport const FINGERPRINT_VALIDATED = new KeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"fingerprintValidated\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n","import { Observable, firstValueFrom, map, combineLatest } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { EncryptedString, EncString } from \"../models/domain/enc-string\";\nimport { ActiveUserState, GlobalState, StateProvider } from \"../state\";\n\nimport {\n  BIOMETRIC_UNLOCK_ENABLED,\n  ENCRYPTED_CLIENT_KEY_HALF,\n  REQUIRE_PASSWORD_ON_START,\n  DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT,\n  PROMPT_AUTOMATICALLY,\n  PROMPT_CANCELLED,\n  FINGERPRINT_VALIDATED,\n} from \"./biometric.state\";\n\nexport abstract class BiometricStateService {\n  /**\n   * `true` if the currently active user has elected to store a biometric key to unlock their vault.\n   */\n  abstract biometricUnlockEnabled$: Observable<boolean>; // used to be biometricUnlock\n  /**\n   * If the user has elected to require a password on first unlock of an application instance, this key will store the\n   * encrypted client key half used to unlock the vault.\n   *\n   * Tracks the currently active user\n   */\n  abstract encryptedClientKeyHalf$: Observable<EncString | undefined>;\n  /**\n   * whether or not a password is required on first unlock after opening the application\n   *\n   * tracks the currently active user\n   */\n  abstract requirePasswordOnStart$: Observable<boolean>;\n  /**\n   * Indicates the user has been warned about the security implications of using biometrics and, depending on the OS,\n   *\n   * tracks the currently active user.\n   */\n  abstract dismissedRequirePasswordOnStartCallout$: Observable<boolean>;\n  /**\n   * Whether the user has cancelled the biometric prompt.\n   *\n   * tracks the currently active user\n   */\n  abstract promptCancelled$: Observable<boolean>;\n  /**\n   * Whether the user has elected to automatically prompt for biometrics.\n   *\n   * tracks the currently active user\n   */\n  abstract promptAutomatically$: Observable<boolean>;\n  /**\n   * Whether or not IPC fingerprint has been validated by the user this session.\n   */\n  abstract fingerprintValidated$: Observable<boolean>;\n\n  /**\n   * Updates the require password on start state for the currently active user.\n   *\n   * If false, the encrypted client key half will be removed.\n   * @param value whether or not a password is required on first unlock after opening the application\n   */\n  abstract setRequirePasswordOnStart(value: boolean): Promise<void>;\n  /**\n   * Updates the biometric unlock enabled state for the currently active user.\n   * @param enabled whether or not to store a biometric key to unlock the vault\n   */\n  abstract setBiometricUnlockEnabled(enabled: boolean): Promise<void>;\n  /**\n   * Gets the biometric unlock enabled state for the given user.\n   * @param userId user Id to check\n   */\n  abstract getBiometricUnlockEnabled(userId: UserId): Promise<boolean>;\n  abstract setEncryptedClientKeyHalf(encryptedKeyHalf: EncString, userId?: UserId): Promise<void>;\n  abstract getEncryptedClientKeyHalf(userId: UserId): Promise<EncString>;\n  abstract getRequirePasswordOnStart(userId: UserId): Promise<boolean>;\n  abstract removeEncryptedClientKeyHalf(userId: UserId): Promise<void>;\n  /**\n   * Updates the active user's state to reflect that they've been warned about requiring password on start.\n   */\n  abstract setDismissedRequirePasswordOnStartCallout(): Promise<void>;\n  /**\n   * Updates the active user's state to reflect that they've cancelled the biometric prompt.\n   */\n  abstract setUserPromptCancelled(): Promise<void>;\n  /**\n   * Resets the given user's state to reflect that they haven't cancelled the biometric prompt.\n   * @param userId the user to reset the prompt cancelled state for. If not provided, the currently active user will be used.\n   */\n  abstract resetUserPromptCancelled(userId?: UserId): Promise<void>;\n  /**\n   * Resets all user's state to reflect that they haven't cancelled the biometric prompt.\n   */\n  abstract resetAllPromptCancelled(): Promise<void>;\n  /**\n   * Updates the currently active user's setting for auto prompting for biometrics on application start and lock\n   * @param prompt Whether or not to prompt for biometrics on application start.\n   */\n  abstract setPromptAutomatically(prompt: boolean): Promise<void>;\n  /**\n   * Updates whether or not IPC has been validated by the user this session\n   * @param validated the value to save\n   */\n  abstract setFingerprintValidated(validated: boolean): Promise<void>;\n\n  abstract logout(userId: UserId): Promise<void>;\n}\n\nexport class DefaultBiometricStateService implements BiometricStateService {\n  private biometricUnlockEnabledState: ActiveUserState<boolean>;\n  private requirePasswordOnStartState: ActiveUserState<boolean>;\n  private encryptedClientKeyHalfState: ActiveUserState<EncryptedString | undefined>;\n  private dismissedRequirePasswordOnStartCalloutState: ActiveUserState<boolean>;\n  private promptCancelledState: GlobalState<Record<UserId, boolean>>;\n  private promptAutomaticallyState: ActiveUserState<boolean>;\n  private fingerprintValidatedState: GlobalState<boolean>;\n  biometricUnlockEnabled$: Observable<boolean>;\n  encryptedClientKeyHalf$: Observable<EncString | undefined>;\n  requirePasswordOnStart$: Observable<boolean>;\n  dismissedRequirePasswordOnStartCallout$: Observable<boolean>;\n  promptCancelled$: Observable<boolean>;\n  promptAutomatically$: Observable<boolean>;\n  fingerprintValidated$: Observable<boolean>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.biometricUnlockEnabledState = this.stateProvider.getActive(BIOMETRIC_UNLOCK_ENABLED);\n    this.biometricUnlockEnabled$ = this.biometricUnlockEnabledState.state$.pipe(map(Boolean));\n\n    this.requirePasswordOnStartState = this.stateProvider.getActive(REQUIRE_PASSWORD_ON_START);\n    this.requirePasswordOnStart$ = this.requirePasswordOnStartState.state$.pipe(\n      map((value) => !!value),\n    );\n\n    this.encryptedClientKeyHalfState = this.stateProvider.getActive(ENCRYPTED_CLIENT_KEY_HALF);\n    this.encryptedClientKeyHalf$ = this.encryptedClientKeyHalfState.state$.pipe(\n      map(encryptedClientKeyHalfToEncString),\n    );\n\n    this.dismissedRequirePasswordOnStartCalloutState = this.stateProvider.getActive(\n      DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT,\n    );\n    this.dismissedRequirePasswordOnStartCallout$ =\n      this.dismissedRequirePasswordOnStartCalloutState.state$.pipe(map(Boolean));\n\n    this.promptCancelledState = this.stateProvider.getGlobal(PROMPT_CANCELLED);\n    this.promptCancelled$ = combineLatest([\n      this.stateProvider.activeUserId$,\n      this.promptCancelledState.state$,\n    ]).pipe(\n      map(([userId, record]) => {\n        return record?.[userId] ?? false;\n      }),\n    );\n    this.promptAutomaticallyState = this.stateProvider.getActive(PROMPT_AUTOMATICALLY);\n    this.promptAutomatically$ = this.promptAutomaticallyState.state$.pipe(map(Boolean));\n\n    this.fingerprintValidatedState = this.stateProvider.getGlobal(FINGERPRINT_VALIDATED);\n    this.fingerprintValidated$ = this.fingerprintValidatedState.state$.pipe(map(Boolean));\n  }\n\n  async setBiometricUnlockEnabled(enabled: boolean): Promise<void> {\n    await this.biometricUnlockEnabledState.update(() => enabled);\n  }\n\n  async getBiometricUnlockEnabled(userId: UserId): Promise<boolean> {\n    return await firstValueFrom(\n      this.stateProvider.getUser(userId, BIOMETRIC_UNLOCK_ENABLED).state$.pipe(map(Boolean)),\n    );\n  }\n\n  async setRequirePasswordOnStart(value: boolean): Promise<void> {\n    let currentActiveId: UserId;\n    await this.requirePasswordOnStartState.update(\n      (_, [userId]) => {\n        currentActiveId = userId;\n        return value;\n      },\n      {\n        combineLatestWith: this.requirePasswordOnStartState.combinedState$,\n      },\n    );\n    if (!value) {\n      await this.removeEncryptedClientKeyHalf(currentActiveId);\n    }\n  }\n\n  async setEncryptedClientKeyHalf(encryptedKeyHalf: EncString, userId?: UserId): Promise<void> {\n    const value = encryptedKeyHalf?.encryptedString ?? null;\n    if (userId) {\n      await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => value);\n    } else {\n      await this.encryptedClientKeyHalfState.update(() => value);\n    }\n  }\n\n  async removeEncryptedClientKeyHalf(userId: UserId): Promise<void> {\n    await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => null);\n  }\n\n  async getRequirePasswordOnStart(userId: UserId): Promise<boolean> {\n    return !!(await firstValueFrom(\n      this.stateProvider.getUser(userId, REQUIRE_PASSWORD_ON_START).state$,\n    ));\n  }\n\n  async getEncryptedClientKeyHalf(userId: UserId): Promise<EncString> {\n    return await firstValueFrom(\n      this.stateProvider\n        .getUser(userId, ENCRYPTED_CLIENT_KEY_HALF)\n        .state$.pipe(map(encryptedClientKeyHalfToEncString)),\n    );\n  }\n\n  async logout(userId: UserId): Promise<void> {\n    await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => null);\n    await this.resetUserPromptCancelled(userId);\n    // Persist auto prompt setting through logout\n    // Persist dismissed require password on start callout through logout\n  }\n\n  async setDismissedRequirePasswordOnStartCallout(): Promise<void> {\n    await this.dismissedRequirePasswordOnStartCalloutState.update(() => true);\n  }\n\n  async resetUserPromptCancelled(userId: UserId): Promise<void> {\n    await this.stateProvider.getGlobal(PROMPT_CANCELLED).update(\n      (data, activeUserId) => {\n        delete data[userId ?? activeUserId];\n        return data;\n      },\n      {\n        combineLatestWith: this.stateProvider.activeUserId$,\n        shouldUpdate: (data, activeUserId) => data?.[userId ?? activeUserId] != null,\n      },\n    );\n  }\n\n  async setUserPromptCancelled(): Promise<void> {\n    await this.promptCancelledState.update(\n      (record, userId) => {\n        record ??= {};\n        record[userId] = true;\n        return record;\n      },\n      {\n        combineLatestWith: this.stateProvider.activeUserId$,\n        shouldUpdate: (_, userId) => {\n          if (userId == null) {\n            throw new Error(\n              \"Cannot update biometric prompt cancelled state without an active user\",\n            );\n          }\n          return true;\n        },\n      },\n    );\n  }\n\n  async resetAllPromptCancelled(): Promise<void> {\n    await this.promptCancelledState.update(() => null);\n  }\n\n  async setPromptAutomatically(prompt: boolean): Promise<void> {\n    await this.promptAutomaticallyState.update(() => prompt);\n  }\n\n  async setFingerprintValidated(validated: boolean): Promise<void> {\n    await this.fingerprintValidatedState.update(() => validated);\n  }\n}\n\nfunction encryptedClientKeyHalfToEncString(\n  encryptedKeyHalf: EncryptedString | undefined,\n): EncString {\n  return encryptedKeyHalf == null ? null : new EncString(encryptedKeyHalf);\n}\n","import { Account } from \"../models/domain/account\";\n\nexport class AccountFactory<T extends Account = Account> {\n  private accountConstructor: new (init: Partial<T>) => T;\n\n  constructor(accountConstructor: new (init: Partial<T>) => T) {\n    this.accountConstructor = accountConstructor;\n  }\n\n  create(args: Partial<T>) {\n    return new this.accountConstructor(args);\n  }\n}\n","import { GlobalState } from \"../models/domain/global-state\";\n\nexport class GlobalStateFactory<T extends GlobalState = GlobalState> {\n  private globalStateConstructor: new (init: Partial<T>) => T;\n\n  constructor(globalStateConstructor: new (init: Partial<T>) => T) {\n    this.globalStateConstructor = globalStateConstructor;\n  }\n\n  create(args?: Partial<T>) {\n    return new this.globalStateConstructor(args);\n  }\n}\n","import { Account } from \"../models/domain/account\";\nimport { GlobalState } from \"../models/domain/global-state\";\n\nimport { AccountFactory } from \"./account-factory\";\nimport { GlobalStateFactory } from \"./global-state-factory\";\n\nexport class StateFactory<\n  TGlobal extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> {\n  private globalStateFactory: GlobalStateFactory<TGlobal>;\n  private accountFactory: AccountFactory<TAccount>;\n\n  constructor(\n    globalStateConstructor: new (init: Partial<TGlobal>) => TGlobal,\n    accountConstructor: new (init: Partial<TAccount>) => TAccount,\n  ) {\n    this.globalStateFactory = new GlobalStateFactory(globalStateConstructor);\n    this.accountFactory = new AccountFactory(accountConstructor);\n  }\n\n  createGlobal(args: Partial<TGlobal>): TGlobal {\n    return this.globalStateFactory.create(args);\n  }\n\n  createAccount(args: Partial<TAccount>): TAccount {\n    return this.accountFactory.create(args);\n  }\n}\n","import { EMPTY, Observable, filter } from \"rxjs\";\n\nimport { Message, CommandDefinition } from \"./types\";\n\n/**\n * A class that allows for listening to messages coming through the application,\n * allows for listening of all messages or just the messages you care about.\n *\n * @note Consider NOT using messaging at all if you can. State Providers offer an observable stream of\n * data that is persisted. This can serve messages that might have been used to notify of settings changes\n * or vault data changes and those observables should be preferred over messaging.\n */\nexport class MessageListener {\n  constructor(private readonly messageStream: Observable<Message<Record<string, unknown>>>) {}\n\n  /**\n   * A stream of all messages sent through the application. It does not contain type information for the\n   * other properties on the messages. You are encouraged to instead subscribe to an individual message\n   * through {@link messages$}.\n   */\n  allMessages$ = this.messageStream;\n\n  /**\n   * Creates an observable stream filtered to just the command given via the {@link CommandDefinition} and typed\n   * to the generic contained in the CommandDefinition. Be careful using this method unless all your messages are being\n   * sent through `MessageSender.send`, if that isn't the case you should have lower confidence in the message\n   * payload being the expected type.\n   *\n   * @param commandDefinition The CommandDefinition containing the information about the message type you care about.\n   */\n  messages$<T extends Record<string, unknown>>(\n    commandDefinition: CommandDefinition<T>,\n  ): Observable<T> {\n    return this.allMessages$.pipe(\n      filter((msg) => msg?.command === commandDefinition.command),\n    ) as Observable<T>;\n  }\n\n  /**\n   * A helper property for returning a MessageListener that will never emit any messages and will immediately complete.\n   */\n  static readonly EMPTY = new MessageListener(EMPTY);\n}\n","import { CommandDefinition } from \"./types\";\n\nclass MultiMessageSender implements MessageSender {\n  constructor(private readonly innerMessageSenders: MessageSender[]) {}\n\n  send<T extends Record<string, unknown>>(\n    commandDefinition: string | CommandDefinition<T>,\n    payload: Record<string, unknown> | T = {},\n  ): void {\n    for (const messageSender of this.innerMessageSenders) {\n      messageSender.send(commandDefinition, payload);\n    }\n  }\n}\n\nexport abstract class MessageSender {\n  /**\n   * A method for sending messages in a type safe manner. The passed in command definition\n   * will require you to provide a compatible type in the payload parameter.\n   *\n   * @example\n   * const MY_COMMAND = new CommandDefinition<{ test: number }>(\"myCommand\");\n   *\n   * this.messageSender.send(MY_COMMAND, { test: 14 });\n   *\n   * @param commandDefinition\n   * @param payload\n   */\n  abstract send<T extends Record<string, unknown>>(\n    commandDefinition: CommandDefinition<T>,\n    payload: T,\n  ): void;\n\n  /**\n   * A legacy method for sending messages in a non-type safe way.\n   *\n   * @remarks Consider defining a {@link CommandDefinition} and passing that in for the first parameter to\n   * get compilation errors when defining an incompatible payload.\n   *\n   * @param command The string based command of your message.\n   * @param payload Extra contextual information regarding the message. Be aware that this payload may\n   *   be serialized and lose all prototype information.\n   */\n  abstract send(command: string, payload?: Record<string, unknown>): void;\n\n  /** Implementation of the other two overloads, read their docs instead. */\n  abstract send<T extends Record<string, unknown>>(\n    commandDefinition: CommandDefinition<T> | string,\n    payload: T | Record<string, unknown>,\n  ): void;\n\n  /**\n   * A helper method for combine multiple {@link MessageSender}'s.\n   * @param messageSenders The message senders that should be combined.\n   * @returns A message sender that will relay all messages to the given message senders.\n   */\n  static combine(...messageSenders: MessageSender[]) {\n    return new MultiMessageSender(messageSenders);\n  }\n\n  /**\n   * A helper property for creating a {@link MessageSender} that sends to nowhere.\n   */\n  static readonly EMPTY: MessageSender = new MultiMessageSender([]);\n}\n","declare const tag: unique symbol;\n\n/**\n * A class for defining information about a message, this is helpful\n * alonside `MessageSender` and `MessageListener` for providing a type\n * safe(-ish) way of sending and receiving messages.\n */\nexport class CommandDefinition<T extends Record<string, unknown>> {\n  [tag]: T;\n  constructor(readonly command: string) {}\n}\n\nexport type Message<T extends Record<string, unknown>> = { command: string } & T;\n","import { map } from \"rxjs\";\n\nimport { CommandDefinition } from \"./types\";\n\nexport const getCommand = (\n  commandDefinition: CommandDefinition<Record<string, unknown>> | string,\n) => {\n  if (typeof commandDefinition === \"string\") {\n    return commandDefinition;\n  } else {\n    return commandDefinition.command;\n  }\n};\n\nexport const EXTERNAL_SOURCE_TAG = Symbol(\"externalSource\");\n\nexport const isExternalMessage = (message: Record<PropertyKey, unknown>) => {\n  return message?.[EXTERNAL_SOURCE_TAG] === true;\n};\n\nexport const tagAsExternal = <T extends Record<PropertyKey, unknown>>() => {\n  return map((message: T) => {\n    return Object.assign(message, { [EXTERNAL_SOURCE_TAG]: true });\n  });\n};\n","import { Subject } from \"rxjs\";\n\nimport { getCommand } from \"./internal\";\nimport { MessageSender } from \"./message.sender\";\nimport { Message, CommandDefinition } from \"./types\";\n\nexport class SubjectMessageSender implements MessageSender {\n  constructor(private readonly messagesSubject: Subject<Message<Record<string, unknown>>>) {}\n\n  send<T extends Record<string, unknown>>(\n    commandDefinition: string | CommandDefinition<T>,\n    payload: Record<string, unknown> | T = {},\n  ): void {\n    const command = getCommand(commandDefinition);\n    this.messagesSubject.next(Object.assign(payload ?? {}, { command: command }));\n  }\n}\n","export class Lazy<T> {\n  private _value: T | undefined = undefined;\n  private _isCreated = false;\n\n  constructor(private readonly factory: () => T) {}\n\n  /**\n   * Resolves the factory and returns the result. Guaranteed to resolve the value only once.\n   *\n   * @returns The value produced by your factory.\n   */\n  get(): T {\n    if (!this._isCreated) {\n      this._value = this.factory();\n      this._isCreated = true;\n    }\n\n    return this._value as T;\n  }\n}\n","const caches = new Map<any, Map<string, Promise<any>>>();\n\nconst getCache = (obj: any) => {\n  let cache = caches.get(obj);\n  if (cache != null) {\n    return cache;\n  }\n  cache = new Map<string, Promise<any>>();\n  caches.set(obj, cache);\n  return cache;\n};\n\nexport function clearCaches() {\n  caches.clear();\n}\n\n/**\n * Use as a Decorator on async functions, it will prevent multiple 'active' calls as the same time\n *\n * If a promise was returned from a previous call to this function, that hasn't yet resolved it will\n * be returned, instead of calling the original function again\n *\n * Results are not cached, once the promise has returned, the next call will result in a fresh call\n *\n * Read more at https://github.com/bitwarden/jslib/pull/7\n */\nexport function sequentialize(cacheKey: (args: any[]) => string) {\n  return (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) => {\n    const originalMethod: () => Promise<any> = descriptor.value;\n\n    return {\n      value: function (...args: any[]) {\n        const cache = getCache(this);\n        const argsCacheKey = cacheKey(args);\n        let response = cache.get(argsCacheKey);\n        if (response != null) {\n          return response;\n        }\n\n        const onFinally = () => {\n          cache.delete(argsCacheKey);\n          if (cache.size === 0) {\n            caches.delete(this);\n          }\n        };\n        response = originalMethod\n          .apply(this, args)\n          .then((val: any) => {\n            onFinally();\n            return val;\n          })\n          .catch((err: any) => {\n            onFinally();\n            throw err;\n          });\n\n        cache.set(argsCacheKey, response);\n        return response;\n      },\n    };\n  };\n}\n","export class GlobalState {\n  enableBrowserIntegration?: boolean;\n  enableBrowserIntegrationFingerprint?: boolean;\n  enableDuckDuckGoBrowserIntegration?: boolean;\n}\n","import { Observable, filter, firstValueFrom, tap } from \"rxjs\";\n\nimport { AppIdService as AppIdServiceAbstraction } from \"../abstractions/app-id.service\";\nimport { Utils } from \"../misc/utils\";\nimport { APPLICATION_ID_DISK, GlobalStateProvider, KeyDefinition } from \"../state\";\n\nexport const APP_ID_KEY = new KeyDefinition(APPLICATION_ID_DISK, \"appId\", {\n  deserializer: (value: string) => value,\n});\nexport const ANONYMOUS_APP_ID_KEY = new KeyDefinition(APPLICATION_ID_DISK, \"anonymousAppId\", {\n  deserializer: (value: string) => value,\n});\n\nexport class AppIdService implements AppIdServiceAbstraction {\n  appId$: Observable<string>;\n  anonymousAppId$: Observable<string>;\n\n  constructor(globalStateProvider: GlobalStateProvider) {\n    const appIdState = globalStateProvider.get(APP_ID_KEY);\n    const anonymousAppIdState = globalStateProvider.get(ANONYMOUS_APP_ID_KEY);\n    this.appId$ = appIdState.state$.pipe(\n      tap(async (appId) => {\n        if (!appId) {\n          await appIdState.update(() => Utils.newGuid());\n        }\n      }),\n      filter((appId) => !!appId),\n    );\n    this.anonymousAppId$ = anonymousAppIdState.state$.pipe(\n      tap(async (appId) => {\n        if (!appId) {\n          await anonymousAppIdState.update(() => Utils.newGuid());\n        }\n      }),\n      filter((appId) => !!appId),\n    );\n  }\n\n  async getAppId(): Promise<string> {\n    return await firstValueFrom(this.appId$);\n  }\n\n  async getAnonymousAppId(): Promise<string> {\n    return await firstValueFrom(this.anonymousAppId$);\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { Region } from \"../../abstractions/environment.service\";\n\nexport class ServerConfigResponse extends BaseResponse {\n  version: string;\n  gitHash: string;\n  server: ThirdPartyServerConfigResponse;\n  environment: EnvironmentServerConfigResponse;\n  featureStates: { [key: string]: string } = {};\n\n  constructor(response: any) {\n    super(response);\n\n    if (response == null) {\n      return;\n    }\n\n    this.version = this.getResponseProperty(\"Version\");\n    this.gitHash = this.getResponseProperty(\"GitHash\");\n    this.server = new ThirdPartyServerConfigResponse(this.getResponseProperty(\"Server\"));\n    this.environment = new EnvironmentServerConfigResponse(this.getResponseProperty(\"Environment\"));\n    this.featureStates = this.getResponseProperty(\"FeatureStates\");\n  }\n}\n\nexport class EnvironmentServerConfigResponse extends BaseResponse {\n  cloudRegion: Region;\n  vault: string;\n  api: string;\n  identity: string;\n  notifications: string;\n  sso: string;\n\n  constructor(data: any = null) {\n    super(data);\n\n    if (data == null) {\n      return;\n    }\n\n    this.cloudRegion = this.getResponseProperty(\"CloudRegion\");\n    this.vault = this.getResponseProperty(\"Vault\");\n    this.api = this.getResponseProperty(\"Api\");\n    this.identity = this.getResponseProperty(\"Identity\");\n    this.notifications = this.getResponseProperty(\"Notifications\");\n    this.sso = this.getResponseProperty(\"Sso\");\n  }\n}\n\nexport class ThirdPartyServerConfigResponse extends BaseResponse {\n  name: string;\n  url: string;\n\n  constructor(data: any = null) {\n    super(data);\n\n    if (data == null) {\n      return;\n    }\n\n    this.name = this.getResponseProperty(\"Name\");\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { TokenService } from \"../../../auth/abstractions/token.service\";\nimport { UserId } from \"../../../types/guid\";\nimport { ConfigApiServiceAbstraction } from \"../../abstractions/config/config-api.service.abstraction\";\nimport { ServerConfigResponse } from \"../../models/response/server-config.response\";\n\nexport class ConfigApiService implements ConfigApiServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private tokenService: TokenService,\n  ) {}\n\n  async get(userId: UserId | undefined): Promise<ServerConfigResponse> {\n    // Authentication adds extra context to config responses, if the user has an access token, we want to use it\n    // We don't particularly care about ensuring the token is valid and not expired, just that it exists\n    const authed: boolean =\n      userId == null ? false : (await this.tokenService.getAccessToken(userId)) != null;\n\n    const r = await this.apiService.send(\"GET\", \"/config\", null, authed, true);\n    return new ServerConfigResponse(r);\n  }\n}\n","/**\n * Feature flags.\n *\n * Flags MUST be short lived and SHALL be removed once enabled.\n */\nexport enum FeatureFlag {\n  BrowserFilelessImport = \"browser-fileless-import\",\n  ItemShare = \"item-share\",\n  FlexibleCollectionsV1 = \"flexible-collections-v-1\", // v-1 is intentional\n  GeneratorToolsModernization = \"generator-tools-modernization\",\n  ShowPaymentMethodWarningBanners = \"show-payment-method-warning-banners\",\n  EnableConsolidatedBilling = \"enable-consolidated-billing\",\n  AC1795_UpdatedSubscriptionStatusSection = \"AC-1795_updated-subscription-status-section\",\n  UnassignedItemsBanner = \"unassigned-items-banner\",\n  EnableDeleteProvider = \"AC-1218-delete-provider\",\n  ExtensionRefresh = \"extension-refresh\",\n  RestrictProviderAccess = \"restrict-provider-access\",\n  UseTreeWalkerApiForPageDetailsCollection = \"use-tree-walker-api-for-page-details-collection\",\n  BulkDeviceApproval = \"bulk-device-approval\",\n}\n\nexport type AllowedFeatureFlagTypes = boolean | number | string;\n\n// Helper to ensure the value is treated as a boolean.\nconst FALSE = false as boolean;\n\n/**\n * Default value for feature flags.\n *\n * DO NOT enable previously disabled flags, REMOVE them instead.\n * We support true as a value as we prefer flags to \"enable\" not \"disable\".\n */\nexport const DefaultFeatureFlagValue = {\n  [FeatureFlag.BrowserFilelessImport]: FALSE,\n  [FeatureFlag.ItemShare]: FALSE,\n  [FeatureFlag.FlexibleCollectionsV1]: FALSE,\n  [FeatureFlag.GeneratorToolsModernization]: FALSE,\n  [FeatureFlag.ShowPaymentMethodWarningBanners]: FALSE,\n  [FeatureFlag.EnableConsolidatedBilling]: FALSE,\n  [FeatureFlag.AC1795_UpdatedSubscriptionStatusSection]: FALSE,\n  [FeatureFlag.UnassignedItemsBanner]: FALSE,\n  [FeatureFlag.EnableDeleteProvider]: FALSE,\n  [FeatureFlag.ExtensionRefresh]: FALSE,\n  [FeatureFlag.RestrictProviderAccess]: FALSE,\n  [FeatureFlag.UseTreeWalkerApiForPageDetailsCollection]: FALSE,\n  [FeatureFlag.BulkDeviceApproval]: FALSE,\n} satisfies Record<FeatureFlag, AllowedFeatureFlagTypes>;\n\nexport type DefaultFeatureFlagValueType = typeof DefaultFeatureFlagValue;\n\nexport type FeatureFlagValueType<Flag extends FeatureFlag> = DefaultFeatureFlagValueType[Flag];\n","import { Jsonify } from \"type-fest\";\n\nimport { AllowedFeatureFlagTypes } from \"../../../enums/feature-flag.enum\";\nimport {\n  ServerConfigData,\n  ThirdPartyServerConfigData,\n  EnvironmentServerConfigData,\n} from \"../../models/data/server-config.data\";\n\nconst dayInMilliseconds = 24 * 3600 * 1000;\n\nexport class ServerConfig {\n  version: string;\n  gitHash: string;\n  server?: ThirdPartyServerConfigData;\n  environment?: EnvironmentServerConfigData;\n  utcDate: Date;\n  featureStates: { [key: string]: AllowedFeatureFlagTypes } = {};\n\n  constructor(serverConfigData: ServerConfigData) {\n    this.version = serverConfigData.version;\n    this.gitHash = serverConfigData.gitHash;\n    this.server = serverConfigData.server;\n    this.utcDate = new Date(serverConfigData.utcDate);\n    this.environment = serverConfigData.environment;\n    this.featureStates = serverConfigData.featureStates;\n\n    if (this.server?.name == null && this.server?.url == null) {\n      this.server = null;\n    }\n  }\n\n  private getAgeInMilliseconds(): number {\n    return new Date().getTime() - this.utcDate?.getTime();\n  }\n\n  isValid(): boolean {\n    return this.getAgeInMilliseconds() <= dayInMilliseconds;\n  }\n\n  static fromJSON(obj: Jsonify<ServerConfig>): ServerConfig {\n    if (obj == null) {\n      return null;\n    }\n\n    return new ServerConfig(obj);\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\n\nexport type Urls = {\n  base?: string;\n  webVault?: string;\n  api?: string;\n  identity?: string;\n  icons?: string;\n  notifications?: string;\n  events?: string;\n  keyConnector?: string;\n  scim?: string;\n};\n\n/**\n * A subset of available regions, additional regions can be loaded through configuration.\n */\nexport enum Region {\n  US = \"US\",\n  EU = \"EU\",\n  SelfHosted = \"Self-hosted\",\n}\n\n/**\n * The possible cloud regions.\n */\nexport type CloudRegion = Exclude<Region, Region.SelfHosted>;\n\nexport type RegionConfig = {\n  // Beware this isn't completely true, it's actually a string for custom environments,\n  // which are currently only supported in web where it doesn't matter.\n  key: Region;\n  domain: string;\n  urls: Urls;\n};\n\n/**\n * The Environment interface represents a server environment.\n *\n * It provides methods to retrieve the URLs of the different services.\n */\nexport interface Environment {\n  /**\n   * Retrieve the current region.\n   */\n  getRegion(): Region;\n  /**\n   * Retrieve the urls, should only be used when configuring the environment.\n   */\n  getUrls(): Urls;\n\n  /**\n   * Identify if the region is a cloud environment.\n   *\n   * @returns true if the environment is a cloud environment, false otherwise.\n   */\n  isCloud(): boolean;\n\n  getApiUrl(): string;\n  getEventsUrl(): string;\n  getIconsUrl(): string;\n  getIdentityUrl(): string;\n\n  /**\n   * @deprecated This is currently only used by the CLI. This functionality should be extracted since\n   * the CLI relies on changing environment mid-login.\n   *\n   * @remarks\n   * Expect this to be null unless the CLI has explicitly set it during the login flow.\n   */\n  getKeyConnectorUrl(): string | null;\n  getNotificationsUrl(): string;\n  getScimUrl(): string;\n  getSendUrl(): string;\n  getWebVaultUrl(): string;\n\n  /**\n   * Get a friendly hostname for the environment.\n   *\n   * - For self-hosted this is the web vault url without protocol prefix.\n   * - For cloud environments it's the domain key.\n   */\n  getHostname(): string;\n\n  // Not sure why we provide this, evaluate if we can remove it.\n  hasBaseUrl(): boolean;\n}\n\n/**\n * The environment service. Provides access to set the current environment urls and region.\n */\nexport abstract class EnvironmentService {\n  abstract environment$: Observable<Environment>;\n  abstract cloudWebVaultUrl$: Observable<string>;\n\n  /**\n   * Retrieve all the available regions for environment selectors.\n   *\n   * This currently relies on compile time provided constants, and will not change at runtime.\n   * Expect all builds to include production environments, QA builds to also include QA\n   * environments and dev builds to include localhost.\n   */\n  abstract availableRegions(): RegionConfig[];\n\n  /**\n   * Set the global environment.\n   */\n  abstract setEnvironment(region: Region, urls?: Urls): Promise<Urls>;\n\n  /**\n   * Seed the environment state for a given user based on the global environment.\n   *\n   * @remarks\n   * Expected to be called only by the StateService when adding a new account.\n   */\n  abstract seedUserEnvironment(userId: UserId): Promise<void>;\n\n  /**\n   * Sets the URL of the cloud web vault app based on the region parameter.\n   *\n   * @param userId - The user id to set the cloud web vault app URL for. If null or undefined the global environment is set.\n   * @param region - The region of the cloud web vault app.\n   */\n  abstract setCloudRegion(userId: UserId, region: Region): Promise<void>;\n\n  /**\n   * Get the environment from state. Useful if you need to get the environment for another user.\n   */\n  abstract getEnvironment(userId?: string): Promise<Environment | undefined>;\n}\n","// required to avoid linting errors when there are no flags\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type SharedFlags = {\n  multithreadDecryption: boolean;\n  showPasswordless?: boolean;\n  enableCipherKeyEncryption?: boolean;\n};\n\n// required to avoid linting errors when there are no flags\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type SharedDevFlags = {\n  noopNotifications: boolean;\n  skipWelcomeOnInstall: boolean;\n  configRetrievalIntervalMs: number;\n};\n\nfunction getFlags<T>(envFlags: string | T): T {\n  if (typeof envFlags === \"string\") {\n    return JSON.parse(envFlags) as T;\n  } else {\n    return envFlags as T;\n  }\n}\n\n/**\n * Gets the value of a feature flag from environment.\n * All flags default to \"on\" (true).\n * Only use for shared code in `libs`, otherwise use the client-specific function.\n * @param flag The name of the feature flag to check\n * @returns The value of the flag\n */\nexport function flagEnabled<Flags extends SharedFlags>(flag: keyof Flags): boolean {\n  const flags = getFlags<Flags>(process.env.FLAGS);\n  return flags[flag] == null || !!flags[flag];\n}\n\n/**\n * Gets the value of a dev flag from environment.\n * Will always return false unless in development.\n * Only use for shared code in `libs`, otherwise use the client-specific function.\n * @param flag The name of the dev flag to check\n * @returns The value of the flag\n */\nexport function devFlagEnabled<DevFlags extends SharedDevFlags>(flag: keyof DevFlags): boolean {\n  if (process.env.ENV !== \"development\") {\n    return false;\n  }\n\n  const devFlags = getFlags<DevFlags>(process.env.DEV_FLAGS);\n  return devFlags?.[flag] == null ? false : !!devFlags[flag];\n}\n\n/**\n * Gets the value of a dev flag from environment.\n * Will always return false unless in development.\n * @param flag The name of the dev flag to check\n * @returns The value of the flag\n * @throws Error if the flag is not enabled\n */\nexport function devFlagValue<DevFlags extends SharedDevFlags>(\n  flag: keyof DevFlags,\n): DevFlags[keyof DevFlags] {\n  if (!devFlagEnabled(flag)) {\n    throw new Error(`This method should not be called, it is protected by a disabled dev flag.`);\n  }\n\n  const devFlags = getFlags<DevFlags>(process.env.DEV_FLAGS);\n  return devFlags[flag];\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { AllowedFeatureFlagTypes } from \"../../../enums/feature-flag.enum\";\nimport { Region } from \"../../abstractions/environment.service\";\nimport {\n  ServerConfigResponse,\n  ThirdPartyServerConfigResponse,\n  EnvironmentServerConfigResponse,\n} from \"../response/server-config.response\";\n\nexport class ServerConfigData {\n  version: string;\n  gitHash: string;\n  server?: ThirdPartyServerConfigData;\n  environment?: EnvironmentServerConfigData;\n  utcDate: string;\n  featureStates: { [key: string]: AllowedFeatureFlagTypes } = {};\n\n  constructor(serverConfigResponse: Partial<ServerConfigResponse>) {\n    this.version = serverConfigResponse?.version;\n    this.gitHash = serverConfigResponse?.gitHash;\n    this.server = serverConfigResponse?.server\n      ? new ThirdPartyServerConfigData(serverConfigResponse.server)\n      : null;\n    this.utcDate = new Date().toISOString();\n    this.environment = serverConfigResponse?.environment\n      ? new EnvironmentServerConfigData(serverConfigResponse.environment)\n      : null;\n    this.featureStates = serverConfigResponse?.featureStates;\n  }\n\n  static fromJSON(obj: Jsonify<ServerConfigData>): ServerConfigData {\n    return Object.assign(new ServerConfigData({}), obj, {\n      server: obj?.server ? ThirdPartyServerConfigData.fromJSON(obj.server) : null,\n      environment: obj?.environment ? EnvironmentServerConfigData.fromJSON(obj.environment) : null,\n    });\n  }\n}\n\nexport class ThirdPartyServerConfigData {\n  name: string;\n  url: string;\n\n  constructor(response: Partial<ThirdPartyServerConfigResponse>) {\n    this.name = response.name;\n    this.url = response.url;\n  }\n\n  static fromJSON(obj: Jsonify<ThirdPartyServerConfigData>): ThirdPartyServerConfigData {\n    return Object.assign(new ThirdPartyServerConfigData({}), obj);\n  }\n}\n\nexport class EnvironmentServerConfigData {\n  cloudRegion: Region;\n  vault: string;\n  api: string;\n  identity: string;\n  notifications: string;\n  sso: string;\n\n  constructor(response: Partial<EnvironmentServerConfigResponse>) {\n    this.cloudRegion = response.cloudRegion;\n    this.vault = response.vault;\n    this.api = response.api;\n    this.identity = response.identity;\n    this.notifications = response.notifications;\n    this.sso = response.sso;\n  }\n\n  static fromJSON(obj: Jsonify<EnvironmentServerConfigData>): EnvironmentServerConfigData {\n    return Object.assign(new EnvironmentServerConfigData({}), obj);\n  }\n}\n","import {\n  combineLatest,\n  firstValueFrom,\n  map,\n  mergeWith,\n  NEVER,\n  Observable,\n  of,\n  shareReplay,\n  Subject,\n  switchMap,\n  tap,\n} from \"rxjs\";\nimport { SemVer } from \"semver\";\n\nimport {\n  DefaultFeatureFlagValue,\n  FeatureFlag,\n  FeatureFlagValueType,\n} from \"../../../enums/feature-flag.enum\";\nimport { UserId } from \"../../../types/guid\";\nimport { ConfigApiServiceAbstraction } from \"../../abstractions/config/config-api.service.abstraction\";\nimport { ConfigService } from \"../../abstractions/config/config.service\";\nimport { ServerConfig } from \"../../abstractions/config/server-config\";\nimport { EnvironmentService, Region } from \"../../abstractions/environment.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { devFlagEnabled, devFlagValue } from \"../../misc/flags\";\nimport { ServerConfigData } from \"../../models/data/server-config.data\";\nimport { CONFIG_DISK, KeyDefinition, StateProvider, UserKeyDefinition } from \"../../state\";\n\nexport const RETRIEVAL_INTERVAL = devFlagEnabled(\"configRetrievalIntervalMs\")\n  ? (devFlagValue(\"configRetrievalIntervalMs\") as number)\n  : 3_600_000; // 1 hour\n\nexport type ApiUrl = string;\n\nexport const USER_SERVER_CONFIG = new UserKeyDefinition<ServerConfig>(CONFIG_DISK, \"serverConfig\", {\n  deserializer: (data) => (data == null ? null : ServerConfig.fromJSON(data)),\n  clearOn: [\"logout\"],\n});\n\nexport const GLOBAL_SERVER_CONFIGURATIONS = KeyDefinition.record<ServerConfig, ApiUrl>(\n  CONFIG_DISK,\n  \"byServer\",\n  {\n    deserializer: (data) => (data == null ? null : ServerConfig.fromJSON(data)),\n  },\n);\n\n// FIXME: currently we are limited to api requests for active users. Update to accept a UserId and APIUrl once ApiService supports it.\nexport class DefaultConfigService implements ConfigService {\n  private failedFetchFallbackSubject = new Subject<ServerConfig>();\n\n  serverConfig$: Observable<ServerConfig>;\n\n  cloudRegion$: Observable<Region>;\n\n  constructor(\n    private configApiService: ConfigApiServiceAbstraction,\n    private environmentService: EnvironmentService,\n    private logService: LogService,\n    private stateProvider: StateProvider,\n  ) {\n    const apiUrl$ = this.environmentService.environment$.pipe(\n      map((environment) => environment.getApiUrl()),\n    );\n\n    this.serverConfig$ = combineLatest([this.stateProvider.activeUserId$, apiUrl$]).pipe(\n      switchMap(([userId, apiUrl]) => {\n        const config$ =\n          userId == null ? this.globalConfigFor$(apiUrl) : this.userConfigFor$(userId);\n        return config$.pipe(map((config) => [config, userId, apiUrl] as const));\n      }),\n      tap(async (rec) => {\n        const [existingConfig, userId, apiUrl] = rec;\n        // Grab new config if older retrieval interval\n        if (!existingConfig || this.olderThanRetrievalInterval(existingConfig.utcDate)) {\n          await this.renewConfig(existingConfig, userId, apiUrl);\n        }\n      }),\n      switchMap(([existingConfig]) => {\n        // If we needed to fetch, stop this emit, we'll get a new one after update\n        // This is split up with the above tap because we need to return an observable from a failed promise,\n        // which isn't very doable since promises are converted to observables in switchMap\n        if (!existingConfig || this.olderThanRetrievalInterval(existingConfig.utcDate)) {\n          return NEVER;\n        }\n        return of(existingConfig);\n      }),\n      // If fetch fails, we'll emit on this subject to fallback to the existing config\n      mergeWith(this.failedFetchFallbackSubject),\n      shareReplay({ refCount: true, bufferSize: 1 }),\n    );\n\n    this.cloudRegion$ = this.serverConfig$.pipe(\n      map((config) => config?.environment?.cloudRegion ?? Region.US),\n    );\n  }\n\n  getFeatureFlag$<Flag extends FeatureFlag>(key: Flag) {\n    return this.serverConfig$.pipe(\n      map((serverConfig) => {\n        if (serverConfig?.featureStates == null || serverConfig.featureStates[key] == null) {\n          return DefaultFeatureFlagValue[key];\n        }\n\n        return serverConfig.featureStates[key] as FeatureFlagValueType<Flag>;\n      }),\n    );\n  }\n\n  async getFeatureFlag<Flag extends FeatureFlag>(key: Flag) {\n    return await firstValueFrom(this.getFeatureFlag$(key));\n  }\n\n  checkServerMeetsVersionRequirement$(minimumRequiredServerVersion: SemVer) {\n    return this.serverConfig$.pipe(\n      map((serverConfig) => {\n        if (serverConfig == null) {\n          return false;\n        }\n        const serverVersion = new SemVer(serverConfig.version);\n        return serverVersion.compare(minimumRequiredServerVersion) >= 0;\n      }),\n    );\n  }\n\n  async ensureConfigFetched() {\n    // Triggering a retrieval for the given user ensures that the config is less than RETRIEVAL_INTERVAL old\n    await firstValueFrom(this.serverConfig$);\n  }\n\n  private olderThanRetrievalInterval(date: Date) {\n    return new Date().getTime() - date.getTime() > RETRIEVAL_INTERVAL;\n  }\n\n  // Updates the on-disk configuration with a newly retrieved configuration\n  private async renewConfig(\n    existingConfig: ServerConfig,\n    userId: UserId,\n    apiUrl: string,\n  ): Promise<void> {\n    try {\n      const response = await this.configApiService.get(userId);\n      const newConfig = new ServerConfig(new ServerConfigData(response));\n\n      // Update the environment region\n      if (\n        newConfig?.environment?.cloudRegion != null &&\n        existingConfig?.environment?.cloudRegion != newConfig.environment.cloudRegion\n      ) {\n        // Null userId sets global, otherwise sets to the given user\n        await this.environmentService.setCloudRegion(userId, newConfig?.environment?.cloudRegion);\n      }\n\n      if (userId == null) {\n        // update global state with new pulled config\n        await this.stateProvider.getGlobal(GLOBAL_SERVER_CONFIGURATIONS).update((configs) => {\n          return { ...configs, [apiUrl]: newConfig };\n        });\n      } else {\n        // update state with new pulled config\n        await this.stateProvider.setUserState(USER_SERVER_CONFIG, newConfig, userId);\n      }\n    } catch (e) {\n      // mutate error to be handled by catchError\n      this.logService.error(\n        `Unable to fetch ServerConfig from ${apiUrl}: ${(e as Error)?.message}`,\n      );\n      // Emit the existing config\n      this.failedFetchFallbackSubject.next(existingConfig);\n    }\n  }\n\n  private globalConfigFor$(apiUrl: string): Observable<ServerConfig> {\n    return this.stateProvider\n      .getGlobal(GLOBAL_SERVER_CONFIGURATIONS)\n      .state$.pipe(map((configs) => configs?.[apiUrl]));\n  }\n\n  private userConfigFor$(userId: UserId): Observable<ServerConfig> {\n    return this.stateProvider.getUser(userId, USER_SERVER_CONFIG).state$;\n  }\n}\n","import { CryptoService } from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\n\nexport class ContainerService {\n  constructor(\n    private cryptoService: CryptoService,\n    private encryptService: EncryptService,\n  ) {}\n\n  attachToGlobal(global: any) {\n    if (!global.bitwardenContainerService) {\n      global.bitwardenContainerService = this;\n    }\n  }\n\n  /**\n   * @throws Will throw if CryptoService was not instantiated and provided to the ContainerService constructor\n   */\n  getCryptoService(): CryptoService {\n    if (this.cryptoService == null) {\n      throw new Error(\"ContainerService.cryptoService not initialized.\");\n    }\n    return this.cryptoService;\n  }\n\n  /**\n   * @throws Will throw if EncryptService was not instantiated and provided to the ContainerService constructor\n   */\n  getEncryptService(): EncryptService {\n    if (this.encryptService == null) {\n      throw new Error(\"ContainerService.encryptService not initialized.\");\n    }\n    return this.encryptService;\n  }\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { EncryptionType } from \"../../enums\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\n\nconst ENC_TYPE_LENGTH = 1;\nconst IV_LENGTH = 16;\nconst MAC_LENGTH = 32;\nconst MIN_DATA_LENGTH = 1;\n\nexport class EncArrayBuffer implements Encrypted {\n  readonly encryptionType: EncryptionType = null;\n  readonly dataBytes: Uint8Array = null;\n  readonly ivBytes: Uint8Array = null;\n  readonly macBytes: Uint8Array = null;\n\n  constructor(readonly buffer: Uint8Array) {\n    const encBytes = buffer;\n    const encType = encBytes[0];\n\n    switch (encType) {\n      case EncryptionType.AesCbc128_HmacSha256_B64:\n      case EncryptionType.AesCbc256_HmacSha256_B64: {\n        const minimumLength = ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH + MIN_DATA_LENGTH;\n        if (encBytes.length < minimumLength) {\n          this.throwDecryptionError();\n        }\n\n        this.ivBytes = encBytes.slice(ENC_TYPE_LENGTH, ENC_TYPE_LENGTH + IV_LENGTH);\n        this.macBytes = encBytes.slice(\n          ENC_TYPE_LENGTH + IV_LENGTH,\n          ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH,\n        );\n        this.dataBytes = encBytes.slice(ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH);\n        break;\n      }\n      case EncryptionType.AesCbc256_B64: {\n        const minimumLength = ENC_TYPE_LENGTH + IV_LENGTH + MIN_DATA_LENGTH;\n        if (encBytes.length < minimumLength) {\n          this.throwDecryptionError();\n        }\n\n        this.ivBytes = encBytes.slice(ENC_TYPE_LENGTH, ENC_TYPE_LENGTH + IV_LENGTH);\n        this.dataBytes = encBytes.slice(ENC_TYPE_LENGTH + IV_LENGTH);\n        break;\n      }\n      default:\n        this.throwDecryptionError();\n    }\n\n    this.encryptionType = encType;\n  }\n\n  private throwDecryptionError() {\n    throw new Error(\n      \"Error parsing encrypted ArrayBuffer: data is corrupted or has an invalid format.\",\n    );\n  }\n\n  static async fromResponse(response: {\n    arrayBuffer: () => Promise<ArrayBuffer>;\n  }): Promise<EncArrayBuffer> {\n    const buffer = await response.arrayBuffer();\n    if (buffer == null) {\n      throw new Error(\"Cannot create EncArrayBuffer from Response - Response is empty\");\n    }\n    return new EncArrayBuffer(new Uint8Array(buffer));\n  }\n\n  static fromB64(b64: string) {\n    const buffer = Utils.fromB64ToArray(b64);\n    return new EncArrayBuffer(buffer);\n  }\n}\n","import { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\n\nexport class EncryptedObject {\n  iv: Uint8Array;\n  data: Uint8Array;\n  mac: Uint8Array;\n  key: SymmetricCryptoKey;\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { CryptoFunctionService } from \"../../abstractions/crypto-function.service\";\nimport { EncryptService } from \"../../abstractions/encrypt.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { EncryptionType } from \"../../enums\";\nimport { Decryptable } from \"../../interfaces/decryptable.interface\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\nimport { EncString } from \"../../models/domain/enc-string\";\nimport { EncryptedObject } from \"../../models/domain/encrypted-object\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\n\nexport class EncryptServiceImplementation implements EncryptService {\n  constructor(\n    protected cryptoFunctionService: CryptoFunctionService,\n    protected logService: LogService,\n    protected logMacFailures: boolean,\n  ) {}\n\n  async encrypt(plainValue: string | Uint8Array, key: SymmetricCryptoKey): Promise<EncString> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    if (plainValue == null) {\n      return Promise.resolve(null);\n    }\n\n    let plainBuf: Uint8Array;\n    if (typeof plainValue === \"string\") {\n      plainBuf = Utils.fromUtf8ToArray(plainValue);\n    } else {\n      plainBuf = plainValue;\n    }\n\n    const encObj = await this.aesEncrypt(plainBuf, key);\n    const iv = Utils.fromBufferToB64(encObj.iv);\n    const data = Utils.fromBufferToB64(encObj.data);\n    const mac = encObj.mac != null ? Utils.fromBufferToB64(encObj.mac) : null;\n    return new EncString(encObj.key.encType, data, iv, mac);\n  }\n\n  async encryptToBytes(plainValue: Uint8Array, key: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    const encValue = await this.aesEncrypt(plainValue, key);\n    let macLen = 0;\n    if (encValue.mac != null) {\n      macLen = encValue.mac.byteLength;\n    }\n\n    const encBytes = new Uint8Array(1 + encValue.iv.byteLength + macLen + encValue.data.byteLength);\n    encBytes.set([encValue.key.encType]);\n    encBytes.set(new Uint8Array(encValue.iv), 1);\n    if (encValue.mac != null) {\n      encBytes.set(new Uint8Array(encValue.mac), 1 + encValue.iv.byteLength);\n    }\n\n    encBytes.set(new Uint8Array(encValue.data), 1 + encValue.iv.byteLength + macLen);\n    return new EncArrayBuffer(encBytes);\n  }\n\n  async decryptToUtf8(encString: EncString, key: SymmetricCryptoKey): Promise<string> {\n    if (key == null) {\n      throw new Error(\"No key provided for decryption.\");\n    }\n\n    key = this.resolveLegacyKey(key, encString);\n\n    if (key.macKey != null && encString?.mac == null) {\n      this.logService.error(\"mac required.\");\n      return null;\n    }\n\n    if (key.encType !== encString.encryptionType) {\n      this.logService.error(\"encType unavailable.\");\n      return null;\n    }\n\n    const fastParams = this.cryptoFunctionService.aesDecryptFastParameters(\n      encString.data,\n      encString.iv,\n      encString.mac,\n      key,\n    );\n    if (fastParams.macKey != null && fastParams.mac != null) {\n      const computedMac = await this.cryptoFunctionService.hmacFast(\n        fastParams.macData,\n        fastParams.macKey,\n        \"sha256\",\n      );\n      const macsEqual = await this.cryptoFunctionService.compareFast(fastParams.mac, computedMac);\n      if (!macsEqual) {\n        this.logMacFailed(\"mac failed.\");\n        return null;\n      }\n    }\n\n    return await this.cryptoFunctionService.aesDecryptFast(fastParams, \"cbc\");\n  }\n\n  async decryptToBytes(encThing: Encrypted, key: SymmetricCryptoKey): Promise<Uint8Array> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    if (encThing == null) {\n      throw new Error(\"Nothing provided for decryption.\");\n    }\n\n    key = this.resolveLegacyKey(key, encThing);\n\n    if (key.macKey != null && encThing.macBytes == null) {\n      return null;\n    }\n\n    if (key.encType !== encThing.encryptionType) {\n      return null;\n    }\n\n    if (key.macKey != null && encThing.macBytes != null) {\n      const macData = new Uint8Array(encThing.ivBytes.byteLength + encThing.dataBytes.byteLength);\n      macData.set(new Uint8Array(encThing.ivBytes), 0);\n      macData.set(new Uint8Array(encThing.dataBytes), encThing.ivBytes.byteLength);\n      const computedMac = await this.cryptoFunctionService.hmac(macData, key.macKey, \"sha256\");\n      if (computedMac === null) {\n        return null;\n      }\n\n      const macsMatch = await this.cryptoFunctionService.compare(encThing.macBytes, computedMac);\n      if (!macsMatch) {\n        this.logMacFailed(\"mac failed.\");\n        return null;\n      }\n    }\n\n    const result = await this.cryptoFunctionService.aesDecrypt(\n      encThing.dataBytes,\n      encThing.ivBytes,\n      key.encKey,\n      \"cbc\",\n    );\n\n    return result ?? null;\n  }\n\n  async rsaEncrypt(data: Uint8Array, publicKey: Uint8Array): Promise<EncString> {\n    if (data == null) {\n      throw new Error(\"No data provided for encryption.\");\n    }\n\n    if (publicKey == null) {\n      throw new Error(\"No public key provided for encryption.\");\n    }\n    const encrypted = await this.cryptoFunctionService.rsaEncrypt(data, publicKey, \"sha1\");\n    return new EncString(EncryptionType.Rsa2048_OaepSha1_B64, Utils.fromBufferToB64(encrypted));\n  }\n\n  async rsaDecrypt(data: EncString, privateKey: Uint8Array): Promise<Uint8Array> {\n    if (data == null) {\n      throw new Error(\"No data provided for decryption.\");\n    }\n\n    let algorithm: \"sha1\" | \"sha256\";\n    switch (data.encryptionType) {\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        algorithm = \"sha1\";\n        break;\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64:\n        algorithm = \"sha256\";\n        break;\n      default:\n        throw new Error(\"Invalid encryption type.\");\n    }\n\n    if (privateKey == null) {\n      throw new Error(\"No private key provided for decryption.\");\n    }\n\n    return this.cryptoFunctionService.rsaDecrypt(data.dataBytes, privateKey, algorithm);\n  }\n\n  async decryptItems<T extends InitializerMetadata>(\n    items: Decryptable<T>[],\n    key: SymmetricCryptoKey,\n  ): Promise<T[]> {\n    if (items == null || items.length < 1) {\n      return [];\n    }\n\n    // don't use promise.all because this task is not io bound\n    const results = [];\n    for (let i = 0; i < items.length; i++) {\n      results.push(await items[i].decrypt(key));\n    }\n    return results;\n  }\n\n  async hash(value: string | Uint8Array, algorithm: \"sha1\" | \"sha256\" | \"sha512\"): Promise<string> {\n    const hashArray = await this.cryptoFunctionService.hash(value, algorithm);\n    return Utils.fromBufferToB64(hashArray);\n  }\n\n  private async aesEncrypt(data: Uint8Array, key: SymmetricCryptoKey): Promise<EncryptedObject> {\n    const obj = new EncryptedObject();\n    obj.key = key;\n    obj.iv = await this.cryptoFunctionService.randomBytes(16);\n    obj.data = await this.cryptoFunctionService.aesEncrypt(data, obj.iv, obj.key.encKey);\n\n    if (obj.key.macKey != null) {\n      const macData = new Uint8Array(obj.iv.byteLength + obj.data.byteLength);\n      macData.set(new Uint8Array(obj.iv), 0);\n      macData.set(new Uint8Array(obj.data), obj.iv.byteLength);\n      obj.mac = await this.cryptoFunctionService.hmac(macData, obj.key.macKey, \"sha256\");\n    }\n\n    return obj;\n  }\n\n  private logMacFailed(msg: string) {\n    if (this.logMacFailures) {\n      this.logService.error(msg);\n    }\n  }\n\n  /**\n   * Transform into new key for the old encrypt-then-mac scheme if required, otherwise return the current key unchanged\n   * @param encThing The encrypted object (e.g. encString or encArrayBuffer) that you want to decrypt\n   */\n  resolveLegacyKey(key: SymmetricCryptoKey, encThing: Encrypted): SymmetricCryptoKey {\n    if (\n      encThing.encryptionType === EncryptionType.AesCbc128_HmacSha256_B64 &&\n      key.encType === EncryptionType.AesCbc256_B64\n    ) {\n      return new SymmetricCryptoKey(key.key, EncryptionType.AesCbc128_HmacSha256_B64);\n    }\n\n    return key;\n  }\n}\n","export enum InitializerKey {\n  Cipher = 0,\n  CipherView = 1,\n}\n","export enum CipherType {\n  Login = 1,\n  SecureNote = 2,\n  Card = 3,\n  Identity = 4,\n}\n","export enum CipherRepromptType {\n  None = 0,\n  Password = 1,\n}\n","export enum FieldType {\n  Text = 0,\n  Hidden = 1,\n  Boolean = 2,\n  Linked = 3,\n}\n","export type LinkedIdType = LoginLinkedId | CardLinkedId | IdentityLinkedId;\n\n// LoginView\nexport enum LoginLinkedId {\n  Username = 100,\n  Password = 101,\n}\n\n// CardView\nexport enum CardLinkedId {\n  CardholderName = 300,\n  ExpMonth = 301,\n  ExpYear = 302,\n  Code = 303,\n  Brand = 304,\n  Number = 305,\n}\n\n// IdentityView\nexport enum IdentityLinkedId {\n  Title = 400,\n  MiddleName = 401,\n  Address1 = 402,\n  Address2 = 403,\n  Address3 = 404,\n  City = 405,\n  State = 406,\n  PostalCode = 407,\n  Country = 408,\n  Company = 409,\n  Email = 410,\n  Phone = 411,\n  Ssn = 412,\n  Username = 413,\n  PassportNumber = 414,\n  LicenseNumber = 415,\n  FirstName = 416,\n  LastName = 417,\n  FullName = 418,\n}\n","export enum SecureNoteType {\n  Generic = 0,\n}\n","import { AttachmentResponse } from \"../response/attachment.response\";\n\nexport class AttachmentData {\n  id: string;\n  url: string;\n  fileName: string;\n  key: string;\n  size: string;\n  sizeName: string;\n\n  constructor(response?: AttachmentResponse) {\n    if (response == null) {\n      return;\n    }\n    this.id = response.id;\n    this.url = response.url;\n    this.fileName = response.fileName;\n    this.key = response.key;\n    this.size = response.size;\n    this.sizeName = response.sizeName;\n  }\n}\n","import { CardApi } from \"../api/card.api\";\n\nexport class CardData {\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(data?: CardApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.cardholderName = data.cardholderName;\n    this.brand = data.brand;\n    this.number = data.number;\n    this.expMonth = data.expMonth;\n    this.expYear = data.expYear;\n    this.code = data.code;\n  }\n}\n","import { FieldType, LinkedIdType } from \"../../enums\";\nimport { FieldApi } from \"../api/field.api\";\n\nexport class FieldData {\n  type: FieldType;\n  name: string;\n  value: string;\n  linkedId: LinkedIdType;\n\n  constructor(response?: FieldApi) {\n    if (response == null) {\n      return;\n    }\n    this.type = response.type;\n    this.name = response.name;\n    this.value = response.value;\n    this.linkedId = response.linkedId;\n  }\n}\n","import { IdentityApi } from \"../api/identity.api\";\n\nexport class IdentityData {\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(data?: IdentityApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.title = data.title;\n    this.firstName = data.firstName;\n    this.middleName = data.middleName;\n    this.lastName = data.lastName;\n    this.address1 = data.address1;\n    this.address2 = data.address2;\n    this.address3 = data.address3;\n    this.city = data.city;\n    this.state = data.state;\n    this.postalCode = data.postalCode;\n    this.country = data.country;\n    this.company = data.company;\n    this.email = data.email;\n    this.phone = data.phone;\n    this.ssn = data.ssn;\n    this.username = data.username;\n    this.passportNumber = data.passportNumber;\n    this.licenseNumber = data.licenseNumber;\n  }\n}\n","import { Fido2CredentialApi } from \"../api/fido2-credential.api\";\n\nexport class Fido2CredentialData {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: string;\n\n  constructor(data?: Fido2CredentialApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.credentialId = data.credentialId;\n    this.keyType = data.keyType;\n    this.keyAlgorithm = data.keyAlgorithm;\n    this.keyCurve = data.keyCurve;\n    this.keyValue = data.keyValue;\n    this.rpId = data.rpId;\n    this.userHandle = data.userHandle;\n    this.userName = data.userName;\n    this.counter = data.counter;\n    this.rpName = data.rpName;\n    this.userDisplayName = data.userDisplayName;\n    this.discoverable = data.discoverable;\n    this.creationDate = data.creationDate;\n  }\n}\n","import { UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { LoginUriApi } from \"../api/login-uri.api\";\n\nexport class LoginUriData {\n  uri: string;\n  uriChecksum: string;\n  match: UriMatchStrategySetting = null;\n\n  constructor(data?: LoginUriApi) {\n    if (data == null) {\n      return;\n    }\n    this.uri = data.uri;\n    this.uriChecksum = data.uriChecksum;\n    this.match = data.match;\n  }\n}\n","import { LoginApi } from \"../api/login.api\";\n\nimport { Fido2CredentialData } from \"./fido2-credential.data\";\nimport { LoginUriData } from \"./login-uri.data\";\n\nexport class LoginData {\n  uris: LoginUriData[];\n  username: string;\n  password: string;\n  passwordRevisionDate: string;\n  totp: string;\n  autofillOnPageLoad: boolean;\n  fido2Credentials?: Fido2CredentialData[];\n\n  constructor(data?: LoginApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.username = data.username;\n    this.password = data.password;\n    this.passwordRevisionDate = data.passwordRevisionDate;\n    this.totp = data.totp;\n    this.autofillOnPageLoad = data.autofillOnPageLoad;\n\n    if (data.uris) {\n      this.uris = data.uris.map((u) => new LoginUriData(u));\n    }\n\n    if (data.fido2Credentials) {\n      this.fido2Credentials = data.fido2Credentials?.map((key) => new Fido2CredentialData(key));\n    }\n  }\n}\n","import { PasswordHistoryResponse } from \"../response/password-history.response\";\n\nexport class PasswordHistoryData {\n  password: string;\n  lastUsedDate: string;\n\n  constructor(response?: PasswordHistoryResponse) {\n    if (response == null) {\n      return;\n    }\n\n    this.password = response.password;\n    this.lastUsedDate = response.lastUsedDate;\n  }\n}\n","import { SecureNoteType } from \"../../enums\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\n\nexport class SecureNoteData {\n  type: SecureNoteType;\n\n  constructor(data?: SecureNoteApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.type = data.type;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CipherResponse } from \"../response/cipher.response\";\n\nimport { AttachmentData } from \"./attachment.data\";\nimport { CardData } from \"./card.data\";\nimport { FieldData } from \"./field.data\";\nimport { IdentityData } from \"./identity.data\";\nimport { LoginData } from \"./login.data\";\nimport { PasswordHistoryData } from \"./password-history.data\";\nimport { SecureNoteData } from \"./secure-note.data\";\n\nexport class CipherData {\n  id: string;\n  organizationId: string;\n  folderId: string;\n  edit: boolean;\n  viewPassword: boolean;\n  organizationUseTotp: boolean;\n  favorite: boolean;\n  revisionDate: string;\n  type: CipherType;\n  name: string;\n  notes: string;\n  login?: LoginData;\n  secureNote?: SecureNoteData;\n  card?: CardData;\n  identity?: IdentityData;\n  fields?: FieldData[];\n  attachments?: AttachmentData[];\n  passwordHistory?: PasswordHistoryData[];\n  collectionIds?: string[];\n  creationDate: string;\n  deletedDate: string;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(response?: CipherResponse, collectionIds?: string[]) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.folderId = response.folderId;\n    this.edit = response.edit;\n    this.viewPassword = response.viewPassword;\n    this.organizationUseTotp = response.organizationUseTotp;\n    this.favorite = response.favorite;\n    this.revisionDate = response.revisionDate;\n    this.type = response.type;\n    this.name = response.name;\n    this.notes = response.notes;\n    this.collectionIds = collectionIds != null ? collectionIds : response.collectionIds;\n    this.creationDate = response.creationDate;\n    this.deletedDate = response.deletedDate;\n    this.reprompt = response.reprompt;\n    this.key = response.key;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new LoginData(response.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteData(response.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new CardData(response.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityData(response.identity);\n        break;\n      default:\n        break;\n    }\n\n    if (response.fields != null) {\n      this.fields = response.fields.map((f) => new FieldData(f));\n    }\n    if (response.attachments != null) {\n      this.attachments = response.attachments.map((a) => new AttachmentData(a));\n    }\n    if (response.passwordHistory != null) {\n      this.passwordHistory = response.passwordHistory.map((ph) => new PasswordHistoryData(ph));\n    }\n  }\n\n  static fromJSON(obj: Jsonify<CipherData>) {\n    return Object.assign(new CipherData(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { Attachment } from \"../domain/attachment\";\n\nexport class AttachmentView implements View {\n  id: string = null;\n  url: string = null;\n  size: string = null;\n  sizeName: string = null;\n  fileName: string = null;\n  key: SymmetricCryptoKey = null;\n\n  constructor(a?: Attachment) {\n    if (!a) {\n      return;\n    }\n\n    this.id = a.id;\n    this.url = a.url;\n    this.size = a.size;\n    this.sizeName = a.sizeName;\n  }\n\n  get fileSize(): number {\n    try {\n      if (this.size != null) {\n        return parseInt(this.size, null);\n      }\n    } catch {\n      // Invalid file size.\n    }\n    return 0;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<AttachmentView>>): AttachmentView {\n    const key = obj.key == null ? null : SymmetricCryptoKey.fromJSON(obj.key);\n    return Object.assign(new AttachmentView(), obj, { key: key });\n  }\n}\n","import { LinkedIdType } from \"./enums\";\nimport { ItemView } from \"./models/view/item.view\";\n\nexport class LinkedMetadata {\n  constructor(\n    readonly propertyKey: string,\n    private readonly _i18nKey?: string,\n  ) {}\n\n  get i18nKey() {\n    return this._i18nKey ?? this.propertyKey;\n  }\n}\n\n/**\n * A decorator used to set metadata used by Linked custom fields. Apply it to a class property or getter to make it\n *    available as a Linked custom field option.\n * @param id - A unique value that is saved in the Field model. It is used to look up the decorated class property.\n * @param i18nKey - The i18n key used to describe the decorated class property in the UI. If it is null, then the name\n *    of the class property will be used as the i18n key.\n */\nexport function linkedFieldOption(id: LinkedIdType, i18nKey?: string) {\n  return (prototype: ItemView, propertyKey: string) => {\n    if (prototype.linkedFieldOptions == null) {\n      prototype.linkedFieldOptions = new Map<LinkedIdType, LinkedMetadata>();\n    }\n\n    prototype.linkedFieldOptions.set(id, new LinkedMetadata(propertyKey, i18nKey));\n  };\n}\n","import { View } from \"../../../models/view/view\";\nimport { LinkedMetadata } from \"../../linked-field-option.decorator\";\n\nexport abstract class ItemView implements View {\n  linkedFieldOptions: Map<number, LinkedMetadata>;\n  abstract get subTitle(): string;\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CardLinkedId as LinkedId } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class CardView extends ItemView {\n  @linkedFieldOption(LinkedId.CardholderName)\n  cardholderName: string = null;\n  @linkedFieldOption(LinkedId.ExpMonth, \"expirationMonth\")\n  expMonth: string = null;\n  @linkedFieldOption(LinkedId.ExpYear, \"expirationYear\")\n  expYear: string = null;\n  @linkedFieldOption(LinkedId.Code, \"securityCode\")\n  code: string = null;\n\n  private _brand: string = null;\n  private _number: string = null;\n  private _subTitle: string = null;\n\n  get maskedCode(): string {\n    return this.code != null ? \"•\".repeat(this.code.length) : null;\n  }\n\n  get maskedNumber(): string {\n    return this.number != null ? \"•\".repeat(this.number.length) : null;\n  }\n\n  @linkedFieldOption(LinkedId.Brand)\n  get brand(): string {\n    return this._brand;\n  }\n  set brand(value: string) {\n    this._brand = value;\n    this._subTitle = null;\n  }\n\n  @linkedFieldOption(LinkedId.Number)\n  get number(): string {\n    return this._number;\n  }\n  set number(value: string) {\n    this._number = value;\n    this._subTitle = null;\n  }\n\n  get subTitle(): string {\n    if (this._subTitle == null) {\n      this._subTitle = this.brand;\n      if (this.number != null && this.number.length >= 4) {\n        if (this._subTitle != null && this._subTitle !== \"\") {\n          this._subTitle += \", \";\n        } else {\n          this._subTitle = \"\";\n        }\n\n        // Show last 5 on amex, last 4 for all others\n        const count =\n          this.number.length >= 5 && this.number.match(new RegExp(\"^3[47]\")) != null ? 5 : 4;\n        this._subTitle += \"*\" + this.number.substr(this.number.length - count);\n      }\n    }\n    return this._subTitle;\n  }\n\n  get expiration(): string {\n    if (!this.expMonth && !this.expYear) {\n      return null;\n    }\n\n    let exp = this.expMonth != null ? (\"0\" + this.expMonth).slice(-2) : \"__\";\n    exp += \" / \" + (this.expYear != null ? this.formatYear(this.expYear) : \"____\");\n    return exp;\n  }\n\n  private formatYear(year: string): string {\n    return year.length === 2 ? \"20\" + year : year;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<CardView>>): CardView {\n    return Object.assign(new CardView(), obj);\n  }\n\n  // ref https://stackoverflow.com/a/5911300\n  static getCardBrandByPatterns(cardNum: string): string {\n    if (cardNum == null || typeof cardNum !== \"string\" || cardNum.trim() === \"\") {\n      return null;\n    }\n\n    // Visa\n    let re = new RegExp(\"^4\");\n    if (cardNum.match(re) != null) {\n      return \"Visa\";\n    }\n\n    // Mastercard\n    // Updated for Mastercard 2017 BINs expansion\n    if (\n      /^(5[1-5][0-9]{14}|2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12}))$/.test(\n        cardNum,\n      )\n    ) {\n      return \"Mastercard\";\n    }\n\n    // AMEX\n    re = new RegExp(\"^3[47]\");\n    if (cardNum.match(re) != null) {\n      return \"Amex\";\n    }\n\n    // Discover\n    re = new RegExp(\n      \"^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)\",\n    );\n    if (cardNum.match(re) != null) {\n      return \"Discover\";\n    }\n\n    // Diners\n    re = new RegExp(\"^36\");\n    if (cardNum.match(re) != null) {\n      return \"Diners Club\";\n    }\n\n    // Diners - Carte Blanche\n    re = new RegExp(\"^30[0-5]\");\n    if (cardNum.match(re) != null) {\n      return \"Diners Club\";\n    }\n\n    // JCB\n    re = new RegExp(\"^35(2[89]|[3-8][0-9])\");\n    if (cardNum.match(re) != null) {\n      return \"JCB\";\n    }\n\n    // Visa Electron\n    re = new RegExp(\"^(4026|417500|4508|4844|491(3|7))\");\n    if (cardNum.match(re) != null) {\n      return \"Visa\";\n    }\n\n    return null;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\nimport { Field } from \"../domain/field\";\n\nexport class FieldView implements View {\n  name: string = null;\n  value: string = null;\n  type: FieldType = null;\n  newField = false; // Marks if the field is new and hasn't been saved\n  showValue = false;\n  showCount = false;\n  linkedId: LinkedIdType = null;\n\n  constructor(f?: Field) {\n    if (!f) {\n      return;\n    }\n\n    this.type = f.type;\n    this.linkedId = f.linkedId;\n  }\n\n  get maskedValue(): string {\n    return this.value != null ? \"••••••••\" : null;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<FieldView>>): FieldView {\n    return Object.assign(new FieldView(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { IdentityLinkedId as LinkedId } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class IdentityView extends ItemView {\n  @linkedFieldOption(LinkedId.Title)\n  title: string = null;\n  @linkedFieldOption(LinkedId.MiddleName)\n  middleName: string = null;\n  @linkedFieldOption(LinkedId.Address1)\n  address1: string = null;\n  @linkedFieldOption(LinkedId.Address2)\n  address2: string = null;\n  @linkedFieldOption(LinkedId.Address3)\n  address3: string = null;\n  @linkedFieldOption(LinkedId.City, \"cityTown\")\n  city: string = null;\n  @linkedFieldOption(LinkedId.State, \"stateProvince\")\n  state: string = null;\n  @linkedFieldOption(LinkedId.PostalCode, \"zipPostalCode\")\n  postalCode: string = null;\n  @linkedFieldOption(LinkedId.Country)\n  country: string = null;\n  @linkedFieldOption(LinkedId.Company)\n  company: string = null;\n  @linkedFieldOption(LinkedId.Email)\n  email: string = null;\n  @linkedFieldOption(LinkedId.Phone)\n  phone: string = null;\n  @linkedFieldOption(LinkedId.Ssn)\n  ssn: string = null;\n  @linkedFieldOption(LinkedId.Username)\n  username: string = null;\n  @linkedFieldOption(LinkedId.PassportNumber)\n  passportNumber: string = null;\n  @linkedFieldOption(LinkedId.LicenseNumber)\n  licenseNumber: string = null;\n\n  private _firstName: string = null;\n  private _lastName: string = null;\n  private _subTitle: string = null;\n\n  constructor() {\n    super();\n  }\n\n  @linkedFieldOption(LinkedId.FirstName)\n  get firstName(): string {\n    return this._firstName;\n  }\n  set firstName(value: string) {\n    this._firstName = value;\n    this._subTitle = null;\n  }\n\n  @linkedFieldOption(LinkedId.LastName)\n  get lastName(): string {\n    return this._lastName;\n  }\n  set lastName(value: string) {\n    this._lastName = value;\n    this._subTitle = null;\n  }\n\n  get subTitle(): string {\n    if (this._subTitle == null && (this.firstName != null || this.lastName != null)) {\n      this._subTitle = \"\";\n      if (this.firstName != null) {\n        this._subTitle = this.firstName;\n      }\n      if (this.lastName != null) {\n        if (this._subTitle !== \"\") {\n          this._subTitle += \" \";\n        }\n        this._subTitle += this.lastName;\n      }\n    }\n\n    return this._subTitle;\n  }\n\n  @linkedFieldOption(LinkedId.FullName)\n  get fullName(): string {\n    if (\n      this.title != null ||\n      this.firstName != null ||\n      this.middleName != null ||\n      this.lastName != null\n    ) {\n      let name = \"\";\n      if (this.title != null) {\n        name += this.title + \" \";\n      }\n      if (this.firstName != null) {\n        name += this.firstName + \" \";\n      }\n      if (this.middleName != null) {\n        name += this.middleName + \" \";\n      }\n      if (this.lastName != null) {\n        name += this.lastName;\n      }\n      return name.trim();\n    }\n\n    return null;\n  }\n\n  get fullAddress(): string {\n    let address = this.address1;\n    if (!Utils.isNullOrWhitespace(this.address2)) {\n      if (!Utils.isNullOrWhitespace(address)) {\n        address += \", \";\n      }\n      address += this.address2;\n    }\n    if (!Utils.isNullOrWhitespace(this.address3)) {\n      if (!Utils.isNullOrWhitespace(address)) {\n        address += \", \";\n      }\n      address += this.address3;\n    }\n    return address;\n  }\n\n  get fullAddressPart2(): string {\n    if (this.city == null && this.state == null && this.postalCode == null) {\n      return null;\n    }\n    const city = this.city || \"-\";\n    const state = this.state;\n    const postalCode = this.postalCode || \"-\";\n    let addressPart2 = city;\n    if (!Utils.isNullOrWhitespace(state)) {\n      addressPart2 += \", \" + state;\n    }\n    addressPart2 += \", \" + postalCode;\n    return addressPart2;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<IdentityView>>): IdentityView {\n    return Object.assign(new IdentityView(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class Fido2CredentialView extends ItemView {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: number;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: boolean;\n  creationDate: Date = null;\n\n  get subTitle(): string {\n    return this.userDisplayName;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Fido2CredentialView>>): Fido2CredentialView {\n    const creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n    return Object.assign(new Fido2CredentialView(), obj, {\n      creationDate,\n    });\n  }\n}\n","import { Utils } from \"./utils\";\n\nconst CanLaunchWhitelist = [\n  \"https://\",\n  \"http://\",\n  \"ssh://\",\n  \"ftp://\",\n  \"sftp://\",\n  \"irc://\",\n  \"vnc://\",\n  // https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-uri\n  \"rdp://\", // Legacy RDP URI scheme\n  \"ms-rd:\", // Preferred RDP URI scheme\n  \"chrome://\",\n  \"iosapp://\",\n  \"androidapp://\",\n];\n\nexport class SafeUrls {\n  static canLaunch(uri: string): boolean {\n    if (Utils.isNullOrWhitespace(uri)) {\n      return false;\n    }\n\n    for (let i = 0; i < CanLaunchWhitelist.length; i++) {\n      if (uri.indexOf(CanLaunchWhitelist[i]) === 0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { UriMatchStrategy, UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { View } from \"../../../models/view/view\";\nimport { SafeUrls } from \"../../../platform/misc/safe-urls\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { LoginUri } from \"../domain/login-uri\";\n\nexport class LoginUriView implements View {\n  match: UriMatchStrategySetting = null;\n\n  private _uri: string = null;\n  private _domain: string = null;\n  private _hostname: string = null;\n  private _host: string = null;\n  private _canLaunch: boolean = null;\n\n  constructor(u?: LoginUri) {\n    if (!u) {\n      return;\n    }\n\n    this.match = u.match;\n  }\n\n  get uri(): string {\n    return this._uri;\n  }\n  set uri(value: string) {\n    this._uri = value;\n    this._domain = null;\n    this._canLaunch = null;\n  }\n\n  get domain(): string {\n    if (this._domain == null && this.uri != null) {\n      this._domain = Utils.getDomain(this.uri);\n      if (this._domain === \"\") {\n        this._domain = null;\n      }\n    }\n\n    return this._domain;\n  }\n\n  get hostname(): string {\n    if (this.match === UriMatchStrategy.RegularExpression) {\n      return null;\n    }\n    if (this._hostname == null && this.uri != null) {\n      this._hostname = Utils.getHostname(this.uri);\n      if (this._hostname === \"\") {\n        this._hostname = null;\n      }\n    }\n\n    return this._hostname;\n  }\n\n  get host(): string {\n    if (this.match === UriMatchStrategy.RegularExpression) {\n      return null;\n    }\n    if (this._host == null && this.uri != null) {\n      this._host = Utils.getHost(this.uri);\n      if (this._host === \"\") {\n        this._host = null;\n      }\n    }\n\n    return this._host;\n  }\n\n  get hostnameOrUri(): string {\n    return this.hostname != null ? this.hostname : this.uri;\n  }\n\n  get hostOrUri(): string {\n    return this.host != null ? this.host : this.uri;\n  }\n\n  get isWebsite(): boolean {\n    return (\n      this.uri != null &&\n      (this.uri.indexOf(\"http://\") === 0 ||\n        this.uri.indexOf(\"https://\") === 0 ||\n        (this.uri.indexOf(\"://\") < 0 && !Utils.isNullOrWhitespace(Utils.getDomain(this.uri))))\n    );\n  }\n\n  get canLaunch(): boolean {\n    if (this._canLaunch != null) {\n      return this._canLaunch;\n    }\n    if (this.uri != null && this.match !== UriMatchStrategy.RegularExpression) {\n      this._canLaunch = SafeUrls.canLaunch(this.launchUri);\n    } else {\n      this._canLaunch = false;\n    }\n    return this._canLaunch;\n  }\n\n  get launchUri(): string {\n    return this.uri.indexOf(\"://\") < 0 && !Utils.isNullOrWhitespace(Utils.getDomain(this.uri))\n      ? \"http://\" + this.uri\n      : this.uri;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<LoginUriView>>): LoginUriView {\n    return Object.assign(new LoginUriView(), obj);\n  }\n\n  matchesUri(\n    targetUri: string,\n    equivalentDomains: Set<string>,\n    defaultUriMatch: UriMatchStrategySetting = null,\n  ): boolean {\n    if (!this.uri || !targetUri) {\n      return false;\n    }\n\n    let matchType = this.match ?? defaultUriMatch;\n    matchType ??= UriMatchStrategy.Domain;\n\n    const targetDomain = Utils.getDomain(targetUri);\n    const matchDomains = equivalentDomains.add(targetDomain);\n\n    switch (matchType) {\n      case UriMatchStrategy.Domain:\n        return this.matchesDomain(targetUri, matchDomains);\n      case UriMatchStrategy.Host: {\n        const urlHost = Utils.getHost(targetUri);\n        return urlHost != null && urlHost === Utils.getHost(this.uri);\n      }\n      case UriMatchStrategy.Exact:\n        return targetUri === this.uri;\n      case UriMatchStrategy.StartsWith:\n        return targetUri.startsWith(this.uri);\n      case UriMatchStrategy.RegularExpression:\n        try {\n          const regex = new RegExp(this.uri, \"i\");\n          return regex.test(targetUri);\n        } catch (e) {\n          // Invalid regex\n          return false;\n        }\n      case UriMatchStrategy.Never:\n        return false;\n      default:\n        break;\n    }\n\n    return false;\n  }\n\n  private matchesDomain(targetUri: string, matchDomains: Set<string>) {\n    if (targetUri == null || this.domain == null || !matchDomains.has(this.domain)) {\n      return false;\n    }\n\n    if (Utils.DomainMatchBlacklist.has(this.domain)) {\n      const domainUrlHost = Utils.getHost(targetUri);\n      return !Utils.DomainMatchBlacklist.get(this.domain).has(domainUrlHost);\n    }\n\n    return true;\n  }\n}\n","import { UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { LoginLinkedId as LinkedId } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\nimport { Login } from \"../domain/login\";\n\nimport { Fido2CredentialView } from \"./fido2-credential.view\";\nimport { ItemView } from \"./item.view\";\nimport { LoginUriView } from \"./login-uri.view\";\n\nexport class LoginView extends ItemView {\n  @linkedFieldOption(LinkedId.Username)\n  username: string = null;\n  @linkedFieldOption(LinkedId.Password)\n  password: string = null;\n\n  passwordRevisionDate?: Date = null;\n  totp: string = null;\n  uris: LoginUriView[] = [];\n  autofillOnPageLoad: boolean = null;\n  fido2Credentials: Fido2CredentialView[] = null;\n\n  constructor(l?: Login) {\n    super();\n    if (!l) {\n      return;\n    }\n\n    this.passwordRevisionDate = l.passwordRevisionDate;\n    this.autofillOnPageLoad = l.autofillOnPageLoad;\n  }\n\n  get uri(): string {\n    return this.hasUris ? this.uris[0].uri : null;\n  }\n\n  get maskedPassword(): string {\n    return this.password != null ? \"••••••••\" : null;\n  }\n\n  get subTitle(): string {\n    return this.username;\n  }\n\n  get canLaunch(): boolean {\n    return this.hasUris && this.uris.some((u) => u.canLaunch);\n  }\n\n  get hasTotp(): boolean {\n    return !Utils.isNullOrWhitespace(this.totp);\n  }\n\n  get launchUri(): string {\n    if (this.hasUris) {\n      const uri = this.uris.find((u) => u.canLaunch);\n      if (uri != null) {\n        return uri.launchUri;\n      }\n    }\n    return null;\n  }\n\n  get hasUris(): boolean {\n    return this.uris != null && this.uris.length > 0;\n  }\n\n  get hasFido2Credentials(): boolean {\n    return this.fido2Credentials != null && this.fido2Credentials.length > 0;\n  }\n\n  matchesUri(\n    targetUri: string,\n    equivalentDomains: Set<string>,\n    defaultUriMatch: UriMatchStrategySetting = null,\n  ): boolean {\n    if (this.uris == null) {\n      return false;\n    }\n\n    return this.uris.some((uri) => uri.matchesUri(targetUri, equivalentDomains, defaultUriMatch));\n  }\n\n  static fromJSON(obj: Partial<DeepJsonify<LoginView>>): LoginView {\n    const passwordRevisionDate =\n      obj.passwordRevisionDate == null ? null : new Date(obj.passwordRevisionDate);\n    const uris = obj.uris.map((uri) => LoginUriView.fromJSON(uri));\n    const fido2Credentials = obj.fido2Credentials?.map((key) => Fido2CredentialView.fromJSON(key));\n\n    return Object.assign(new LoginView(), obj, {\n      passwordRevisionDate,\n      uris,\n      fido2Credentials,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { Password } from \"../domain/password\";\n\nexport class PasswordHistoryView implements View {\n  password: string = null;\n  lastUsedDate: Date = null;\n\n  constructor(ph?: Password) {\n    if (!ph) {\n      return;\n    }\n\n    this.lastUsedDate = ph.lastUsedDate;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<PasswordHistoryView>>): PasswordHistoryView {\n    const lastUsedDate = obj.lastUsedDate == null ? null : new Date(obj.lastUsedDate);\n\n    return Object.assign(new PasswordHistoryView(), obj, {\n      lastUsedDate: lastUsedDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { SecureNoteType } from \"../../enums\";\nimport { SecureNote } from \"../domain/secure-note\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class SecureNoteView extends ItemView {\n  type: SecureNoteType = null;\n\n  constructor(n?: SecureNote) {\n    super();\n    if (!n) {\n      return;\n    }\n\n    this.type = n.type;\n  }\n\n  get subTitle(): string {\n    return null;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<SecureNoteView>>): SecureNoteView {\n    return Object.assign(new SecureNoteView(), obj);\n  }\n}\n","import { View } from \"../../../models/view/view\";\nimport { InitializerMetadata } from \"../../../platform/interfaces/initializer-metadata.interface\";\nimport { InitializerKey } from \"../../../platform/services/cryptography/initializer-key\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { LinkedIdType } from \"../../enums\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { LocalData } from \"../data/local.data\";\nimport { Cipher } from \"../domain/cipher\";\n\nimport { AttachmentView } from \"./attachment.view\";\nimport { CardView } from \"./card.view\";\nimport { FieldView } from \"./field.view\";\nimport { IdentityView } from \"./identity.view\";\nimport { LoginView } from \"./login.view\";\nimport { PasswordHistoryView } from \"./password-history.view\";\nimport { SecureNoteView } from \"./secure-note.view\";\n\nexport class CipherView implements View, InitializerMetadata {\n  readonly initializerKey = InitializerKey.CipherView;\n\n  id: string = null;\n  organizationId: string = null;\n  folderId: string = null;\n  name: string = null;\n  notes: string = null;\n  type: CipherType = null;\n  favorite = false;\n  organizationUseTotp = false;\n  edit = false;\n  viewPassword = true;\n  localData: LocalData;\n  login = new LoginView();\n  identity = new IdentityView();\n  card = new CardView();\n  secureNote = new SecureNoteView();\n  attachments: AttachmentView[] = null;\n  fields: FieldView[] = null;\n  passwordHistory: PasswordHistoryView[] = null;\n  collectionIds: string[] = null;\n  revisionDate: Date = null;\n  creationDate: Date = null;\n  deletedDate: Date = null;\n  reprompt: CipherRepromptType = CipherRepromptType.None;\n\n  constructor(c?: Cipher) {\n    if (!c) {\n      return;\n    }\n\n    this.id = c.id;\n    this.organizationId = c.organizationId;\n    this.folderId = c.folderId;\n    this.favorite = c.favorite;\n    this.organizationUseTotp = c.organizationUseTotp;\n    this.edit = c.edit;\n    this.viewPassword = c.viewPassword;\n    this.type = c.type;\n    this.localData = c.localData;\n    this.collectionIds = c.collectionIds;\n    this.revisionDate = c.revisionDate;\n    this.creationDate = c.creationDate;\n    this.deletedDate = c.deletedDate;\n    // Old locally stored ciphers might have reprompt == null. If so set it to None.\n    this.reprompt = c.reprompt ?? CipherRepromptType.None;\n  }\n\n  private get item() {\n    switch (this.type) {\n      case CipherType.Login:\n        return this.login;\n      case CipherType.SecureNote:\n        return this.secureNote;\n      case CipherType.Card:\n        return this.card;\n      case CipherType.Identity:\n        return this.identity;\n      default:\n        break;\n    }\n\n    return null;\n  }\n\n  get subTitle(): string {\n    return this.item?.subTitle;\n  }\n\n  get hasPasswordHistory(): boolean {\n    return this.passwordHistory && this.passwordHistory.length > 0;\n  }\n\n  get hasAttachments(): boolean {\n    return this.attachments && this.attachments.length > 0;\n  }\n\n  get hasOldAttachments(): boolean {\n    if (this.hasAttachments) {\n      for (let i = 0; i < this.attachments.length; i++) {\n        if (this.attachments[i].key == null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  get hasFields(): boolean {\n    return this.fields && this.fields.length > 0;\n  }\n\n  get passwordRevisionDisplayDate(): Date {\n    if (this.type !== CipherType.Login || this.login == null) {\n      return null;\n    } else if (this.login.password == null || this.login.password === \"\") {\n      return null;\n    }\n    return this.login.passwordRevisionDate;\n  }\n\n  get isDeleted(): boolean {\n    return this.deletedDate != null;\n  }\n\n  get linkedFieldOptions() {\n    return this.item?.linkedFieldOptions;\n  }\n\n  get isUnassigned(): boolean {\n    return (\n      this.organizationId != null && (this.collectionIds == null || this.collectionIds.length === 0)\n    );\n  }\n\n  linkedFieldValue(id: LinkedIdType) {\n    const linkedFieldOption = this.linkedFieldOptions?.get(id);\n    if (linkedFieldOption == null) {\n      return null;\n    }\n\n    const item = this.item;\n    return this.item[linkedFieldOption.propertyKey as keyof typeof item];\n  }\n\n  linkedFieldI18nKey(id: LinkedIdType): string {\n    return this.linkedFieldOptions.get(id)?.i18nKey;\n  }\n\n  // This is used as a marker to indicate that the cipher view object still has its prototype\n  toJSON() {\n    return this;\n  }\n\n  static fromJSON(obj: Partial<DeepJsonify<CipherView>>): CipherView {\n    if (obj == null) {\n      return null;\n    }\n\n    const view = new CipherView();\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const deletedDate = obj.deletedDate == null ? null : new Date(obj.deletedDate);\n    const attachments = obj.attachments?.map((a: any) => AttachmentView.fromJSON(a));\n    const fields = obj.fields?.map((f: any) => FieldView.fromJSON(f));\n    const passwordHistory = obj.passwordHistory?.map((ph: any) => PasswordHistoryView.fromJSON(ph));\n\n    Object.assign(view, obj, {\n      revisionDate: revisionDate,\n      deletedDate: deletedDate,\n      attachments: attachments,\n      fields: fields,\n      passwordHistory: passwordHistory,\n    });\n\n    switch (obj.type) {\n      case CipherType.Card:\n        view.card = CardView.fromJSON(obj.card);\n        break;\n      case CipherType.Identity:\n        view.identity = IdentityView.fromJSON(obj.identity);\n        break;\n      case CipherType.Login:\n        view.login = LoginView.fromJSON(obj.login);\n        break;\n      case CipherType.SecureNote:\n        view.secureNote = SecureNoteView.fromJSON(obj.secureNote);\n        break;\n      default:\n        break;\n    }\n\n    return view;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { AttachmentData } from \"../data/attachment.data\";\nimport { AttachmentView } from \"../view/attachment.view\";\n\nexport class Attachment extends Domain {\n  id: string;\n  url: string;\n  size: string;\n  sizeName: string; // Readable size, ex: \"4.2 KB\" or \"1.43 GB\"\n  key: EncString;\n  fileName: EncString;\n\n  constructor(obj?: AttachmentData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.size = obj.size;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        url: null,\n        sizeName: null,\n        fileName: null,\n        key: null,\n      },\n      [\"id\", \"url\", \"sizeName\"],\n    );\n  }\n\n  async decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<AttachmentView> {\n    const view = await this.decryptObj(\n      new AttachmentView(this),\n      {\n        fileName: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    if (this.key != null) {\n      view.key = await this.decryptAttachmentKey(orgId, encKey);\n    }\n\n    return view;\n  }\n\n  private async decryptAttachmentKey(orgId: string, encKey?: SymmetricCryptoKey) {\n    try {\n      if (encKey == null) {\n        encKey = await this.getKeyForDecryption(orgId);\n      }\n\n      const encryptService = Utils.getContainerService().getEncryptService();\n      const decValue = await encryptService.decryptToBytes(this.key, encKey);\n      return new SymmetricCryptoKey(decValue);\n    } catch (e) {\n      // TODO: error?\n    }\n  }\n\n  private async getKeyForDecryption(orgId: string) {\n    const cryptoService = Utils.getContainerService().getCryptoService();\n    return orgId != null\n      ? await cryptoService.getOrgKey(orgId)\n      : await cryptoService.getUserKeyWithLegacySupport();\n  }\n\n  toAttachmentData(): AttachmentData {\n    const a = new AttachmentData();\n    a.size = this.size;\n    this.buildDataModel(\n      this,\n      a,\n      {\n        id: null,\n        url: null,\n        sizeName: null,\n        fileName: null,\n        key: null,\n      },\n      [\"id\", \"url\", \"sizeName\"],\n    );\n    return a;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Attachment>>): Attachment {\n    if (obj == null) {\n      return null;\n    }\n\n    const key = EncString.fromJSON(obj.key);\n    const fileName = EncString.fromJSON(obj.fileName);\n\n    return Object.assign(new Attachment(), obj, {\n      key,\n      fileName,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { CardData } from \"../data/card.data\";\nimport { CardView } from \"../view/card.view\";\n\nexport class Card extends Domain {\n  cardholderName: EncString;\n  brand: EncString;\n  number: EncString;\n  expMonth: EncString;\n  expYear: EncString;\n  code: EncString;\n\n  constructor(obj?: CardData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        cardholderName: null,\n        brand: null,\n        number: null,\n        expMonth: null,\n        expYear: null,\n        code: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<CardView> {\n    return this.decryptObj(\n      new CardView(),\n      {\n        cardholderName: null,\n        brand: null,\n        number: null,\n        expMonth: null,\n        expYear: null,\n        code: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toCardData(): CardData {\n    const c = new CardData();\n    this.buildDataModel(this, c, {\n      cardholderName: null,\n      brand: null,\n      number: null,\n      expMonth: null,\n      expYear: null,\n      code: null,\n    });\n    return c;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Card>>): Card {\n    if (obj == null) {\n      return null;\n    }\n\n    const cardholderName = EncString.fromJSON(obj.cardholderName);\n    const brand = EncString.fromJSON(obj.brand);\n    const number = EncString.fromJSON(obj.number);\n    const expMonth = EncString.fromJSON(obj.expMonth);\n    const expYear = EncString.fromJSON(obj.expYear);\n    const code = EncString.fromJSON(obj.code);\n    return Object.assign(new Card(), obj, {\n      cardholderName,\n      brand,\n      number,\n      expMonth,\n      expYear,\n      code,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\nimport { FieldData } from \"../data/field.data\";\nimport { FieldView } from \"../view/field.view\";\n\nexport class Field extends Domain {\n  name: EncString;\n  value: EncString;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(obj?: FieldData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.type = obj.type;\n    this.linkedId = obj.linkedId;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        name: null,\n        value: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<FieldView> {\n    return this.decryptObj(\n      new FieldView(this),\n      {\n        name: null,\n        value: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toFieldData(): FieldData {\n    const f = new FieldData();\n    this.buildDataModel(\n      this,\n      f,\n      {\n        name: null,\n        value: null,\n        type: null,\n        linkedId: null,\n      },\n      [\"type\", \"linkedId\"],\n    );\n    return f;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Field>>): Field {\n    if (obj == null) {\n      return null;\n    }\n\n    const name = EncString.fromJSON(obj.name);\n    const value = EncString.fromJSON(obj.value);\n\n    return Object.assign(new Field(), obj, {\n      name,\n      value,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { IdentityData } from \"../data/identity.data\";\nimport { IdentityView } from \"../view/identity.view\";\n\nexport class Identity extends Domain {\n  title: EncString;\n  firstName: EncString;\n  middleName: EncString;\n  lastName: EncString;\n  address1: EncString;\n  address2: EncString;\n  address3: EncString;\n  city: EncString;\n  state: EncString;\n  postalCode: EncString;\n  country: EncString;\n  company: EncString;\n  email: EncString;\n  phone: EncString;\n  ssn: EncString;\n  username: EncString;\n  passportNumber: EncString;\n  licenseNumber: EncString;\n\n  constructor(obj?: IdentityData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        title: null,\n        firstName: null,\n        middleName: null,\n        lastName: null,\n        address1: null,\n        address2: null,\n        address3: null,\n        city: null,\n        state: null,\n        postalCode: null,\n        country: null,\n        company: null,\n        email: null,\n        phone: null,\n        ssn: null,\n        username: null,\n        passportNumber: null,\n        licenseNumber: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<IdentityView> {\n    return this.decryptObj(\n      new IdentityView(),\n      {\n        title: null,\n        firstName: null,\n        middleName: null,\n        lastName: null,\n        address1: null,\n        address2: null,\n        address3: null,\n        city: null,\n        state: null,\n        postalCode: null,\n        country: null,\n        company: null,\n        email: null,\n        phone: null,\n        ssn: null,\n        username: null,\n        passportNumber: null,\n        licenseNumber: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toIdentityData(): IdentityData {\n    const i = new IdentityData();\n    this.buildDataModel(this, i, {\n      title: null,\n      firstName: null,\n      middleName: null,\n      lastName: null,\n      address1: null,\n      address2: null,\n      address3: null,\n      city: null,\n      state: null,\n      postalCode: null,\n      country: null,\n      company: null,\n      email: null,\n      phone: null,\n      ssn: null,\n      username: null,\n      passportNumber: null,\n      licenseNumber: null,\n    });\n    return i;\n  }\n\n  static fromJSON(obj: Jsonify<Identity>): Identity {\n    if (obj == null) {\n      return null;\n    }\n\n    const title = EncString.fromJSON(obj.title);\n    const firstName = EncString.fromJSON(obj.firstName);\n    const middleName = EncString.fromJSON(obj.middleName);\n    const lastName = EncString.fromJSON(obj.lastName);\n    const address1 = EncString.fromJSON(obj.address1);\n    const address2 = EncString.fromJSON(obj.address2);\n    const address3 = EncString.fromJSON(obj.address3);\n    const city = EncString.fromJSON(obj.city);\n    const state = EncString.fromJSON(obj.state);\n    const postalCode = EncString.fromJSON(obj.postalCode);\n    const country = EncString.fromJSON(obj.country);\n    const company = EncString.fromJSON(obj.company);\n    const email = EncString.fromJSON(obj.email);\n    const phone = EncString.fromJSON(obj.phone);\n    const ssn = EncString.fromJSON(obj.ssn);\n    const username = EncString.fromJSON(obj.username);\n    const passportNumber = EncString.fromJSON(obj.passportNumber);\n    const licenseNumber = EncString.fromJSON(obj.licenseNumber);\n\n    return Object.assign(new Identity(), obj, {\n      title,\n      firstName,\n      middleName,\n      lastName,\n      address1,\n      address2,\n      address3,\n      city,\n      state,\n      postalCode,\n      country,\n      company,\n      email,\n      phone,\n      ssn,\n      username,\n      passportNumber,\n      licenseNumber,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { Fido2CredentialData } from \"../data/fido2-credential.data\";\nimport { Fido2CredentialView } from \"../view/fido2-credential.view\";\n\nexport class Fido2Credential extends Domain {\n  credentialId: EncString | null = null;\n  keyType: EncString;\n  keyAlgorithm: EncString;\n  keyCurve: EncString;\n  keyValue: EncString;\n  rpId: EncString;\n  userHandle: EncString;\n  userName: EncString;\n  counter: EncString;\n  rpName: EncString;\n  userDisplayName: EncString;\n  discoverable: EncString;\n  creationDate: Date;\n\n  constructor(obj?: Fido2CredentialData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        credentialId: null,\n        keyType: null,\n        keyAlgorithm: null,\n        keyCurve: null,\n        keyValue: null,\n        rpId: null,\n        userHandle: null,\n        userName: null,\n        counter: null,\n        rpName: null,\n        userDisplayName: null,\n        discoverable: null,\n      },\n      [],\n    );\n    this.creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n  }\n\n  async decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<Fido2CredentialView> {\n    const view = await this.decryptObj(\n      new Fido2CredentialView(),\n      {\n        credentialId: null,\n        keyType: null,\n        keyAlgorithm: null,\n        keyCurve: null,\n        keyValue: null,\n        rpId: null,\n        userHandle: null,\n        userName: null,\n        rpName: null,\n        userDisplayName: null,\n        discoverable: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    const { counter } = await this.decryptObj(\n      { counter: \"\" },\n      {\n        counter: null,\n      },\n      orgId,\n      encKey,\n    );\n    // Counter will end up as NaN if this fails\n    view.counter = parseInt(counter);\n\n    const { discoverable } = await this.decryptObj(\n      { discoverable: \"\" },\n      {\n        discoverable: null,\n      },\n      orgId,\n      encKey,\n    );\n    view.discoverable = discoverable === \"true\";\n    view.creationDate = this.creationDate;\n\n    return view;\n  }\n\n  toFido2CredentialData(): Fido2CredentialData {\n    const i = new Fido2CredentialData();\n    i.creationDate = this.creationDate.toISOString();\n    this.buildDataModel(this, i, {\n      credentialId: null,\n      keyType: null,\n      keyAlgorithm: null,\n      keyCurve: null,\n      keyValue: null,\n      rpId: null,\n      userHandle: null,\n      userName: null,\n      counter: null,\n      rpName: null,\n      userDisplayName: null,\n      discoverable: null,\n    });\n    return i;\n  }\n\n  static fromJSON(obj: Jsonify<Fido2Credential>): Fido2Credential {\n    if (obj == null) {\n      return null;\n    }\n\n    const credentialId = EncString.fromJSON(obj.credentialId);\n    const keyType = EncString.fromJSON(obj.keyType);\n    const keyAlgorithm = EncString.fromJSON(obj.keyAlgorithm);\n    const keyCurve = EncString.fromJSON(obj.keyCurve);\n    const keyValue = EncString.fromJSON(obj.keyValue);\n    const rpId = EncString.fromJSON(obj.rpId);\n    const userHandle = EncString.fromJSON(obj.userHandle);\n    const userName = EncString.fromJSON(obj.userName);\n    const counter = EncString.fromJSON(obj.counter);\n    const rpName = EncString.fromJSON(obj.rpName);\n    const userDisplayName = EncString.fromJSON(obj.userDisplayName);\n    const discoverable = EncString.fromJSON(obj.discoverable);\n    const creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n\n    return Object.assign(new Fido2Credential(), obj, {\n      credentialId,\n      keyType,\n      keyAlgorithm,\n      keyCurve,\n      keyValue,\n      rpId,\n      userHandle,\n      userName,\n      counter,\n      rpName,\n      userDisplayName,\n      discoverable,\n      creationDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { LoginUriData } from \"../data/login-uri.data\";\nimport { LoginUriView } from \"../view/login-uri.view\";\n\nexport class LoginUri extends Domain {\n  uri: EncString;\n  uriChecksum: EncString | undefined;\n  match: UriMatchStrategySetting;\n\n  constructor(obj?: LoginUriData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.match = obj.match;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        uri: null,\n        uriChecksum: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<LoginUriView> {\n    return this.decryptObj(\n      new LoginUriView(this),\n      {\n        uri: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  async validateChecksum(clearTextUri: string, orgId: string, encKey: SymmetricCryptoKey) {\n    if (this.uriChecksum == null) {\n      return false;\n    }\n\n    const cryptoService = Utils.getContainerService().getEncryptService();\n    const localChecksum = await cryptoService.hash(clearTextUri, \"sha256\");\n\n    const remoteChecksum = await this.uriChecksum.decrypt(orgId, encKey);\n    return remoteChecksum === localChecksum;\n  }\n\n  toLoginUriData(): LoginUriData {\n    const u = new LoginUriData();\n    this.buildDataModel(\n      this,\n      u,\n      {\n        uri: null,\n        uriChecksum: null,\n        match: null,\n      },\n      [\"match\"],\n    );\n    return u;\n  }\n\n  static fromJSON(obj: Jsonify<LoginUri>): LoginUri {\n    if (obj == null) {\n      return null;\n    }\n\n    const uri = EncString.fromJSON(obj.uri);\n    const uriChecksum = EncString.fromJSON(obj.uriChecksum);\n    return Object.assign(new LoginUri(), obj, {\n      uri,\n      uriChecksum,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { LoginData } from \"../data/login.data\";\nimport { LoginView } from \"../view/login.view\";\n\nimport { Fido2Credential } from \"./fido2-credential\";\nimport { LoginUri } from \"./login-uri\";\n\nexport class Login extends Domain {\n  uris: LoginUri[];\n  username: EncString;\n  password: EncString;\n  passwordRevisionDate?: Date;\n  totp: EncString;\n  autofillOnPageLoad: boolean;\n  fido2Credentials: Fido2Credential[];\n\n  constructor(obj?: LoginData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.passwordRevisionDate =\n      obj.passwordRevisionDate != null ? new Date(obj.passwordRevisionDate) : null;\n    this.autofillOnPageLoad = obj.autofillOnPageLoad;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        username: null,\n        password: null,\n        totp: null,\n      },\n      [],\n    );\n\n    if (obj.uris) {\n      this.uris = [];\n      obj.uris.forEach((u) => {\n        this.uris.push(new LoginUri(u));\n      });\n    }\n\n    if (obj.fido2Credentials) {\n      this.fido2Credentials = obj.fido2Credentials.map((key) => new Fido2Credential(key));\n    }\n  }\n\n  async decrypt(\n    orgId: string,\n    bypassValidation: boolean,\n    encKey?: SymmetricCryptoKey,\n  ): Promise<LoginView> {\n    const view = await this.decryptObj(\n      new LoginView(this),\n      {\n        username: null,\n        password: null,\n        totp: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    if (this.uris != null) {\n      view.uris = [];\n      for (let i = 0; i < this.uris.length; i++) {\n        const uri = await this.uris[i].decrypt(orgId, encKey);\n        // URIs are shared remotely after decryption\n        // we need to validate that the string hasn't been changed by a compromised server\n        // This validation is tied to the existence of cypher.key for backwards compatibility\n        // So we bypass the validation if there's no cipher.key or procceed with the validation and\n        // Skip the value if it's been tampered with.\n        if (bypassValidation || (await this.uris[i].validateChecksum(uri.uri, orgId, encKey))) {\n          view.uris.push(uri);\n        }\n      }\n    }\n\n    if (this.fido2Credentials != null) {\n      view.fido2Credentials = await Promise.all(\n        this.fido2Credentials.map((key) => key.decrypt(orgId, encKey)),\n      );\n    }\n\n    return view;\n  }\n\n  toLoginData(): LoginData {\n    const l = new LoginData();\n    l.passwordRevisionDate =\n      this.passwordRevisionDate != null ? this.passwordRevisionDate.toISOString() : null;\n    l.autofillOnPageLoad = this.autofillOnPageLoad;\n    this.buildDataModel(this, l, {\n      username: null,\n      password: null,\n      totp: null,\n    });\n\n    if (this.uris != null && this.uris.length > 0) {\n      l.uris = [];\n      this.uris.forEach((u) => {\n        l.uris.push(u.toLoginUriData());\n      });\n    }\n\n    if (this.fido2Credentials != null && this.fido2Credentials.length > 0) {\n      l.fido2Credentials = this.fido2Credentials.map((key) => key.toFido2CredentialData());\n    }\n\n    return l;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Login>>): Login {\n    if (obj == null) {\n      return null;\n    }\n\n    const username = EncString.fromJSON(obj.username);\n    const password = EncString.fromJSON(obj.password);\n    const totp = EncString.fromJSON(obj.totp);\n    const passwordRevisionDate =\n      obj.passwordRevisionDate == null ? null : new Date(obj.passwordRevisionDate);\n    const uris = obj.uris?.map((uri: any) => LoginUri.fromJSON(uri));\n    const fido2Credentials =\n      obj.fido2Credentials?.map((key) => Fido2Credential.fromJSON(key)) ?? [];\n\n    return Object.assign(new Login(), obj, {\n      username,\n      password,\n      totp,\n      passwordRevisionDate,\n      uris,\n      fido2Credentials,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { PasswordHistoryData } from \"../data/password-history.data\";\nimport { PasswordHistoryView } from \"../view/password-history.view\";\n\nexport class Password extends Domain {\n  password: EncString;\n  lastUsedDate: Date;\n\n  constructor(obj?: PasswordHistoryData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(this, obj, {\n      password: null,\n    });\n    this.lastUsedDate = new Date(obj.lastUsedDate);\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<PasswordHistoryView> {\n    return this.decryptObj(\n      new PasswordHistoryView(this),\n      {\n        password: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toPasswordHistoryData(): PasswordHistoryData {\n    const ph = new PasswordHistoryData();\n    ph.lastUsedDate = this.lastUsedDate.toISOString();\n    this.buildDataModel(this, ph, {\n      password: null,\n    });\n    return ph;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Password>>): Password {\n    if (obj == null) {\n      return null;\n    }\n\n    const password = EncString.fromJSON(obj.password);\n    const lastUsedDate = obj.lastUsedDate == null ? null : new Date(obj.lastUsedDate);\n\n    return Object.assign(new Password(), obj, {\n      password,\n      lastUsedDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { SecureNoteType } from \"../../enums\";\nimport { SecureNoteData } from \"../data/secure-note.data\";\nimport { SecureNoteView } from \"../view/secure-note.view\";\n\nexport class SecureNote extends Domain {\n  type: SecureNoteType;\n\n  constructor(obj?: SecureNoteData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.type = obj.type;\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<SecureNoteView> {\n    return Promise.resolve(new SecureNoteView(this));\n  }\n\n  toSecureNoteData(): SecureNoteData {\n    const n = new SecureNoteData();\n    n.type = this.type;\n    return n;\n  }\n\n  static fromJSON(obj: Jsonify<SecureNote>): SecureNote {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SecureNote(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Decryptable } from \"../../../platform/interfaces/decryptable.interface\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { InitializerKey } from \"../../../platform/services/cryptography/initializer-key\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CipherData } from \"../data/cipher.data\";\nimport { LocalData } from \"../data/local.data\";\nimport { CipherView } from \"../view/cipher.view\";\n\nimport { Attachment } from \"./attachment\";\nimport { Card } from \"./card\";\nimport { Field } from \"./field\";\nimport { Identity } from \"./identity\";\nimport { Login } from \"./login\";\nimport { Password } from \"./password\";\nimport { SecureNote } from \"./secure-note\";\n\nexport class Cipher extends Domain implements Decryptable<CipherView> {\n  readonly initializerKey = InitializerKey.Cipher;\n\n  id: string;\n  organizationId: string;\n  folderId: string;\n  name: EncString;\n  notes: EncString;\n  type: CipherType;\n  favorite: boolean;\n  organizationUseTotp: boolean;\n  edit: boolean;\n  viewPassword: boolean;\n  revisionDate: Date;\n  localData: LocalData;\n  login: Login;\n  identity: Identity;\n  card: Card;\n  secureNote: SecureNote;\n  attachments: Attachment[];\n  fields: Field[];\n  passwordHistory: Password[];\n  collectionIds: string[];\n  creationDate: Date;\n  deletedDate: Date;\n  reprompt: CipherRepromptType;\n  key: EncString;\n\n  constructor(obj?: CipherData, localData: LocalData = null) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        organizationId: null,\n        folderId: null,\n        name: null,\n        notes: null,\n        key: null,\n      },\n      [\"id\", \"organizationId\", \"folderId\"],\n    );\n\n    this.type = obj.type;\n    this.favorite = obj.favorite;\n    this.organizationUseTotp = obj.organizationUseTotp;\n    this.edit = obj.edit;\n    if (obj.viewPassword != null) {\n      this.viewPassword = obj.viewPassword;\n    } else {\n      this.viewPassword = true; // Default for already synced Ciphers without viewPassword\n    }\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n    this.collectionIds = obj.collectionIds;\n    this.localData = localData;\n    this.creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n    this.deletedDate = obj.deletedDate != null ? new Date(obj.deletedDate) : null;\n    this.reprompt = obj.reprompt;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new Login(obj.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNote(obj.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new Card(obj.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new Identity(obj.identity);\n        break;\n      default:\n        break;\n    }\n\n    if (obj.attachments != null) {\n      this.attachments = obj.attachments.map((a) => new Attachment(a));\n    } else {\n      this.attachments = null;\n    }\n\n    if (obj.fields != null) {\n      this.fields = obj.fields.map((f) => new Field(f));\n    } else {\n      this.fields = null;\n    }\n\n    if (obj.passwordHistory != null) {\n      this.passwordHistory = obj.passwordHistory.map((ph) => new Password(ph));\n    } else {\n      this.passwordHistory = null;\n    }\n  }\n\n  // We are passing the organizationId into the EncString.decrypt() method here, but because the encKey will always be\n  // present and so the organizationId will not be used.\n  // We will refactor the EncString.decrypt() in https://bitwarden.atlassian.net/browse/PM-3762 to remove the dependency on the organizationId.\n  async decrypt(encKey: SymmetricCryptoKey): Promise<CipherView> {\n    const model = new CipherView(this);\n    let bypassValidation = true;\n\n    if (this.key != null) {\n      const encryptService = Utils.getContainerService().getEncryptService();\n      encKey = new SymmetricCryptoKey(await encryptService.decryptToBytes(this.key, encKey));\n      bypassValidation = false;\n    }\n\n    await this.decryptObj(\n      model,\n      {\n        name: null,\n        notes: null,\n      },\n      this.organizationId,\n      encKey,\n    );\n\n    switch (this.type) {\n      case CipherType.Login:\n        model.login = await this.login.decrypt(this.organizationId, bypassValidation, encKey);\n        break;\n      case CipherType.SecureNote:\n        model.secureNote = await this.secureNote.decrypt(this.organizationId, encKey);\n        break;\n      case CipherType.Card:\n        model.card = await this.card.decrypt(this.organizationId, encKey);\n        break;\n      case CipherType.Identity:\n        model.identity = await this.identity.decrypt(this.organizationId, encKey);\n        break;\n      default:\n        break;\n    }\n\n    if (this.attachments != null && this.attachments.length > 0) {\n      const attachments: any[] = [];\n      await this.attachments.reduce((promise, attachment) => {\n        return promise\n          .then(() => {\n            return attachment.decrypt(this.organizationId, encKey);\n          })\n          .then((decAttachment) => {\n            attachments.push(decAttachment);\n          });\n      }, Promise.resolve());\n      model.attachments = attachments;\n    }\n\n    if (this.fields != null && this.fields.length > 0) {\n      const fields: any[] = [];\n      await this.fields.reduce((promise, field) => {\n        return promise\n          .then(() => {\n            return field.decrypt(this.organizationId, encKey);\n          })\n          .then((decField) => {\n            fields.push(decField);\n          });\n      }, Promise.resolve());\n      model.fields = fields;\n    }\n\n    if (this.passwordHistory != null && this.passwordHistory.length > 0) {\n      const passwordHistory: any[] = [];\n      await this.passwordHistory.reduce((promise, ph) => {\n        return promise\n          .then(() => {\n            return ph.decrypt(this.organizationId, encKey);\n          })\n          .then((decPh) => {\n            passwordHistory.push(decPh);\n          });\n      }, Promise.resolve());\n      model.passwordHistory = passwordHistory;\n    }\n\n    return model;\n  }\n\n  toCipherData(): CipherData {\n    const c = new CipherData();\n    c.id = this.id;\n    c.organizationId = this.organizationId;\n    c.folderId = this.folderId;\n    c.edit = this.edit;\n    c.viewPassword = this.viewPassword;\n    c.organizationUseTotp = this.organizationUseTotp;\n    c.favorite = this.favorite;\n    c.revisionDate = this.revisionDate != null ? this.revisionDate.toISOString() : null;\n    c.type = this.type;\n    c.collectionIds = this.collectionIds;\n    c.creationDate = this.creationDate != null ? this.creationDate.toISOString() : null;\n    c.deletedDate = this.deletedDate != null ? this.deletedDate.toISOString() : null;\n    c.reprompt = this.reprompt;\n    c.key = this.key?.encryptedString;\n\n    this.buildDataModel(this, c, {\n      name: null,\n      notes: null,\n    });\n\n    switch (c.type) {\n      case CipherType.Login:\n        c.login = this.login.toLoginData();\n        break;\n      case CipherType.SecureNote:\n        c.secureNote = this.secureNote.toSecureNoteData();\n        break;\n      case CipherType.Card:\n        c.card = this.card.toCardData();\n        break;\n      case CipherType.Identity:\n        c.identity = this.identity.toIdentityData();\n        break;\n      default:\n        break;\n    }\n\n    if (this.fields != null) {\n      c.fields = this.fields.map((f) => f.toFieldData());\n    }\n    if (this.attachments != null) {\n      c.attachments = this.attachments.map((a) => a.toAttachmentData());\n    }\n    if (this.passwordHistory != null) {\n      c.passwordHistory = this.passwordHistory.map((ph) => ph.toPasswordHistoryData());\n    }\n    return c;\n  }\n\n  static fromJSON(obj: Jsonify<Cipher>) {\n    if (obj == null) {\n      return null;\n    }\n\n    const domain = new Cipher();\n    const name = EncString.fromJSON(obj.name);\n    const notes = EncString.fromJSON(obj.notes);\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const deletedDate = obj.deletedDate == null ? null : new Date(obj.deletedDate);\n    const attachments = obj.attachments?.map((a: any) => Attachment.fromJSON(a));\n    const fields = obj.fields?.map((f: any) => Field.fromJSON(f));\n    const passwordHistory = obj.passwordHistory?.map((ph: any) => Password.fromJSON(ph));\n    const key = EncString.fromJSON(obj.key);\n\n    Object.assign(domain, obj, {\n      name,\n      notes,\n      revisionDate,\n      deletedDate,\n      attachments,\n      fields,\n      passwordHistory,\n      key,\n    });\n\n    switch (obj.type) {\n      case CipherType.Card:\n        domain.card = Card.fromJSON(obj.card);\n        break;\n      case CipherType.Identity:\n        domain.identity = Identity.fromJSON(obj.identity);\n        break;\n      case CipherType.Login:\n        domain.login = Login.fromJSON(obj.login);\n        break;\n      case CipherType.SecureNote:\n        domain.secureNote = SecureNote.fromJSON(obj.secureNote);\n        break;\n      default:\n        break;\n    }\n\n    return domain;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Cipher } from \"../../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../../vault/models/view/cipher.view\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\n\nimport { InitializerKey } from \"./initializer-key\";\n\n/**\n * Internal reference of classes so we can reconstruct objects properly.\n * Each entry should be keyed using the Decryptable.initializerKey property\n */\nconst classInitializers: Record<InitializerKey, (obj: any) => any> = {\n  [InitializerKey.Cipher]: Cipher.fromJSON,\n  [InitializerKey.CipherView]: CipherView.fromJSON,\n};\n\nexport function getClassInitializer<T extends InitializerMetadata>(\n  className: InitializerKey,\n): (obj: Jsonify<T>) => T {\n  return classInitializers[className];\n}\n","import { defaultIfEmpty, filter, firstValueFrom, fromEvent, map, Subject, takeUntil } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { Decryptable } from \"../../interfaces/decryptable.interface\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\n\nimport { EncryptServiceImplementation } from \"./encrypt.service.implementation\";\nimport { getClassInitializer } from \"./get-class-initializer\";\n\n// TTL (time to live) is not strictly required but avoids tying up memory resources if inactive\nconst workerTTL = 3 * 60000; // 3 minutes\n\nexport class MultithreadEncryptServiceImplementation extends EncryptServiceImplementation {\n  private worker: Worker;\n  private timeout: any;\n\n  private clear$ = new Subject<void>();\n\n  /**\n   * Sends items to a web worker to decrypt them.\n   * This utilises multithreading to decrypt items faster without interrupting other operations (e.g. updating UI).\n   */\n  async decryptItems<T extends InitializerMetadata>(\n    items: Decryptable<T>[],\n    key: SymmetricCryptoKey,\n  ): Promise<T[]> {\n    if (items == null || items.length < 1) {\n      return [];\n    }\n\n    this.logService.info(\"Starting decryption using multithreading\");\n\n    this.worker ??= new Worker(\n      new URL(\n        /* webpackChunkName: 'encrypt-worker' */\n        \"@bitwarden/common/platform/services/cryptography/encrypt.worker.ts\",\n        import.meta.url,\n      ),\n    );\n\n    this.restartTimeout();\n\n    const request = {\n      id: Utils.newGuid(),\n      items: items,\n      key: key,\n    };\n\n    this.worker.postMessage(JSON.stringify(request));\n\n    return await firstValueFrom(\n      fromEvent(this.worker, \"message\").pipe(\n        filter((response: MessageEvent) => response.data?.id === request.id),\n        map((response) => JSON.parse(response.data.items)),\n        map((items) =>\n          items.map((jsonItem: Jsonify<T>) => {\n            const initializer = getClassInitializer<T>(jsonItem.initializerKey);\n            return initializer(jsonItem);\n          }),\n        ),\n        takeUntil(this.clear$),\n        defaultIfEmpty([]),\n      ),\n    );\n  }\n\n  private clear() {\n    this.clear$.next();\n    this.worker?.terminate();\n    this.worker = null;\n    this.clearTimeout();\n  }\n\n  private restartTimeout() {\n    this.clearTimeout();\n    this.timeout = setTimeout(() => this.clear(), workerTTL);\n  }\n\n  private clearTimeout() {\n    if (this.timeout != null) {\n      clearTimeout(this.timeout);\n    }\n  }\n}\n","/**\n * This class represents an abstraction of the WebAuthn Authenticator model as described by W3C:\n * https://www.w3.org/TR/webauthn-3/#sctn-authenticator-model\n *\n * The authenticator provides key management and cryptographic signatures.\n */\nexport abstract class Fido2AuthenticatorService {\n  /**\n   * Create and save a new credential as described in:\n   * https://www.w3.org/TR/webauthn-3/#sctn-op-make-cred\n   *\n   * @param params Parameters for creating a new credential\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the new credential and an attestation signature.\n   **/\n  makeCredential: (\n    params: Fido2AuthenticatorMakeCredentialsParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<Fido2AuthenticatorMakeCredentialResult>;\n\n  /**\n   * Generate an assertion using an existing credential as describe in:\n   * https://www.w3.org/TR/webauthn-3/#sctn-op-get-assertion\n   *\n   * @param params Parameters for generating an assertion\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the asserted credential and an assertion signature.\n   */\n  getAssertion: (\n    params: Fido2AuthenticatorGetAssertionParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<Fido2AuthenticatorGetAssertionResult>;\n}\n\nexport enum Fido2AlgorithmIdentifier {\n  ES256 = -7,\n  RS256 = -257,\n}\n\nexport enum Fido2AuthenticatorErrorCode {\n  Unknown = \"UnknownError\",\n  NotSupported = \"NotSupportedError\",\n  InvalidState = \"InvalidStateError\",\n  NotAllowed = \"NotAllowedError\",\n  Constraint = \"ConstraintError\",\n}\n\nexport class Fido2AuthenticatorError extends Error {\n  constructor(readonly errorCode: Fido2AuthenticatorErrorCode) {\n    super(errorCode);\n  }\n}\n\nexport interface PublicKeyCredentialDescriptor {\n  id: BufferSource;\n  transports?: (\"ble\" | \"hybrid\" | \"internal\" | \"nfc\" | \"usb\")[];\n  type: \"public-key\";\n}\n\n/**\n * Parameters for {@link Fido2AuthenticatorService.makeCredential}\n *\n * This interface represents the input parameters described in\n * https://www.w3.org/TR/webauthn-3/#sctn-op-make-cred\n */\nexport interface Fido2AuthenticatorMakeCredentialsParams {\n  /** The hash of the serialized client data, provided by the client. */\n  hash: BufferSource;\n  /** The Relying Party's PublicKeyCredentialRpEntity. */\n  rpEntity: {\n    name: string;\n    id?: string;\n  };\n  /** The user account’s PublicKeyCredentialUserEntity, containing the user handle given by the Relying Party. */\n  userEntity: {\n    id: BufferSource;\n    name?: string;\n    displayName?: string;\n    icon?: string;\n  };\n  /** A sequence of pairs of PublicKeyCredentialType and public key algorithms (COSEAlgorithmIdentifier) requested by the Relying Party. This sequence is ordered from most preferred to least preferred. The authenticator makes a best-effort to create the most preferred credential that it can. */\n  credTypesAndPubKeyAlgs: {\n    alg: number;\n    type: \"public-key\"; // not used\n  }[];\n  /** An OPTIONAL list of PublicKeyCredentialDescriptor objects provided by the Relying Party with the intention that, if any of these are known to the authenticator, it SHOULD NOT create a new credential. excludeCredentialDescriptorList contains a list of known credentials. */\n  excludeCredentialDescriptorList?: PublicKeyCredentialDescriptor[];\n  /** A map from extension identifiers to their authenticator extension inputs, created by the client based on the extensions requested by the Relying Party, if any. */\n  extensions?: {\n    appid?: string;\n    appidExclude?: string;\n    credProps?: boolean;\n    uvm?: boolean;\n  };\n  /** A Boolean value that indicates that individually-identifying attestation MAY be returned by the authenticator. */\n  enterpriseAttestationPossible?: boolean; // Ignored by bitwarden at the moment\n  /** The effective resident key requirement for credential creation, a Boolean value determined by the client. Resident is synonymous with discoverable. */\n  requireResidentKey: boolean;\n  requireUserVerification: boolean;\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n  /** The constant Boolean value true. It is included here as a pseudo-parameter to simplify applying this abstract authenticator model to implementations that may wish to make a test of user presence optional although WebAuthn does not. */\n  // requireUserPresence: true; // Always required\n}\n\nexport interface Fido2AuthenticatorMakeCredentialResult {\n  credentialId: BufferSource;\n  attestationObject: BufferSource;\n  authData: BufferSource;\n  publicKey: BufferSource;\n  publicKeyAlgorithm: number;\n}\n\n/**\n * Parameters for {@link Fido2AuthenticatorService.getAssertion}\n\n * This interface represents the input parameters described in\n * https://www.w3.org/TR/webauthn-3/#sctn-op-get-assertion\n */\nexport interface Fido2AuthenticatorGetAssertionParams {\n  /** The caller’s RP ID, as determined by the user agent and the client. */\n  rpId: string;\n  /** The hash of the serialized client data, provided by the client. */\n  hash: BufferSource;\n  allowCredentialDescriptorList: PublicKeyCredentialDescriptor[];\n  /** The effective user verification requirement for assertion, a Boolean value provided by the client. */\n  requireUserVerification: boolean;\n  /** The constant Boolean value true. It is included here as a pseudo-parameter to simplify applying this abstract authenticator model to implementations that may wish to make a test of user presence optional although WebAuthn does not. */\n  // requireUserPresence: boolean; // Always required\n  extensions: unknown;\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n}\n\nexport interface Fido2AuthenticatorGetAssertionResult {\n  selectedCredential: {\n    id: Uint8Array;\n    userHandle?: Uint8Array;\n  };\n  authenticatorData: Uint8Array;\n  signature: Uint8Array;\n}\n","/**\nThe MIT License (MIT)\n\nCopyright (c) 2014-2016 Patrick Gansterer <paroga@paroga.com>\nCopyright (c) 2020-present Aaron Huggins <ahuggins@aaronhuggins.com>\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\nExported from GitHub release version 0.4.0\n*/\n\n/* eslint-disable */\n/** @hidden */\nconst POW_2_24 = 5.960464477539063e-8;\n/** @hidden */\nconst POW_2_32 = 4294967296;\n/** @hidden */\nconst POW_2_53 = 9007199254740992;\n/** @hidden */\nconst DECODE_CHUNK_SIZE = 8192;\n\n/** @hidden */\nfunction objectIs(x: any, y: any) {\n  if (typeof Object.is === \"function\") return Object.is(x, y);\n\n  // SameValue algorithm\n  // Steps 1-5, 7-10\n  if (x === y) {\n    // Steps 6.b-6.e: +0 != -0\n    return x !== 0 || 1 / x === 1 / y;\n  }\n\n  // Step 6.a: NaN == NaN\n  return x !== x && y !== y;\n}\n\n/** A function that extracts tagged values. */\ntype TaggedValueFunction = (value: any, tag: number) => TaggedValue;\n/** A function that extracts simple values. */\ntype SimpleValueFunction = (value: any) => SimpleValue;\n\n/** Convenience class for structuring a tagged value. */\nexport class TaggedValue {\n  constructor(value: any, tag: number) {\n    this.value = value;\n    this.tag = tag;\n  }\n\n  value: any;\n  tag: number;\n}\n\n/** Convenience class for structuring a simple value. */\nexport class SimpleValue {\n  constructor(value: any) {\n    this.value = value;\n  }\n\n  value: any;\n}\n\n/**\n * Converts a Concise Binary Object Representation (CBOR) buffer into an object.\n * @param {ArrayBuffer|SharedArrayBuffer} data - A valid CBOR buffer.\n * @param {Function} [tagger] - A function that extracts tagged values. This function is called for each member of the object.\n * @param {Function} [simpleValue] - A function that extracts simple values. This function is called for each member of the object.\n * @returns {any} The CBOR buffer converted to a JavaScript value.\n */\nexport function decode<T = any>(\n  data: ArrayBuffer | SharedArrayBuffer,\n  tagger?: TaggedValueFunction,\n  simpleValue?: SimpleValueFunction,\n): T {\n  let dataView = new DataView(data);\n  let ta = new Uint8Array(data);\n  let offset = 0;\n  let tagValueFunction: TaggedValueFunction = function (value: number, tag: number): any {\n    return new TaggedValue(value, tag);\n  };\n  let simpleValFunction: SimpleValueFunction = function (value: number): SimpleValue {\n    return undefined as unknown as SimpleValue;\n  };\n\n  if (typeof tagger === \"function\") tagValueFunction = tagger;\n  if (typeof simpleValue === \"function\") simpleValFunction = simpleValue;\n\n  function commitRead<T>(length: number, value: T): T {\n    offset += length;\n    return value;\n  }\n  function readArrayBuffer(length: number) {\n    return commitRead(length, new Uint8Array(data, offset, length));\n  }\n  function readFloat16() {\n    let tempArrayBuffer = new ArrayBuffer(4);\n    let tempDataView = new DataView(tempArrayBuffer);\n    let value = readUint16();\n\n    let sign = value & 0x8000;\n    let exponent = value & 0x7c00;\n    let fraction = value & 0x03ff;\n\n    if (exponent === 0x7c00) exponent = 0xff << 10;\n    else if (exponent !== 0) exponent += (127 - 15) << 10;\n    else if (fraction !== 0) return (sign ? -1 : 1) * fraction * POW_2_24;\n\n    tempDataView.setUint32(0, (sign << 16) | (exponent << 13) | (fraction << 13));\n    return tempDataView.getFloat32(0);\n  }\n  function readFloat32(): number {\n    return commitRead(4, dataView.getFloat32(offset));\n  }\n  function readFloat64(): number {\n    return commitRead(8, dataView.getFloat64(offset));\n  }\n  function readUint8(): number {\n    return commitRead(1, ta[offset]);\n  }\n  function readUint16(): number {\n    return commitRead(2, dataView.getUint16(offset));\n  }\n  function readUint32(): number {\n    return commitRead(4, dataView.getUint32(offset));\n  }\n  function readUint64(): number {\n    return readUint32() * POW_2_32 + readUint32();\n  }\n  function readBreak(): boolean {\n    if (ta[offset] !== 0xff) return false;\n    offset += 1;\n    return true;\n  }\n  function readLength(additionalInformation: number): number {\n    if (additionalInformation < 24) return additionalInformation;\n    if (additionalInformation === 24) return readUint8();\n    if (additionalInformation === 25) return readUint16();\n    if (additionalInformation === 26) return readUint32();\n    if (additionalInformation === 27) return readUint64();\n    if (additionalInformation === 31) return -1;\n    throw new Error(\"Invalid length encoding\");\n  }\n  function readIndefiniteStringLength(majorType: number): number {\n    let initialByte = readUint8();\n    if (initialByte === 0xff) return -1;\n    let length = readLength(initialByte & 0x1f);\n    if (length < 0 || initialByte >> 5 !== majorType)\n      throw new Error(\"Invalid indefinite length element\");\n    return length;\n  }\n\n  function appendUtf16Data(utf16data: number[], length: number) {\n    for (let i = 0; i < length; ++i) {\n      let value = readUint8();\n      if (value & 0x80) {\n        if (value < 0xe0) {\n          value = ((value & 0x1f) << 6) | (readUint8() & 0x3f);\n          length -= 1;\n        } else if (value < 0xf0) {\n          value = ((value & 0x0f) << 12) | ((readUint8() & 0x3f) << 6) | (readUint8() & 0x3f);\n          length -= 2;\n        } else {\n          value =\n            ((value & 0x0f) << 18) |\n            ((readUint8() & 0x3f) << 12) |\n            ((readUint8() & 0x3f) << 6) |\n            (readUint8() & 0x3f);\n          length -= 3;\n        }\n      }\n\n      if (value < 0x10000) {\n        utf16data.push(value);\n      } else {\n        value -= 0x10000;\n        utf16data.push(0xd800 | (value >> 10));\n        utf16data.push(0xdc00 | (value & 0x3ff));\n      }\n    }\n  }\n\n  function decodeItem(): any {\n    let initialByte = readUint8();\n    let majorType = initialByte >> 5;\n    let additionalInformation = initialByte & 0x1f;\n    let i;\n    let length;\n\n    if (majorType === 7) {\n      switch (additionalInformation) {\n        case 25:\n          return readFloat16();\n        case 26:\n          return readFloat32();\n        case 27:\n          return readFloat64();\n      }\n    }\n\n    length = readLength(additionalInformation);\n    if (length < 0 && (majorType < 2 || 6 < majorType)) throw new Error(\"Invalid length\");\n\n    switch (majorType) {\n      case 0:\n        return length;\n      case 1:\n        return -1 - length;\n      case 2:\n        if (length < 0) {\n          let elements = [];\n          let fullArrayLength = 0;\n          while ((length = readIndefiniteStringLength(majorType)) >= 0) {\n            fullArrayLength += length;\n            elements.push(readArrayBuffer(length));\n          }\n          let fullArray = new Uint8Array(fullArrayLength);\n          let fullArrayOffset = 0;\n          for (i = 0; i < elements.length; ++i) {\n            fullArray.set(elements[i], fullArrayOffset);\n            fullArrayOffset += elements[i].length;\n          }\n          return fullArray;\n        }\n        return readArrayBuffer(length);\n      case 3:\n        let utf16data: number[] = [];\n        if (length < 0) {\n          while ((length = readIndefiniteStringLength(majorType)) >= 0)\n            appendUtf16Data(utf16data, length);\n        } else {\n          appendUtf16Data(utf16data, length);\n        }\n        let string = \"\";\n        for (i = 0; i < utf16data.length; i += DECODE_CHUNK_SIZE) {\n          string += String.fromCharCode.apply(null, utf16data.slice(i, i + DECODE_CHUNK_SIZE));\n        }\n        return string;\n      case 4:\n        let retArray;\n        if (length < 0) {\n          retArray = [];\n          while (!readBreak()) retArray.push(decodeItem());\n        } else {\n          retArray = new Array(length);\n          for (i = 0; i < length; ++i) retArray[i] = decodeItem();\n        }\n        return retArray;\n      case 5:\n        let retObject: any = {};\n        for (i = 0; i < length || (length < 0 && !readBreak()); ++i) {\n          let key = decodeItem();\n          retObject[key] = decodeItem();\n        }\n        return retObject;\n      case 6:\n        return tagValueFunction(decodeItem(), length);\n      case 7:\n        switch (length) {\n          case 20:\n            return false;\n          case 21:\n            return true;\n          case 22:\n            return null;\n          case 23:\n            return undefined;\n          default:\n            return simpleValFunction(length);\n        }\n    }\n  }\n\n  let ret = decodeItem();\n  if (offset !== data.byteLength) throw new Error(\"Remaining bytes\");\n  return ret;\n}\n\n/**\n * Converts a JavaScript value to a Concise Binary Object Representation (CBOR) buffer.\n * @param {any} value - A JavaScript value, usually an object or array, to be converted.\n * @returns {ArrayBuffer} The JavaScript value converted to CBOR format.\n */\nexport function encode<T = any>(value: T): ArrayBuffer {\n  let data = new ArrayBuffer(256);\n  let dataView = new DataView(data);\n  let byteView = new Uint8Array(data);\n  let lastLength: number;\n  let offset = 0;\n\n  function prepareWrite(length: number): DataView {\n    let newByteLength = data.byteLength;\n    let requiredLength = offset + length;\n    while (newByteLength < requiredLength) newByteLength <<= 1;\n    if (newByteLength !== data.byteLength) {\n      let oldDataView = dataView;\n      data = new ArrayBuffer(newByteLength);\n      dataView = new DataView(data);\n      byteView = new Uint8Array(data);\n      let uint32count = (offset + 3) >> 2;\n      for (let i = 0; i < uint32count; ++i)\n        dataView.setUint32(i << 2, oldDataView.getUint32(i << 2));\n    }\n\n    lastLength = length;\n    return dataView;\n  }\n  function commitWrite(...args: any[]) {\n    offset += lastLength;\n  }\n  function writeFloat64(val: number) {\n    commitWrite(prepareWrite(8).setFloat64(offset, val));\n  }\n  function writeUint8(val: number) {\n    commitWrite(prepareWrite(1).setUint8(offset, val));\n  }\n  function writeUint8Array(val: number[] | Uint8Array) {\n    prepareWrite(val.length);\n    byteView.set(val, offset);\n    commitWrite();\n  }\n  function writeUint16(val: number) {\n    commitWrite(prepareWrite(2).setUint16(offset, val));\n  }\n  function writeUint32(val: number) {\n    commitWrite(prepareWrite(4).setUint32(offset, val));\n  }\n  function writeUint64(val: number) {\n    let low = val % POW_2_32;\n    let high = (val - low) / POW_2_32;\n    let view = prepareWrite(8);\n    view.setUint32(offset, high);\n    view.setUint32(offset + 4, low);\n    commitWrite();\n  }\n  function writeVarUint(val: number, mod: number = 0) {\n    if (val <= 0xff) {\n      if (val < 24) {\n        writeUint8(val | mod);\n      } else {\n        writeUint8(0x18 | mod);\n        writeUint8(val);\n      }\n    } else if (val <= 0xffff) {\n      writeUint8(0x19 | mod);\n      writeUint16(val);\n    } else if (val <= 0xffffffff) {\n      writeUint8(0x1a | mod);\n      writeUint32(val);\n    } else {\n      writeUint8(0x1b | mod);\n      writeUint64(val);\n    }\n  }\n  function writeTypeAndLength(type: number, length: number) {\n    if (length < 24) {\n      writeUint8((type << 5) | length);\n    } else if (length < 0x100) {\n      writeUint8((type << 5) | 24);\n      writeUint8(length);\n    } else if (length < 0x10000) {\n      writeUint8((type << 5) | 25);\n      writeUint16(length);\n    } else if (length < 0x100000000) {\n      writeUint8((type << 5) | 26);\n      writeUint32(length);\n    } else {\n      writeUint8((type << 5) | 27);\n      writeUint64(length);\n    }\n  }\n\n  function encodeItem(val: any) {\n    let i;\n\n    if (val === false) return writeUint8(0xf4);\n    if (val === true) return writeUint8(0xf5);\n    if (val === null) return writeUint8(0xf6);\n    if (val === undefined) return writeUint8(0xf7);\n    if (objectIs(val, -0)) return writeUint8Array([0xf9, 0x80, 0x00]);\n\n    switch (typeof val) {\n      case \"number\":\n        if (Math.floor(val) === val) {\n          if (0 <= val && val <= POW_2_53) return writeTypeAndLength(0, val);\n          if (-POW_2_53 <= val && val < 0) return writeTypeAndLength(1, -(val + 1));\n        }\n        writeUint8(0xfb);\n        return writeFloat64(val);\n\n      case \"string\":\n        let utf8data = [];\n        for (i = 0; i < val.length; ++i) {\n          let charCode = val.charCodeAt(i);\n          if (charCode < 0x80) {\n            utf8data.push(charCode);\n          } else if (charCode < 0x800) {\n            utf8data.push(0xc0 | (charCode >> 6));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          } else if (charCode < 0xd800 || charCode >= 0xe000) {\n            utf8data.push(0xe0 | (charCode >> 12));\n            utf8data.push(0x80 | ((charCode >> 6) & 0x3f));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          } else {\n            charCode = (charCode & 0x3ff) << 10;\n            charCode |= val.charCodeAt(++i) & 0x3ff;\n            charCode += 0x10000;\n\n            utf8data.push(0xf0 | (charCode >> 18));\n            utf8data.push(0x80 | ((charCode >> 12) & 0x3f));\n            utf8data.push(0x80 | ((charCode >> 6) & 0x3f));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          }\n        }\n\n        writeTypeAndLength(3, utf8data.length);\n        return writeUint8Array(utf8data);\n\n      default:\n        let length;\n        let converted;\n        if (Array.isArray(val)) {\n          length = val.length;\n          writeTypeAndLength(4, length);\n          for (i = 0; i < length; i += 1) encodeItem(val[i]);\n        } else if (val instanceof Uint8Array) {\n          writeTypeAndLength(2, val.length);\n          writeUint8Array(val);\n        } else if (ArrayBuffer.isView(val)) {\n          converted = new Uint8Array(val.buffer);\n          writeTypeAndLength(2, converted.length);\n          writeUint8Array(converted);\n        } else if (\n          val instanceof ArrayBuffer ||\n          (typeof SharedArrayBuffer === \"function\" && val instanceof SharedArrayBuffer)\n        ) {\n          converted = new Uint8Array(val);\n          writeTypeAndLength(2, converted.length);\n          writeUint8Array(converted);\n        } else if (val instanceof TaggedValue) {\n          writeVarUint(val.tag, 0b11000000);\n          encodeItem(val.value);\n        } else {\n          let keys = Object.keys(val);\n          length = keys.length;\n          writeTypeAndLength(5, length);\n          for (i = 0; i < length; i += 1) {\n            let key = keys[i];\n            encodeItem(key);\n            encodeItem(val[key]);\n          }\n        }\n    }\n  }\n\n  encodeItem(value);\n\n  if (\"slice\" in data) return data.slice(0, offset);\n\n  let ret = new ArrayBuffer(offset);\n  let retView = new DataView(ret);\n  for (let i = 0; i < offset; ++i) retView.setUint8(i, dataView.getUint8(i));\n  return ret;\n}\n\n/**\n * An intrinsic object that provides functions to convert JavaScript values\n * to and from the Concise Binary Object Representation (CBOR) format.\n */\nexport const CBOR: {\n  decode: <T = any>(\n    data: ArrayBuffer | SharedArrayBuffer,\n    tagger?: TaggedValueFunction,\n    simpleValue?: SimpleValueFunction,\n  ) => T;\n  encode: <T = any>(value: T) => ArrayBuffer;\n} = {\n  decode,\n  encode,\n};\n","/*\n   Copyright 2015 D2L Corporation\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n// Changes:\n// - Cherry-pick the methods that we have a need for.\n// - Add typings.\n// - Original code is made for running in node, this version is adapted to work in the browser.\n\n// https://github.com/Brightspace/node-ecdsa-sig-formatter/blob/master/src/param-bytes-for-alg.js\n\nfunction getParamSize(keySize: number) {\n  const result = ((keySize / 8) | 0) + (keySize % 8 === 0 ? 0 : 1);\n  return result;\n}\n\nconst paramBytesForAlg = {\n  ES256: getParamSize(256),\n  ES384: getParamSize(384),\n  ES512: getParamSize(521),\n};\n\ntype Alg = keyof typeof paramBytesForAlg;\n\nfunction getParamBytesForAlg(alg: Alg) {\n  const paramBytes = paramBytesForAlg[alg];\n  if (paramBytes) {\n    return paramBytes;\n  }\n\n  throw new Error('Unknown algorithm \"' + alg + '\"');\n}\n\n// https://github.com/Brightspace/node-ecdsa-sig-formatter/blob/master/src/ecdsa-sig-formatter.js\n\nconst MAX_OCTET = 0x80,\n  CLASS_UNIVERSAL = 0,\n  PRIMITIVE_BIT = 0x20,\n  TAG_SEQ = 0x10,\n  TAG_INT = 0x02,\n  ENCODED_TAG_SEQ = TAG_SEQ | PRIMITIVE_BIT | (CLASS_UNIVERSAL << 6),\n  ENCODED_TAG_INT = TAG_INT | (CLASS_UNIVERSAL << 6);\n\n// Counts leading zeros and determines if there's a need for 0x00 padding\nfunction countPadding(\n  buf: Uint8Array,\n  start: number,\n  end: number,\n): { padding: number; needs0x00: boolean } {\n  let padding = 0;\n  while (start + padding < end && buf[start + padding] === 0) {\n    padding++;\n  }\n\n  const needs0x00 = (buf[start + padding] & MAX_OCTET) === MAX_OCTET;\n  return { padding, needs0x00 };\n}\n\nexport function p1363ToDer(signature: Uint8Array) {\n  const alg = \"ES256\";\n  const paramBytes = getParamBytesForAlg(alg);\n\n  const signatureBytes = signature.length;\n  if (signatureBytes !== paramBytes * 2) {\n    throw new TypeError(\n      '\"' +\n        alg +\n        '\" signatures must be \"' +\n        paramBytes * 2 +\n        '\" bytes, saw \"' +\n        signatureBytes +\n        '\"',\n    );\n  }\n\n  const { padding: rPadding, needs0x00: rNeeds0x00 } = countPadding(signature, 0, paramBytes);\n  const { padding: sPadding, needs0x00: sNeeds0x00 } = countPadding(\n    signature,\n    paramBytes,\n    signature.length,\n  );\n\n  const rActualLength = paramBytes - rPadding;\n  const sActualLength = paramBytes - sPadding;\n\n  const rLength = rActualLength + (rNeeds0x00 ? 1 : 0);\n  const sLength = sActualLength + (sNeeds0x00 ? 1 : 0);\n\n  const rsBytes = 2 + rLength + 2 + sLength;\n\n  const shortLength = rsBytes < MAX_OCTET;\n\n  const dst = new Uint8Array((shortLength ? 2 : 3) + rsBytes);\n\n  let offset = 0;\n  dst[offset++] = ENCODED_TAG_SEQ;\n  if (shortLength) {\n    dst[offset++] = rsBytes;\n  } else {\n    dst[offset++] = MAX_OCTET | 1;\n    dst[offset++] = rsBytes & 0xff;\n  }\n\n  // Encoding 'R' component\n  dst[offset++] = ENCODED_TAG_INT;\n  dst[offset++] = rLength;\n  if (rNeeds0x00) {\n    dst[offset++] = 0;\n  }\n  dst.set(signature.subarray(rPadding, rPadding + rActualLength), offset);\n  offset += rActualLength;\n\n  // Encoding 'S' component\n  dst[offset++] = ENCODED_TAG_INT;\n  dst[offset++] = sLength;\n  if (sNeeds0x00) {\n    dst[offset++] = 0;\n  }\n  dst.set(signature.subarray(paramBytes + sPadding, paramBytes + sPadding + sActualLength), offset);\n\n  return dst;\n}\n","export class Fido2Utils {\n  static bufferToString(bufferSource: BufferSource): string {\n    let buffer: Uint8Array;\n    if (bufferSource instanceof ArrayBuffer || bufferSource.buffer === undefined) {\n      buffer = new Uint8Array(bufferSource as ArrayBuffer);\n    } else {\n      buffer = new Uint8Array(bufferSource.buffer);\n    }\n\n    return Fido2Utils.fromBufferToB64(buffer)\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=/g, \"\");\n  }\n\n  static stringToBuffer(str: string): Uint8Array {\n    return Fido2Utils.fromB64ToArray(Fido2Utils.fromUrlB64ToB64(str));\n  }\n\n  static bufferSourceToUint8Array(bufferSource: BufferSource) {\n    if (Fido2Utils.isArrayBuffer(bufferSource)) {\n      return new Uint8Array(bufferSource);\n    } else {\n      return new Uint8Array(bufferSource.buffer);\n    }\n  }\n\n  /** Utility function to identify type of bufferSource. Necessary because of differences between runtimes */\n  private static isArrayBuffer(bufferSource: BufferSource): bufferSource is ArrayBuffer {\n    return bufferSource instanceof ArrayBuffer || bufferSource.buffer === undefined;\n  }\n\n  static fromB64toUrlB64(b64Str: string) {\n    return b64Str.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n  }\n\n  static fromBufferToB64(buffer: ArrayBuffer): string {\n    if (buffer == null) {\n      return null;\n    }\n\n    let binary = \"\";\n    const bytes = new Uint8Array(buffer);\n    for (let i = 0; i < bytes.byteLength; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return globalThis.btoa(binary);\n  }\n\n  static fromB64ToArray(str: string): Uint8Array {\n    if (str == null) {\n      return null;\n    }\n\n    const binaryString = globalThis.atob(str);\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes;\n  }\n\n  static fromUrlB64ToB64(urlB64Str: string): string {\n    let output = urlB64Str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += \"==\";\n        break;\n      case 3:\n        output += \"=\";\n        break;\n      default:\n        throw new Error(\"Illegal base64url string!\");\n    }\n\n    return output;\n  }\n}\n","/*\n  License for: guidToRawFormat, guidToStandardFormat\n  Source: https://github.com/uuidjs/uuid/\n  The MIT License (MIT)\n  Copyright (c) 2010-2020 Robert Kieffer and other contributors\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.*/\n\n/** Private array used for optimization */\nconst byteToHex = Array.from({ length: 256 }, (_, i) => (i + 0x100).toString(16).substring(1));\n\n/** Convert standard format (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX) UUID to raw 16 byte array. */\nexport function guidToRawFormat(guid: string) {\n  if (!isValidGuid(guid)) {\n    throw TypeError(\"GUID parameter is invalid\");\n  }\n\n  let v;\n  const arr = new Uint8Array(16);\n\n  // Parse ########-....-....-....-............\n  arr[0] = (v = parseInt(guid.slice(0, 8), 16)) >>> 24;\n  arr[1] = (v >>> 16) & 0xff;\n  arr[2] = (v >>> 8) & 0xff;\n  arr[3] = v & 0xff;\n\n  // Parse ........-####-....-....-............\n  arr[4] = (v = parseInt(guid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff;\n\n  // Parse ........-....-####-....-............\n  arr[6] = (v = parseInt(guid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff;\n\n  // Parse ........-....-....-####-............\n  arr[8] = (v = parseInt(guid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff;\n\n  // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n  arr[10] = ((v = parseInt(guid.slice(24, 36), 16)) / 0x10000000000) & 0xff;\n  arr[11] = (v / 0x100000000) & 0xff;\n  arr[12] = (v >>> 24) & 0xff;\n  arr[13] = (v >>> 16) & 0xff;\n  arr[14] = (v >>> 8) & 0xff;\n  arr[15] = v & 0xff;\n\n  return arr;\n}\n\n/** Convert raw 16 byte array to standard format (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX) UUID. */\nexport function guidToStandardFormat(bufferSource: BufferSource) {\n  const arr =\n    bufferSource instanceof ArrayBuffer\n      ? new Uint8Array(bufferSource)\n      : new Uint8Array(bufferSource.buffer);\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  const guid = (\n    byteToHex[arr[0]] +\n    byteToHex[arr[1]] +\n    byteToHex[arr[2]] +\n    byteToHex[arr[3]] +\n    \"-\" +\n    byteToHex[arr[4]] +\n    byteToHex[arr[5]] +\n    \"-\" +\n    byteToHex[arr[6]] +\n    byteToHex[arr[7]] +\n    \"-\" +\n    byteToHex[arr[8]] +\n    byteToHex[arr[9]] +\n    \"-\" +\n    byteToHex[arr[10]] +\n    byteToHex[arr[11]] +\n    byteToHex[arr[12]] +\n    byteToHex[arr[13]] +\n    byteToHex[arr[14]] +\n    byteToHex[arr[15]]\n  ).toLowerCase();\n\n  // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // or more input array values not mapping to a hex octet (leading to \"undefined\" in the uuid)\n  if (!isValidGuid(guid)) {\n    throw TypeError(\"Converted GUID is invalid\");\n  }\n\n  return guid;\n}\n\n// Perform format validation, without enforcing any variant restrictions as Utils.isGuid does\nfunction isValidGuid(guid: string): boolean {\n  return RegExp(/^[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/, \"i\").test(guid);\n}\n","import { CipherService } from \"../../../vault/abstractions/cipher.service\";\nimport { SyncService } from \"../../../vault/abstractions/sync/sync.service.abstraction\";\nimport { CipherRepromptType } from \"../../../vault/enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../../vault/enums/cipher-type\";\nimport { CipherView } from \"../../../vault/models/view/cipher.view\";\nimport { Fido2CredentialView } from \"../../../vault/models/view/fido2-credential.view\";\nimport {\n  Fido2AlgorithmIdentifier,\n  Fido2AuthenticatorError,\n  Fido2AuthenticatorErrorCode,\n  Fido2AuthenticatorGetAssertionParams,\n  Fido2AuthenticatorGetAssertionResult,\n  Fido2AuthenticatorMakeCredentialResult,\n  Fido2AuthenticatorMakeCredentialsParams,\n  Fido2AuthenticatorService as Fido2AuthenticatorServiceAbstraction,\n  PublicKeyCredentialDescriptor,\n} from \"../../abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport { Fido2UserInterfaceService } from \"../../abstractions/fido2/fido2-user-interface.service.abstraction\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { Utils } from \"../../misc/utils\";\n\nimport { CBOR } from \"./cbor\";\nimport { p1363ToDer } from \"./ecdsa-utils\";\nimport { Fido2Utils } from \"./fido2-utils\";\nimport { guidToRawFormat, guidToStandardFormat } from \"./guid-utils\";\n\n// AAGUID: d548826e-79b4-db40-a3d8-11116f7e8349\nexport const AAGUID = new Uint8Array([\n  0xd5, 0x48, 0x82, 0x6e, 0x79, 0xb4, 0xdb, 0x40, 0xa3, 0xd8, 0x11, 0x11, 0x6f, 0x7e, 0x83, 0x49,\n]);\n\nconst KeyUsages: KeyUsage[] = [\"sign\"];\n\n/**\n * Bitwarden implementation of the WebAuthn Authenticator Model as described by W3C\n * https://www.w3.org/TR/webauthn-3/#sctn-authenticator-model\n *\n * It is highly recommended that the W3C specification is used a reference when reading this code.\n */\nexport class Fido2AuthenticatorService implements Fido2AuthenticatorServiceAbstraction {\n  constructor(\n    private cipherService: CipherService,\n    private userInterface: Fido2UserInterfaceService,\n    private syncService: SyncService,\n    private logService?: LogService,\n  ) {}\n\n  async makeCredential(\n    params: Fido2AuthenticatorMakeCredentialsParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2AuthenticatorMakeCredentialResult> {\n    const userInterfaceSession = await this.userInterface.newSession(\n      params.fallbackSupported,\n      tab,\n      abortController,\n    );\n\n    try {\n      if (params.credTypesAndPubKeyAlgs.every((p) => p.alg !== Fido2AlgorithmIdentifier.ES256)) {\n        const requestedAlgorithms = params.credTypesAndPubKeyAlgs.map((p) => p.alg).join(\", \");\n        this.logService?.warning(\n          `[Fido2Authenticator] No compatible algorithms found, RP requested: ${requestedAlgorithms}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotSupported);\n      }\n\n      if (\n        params.requireResidentKey != undefined &&\n        typeof params.requireResidentKey !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireResidentKey' value: ${String(\n            params.requireResidentKey,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      if (\n        params.requireUserVerification != undefined &&\n        typeof params.requireUserVerification !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireUserVerification' value: ${String(\n            params.requireUserVerification,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      await userInterfaceSession.ensureUnlockedVault();\n      await this.syncService.fullSync(false);\n\n      const existingCipherIds = await this.findExcludedCredentials(\n        params.excludeCredentialDescriptorList,\n      );\n      if (existingCipherIds.length > 0) {\n        this.logService?.info(\n          `[Fido2Authenticator] Aborting due to excluded credential found in vault.`,\n        );\n        await userInterfaceSession.informExcludedCredential(existingCipherIds);\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      let cipher: CipherView;\n      let fido2Credential: Fido2CredentialView;\n      let keyPair: CryptoKeyPair;\n      let userVerified = false;\n      let credentialId: string;\n      let pubKeyDer: ArrayBuffer;\n      const response = await userInterfaceSession.confirmNewCredential({\n        credentialName: params.rpEntity.name,\n        userName: params.userEntity.displayName,\n        userVerification: params.requireUserVerification,\n        rpId: params.rpEntity.id,\n      });\n      const cipherId = response.cipherId;\n      userVerified = response.userVerified;\n\n      if (cipherId === undefined) {\n        this.logService?.warning(\n          `[Fido2Authenticator] Aborting because user confirmation was not recieved.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      try {\n        keyPair = await createKeyPair();\n        pubKeyDer = await crypto.subtle.exportKey(\"spki\", keyPair.publicKey);\n        const encrypted = await this.cipherService.get(cipherId);\n        cipher = await encrypted.decrypt(\n          await this.cipherService.getKeyForCipherKeyDecryption(encrypted),\n        );\n\n        if (\n          !userVerified &&\n          (params.requireUserVerification || cipher.reprompt !== CipherRepromptType.None)\n        ) {\n          this.logService?.warning(\n            `[Fido2Authenticator] Aborting because user verification was unsuccessful.`,\n          );\n          throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n        }\n\n        fido2Credential = await createKeyView(params, keyPair.privateKey);\n        cipher.login.fido2Credentials = [fido2Credential];\n        const reencrypted = await this.cipherService.encrypt(cipher);\n        await this.cipherService.updateWithServer(reencrypted);\n        credentialId = fido2Credential.credentialId;\n      } catch (error) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because of unknown error when creating credential: ${error}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      const authData = await generateAuthData({\n        rpId: params.rpEntity.id,\n        credentialId: guidToRawFormat(credentialId),\n        counter: fido2Credential.counter,\n        userPresence: true,\n        userVerification: userVerified,\n        keyPair,\n      });\n      const attestationObject = new Uint8Array(\n        CBOR.encode({\n          fmt: \"none\",\n          attStmt: {},\n          authData,\n        }),\n      );\n\n      return {\n        credentialId: guidToRawFormat(credentialId),\n        attestationObject,\n        authData,\n        publicKey: pubKeyDer,\n        publicKeyAlgorithm: -7,\n      };\n    } finally {\n      userInterfaceSession.close();\n    }\n  }\n\n  async getAssertion(\n    params: Fido2AuthenticatorGetAssertionParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2AuthenticatorGetAssertionResult> {\n    const userInterfaceSession = await this.userInterface.newSession(\n      params.fallbackSupported,\n      tab,\n      abortController,\n    );\n    try {\n      if (\n        params.requireUserVerification != undefined &&\n        typeof params.requireUserVerification !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireUserVerification' value: ${String(\n            params.requireUserVerification,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      let cipherOptions: CipherView[];\n\n      await userInterfaceSession.ensureUnlockedVault();\n      await this.syncService.fullSync(false);\n\n      if (params.allowCredentialDescriptorList?.length > 0) {\n        cipherOptions = await this.findCredentialsById(\n          params.allowCredentialDescriptorList,\n          params.rpId,\n        );\n      } else {\n        cipherOptions = await this.findCredentialsByRp(params.rpId);\n      }\n\n      if (cipherOptions.length === 0) {\n        this.logService?.info(\n          `[Fido2Authenticator] Aborting because no matching credentials were found in the vault.`,\n        );\n\n        await userInterfaceSession.informCredentialNotFound();\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      const response = await userInterfaceSession.pickCredential({\n        cipherIds: cipherOptions.map((cipher) => cipher.id),\n        userVerification: params.requireUserVerification,\n      });\n      const selectedCipherId = response.cipherId;\n      const userVerified = response.userVerified;\n      const selectedCipher = cipherOptions.find((c) => c.id === selectedCipherId);\n\n      if (selectedCipher === undefined) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because the selected credential could not be found.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      if (\n        !userVerified &&\n        (params.requireUserVerification || selectedCipher.reprompt !== CipherRepromptType.None)\n      ) {\n        this.logService?.warning(\n          `[Fido2Authenticator] Aborting because user verification was unsuccessful.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      try {\n        const selectedFido2Credential = selectedCipher.login.fido2Credentials[0];\n        const selectedCredentialId = selectedFido2Credential.credentialId;\n\n        if (selectedFido2Credential.counter > 0) {\n          ++selectedFido2Credential.counter;\n        }\n\n        selectedCipher.localData = {\n          ...selectedCipher.localData,\n          lastUsedDate: new Date().getTime(),\n        };\n\n        if (selectedFido2Credential.counter > 0) {\n          const encrypted = await this.cipherService.encrypt(selectedCipher);\n          await this.cipherService.updateWithServer(encrypted);\n        }\n\n        const authenticatorData = await generateAuthData({\n          rpId: selectedFido2Credential.rpId,\n          credentialId: guidToRawFormat(selectedCredentialId),\n          counter: selectedFido2Credential.counter,\n          userPresence: true,\n          userVerification: userVerified,\n        });\n\n        const signature = await generateSignature({\n          authData: authenticatorData,\n          clientDataHash: params.hash,\n          privateKey: await getPrivateKeyFromFido2Credential(selectedFido2Credential),\n        });\n\n        return {\n          authenticatorData,\n          selectedCredential: {\n            id: guidToRawFormat(selectedCredentialId),\n            userHandle: Fido2Utils.stringToBuffer(selectedFido2Credential.userHandle),\n          },\n          signature,\n        };\n      } catch (error) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because of unknown error when asserting credential: ${error}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n    } finally {\n      userInterfaceSession.close();\n    }\n  }\n\n  /** Finds existing crendetials and returns the `cipherId` for each one */\n  private async findExcludedCredentials(\n    credentials: PublicKeyCredentialDescriptor[],\n  ): Promise<string[]> {\n    const ids: string[] = [];\n\n    for (const credential of credentials) {\n      try {\n        ids.push(guidToStandardFormat(credential.id));\n        // eslint-disable-next-line no-empty\n      } catch {}\n    }\n\n    if (ids.length === 0) {\n      return [];\n    }\n\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers\n      .filter(\n        (cipher) =>\n          !cipher.isDeleted &&\n          cipher.organizationId == undefined &&\n          cipher.type === CipherType.Login &&\n          cipher.login.hasFido2Credentials &&\n          ids.includes(cipher.login.fido2Credentials[0].credentialId),\n      )\n      .map((cipher) => cipher.id);\n  }\n\n  private async findCredentialsById(\n    credentials: PublicKeyCredentialDescriptor[],\n    rpId: string,\n  ): Promise<CipherView[]> {\n    const ids: string[] = [];\n\n    for (const credential of credentials) {\n      try {\n        ids.push(guidToStandardFormat(credential.id));\n        // eslint-disable-next-line no-empty\n      } catch {}\n    }\n\n    if (ids.length === 0) {\n      return [];\n    }\n\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers.filter(\n      (cipher) =>\n        !cipher.isDeleted &&\n        cipher.type === CipherType.Login &&\n        cipher.login.hasFido2Credentials &&\n        cipher.login.fido2Credentials[0].rpId === rpId &&\n        ids.includes(cipher.login.fido2Credentials[0].credentialId),\n    );\n  }\n\n  private async findCredentialsByRp(rpId: string): Promise<CipherView[]> {\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers.filter(\n      (cipher) =>\n        !cipher.isDeleted &&\n        cipher.type === CipherType.Login &&\n        cipher.login.hasFido2Credentials &&\n        cipher.login.fido2Credentials[0].rpId === rpId &&\n        cipher.login.fido2Credentials[0].discoverable,\n    );\n  }\n}\n\nasync function createKeyPair() {\n  return await crypto.subtle.generateKey(\n    {\n      name: \"ECDSA\",\n      namedCurve: \"P-256\",\n    },\n    true,\n    KeyUsages,\n  );\n}\n\nasync function createKeyView(\n  params: Fido2AuthenticatorMakeCredentialsParams,\n  keyValue: CryptoKey,\n): Promise<Fido2CredentialView> {\n  if (keyValue.algorithm.name !== \"ECDSA\" && (keyValue.algorithm as any).namedCurve !== \"P-256\") {\n    throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n  }\n\n  const pkcs8Key = await crypto.subtle.exportKey(\"pkcs8\", keyValue);\n  const fido2Credential = new Fido2CredentialView();\n  fido2Credential.credentialId = Utils.newGuid();\n  fido2Credential.keyType = \"public-key\";\n  fido2Credential.keyAlgorithm = \"ECDSA\";\n  fido2Credential.keyCurve = \"P-256\";\n  fido2Credential.keyValue = Fido2Utils.bufferToString(pkcs8Key);\n  fido2Credential.rpId = params.rpEntity.id;\n  fido2Credential.userHandle = Fido2Utils.bufferToString(params.userEntity.id);\n  fido2Credential.userName = params.userEntity.name;\n  fido2Credential.counter = 0;\n  fido2Credential.rpName = params.rpEntity.name;\n  fido2Credential.userDisplayName = params.userEntity.displayName;\n  fido2Credential.discoverable = params.requireResidentKey;\n  fido2Credential.creationDate = new Date();\n\n  return fido2Credential;\n}\n\nasync function getPrivateKeyFromFido2Credential(\n  fido2Credential: Fido2CredentialView,\n): Promise<CryptoKey> {\n  const keyBuffer = Fido2Utils.stringToBuffer(fido2Credential.keyValue);\n  return await crypto.subtle.importKey(\n    \"pkcs8\",\n    keyBuffer,\n    {\n      name: fido2Credential.keyAlgorithm,\n      namedCurve: fido2Credential.keyCurve,\n    } as EcKeyImportParams,\n    true,\n    KeyUsages,\n  );\n}\n\ninterface AuthDataParams {\n  rpId: string;\n  credentialId: BufferSource;\n  userPresence: boolean;\n  userVerification: boolean;\n  counter: number;\n  keyPair?: CryptoKeyPair;\n}\n\nasync function generateAuthData(params: AuthDataParams) {\n  const authData: Array<number> = [];\n\n  const rpIdHash = new Uint8Array(\n    await crypto.subtle.digest({ name: \"SHA-256\" }, Utils.fromByteStringToArray(params.rpId)),\n  );\n  authData.push(...rpIdHash);\n\n  const flags = authDataFlags({\n    extensionData: false,\n    attestationData: params.keyPair != undefined,\n    backupEligibility: true,\n    backupState: true, // Credentials are always synced\n    userVerification: params.userVerification,\n    userPresence: params.userPresence,\n  });\n  authData.push(flags);\n\n  // add 4 bytes of counter - we use time in epoch seconds as monotonic counter\n  // TODO: Consider changing this to a cryptographically safe random number\n  const counter = params.counter;\n  authData.push(\n    ((counter & 0xff000000) >> 24) & 0xff,\n    ((counter & 0x00ff0000) >> 16) & 0xff,\n    ((counter & 0x0000ff00) >> 8) & 0xff,\n    counter & 0x000000ff,\n  );\n\n  if (params.keyPair) {\n    // attestedCredentialData\n    const attestedCredentialData: Array<number> = [];\n\n    attestedCredentialData.push(...AAGUID);\n\n    // credentialIdLength (2 bytes) and credential Id\n    const rawId = Fido2Utils.bufferSourceToUint8Array(params.credentialId);\n    const credentialIdLength = [(rawId.length - (rawId.length & 0xff)) / 256, rawId.length & 0xff];\n    attestedCredentialData.push(...credentialIdLength);\n    attestedCredentialData.push(...rawId);\n\n    const publicKeyJwk = await crypto.subtle.exportKey(\"jwk\", params.keyPair.publicKey);\n    // COSE format of the EC256 key\n    const keyX = Utils.fromUrlB64ToArray(publicKeyJwk.x);\n    const keyY = Utils.fromUrlB64ToArray(publicKeyJwk.y);\n\n    // Can't get `cbor-redux` to encode in CTAP2 canonical CBOR. So we do it manually:\n    const coseBytes = new Uint8Array(77);\n    coseBytes.set([0xa5, 0x01, 0x02, 0x03, 0x26, 0x20, 0x01, 0x21, 0x58, 0x20], 0);\n    coseBytes.set(keyX, 10);\n    coseBytes.set([0x22, 0x58, 0x20], 10 + 32);\n    coseBytes.set(keyY, 10 + 32 + 3);\n\n    // credential public key - convert to array from CBOR encoded COSE key\n    attestedCredentialData.push(...coseBytes);\n\n    authData.push(...attestedCredentialData);\n  }\n\n  return new Uint8Array(authData);\n}\n\ninterface SignatureParams {\n  authData: Uint8Array;\n  clientDataHash: BufferSource;\n  privateKey: CryptoKey;\n}\n\nasync function generateSignature(params: SignatureParams) {\n  const sigBase = new Uint8Array([\n    ...params.authData,\n    ...Fido2Utils.bufferSourceToUint8Array(params.clientDataHash),\n  ]);\n  const p1363_signature = new Uint8Array(\n    await crypto.subtle.sign(\n      {\n        name: \"ECDSA\",\n        hash: { name: \"SHA-256\" },\n      },\n      params.privateKey,\n      sigBase,\n    ),\n  );\n\n  const asn1Der_signature = p1363ToDer(p1363_signature);\n\n  return asn1Der_signature;\n}\n\ninterface Flags {\n  extensionData: boolean;\n  attestationData: boolean;\n  backupEligibility: boolean;\n  backupState: boolean;\n  userVerification: boolean;\n  userPresence: boolean;\n}\n\nfunction authDataFlags(options: Flags): number {\n  let flags = 0;\n\n  if (options.extensionData) {\n    flags |= 0b1000000;\n  }\n\n  if (options.attestationData) {\n    flags |= 0b01000000;\n  }\n\n  if (options.backupEligibility) {\n    flags |= 0b00001000;\n  }\n\n  if (options.backupState) {\n    flags |= 0b00010000;\n  }\n\n  if (options.userVerification) {\n    flags |= 0b00000100;\n  }\n\n  if (options.userPresence) {\n    flags |= 0b00000001;\n  }\n\n  return flags;\n}\n","export const UserRequestedFallbackAbortReason = \"UserRequestedFallback\";\n\nexport type UserVerification = \"discouraged\" | \"preferred\" | \"required\";\n\n/**\n * This class represents an abstraction of the WebAuthn Client as described by W3C:\n * https://www.w3.org/TR/webauthn-3/#webauthn-client\n *\n * The WebAuthn Client is an intermediary entity typically implemented in the user agent\n * (in whole, or in part). Conceptually, it underlies the Web Authentication API and embodies\n * the implementation of the Web Authentication API's operations.\n *\n * It is responsible for both marshalling the inputs for the underlying authenticator operations,\n * and for returning the results of the latter operations to the Web Authentication API's callers.\n */\nexport abstract class Fido2ClientService {\n  isFido2FeatureEnabled: (hostname: string, origin: string) => Promise<boolean>;\n\n  /**\n   * Allows WebAuthn Relying Party scripts to request the creation of a new public key credential source.\n   * For more information please see: https://www.w3.org/TR/webauthn-3/#sctn-createCredential\n   *\n   * @param params The parameters for the credential creation operation.\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the new credential.\n   */\n  createCredential: (\n    params: CreateCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<CreateCredentialResult>;\n\n  /**\n   * Allows WebAuthn Relying Party scripts to discover and use an existing public key credential, with the user’s consent.\n   * Relying Party script can optionally specify some criteria to indicate what credential sources are acceptable to it.\n   * For more information please see: https://www.w3.org/TR/webauthn-3/#sctn-getAssertion\n   *\n   * @param params The parameters for the credential assertion operation.\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the asserted credential.\n   */\n  assertCredential: (\n    params: AssertCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<AssertCredentialResult>;\n}\n\n/**\n * Parameters for creating a new credential.\n */\nexport interface CreateCredentialParams {\n  /** The Relaying Parties origin, see: https://html.spec.whatwg.org/multipage/browsers.html#concept-origin */\n  origin: string;\n  /**\n   * A value which is true if and only if the caller’s environment settings object is same-origin with its ancestors.\n   * It is false if caller is cross-origin.\n   * */\n  sameOriginWithAncestors: boolean;\n  /** The Relying Party's preference for attestation conveyance */\n  attestation?: \"direct\" | \"enterprise\" | \"indirect\" | \"none\";\n  /** The Relying Party's requirements of the authenticator used in the creation of the credential. */\n  authenticatorSelection?: {\n    // authenticatorAttachment?: AuthenticatorAttachment; // not used\n    requireResidentKey?: boolean;\n    residentKey?: \"discouraged\" | \"preferred\" | \"required\";\n    userVerification?: UserVerification;\n  };\n  /** Challenge intended to be used for generating the newly created credential's attestation object. */\n  challenge: string; // b64 encoded\n  /**\n   * This member is intended for use by Relying Parties that wish to limit the creation of multiple credentials for\n   * the same account on a single authenticator. The client is requested to return an error if the new credential would\n   * be created on an authenticator that also contains one of the credentials enumerated in this parameter.\n   * */\n  excludeCredentials?: {\n    id: string; // b64 encoded\n    transports?: (\"ble\" | \"hybrid\" | \"internal\" | \"nfc\" | \"usb\")[];\n    type: \"public-key\";\n  }[];\n  /**\n   * This member contains additional parameters requesting additional processing by the client and authenticator.\n   **/\n  extensions?: {\n    appid?: string; // Not supported\n    appidExclude?: string; // Not supported\n    uvm?: boolean; // Not supported\n    credProps?: boolean;\n  };\n  /**\n   * This member contains information about the desired properties of the credential to be created.\n   * The sequence is ordered from most preferred to least preferred.\n   * The client makes a best-effort to create the most preferred credential that it can.\n   */\n  pubKeyCredParams: PublicKeyCredentialParam[];\n  /** Data about the Relying Party responsible for the request. */\n  rp: {\n    id?: string;\n    name: string;\n  };\n  /** Data about the user account for which the Relying Party is requesting attestation. */\n  user: {\n    id: string; // b64 encoded\n    displayName: string;\n    name: string;\n  };\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n  /**\n   * This member specifies a time, in milliseconds, that the caller is willing to wait for the call to complete.\n   * This is treated as a hint, and MAY be overridden by the client.\n   **/\n  timeout?: number;\n}\n\n/**\n * The result of creating a new credential.\n */\nexport interface CreateCredentialResult {\n  credentialId: string;\n  clientDataJSON: string;\n  attestationObject: string;\n  authData: string;\n  publicKey: string;\n  publicKeyAlgorithm: number;\n  transports: string[];\n  extensions: {\n    credProps?: {\n      rk: boolean;\n    };\n  };\n}\n\n/**\n * Parameters for asserting a credential.\n */\nexport interface AssertCredentialParams {\n  allowedCredentialIds: string[];\n  rpId: string;\n  origin: string;\n  challenge: string;\n  userVerification?: UserVerification;\n  timeout: number;\n  sameOriginWithAncestors: boolean;\n  fallbackSupported: boolean;\n}\n\n/**\n * The result of asserting a credential.\n */\nexport interface AssertCredentialResult {\n  credentialId: string;\n  clientDataJSON: string;\n  authenticatorData: string;\n  signature: string;\n  userHandle: string;\n}\n\n/**\n * A description of a key type and algorithm.\n *\n * @example {\n *   alg: -7, // ES256\n *   type: \"public-key\"\n * }\n */\nexport interface PublicKeyCredentialParam {\n  alg: number;\n  type: \"public-key\";\n}\n\n/**\n * Error thrown when the user requests a fallback to the browser's built-in WebAuthn implementation.\n */\nexport class FallbackRequestedError extends Error {\n  readonly fallbackRequested = true;\n  constructor() {\n    super(\"FallbackRequested\");\n  }\n}\n","import { parse } from \"tldts\";\n\nexport function isValidRpId(rpId: string, origin: string) {\n  const parsedOrigin = parse(origin, { allowPrivateDomains: true });\n  const parsedRpId = parse(rpId, { allowPrivateDomains: true });\n\n  return (\n    (parsedOrigin.domain == null &&\n      parsedOrigin.hostname == parsedRpId.hostname &&\n      parsedOrigin.hostname == \"localhost\") ||\n    (parsedOrigin.domain != null &&\n      parsedOrigin.domain == parsedRpId.domain &&\n      parsedOrigin.subdomain.endsWith(parsedRpId.subdomain))\n  );\n}\n","import { firstValueFrom } from \"rxjs\";\nimport { parse } from \"tldts\";\n\nimport { AuthService } from \"../../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../../auth/enums/authentication-status\";\nimport { DomainSettingsService } from \"../../../autofill/services/domain-settings.service\";\nimport { VaultSettingsService } from \"../../../vault/abstractions/vault-settings/vault-settings.service\";\nimport { ConfigService } from \"../../abstractions/config/config.service\";\nimport {\n  Fido2AuthenticatorError,\n  Fido2AuthenticatorErrorCode,\n  Fido2AuthenticatorGetAssertionParams,\n  Fido2AuthenticatorMakeCredentialsParams,\n  Fido2AuthenticatorService,\n  PublicKeyCredentialDescriptor,\n} from \"../../abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport {\n  AssertCredentialParams,\n  AssertCredentialResult,\n  CreateCredentialParams,\n  CreateCredentialResult,\n  FallbackRequestedError,\n  Fido2ClientService as Fido2ClientServiceAbstraction,\n  PublicKeyCredentialParam,\n  UserRequestedFallbackAbortReason,\n  UserVerification,\n} from \"../../abstractions/fido2/fido2-client.service.abstraction\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { Utils } from \"../../misc/utils\";\n\nimport { isValidRpId } from \"./domain-utils\";\nimport { Fido2Utils } from \"./fido2-utils\";\n\n/**\n * Bitwarden implementation of the Web Authentication API as described by W3C\n * https://www.w3.org/TR/webauthn-3/#sctn-api\n *\n * It is highly recommended that the W3C specification is used a reference when reading this code.\n */\nexport class Fido2ClientService implements Fido2ClientServiceAbstraction {\n  constructor(\n    private authenticator: Fido2AuthenticatorService,\n    private configService: ConfigService,\n    private authService: AuthService,\n    private vaultSettingsService: VaultSettingsService,\n    private domainSettingsService: DomainSettingsService,\n    private logService?: LogService,\n  ) {}\n\n  async isFido2FeatureEnabled(hostname: string, origin: string): Promise<boolean> {\n    const isUserLoggedIn =\n      (await this.authService.getAuthStatus()) !== AuthenticationStatus.LoggedOut;\n    if (!isUserLoggedIn) {\n      return false;\n    }\n\n    const neverDomains = await firstValueFrom(this.domainSettingsService.neverDomains$);\n\n    const isExcludedDomain = neverDomains != null && hostname in neverDomains;\n    if (isExcludedDomain) {\n      return false;\n    }\n\n    const serverConfig = await firstValueFrom(this.configService.serverConfig$);\n    const isOriginEqualBitwardenVault = origin === serverConfig.environment?.vault;\n    if (isOriginEqualBitwardenVault) {\n      return false;\n    }\n\n    return await firstValueFrom(this.vaultSettingsService.enablePasskeys$);\n  }\n\n  async createCredential(\n    params: CreateCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController = new AbortController(),\n  ): Promise<CreateCredentialResult> {\n    const parsedOrigin = parse(params.origin, { allowPrivateDomains: true });\n\n    const enableFido2VaultCredentials = await this.isFido2FeatureEnabled(\n      parsedOrigin.hostname,\n      params.origin,\n    );\n\n    if (!enableFido2VaultCredentials) {\n      this.logService?.warning(`[Fido2Client] Fido2VaultCredential is not enabled`);\n      throw new FallbackRequestedError();\n    }\n\n    if (!params.sameOriginWithAncestors) {\n      this.logService?.warning(\n        `[Fido2Client] Invalid 'sameOriginWithAncestors' value: ${params.sameOriginWithAncestors}`,\n      );\n      throw new DOMException(\"Invalid 'sameOriginWithAncestors' value\", \"NotAllowedError\");\n    }\n\n    const userId = Fido2Utils.stringToBuffer(params.user.id);\n    if (userId.length < 1 || userId.length > 64) {\n      this.logService?.warning(\n        `[Fido2Client] Invalid 'user.id' length: ${params.user.id} (${userId.length})`,\n      );\n      throw new TypeError(\"Invalid 'user.id' length\");\n    }\n\n    params.rp.id = params.rp.id ?? parsedOrigin.hostname;\n    if (parsedOrigin.hostname == undefined || !params.origin.startsWith(\"https://\")) {\n      this.logService?.warning(`[Fido2Client] Invalid https origin: ${params.origin}`);\n      throw new DOMException(\"'origin' is not a valid https origin\", \"SecurityError\");\n    }\n\n    if (!isValidRpId(params.rp.id, params.origin)) {\n      this.logService?.warning(\n        `[Fido2Client] 'rp.id' cannot be used with the current origin: rp.id = ${params.rp.id}; origin = ${params.origin}`,\n      );\n      throw new DOMException(\"'rp.id' cannot be used with the current origin\", \"SecurityError\");\n    }\n\n    let credTypesAndPubKeyAlgs: PublicKeyCredentialParam[];\n    if (params.pubKeyCredParams?.length > 0) {\n      // Filter out all unsupported algorithms\n      credTypesAndPubKeyAlgs = params.pubKeyCredParams.filter(\n        (kp) => kp.alg === -7 && kp.type === \"public-key\",\n      );\n    } else {\n      // Assign default algorithms\n      credTypesAndPubKeyAlgs = [\n        { alg: -7, type: \"public-key\" },\n        { alg: -257, type: \"public-key\" },\n      ];\n    }\n\n    if (credTypesAndPubKeyAlgs.length === 0) {\n      const requestedAlgorithms = credTypesAndPubKeyAlgs.map((p) => p.alg).join(\", \");\n      this.logService?.warning(\n        `[Fido2Client] No compatible algorithms found, RP requested: ${requestedAlgorithms}`,\n      );\n      throw new DOMException(\"No supported key algorithms were found\", \"NotSupportedError\");\n    }\n\n    const collectedClientData = {\n      type: \"webauthn.create\",\n      challenge: params.challenge,\n      origin: params.origin,\n      crossOrigin: !params.sameOriginWithAncestors,\n      // tokenBinding: {} // Not currently supported\n    };\n    const clientDataJSON = JSON.stringify(collectedClientData);\n    const clientDataJSONBytes = Utils.fromByteStringToArray(clientDataJSON);\n    const clientDataHash = await crypto.subtle.digest({ name: \"SHA-256\" }, clientDataJSONBytes);\n    const makeCredentialParams = mapToMakeCredentialParams({\n      params,\n      credTypesAndPubKeyAlgs,\n      clientDataHash,\n    });\n\n    // Set timeout before invoking authenticator\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n    const timeout = setAbortTimeout(\n      abortController,\n      params.authenticatorSelection?.userVerification,\n      params.timeout,\n    );\n\n    let makeCredentialResult;\n    try {\n      makeCredentialResult = await this.authenticator.makeCredential(\n        makeCredentialParams,\n        tab,\n        abortController,\n      );\n    } catch (error) {\n      if (\n        abortController.signal.aborted &&\n        abortController.signal.reason === UserRequestedFallbackAbortReason\n      ) {\n        this.logService?.info(`[Fido2Client] Aborting because user requested fallback`);\n        throw new FallbackRequestedError();\n      }\n\n      if (\n        error instanceof Fido2AuthenticatorError &&\n        error.errorCode === Fido2AuthenticatorErrorCode.InvalidState\n      ) {\n        this.logService?.warning(`[Fido2Client] Unknown error: ${error}`);\n        throw new DOMException(\"Unknown error occured.\", \"InvalidStateError\");\n      }\n\n      this.logService?.info(`[Fido2Client] Aborted by user: ${error}`);\n      throw new DOMException(\n        \"The operation either timed out or was not allowed.\",\n        \"NotAllowedError\",\n      );\n    }\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n\n    let credProps;\n    if (params.extensions?.credProps) {\n      credProps = {\n        rk: makeCredentialParams.requireResidentKey,\n      };\n    }\n\n    clearTimeout(timeout);\n    return {\n      credentialId: Fido2Utils.bufferToString(makeCredentialResult.credentialId),\n      attestationObject: Fido2Utils.bufferToString(makeCredentialResult.attestationObject),\n      authData: Fido2Utils.bufferToString(makeCredentialResult.authData),\n      clientDataJSON: Fido2Utils.bufferToString(clientDataJSONBytes),\n      publicKey: Fido2Utils.bufferToString(makeCredentialResult.publicKey),\n      publicKeyAlgorithm: makeCredentialResult.publicKeyAlgorithm,\n      transports: params.rp.id === \"google.com\" ? [\"internal\", \"usb\"] : [\"internal\"],\n      extensions: { credProps },\n    };\n  }\n\n  async assertCredential(\n    params: AssertCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController = new AbortController(),\n  ): Promise<AssertCredentialResult> {\n    const parsedOrigin = parse(params.origin, { allowPrivateDomains: true });\n    const enableFido2VaultCredentials = await this.isFido2FeatureEnabled(\n      parsedOrigin.hostname,\n      params.origin,\n    );\n\n    if (!enableFido2VaultCredentials) {\n      this.logService?.warning(`[Fido2Client] Fido2VaultCredential is not enabled`);\n      throw new FallbackRequestedError();\n    }\n\n    params.rpId = params.rpId ?? parsedOrigin.hostname;\n\n    if (parsedOrigin.hostname == undefined || !params.origin.startsWith(\"https://\")) {\n      this.logService?.warning(`[Fido2Client] Invalid https origin: ${params.origin}`);\n      throw new DOMException(\"'origin' is not a valid https origin\", \"SecurityError\");\n    }\n\n    if (!isValidRpId(params.rpId, params.origin)) {\n      this.logService?.warning(\n        `[Fido2Client] 'rp.id' cannot be used with the current origin: rp.id = ${params.rpId}; origin = ${params.origin}`,\n      );\n      throw new DOMException(\"'rp.id' cannot be used with the current origin\", \"SecurityError\");\n    }\n\n    const collectedClientData = {\n      type: \"webauthn.get\",\n      challenge: params.challenge,\n      origin: params.origin,\n      crossOrigin: !params.sameOriginWithAncestors,\n      // tokenBinding: {} // Not currently supported\n    };\n    const clientDataJSON = JSON.stringify(collectedClientData);\n    const clientDataJSONBytes = Utils.fromByteStringToArray(clientDataJSON);\n    const clientDataHash = await crypto.subtle.digest({ name: \"SHA-256\" }, clientDataJSONBytes);\n    const getAssertionParams = mapToGetAssertionParams({ params, clientDataHash });\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n\n    const timeout = setAbortTimeout(abortController, params.userVerification, params.timeout);\n\n    let getAssertionResult;\n    try {\n      getAssertionResult = await this.authenticator.getAssertion(\n        getAssertionParams,\n        tab,\n        abortController,\n      );\n    } catch (error) {\n      if (\n        abortController.signal.aborted &&\n        abortController.signal.reason === UserRequestedFallbackAbortReason\n      ) {\n        this.logService?.info(`[Fido2Client] Aborting because user requested fallback`);\n        throw new FallbackRequestedError();\n      }\n\n      if (\n        error instanceof Fido2AuthenticatorError &&\n        error.errorCode === Fido2AuthenticatorErrorCode.InvalidState\n      ) {\n        this.logService?.warning(`[Fido2Client] Unknown error: ${error}`);\n        throw new DOMException(\"Unknown error occured.\", \"InvalidStateError\");\n      }\n\n      this.logService?.info(`[Fido2Client] Aborted by user: ${error}`);\n      throw new DOMException(\n        \"The operation either timed out or was not allowed.\",\n        \"NotAllowedError\",\n      );\n    }\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n    clearTimeout(timeout);\n\n    return {\n      authenticatorData: Fido2Utils.bufferToString(getAssertionResult.authenticatorData),\n      clientDataJSON: Fido2Utils.bufferToString(clientDataJSONBytes),\n      credentialId: Fido2Utils.bufferToString(getAssertionResult.selectedCredential.id),\n      userHandle:\n        getAssertionResult.selectedCredential.userHandle !== undefined\n          ? Fido2Utils.bufferToString(getAssertionResult.selectedCredential.userHandle)\n          : undefined,\n      signature: Fido2Utils.bufferToString(getAssertionResult.signature),\n    };\n  }\n}\n\nconst TIMEOUTS = {\n  NO_VERIFICATION: {\n    DEFAULT: 120000,\n    MIN: 30000,\n    MAX: 180000,\n  },\n  WITH_VERIFICATION: {\n    DEFAULT: 300000,\n    MIN: 30000,\n    MAX: 600000,\n  },\n};\n\nfunction setAbortTimeout(\n  abortController: AbortController,\n  userVerification?: UserVerification,\n  timeout?: number,\n): number {\n  let clampedTimeout: number;\n\n  if (userVerification === \"required\") {\n    timeout = timeout ?? TIMEOUTS.WITH_VERIFICATION.DEFAULT;\n    clampedTimeout = Math.max(\n      TIMEOUTS.WITH_VERIFICATION.MIN,\n      Math.min(timeout, TIMEOUTS.WITH_VERIFICATION.MAX),\n    );\n  } else {\n    timeout = timeout ?? TIMEOUTS.NO_VERIFICATION.DEFAULT;\n    clampedTimeout = Math.max(\n      TIMEOUTS.NO_VERIFICATION.MIN,\n      Math.min(timeout, TIMEOUTS.NO_VERIFICATION.MAX),\n    );\n  }\n\n  return self.setTimeout(() => abortController.abort(), clampedTimeout);\n}\n\n/**\n * Convert data gathered by the WebAuthn Client to a format that can be used by the authenticator.\n */\nfunction mapToMakeCredentialParams({\n  params,\n  credTypesAndPubKeyAlgs,\n  clientDataHash,\n}: {\n  params: CreateCredentialParams;\n  credTypesAndPubKeyAlgs: PublicKeyCredentialParam[];\n  clientDataHash: ArrayBuffer;\n}): Fido2AuthenticatorMakeCredentialsParams {\n  const excludeCredentialDescriptorList: PublicKeyCredentialDescriptor[] =\n    params.excludeCredentials?.map((credential) => ({\n      id: Fido2Utils.stringToBuffer(credential.id),\n      transports: credential.transports,\n      type: credential.type,\n    })) ?? [];\n\n  const requireResidentKey =\n    params.authenticatorSelection?.residentKey === \"required\" ||\n    params.authenticatorSelection?.residentKey === \"preferred\" ||\n    (params.authenticatorSelection?.residentKey === undefined &&\n      params.authenticatorSelection?.requireResidentKey === true);\n\n  const requireUserVerification =\n    params.authenticatorSelection?.userVerification === \"required\" ||\n    params.authenticatorSelection?.userVerification === \"preferred\" ||\n    params.authenticatorSelection?.userVerification === undefined;\n\n  return {\n    requireResidentKey,\n    requireUserVerification,\n    enterpriseAttestationPossible: params.attestation === \"enterprise\",\n    excludeCredentialDescriptorList,\n    credTypesAndPubKeyAlgs,\n    hash: clientDataHash,\n    rpEntity: {\n      id: params.rp.id,\n      name: params.rp.name,\n    },\n    userEntity: {\n      id: Fido2Utils.stringToBuffer(params.user.id),\n      displayName: params.user.displayName,\n      name: params.user.name,\n    },\n    fallbackSupported: params.fallbackSupported,\n  };\n}\n\n/**\n * Convert data gathered by the WebAuthn Client to a format that can be used by the authenticator.\n */\nfunction mapToGetAssertionParams({\n  params,\n  clientDataHash,\n}: {\n  params: AssertCredentialParams;\n  clientDataHash: ArrayBuffer;\n}): Fido2AuthenticatorGetAssertionParams {\n  const allowCredentialDescriptorList: PublicKeyCredentialDescriptor[] =\n    params.allowedCredentialIds.map((id) => ({\n      id: Fido2Utils.stringToBuffer(id),\n      type: \"public-key\",\n    }));\n\n  const requireUserVerification =\n    params.userVerification === \"required\" ||\n    params.userVerification === \"preferred\" ||\n    params.userVerification === undefined;\n\n  return {\n    rpId: params.rpId,\n    requireUserVerification,\n    hash: clientDataHash,\n    allowCredentialDescriptorList,\n    extensions: {},\n    fallbackSupported: params.fallbackSupported,\n  };\n}\n","import { LogService } from \"../../abstractions/log.service\";\nimport { Utils } from \"../../misc/utils\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\n\nconst MAX_SINGLE_BLOB_UPLOAD_SIZE = 256 * 1024 * 1024; // 256 MiB\nconst MAX_BLOCKS_PER_BLOB = 50000;\n\nexport class AzureFileUploadService {\n  constructor(private logService: LogService) {}\n\n  async upload(url: string, data: EncArrayBuffer, renewalCallback: () => Promise<string>) {\n    if (data.buffer.byteLength <= MAX_SINGLE_BLOB_UPLOAD_SIZE) {\n      return await this.azureUploadBlob(url, data);\n    } else {\n      return await this.azureUploadBlocks(url, data, renewalCallback);\n    }\n  }\n  private async azureUploadBlob(url: string, data: EncArrayBuffer) {\n    const urlObject = Utils.getUrl(url);\n    const headers = new Headers({\n      \"x-ms-date\": new Date().toUTCString(),\n      \"x-ms-version\": urlObject.searchParams.get(\"sv\"),\n      \"Content-Length\": data.buffer.byteLength.toString(),\n      \"x-ms-blob-type\": \"BlockBlob\",\n    });\n\n    const request = new Request(url, {\n      body: data.buffer,\n      cache: \"no-store\",\n      method: \"PUT\",\n      headers: headers,\n    });\n\n    const blobResponse = await fetch(request);\n\n    if (blobResponse.status !== 201) {\n      throw new Error(`Failed to create Azure blob: ${blobResponse.status}`);\n    }\n  }\n  private async azureUploadBlocks(\n    url: string,\n    data: EncArrayBuffer,\n    renewalCallback: () => Promise<string>,\n  ) {\n    const baseUrl = Utils.getUrl(url);\n    const blockSize = this.getMaxBlockSize(baseUrl.searchParams.get(\"sv\"));\n    let blockIndex = 0;\n    const numBlocks = Math.ceil(data.buffer.byteLength / blockSize);\n    const blocksStaged: string[] = [];\n\n    if (numBlocks > MAX_BLOCKS_PER_BLOB) {\n      throw new Error(\n        `Cannot upload file, exceeds maximum size of ${blockSize * MAX_BLOCKS_PER_BLOB}`,\n      );\n    }\n\n    // eslint-disable-next-line\n    try {\n      while (blockIndex < numBlocks) {\n        url = await this.renewUrlIfNecessary(url, renewalCallback);\n        const blockUrl = Utils.getUrl(url);\n        const blockId = this.encodedBlockId(blockIndex);\n        blockUrl.searchParams.append(\"comp\", \"block\");\n        blockUrl.searchParams.append(\"blockid\", blockId);\n        const start = blockIndex * blockSize;\n        const blockData = data.buffer.slice(start, start + blockSize);\n        const blockHeaders = new Headers({\n          \"x-ms-date\": new Date().toUTCString(),\n          \"x-ms-version\": blockUrl.searchParams.get(\"sv\"),\n          \"Content-Length\": blockData.byteLength.toString(),\n        });\n\n        const blockRequest = new Request(blockUrl.toString(), {\n          body: blockData,\n          cache: \"no-store\",\n          method: \"PUT\",\n          headers: blockHeaders,\n        });\n\n        const blockResponse = await fetch(blockRequest);\n\n        if (blockResponse.status !== 201) {\n          const message = `Unsuccessful block PUT. Received status ${blockResponse.status}`;\n          this.logService.error(message + \"\\n\" + (await blockResponse.json()));\n          throw new Error(message);\n        }\n\n        blocksStaged.push(blockId);\n        blockIndex++;\n      }\n\n      url = await this.renewUrlIfNecessary(url, renewalCallback);\n      const blockListUrl = Utils.getUrl(url);\n      const blockListXml = this.blockListXml(blocksStaged);\n      blockListUrl.searchParams.append(\"comp\", \"blocklist\");\n      const headers = new Headers({\n        \"x-ms-date\": new Date().toUTCString(),\n        \"x-ms-version\": blockListUrl.searchParams.get(\"sv\"),\n        \"Content-Length\": blockListXml.length.toString(),\n      });\n\n      const request = new Request(blockListUrl.toString(), {\n        body: blockListXml,\n        cache: \"no-store\",\n        method: \"PUT\",\n        headers: headers,\n      });\n\n      const response = await fetch(request);\n\n      if (response.status !== 201) {\n        const message = `Unsuccessful block list PUT. Received status ${response.status}`;\n        this.logService.error(message + \"\\n\" + (await response.json()));\n        throw new Error(message);\n      }\n    } catch (e) {\n      throw e;\n    }\n  }\n\n  private async renewUrlIfNecessary(\n    url: string,\n    renewalCallback: () => Promise<string>,\n  ): Promise<string> {\n    const urlObject = Utils.getUrl(url);\n    const expiry = new Date(urlObject.searchParams.get(\"se\") ?? \"\");\n\n    if (isNaN(expiry.getTime())) {\n      expiry.setTime(Date.now() + 3600000);\n    }\n\n    if (expiry.getTime() < Date.now() + 1000) {\n      return await renewalCallback();\n    }\n    return url;\n  }\n\n  private encodedBlockId(blockIndex: number) {\n    // Encoded blockId max size is 64, so pre-encoding max size is 48\n    const utfBlockId = (\n      \"000000000000000000000000000000000000000000000000\" + blockIndex.toString()\n    ).slice(-48);\n    return Utils.fromUtf8ToB64(utfBlockId);\n  }\n\n  private blockListXml(blockIdList: string[]) {\n    let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><BlockList>';\n    blockIdList.forEach((blockId) => {\n      xml += `<Latest>${blockId}</Latest>`;\n    });\n    xml += \"</BlockList>\";\n    return xml;\n  }\n\n  private getMaxBlockSize(version: string) {\n    if (Version.compare(version, \"2019-12-12\") >= 0) {\n      return 4000 * 1024 * 1024; // 4000 MiB\n    } else if (Version.compare(version, \"2016-05-31\") >= 0) {\n      return 100 * 1024 * 1024; // 100 MiB\n    } else {\n      return 4 * 1024 * 1024; // 4 MiB\n    }\n  }\n}\n\nclass Version {\n  /**\n   * Compares two Azure Versions against each other\n   * @param a Version to compare\n   * @param b Version to compare\n   * @returns a number less than zero if b is newer than a, 0 if equal,\n   * and greater than zero if a is newer than b\n   */\n  static compare(a: Required<Version> | string, b: Required<Version> | string) {\n    if (typeof a === \"string\") {\n      a = new Version(a);\n    }\n\n    if (typeof b === \"string\") {\n      b = new Version(b);\n    }\n\n    return a.year !== b.year\n      ? a.year - b.year\n      : a.month !== b.month\n        ? a.month - b.month\n        : a.day !== b.day\n          ? a.day - b.day\n          : 0;\n  }\n  year = 0;\n  month = 0;\n  day = 0;\n\n  constructor(version: string) {\n    try {\n      const parts = version.split(\"-\").map((v) => Number.parseInt(v, 10));\n      this.year = parts[0];\n      this.month = parts[1];\n      this.day = parts[2];\n    } catch {\n      // Ignore error\n    }\n  }\n  /**\n   * Compares two Azure Versions against each other\n   * @param compareTo Version to compare against\n   * @returns a number less than zero if compareTo is newer, 0 if equal,\n   * and greater than zero if this is greater than compareTo\n   */\n  compare(compareTo: Required<Version> | string) {\n    return Version.compare(this, compareTo);\n  }\n}\n","import { Utils } from \"../../misc/utils\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\n\nexport class BitwardenFileUploadService {\n  async upload(\n    encryptedFileName: string,\n    encryptedFileData: EncArrayBuffer,\n    apiCall: (fd: FormData) => Promise<any>,\n  ) {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encryptedFileData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"data\", blob, encryptedFileName);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\n          \"data\",\n          Buffer.from(encryptedFileData.buffer) as any,\n          {\n            filepath: encryptedFileName,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    await apiCall(fd);\n  }\n}\n","import {\n  FileUploadApiMethods,\n  FileUploadService as FileUploadServiceAbstraction,\n} from \"../../abstractions/file-upload/file-upload.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { FileUploadType } from \"../../enums\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\nimport { EncString } from \"../../models/domain/enc-string\";\n\nimport { AzureFileUploadService } from \"./azure-file-upload.service\";\nimport { BitwardenFileUploadService } from \"./bitwarden-file-upload.service\";\n\nexport class FileUploadService implements FileUploadServiceAbstraction {\n  private azureFileUploadService: AzureFileUploadService;\n  private bitwardenFileUploadService: BitwardenFileUploadService;\n\n  constructor(protected logService: LogService) {\n    this.azureFileUploadService = new AzureFileUploadService(logService);\n    this.bitwardenFileUploadService = new BitwardenFileUploadService();\n  }\n\n  async upload(\n    uploadData: { url: string; fileUploadType: FileUploadType },\n    fileName: EncString,\n    encryptedFileData: EncArrayBuffer,\n    fileUploadMethods: FileUploadApiMethods,\n  ) {\n    try {\n      switch (uploadData.fileUploadType) {\n        case FileUploadType.Direct:\n          await this.bitwardenFileUploadService.upload(\n            fileName.encryptedString,\n            encryptedFileData,\n            (fd) => fileUploadMethods.postDirect(fd),\n          );\n          break;\n        case FileUploadType.Azure: {\n          await this.azureFileUploadService.upload(\n            uploadData.url,\n            encryptedFileData,\n            fileUploadMethods.renewFileUploadUrl,\n          );\n          break;\n        }\n        default:\n          throw new Error(\"Unknown file upload type\");\n      }\n    } catch (e) {\n      await fileUploadMethods.rollback();\n      throw e;\n    }\n  }\n}\n","import { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport { KeyGenerationService as KeyGenerationServiceAbstraction } from \"../abstractions/key-generation.service\";\nimport {\n  ARGON2_ITERATIONS,\n  ARGON2_MEMORY,\n  ARGON2_PARALLELISM,\n  KdfType,\n  PBKDF2_ITERATIONS,\n} from \"../enums\";\nimport { Utils } from \"../misc/utils\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\nexport class KeyGenerationService implements KeyGenerationServiceAbstraction {\n  constructor(private cryptoFunctionService: CryptoFunctionService) {}\n\n  async createKey(bitLength: 256 | 512): Promise<SymmetricCryptoKey> {\n    const key = await this.cryptoFunctionService.aesGenerateKey(bitLength);\n    return new SymmetricCryptoKey(key);\n  }\n\n  async createKeyWithPurpose(\n    bitLength: 128 | 192 | 256 | 512,\n    purpose: string,\n    salt?: string,\n  ): Promise<{ salt: string; material: CsprngArray; derivedKey: SymmetricCryptoKey }> {\n    if (salt == null) {\n      const bytes = await this.cryptoFunctionService.randomBytes(32);\n      salt = Utils.fromBufferToUtf8(bytes);\n    }\n    const material = await this.cryptoFunctionService.aesGenerateKey(bitLength);\n    const key = await this.cryptoFunctionService.hkdf(material, salt, purpose, 64, \"sha256\");\n    return { salt, material, derivedKey: new SymmetricCryptoKey(key) };\n  }\n\n  async deriveKeyFromMaterial(\n    material: CsprngArray,\n    salt: string,\n    purpose: string,\n  ): Promise<SymmetricCryptoKey> {\n    const key = await this.cryptoFunctionService.hkdf(material, salt, purpose, 64, \"sha256\");\n    return new SymmetricCryptoKey(key);\n  }\n\n  async deriveKeyFromPassword(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    kdfConfig: KdfConfig,\n  ): Promise<SymmetricCryptoKey> {\n    let key: Uint8Array = null;\n    if (kdfConfig.kdfType == null || kdfConfig.kdfType === KdfType.PBKDF2_SHA256) {\n      if (kdfConfig.iterations == null) {\n        kdfConfig.iterations = PBKDF2_ITERATIONS.defaultValue;\n      }\n\n      key = await this.cryptoFunctionService.pbkdf2(password, salt, \"sha256\", kdfConfig.iterations);\n    } else if (kdfConfig.kdfType == KdfType.Argon2id) {\n      if (kdfConfig.iterations == null) {\n        kdfConfig.iterations = ARGON2_ITERATIONS.defaultValue;\n      }\n\n      if (kdfConfig.memory == null) {\n        kdfConfig.memory = ARGON2_MEMORY.defaultValue;\n      }\n\n      if (kdfConfig.parallelism == null) {\n        kdfConfig.parallelism = ARGON2_PARALLELISM.defaultValue;\n      }\n\n      const saltHash = await this.cryptoFunctionService.hash(salt, \"sha256\");\n      key = await this.cryptoFunctionService.argon2(\n        password,\n        saltHash,\n        kdfConfig.iterations,\n        kdfConfig.memory * 1024, // convert to KiB from MiB\n        kdfConfig.parallelism,\n      );\n    } else {\n      throw new Error(\"Unknown Kdf.\");\n    }\n    return new SymmetricCryptoKey(key);\n  }\n\n  async stretchKey(key: SymmetricCryptoKey): Promise<SymmetricCryptoKey> {\n    const newKey = new Uint8Array(64);\n    const encKey = await this.cryptoFunctionService.hkdfExpand(key.key, \"enc\", 32, \"sha256\");\n    const macKey = await this.cryptoFunctionService.hkdfExpand(key.key, \"mac\", 32, \"sha256\");\n\n    newKey.set(new Uint8Array(encKey));\n    newKey.set(new Uint8Array(macKey), 32);\n\n    return new SymmetricCryptoKey(newKey);\n  }\n}\n","import { MigrationHelper } from \"./migration-helper\";\nimport { Direction, Migrator, VersionFrom, VersionTo } from \"./migrator\";\n\nexport class MigrationBuilder<TCurrent extends number = 0> {\n  /** Create a new MigrationBuilder with an empty buffer of migrations to perform.\n   *\n   * Add migrations to the buffer with {@link with} and {@link rollback}.\n   * @returns A new MigrationBuilder.\n   */\n  static create(): MigrationBuilder<0> {\n    return new MigrationBuilder([]);\n  }\n\n  private constructor(\n    private migrations: readonly { migrator: Migrator<number, number>; direction: Direction }[],\n  ) {}\n\n  /** Add a migrator to the MigrationBuilder. Types are updated such that the chained MigrationBuilder must currently be\n   * at state version equal to the from version of the migrator. Return as MigrationBuilder<TTo> where TTo is the to\n   * version of the migrator, so that the next migrator can be chained.\n   *\n   * @param migrate A migrator class or a tuple of a migrator class, the from version, and the to version. A tuple is\n   * required to instantiate version numbers unless a default constructor is defined.\n   * @returns A new MigrationBuilder with the to version of the migrator as the current version.\n   */\n  with<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator> & TCurrent,\n    TTo extends VersionTo<TMigrator>,\n  >(\n    ...migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TFrom, TTo]\n  ): MigrationBuilder<TTo> {\n    return this.addMigrator(migrate, \"up\");\n  }\n\n  /** Add a migrator to rollback on the MigrationBuilder's list of migrations. As with {@link with}, types of\n   * MigrationBuilder and Migrator must align. However, this time the migration is reversed so TCurrent of the\n   * MigrationBuilder must be equal to the to version of the migrator. Return as MigrationBuilder<TFrom> where TFrom\n   * is the from version of the migrator, so that the next migrator can be chained.\n   *\n   * @param migrate A migrator class or a tuple of a migrator class, the from version, and the to version. A tuple is\n   * required to instantiate version numbers unless a default constructor is defined.\n   * @returns A new MigrationBuilder with the from version of the migrator as the current version.\n   */\n  rollback<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator>,\n    TTo extends VersionTo<TMigrator> & TCurrent,\n  >(\n    ...migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TTo, TFrom]\n  ): MigrationBuilder<TFrom> {\n    if (migrate.length === 3) {\n      migrate = [migrate[0], migrate[2], migrate[1]];\n    }\n    return this.addMigrator(migrate, \"down\");\n  }\n\n  /** Execute the migrations as defined in the MigrationBuilder's migrator buffer */\n  migrate(helper: MigrationHelper): Promise<void> {\n    return this.migrations.reduce(\n      (promise, migrator) =>\n        promise.then(async () => {\n          await this.runMigrator(migrator.migrator, helper, migrator.direction);\n        }),\n      Promise.resolve(),\n    );\n  }\n\n  private addMigrator<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator> & TCurrent,\n    TTo extends VersionTo<TMigrator>,\n  >(\n    migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TFrom, TTo],\n    direction: Direction = \"up\",\n  ) {\n    const newMigration =\n      migrate.length === 1\n        ? { migrator: new migrate[0](), direction }\n        : { migrator: new migrate[0](migrate[1], migrate[2]), direction };\n\n    return new MigrationBuilder<TTo>([...this.migrations, newMigration]);\n  }\n\n  private async runMigrator(\n    migrator: Migrator<number, number>,\n    helper: MigrationHelper,\n    direction: Direction,\n  ): Promise<void> {\n    const shouldMigrate = await migrator.shouldMigrate(helper, direction);\n    helper.info(\n      `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) should migrate: ${shouldMigrate} - ${direction}`,\n    );\n    if (shouldMigrate) {\n      const method = direction === \"up\" ? migrator.migrate : migrator.rollback;\n      await method.bind(migrator)(helper);\n      helper.info(\n        `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) migrated - ${direction}`,\n      );\n      await migrator.updateVersion(helper, direction);\n      helper.info(\n        `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) updated version - ${direction}`,\n      );\n    }\n  }\n}\n","import { NonNegativeInteger } from \"type-fest\";\n\nimport { MigrationHelper } from \"./migration-helper\";\n\nexport const IRREVERSIBLE = new Error(\"Irreversible migration\");\n\nexport type VersionFrom<T> =\n  T extends Migrator<infer TFrom, number>\n    ? TFrom extends NonNegativeInteger<TFrom>\n      ? TFrom\n      : never\n    : never;\nexport type VersionTo<T> =\n  T extends Migrator<number, infer TTo>\n    ? TTo extends NonNegativeInteger<TTo>\n      ? TTo\n      : never\n    : never;\nexport type Direction = \"up\" | \"down\";\n\nexport abstract class Migrator<TFrom extends number, TTo extends number> {\n  constructor(\n    public fromVersion: TFrom,\n    public toVersion: TTo,\n  ) {\n    if (fromVersion == null || toVersion == null) {\n      throw new Error(\"Invalid migration\");\n    }\n    if (fromVersion > toVersion) {\n      throw new Error(\"Invalid migration\");\n    }\n  }\n\n  shouldMigrate(helper: MigrationHelper, direction: Direction): Promise<boolean> {\n    const startVersion = direction === \"up\" ? this.fromVersion : this.toVersion;\n    return Promise.resolve(helper.currentVersion === startVersion);\n  }\n  abstract migrate(helper: MigrationHelper): Promise<void>;\n  abstract rollback(helper: MigrationHelper): Promise<void>;\n  async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    await helper.set(\"stateVersion\", endVersion);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    everHadUserKey?: boolean;\n  };\n};\n\nconst USER_EVER_HAD_USER_KEY: KeyDefinitionLike = {\n  key: \"everHadUserKey\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class EverHadUserKeyMigrator extends Migrator<9, 10> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.everHadUserKey;\n      await helper.setToUser(userId, USER_EVER_HAD_USER_KEY, value ?? false);\n      if (value != null) {\n        delete account.profile.everHadUserKey;\n      }\n      await helper.set(userId, account);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_EVER_HAD_USER_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          everHadUserKey: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_EVER_HAD_USER_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype OrgKeyDataType = {\n  type: \"organization\" | \"provider\";\n  key: string;\n  providerId?: string;\n};\n\ntype ExpectedAccountType = {\n  keys?: {\n    organizationKeys?: {\n      encrypted?: Record<string, OrgKeyDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_ORGANIZATION_KEYS: KeyDefinitionLike = {\n  key: \"organizationKeys\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class OrganizationKeyMigrator extends Migrator<10, 11> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.organizationKeys?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS, value);\n        delete account.keys.organizationKeys;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, OrgKeyDataType>>(\n        userId,\n        USER_ENCRYPTED_ORGANIZATION_KEYS,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          organizationKeys: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype EnvironmentUrls = Record<string, string>;\n\ntype ExpectedAccountType = {\n  settings?: { region?: string; environmentUrls?: EnvironmentUrls };\n};\n\ntype ExpectedGlobalType = { region?: string; environmentUrls?: EnvironmentUrls };\n\nconst ENVIRONMENT_STATE: StateDefinitionLike = { name: \"environment\" };\n\nconst REGION_KEY: KeyDefinitionLike = { key: \"region\", stateDefinition: ENVIRONMENT_STATE };\nconst URLS_KEY: KeyDefinitionLike = { key: \"urls\", stateDefinition: ENVIRONMENT_STATE };\n\nexport class MoveEnvironmentStateToProviders extends Migrator<11, 12> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n\n    // Move global data\n    if (legacyGlobal?.region != null) {\n      await helper.setToGlobal(REGION_KEY, legacyGlobal.region);\n    }\n\n    if (legacyGlobal?.environmentUrls != null) {\n      await helper.setToGlobal(URLS_KEY, legacyGlobal.environmentUrls);\n    }\n\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.region != null) {\n          await helper.setToUser(userId, REGION_KEY, account.settings.region);\n        }\n\n        if (account?.settings?.environmentUrls != null) {\n          await helper.setToUser(userId, URLS_KEY, account.settings.environmentUrls);\n        }\n\n        // Delete old account data\n        delete account?.settings?.region;\n        delete account?.settings?.environmentUrls;\n        await helper.set(userId, account);\n      }),\n    );\n\n    // Delete legacy global data\n    delete legacyGlobal?.region;\n    delete legacyGlobal?.environmentUrls;\n    await helper.set(\"global\", legacyGlobal);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n\n    let updatedLegacyGlobal = false;\n\n    const globalRegion = await helper.getFromGlobal<string>(REGION_KEY);\n\n    if (globalRegion) {\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n\n      updatedLegacyGlobal = true;\n      legacyGlobal.region = globalRegion;\n      await helper.setToGlobal(REGION_KEY, null);\n    }\n\n    const globalUrls = await helper.getFromGlobal<EnvironmentUrls>(URLS_KEY);\n\n    if (globalUrls) {\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n\n      updatedLegacyGlobal = true;\n      legacyGlobal.environmentUrls = globalUrls;\n      await helper.setToGlobal(URLS_KEY, null);\n    }\n\n    if (updatedLegacyGlobal) {\n      await helper.set(\"global\", legacyGlobal);\n    }\n\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n      const userRegion = await helper.getFromUser<string>(userId, REGION_KEY);\n\n      if (userRegion) {\n        if (!account) {\n          account = {};\n        }\n\n        if (!account.settings) {\n          account.settings = {};\n        }\n\n        updatedAccount = true;\n        account.settings.region = userRegion;\n        await helper.setToUser(userId, REGION_KEY, null);\n      }\n\n      const userUrls = await helper.getFromUser<EnvironmentUrls>(userId, URLS_KEY);\n\n      if (userUrls) {\n        if (!account) {\n          account = {};\n        }\n\n        if (!account.settings) {\n          account.settings = {};\n        }\n\n        updatedAccount = true;\n        account.settings.environmentUrls = userUrls;\n        await helper.setToUser(userId, URLS_KEY, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  keys?: {\n    providerKeys?: {\n      encrypted?: Record<string, string>; // Record<ProviderId, EncryptedString> where EncryptedString is the ProviderKey encrypted by the UserKey.\n    };\n  };\n};\n\nconst USER_ENCRYPTED_PROVIDER_KEYS: KeyDefinitionLike = {\n  key: \"providerKeys\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class ProviderKeyMigrator extends Migrator<12, 13> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.providerKeys?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_PROVIDER_KEYS, value);\n        delete account.keys.providerKeys;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, string>>(\n        userId,\n        USER_ENCRYPTED_PROVIDER_KEYS,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          providerKeys: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_PROVIDER_KEYS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    disableAutoBiometricsPrompt?: boolean;\n    biometricUnlock?: boolean;\n    dismissedBiometricRequirePasswordOnStartCallout?: boolean;\n  };\n  keys?: { biometricEncryptionClientKeyHalf?: string };\n};\n\n// Biometric text, no auto prompt text, fingerprint validated, and prompt cancelled are refreshed on every app start, so we don't need to migrate them\nexport const CLIENT_KEY_HALF: KeyDefinitionLike = {\n  key: \"clientKeyHalf\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class MoveBiometricClientKeyHalfToStateProviders extends Migrator<13, 14> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.keys?.biometricEncryptionClientKeyHalf != null) {\n          await helper.setToUser(\n            userId,\n            CLIENT_KEY_HALF,\n            account.keys.biometricEncryptionClientKeyHalf,\n          );\n\n          // Delete old account data\n          delete account?.keys?.biometricEncryptionClientKeyHalf;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n\n      const userKeyHalf = await helper.getFromUser<string>(userId, CLIENT_KEY_HALF);\n\n      if (userKeyHalf) {\n        account ??= {};\n        account.keys ??= {};\n\n        updatedAccount = true;\n        account.keys.biometricEncryptionClientKeyHalf = userKeyHalf;\n        await helper.setToUser(userId, CLIENT_KEY_HALF, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype FolderDataType = {\n  id: string;\n  name: string;\n  revisionDate: string;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    folders?: {\n      encrypted?: Record<string, FolderDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_FOLDERS: KeyDefinitionLike = {\n  key: \"folders\",\n  stateDefinition: {\n    name: \"folder\",\n  },\n};\n\nexport class FolderMigrator extends Migrator<14, 15> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.folders?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_FOLDERS, value);\n        delete account.data.folders;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_ENCRYPTED_FOLDERS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          folders: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_FOLDERS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    lastSync?: string;\n  };\n};\n\nconst LAST_SYNC_KEY: KeyDefinitionLike = {\n  key: \"lastSync\",\n  stateDefinition: {\n    name: \"sync\",\n  },\n};\n\nexport class LastSyncMigrator extends Migrator<15, 16> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.lastSync;\n      await helper.setToUser(userId, LAST_SYNC_KEY, value ?? null);\n      if (value != null) {\n        delete account.profile.lastSync;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, LAST_SYNC_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          lastSync: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, LAST_SYNC_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalType = {\n  enablePasskeys?: boolean;\n};\n\nconst USER_ENABLE_PASSKEYS: KeyDefinitionLike = {\n  key: \"enablePasskeys\",\n  stateDefinition: {\n    name: \"vaultSettings\",\n  },\n};\n\nexport class EnablePasskeysMigrator extends Migrator<16, 17> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<ExpectedGlobalType>(\"global\");\n\n    if (global?.enablePasskeys != null) {\n      await helper.setToGlobal(USER_ENABLE_PASSKEYS, global.enablePasskeys);\n      delete global?.enablePasskeys;\n      await helper.set(\"global\", global);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let global = await helper.get<ExpectedGlobalType>(\"global\");\n    const globalEnablePasskeys = await helper.getFromGlobal<boolean>(USER_ENABLE_PASSKEYS);\n\n    if (globalEnablePasskeys != null) {\n      global = Object.assign(global ?? {}, { enablePasskeys: globalEnablePasskeys });\n      await helper.set(\"global\", global);\n      await helper.setToGlobal(USER_ENABLE_PASSKEYS, undefined);\n    }\n  }\n}\n","import { StateDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nconst AutofillOverlayVisibility = {\n  Off: 0,\n  OnButtonClick: 1,\n  OnFieldFocus: 2,\n} as const;\n\ntype InlineMenuVisibilitySetting =\n  (typeof AutofillOverlayVisibility)[keyof typeof AutofillOverlayVisibility];\n\ntype ExpectedAccountState = {\n  settings?: {\n    autoFillOnPageLoadDefault?: boolean;\n    enableAutoFillOnPageLoad?: boolean;\n    dismissedAutoFillOnPageLoadCallout?: boolean;\n    disableAutoTotpCopy?: boolean;\n    activateAutoFillOnPageLoadFromPolicy?: InlineMenuVisibilitySetting;\n  };\n};\n\ntype ExpectedGlobalState = { autoFillOverlayVisibility?: InlineMenuVisibilitySetting };\n\nconst autofillSettingsStateDefinition: {\n  stateDefinition: StateDefinitionLike;\n} = {\n  stateDefinition: {\n    name: \"autofillSettings\",\n  },\n};\n\nexport class AutofillSettingsKeyMigrator extends Migrator<17, 18> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // global state (e.g. \"autoFillOverlayVisibility -> inlineMenuVisibility\")\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    if (globalState?.autoFillOverlayVisibility != null) {\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"inlineMenuVisibility\",\n        },\n        globalState.autoFillOverlayVisibility,\n      );\n\n      // delete `autoFillOverlayVisibility` from state global\n      delete globalState.autoFillOverlayVisibility;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n\n    // account state (e.g. account settings -> state provider framework keys)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.autoFillOnPageLoadDefault != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadDefault\" },\n          accountSettings.autoFillOnPageLoadDefault,\n        );\n        delete account.settings.autoFillOnPageLoadDefault;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.enableAutoFillOnPageLoad != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoad\" },\n          accountSettings?.enableAutoFillOnPageLoad,\n        );\n        delete account.settings.enableAutoFillOnPageLoad;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.dismissedAutoFillOnPageLoadCallout != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadCalloutIsDismissed\" },\n          accountSettings?.dismissedAutoFillOnPageLoadCallout,\n        );\n        delete account.settings.dismissedAutoFillOnPageLoadCallout;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.disableAutoTotpCopy != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autoCopyTotp\" },\n          // invert the value to match the new naming convention\n          !accountSettings?.disableAutoTotpCopy,\n        );\n        delete account.settings.disableAutoTotpCopy;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.activateAutoFillOnPageLoadFromPolicy != null) {\n        await helper.setToUser(\n          userId,\n          {\n            stateDefinition: {\n              name: \"autofillSettingsLocal\",\n            },\n            key: \"activateAutofillOnPageLoadFromPolicy\",\n          },\n          accountSettings?.activateAutoFillOnPageLoadFromPolicy,\n        );\n        delete account.settings.activateAutoFillOnPageLoadFromPolicy;\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // global state (e.g. \"inlineMenuVisibility -> autoFillOverlayVisibility\")\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n    const inlineMenuVisibility: InlineMenuVisibilitySetting = await helper.getFromGlobal({\n      stateDefinition: {\n        name: \"autofillSettingsLocal\",\n      },\n      key: \"inlineMenuVisibility\",\n    });\n\n    if (inlineMenuVisibility) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        autoFillOverlayVisibility: inlineMenuVisibility,\n      });\n\n      // remove the global state provider framework key for `inlineMenuVisibility`\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"inlineMenuVisibility\",\n        },\n        null,\n      );\n    }\n\n    // account state (e.g. state provider framework keys -> account settings)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      let settings = account?.settings || {};\n\n      const autoFillOnPageLoadDefault: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoadDefault\",\n      });\n\n      const enableAutoFillOnPageLoad: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoad\",\n      });\n\n      const dismissedAutoFillOnPageLoadCallout: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoadCalloutIsDismissed\",\n      });\n\n      const autoCopyTotp: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autoCopyTotp\",\n      });\n\n      const activateAutoFillOnPageLoadFromPolicy: InlineMenuVisibilitySetting =\n        await helper.getFromUser(userId, {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"activateAutofillOnPageLoadFromPolicy\",\n        });\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (autoFillOnPageLoadDefault != null) {\n        settings = { ...settings, autoFillOnPageLoadDefault };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadDefault\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (enableAutoFillOnPageLoad != null) {\n        settings = { ...settings, enableAutoFillOnPageLoad };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoad\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (dismissedAutoFillOnPageLoadCallout != null) {\n        settings = { ...settings, dismissedAutoFillOnPageLoadCallout };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadCalloutIsDismissed\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (autoCopyTotp != null) {\n        // invert the value to match the new naming convention\n        settings = { ...settings, disableAutoTotpCopy: !autoCopyTotp };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autoCopyTotp\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (activateAutoFillOnPageLoadFromPolicy != null) {\n        settings = { ...settings, activateAutoFillOnPageLoadFromPolicy };\n\n        await helper.setToUser(\n          userId,\n          {\n            stateDefinition: {\n              name: \"autofillSettingsLocal\",\n            },\n            key: \"activateAutofillOnPageLoadFromPolicy\",\n          },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        // commit updated settings to state\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    requirePasswordOnStart?: boolean;\n  };\n};\n\n// Biometric text, no auto prompt text, fingerprint validated, and prompt cancelled are refreshed on every app start, so we don't need to migrate them\nexport const REQUIRE_PASSWORD_ON_START: KeyDefinitionLike = {\n  key: \"requirePasswordOnStart\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class RequirePasswordOnStartMigrator extends Migrator<18, 19> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.requirePasswordOnStart != null) {\n          await helper.setToUser(\n            userId,\n            REQUIRE_PASSWORD_ON_START,\n            account.settings.requirePasswordOnStart,\n          );\n\n          // Delete old account data\n          delete account.settings.requirePasswordOnStart;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      const requirePassword = await helper.getFromUser<boolean>(userId, REQUIRE_PASSWORD_ON_START);\n\n      if (requirePassword) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.requirePasswordOnStart = requirePassword;\n        await helper.setToUser(userId, REQUIRE_PASSWORD_ON_START, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  keys?: {\n    privateKey?: {\n      encrypted?: string; // EncryptedString\n    };\n  };\n};\n\nconst USER_ENCRYPTED_PRIVATE_KEY: KeyDefinitionLike = {\n  key: \"privateKey\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class PrivateKeyMigrator extends Migrator<19, 20> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.privateKey?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_PRIVATE_KEY, value);\n        delete account.keys.privateKey;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, string>>(\n        userId,\n        USER_ENCRYPTED_PRIVATE_KEY,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          privateKey: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_PRIVATE_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype CollectionDataType = {\n  id: string;\n  organizationId: string;\n  name: string;\n  externalId: string;\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    collections?: {\n      encrypted?: Record<string, CollectionDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_COLLECTIONS: KeyDefinitionLike = {\n  key: \"collections\",\n  stateDefinition: {\n    name: \"collection\",\n  },\n};\n\nexport class CollectionMigrator extends Migrator<20, 21> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.collections?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_COLLECTIONS, value);\n        delete account.data.collections;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_ENCRYPTED_COLLECTIONS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          collections: {\n            encrypted: value,\n          },\n        });\n\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_COLLECTIONS, null);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    collapsedGroupings?: string[];\n  };\n};\n\nconst COLLAPSED_GROUPINGS: KeyDefinitionLike = {\n  key: \"collapsedGroupings\",\n  stateDefinition: {\n    name: \"vaultFilter\",\n  },\n};\n\nexport class CollapsedGroupingsMigrator extends Migrator<21, 22> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.settings?.collapsedGroupings;\n      if (value != null) {\n        await helper.setToUser(userId, COLLAPSED_GROUPINGS, value);\n        delete account.settings.collapsedGroupings;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, COLLAPSED_GROUPINGS);\n      if (account) {\n        account.settings = Object.assign(account.settings ?? {}, {\n          collapsedGroupings: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, COLLAPSED_GROUPINGS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    disableAutoBiometricsPrompt?: boolean;\n    dismissedBiometricRequirePasswordOnStartCallout?: boolean;\n  };\n};\n\n// prompt cancelled is refreshed on every app start/quit/unlock, so we don't need to migrate it\n\nexport const DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT: KeyDefinitionLike = {\n  key: \"dismissedBiometricRequirePasswordOnStartCallout\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport const PROMPT_AUTOMATICALLY: KeyDefinitionLike = {\n  key: \"promptAutomatically\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class MoveBiometricPromptsToStateProviders extends Migrator<22, 23> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        if (account == null) {\n          return;\n        }\n        // Move account data\n\n        if (account?.settings?.dismissedBiometricRequirePasswordOnStartCallout != null) {\n          await helper.setToUser(\n            userId,\n            DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT,\n            account.settings.dismissedBiometricRequirePasswordOnStartCallout,\n          );\n        }\n\n        if (account?.settings?.disableAutoBiometricsPrompt != null) {\n          await helper.setToUser(\n            userId,\n            PROMPT_AUTOMATICALLY,\n            !account.settings.disableAutoBiometricsPrompt,\n          );\n        }\n\n        // Delete old account data\n        delete account?.settings?.dismissedBiometricRequirePasswordOnStartCallout;\n        delete account?.settings?.disableAutoBiometricsPrompt;\n        await helper.set(userId, account);\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n\n      const userDismissed = await helper.getFromUser<boolean>(\n        userId,\n        DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT,\n      );\n\n      if (userDismissed) {\n        account ??= {};\n        account.settings ??= {};\n\n        updatedAccount = true;\n        account.settings.dismissedBiometricRequirePasswordOnStartCallout = userDismissed;\n        await helper.setToUser(userId, DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT, null);\n      }\n\n      const userPromptAutomatically = await helper.getFromUser<boolean>(\n        userId,\n        PROMPT_AUTOMATICALLY,\n      );\n\n      if (userPromptAutomatically != null) {\n        account ??= {};\n        account.settings ??= {};\n\n        updatedAccount = true;\n        account.settings.disableAutoBiometricsPrompt = !userPromptAutomatically;\n        await helper.setToUser(userId, PROMPT_AUTOMATICALLY, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    smOnboardingTasks?: Record<string, Record<string, boolean>>;\n  };\n};\n\nexport const SM_ONBOARDING_TASKS: KeyDefinitionLike = {\n  key: \"tasks\",\n  stateDefinition: { name: \"smOnboarding\" },\n};\n\nexport class SmOnboardingTasksMigrator extends Migrator<23, 24> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.smOnboardingTasks != null) {\n          await helper.setToUser(userId, SM_ONBOARDING_TASKS, account.settings.smOnboardingTasks);\n\n          // Delete old account data\n          delete account.settings.smOnboardingTasks;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      const smOnboardingTasks = await helper.getFromUser<Record<string, Record<string, boolean>>>(\n        userId,\n        SM_ONBOARDING_TASKS,\n      );\n      if (smOnboardingTasks) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.smOnboardingTasks = smOnboardingTasks;\n        await helper.setToUser(userId, SM_ONBOARDING_TASKS, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { StateDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nconst ClearClipboardDelay = {\n  Never: null as null,\n  TenSeconds: 10,\n  TwentySeconds: 20,\n  ThirtySeconds: 30,\n  OneMinute: 60,\n  TwoMinutes: 120,\n  FiveMinutes: 300,\n} as const;\n\ntype ClearClipboardDelaySetting = (typeof ClearClipboardDelay)[keyof typeof ClearClipboardDelay];\n\ntype ExpectedAccountState = {\n  settings?: {\n    clearClipboard?: ClearClipboardDelaySetting;\n  };\n};\n\nconst autofillSettingsLocalStateDefinition: {\n  stateDefinition: StateDefinitionLike;\n} = {\n  stateDefinition: {\n    name: \"autofillSettingsLocal\",\n  },\n};\n\nexport class ClearClipboardDelayMigrator extends Migrator<24, 25> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. account settings -> state provider framework keys)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.clearClipboard !== undefined) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsLocalStateDefinition, key: \"clearClipboardDelay\" },\n          accountSettings.clearClipboard,\n        );\n        delete account.settings.clearClipboard;\n\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. state provider framework keys -> account settings)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let settings = account?.settings || {};\n\n      const clearClipboardDelay: ClearClipboardDelaySetting = await helper.getFromUser(userId, {\n        ...autofillSettingsLocalStateDefinition,\n        key: \"clearClipboardDelay\",\n      });\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (clearClipboardDelay !== undefined) {\n        settings = { ...settings, clearClipboard: clearClipboardDelay };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsLocalStateDefinition, key: \"clearClipboardDelay\" },\n          null,\n        );\n\n        // commit updated settings to state\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    lastSync?: string;\n  };\n};\n\nconst LAST_SYNC_KEY: KeyDefinitionLike = {\n  key: \"lastSync\",\n  stateDefinition: {\n    name: \"sync\",\n  },\n};\n\nexport class RevertLastSyncMigrator extends Migrator<25, 26> {\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.lastSync;\n      await helper.setToUser(userId, LAST_SYNC_KEY, value ?? null);\n      if (value != null) {\n        delete account.profile.lastSync;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, LAST_SYNC_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          lastSync: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, LAST_SYNC_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: {\n    disableBadgeCounter?: boolean;\n  };\n};\n\nconst enableBadgeCounterKeyDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"badgeSettings\",\n  },\n  key: \"enableBadgeCounter\",\n};\n\nexport class BadgeSettingsMigrator extends Migrator<26, 27> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. account settings -> state provider framework keys)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.disableBadgeCounter != undefined) {\n        await helper.setToUser(\n          userId,\n          enableBadgeCounterKeyDefinition,\n          !accountSettings.disableBadgeCounter,\n        );\n        delete account.settings.disableBadgeCounter;\n\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. state provider framework keys -> account settings)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let settings = account?.settings || {};\n\n      const enableBadgeCounter: boolean = await helper.getFromUser(\n        userId,\n        enableBadgeCounterKeyDefinition,\n      );\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (enableBadgeCounter != undefined) {\n        settings = { ...settings, disableBadgeCounter: !enableBadgeCounter };\n\n        await helper.setToUser(userId, enableBadgeCounterKeyDefinition, null);\n\n        // commit updated settings to state\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    biometricUnlock?: boolean;\n  };\n};\n\nexport const BIOMETRIC_UNLOCK_ENABLED: KeyDefinitionLike = {\n  key: \"biometricUnlockEnabled\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class MoveBiometricUnlockToStateProviders extends Migrator<27, 28> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        if (account == null) {\n          return;\n        }\n        // Move account data\n        if (account?.settings?.biometricUnlock != null) {\n          await helper.setToUser(\n            userId,\n            BIOMETRIC_UNLOCK_ENABLED,\n            account.settings.biometricUnlock,\n          );\n        }\n\n        // Delete old account data\n        delete account?.settings?.biometricUnlock;\n        await helper.set(userId, account);\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      const biometricUnlock = await helper.getFromUser<boolean>(userId, BIOMETRIC_UNLOCK_ENABLED);\n\n      if (biometricUnlock != null) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.biometricUnlock = biometricUnlock;\n        await helper.setToUser(userId, BIOMETRIC_UNLOCK_ENABLED, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalState = {\n  disableAddLoginNotification?: boolean;\n  disableChangedPasswordNotification?: boolean;\n};\n\nexport class UserNotificationSettingsKeyMigrator extends Migrator<28, 29> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    // disableAddLoginNotification -> enableAddedLoginPrompt\n    if (globalState?.disableAddLoginNotification != null) {\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"userNotificationSettings\",\n          },\n          key: \"enableAddedLoginPrompt\",\n        },\n        !globalState.disableAddLoginNotification,\n      );\n\n      // delete `disableAddLoginNotification` from state global\n      delete globalState.disableAddLoginNotification;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n\n    // disableChangedPasswordNotification -> enableChangedPasswordPrompt\n    if (globalState?.disableChangedPasswordNotification != null) {\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"userNotificationSettings\",\n          },\n          key: \"enableChangedPasswordPrompt\",\n        },\n        !globalState.disableChangedPasswordNotification,\n      );\n\n      // delete `disableChangedPasswordNotification` from state global\n      delete globalState.disableChangedPasswordNotification;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n\n    const enableAddedLoginPrompt: boolean = await helper.getFromGlobal({\n      stateDefinition: {\n        name: \"userNotificationSettings\",\n      },\n      key: \"enableAddedLoginPrompt\",\n    });\n\n    const enableChangedPasswordPrompt: boolean = await helper.getFromGlobal({\n      stateDefinition: {\n        name: \"userNotificationSettings\",\n      },\n      key: \"enableChangedPasswordPrompt\",\n    });\n\n    // enableAddedLoginPrompt -> disableAddLoginNotification\n    if (enableAddedLoginPrompt) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        disableAddLoginNotification: !enableAddedLoginPrompt,\n      });\n\n      // remove the global state provider framework key for `enableAddedLoginPrompt`\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"userNotificationSettings\",\n          },\n          key: \"enableAddedLoginPrompt\",\n        },\n        null,\n      );\n    }\n\n    // enableChangedPasswordPrompt -> disableChangedPasswordNotification\n    if (enableChangedPasswordPrompt) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        disableChangedPasswordNotification: !enableChangedPasswordPrompt,\n      });\n\n      // remove the global state provider framework key for `enableChangedPasswordPrompt`\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"userNotificationSettings\",\n          },\n          key: \"enableChangedPasswordPrompt\",\n        },\n        null,\n      );\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nenum PolicyType {\n  TwoFactorAuthentication = 0, // Requires users to have 2fa enabled\n  MasterPassword = 1, // Sets minimum requirements for master password complexity\n  PasswordGenerator = 2, // Sets minimum requirements/default type for generated passwords/passphrases\n  SingleOrg = 3, // Allows users to only be apart of one organization\n  RequireSso = 4, // Requires users to authenticate with SSO\n  PersonalOwnership = 5, // Disables personal vault ownership for adding/cloning items\n  DisableSend = 6, // Disables the ability to create and edit Bitwarden Sends\n  SendOptions = 7, // Sets restrictions or defaults for Bitwarden Sends\n  ResetPassword = 8, // Allows orgs to use reset password : also can enable auto-enrollment during invite flow\n  MaximumVaultTimeout = 9, // Sets the maximum allowed vault timeout\n  DisablePersonalVaultExport = 10, // Disable personal vault export\n  ActivateAutofill = 11, // Activates autofill with page load on the browser extension\n}\n\ntype PolicyDataType = {\n  id: string;\n  organizationId: string;\n  type: PolicyType;\n  data: Record<string, string | number | boolean>;\n  enabled: boolean;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    policies?: {\n      encrypted?: Record<string, PolicyDataType>;\n    };\n  };\n};\n\nconst POLICIES_KEY: KeyDefinitionLike = {\n  key: \"policies\",\n  stateDefinition: {\n    name: \"policies\",\n  },\n};\n\nexport class PolicyMigrator extends Migrator<29, 30> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.policies?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, POLICIES_KEY, value);\n        delete account.data.policies;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => migrateAccount(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, POLICIES_KEY);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          policies: {\n            encrypted: value,\n          },\n        });\n\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, POLICIES_KEY, null);\n    }\n    await Promise.all(accounts.map(({ userId, account }) => rollbackAccount(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalState = {\n  disableContextMenuItem?: boolean;\n};\n\nconst enableContextMenuKeyDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"autofillSettings\",\n  },\n  key: \"enableContextMenu\",\n};\n\nexport class EnableContextMenuMigrator extends Migrator<30, 31> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    // disableContextMenuItem -> enableContextMenu\n    if (globalState?.disableContextMenuItem != null) {\n      await helper.setToGlobal(enableContextMenuKeyDefinition, !globalState.disableContextMenuItem);\n\n      // delete `disableContextMenuItem` from state global\n      delete globalState.disableContextMenuItem;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n\n    const enableContextMenu: boolean = await helper.getFromGlobal(enableContextMenuKeyDefinition);\n\n    // enableContextMenu -> disableContextMenuItem\n    if (enableContextMenu != null) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        disableContextMenuItem: !enableContextMenu,\n      });\n\n      // remove the global state provider framework key for `enableContextMenu`\n      await helper.setToGlobal(enableContextMenuKeyDefinition, null);\n    }\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobal = {\n  locale?: string;\n};\n\nexport const LOCALE_KEY = {\n  key: \"locale\",\n  stateDefinition: {\n    name: \"translation\",\n  },\n};\n\nexport class PreferredLanguageMigrator extends Migrator<31, 32> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // global state\n    const global = await helper.get<ExpectedGlobal>(\"global\");\n    if (!global?.locale) {\n      return;\n    }\n\n    await helper.setToGlobal(LOCALE_KEY, global.locale);\n    delete global.locale;\n    await helper.set(\"global\", global);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const locale = await helper.getFromGlobal<string>(LOCALE_KEY);\n\n    if (!locale) {\n      return;\n    }\n    const global = (await helper.get<ExpectedGlobal>(\"global\")) ?? {};\n    global.locale = locale;\n    await helper.set(\"global\", global);\n    await helper.setToGlobal(LOCALE_KEY, null);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nexport const APP_ID_STORAGE_KEY = \"appId\";\nexport const ANONYMOUS_APP_ID_STORAGE_KEY = \"anonymousAppId\";\n\nexport const APP_ID_KEY: KeyDefinitionLike = {\n  key: APP_ID_STORAGE_KEY,\n  stateDefinition: { name: \"applicationId\" },\n};\n\nexport const ANONYMOUS_APP_ID_KEY: KeyDefinitionLike = {\n  key: ANONYMOUS_APP_ID_STORAGE_KEY,\n  stateDefinition: { name: \"applicationId\" },\n};\n\nexport class AppIdMigrator extends Migrator<32, 33> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const appId = await helper.get<string>(APP_ID_STORAGE_KEY);\n    const anonymousAppId = await helper.get<string>(ANONYMOUS_APP_ID_STORAGE_KEY);\n\n    if (appId != null) {\n      await helper.setToGlobal(APP_ID_KEY, appId);\n      await helper.set(APP_ID_STORAGE_KEY, null);\n    }\n\n    if (anonymousAppId != null) {\n      await helper.setToGlobal(ANONYMOUS_APP_ID_KEY, anonymousAppId);\n      await helper.set(ANONYMOUS_APP_ID_STORAGE_KEY, null);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const appId = await helper.getFromGlobal<string>(APP_ID_KEY);\n    const anonymousAppId = await helper.getFromGlobal<string>(ANONYMOUS_APP_ID_KEY);\n\n    if (appId != null) {\n      await helper.set(APP_ID_STORAGE_KEY, appId);\n      await helper.setToGlobal(APP_ID_KEY, null);\n    }\n    if (anonymousAppId != null) {\n      await helper.set(ANONYMOUS_APP_ID_STORAGE_KEY, anonymousAppId);\n      await helper.setToGlobal(ANONYMOUS_APP_ID_KEY, null);\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nconst UriMatchStrategy = {\n  Domain: 0,\n  Host: 1,\n  StartsWith: 2,\n  Exact: 3,\n  RegularExpression: 4,\n  Never: 5,\n} as const;\n\ntype UriMatchStrategySetting = (typeof UriMatchStrategy)[keyof typeof UriMatchStrategy];\n\ntype ExpectedAccountState = {\n  settings?: {\n    defaultUriMatch?: UriMatchStrategySetting;\n    settings?: {\n      equivalentDomains?: string[][];\n    };\n  };\n};\n\ntype ExpectedGlobalState = {\n  neverDomains?: { [key: string]: null };\n};\n\nconst defaultUriMatchStrategyDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"domainSettings\",\n  },\n  key: \"defaultUriMatchStrategy\",\n};\n\nconst equivalentDomainsDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"domainSettings\",\n  },\n  key: \"equivalentDomains\",\n};\n\nconst neverDomainsDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"domainSettings\",\n  },\n  key: \"neverDomains\",\n};\n\nexport class DomainSettingsMigrator extends Migrator<33, 34> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    let updateAccount = false;\n\n    // global state (\"neverDomains\")\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    if (globalState?.neverDomains != null) {\n      await helper.setToGlobal(neverDomainsDefinition, globalState.neverDomains);\n\n      // delete `neverDomains` from state global\n      delete globalState.neverDomains;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n\n    // account state (\"defaultUriMatch\" and \"settings.equivalentDomains\")\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.defaultUriMatch != undefined) {\n        await helper.setToUser(\n          userId,\n          defaultUriMatchStrategyDefinition,\n          accountSettings.defaultUriMatch,\n        );\n        delete account.settings.defaultUriMatch;\n\n        updateAccount = true;\n      }\n\n      if (accountSettings?.settings?.equivalentDomains != undefined) {\n        await helper.setToUser(\n          userId,\n          equivalentDomainsDefinition,\n          accountSettings.settings.equivalentDomains,\n        );\n        delete account.settings.settings.equivalentDomains;\n        delete account.settings.settings;\n\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let updateAccount = false;\n\n    // global state (\"neverDomains\")\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n    const neverDomains: { [key: string]: null } =\n      await helper.getFromGlobal(neverDomainsDefinition);\n\n    if (neverDomains != null) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        neverDomains: neverDomains,\n      });\n\n      // remove the global state provider framework key for `neverDomains`\n      await helper.setToGlobal(neverDomainsDefinition, null);\n    }\n\n    // account state (\"defaultUriMatchStrategy\" and \"equivalentDomains\")\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let settings = account?.settings || {};\n\n      const defaultUriMatchStrategy: UriMatchStrategySetting = await helper.getFromUser(\n        userId,\n        defaultUriMatchStrategyDefinition,\n      );\n\n      const equivalentDomains: string[][] = await helper.getFromUser(\n        userId,\n        equivalentDomainsDefinition,\n      );\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (defaultUriMatchStrategy != null) {\n        settings = { ...settings, defaultUriMatch: defaultUriMatchStrategy };\n\n        await helper.setToUser(userId, defaultUriMatchStrategyDefinition, null);\n\n        updateAccount = true;\n      }\n\n      if (equivalentDomains != null) {\n        settings = { ...settings, settings: { equivalentDomains } };\n\n        await helper.setToUser(userId, equivalentDomainsDefinition, null);\n\n        updateAccount = true;\n      }\n\n      // commit updated settings to state\n      if (updateAccount) {\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobal = { theme?: string };\n\nconst THEME_SELECTION: KeyDefinitionLike = {\n  key: \"selection\",\n  stateDefinition: { name: \"theming\" },\n};\n\nexport class MoveThemeToStateProviderMigrator extends Migrator<34, 35> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobalState = await helper.get<ExpectedGlobal>(\"global\");\n    const theme = legacyGlobalState?.theme;\n    if (theme != null) {\n      await helper.setToGlobal(THEME_SELECTION, theme);\n      delete legacyGlobalState.theme;\n      await helper.set(\"global\", legacyGlobalState);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const theme = await helper.getFromGlobal<string>(THEME_SELECTION);\n    if (theme != null) {\n      const legacyGlobal = (await helper.get<ExpectedGlobal>(\"global\")) ?? {};\n      legacyGlobal.theme = theme;\n      await helper.set(\"global\", legacyGlobal);\n      await helper.removeFromGlobal(THEME_SELECTION);\n    }\n  }\n}\n","import { MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: {\n    dontShowCardsCurrentTab?: boolean;\n    dontShowIdentitiesCurrentTab?: boolean;\n  };\n};\n\nconst vaultSettingsStateDefinition: {\n  stateDefinition: StateDefinitionLike;\n} = {\n  stateDefinition: {\n    name: \"vaultSettings\",\n  },\n};\n\nexport class VaultSettingsKeyMigrator extends Migrator<35, 36> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.dontShowCardsCurrentTab != null) {\n        await helper.setToUser(\n          userId,\n          { ...vaultSettingsStateDefinition, key: \"showCardsCurrentTab\" },\n          !accountSettings.dontShowCardsCurrentTab,\n        );\n        delete account.settings.dontShowCardsCurrentTab;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.dontShowIdentitiesCurrentTab != null) {\n        await helper.setToUser(\n          userId,\n          { ...vaultSettingsStateDefinition, key: \"showIdentitiesCurrentTab\" },\n          !accountSettings.dontShowIdentitiesCurrentTab,\n        );\n        delete account.settings.dontShowIdentitiesCurrentTab;\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      let settings = account?.settings ?? {};\n\n      const showCardsCurrentTab = await helper.getFromUser<boolean>(userId, {\n        ...vaultSettingsStateDefinition,\n        key: \"showCardsCurrentTab\",\n      });\n\n      const showIdentitiesCurrentTab = await helper.getFromUser<boolean>(userId, {\n        ...vaultSettingsStateDefinition,\n        key: \"showIdentitiesCurrentTab\",\n      });\n\n      if (showCardsCurrentTab != null) {\n        // invert the value to match the new naming convention\n        settings = { ...settings, dontShowCardsCurrentTab: !showCardsCurrentTab };\n\n        await helper.setToUser(\n          userId,\n          { ...vaultSettingsStateDefinition, key: \"showCardsCurrentTab\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (showIdentitiesCurrentTab != null) {\n        // invert the value to match the new naming convention\n        settings = { ...settings, dontShowIdentitiesCurrentTab: !showIdentitiesCurrentTab };\n\n        await helper.setToUser(\n          userId,\n          { ...vaultSettingsStateDefinition, key: \"showIdentitiesCurrentTab\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        await helper.set(userId, { ...account, settings });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: { avatarColor?: string };\n};\n\nconst AVATAR_COLOR_STATE: StateDefinitionLike = { name: \"avatar\" };\n\nconst AVATAR_COLOR_KEY: KeyDefinitionLike = {\n  key: \"avatarColor\",\n  stateDefinition: AVATAR_COLOR_STATE,\n};\n\nexport class AvatarColorMigrator extends Migrator<36, 37> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account avatarColor\n        if (account?.settings?.avatarColor != null) {\n          await helper.setToUser(userId, AVATAR_COLOR_KEY, account.settings.avatarColor);\n\n          // Delete old account avatarColor property\n          delete account?.settings?.avatarColor;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountState) {\n      let updatedAccount = false;\n      const userAvatarColor = await helper.getFromUser<string>(userId, AVATAR_COLOR_KEY);\n\n      if (userAvatarColor) {\n        if (!account) {\n          account = {};\n        }\n\n        updatedAccount = true;\n        account.settings.avatarColor = userAvatarColor;\n        await helper.setToUser(userId, AVATAR_COLOR_KEY, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n// Types to represent data as it is stored in JSON\ntype ExpectedAccountType = {\n  tokens?: {\n    accessToken?: string;\n    refreshToken?: string;\n  };\n  profile?: {\n    apiKeyClientId?: string;\n    email?: string;\n  };\n  keys?: {\n    apiKeyClientSecret?: string;\n  };\n};\n\ntype ExpectedGlobalType = {\n  twoFactorToken?: string;\n};\n\nexport const EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL: KeyDefinitionLike = {\n  key: \"emailTwoFactorTokenRecord\",\n  stateDefinition: {\n    name: \"tokenDiskLocal\",\n  },\n};\n\nconst TOKEN_STATE_DEF_LIKE: StateDefinitionLike = {\n  name: \"token\",\n};\n\nexport const ACCESS_TOKEN_DISK: KeyDefinitionLike = {\n  key: \"accessToken\", // matches KeyDefinition.key\n  stateDefinition: TOKEN_STATE_DEF_LIKE,\n};\n\nexport const REFRESH_TOKEN_DISK: KeyDefinitionLike = {\n  key: \"refreshToken\",\n  stateDefinition: TOKEN_STATE_DEF_LIKE,\n};\n\nexport const API_KEY_CLIENT_ID_DISK: KeyDefinitionLike = {\n  key: \"apiKeyClientId\",\n  stateDefinition: TOKEN_STATE_DEF_LIKE,\n};\n\nexport const API_KEY_CLIENT_SECRET_DISK: KeyDefinitionLike = {\n  key: \"apiKeyClientSecret\",\n  stateDefinition: TOKEN_STATE_DEF_LIKE,\n};\n\nexport class TokenServiceStateProviderMigrator extends Migrator<37, 38> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // Move global data\n    const globalData = await helper.get<ExpectedGlobalType>(\"global\");\n\n    // Create new global record for 2FA token that we can accumulate data in\n    const emailTwoFactorTokenRecord = {};\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(\n      userId: string,\n      account: ExpectedAccountType | undefined,\n      globalTwoFactorToken: string | undefined,\n      emailTwoFactorTokenRecord: Record<string, string>,\n    ): Promise<void> {\n      let updatedAccount = false;\n\n      // migrate 2FA token from global to user state\n      // Due to the existing implmentation, n users on the same device share the same global state value for 2FA token.\n      // So, we will just migrate it to all users to keep it valid for whichever was the user that set it previously.\n      // Note: don't bother migrating 2FA Token if user account or email is undefined\n      const email = account?.profile?.email;\n      if (globalTwoFactorToken != undefined && account != undefined && email != undefined) {\n        emailTwoFactorTokenRecord[email] = globalTwoFactorToken;\n        // Note: don't set updatedAccount to true here as we aren't updating\n        // the legacy user state, just migrating a global state to a new user state\n      }\n\n      // Migrate access token\n      const existingAccessToken = account?.tokens?.accessToken;\n\n      if (existingAccessToken != null) {\n        // Only migrate data that exists\n        if (helper.type !== \"web-disk-local\") {\n          // only migrate access token to session storage - never local.\n          await helper.setToUser(userId, ACCESS_TOKEN_DISK, existingAccessToken);\n        }\n        delete account.tokens.accessToken;\n        updatedAccount = true;\n      }\n\n      // Migrate refresh token\n      const existingRefreshToken = account?.tokens?.refreshToken;\n\n      if (existingRefreshToken != null) {\n        if (helper.type !== \"web-disk-local\") {\n          // only migrate refresh token to session storage - never local.\n          await helper.setToUser(userId, REFRESH_TOKEN_DISK, existingRefreshToken);\n        }\n        delete account.tokens.refreshToken;\n        updatedAccount = true;\n      }\n\n      // Migrate API key client id\n      const existingApiKeyClientId = account?.profile?.apiKeyClientId;\n\n      if (existingApiKeyClientId != null) {\n        if (helper.type !== \"web-disk-local\") {\n          // only migrate client id to session storage - never local.\n          await helper.setToUser(userId, API_KEY_CLIENT_ID_DISK, existingApiKeyClientId);\n        }\n        delete account.profile.apiKeyClientId;\n        updatedAccount = true;\n      }\n\n      // Migrate API key client secret\n      const existingApiKeyClientSecret = account?.keys?.apiKeyClientSecret;\n      if (existingApiKeyClientSecret != null) {\n        if (helper.type !== \"web-disk-local\") {\n          // only migrate client secret to session storage - never local.\n          await helper.setToUser(userId, API_KEY_CLIENT_SECRET_DISK, existingApiKeyClientSecret);\n        }\n        delete account.keys.apiKeyClientSecret;\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        // Save the migrated account only if it was updated\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([\n      ...accounts.map(({ userId, account }) =>\n        migrateAccount(userId, account, globalData?.twoFactorToken, emailTwoFactorTokenRecord),\n      ),\n    ]);\n\n    // Save the global 2FA token record\n    await helper.setToGlobal(EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL, emailTwoFactorTokenRecord);\n\n    // Delete global data\n    delete globalData?.twoFactorToken;\n    await helper.set(\"global\", globalData);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    // Since we migrated the global 2FA token to all users, we need to rollback the 2FA token for all users\n    // but we only need to set it to the global state once\n\n    // Go through accounts and find the first user that has a non-null email and 2FA token\n    let migratedTwoFactorToken: string | null = null;\n    for (const { account } of accounts) {\n      const email = account?.profile?.email;\n      if (email == null) {\n        continue;\n      }\n      const emailTwoFactorTokenRecord: Record<string, string> = await helper.getFromGlobal(\n        EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL,\n      );\n\n      migratedTwoFactorToken = emailTwoFactorTokenRecord[email];\n\n      if (migratedTwoFactorToken != null) {\n        break;\n      }\n    }\n\n    if (migratedTwoFactorToken != null) {\n      let legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n      legacyGlobal.twoFactorToken = migratedTwoFactorToken;\n      await helper.set(\"global\", legacyGlobal);\n    }\n\n    // delete global 2FA token record\n    await helper.setToGlobal(EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL, null);\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedLegacyAccount = false;\n\n      // Rollback access token\n      const migratedAccessToken = await helper.getFromUser<string>(userId, ACCESS_TOKEN_DISK);\n\n      if (account?.tokens && migratedAccessToken != null) {\n        account.tokens.accessToken = migratedAccessToken;\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, ACCESS_TOKEN_DISK, null);\n\n      // Rollback refresh token\n      const migratedRefreshToken = await helper.getFromUser<string>(userId, REFRESH_TOKEN_DISK);\n\n      if (account?.tokens && migratedRefreshToken != null) {\n        account.tokens.refreshToken = migratedRefreshToken;\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, REFRESH_TOKEN_DISK, null);\n\n      // Rollback API key client id\n\n      const migratedApiKeyClientId = await helper.getFromUser<string>(\n        userId,\n        API_KEY_CLIENT_ID_DISK,\n      );\n\n      if (account?.profile && migratedApiKeyClientId != null) {\n        account.profile.apiKeyClientId = migratedApiKeyClientId;\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, API_KEY_CLIENT_ID_DISK, null);\n\n      // Rollback API key client secret\n      const migratedApiKeyClientSecret = await helper.getFromUser<string>(\n        userId,\n        API_KEY_CLIENT_SECRET_DISK,\n      );\n\n      if (account?.keys && migratedApiKeyClientSecret != null) {\n        account.keys.apiKeyClientSecret = migratedApiKeyClientSecret;\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, API_KEY_CLIENT_SECRET_DISK, null);\n\n      if (updatedLegacyAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    hasPremiumPersonally?: boolean;\n    hasPremiumFromOrganization?: boolean;\n  };\n};\n\ntype ExpectedBillingAccountProfileType = {\n  hasPremiumPersonally: boolean;\n  hasPremiumFromOrganization: boolean;\n};\n\nexport const BILLING_ACCOUNT_PROFILE_KEY_DEFINITION: KeyDefinitionLike = {\n  key: \"accountProfile\",\n  stateDefinition: {\n    name: \"billing\",\n  },\n};\n\nexport class MoveBillingAccountProfileMigrator extends Migrator<38, 39> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    const migrateAccount = async (userId: string, account: ExpectedAccountType): Promise<void> => {\n      const hasPremiumPersonally = account?.profile?.hasPremiumPersonally;\n      const hasPremiumFromOrganization = account?.profile?.hasPremiumFromOrganization;\n\n      if (hasPremiumPersonally != null || hasPremiumFromOrganization != null) {\n        await helper.setToUser(userId, BILLING_ACCOUNT_PROFILE_KEY_DEFINITION, {\n          hasPremiumPersonally: hasPremiumPersonally,\n          hasPremiumFromOrganization: hasPremiumFromOrganization,\n        });\n\n        delete account?.profile?.hasPremiumPersonally;\n        delete account?.profile?.hasPremiumFromOrganization;\n        await helper.set(userId, account);\n      }\n    };\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    const rollbackAccount = async (userId: string, account: ExpectedAccountType): Promise<void> => {\n      const value = await helper.getFromUser<ExpectedBillingAccountProfileType>(\n        userId,\n        BILLING_ACCOUNT_PROFILE_KEY_DEFINITION,\n      );\n\n      if (account && value) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          hasPremiumPersonally: value?.hasPremiumPersonally,\n          hasPremiumFromOrganization: value?.hasPremiumFromOrganization,\n        });\n        await helper.set(userId, account);\n      }\n\n      await helper.setToUser(userId, BILLING_ACCOUNT_PROFILE_KEY_DEFINITION, null);\n    };\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { profile?: { everBeenUnlocked?: boolean } };\n\nexport class RemoveEverBeenUnlockedMigrator extends Migrator<3, 4> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function removeEverBeenUnlocked(userId: string, account: ExpectedAccountType) {\n      if (account?.profile?.everBeenUnlocked != null) {\n        delete account.profile.everBeenUnlocked;\n        return helper.set(userId, account);\n      }\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(({ userId, account }) => removeEverBeenUnlocked(userId, account)));\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n// Local declarations of `OrganizationData` and the types of it's properties.\n// Duplicated to remain frozen in time when migration occurs.\nenum OrganizationUserStatusType {\n  Invited = 0,\n  Accepted = 1,\n  Confirmed = 2,\n  Revoked = -1,\n}\n\nenum OrganizationUserType {\n  Owner = 0,\n  Admin = 1,\n  User = 2,\n  Manager = 3,\n  Custom = 4,\n}\n\ntype PermissionsApi = {\n  accessEventLogs: boolean;\n  accessImportExport: boolean;\n  accessReports: boolean;\n  createNewCollections: boolean;\n  editAnyCollection: boolean;\n  deleteAnyCollection: boolean;\n  editAssignedCollections: boolean;\n  deleteAssignedCollections: boolean;\n  manageCiphers: boolean;\n  manageGroups: boolean;\n  manageSso: boolean;\n  managePolicies: boolean;\n  manageUsers: boolean;\n  manageResetPassword: boolean;\n  manageScim: boolean;\n};\n\nenum ProviderType {\n  Msp = 0,\n  Reseller = 1,\n}\n\nenum ProductType {\n  Free = 0,\n  Families = 1,\n  Teams = 2,\n  Enterprise = 3,\n  TeamsStarter = 4,\n}\n\ntype OrganizationData = {\n  id: string;\n  name: string;\n  status: OrganizationUserStatusType;\n  type: OrganizationUserType;\n  enabled: boolean;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  hasPublicAndPrivateKeys: boolean;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  isProviderUser: boolean;\n  isMember: boolean;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  limitCollectionCreationDeletion: boolean;\n  allowAdminAccessToAllCollectionItems: boolean;\n  flexibleCollections: boolean;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    organizations?: Record<string, Jsonify<OrganizationData>>;\n  };\n};\n\nconst USER_ORGANIZATIONS: KeyDefinitionLike = {\n  key: \"organizations\",\n  stateDefinition: {\n    name: \"organizations\",\n  },\n};\n\nexport class OrganizationMigrator extends Migrator<39, 40> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.organizations;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ORGANIZATIONS, value);\n        delete account.data.organizations;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => migrateAccount(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_ORGANIZATIONS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          organizations: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ORGANIZATIONS, null);\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackAccount(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  data?: {\n    eventCollection?: [];\n  };\n};\n\nconst EVENT_COLLECTION: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"eventCollection\",\n  },\n  key: \"eventCollection\",\n};\n\nexport class EventCollectionMigrator extends Migrator<40, 41> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const value = account?.data?.eventCollection;\n      if (value != null) {\n        await helper.setToUser(userId, EVENT_COLLECTION, value);\n        delete account.data.eventCollection;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const value = await helper.getFromUser(userId, EVENT_COLLECTION);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          eventCollection: value,\n        });\n\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, EVENT_COLLECTION, null);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalState = {\n  disableFavicon?: boolean;\n};\n\nconst ShowFaviconDefinition: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"domainSettings\",\n  },\n  key: \"showFavicons\",\n};\n\nexport class EnableFaviconMigrator extends Migrator<41, 42> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // global state (\"disableFavicon\" -> \"showFavicons\")\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    if (globalState?.disableFavicon != null) {\n      await helper.setToGlobal(ShowFaviconDefinition, !globalState.disableFavicon);\n\n      // delete `disableFavicon` from state global\n      delete globalState.disableFavicon;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // global state (\"showFavicons\" -> \"disableFavicon\")\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n    const showFavicons: boolean = await helper.getFromGlobal(ShowFaviconDefinition);\n\n    if (showFavicons != null) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        disableFavicon: !showFavicons,\n      });\n\n      // remove the global state provider framework key for `showFavicons`\n      await helper.setToGlobal(ShowFaviconDefinition, null);\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: { autoConfirmFingerPrints?: boolean };\n};\n\nconst ORGANIZATION_MANAGEMENT_PREFERENCES: StateDefinitionLike = {\n  name: \"organizationManagementPreferences\",\n};\n\nconst AUTO_CONFIRM_FINGERPRINTS: KeyDefinitionLike = {\n  key: \"autoConfirmFingerPrints\",\n  stateDefinition: ORGANIZATION_MANAGEMENT_PREFERENCES,\n};\n\nexport class AutoConfirmFingerPrintsMigrator extends Migrator<42, 43> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        if (account?.settings?.autoConfirmFingerPrints != null) {\n          await helper.setToUser(\n            userId,\n            AUTO_CONFIRM_FINGERPRINTS,\n            account.settings.autoConfirmFingerPrints,\n          );\n          delete account?.settings?.autoConfirmFingerPrints;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountState) {\n      let updatedAccount = false;\n      const autoConfirmFingerPrints = await helper.getFromUser<boolean>(\n        userId,\n        AUTO_CONFIRM_FINGERPRINTS,\n      );\n\n      if (autoConfirmFingerPrints) {\n        if (!account) {\n          account = {};\n        }\n\n        updatedAccount = true;\n        account.settings.autoConfirmFingerPrints = autoConfirmFingerPrints;\n        await helper.setToUser(userId, AUTO_CONFIRM_FINGERPRINTS, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype DecryptionOptionsType = {\n  hasMasterPassword: boolean;\n  trustedDeviceOption?: {\n    hasAdminApproval: boolean;\n    hasLoginApprovingDevice: boolean;\n    hasManageResetPasswordPermission: boolean;\n  };\n  keyConnectorOption?: {\n    keyConnectorUrl: string;\n  };\n};\n\ntype ExpectedAccountType = {\n  decryptionOptions?: DecryptionOptionsType;\n};\n\nconst USER_DECRYPTION_OPTIONS: KeyDefinitionLike = {\n  key: \"decryptionOptions\",\n  stateDefinition: {\n    name: \"userDecryptionOptions\",\n  },\n};\n\nexport class UserDecryptionOptionsMigrator extends Migrator<43, 44> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.decryptionOptions;\n      if (value != null) {\n        await helper.setToUser(userId, USER_DECRYPTION_OPTIONS, value);\n        delete account.decryptionOptions;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value: DecryptionOptionsType = await helper.getFromUser(\n        userId,\n        USER_DECRYPTION_OPTIONS,\n      );\n      if (account) {\n        account.decryptionOptions = Object.assign(account.decryptionOptions, value);\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_DECRYPTION_OPTIONS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nconst ENVIRONMENT_STATE: StateDefinitionLike = { name: \"environment\" };\n\nconst ENVIRONMENT_REGION: KeyDefinitionLike = {\n  key: \"region\",\n  stateDefinition: ENVIRONMENT_STATE,\n};\n\nconst ENVIRONMENT_URLS: KeyDefinitionLike = {\n  key: \"urls\",\n  stateDefinition: ENVIRONMENT_STATE,\n};\n\nconst ENVIRONMENT_ENVIRONMENT: KeyDefinitionLike = {\n  key: \"environment\",\n  stateDefinition: ENVIRONMENT_STATE,\n};\n\nexport class MergeEnvironmentState extends Migrator<44, 45> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<unknown>();\n\n    async function migrateAccount(userId: string, account: unknown): Promise<void> {\n      const region = await helper.getFromUser(userId, ENVIRONMENT_REGION);\n      const urls = await helper.getFromUser(userId, ENVIRONMENT_URLS);\n\n      if (region == null && urls == null) {\n        return;\n      }\n\n      await helper.setToUser(userId, ENVIRONMENT_ENVIRONMENT, {\n        region,\n        urls,\n      });\n      await helper.removeFromUser(userId, ENVIRONMENT_REGION);\n      await helper.removeFromUser(userId, ENVIRONMENT_URLS);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    const region = await helper.getFromGlobal(ENVIRONMENT_REGION);\n    const urls = await helper.getFromGlobal(ENVIRONMENT_URLS);\n\n    if (region == null && urls == null) {\n      return;\n    }\n\n    await helper.setToGlobal(ENVIRONMENT_ENVIRONMENT, {\n      region,\n      urls,\n    });\n    await helper.removeFromGlobal(ENVIRONMENT_REGION);\n    await helper.removeFromGlobal(ENVIRONMENT_URLS);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<unknown>();\n\n    async function rollbackAccount(userId: string, account: unknown): Promise<void> {\n      const state = (await helper.getFromUser(userId, ENVIRONMENT_ENVIRONMENT)) as {\n        region: string;\n        urls: string;\n      } | null;\n\n      await helper.setToUser(userId, ENVIRONMENT_REGION, state?.region);\n      await helper.setToUser(userId, ENVIRONMENT_URLS, state?.urls);\n      await helper.removeFromUser(userId, ENVIRONMENT_ENVIRONMENT);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    const state = (await helper.getFromGlobal(ENVIRONMENT_ENVIRONMENT)) as {\n      region: string;\n      urls: string;\n    } | null;\n\n    await helper.setToGlobal(ENVIRONMENT_REGION, state?.region);\n    await helper.setToGlobal(ENVIRONMENT_URLS, state?.urls);\n    await helper.removeFromGlobal(ENVIRONMENT_ENVIRONMENT);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\nexport const PROMPT_CANCELLED: KeyDefinitionLike = {\n  key: \"promptCancelled\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class DeleteBiometricPromptCancelledData extends Migrator<45, 46> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    await Promise.all(\n      (await helper.getAccounts()).map(async ({ userId }) => {\n        if (helper.getFromUser(userId, PROMPT_CANCELLED) != null) {\n          await helper.removeFromUser(userId, PROMPT_CANCELLED);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedGlobalType = {\n  window?: object;\n  enableTray?: boolean;\n  enableMinimizeToTray?: boolean;\n  enableCloseToTray?: boolean;\n  enableStartToTray?: boolean;\n  openAtLogin?: boolean;\n  alwaysShowDock?: boolean;\n  enableAlwaysOnTop?: boolean;\n};\n\ntype ExpectedAccountType = {\n  settings?: {\n    enableAlwaysOnTop?: boolean;\n  };\n};\n\nconst DESKTOP_SETTINGS_STATE: StateDefinitionLike = { name: \"desktopSettings\" };\n\nconst WINDOW_KEY: KeyDefinitionLike = { key: \"window\", stateDefinition: DESKTOP_SETTINGS_STATE };\n\nconst CLOSE_TO_TRAY_KEY: KeyDefinitionLike = {\n  key: \"closeToTray\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\nconst MINIMIZE_TO_TRAY_KEY: KeyDefinitionLike = {\n  key: \"minimizeToTray\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\nconst START_TO_TRAY_KEY: KeyDefinitionLike = {\n  key: \"startToTray\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\nconst TRAY_ENABLED_KEY: KeyDefinitionLike = {\n  key: \"trayEnabled\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\nconst OPEN_AT_LOGIN_KEY: KeyDefinitionLike = {\n  key: \"openAtLogin\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\nconst ALWAYS_SHOW_DOCK_KEY: KeyDefinitionLike = {\n  key: \"alwaysShowDock\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\n\nconst ALWAYS_ON_TOP_KEY: KeyDefinitionLike = {\n  key: \"alwaysOnTop\",\n  stateDefinition: DESKTOP_SETTINGS_STATE,\n};\n\nexport class MoveDesktopSettingsMigrator extends Migrator<46, 47> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n\n    let updatedGlobal = false;\n    if (legacyGlobal?.window !== undefined) {\n      await helper.setToGlobal(WINDOW_KEY, legacyGlobal.window);\n      updatedGlobal = true;\n      delete legacyGlobal.window;\n    }\n\n    if (legacyGlobal?.enableCloseToTray != null) {\n      await helper.setToGlobal(CLOSE_TO_TRAY_KEY, legacyGlobal.enableCloseToTray);\n      updatedGlobal = true;\n      delete legacyGlobal.enableCloseToTray;\n    }\n\n    if (legacyGlobal?.enableMinimizeToTray != null) {\n      await helper.setToGlobal(MINIMIZE_TO_TRAY_KEY, legacyGlobal.enableMinimizeToTray);\n      updatedGlobal = true;\n      delete legacyGlobal.enableMinimizeToTray;\n    }\n\n    if (legacyGlobal?.enableStartToTray != null) {\n      await helper.setToGlobal(START_TO_TRAY_KEY, legacyGlobal.enableStartToTray);\n      updatedGlobal = true;\n      delete legacyGlobal.enableStartToTray;\n    }\n\n    if (legacyGlobal?.enableTray != null) {\n      await helper.setToGlobal(TRAY_ENABLED_KEY, legacyGlobal.enableTray);\n      updatedGlobal = true;\n      delete legacyGlobal.enableTray;\n    }\n\n    if (legacyGlobal?.openAtLogin != null) {\n      await helper.setToGlobal(OPEN_AT_LOGIN_KEY, legacyGlobal.openAtLogin);\n      updatedGlobal = true;\n      delete legacyGlobal.openAtLogin;\n    }\n\n    if (legacyGlobal?.alwaysShowDock != null) {\n      await helper.setToGlobal(ALWAYS_SHOW_DOCK_KEY, legacyGlobal.alwaysShowDock);\n      updatedGlobal = true;\n      delete legacyGlobal.alwaysShowDock;\n    }\n\n    if (legacyGlobal?.enableAlwaysOnTop != null) {\n      await helper.setToGlobal(ALWAYS_ON_TOP_KEY, legacyGlobal.enableAlwaysOnTop);\n      updatedGlobal = true;\n      delete legacyGlobal.enableAlwaysOnTop;\n    }\n\n    if (updatedGlobal) {\n      await helper.set(\"global\", legacyGlobal);\n    }\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType) {\n      // We only migrate the global setting for this, if we find it on the account object\n      // just delete it.\n      if (account?.settings?.enableAlwaysOnTop != null) {\n        delete account.settings.enableAlwaysOnTop;\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    await Promise.all(accounts.map(({ userId, account }) => migrateAccount(userId, account)));\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobal = {\n  enableDuckDuckGoBrowserIntegration?: boolean;\n};\n\nexport const DDG_KEY: KeyDefinitionLike = {\n  key: \"enableDuckDuckGoBrowserIntegration\",\n  stateDefinition: {\n    name: \"autofillSettings\",\n  },\n};\n\nexport class MoveDdgToStateProviderMigrator extends Migrator<47, 48> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // global state\n    const global = await helper.get<ExpectedGlobal>(\"global\");\n    if (global?.enableDuckDuckGoBrowserIntegration == null) {\n      return;\n    }\n\n    await helper.setToGlobal(DDG_KEY, global.enableDuckDuckGoBrowserIntegration);\n    delete global.enableDuckDuckGoBrowserIntegration;\n    await helper.set(\"global\", global);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const enableDdg = await helper.getFromGlobal<boolean>(DDG_KEY);\n\n    if (!enableDdg) {\n      return;\n    }\n\n    const global = (await helper.get<ExpectedGlobal>(\"global\")) ?? {};\n    global.enableDuckDuckGoBrowserIntegration = enableDdg;\n    await helper.set(\"global\", global);\n    await helper.removeFromGlobal(DDG_KEY);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nconst CONFIG_DISK: StateDefinitionLike = { name: \"config\" };\nexport const USER_SERVER_CONFIG: KeyDefinitionLike = {\n  stateDefinition: CONFIG_DISK,\n  key: \"serverConfig\",\n};\n\n// Note: no need to migrate global configs, they don't currently exist\n\ntype ExpectedAccountType = {\n  settings?: {\n    serverConfig?: unknown;\n  };\n};\n\nexport class AccountServerConfigMigrator extends Migrator<48, 49> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      if (account?.settings?.serverConfig != null) {\n        await helper.setToUser(userId, USER_SERVER_CONFIG, account.settings.serverConfig);\n        delete account.settings.serverConfig;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const serverConfig = await helper.getFromUser(userId, USER_SERVER_CONFIG);\n\n      if (serverConfig) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.serverConfig = serverConfig;\n        await helper.setToUser(userId, USER_SERVER_CONFIG, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { keys?: { organizationKeys?: { encrypted: Record<string, string> } } };\ntype NewAccountType = {\n  keys?: {\n    organizationKeys?: { encrypted: Record<string, { type: \"organization\"; key: string }> };\n  };\n};\n\nexport class AddKeyTypeToOrgKeysMigrator extends Migrator<4, 5> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts();\n\n    async function updateOrgKey(userId: string, account: ExpectedAccountType) {\n      const encryptedOrgKeys = account?.keys?.organizationKeys?.encrypted;\n      if (encryptedOrgKeys == null) {\n        return;\n      }\n\n      const newOrgKeys: Record<string, { type: \"organization\"; key: string }> = {};\n\n      Object.entries(encryptedOrgKeys).forEach(([orgId, encKey]) => {\n        newOrgKeys[orgId] = {\n          type: \"organization\",\n          key: encKey,\n        };\n      });\n      (account as any).keys.organizationKeys.encrypted = newOrgKeys;\n\n      await helper.set(userId, account);\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(({ userId, account }) => updateOrgKey(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts();\n\n    async function updateOrgKey(userId: string, account: NewAccountType) {\n      const encryptedOrgKeys = account?.keys?.organizationKeys?.encrypted;\n      if (encryptedOrgKeys == null) {\n        return;\n      }\n\n      const newOrgKeys: Record<string, string> = {};\n\n      Object.entries(encryptedOrgKeys).forEach(([orgId, encKey]) => {\n        newOrgKeys[orgId] = encKey.key;\n      });\n      (account as any).keys.organizationKeys.encrypted = newOrgKeys;\n\n      await helper.set(userId, account);\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(async ({ userId, account }) => updateOrgKey(userId, account)));\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    usesKeyConnector?: boolean;\n    convertAccountToKeyConnector?: boolean;\n  };\n};\n\nconst usesKeyConnectorKeyDefinition: KeyDefinitionLike = {\n  key: \"usesKeyConnector\",\n  stateDefinition: {\n    name: \"keyConnector\",\n  },\n};\n\nconst convertAccountToKeyConnectorKeyDefinition: KeyDefinitionLike = {\n  key: \"convertAccountToKeyConnector\",\n  stateDefinition: {\n    name: \"keyConnector\",\n  },\n};\n\nexport class KeyConnectorMigrator extends Migrator<49, 50> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const usesKeyConnector = account?.profile?.usesKeyConnector;\n      const convertAccountToKeyConnector = account?.profile?.convertAccountToKeyConnector;\n      if (usesKeyConnector == null && convertAccountToKeyConnector == null) {\n        return;\n      }\n      if (usesKeyConnector != null) {\n        await helper.setToUser(userId, usesKeyConnectorKeyDefinition, usesKeyConnector);\n        delete account.profile.usesKeyConnector;\n      }\n      if (convertAccountToKeyConnector != null) {\n        await helper.setToUser(\n          userId,\n          convertAccountToKeyConnectorKeyDefinition,\n          convertAccountToKeyConnector,\n        );\n        delete account.profile.convertAccountToKeyConnector;\n      }\n      await helper.set(userId, account);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const usesKeyConnector: boolean = await helper.getFromUser(\n        userId,\n        usesKeyConnectorKeyDefinition,\n      );\n      const convertAccountToKeyConnector: boolean = await helper.getFromUser(\n        userId,\n        convertAccountToKeyConnectorKeyDefinition,\n      );\n      if (usesKeyConnector == null && convertAccountToKeyConnector == null) {\n        return;\n      }\n      if (usesKeyConnector != null) {\n        account.profile.usesKeyConnector = usesKeyConnector;\n        await helper.setToUser(userId, usesKeyConnectorKeyDefinition, null);\n      }\n      if (convertAccountToKeyConnector != null) {\n        account.profile.convertAccountToKeyConnector = convertAccountToKeyConnector;\n        await helper.setToUser(userId, convertAccountToKeyConnectorKeyDefinition, null);\n      }\n      await helper.set(userId, account);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalState = { rememberedEmail?: string };\n\nconst LOGIN_EMAIL_STATE: StateDefinitionLike = { name: \"loginEmail\" };\n\nconst STORED_EMAIL: KeyDefinitionLike = {\n  key: \"storedEmail\",\n  stateDefinition: LOGIN_EMAIL_STATE,\n};\n\nexport class RememberedEmailMigrator extends Migrator<50, 51> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobal = await helper.get<ExpectedGlobalState>(\"global\");\n\n    // Move global data\n    if (legacyGlobal?.rememberedEmail != null) {\n      await helper.setToGlobal(STORED_EMAIL, legacyGlobal.rememberedEmail);\n    }\n\n    // Delete legacy global data\n    delete legacyGlobal?.rememberedEmail;\n    await helper.set(\"global\", legacyGlobal);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let legacyGlobal = await helper.get<ExpectedGlobalState>(\"global\");\n    let updatedLegacyGlobal = false;\n    const globalStoredEmail = await helper.getFromGlobal<string>(STORED_EMAIL);\n\n    if (globalStoredEmail) {\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n\n      updatedLegacyGlobal = true;\n      legacyGlobal.rememberedEmail = globalStoredEmail;\n      await helper.setToGlobal(STORED_EMAIL, null);\n    }\n\n    if (updatedLegacyGlobal) {\n      await helper.set(\"global\", legacyGlobal);\n    }\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedGlobal = {\n  installedVersion?: string;\n};\n\nexport class DeleteInstalledVersion extends Migrator<51, 52> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobal = await helper.get<ExpectedGlobal>(\"global\");\n    if (legacyGlobal?.installedVersion != null) {\n      delete legacyGlobal.installedVersion;\n      await helper.set(\"global\", legacyGlobal);\n    }\n  }\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n// Types to represent data as it is stored in JSON\ntype DeviceKeyJsonType = {\n  keyB64: string;\n};\n\ntype ExpectedAccountType = {\n  keys?: {\n    deviceKey?: DeviceKeyJsonType;\n  };\n  settings?: {\n    trustDeviceChoiceForDecryption?: boolean;\n  };\n};\n\nexport const DEVICE_KEY: KeyDefinitionLike = {\n  key: \"deviceKey\", // matches KeyDefinition.key in DeviceTrustService\n  stateDefinition: {\n    name: \"deviceTrust\", // matches StateDefinition.name in StateDefinitions\n  },\n};\n\nexport const SHOULD_TRUST_DEVICE: KeyDefinitionLike = {\n  key: \"shouldTrustDevice\",\n  stateDefinition: {\n    name: \"deviceTrust\",\n  },\n};\n\nexport class DeviceTrustServiceStateProviderMigrator extends Migrator<52, 53> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedAccount = false;\n\n      // Migrate deviceKey\n      const existingDeviceKey = account?.keys?.deviceKey;\n\n      if (existingDeviceKey != null) {\n        // Only migrate data that exists\n        await helper.setToUser(userId, DEVICE_KEY, existingDeviceKey);\n        delete account.keys.deviceKey;\n        updatedAccount = true;\n      }\n\n      // Migrate shouldTrustDevice\n      const existingShouldTrustDevice = account?.settings?.trustDeviceChoiceForDecryption;\n\n      if (existingShouldTrustDevice != null) {\n        await helper.setToUser(userId, SHOULD_TRUST_DEVICE, existingShouldTrustDevice);\n        delete account.settings.trustDeviceChoiceForDecryption;\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        // Save the migrated account\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      // Rollback deviceKey\n      const migratedDeviceKey: DeviceKeyJsonType = await helper.getFromUser(userId, DEVICE_KEY);\n\n      if (account?.keys && migratedDeviceKey != null) {\n        account.keys.deviceKey = migratedDeviceKey;\n        await helper.set(userId, account);\n      }\n\n      await helper.setToUser(userId, DEVICE_KEY, null);\n\n      // Rollback shouldTrustDevice\n      const migratedShouldTrustDevice = await helper.getFromUser<boolean>(\n        userId,\n        SHOULD_TRUST_DEVICE,\n      );\n\n      if (account?.settings && migratedShouldTrustDevice != null) {\n        account.settings.trustDeviceChoiceForDecryption = migratedShouldTrustDevice;\n        await helper.set(userId, account);\n      }\n\n      await helper.setToUser(userId, SHOULD_TRUST_DEVICE, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nexport enum SendType {\n  Text = 0,\n  File = 1,\n}\n\ntype SendData = {\n  id: string;\n  accessId: string;\n};\n\ntype ExpectedSendState = {\n  data?: {\n    sends?: {\n      encrypted?: Record<string, SendData>;\n    };\n  };\n};\n\nconst ENCRYPTED_SENDS: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"send\",\n  },\n  key: \"sends\",\n};\n\n/**\n * Only encrypted sends are stored on disk. Only the encrypted items need to be\n * migrated from the previous sends state data.\n */\nexport class SendMigrator extends Migrator<53, 54> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedSendState>();\n\n    async function migrateAccount(userId: string, account: ExpectedSendState): Promise<void> {\n      const value = account?.data?.sends?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, ENCRYPTED_SENDS, value);\n        delete account.data.sends;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedSendState>();\n\n    async function rollbackAccount(userId: string, account: ExpectedSendState): Promise<void> {\n      const value = await helper.getFromUser(userId, ENCRYPTED_SENDS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          sends: {\n            encrypted: value,\n          },\n        });\n\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, ENCRYPTED_SENDS, null);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  keys?: {\n    masterKeyEncryptedUserKey?: string;\n  };\n  profile?: {\n    forceSetPasswordReason?: number;\n    keyHash?: string;\n  };\n};\n\nexport const FORCE_SET_PASSWORD_REASON_DEFINITION: KeyDefinitionLike = {\n  key: \"forceSetPasswordReason\",\n  stateDefinition: {\n    name: \"masterPassword\",\n  },\n};\n\nexport const MASTER_KEY_HASH_DEFINITION: KeyDefinitionLike = {\n  key: \"masterKeyHash\",\n  stateDefinition: {\n    name: \"masterPassword\",\n  },\n};\n\nexport const MASTER_KEY_ENCRYPTED_USER_KEY_DEFINITION: KeyDefinitionLike = {\n  key: \"masterKeyEncryptedUserKey\",\n  stateDefinition: {\n    name: \"masterPassword\",\n  },\n};\n\nexport class MoveMasterKeyStateToProviderMigrator extends Migrator<54, 55> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const forceSetPasswordReason = account?.profile?.forceSetPasswordReason;\n      if (forceSetPasswordReason != null) {\n        await helper.setToUser(\n          userId,\n          FORCE_SET_PASSWORD_REASON_DEFINITION,\n          forceSetPasswordReason,\n        );\n\n        delete account.profile.forceSetPasswordReason;\n        await helper.set(userId, account);\n      }\n\n      const masterKeyHash = account?.profile?.keyHash;\n      if (masterKeyHash != null) {\n        await helper.setToUser(userId, MASTER_KEY_HASH_DEFINITION, masterKeyHash);\n\n        delete account.profile.keyHash;\n        await helper.set(userId, account);\n      }\n\n      const masterKeyEncryptedUserKey = account?.keys?.masterKeyEncryptedUserKey;\n      if (masterKeyEncryptedUserKey != null) {\n        await helper.setToUser(\n          userId,\n          MASTER_KEY_ENCRYPTED_USER_KEY_DEFINITION,\n          masterKeyEncryptedUserKey,\n        );\n\n        delete account.keys.masterKeyEncryptedUserKey;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const forceSetPasswordReason = await helper.getFromUser(\n        userId,\n        FORCE_SET_PASSWORD_REASON_DEFINITION,\n      );\n      const masterKeyHash = await helper.getFromUser(userId, MASTER_KEY_HASH_DEFINITION);\n      const masterKeyEncryptedUserKey = await helper.getFromUser(\n        userId,\n        MASTER_KEY_ENCRYPTED_USER_KEY_DEFINITION,\n      );\n      if (account != null) {\n        if (forceSetPasswordReason != null) {\n          account.profile = Object.assign(account.profile ?? {}, {\n            forceSetPasswordReason,\n          });\n        }\n        if (masterKeyHash != null) {\n          account.profile = Object.assign(account.profile ?? {}, {\n            keyHash: masterKeyHash,\n          });\n        }\n        if (masterKeyEncryptedUserKey != null) {\n          account.keys = Object.assign(account.keys ?? {}, {\n            masterKeyEncryptedUserKey,\n          });\n        }\n        await helper.set(userId, account);\n      }\n\n      await helper.setToUser(userId, FORCE_SET_PASSWORD_REASON_DEFINITION, null);\n      await helper.setToUser(userId, MASTER_KEY_HASH_DEFINITION, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype AdminAuthRequestStorable = {\n  id: string;\n  privateKey: string;\n};\n\ntype ExpectedAccountType = {\n  adminAuthRequest?: AdminAuthRequestStorable;\n  settings?: {\n    approveLoginRequests?: boolean;\n  };\n};\n\nconst ADMIN_AUTH_REQUEST_KEY: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"authRequestLocal\",\n  },\n  key: \"adminAuthRequest\",\n};\n\nconst ACCEPT_AUTH_REQUESTS_KEY: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"authRequestLocal\",\n  },\n  key: \"acceptAuthRequests\",\n};\n\nexport class AuthRequestMigrator extends Migrator<55, 56> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedAccount = false;\n\n      // Migrate admin auth request\n      const existingAdminAuthRequest = account?.adminAuthRequest;\n\n      if (existingAdminAuthRequest != null) {\n        await helper.setToUser(userId, ADMIN_AUTH_REQUEST_KEY, existingAdminAuthRequest);\n        delete account.adminAuthRequest;\n        updatedAccount = true;\n      }\n\n      // Migrate approve login requests\n      const existingApproveLoginRequests = account?.settings?.approveLoginRequests;\n\n      if (existingApproveLoginRequests != null) {\n        await helper.setToUser(userId, ACCEPT_AUTH_REQUESTS_KEY, existingApproveLoginRequests);\n        delete account.settings.approveLoginRequests;\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        // Save the migrated account\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedAccount = false;\n      // Rollback admin auth request\n      const migratedAdminAuthRequest: AdminAuthRequestStorable = await helper.getFromUser(\n        userId,\n        ADMIN_AUTH_REQUEST_KEY,\n      );\n\n      if (migratedAdminAuthRequest != null) {\n        account.adminAuthRequest = migratedAdminAuthRequest;\n        updatedAccount = true;\n      }\n\n      await helper.setToUser(userId, ADMIN_AUTH_REQUEST_KEY, null);\n\n      // Rollback approve login requests\n      const migratedAcceptAuthRequest: boolean = await helper.getFromUser(\n        userId,\n        ACCEPT_AUTH_REQUESTS_KEY,\n      );\n\n      if (migratedAcceptAuthRequest != null) {\n        account.settings = Object.assign(account.settings ?? {}, {\n          approveLoginRequests: migratedAcceptAuthRequest,\n        });\n        updatedAccount = true;\n      }\n\n      await helper.setToUser(userId, ACCEPT_AUTH_REQUESTS_KEY, null);\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  data: {\n    localData?: unknown;\n    ciphers?: {\n      encrypted: unknown;\n    };\n  };\n};\n\nexport const CIPHERS_DISK_LOCAL: KeyDefinitionLike = {\n  key: \"localData\",\n  stateDefinition: {\n    name: \"ciphersLocal\",\n  },\n};\n\nexport const CIPHERS_DISK: KeyDefinitionLike = {\n  key: \"ciphers\",\n  stateDefinition: {\n    name: \"ciphers\",\n  },\n};\n\nexport class CipherServiceMigrator extends Migrator<56, 57> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedAccount = false;\n\n      //Migrate localData\n      const localData = account?.data?.localData;\n      if (localData != null) {\n        await helper.setToUser(userId, CIPHERS_DISK_LOCAL, localData);\n        delete account.data.localData;\n        updatedAccount = true;\n      }\n\n      //Migrate ciphers\n      const ciphers = account?.data?.ciphers?.encrypted;\n      if (ciphers != null) {\n        await helper.setToUser(userId, CIPHERS_DISK, ciphers);\n        delete account.data.ciphers;\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      //rollback localData\n      const localData = await helper.getFromUser(userId, CIPHERS_DISK_LOCAL);\n\n      if (account.data && localData != null) {\n        account.data.localData = localData;\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, CIPHERS_DISK_LOCAL, null);\n\n      //rollback ciphers\n      const ciphers = await helper.getFromUser(userId, CIPHERS_DISK);\n\n      if (account.data && ciphers != null) {\n        account.data.ciphers ||= { encrypted: null };\n        account.data.ciphers.encrypted = ciphers;\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, CIPHERS_DISK, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = NonNullable<unknown>;\n\nexport const REFRESH_TOKEN_MIGRATED_TO_SECURE_STORAGE: KeyDefinitionLike = {\n  key: \"refreshTokenMigratedToSecureStorage\", // matches KeyDefinition.key\n  stateDefinition: {\n    name: \"token\", // matches StateDefinition.name in StateDefinitions\n  },\n};\n\nexport class RemoveRefreshTokenMigratedFlagMigrator extends Migrator<57, 58> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const refreshTokenMigratedFlag = await helper.getFromUser(\n        userId,\n        REFRESH_TOKEN_MIGRATED_TO_SECURE_STORAGE,\n      );\n\n      if (refreshTokenMigratedFlag != null) {\n        // Only delete the flag if it exists\n        await helper.removeFromUser(userId, REFRESH_TOKEN_MIGRATED_TO_SECURE_STORAGE);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nenum KdfType {\n  PBKDF2_SHA256 = 0,\n  Argon2id = 1,\n}\n\nclass KdfConfig {\n  iterations: number;\n  kdfType: KdfType;\n  memory?: number;\n  parallelism?: number;\n}\n\ntype ExpectedAccountType = {\n  profile?: {\n    kdfIterations: number;\n    kdfType: KdfType;\n    kdfMemory?: number;\n    kdfParallelism?: number;\n  };\n};\n\nconst kdfConfigKeyDefinition: KeyDefinitionLike = {\n  key: \"kdfConfig\",\n  stateDefinition: {\n    name: \"kdfConfig\",\n  },\n};\n\nexport class KdfConfigMigrator extends Migrator<58, 59> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const iterations = account?.profile?.kdfIterations;\n      const kdfType = account?.profile?.kdfType;\n      const memory = account?.profile?.kdfMemory;\n      const parallelism = account?.profile?.kdfParallelism;\n\n      const kdfConfig: KdfConfig = {\n        iterations: iterations,\n        kdfType: kdfType,\n        memory: memory,\n        parallelism: parallelism,\n      };\n\n      if (kdfConfig != null) {\n        await helper.setToUser(userId, kdfConfigKeyDefinition, kdfConfig);\n        delete account?.profile?.kdfIterations;\n        delete account?.profile?.kdfType;\n        delete account?.profile?.kdfMemory;\n        delete account?.profile?.kdfParallelism;\n      }\n\n      await helper.set(userId, account);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const kdfConfig: KdfConfig = await helper.getFromUser(userId, kdfConfigKeyDefinition);\n\n      if (kdfConfig != null) {\n        account.profile.kdfIterations = kdfConfig.iterations;\n        account.profile.kdfType = kdfConfig.kdfType;\n        account.profile.kdfMemory = kdfConfig.memory;\n        account.profile.kdfParallelism = kdfConfig.parallelism;\n        await helper.setToUser(userId, kdfConfigKeyDefinition, null);\n      }\n      await helper.set(userId, account);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { keys?: { legacyEtmKey?: string } };\n\nexport class RemoveLegacyEtmKeyMigrator extends Migrator<5, 6> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function updateAccount(userId: string, account: ExpectedAccountType) {\n      if (account?.keys?.legacyEtmKey) {\n        delete account.keys.legacyEtmKey;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => updateAccount(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\nexport const ACCOUNT_ACCOUNTS: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"account\",\n  },\n  key: \"accounts\",\n};\n\nexport const ACCOUNT_ACTIVE_ACCOUNT_ID: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"account\",\n  },\n  key: \"activeAccountId\",\n};\n\nexport const ACCOUNT_ACTIVITY: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"account\",\n  },\n  key: \"activity\",\n};\n\ntype ExpectedAccountType = {\n  profile?: {\n    email?: string;\n    name?: string;\n    emailVerified?: boolean;\n  };\n};\n\nexport class KnownAccountsMigrator extends Migrator<59, 60> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    await this.migrateAuthenticatedAccounts(helper);\n    await this.migrateActiveAccountId(helper);\n    await this.migrateAccountActivity(helper);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // authenticated account are removed, but the accounts record also contains logged out accounts. Best we can do is to add them all back\n    const userIds = (await helper.getKnownUserIds()) ?? [];\n    await helper.set(\"authenticatedAccounts\", userIds);\n    await helper.removeFromGlobal(ACCOUNT_ACCOUNTS);\n\n    // Active Account Id\n    const activeAccountId = await helper.getFromGlobal<string>(ACCOUNT_ACTIVE_ACCOUNT_ID);\n    if (activeAccountId) {\n      await helper.set(\"activeUserId\", activeAccountId);\n    }\n    await helper.removeFromGlobal(ACCOUNT_ACTIVE_ACCOUNT_ID);\n\n    // Account Activity\n    const accountActivity = await helper.getFromGlobal<Record<string, string>>(ACCOUNT_ACTIVITY);\n    if (accountActivity) {\n      const toStore = Object.entries(accountActivity).reduce(\n        (agg, [userId, dateString]) => {\n          agg[userId] = new Date(dateString).getTime();\n          return agg;\n        },\n        {} as Record<string, number>,\n      );\n      await helper.set(\"accountActivity\", toStore);\n    }\n    await helper.removeFromGlobal(ACCOUNT_ACTIVITY);\n  }\n\n  private async migrateAuthenticatedAccounts(helper: MigrationHelper) {\n    const authenticatedAccounts = (await helper.get<string[]>(\"authenticatedAccounts\")) ?? [];\n    const accounts = await Promise.all(\n      authenticatedAccounts.map(async (userId) => {\n        const account = await helper.get<ExpectedAccountType>(userId);\n        return { userId, account };\n      }),\n    );\n    const accountsToStore = accounts.reduce(\n      (agg, { userId, account }) => {\n        if (account?.profile) {\n          agg[userId] = {\n            email: account.profile.email ?? \"\",\n            emailVerified: account.profile.emailVerified ?? false,\n            name: account.profile.name,\n          };\n        }\n        return agg;\n      },\n      {} as Record<string, { email: string; emailVerified: boolean; name: string | undefined }>,\n    );\n\n    await helper.setToGlobal(ACCOUNT_ACCOUNTS, accountsToStore);\n    await helper.remove(\"authenticatedAccounts\");\n  }\n\n  private async migrateAccountActivity(helper: MigrationHelper) {\n    const stored = await helper.get<Record<string, Date>>(\"accountActivity\");\n    const accountActivity = Object.entries(stored ?? {}).reduce(\n      (agg, [userId, dateMs]) => {\n        agg[userId] = JSON.stringify(new Date(dateMs));\n        return agg;\n      },\n      {} as Record<string, string>,\n    );\n    await helper.setToGlobal(ACCOUNT_ACTIVITY, accountActivity);\n    await helper.remove(\"accountActivity\");\n  }\n\n  private async migrateActiveAccountId(helper: MigrationHelper) {\n    const activeAccountId = await helper.get<string>(\"activeUserId\");\n    await helper.setToGlobal(ACCOUNT_ACTIVE_ACCOUNT_ID, activeAccountId);\n    await helper.remove(\"activeUserId\");\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: {\n    pinKeyEncryptedUserKey?: string; // EncryptedString\n    protectedPin?: string; // EncryptedString\n    pinProtected?: {\n      encrypted?: string;\n    };\n  };\n};\n\nexport const PIN_STATE: StateDefinitionLike = { name: \"pinUnlock\" };\n\nexport const PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT: KeyDefinitionLike = {\n  stateDefinition: PIN_STATE,\n  key: \"pinKeyEncryptedUserKeyPersistent\",\n};\n\nexport const USER_KEY_ENCRYPTED_PIN: KeyDefinitionLike = {\n  stateDefinition: PIN_STATE,\n  key: \"userKeyEncryptedPin\",\n};\n\nexport const OLD_PIN_KEY_ENCRYPTED_MASTER_KEY: KeyDefinitionLike = {\n  stateDefinition: PIN_STATE,\n  key: \"oldPinKeyEncryptedMasterKey\",\n};\n\nexport class PinStateMigrator extends Migrator<60, 61> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountState>();\n    let updatedAccount = false;\n\n    async function migrateAccount(userId: string, account: ExpectedAccountState) {\n      // Migrate pinKeyEncryptedUserKey (to `pinKeyEncryptedUserKeyPersistent`)\n      if (account?.settings?.pinKeyEncryptedUserKey != null) {\n        await helper.setToUser(\n          userId,\n          PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT,\n          account.settings.pinKeyEncryptedUserKey,\n        );\n        delete account.settings.pinKeyEncryptedUserKey;\n        updatedAccount = true;\n      }\n\n      // Migrate protectedPin (to `userKeyEncryptedPin`)\n      if (account?.settings?.protectedPin != null) {\n        await helper.setToUser(userId, USER_KEY_ENCRYPTED_PIN, account.settings.protectedPin);\n        delete account.settings.protectedPin;\n        updatedAccount = true;\n      }\n\n      // Migrate pinProtected (to `oldPinKeyEncryptedMasterKey`)\n      if (account?.settings?.pinProtected?.encrypted != null) {\n        await helper.setToUser(\n          userId,\n          OLD_PIN_KEY_ENCRYPTED_MASTER_KEY,\n          account.settings.pinProtected.encrypted,\n        );\n        delete account.settings.pinProtected;\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([\n      ...legacyAccounts.map(({ userId, account }) => migrateAccount(userId, account)),\n    ]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountState) {\n      let updatedAccount = false;\n\n      const accountPinKeyEncryptedUserKeyPersistent = await helper.getFromUser<string>(\n        userId,\n        PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT,\n      );\n      const accountUserKeyEncryptedPin = await helper.getFromUser<string>(\n        userId,\n        USER_KEY_ENCRYPTED_PIN,\n      );\n      const accountOldPinKeyEncryptedMasterKey = await helper.getFromUser<string>(\n        userId,\n        OLD_PIN_KEY_ENCRYPTED_MASTER_KEY,\n      );\n\n      if (!account) {\n        account = {};\n      }\n\n      if (accountPinKeyEncryptedUserKeyPersistent != null) {\n        account.settings.pinKeyEncryptedUserKey = accountPinKeyEncryptedUserKeyPersistent;\n        await helper.setToUser(userId, PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT, null);\n        updatedAccount = true;\n      }\n\n      if (accountUserKeyEncryptedPin != null) {\n        account.settings.protectedPin = accountUserKeyEncryptedPin;\n        await helper.setToUser(userId, USER_KEY_ENCRYPTED_PIN, null);\n        updatedAccount = true;\n      }\n\n      if (accountOldPinKeyEncryptedMasterKey != null) {\n        account.settings = Object.assign(account.settings ?? {}, {\n          pinProtected: {\n            encrypted: accountOldPinKeyEncryptedMasterKey,\n          },\n        });\n\n        await helper.setToUser(userId, OLD_PIN_KEY_ENCRYPTED_MASTER_KEY, null);\n        updatedAccount = true;\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackAccount(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n// Types to represent data as it is stored in JSON\ntype ExpectedAccountType = {\n  settings?: {\n    vaultTimeout?: number;\n    vaultTimeoutAction?: string;\n  };\n};\n\ntype ExpectedGlobalType = {\n  vaultTimeout?: number;\n  vaultTimeoutAction?: string;\n};\n\nconst VAULT_TIMEOUT_SETTINGS_STATE_DEF_LIKE: StateDefinitionLike = {\n  name: \"vaultTimeoutSettings\",\n};\n\nexport const VAULT_TIMEOUT: KeyDefinitionLike = {\n  key: \"vaultTimeout\", // matches KeyDefinition.key\n  stateDefinition: VAULT_TIMEOUT_SETTINGS_STATE_DEF_LIKE,\n};\n\nexport const VAULT_TIMEOUT_ACTION: KeyDefinitionLike = {\n  key: \"vaultTimeoutAction\", // matches KeyDefinition.key\n  stateDefinition: VAULT_TIMEOUT_SETTINGS_STATE_DEF_LIKE,\n};\n\n// Migrations are supposed to be frozen so we have to copy the type here.\nexport type VaultTimeout =\n  | number // 0 for immediately; otherwise positive numbers\n  | \"never\" // null\n  | \"onRestart\" // -1\n  | \"onLocked\" // -2\n  | \"onSleep\" // -3\n  | \"onIdle\"; // -4\n\n// Define mapping of old values to new values for migration purposes\nconst vaultTimeoutTypeMigrateRecord: Record<any, VaultTimeout> = {\n  null: \"never\",\n  \"-1\": \"onRestart\",\n  \"-2\": \"onLocked\",\n  \"-3\": \"onSleep\",\n  \"-4\": \"onIdle\",\n};\n\n// define mapping of new values to old values for rollback purposes\nconst vaultTimeoutTypeRollbackRecord: Record<VaultTimeout, any> = {\n  never: null,\n  onRestart: -1,\n  onLocked: -2,\n  onSleep: -3,\n  onIdle: -4,\n};\n\nexport enum ClientType {\n  Web = \"web\",\n  Browser = \"browser\",\n  Desktop = \"desktop\",\n  Cli = \"cli\",\n}\n\nexport class VaultTimeoutSettingsServiceStateProviderMigrator extends Migrator<61, 62> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const globalData = await helper.get<ExpectedGlobalType>(\"global\");\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(\n      userId: string,\n      account: ExpectedAccountType | undefined,\n    ): Promise<void> {\n      let updatedAccount = false;\n\n      // Migrate vault timeout\n      let existingVaultTimeout = account?.settings?.vaultTimeout;\n\n      if (helper.clientType === ClientType.Cli && existingVaultTimeout === undefined) {\n        // The CLI does not set a vault timeout by default so we need to set it to null\n        // so that the migration can migrate null to \"never\" as the CLI does not have a vault timeout.\n        existingVaultTimeout = null;\n      }\n\n      if (existingVaultTimeout !== undefined) {\n        // check undefined so that we allow null values (previously meant never timeout)\n        // Only migrate data that exists\n\n        if (existingVaultTimeout === null || existingVaultTimeout < 0) {\n          // Map null or negative values to new string values\n          const newVaultTimeout = vaultTimeoutTypeMigrateRecord[existingVaultTimeout];\n          await helper.setToUser(userId, VAULT_TIMEOUT, newVaultTimeout);\n        } else {\n          // Persist positive numbers as is\n          await helper.setToUser(userId, VAULT_TIMEOUT, existingVaultTimeout);\n        }\n\n        delete account?.settings?.vaultTimeout;\n        updatedAccount = true;\n      }\n\n      // Migrate vault timeout action\n      const existingVaultTimeoutAction = account?.settings?.vaultTimeoutAction;\n\n      if (existingVaultTimeoutAction != null) {\n        // Only migrate data that exists\n        await helper.setToUser(userId, VAULT_TIMEOUT_ACTION, existingVaultTimeoutAction);\n\n        delete account?.settings?.vaultTimeoutAction;\n        updatedAccount = true;\n      }\n\n      // Note: we are explicitly not worrying about mapping over the global fallback vault timeout / action\n      // into the new state provider framework.  It was originally a fallback but hasn't been used for years\n      // so this migration will clean up the global properties fully.\n\n      if (updatedAccount) {\n        // Save the migrated account only if it was updated\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // Delete global data (works for browser extension and web; CLI doesn't have these as global settings).\n    delete globalData?.vaultTimeout;\n    delete globalData?.vaultTimeoutAction;\n    await helper.set(\"global\", globalData);\n\n    // Remove desktop only settings. These aren't found by the above global key removal b/c of\n    // the different storage key format. This removal does not cause any issues on migrating for other clients.\n    await helper.remove(\"global\\\\.vaultTimeout\");\n    await helper.remove(\"global\\\\.vaultTimeoutAction\");\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      let updatedLegacyAccount = false;\n\n      // Rollback vault timeout\n      const migratedVaultTimeout = await helper.getFromUser<VaultTimeout>(userId, VAULT_TIMEOUT);\n\n      if (account?.settings && migratedVaultTimeout != null) {\n        if (typeof migratedVaultTimeout === \"string\") {\n          // Map new string values back to old values\n          account.settings.vaultTimeout = vaultTimeoutTypeRollbackRecord[migratedVaultTimeout];\n        } else {\n          // persist numbers as is\n          account.settings.vaultTimeout = migratedVaultTimeout;\n        }\n\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, VAULT_TIMEOUT, null);\n\n      // Rollback vault timeout action\n      const migratedVaultTimeoutAction = await helper.getFromUser<string>(\n        userId,\n        VAULT_TIMEOUT_ACTION,\n      );\n\n      if (account?.settings && migratedVaultTimeoutAction != null) {\n        account.settings.vaultTimeoutAction = migratedVaultTimeoutAction;\n        updatedLegacyAccount = true;\n      }\n\n      await helper.setToUser(userId, VAULT_TIMEOUT_ACTION, null);\n\n      if (updatedLegacyAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n/** settings targeted by migrator */\nexport type AccountType = {\n  settings?: {\n    passwordGenerationOptions?: ExpectedOptions;\n  };\n};\n\nexport type GeneratorType = \"password\" | \"passphrase\" | \"username\";\n\n/** username generation options prior to refactoring */\nexport type ExpectedOptions = {\n  type?: GeneratorType;\n  length?: number;\n  minLength?: number;\n  ambiguous?: boolean;\n  uppercase?: boolean;\n  minUppercase?: number;\n  lowercase?: boolean;\n  minLowercase?: number;\n  number?: boolean;\n  minNumber?: number;\n  special?: boolean;\n  minSpecial?: number;\n  numWords?: number;\n  wordSeparator?: string;\n  capitalize?: boolean;\n  includeNumber?: boolean;\n};\n\n/** username generation options after refactoring */\ntype ConvertedOptions = {\n  generator: GeneratorNavigation;\n  password: PasswordGenerationOptions;\n  passphrase: PassphraseGenerationOptions;\n};\n\nexport const NAVIGATION: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"generatorSettings\",\n};\n\nexport const PASSWORD: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"passwordGeneratorSettings\",\n};\n\nexport const PASSPHRASE: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"passphraseGeneratorSettings\",\n};\n\nexport type GeneratorNavigation = {\n  type?: string;\n};\n\nexport type PassphraseGenerationOptions = {\n  numWords?: number;\n  wordSeparator?: string;\n  capitalize?: boolean;\n  includeNumber?: boolean;\n};\n\nexport type PasswordGenerationOptions = {\n  length?: number;\n  minLength?: number;\n  ambiguous?: boolean;\n  uppercase?: boolean;\n  minUppercase?: number;\n  lowercase?: boolean;\n  minLowercase?: number;\n  number?: boolean;\n  minNumber?: number;\n  special?: boolean;\n  minSpecial?: number;\n};\n\nexport class PasswordOptionsMigrator extends Migrator<62, 63> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<AccountType>();\n\n    async function migrateAccount(userId: string, account: AccountType) {\n      const legacyOptions = account?.settings?.passwordGenerationOptions;\n\n      if (legacyOptions) {\n        const converted = convertSettings(legacyOptions);\n        await storeSettings(helper, userId, converted);\n        await deleteSettings(helper, userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // not supported\n  }\n}\n\nfunction convertSettings(options: ExpectedOptions): ConvertedOptions {\n  const password = {\n    length: options.length,\n    ambiguous: options.ambiguous,\n    uppercase: options.uppercase,\n    minUppercase: options.minUppercase,\n    lowercase: options.lowercase,\n    minLowercase: options.minLowercase,\n    number: options.number,\n    minNumber: options.minNumber,\n    special: options.special,\n    minSpecial: options.minSpecial,\n  };\n\n  const generator = {\n    type: options.type,\n  };\n\n  const passphrase = {\n    numWords: options.numWords,\n    wordSeparator: options.wordSeparator,\n    capitalize: options.capitalize,\n    includeNumber: options.includeNumber,\n  };\n\n  return { generator, password, passphrase };\n}\n\nasync function storeSettings(helper: MigrationHelper, userId: string, converted: ConvertedOptions) {\n  const existing = (await helper.getFromUser(userId, NAVIGATION)) ?? {};\n  const updated = Object.assign(existing, converted.generator);\n\n  await Promise.all([\n    helper.setToUser(userId, NAVIGATION, updated),\n    helper.setToUser(userId, PASSPHRASE, converted.passphrase),\n    helper.setToUser(userId, PASSWORD, converted.password),\n  ]);\n}\n\nasync function deleteSettings(helper: MigrationHelper, userId: string, account: AccountType) {\n  delete account?.settings?.passwordGenerationOptions;\n  await helper.set(userId, account);\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n/** settings targeted by migrator */\nexport type AccountType = {\n  data?: {\n    passwordGenerationHistory?: {\n      encrypted: EncryptedHistory;\n    };\n  };\n};\n\n/** the actual data stored in the history is opaque to the migrator */\nexport type EncryptedHistory = Array<unknown>;\n\nexport const HISTORY: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"localGeneratorHistoryBuffer\",\n};\n\nexport class GeneratorHistoryMigrator extends Migrator<63, 64> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<AccountType>();\n\n    async function migrateAccount(userId: string, account: AccountType) {\n      const data = account?.data?.passwordGenerationHistory;\n      if (data && data.encrypted) {\n        await helper.setToUser(userId, HISTORY, data.encrypted);\n        delete account.data.passwordGenerationHistory;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // not supported\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\n/** settings targeted by migrator */\nexport type AccountType = {\n  settings?: {\n    usernameGenerationOptions?: ExpectedOptions;\n  };\n};\n\n/** username generation options prior to refactoring */\nexport type ExpectedOptions = {\n  type?: \"word\" | \"subaddress\" | \"catchall\" | \"forwarded\";\n  wordCapitalize?: boolean;\n  wordIncludeNumber?: boolean;\n  subaddressType?: \"random\" | \"website-name\";\n  subaddressEmail?: string;\n  catchallType?: \"random\" | \"website-name\";\n  catchallDomain?: string;\n  forwardedService?: string;\n  forwardedAnonAddyApiToken?: string;\n  forwardedAnonAddyDomain?: string;\n  forwardedAnonAddyBaseUrl?: string;\n  forwardedDuckDuckGoToken?: string;\n  forwardedFirefoxApiToken?: string;\n  forwardedFastmailApiToken?: string;\n  forwardedForwardEmailApiToken?: string;\n  forwardedForwardEmailDomain?: string;\n  forwardedSimpleLoginApiKey?: string;\n  forwardedSimpleLoginBaseUrl?: string;\n};\n\n/** username generation options after refactoring */\ntype ConvertedOptions = {\n  generator: GeneratorNavigation;\n  algorithms: {\n    catchall: CatchallGenerationOptions;\n    effUsername: EffUsernameGenerationOptions;\n    subaddress: SubaddressGenerationOptions;\n  };\n  forwarders: {\n    addyIo: SelfHostedApiOptions & EmailDomainOptions;\n    duckDuckGo: ApiOptions;\n    fastmail: ApiOptions;\n    firefoxRelay: ApiOptions;\n    forwardEmail: ApiOptions & EmailDomainOptions;\n    simpleLogin: SelfHostedApiOptions;\n  };\n};\n\nexport const NAVIGATION: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"generatorSettings\",\n};\n\nexport const CATCHALL: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"catchallGeneratorSettings\",\n};\n\nexport const EFF_USERNAME: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"effUsernameGeneratorSettings\",\n};\n\nexport const SUBADDRESS: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"subaddressGeneratorSettings\",\n};\n\nexport const ADDY_IO: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"addyIoBuffer\",\n};\n\nexport const DUCK_DUCK_GO: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"duckDuckGoBuffer\",\n};\n\nexport const FASTMAIL: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"fastmailBuffer\",\n};\n\nexport const FIREFOX_RELAY: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"firefoxRelayBuffer\",\n};\n\nexport const FORWARD_EMAIL: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"forwardEmailBuffer\",\n};\n\nexport const SIMPLE_LOGIN: KeyDefinitionLike = {\n  stateDefinition: {\n    name: \"generator\",\n  },\n  key: \"simpleLoginBuffer\",\n};\n\nexport type GeneratorNavigation = {\n  type?: string;\n  username?: string;\n  forwarder?: string;\n};\n\ntype UsernameGenerationMode = \"random\" | \"website-name\";\n\ntype CatchallGenerationOptions = {\n  catchallType?: UsernameGenerationMode;\n  catchallDomain?: string;\n};\n\ntype EffUsernameGenerationOptions = {\n  wordCapitalize?: boolean;\n  wordIncludeNumber?: boolean;\n};\n\ntype SubaddressGenerationOptions = {\n  subaddressType?: UsernameGenerationMode;\n  subaddressEmail?: string;\n};\n\ntype ApiOptions = {\n  token?: string;\n};\n\ntype SelfHostedApiOptions = ApiOptions & {\n  baseUrl: string;\n};\n\ntype EmailDomainOptions = {\n  domain: string;\n};\n\nexport class ForwarderOptionsMigrator extends Migrator<64, 65> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<AccountType>();\n\n    async function migrateAccount(userId: string, account: AccountType) {\n      const legacyOptions = account?.settings?.usernameGenerationOptions;\n\n      if (legacyOptions) {\n        const converted = convertSettings(legacyOptions);\n        await storeSettings(helper, userId, converted);\n        await deleteSettings(helper, userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // not supported\n  }\n}\n\nfunction convertSettings(options: ExpectedOptions): ConvertedOptions {\n  const forwarders = {\n    addyIo: {\n      baseUrl: options.forwardedAnonAddyBaseUrl,\n      token: options.forwardedAnonAddyApiToken,\n      domain: options.forwardedAnonAddyDomain,\n    },\n    duckDuckGo: {\n      token: options.forwardedDuckDuckGoToken,\n    },\n    fastmail: {\n      token: options.forwardedFastmailApiToken,\n    },\n    firefoxRelay: {\n      token: options.forwardedFirefoxApiToken,\n    },\n    forwardEmail: {\n      token: options.forwardedForwardEmailApiToken,\n      domain: options.forwardedForwardEmailDomain,\n    },\n    simpleLogin: {\n      token: options.forwardedSimpleLoginApiKey,\n      baseUrl: options.forwardedSimpleLoginBaseUrl,\n    },\n  };\n\n  const generator = {\n    username: options.type,\n    forwarder: options.forwardedService,\n  };\n\n  const algorithms = {\n    effUsername: {\n      wordCapitalize: options.wordCapitalize,\n      wordIncludeNumber: options.wordIncludeNumber,\n    },\n    subaddress: {\n      subaddressType: options.subaddressType,\n      subaddressEmail: options.subaddressEmail,\n    },\n    catchall: {\n      catchallType: options.catchallType,\n      catchallDomain: options.catchallDomain,\n    },\n  };\n\n  return { generator, algorithms, forwarders };\n}\n\nasync function storeSettings(helper: MigrationHelper, userId: string, converted: ConvertedOptions) {\n  await Promise.all([\n    helper.setToUser(userId, NAVIGATION, converted.generator),\n    helper.setToUser(userId, CATCHALL, converted.algorithms.catchall),\n    helper.setToUser(userId, EFF_USERNAME, converted.algorithms.effUsername),\n    helper.setToUser(userId, SUBADDRESS, converted.algorithms.subaddress),\n    helper.setToUser(userId, ADDY_IO, converted.forwarders.addyIo),\n    helper.setToUser(userId, DUCK_DUCK_GO, converted.forwarders.duckDuckGo),\n    helper.setToUser(userId, FASTMAIL, converted.forwarders.fastmail),\n    helper.setToUser(userId, FIREFOX_RELAY, converted.forwarders.firefoxRelay),\n    helper.setToUser(userId, FORWARD_EMAIL, converted.forwarders.forwardEmail),\n    helper.setToUser(userId, SIMPLE_LOGIN, converted.forwarders.simpleLogin),\n  ]);\n}\n\nasync function deleteSettings(helper: MigrationHelper, userId: string, account: AccountType) {\n  delete account?.settings?.usernameGenerationOptions;\n  await helper.set(userId, account);\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { settings?: { disableAutoBiometricsPrompt?: boolean } };\n\nexport class MoveBiometricAutoPromptToAccount extends Migrator<6, 7> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<{ noAutoPromptBiometrics?: boolean }>(\"global\");\n    const noAutoPromptBiometrics = global?.noAutoPromptBiometrics ?? false;\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function updateAccount(userId: string, account: ExpectedAccountType) {\n      if (account == null) {\n        return;\n      }\n\n      if (noAutoPromptBiometrics) {\n        account.settings = Object.assign(account?.settings ?? {}, {\n          disableAutoBiometricsPrompt: true,\n        });\n        await helper.set(userId, account);\n      }\n    }\n\n    delete global.noAutoPromptBiometrics;\n\n    await Promise.all([\n      ...accounts.map(({ userId, account }) => updateAccount(userId, account)),\n      helper.set(\"global\", global),\n    ]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { JsonObject } from \"type-fest\";\n\nimport { MigrationHelper } from \"../migration-helper\";\nimport { Direction, Migrator } from \"../migrator\";\n\nexport class MoveStateVersionMigrator extends Migrator<7, 8> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<{ stateVersion: number }>(\"global\");\n    if (global.stateVersion) {\n      await helper.set(\"stateVersion\", global.stateVersion);\n      delete global.stateVersion;\n      await helper.set(\"global\", global);\n    } else {\n      throw new Error(\"Migration failed, state version not found\");\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const version = await helper.get<number>(\"stateVersion\");\n    const global = await helper.get<JsonObject>(\"global\");\n    await helper.set(\"global\", { ...global, stateVersion: version });\n    await helper.set(\"stateVersion\", undefined);\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but this migration moves\n  // it from a `global` object to root.This makes for unique rollback versioning.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    if (direction === \"up\") {\n      await helper.set(\"stateVersion\", endVersion);\n    } else {\n      const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n      await helper.set(\"global\", { ...global, stateVersion: endVersion });\n    }\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype NeverDomains = { [id: string]: unknown };\n\ntype ExpectedAccountType = {\n  settings?: {\n    neverDomains?: NeverDomains;\n    disableAddLoginNotification?: boolean;\n    disableChangedPasswordNotification?: boolean;\n    disableContextMenuItem?: boolean;\n  };\n};\n\ntype TargetGlobalState = {\n  neverDomains?: NeverDomains;\n  disableAddLoginNotification?: boolean;\n  disableChangedPasswordNotification?: boolean;\n  disableContextMenuItem?: boolean;\n};\n\nexport class MoveBrowserSettingsToGlobal extends Migrator<8, 9> {\n  // Will first check if any of the accounts have a value from the given accountSelector\n  // if they do have a value it will set that value into global state but if multiple\n  // users have differing values it will prefer the false setting,\n  // if all users have true then it will take true.\n  tryAddSetting(\n    accounts: { userId: string; account: ExpectedAccountType }[],\n    accountSelector: (account: ExpectedAccountType) => boolean | undefined,\n    globalSetter: (value: boolean | undefined) => void,\n  ): void {\n    const hasValue = accounts.some(({ account }) => {\n      return accountSelector(account) !== undefined;\n    });\n\n    if (hasValue) {\n      const value = !accounts.some(({ account }) => {\n        return (accountSelector(account) ?? false) === false;\n      });\n\n      globalSetter(value);\n    }\n  }\n\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<object>(\"global\");\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    const globalNeverDomainsValue = accounts.reduce((accumulator, { account }) => {\n      const normalizedNeverDomains = account.settings?.neverDomains ?? {};\n      for (const [id, value] of Object.entries(normalizedNeverDomains)) {\n        accumulator ??= {};\n        accumulator[id] = value;\n      }\n      return accumulator;\n    }, undefined as NeverDomains);\n\n    const targetGlobalState: TargetGlobalState = {};\n\n    if (globalNeverDomainsValue != null) {\n      targetGlobalState.neverDomains = globalNeverDomainsValue;\n    }\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableAddLoginNotification,\n      (v) => (targetGlobalState.disableAddLoginNotification = v),\n    );\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableChangedPasswordNotification,\n      (v) => (targetGlobalState.disableChangedPasswordNotification = v),\n    );\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableContextMenuItem,\n      (v) => (targetGlobalState.disableContextMenuItem = v),\n    );\n\n    await helper.set<TargetGlobalState>(\"global\", {\n      ...global,\n      ...targetGlobalState,\n    });\n\n    await Promise.all(\n      accounts.map(async ({ userId, account }) => {\n        delete account.settings?.disableAddLoginNotification;\n        delete account.settings?.disableChangedPasswordNotification;\n        delete account.settings?.disableContextMenuItem;\n        delete account.settings?.neverDomains;\n        await helper.set(userId, account);\n      }),\n    );\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw new Error(\"Method not implemented.\");\n  }\n}\n","import { MinVersion, MIN_VERSION } from \"../migrate\";\nimport { MigrationHelper } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\nexport function minVersionError(current: number) {\n  return `Your local data is too old to be migrated. Your current state version is ${current}, but minimum version is ${MIN_VERSION}.`;\n}\n\nexport class MinVersionMigrator extends Migrator<0, MinVersion> {\n  constructor() {\n    super(0, MIN_VERSION);\n  }\n\n  // Overrides the default implementation to catch any version that may be passed in.\n  override shouldMigrate(helper: MigrationHelper): Promise<boolean> {\n    return Promise.resolve(helper.currentVersion < MIN_VERSION);\n  }\n  async migrate(helper: MigrationHelper): Promise<void> {\n    if (helper.currentVersion < MIN_VERSION) {\n      throw new Error(minVersionError(helper.currentVersion));\n    }\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Needed to print log messages\nimport { LogService } from \"../platform/abstractions/log.service\";\n// eslint-disable-next-line import/no-restricted-paths -- Needed to interface with storage locations\nimport { AbstractStorageService } from \"../platform/abstractions/storage.service\";\n\nimport { MigrationBuilder } from \"./migration-builder\";\nimport { EverHadUserKeyMigrator } from \"./migrations/10-move-ever-had-user-key-to-state-providers\";\nimport { OrganizationKeyMigrator } from \"./migrations/11-move-org-keys-to-state-providers\";\nimport { MoveEnvironmentStateToProviders } from \"./migrations/12-move-environment-state-to-providers\";\nimport { ProviderKeyMigrator } from \"./migrations/13-move-provider-keys-to-state-providers\";\nimport { MoveBiometricClientKeyHalfToStateProviders } from \"./migrations/14-move-biometric-client-key-half-state-to-providers\";\nimport { FolderMigrator } from \"./migrations/15-move-folder-state-to-state-provider\";\nimport { LastSyncMigrator } from \"./migrations/16-move-last-sync-to-state-provider\";\nimport { EnablePasskeysMigrator } from \"./migrations/17-move-enable-passkeys-to-state-providers\";\nimport { AutofillSettingsKeyMigrator } from \"./migrations/18-move-autofill-settings-to-state-providers\";\nimport { RequirePasswordOnStartMigrator } from \"./migrations/19-migrate-require-password-on-start\";\nimport { PrivateKeyMigrator } from \"./migrations/20-move-private-key-to-state-providers\";\nimport { CollectionMigrator } from \"./migrations/21-move-collections-state-to-state-provider\";\nimport { CollapsedGroupingsMigrator } from \"./migrations/22-move-collapsed-groupings-to-state-provider\";\nimport { MoveBiometricPromptsToStateProviders } from \"./migrations/23-move-biometric-prompts-to-state-providers\";\nimport { SmOnboardingTasksMigrator } from \"./migrations/24-move-sm-onboarding-key-to-state-providers\";\nimport { ClearClipboardDelayMigrator } from \"./migrations/25-move-clear-clipboard-to-autofill-settings-state-provider\";\nimport { RevertLastSyncMigrator } from \"./migrations/26-revert-move-last-sync-to-state-provider\";\nimport { BadgeSettingsMigrator } from \"./migrations/27-move-badge-settings-to-state-providers\";\nimport { MoveBiometricUnlockToStateProviders } from \"./migrations/28-move-biometric-unlock-to-state-providers\";\nimport { UserNotificationSettingsKeyMigrator } from \"./migrations/29-move-user-notification-settings-to-state-provider\";\nimport { PolicyMigrator } from \"./migrations/30-move-policy-state-to-state-provider\";\nimport { EnableContextMenuMigrator } from \"./migrations/31-move-enable-context-menu-to-autofill-settings-state-provider\";\nimport { PreferredLanguageMigrator } from \"./migrations/32-move-preferred-language\";\nimport { AppIdMigrator } from \"./migrations/33-move-app-id-to-state-providers\";\nimport { DomainSettingsMigrator } from \"./migrations/34-move-domain-settings-to-state-providers\";\nimport { MoveThemeToStateProviderMigrator } from \"./migrations/35-move-theme-to-state-providers\";\nimport { VaultSettingsKeyMigrator } from \"./migrations/36-move-show-card-and-identity-to-state-provider\";\nimport { AvatarColorMigrator } from \"./migrations/37-move-avatar-color-to-state-providers\";\nimport { TokenServiceStateProviderMigrator } from \"./migrations/38-migrate-token-svc-to-state-provider\";\nimport { MoveBillingAccountProfileMigrator } from \"./migrations/39-move-billing-account-profile-to-state-providers\";\nimport { RemoveEverBeenUnlockedMigrator } from \"./migrations/4-remove-ever-been-unlocked\";\nimport { OrganizationMigrator } from \"./migrations/40-move-organization-state-to-state-provider\";\nimport { EventCollectionMigrator } from \"./migrations/41-move-event-collection-to-state-provider\";\nimport { EnableFaviconMigrator } from \"./migrations/42-move-enable-favicon-to-domain-settings-state-provider\";\nimport { AutoConfirmFingerPrintsMigrator } from \"./migrations/43-move-auto-confirm-finger-prints-to-state-provider\";\nimport { UserDecryptionOptionsMigrator } from \"./migrations/44-move-user-decryption-options-to-state-provider\";\nimport { MergeEnvironmentState } from \"./migrations/45-merge-environment-state\";\nimport { DeleteBiometricPromptCancelledData } from \"./migrations/46-delete-orphaned-biometric-prompt-data\";\nimport { MoveDesktopSettingsMigrator } from \"./migrations/47-move-desktop-settings\";\nimport { MoveDdgToStateProviderMigrator } from \"./migrations/48-move-ddg-to-state-provider\";\nimport { AccountServerConfigMigrator } from \"./migrations/49-move-account-server-configs\";\nimport { AddKeyTypeToOrgKeysMigrator } from \"./migrations/5-add-key-type-to-org-keys\";\nimport { KeyConnectorMigrator } from \"./migrations/50-move-key-connector-to-state-provider\";\nimport { RememberedEmailMigrator } from \"./migrations/51-move-remembered-email-to-state-providers\";\nimport { DeleteInstalledVersion } from \"./migrations/52-delete-installed-version\";\nimport { DeviceTrustServiceStateProviderMigrator } from \"./migrations/53-migrate-device-trust-svc-to-state-providers\";\nimport { SendMigrator } from \"./migrations/54-move-encrypted-sends\";\nimport { MoveMasterKeyStateToProviderMigrator } from \"./migrations/55-move-master-key-state-to-provider\";\nimport { AuthRequestMigrator } from \"./migrations/56-move-auth-requests\";\nimport { CipherServiceMigrator } from \"./migrations/57-move-cipher-service-to-state-provider\";\nimport { RemoveRefreshTokenMigratedFlagMigrator } from \"./migrations/58-remove-refresh-token-migrated-state-provider-flag\";\nimport { KdfConfigMigrator } from \"./migrations/59-move-kdf-config-to-state-provider\";\nimport { RemoveLegacyEtmKeyMigrator } from \"./migrations/6-remove-legacy-etm-key\";\nimport { KnownAccountsMigrator } from \"./migrations/60-known-accounts\";\nimport { PinStateMigrator } from \"./migrations/61-move-pin-state-to-providers\";\nimport { VaultTimeoutSettingsServiceStateProviderMigrator } from \"./migrations/62-migrate-vault-timeout-settings-svc-to-state-provider\";\nimport { PasswordOptionsMigrator } from \"./migrations/63-migrate-password-settings\";\nimport { GeneratorHistoryMigrator } from \"./migrations/64-migrate-generator-history\";\nimport { ForwarderOptionsMigrator } from \"./migrations/65-migrate-forwarder-settings\";\nimport { MoveBiometricAutoPromptToAccount } from \"./migrations/7-move-biometric-auto-prompt-to-account\";\nimport { MoveStateVersionMigrator } from \"./migrations/8-move-state-version\";\nimport { MoveBrowserSettingsToGlobal } from \"./migrations/9-move-browser-settings-to-global\";\nimport { MinVersionMigrator } from \"./migrations/min-version\";\n\nexport const MIN_VERSION = 3;\nexport const CURRENT_VERSION = 65;\nexport type MinVersion = typeof MIN_VERSION;\n\nexport function createMigrationBuilder() {\n  return MigrationBuilder.create()\n    .with(MinVersionMigrator)\n    .with(RemoveEverBeenUnlockedMigrator, 3, 4)\n    .with(AddKeyTypeToOrgKeysMigrator, 4, 5)\n    .with(RemoveLegacyEtmKeyMigrator, 5, 6)\n    .with(MoveBiometricAutoPromptToAccount, 6, 7)\n    .with(MoveStateVersionMigrator, 7, 8)\n    .with(MoveBrowserSettingsToGlobal, 8, 9)\n    .with(EverHadUserKeyMigrator, 9, 10)\n    .with(OrganizationKeyMigrator, 10, 11)\n    .with(MoveEnvironmentStateToProviders, 11, 12)\n    .with(ProviderKeyMigrator, 12, 13)\n    .with(MoveBiometricClientKeyHalfToStateProviders, 13, 14)\n    .with(FolderMigrator, 14, 15)\n    .with(LastSyncMigrator, 15, 16)\n    .with(EnablePasskeysMigrator, 16, 17)\n    .with(AutofillSettingsKeyMigrator, 17, 18)\n    .with(RequirePasswordOnStartMigrator, 18, 19)\n    .with(PrivateKeyMigrator, 19, 20)\n    .with(CollectionMigrator, 20, 21)\n    .with(CollapsedGroupingsMigrator, 21, 22)\n    .with(MoveBiometricPromptsToStateProviders, 22, 23)\n    .with(SmOnboardingTasksMigrator, 23, 24)\n    .with(ClearClipboardDelayMigrator, 24, 25)\n    .with(RevertLastSyncMigrator, 25, 26)\n    .with(BadgeSettingsMigrator, 26, 27)\n    .with(MoveBiometricUnlockToStateProviders, 27, 28)\n    .with(UserNotificationSettingsKeyMigrator, 28, 29)\n    .with(PolicyMigrator, 29, 30)\n    .with(EnableContextMenuMigrator, 30, 31)\n    .with(PreferredLanguageMigrator, 31, 32)\n    .with(AppIdMigrator, 32, 33)\n    .with(DomainSettingsMigrator, 33, 34)\n    .with(MoveThemeToStateProviderMigrator, 34, 35)\n    .with(VaultSettingsKeyMigrator, 35, 36)\n    .with(AvatarColorMigrator, 36, 37)\n    .with(TokenServiceStateProviderMigrator, 37, 38)\n    .with(MoveBillingAccountProfileMigrator, 38, 39)\n    .with(OrganizationMigrator, 39, 40)\n    .with(EventCollectionMigrator, 40, 41)\n    .with(EnableFaviconMigrator, 41, 42)\n    .with(AutoConfirmFingerPrintsMigrator, 42, 43)\n    .with(UserDecryptionOptionsMigrator, 43, 44)\n    .with(MergeEnvironmentState, 44, 45)\n    .with(DeleteBiometricPromptCancelledData, 45, 46)\n    .with(MoveDesktopSettingsMigrator, 46, 47)\n    .with(MoveDdgToStateProviderMigrator, 47, 48)\n    .with(AccountServerConfigMigrator, 48, 49)\n    .with(KeyConnectorMigrator, 49, 50)\n    .with(RememberedEmailMigrator, 50, 51)\n    .with(DeleteInstalledVersion, 51, 52)\n    .with(DeviceTrustServiceStateProviderMigrator, 52, 53)\n    .with(SendMigrator, 53, 54)\n    .with(MoveMasterKeyStateToProviderMigrator, 54, 55)\n    .with(AuthRequestMigrator, 55, 56)\n    .with(CipherServiceMigrator, 56, 57)\n    .with(RemoveRefreshTokenMigratedFlagMigrator, 57, 58)\n    .with(KdfConfigMigrator, 58, 59)\n    .with(KnownAccountsMigrator, 59, 60)\n    .with(PinStateMigrator, 60, 61)\n    .with(VaultTimeoutSettingsServiceStateProviderMigrator, 61, 62)\n    .with(PasswordOptionsMigrator, 62, 63)\n    .with(GeneratorHistoryMigrator, 63, 64)\n    .with(ForwarderOptionsMigrator, 64, CURRENT_VERSION);\n}\n\nexport async function currentVersion(\n  storageService: AbstractStorageService,\n  logService: LogService,\n) {\n  let state = await storageService.get<number>(\"stateVersion\");\n  if (state == null) {\n    // Pre v8\n    state = (await storageService.get<{ stateVersion: number }>(\"global\"))?.stateVersion;\n  }\n  if (state == null) {\n    logService.info(\"No state version found, assuming empty state.\");\n    return -1;\n  }\n  logService.info(`State version: ${state}`);\n  return state;\n}\n\n/**\n * Waits for migrations to have a chance to run and will resolve the promise once they are.\n *\n * @param storageService Disk storage where the `stateVersion` will or is already saved in.\n * @param logService Log service\n */\nexport async function waitForMigrations(\n  storageService: AbstractStorageService,\n  logService: LogService,\n) {\n  const isReady = async () => {\n    const version = await currentVersion(storageService, logService);\n    // The saved version is what we consider the latest\n    // migrations should be complete, the state version\n    // shouldn't become larger than `CURRENT_VERSION` in\n    // any normal usage of the application but it is common\n    // enough in dev scenarios where we want to consider that\n    // ready as well and return true in that scenario.\n    return version >= CURRENT_VERSION;\n  };\n\n  const wait = async (time: number) => {\n    // Wait exponentially\n    const nextTime = time * 2;\n    if (nextTime > 8192) {\n      // Don't wait longer than ~8 seconds in a single wait,\n      // if the migrations still haven't happened. They aren't\n      // likely to.\n      return;\n    }\n    return new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        if (!(await isReady())) {\n          logService.info(`Waiting for migrations to finish, waiting for ${nextTime}ms`);\n          await wait(nextTime);\n        }\n        resolve();\n      }, time);\n    });\n  };\n\n  if (!(await isReady())) {\n    // Wait for 2ms to start with\n    await wait(2);\n  }\n}\n","import { createMigrationBuilder } from \"../../state-migrations\";\nimport { MigrationBuilder } from \"../../state-migrations/migration-builder\";\n\nexport class MigrationBuilderService {\n  private migrationBuilderCache: MigrationBuilder;\n\n  build() {\n    return (this.migrationBuilderCache ??= createMigrationBuilder());\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Needed to provide client type to migrations\nimport { ClientType } from \"../enums\";\n// eslint-disable-next-line import/no-restricted-paths -- Needed to print log messages\nimport { LogService } from \"../platform/abstractions/log.service\";\n// eslint-disable-next-line import/no-restricted-paths -- Needed to interface with storage locations\nimport { AbstractStorageService } from \"../platform/abstractions/storage.service\";\n\nexport type StateDefinitionLike = { name: string };\nexport type KeyDefinitionLike = {\n  stateDefinition: StateDefinitionLike;\n  key: string;\n};\n\nexport type MigrationHelperType = \"general\" | \"web-disk-local\";\n\nexport class MigrationHelper {\n  constructor(\n    public currentVersion: number,\n    private storageService: AbstractStorageService,\n    public logService: LogService,\n    type: MigrationHelperType,\n    public clientType: ClientType,\n  ) {\n    this.type = type;\n  }\n\n  /**\n   * On some clients, migrations are ran multiple times without direct action from the migration writer.\n   *\n   * All clients will run through migrations at least once, this run is referred to as `\"general\"`. If a migration is\n   * ran more than that single time, they will get a unique name if that the write can make conditional logic based on which\n   * migration run this is.\n   *\n   * @remarks The preferrable way of writing migrations is ALWAYS to be defensive and reflect on the data you are given back. This\n   * should really only be used when reflecting on the data given isn't enough.\n   */\n  type: MigrationHelperType;\n\n  /**\n   * Gets a value from the storage service at the given key.\n   *\n   * This is a brute force method to just get a value from the storage service. If you can use {@link getFromGlobal} or {@link getFromUser}, you should.\n   * @param key location\n   * @returns the value at the location\n   */\n  get<T>(key: string): Promise<T> {\n    return this.storageService.get<T>(key);\n  }\n\n  /**\n   * Sets a value in the storage service at the given key.\n   *\n   * This is a brute force method to just set a value in the storage service. If you can use {@link setToGlobal} or {@link setToUser}, you should.\n   * @param key location\n   * @param value the value to set\n   * @returns\n   */\n  set<T>(key: string, value: T): Promise<void> {\n    this.logService.info(`Setting ${key}`);\n    return this.storageService.save(key, value);\n  }\n\n  /**\n   * Remove a value in the storage service at the given key.\n   *\n   * This is a brute force method to just remove a value in the storage service. If you can use {@link removeFromGlobal} or {@link removeFromUser}, you should.\n   * @param key location\n   * @returns void\n   */\n  remove(key: string): Promise<void> {\n    this.logService.info(`Removing ${key}`);\n    return this.storageService.remove(key);\n  }\n\n  /**\n   * Gets a globally scoped value from a location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link get} for those.\n   * @param keyDefinition unique key definition\n   * @returns value from store\n   */\n  getFromGlobal<T>(keyDefinition: KeyDefinitionLike): Promise<T> {\n    return this.get<T>(this.getGlobalKey(keyDefinition));\n  }\n\n  /**\n   * Sets a globally scoped value to a location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link set} for those.\n   * @param keyDefinition unique key definition\n   * @param value value to store\n   * @returns void\n   */\n  setToGlobal<T>(keyDefinition: KeyDefinitionLike, value: T): Promise<void> {\n    return this.set(this.getGlobalKey(keyDefinition), value);\n  }\n\n  /**\n   * Remove a globally scoped location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link remove} for those.\n   * @param keyDefinition unique key definition\n   * @returns void\n   */\n  removeFromGlobal(keyDefinition: KeyDefinitionLike): Promise<void> {\n    return this.remove(this.getGlobalKey(keyDefinition));\n  }\n\n  /**\n   * Gets a user scoped value from a location derived through the user id and key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link get} for those.\n   * @param userId userId to use in the key\n   * @param keyDefinition unique key definition\n   * @returns value from store\n   */\n  getFromUser<T>(userId: string, keyDefinition: KeyDefinitionLike): Promise<T> {\n    return this.get<T>(this.getUserKey(userId, keyDefinition));\n  }\n\n  /**\n   * Sets a user scoped value to a location derived through the user id and key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link set} for those.\n   * @param userId userId to use in the key\n   * @param keyDefinition unique key definition\n   * @param value value to store\n   * @returns void\n   */\n  setToUser<T>(userId: string, keyDefinition: KeyDefinitionLike, value: T): Promise<void> {\n    return this.set(this.getUserKey(userId, keyDefinition), value);\n  }\n\n  /**\n   * Remove a user scoped location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link remove} for those.\n   * @param keyDefinition unique key definition\n   * @returns void\n   */\n  removeFromUser(userId: string, keyDefinition: KeyDefinitionLike): Promise<void> {\n    return this.remove(this.getUserKey(userId, keyDefinition));\n  }\n\n  info(message: string): void {\n    this.logService.info(message);\n  }\n\n  /**\n   * Helper method to read all Account objects stored by the State Service.\n   *\n   * This is useful from creating migrations off of this paradigm, but should not be used once a value is migrated to a state provider.\n   *\n   * @returns a list of all accounts that have been authenticated with state service, cast the expected type.\n   */\n  async getAccounts<ExpectedAccountType>(): Promise<\n    { userId: string; account: ExpectedAccountType }[]\n  > {\n    const userIds = await this.getKnownUserIds();\n    return Promise.all(\n      userIds.map(async (userId) => ({\n        userId,\n        account: await this.get<ExpectedAccountType>(userId),\n      })),\n    );\n  }\n\n  /**\n   * Helper method to read known users ids.\n   */\n  async getKnownUserIds(): Promise<string[]> {\n    if (this.currentVersion < 60) {\n      return knownAccountUserIdsBuilderPre60(this.storageService);\n    } else {\n      return knownAccountUserIdsBuilder(this.storageService);\n    }\n  }\n\n  /**\n   * Builds a user storage key appropriate for the current version.\n   *\n   * @param userId userId to use in the key\n   * @param keyDefinition state and key to use in the key\n   * @returns\n   */\n  private getUserKey(userId: string, keyDefinition: KeyDefinitionLike): string {\n    if (this.currentVersion < 9) {\n      return userKeyBuilderPre9();\n    } else {\n      return userKeyBuilder(userId, keyDefinition);\n    }\n  }\n\n  /**\n   * Builds a global storage key appropriate for the current version.\n   *\n   * @param keyDefinition state and key to use in the key\n   * @returns\n   */\n  private getGlobalKey(keyDefinition: KeyDefinitionLike): string {\n    if (this.currentVersion < 9) {\n      return globalKeyBuilderPre9();\n    } else {\n      return globalKeyBuilder(keyDefinition);\n    }\n  }\n}\n\n/**\n * When this is updated, rename this function to `userKeyBuilderXToY` where `X` is the version number it\n * became relevant, and `Y` prior to the version it was updated.\n *\n * Be sure to update the map in `MigrationHelper` to point to the appropriate function for the current version.\n * @param userId The userId of the user you want the key to be for.\n * @param keyDefinition the key definition of which data the key should point to.\n * @returns\n */\nfunction userKeyBuilder(userId: string, keyDefinition: KeyDefinitionLike): string {\n  return `user_${userId}_${keyDefinition.stateDefinition.name}_${keyDefinition.key}`;\n}\n\nfunction userKeyBuilderPre9(): string {\n  throw Error(\"No key builder should be used for versions prior to 9.\");\n}\n\n/**\n * When this is updated, rename this function to `globalKeyBuilderXToY` where `X` is the version number\n * it became relevant, and `Y` prior to the version it was updated.\n *\n * Be sure to update the map in `MigrationHelper` to point to the appropriate function for the current version.\n * @param keyDefinition the key definition of which data the key should point to.\n * @returns\n */\nfunction globalKeyBuilder(keyDefinition: KeyDefinitionLike): string {\n  return `global_${keyDefinition.stateDefinition.name}_${keyDefinition.key}`;\n}\n\nfunction globalKeyBuilderPre9(): string {\n  throw Error(\"No key builder should be used for versions prior to 9.\");\n}\n\nasync function knownAccountUserIdsBuilderPre60(\n  storageService: AbstractStorageService,\n): Promise<string[]> {\n  return (await storageService.get<string[]>(\"authenticatedAccounts\")) ?? [];\n}\n\nasync function knownAccountUserIdsBuilder(\n  storageService: AbstractStorageService,\n): Promise<string[]> {\n  const accounts = await storageService.get<Record<string, unknown>>(\n    globalKeyBuilder({ stateDefinition: { name: \"account\" }, key: \"accounts\" }),\n  );\n  return Object.keys(accounts ?? {});\n}\n","import { ClientType } from \"../../enums\";\nimport { waitForMigrations } from \"../../state-migrations\";\nimport { CURRENT_VERSION, currentVersion } from \"../../state-migrations/migrate\";\nimport { MigrationHelper } from \"../../state-migrations/migration-helper\";\nimport { LogService } from \"../abstractions/log.service\";\nimport { AbstractStorageService } from \"../abstractions/storage.service\";\n\nimport { MigrationBuilderService } from \"./migration-builder.service\";\n\nexport class MigrationRunner {\n  constructor(\n    protected diskStorage: AbstractStorageService,\n    protected logService: LogService,\n    protected migrationBuilderService: MigrationBuilderService,\n    private clientType: ClientType,\n  ) {}\n\n  async run(): Promise<void> {\n    const migrationHelper = new MigrationHelper(\n      await currentVersion(this.diskStorage, this.logService),\n      this.diskStorage,\n      this.logService,\n      \"general\",\n      this.clientType,\n    );\n\n    if (migrationHelper.currentVersion < 0) {\n      // Cannot determine state, assuming empty so we don't repeatedly apply a migration.\n      await this.diskStorage.save(\"stateVersion\", CURRENT_VERSION);\n      return;\n    }\n\n    const migrationBuilder = this.migrationBuilderService.build();\n\n    await migrationBuilder.migrate(migrationHelper);\n  }\n\n  async waitForCompletion(): Promise<void> {\n    await waitForMigrations(this.diskStorage, this.logService);\n  }\n}\n","import { firstValueFrom, map, timeout } from \"rxjs\";\n\nimport { PinServiceAbstraction } from \"../../../../auth/src/common/abstractions\";\nimport { VaultTimeoutSettingsService } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { AutofillSettingsServiceAbstraction } from \"../../autofill/services/autofill-settings.service\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { UserId } from \"../../types/guid\";\nimport { MessagingService } from \"../abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"../abstractions/platform-utils.service\";\nimport { StateService } from \"../abstractions/state.service\";\nimport { SystemService as SystemServiceAbstraction } from \"../abstractions/system.service\";\nimport { BiometricStateService } from \"../biometrics/biometric-state.service\";\nimport { Utils } from \"../misc/utils\";\n\nexport class SystemService implements SystemServiceAbstraction {\n  private reloadInterval: any = null;\n  private clearClipboardTimeout: any = null;\n  private clearClipboardTimeoutFunction: () => Promise<any> = null;\n\n  constructor(\n    private pinService: PinServiceAbstraction,\n    private messagingService: MessagingService,\n    private platformUtilsService: PlatformUtilsService,\n    private reloadCallback: () => Promise<void> = null,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n    private biometricStateService: BiometricStateService,\n    private accountService: AccountService,\n  ) {}\n\n  async startProcessReload(authService: AuthService): Promise<void> {\n    const accounts = await firstValueFrom(this.accountService.accounts$);\n    if (accounts != null) {\n      const keys = Object.keys(accounts);\n      if (keys.length > 0) {\n        for (const userId of keys) {\n          let status = await firstValueFrom(authService.authStatusFor$(userId as UserId));\n          status = await authService.getAuthStatus(userId);\n          if (status === AuthenticationStatus.Unlocked) {\n            return;\n          }\n        }\n      }\n    }\n\n    // A reloadInterval has already been set and is executing\n    if (this.reloadInterval != null) {\n      return;\n    }\n\n    // If there is an active user, check if they have a pinKeyEncryptedUserKeyEphemeral. If so, prevent process reload upon lock.\n    const userId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    if (userId != null) {\n      const ephemeralPin = await this.pinService.getPinKeyEncryptedUserKeyEphemeral(userId);\n      if (ephemeralPin != null) {\n        return;\n      }\n    }\n\n    this.cancelProcessReload();\n    await this.executeProcessReload();\n  }\n\n  private async executeProcessReload() {\n    const biometricLockedFingerprintValidated = await firstValueFrom(\n      this.biometricStateService.fingerprintValidated$,\n    );\n    if (!biometricLockedFingerprintValidated) {\n      clearInterval(this.reloadInterval);\n      this.reloadInterval = null;\n\n      const activeUserId = await firstValueFrom(\n        this.accountService.activeAccount$.pipe(\n          map((a) => a?.id),\n          timeout(500),\n        ),\n      );\n      // Replace current active user if they will be logged out on reload\n      if (activeUserId != null) {\n        const timeoutAction = await firstValueFrom(\n          this.vaultTimeoutSettingsService\n            .getVaultTimeoutActionByUserId$(activeUserId)\n            .pipe(timeout(500)), // safety feature to avoid this call hanging and stopping process reload from clearing memory\n        );\n        if (timeoutAction === VaultTimeoutAction.LogOut) {\n          const nextUser = await firstValueFrom(\n            this.accountService.nextUpAccount$.pipe(map((account) => account?.id ?? null)),\n          );\n          // Can be removed once we migrate password generation history to state providers\n          await this.stateService.clearDecryptedData(activeUserId);\n          await this.accountService.switchAccount(nextUser);\n        }\n      }\n\n      this.messagingService.send(\"reloadProcess\");\n      if (this.reloadCallback != null) {\n        await this.reloadCallback();\n      }\n      return;\n    }\n    if (this.reloadInterval == null) {\n      this.reloadInterval = setInterval(async () => await this.executeProcessReload(), 1000);\n    }\n  }\n\n  cancelProcessReload(): void {\n    if (this.reloadInterval != null) {\n      clearInterval(this.reloadInterval);\n      this.reloadInterval = null;\n    }\n  }\n\n  async clearClipboard(clipboardValue: string, timeoutMs: number = null): Promise<void> {\n    if (this.clearClipboardTimeout != null) {\n      clearTimeout(this.clearClipboardTimeout);\n      this.clearClipboardTimeout = null;\n    }\n\n    if (Utils.isNullOrWhitespace(clipboardValue)) {\n      return;\n    }\n\n    const clearClipboardDelay = await firstValueFrom(\n      this.autofillSettingsService.clearClipboardDelay$,\n    );\n\n    if (clearClipboardDelay == null) {\n      return;\n    }\n\n    if (timeoutMs == null) {\n      timeoutMs = clearClipboardDelay * 1000;\n    }\n\n    this.clearClipboardTimeoutFunction = async () => {\n      const clipboardValueNow = await this.platformUtilsService.readFromClipboard();\n      if (clipboardValue === clipboardValueNow) {\n        this.platformUtilsService.copyToClipboard(\"\", { clearing: true });\n      }\n    };\n\n    this.clearClipboardTimeout = setTimeout(async () => {\n      await this.clearPendingClipboard();\n    }, timeoutMs);\n  }\n\n  async clearPendingClipboard() {\n    if (this.clearClipboardTimeoutFunction != null) {\n      await this.clearClipboardTimeoutFunction();\n      this.clearClipboardTimeoutFunction = null;\n    }\n  }\n}\n","import { UserId } from \"../../types/guid\";\nimport { CryptoService } from \"../abstractions/crypto.service\";\nimport { KeySuffixOptions } from \"../enums\";\n\n// TODO: this is a half measure improvement which allows us to reduce some side effects today (cryptoService.getUserKey setting user key in memory if auto key exists)\n// but ideally, in the future, we would be able to put this logic into the cryptoService\n// after the vault timeout settings service is transitioned to state provider so that\n// the getUserKey logic can simply go to the correct location based on the vault timeout settings\n// similar to the TokenService (it would either go to secure storage for the auto user key or memory for the user key)\n\nexport class UserAutoUnlockKeyService {\n  constructor(private cryptoService: CryptoService) {}\n\n  /**\n   * The presence of the user key in memory dictates whether the user's vault is locked or unlocked.\n   * However, for users that have the auto unlock user key set, we need to set the user key in memory\n   * on application bootstrap and on active account changes so that the user's vault loads unlocked.\n   * @param userId - The user id to check for an auto user key.\n   */\n  async setUserKeyInMemoryIfAutoUserKeySet(userId: UserId): Promise<void> {\n    if (userId == null) {\n      return;\n    }\n\n    const autoUserKey = await this.cryptoService.getUserKeyFromStorage(\n      KeySuffixOptions.Auto,\n      userId,\n    );\n\n    if (autoUserKey == null) {\n      return;\n    }\n\n    await this.cryptoService.setUserKey(autoUserKey, userId);\n  }\n}\n","export class DecryptParameters<T> {\n  encKey: T;\n  data: T;\n  iv: T;\n  macKey: T;\n  mac: T;\n  macData: T;\n}\n","import * as argon2 from \"argon2-browser\";\nimport * as forge from \"node-forge\";\n\nimport { Utils } from \"../../platform/misc/utils\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport { DecryptParameters } from \"../models/domain/decrypt-parameters\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\nexport class WebCryptoFunctionService implements CryptoFunctionService {\n  private crypto: Crypto;\n  private subtle: SubtleCrypto;\n  private wasmSupported: boolean;\n\n  constructor(globalContext: Window | typeof global) {\n    this.crypto = typeof globalContext.crypto !== \"undefined\" ? globalContext.crypto : null;\n    this.subtle =\n      !!this.crypto && typeof this.crypto.subtle !== \"undefined\" ? this.crypto.subtle : null;\n    this.wasmSupported = this.checkIfWasmSupported();\n  }\n\n  async pbkdf2(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    algorithm: \"sha256\" | \"sha512\",\n    iterations: number,\n  ): Promise<Uint8Array> {\n    const wcLen = algorithm === \"sha256\" ? 256 : 512;\n    const passwordBuf = this.toBuf(password);\n    const saltBuf = this.toBuf(salt);\n\n    const pbkdf2Params: Pbkdf2Params = {\n      name: \"PBKDF2\",\n      salt: saltBuf,\n      iterations: iterations,\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\n      \"raw\",\n      passwordBuf,\n      { name: \"PBKDF2\" } as any,\n      false,\n      [\"deriveBits\"],\n    );\n    const buffer = await this.subtle.deriveBits(pbkdf2Params as any, impKey, wcLen);\n    return new Uint8Array(buffer);\n  }\n\n  async argon2(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    iterations: number,\n    memory: number,\n    parallelism: number,\n  ): Promise<Uint8Array> {\n    if (!this.wasmSupported) {\n      throw \"Webassembly support is required for the Argon2 KDF feature.\";\n    }\n\n    const passwordArr = new Uint8Array(this.toBuf(password));\n    const saltArr = new Uint8Array(this.toBuf(salt));\n\n    const result = await argon2.hash({\n      pass: passwordArr,\n      salt: saltArr,\n      time: iterations,\n      mem: memory,\n      parallelism: parallelism,\n      hashLen: 32,\n      type: argon2.ArgonType.Argon2id,\n    });\n    argon2.unloadRuntime();\n    return result.hash;\n  }\n\n  async hkdf(\n    ikm: Uint8Array,\n    salt: string | Uint8Array,\n    info: string | Uint8Array,\n    outputByteSize: number,\n    algorithm: \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const saltBuf = this.toBuf(salt);\n    const infoBuf = this.toBuf(info);\n\n    const hkdfParams: HkdfParams = {\n      name: \"HKDF\",\n      salt: saltBuf,\n      info: infoBuf,\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\"raw\", ikm, { name: \"HKDF\" } as any, false, [\n      \"deriveBits\",\n    ]);\n    const buffer = await this.subtle.deriveBits(hkdfParams as any, impKey, outputByteSize * 8);\n    return new Uint8Array(buffer);\n  }\n\n  // ref: https://tools.ietf.org/html/rfc5869\n  async hkdfExpand(\n    prk: Uint8Array,\n    info: string | Uint8Array,\n    outputByteSize: number,\n    algorithm: \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const hashLen = algorithm === \"sha256\" ? 32 : 64;\n    if (outputByteSize > 255 * hashLen) {\n      throw new Error(\"outputByteSize is too large.\");\n    }\n    const prkArr = new Uint8Array(prk);\n    if (prkArr.length < hashLen) {\n      throw new Error(\"prk is too small.\");\n    }\n    const infoBuf = this.toBuf(info);\n    const infoArr = new Uint8Array(infoBuf);\n    let runningOkmLength = 0;\n    let previousT = new Uint8Array(0);\n    const n = Math.ceil(outputByteSize / hashLen);\n    const okm = new Uint8Array(n * hashLen);\n    for (let i = 0; i < n; i++) {\n      const t = new Uint8Array(previousT.length + infoArr.length + 1);\n      t.set(previousT);\n      t.set(infoArr, previousT.length);\n      t.set([i + 1], t.length - 1);\n      previousT = new Uint8Array(await this.hmac(t, prk, algorithm));\n      okm.set(previousT, runningOkmLength);\n      runningOkmLength += previousT.length;\n      if (runningOkmLength >= outputByteSize) {\n        break;\n      }\n    }\n    return okm.slice(0, outputByteSize);\n  }\n\n  async hash(\n    value: string | Uint8Array,\n    algorithm: \"sha1\" | \"sha256\" | \"sha512\" | \"md5\",\n  ): Promise<Uint8Array> {\n    if (algorithm === \"md5\") {\n      const md = forge.md.md5.create();\n      const valueBytes = this.toByteString(value);\n      md.update(valueBytes, \"raw\");\n      return Utils.fromByteStringToArray(md.digest().data);\n    }\n\n    const valueBuf = this.toBuf(value);\n    const buffer = await this.subtle.digest(\n      { name: this.toWebCryptoAlgorithm(algorithm) },\n      valueBuf,\n    );\n    return new Uint8Array(buffer);\n  }\n\n  async hmac(\n    value: Uint8Array,\n    key: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const signingAlgorithm = {\n      name: \"HMAC\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\"raw\", key, signingAlgorithm, false, [\"sign\"]);\n    const buffer = await this.subtle.sign(signingAlgorithm, impKey, value);\n    return new Uint8Array(buffer);\n  }\n\n  // Safely compare two values in a way that protects against timing attacks (Double HMAC Verification).\n  // ref: https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2011/february/double-hmac-verification/\n  // ref: https://paragonie.com/blog/2015/11/preventing-timing-attacks-on-string-comparison-with-double-hmac-strategy\n  async compare(a: Uint8Array, b: Uint8Array): Promise<boolean> {\n    const macKey = await this.randomBytes(32);\n    const signingAlgorithm = {\n      name: \"HMAC\",\n      hash: { name: \"SHA-256\" },\n    };\n    const impKey = await this.subtle.importKey(\"raw\", macKey, signingAlgorithm, false, [\"sign\"]);\n    const mac1 = await this.subtle.sign(signingAlgorithm, impKey, a);\n    const mac2 = await this.subtle.sign(signingAlgorithm, impKey, b);\n\n    if (mac1.byteLength !== mac2.byteLength) {\n      return false;\n    }\n\n    const arr1 = new Uint8Array(mac1);\n    const arr2 = new Uint8Array(mac2);\n    for (let i = 0; i < arr2.length; i++) {\n      if (arr1[i] !== arr2[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hmacFast(value: string, key: string, algorithm: \"sha1\" | \"sha256\" | \"sha512\"): Promise<string> {\n    const hmac = forge.hmac.create();\n    hmac.start(algorithm, key);\n    hmac.update(value);\n    const bytes = hmac.digest().getBytes();\n    return Promise.resolve(bytes);\n  }\n\n  async compareFast(a: string, b: string): Promise<boolean> {\n    const rand = await this.randomBytes(32);\n    const bytes = new Uint32Array(rand);\n    const buffer = forge.util.createBuffer();\n    for (let i = 0; i < bytes.length; i++) {\n      buffer.putInt32(bytes[i]);\n    }\n    const macKey = buffer.getBytes();\n\n    const hmac = forge.hmac.create();\n    hmac.start(\"sha256\", macKey);\n    hmac.update(a);\n    const mac1 = hmac.digest().getBytes();\n\n    hmac.start(null, null);\n    hmac.update(b);\n    const mac2 = hmac.digest().getBytes();\n\n    const equals = mac1 === mac2;\n    return equals;\n  }\n\n  async aesEncrypt(data: Uint8Array, iv: Uint8Array, key: Uint8Array): Promise<Uint8Array> {\n    const impKey = await this.subtle.importKey(\"raw\", key, { name: \"AES-CBC\" } as any, false, [\n      \"encrypt\",\n    ]);\n    const buffer = await this.subtle.encrypt({ name: \"AES-CBC\", iv: iv }, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  aesDecryptFastParameters(\n    data: string,\n    iv: string,\n    mac: string,\n    key: SymmetricCryptoKey,\n  ): DecryptParameters<string> {\n    const p = new DecryptParameters<string>();\n    if (key.meta != null) {\n      p.encKey = key.meta.encKeyByteString;\n      p.macKey = key.meta.macKeyByteString;\n    }\n\n    if (p.encKey == null) {\n      p.encKey = forge.util.decode64(key.encKeyB64);\n    }\n    p.data = forge.util.decode64(data);\n    p.iv = forge.util.decode64(iv);\n    p.macData = p.iv + p.data;\n    if (p.macKey == null && key.macKeyB64 != null) {\n      p.macKey = forge.util.decode64(key.macKeyB64);\n    }\n    if (mac != null) {\n      p.mac = forge.util.decode64(mac);\n    }\n\n    // cache byte string keys for later\n    if (key.meta == null) {\n      key.meta = {};\n    }\n    if (key.meta.encKeyByteString == null) {\n      key.meta.encKeyByteString = p.encKey;\n    }\n    if (p.macKey != null && key.meta.macKeyByteString == null) {\n      key.meta.macKeyByteString = p.macKey;\n    }\n\n    return p;\n  }\n\n  aesDecryptFast(parameters: DecryptParameters<string>, mode: \"cbc\" | \"ecb\"): Promise<string> {\n    const decipher = (forge as any).cipher.createDecipher(\n      this.toWebCryptoAesMode(mode),\n      parameters.encKey,\n    );\n    const options = {} as any;\n    if (mode === \"cbc\") {\n      options.iv = parameters.iv;\n    }\n    const dataBuffer = (forge as any).util.createBuffer(parameters.data);\n    decipher.start(options);\n    decipher.update(dataBuffer);\n    decipher.finish();\n    const val = decipher.output.toString();\n    return Promise.resolve(val);\n  }\n\n  async aesDecrypt(\n    data: Uint8Array,\n    iv: Uint8Array,\n    key: Uint8Array,\n    mode: \"cbc\" | \"ecb\",\n  ): Promise<Uint8Array> {\n    if (mode === \"ecb\") {\n      // Web crypto does not support AES-ECB mode, so we need to do this in forge.\n      const params = new DecryptParameters<string>();\n      params.data = this.toByteString(data);\n      params.encKey = this.toByteString(key);\n      const result = await this.aesDecryptFast(params, \"ecb\");\n      return Utils.fromByteStringToArray(result);\n    }\n    const impKey = await this.subtle.importKey(\"raw\", key, { name: \"AES-CBC\" } as any, false, [\n      \"decrypt\",\n    ]);\n    const buffer = await this.subtle.decrypt({ name: \"AES-CBC\", iv: iv }, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaEncrypt(\n    data: Uint8Array,\n    publicKey: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\",\n  ): Promise<Uint8Array> {\n    // Note: Edge browser requires that we specify name and hash for both key import and decrypt.\n    // We cannot use the proper types here.\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n    const impKey = await this.subtle.importKey(\"spki\", publicKey, rsaParams, false, [\"encrypt\"]);\n    const buffer = await this.subtle.encrypt(rsaParams, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaDecrypt(\n    data: Uint8Array,\n    privateKey: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\",\n  ): Promise<Uint8Array> {\n    // Note: Edge browser requires that we specify name and hash for both key import and decrypt.\n    // We cannot use the proper types here.\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n    const impKey = await this.subtle.importKey(\"pkcs8\", privateKey, rsaParams, false, [\"decrypt\"]);\n    const buffer = await this.subtle.decrypt(rsaParams, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaExtractPublicKey(privateKey: Uint8Array): Promise<Uint8Array> {\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      // Have to specify some algorithm\n      hash: { name: this.toWebCryptoAlgorithm(\"sha1\") },\n    };\n    const impPrivateKey = await this.subtle.importKey(\"pkcs8\", privateKey, rsaParams, true, [\n      \"decrypt\",\n    ]);\n    const jwkPrivateKey = await this.subtle.exportKey(\"jwk\", impPrivateKey);\n    const jwkPublicKeyParams = {\n      kty: \"RSA\",\n      e: jwkPrivateKey.e,\n      n: jwkPrivateKey.n,\n      alg: \"RSA-OAEP\",\n      ext: true,\n    };\n    const impPublicKey = await this.subtle.importKey(\"jwk\", jwkPublicKeyParams, rsaParams, true, [\n      \"encrypt\",\n    ]);\n    const buffer = await this.subtle.exportKey(\"spki\", impPublicKey);\n    return new Uint8Array(buffer);\n  }\n\n  async aesGenerateKey(bitLength = 128 | 192 | 256 | 512): Promise<CsprngArray> {\n    if (bitLength === 512) {\n      // 512 bit keys are not supported in WebCrypto, so we concat two 256 bit keys\n      const key1 = await this.aesGenerateKey(256);\n      const key2 = await this.aesGenerateKey(256);\n      return new Uint8Array([...key1, ...key2]) as CsprngArray;\n    }\n    const aesParams = {\n      name: \"AES-CBC\",\n      length: bitLength,\n    };\n\n    const key = await this.subtle.generateKey(aesParams, true, [\"encrypt\", \"decrypt\"]);\n    const rawKey = await this.subtle.exportKey(\"raw\", key);\n    return new Uint8Array(rawKey) as CsprngArray;\n  }\n\n  async rsaGenerateKeyPair(length: 1024 | 2048 | 4096): Promise<[Uint8Array, Uint8Array]> {\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      modulusLength: length,\n      publicExponent: new Uint8Array([0x01, 0x00, 0x01]), // 65537\n      // Have to specify some algorithm\n      hash: { name: this.toWebCryptoAlgorithm(\"sha1\") },\n    };\n    const keyPair = await this.subtle.generateKey(rsaParams, true, [\"encrypt\", \"decrypt\"]);\n    const publicKey = await this.subtle.exportKey(\"spki\", keyPair.publicKey);\n    const privateKey = await this.subtle.exportKey(\"pkcs8\", keyPair.privateKey);\n    return [new Uint8Array(publicKey), new Uint8Array(privateKey)];\n  }\n\n  randomBytes(length: number): Promise<CsprngArray> {\n    const arr = new Uint8Array(length);\n    this.crypto.getRandomValues(arr);\n    return Promise.resolve(arr as CsprngArray);\n  }\n\n  private toBuf(value: string | Uint8Array): Uint8Array {\n    let buf: Uint8Array;\n    if (typeof value === \"string\") {\n      buf = Utils.fromUtf8ToArray(value);\n    } else {\n      buf = value;\n    }\n    return buf;\n  }\n\n  private toByteString(value: string | Uint8Array): string {\n    let bytes: string;\n    if (typeof value === \"string\") {\n      bytes = forge.util.encodeUtf8(value);\n    } else {\n      bytes = Utils.fromBufferToByteString(value);\n    }\n    return bytes;\n  }\n\n  private toWebCryptoAlgorithm(algorithm: \"sha1\" | \"sha256\" | \"sha512\" | \"md5\"): string {\n    if (algorithm === \"md5\") {\n      throw new Error(\"MD5 is not supported in WebCrypto.\");\n    }\n    return algorithm === \"sha1\" ? \"SHA-1\" : algorithm === \"sha256\" ? \"SHA-256\" : \"SHA-512\";\n  }\n\n  private toWebCryptoAesMode(mode: \"cbc\" | \"ecb\"): string {\n    return mode === \"cbc\" ? \"AES-CBC\" : \"AES-ECB\";\n  }\n\n  // ref: https://stackoverflow.com/a/47880734/1090359\n  private checkIfWasmSupported(): boolean {\n    try {\n      if (typeof WebAssembly === \"object\" && typeof WebAssembly.instantiate === \"function\") {\n        const module = new WebAssembly.Module(\n          Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00),\n        );\n        if (module instanceof WebAssembly.Module) {\n          return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n        }\n      }\n    } catch {\n      return false;\n    }\n    return false;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\n\nimport { StateUpdateOptions } from \"./state-update-options\";\n\nexport type CombinedState<T> = readonly [userId: UserId, state: T];\n\n/** A helper object for interacting with state that is scoped to a specific user. */\nexport interface UserState<T> {\n  /** Emits a stream of data. Emits null if the user does not have specified state. */\n  readonly state$: Observable<T | null>;\n\n  /** Emits a stream of tuples, with the first element being a user id and the second element being the data for that user. */\n  readonly combinedState$: Observable<CombinedState<T>>;\n}\n\nexport const activeMarker: unique symbol = Symbol(\"active\");\nexport interface ActiveUserState<T> extends UserState<T> {\n  readonly [activeMarker]: true;\n\n  /**\n   * Emits a stream of data. Emits null if the user does not have specified state.\n   * Note: Will not emit if there is no active user.\n   */\n  readonly state$: Observable<T | null>;\n\n  /**\n   * Updates backing stores for the active user.\n   * @param configureState function that takes the current state and returns the new state\n   * @param options Defaults to @see {module:state-update-options#DEFAULT_OPTIONS}\n   * @param options.shouldUpdate A callback for determining if you want to update state. Defaults to () => true\n   * @param options.combineLatestWith An observable that you want to combine with the current state for callbacks. Defaults to null\n   * @param options.msTimeout A timeout for how long you are willing to wait for a `combineLatestWith` option to complete. Defaults to 1000ms. Only applies if `combineLatestWith` is set.\n\n   * @returns A promise that must be awaited before your next action to ensure the update has been written to state.\n   * Resolves to the new state. If `shouldUpdate` returns false, the promise will resolve to the current state.\n   */\n  readonly update: <TCombine>(\n    configureState: (state: T, dependencies: TCombine) => T,\n    options?: StateUpdateOptions<T, TCombine>,\n  ) => Promise<[UserId, T]>;\n}\nexport interface SingleUserState<T> extends UserState<T> {\n  readonly userId: UserId;\n\n  /**\n   * Updates backing stores for the active user.\n   * @param configureState function that takes the current state and returns the new state\n   * @param options Defaults to @see {module:state-update-options#DEFAULT_OPTIONS}\n   * @param options.shouldUpdate A callback for determining if you want to update state. Defaults to () => true\n   * @param options.combineLatestWith An observable that you want to combine with the current state for callbacks. Defaults to null\n   * @param options.msTimeout A timeout for how long you are willing to wait for a `combineLatestWith` option to complete. Defaults to 1000ms. Only applies if `combineLatestWith` is set.\n\n   * @returns A promise that must be awaited before your next action to ensure the update has been written to state.\n   * Resolves to the new state. If `shouldUpdate` returns false, the promise will resolve to the current state.\n   */\n  readonly update: <TCombine>(\n    configureState: (state: T, dependencies: TCombine) => T,\n    options?: StateUpdateOptions<T, TCombine>,\n  ) => Promise<T>;\n}\n","import { Observable, map, switchMap, firstValueFrom, timeout, throwError, NEVER } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport { StateUpdateOptions } from \"../state-update-options\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserState, CombinedState, activeMarker } from \"../user-state\";\nimport { SingleUserStateProvider } from \"../user-state.provider\";\n\nexport class DefaultActiveUserState<T> implements ActiveUserState<T> {\n  [activeMarker]: true;\n  combinedState$: Observable<CombinedState<T>>;\n  state$: Observable<T>;\n\n  constructor(\n    protected keyDefinition: UserKeyDefinition<T>,\n    private activeUserId$: Observable<UserId | null>,\n    private singleUserStateProvider: SingleUserStateProvider,\n  ) {\n    this.combinedState$ = this.activeUserId$.pipe(\n      switchMap((userId) =>\n        userId != null\n          ? this.singleUserStateProvider.get(userId, this.keyDefinition).combinedState$\n          : NEVER,\n      ),\n    );\n\n    // State should just be combined state without the user id\n    this.state$ = this.combinedState$.pipe(map(([_userId, state]) => state));\n  }\n\n  async update<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine> = {},\n  ): Promise<[UserId, T]> {\n    const userId = await firstValueFrom(\n      this.activeUserId$.pipe(\n        timeout({\n          first: 1000,\n          with: () =>\n            throwError(\n              () =>\n                new Error(\n                  `Timeout while retrieving active user for key ${this.keyDefinition.fullName}.`,\n                ),\n            ),\n        }),\n      ),\n    );\n    if (userId == null) {\n      throw new Error(\n        `Error storing ${this.keyDefinition.fullName} for the active user: No active user at this time.`,\n      );\n    }\n\n    return [\n      userId,\n      await this.singleUserStateProvider\n        .get(userId, this.keyDefinition)\n        .update(configureState, options),\n    ];\n  }\n}\n","import { Observable, distinctUntilChanged, map } from \"rxjs\";\n\nimport { AccountService } from \"../../../auth/abstractions/account.service\";\nimport { UserId } from \"../../../types/guid\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { UserKeyDefinition, isUserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserState } from \"../user-state\";\nimport { ActiveUserStateProvider, SingleUserStateProvider } from \"../user-state.provider\";\n\nimport { DefaultActiveUserState } from \"./default-active-user-state\";\n\nexport class DefaultActiveUserStateProvider implements ActiveUserStateProvider {\n  activeUserId$: Observable<UserId | undefined>;\n\n  constructor(\n    private readonly accountService: AccountService,\n    private readonly singleUserStateProvider: SingleUserStateProvider,\n  ) {\n    this.activeUserId$ = this.accountService.activeAccount$.pipe(\n      map((account) => account?.id),\n      // To avoid going to storage when we don't need to, only get updates when there is a true change.\n      distinctUntilChanged((a, b) => (a == null || b == null ? a == b : a === b)), // Treat null and undefined as equal\n    );\n  }\n\n  get<T>(keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>): ActiveUserState<T> {\n    if (!isUserKeyDefinition(keyDefinition)) {\n      keyDefinition = UserKeyDefinition.fromBaseKeyDefinition(keyDefinition);\n    }\n\n    // All other providers cache the creation of their corresponding `State` objects, this instance\n    // doesn't need to do that since it calls `SingleUserStateProvider` it will go through their caching\n    // layer, because of that, the creation of this instance is quite simple and not worth caching.\n    return new DefaultActiveUserState(\n      keyDefinition,\n      this.activeUserId$,\n      this.singleUserStateProvider,\n    );\n  }\n}\n","import { Observable } from \"rxjs\";\n\nexport const DEFAULT_OPTIONS = {\n  shouldUpdate: () => true,\n  combineLatestWith: null as Observable<unknown>,\n  msTimeout: 1000,\n};\n\ntype DefinitelyTypedDefault<T, TCombine> = Omit<\n  typeof DEFAULT_OPTIONS,\n  \"shouldUpdate\" | \"combineLatestWith\"\n> & {\n  shouldUpdate: (state: T, dependency: TCombine) => boolean;\n  combineLatestWith?: Observable<TCombine>;\n};\n\nexport type StateUpdateOptions<T, TCombine> = Partial<DefinitelyTypedDefault<T, TCombine>>;\n\nexport function populateOptionsWithDefault<T, TCombine>(\n  options: StateUpdateOptions<T, TCombine>,\n): StateUpdateOptions<T, TCombine> {\n  return {\n    ...(DEFAULT_OPTIONS as StateUpdateOptions<T, TCombine>),\n    ...options,\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { AbstractStorageService } from \"../../abstractions/storage.service\";\n\nexport async function getStoredValue<T>(\n  key: string,\n  storage: AbstractStorageService,\n  deserializer: (jsonValue: Jsonify<T>) => T,\n) {\n  if (storage.valuesRequireDeserialization) {\n    const jsonValue = await storage.get<Jsonify<T>>(key);\n    const value = deserializer(jsonValue);\n    return value;\n  } else {\n    const value = await storage.get<T>(key);\n    return value ?? null;\n  }\n}\n","import {\n  Observable,\n  ReplaySubject,\n  defer,\n  filter,\n  firstValueFrom,\n  merge,\n  share,\n  switchMap,\n  timeout,\n  timer,\n} from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { StorageKey } from \"../../../types/state\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { StateUpdateOptions, populateOptionsWithDefault } from \"../state-update-options\";\n\nimport { getStoredValue } from \"./util\";\n\n// The parts of a KeyDefinition this class cares about to make it work\ntype KeyDefinitionRequirements<T> = {\n  deserializer: (jsonState: Jsonify<T>) => T;\n  cleanupDelayMs: number;\n};\n\nexport abstract class StateBase<T, KeyDef extends KeyDefinitionRequirements<T>> {\n  private updatePromise: Promise<T>;\n\n  readonly state$: Observable<T>;\n\n  constructor(\n    protected readonly key: StorageKey,\n    protected readonly storageService: AbstractStorageService & ObservableStorageService,\n    protected readonly keyDefinition: KeyDef,\n  ) {\n    const storageUpdate$ = storageService.updates$.pipe(\n      filter((storageUpdate) => storageUpdate.key === key),\n      switchMap(async (storageUpdate) => {\n        if (storageUpdate.updateType === \"remove\") {\n          return null;\n        }\n\n        return await getStoredValue(key, storageService, keyDefinition.deserializer);\n      }),\n    );\n\n    this.state$ = merge(\n      defer(() => getStoredValue(key, storageService, keyDefinition.deserializer)),\n      storageUpdate$,\n    ).pipe(\n      share({\n        connector: () => new ReplaySubject(1),\n        resetOnRefCountZero: () => timer(keyDefinition.cleanupDelayMs),\n      }),\n    );\n  }\n\n  async update<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine> = {},\n  ): Promise<T> {\n    options = populateOptionsWithDefault(options);\n    if (this.updatePromise != null) {\n      await this.updatePromise;\n    }\n\n    try {\n      this.updatePromise = this.internalUpdate(configureState, options);\n      const newState = await this.updatePromise;\n      return newState;\n    } finally {\n      this.updatePromise = null;\n    }\n  }\n\n  private async internalUpdate<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine>,\n  ): Promise<T> {\n    const currentState = await this.getStateForUpdate();\n    const combinedDependencies =\n      options.combineLatestWith != null\n        ? await firstValueFrom(options.combineLatestWith.pipe(timeout(options.msTimeout)))\n        : null;\n\n    if (!options.shouldUpdate(currentState, combinedDependencies)) {\n      return currentState;\n    }\n\n    const newState = configureState(currentState, combinedDependencies);\n    await this.doStorageSave(newState, currentState);\n    return newState;\n  }\n\n  protected async doStorageSave(newState: T, oldState: T) {\n    await this.storageService.save(this.key, newState);\n  }\n\n  /** For use in update methods, does not wait for update to complete before yielding state.\n   * The expectation is that that await is already done\n   */\n  private async getStateForUpdate() {\n    return await getStoredValue(this.key, this.storageService, this.keyDefinition.deserializer);\n  }\n}\n","import {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { GlobalState } from \"../global-state\";\nimport { KeyDefinition, globalKeyBuilder } from \"../key-definition\";\n\nimport { StateBase } from \"./state-base\";\n\nexport class DefaultGlobalState<T>\n  extends StateBase<T, KeyDefinition<T>>\n  implements GlobalState<T>\n{\n  constructor(\n    keyDefinition: KeyDefinition<T>,\n    chosenLocation: AbstractStorageService & ObservableStorageService,\n  ) {\n    super(globalKeyBuilder(keyDefinition), chosenLocation, keyDefinition);\n  }\n}\n","import { StorageServiceProvider } from \"../../services/storage-service.provider\";\nimport { GlobalState } from \"../global-state\";\nimport { GlobalStateProvider } from \"../global-state.provider\";\nimport { KeyDefinition } from \"../key-definition\";\n\nimport { DefaultGlobalState } from \"./default-global-state\";\n\nexport class DefaultGlobalStateProvider implements GlobalStateProvider {\n  private globalStateCache: Record<string, GlobalState<unknown>> = {};\n\n  constructor(private storageServiceProvider: StorageServiceProvider) {}\n\n  get<T>(keyDefinition: KeyDefinition<T>): GlobalState<T> {\n    const [location, storageService] = this.storageServiceProvider.get(\n      keyDefinition.stateDefinition.defaultStorageLocation,\n      keyDefinition.stateDefinition.storageLocationOverrides,\n    );\n    const cacheKey = this.buildCacheKey(location, keyDefinition);\n    const existingGlobalState = this.globalStateCache[cacheKey];\n    if (existingGlobalState != null) {\n      // The cast into the actual generic is safe because of rules around key definitions\n      // being unique.\n      return existingGlobalState as DefaultGlobalState<T>;\n    }\n\n    const newGlobalState = new DefaultGlobalState<T>(keyDefinition, storageService);\n\n    this.globalStateCache[cacheKey] = newGlobalState;\n    return newGlobalState;\n  }\n\n  private buildCacheKey(location: string, keyDefinition: KeyDefinition<unknown>) {\n    return `${location}_${keyDefinition.fullName}`;\n  }\n}\n","import { Observable, combineLatest, of } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { StateEventRegistrarService } from \"../state-event-registrar.service\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { CombinedState, SingleUserState } from \"../user-state\";\n\nimport { StateBase } from \"./state-base\";\n\nexport class DefaultSingleUserState<T>\n  extends StateBase<T, UserKeyDefinition<T>>\n  implements SingleUserState<T>\n{\n  readonly combinedState$: Observable<CombinedState<T>>;\n\n  constructor(\n    readonly userId: UserId,\n    keyDefinition: UserKeyDefinition<T>,\n    chosenLocation: AbstractStorageService & ObservableStorageService,\n    private stateEventRegistrarService: StateEventRegistrarService,\n  ) {\n    super(keyDefinition.buildKey(userId), chosenLocation, keyDefinition);\n    this.combinedState$ = combineLatest([of(userId), this.state$]);\n  }\n\n  protected override async doStorageSave(newState: T, oldState: T): Promise<void> {\n    await super.doStorageSave(newState, oldState);\n    if (newState != null && oldState == null) {\n      await this.stateEventRegistrarService.registerEvents(this.keyDefinition);\n    }\n  }\n}\n","import { UserId } from \"../../../types/guid\";\nimport { StorageServiceProvider } from \"../../services/storage-service.provider\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateEventRegistrarService } from \"../state-event-registrar.service\";\nimport { UserKeyDefinition, isUserKeyDefinition } from \"../user-key-definition\";\nimport { SingleUserState } from \"../user-state\";\nimport { SingleUserStateProvider } from \"../user-state.provider\";\n\nimport { DefaultSingleUserState } from \"./default-single-user-state\";\n\nexport class DefaultSingleUserStateProvider implements SingleUserStateProvider {\n  private cache: Record<string, SingleUserState<unknown>> = {};\n\n  constructor(\n    private readonly storageServiceProvider: StorageServiceProvider,\n    private readonly stateEventRegistrarService: StateEventRegistrarService,\n  ) {}\n\n  get<T>(\n    userId: UserId,\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n  ): SingleUserState<T> {\n    if (!isUserKeyDefinition(keyDefinition)) {\n      keyDefinition = UserKeyDefinition.fromBaseKeyDefinition(keyDefinition);\n    }\n    const [location, storageService] = this.storageServiceProvider.get(\n      keyDefinition.stateDefinition.defaultStorageLocation,\n      keyDefinition.stateDefinition.storageLocationOverrides,\n    );\n    const cacheKey = this.buildCacheKey(location, userId, keyDefinition);\n    const existingUserState = this.cache[cacheKey];\n    if (existingUserState != null) {\n      // I have to cast out of the unknown generic but this should be safe if rules\n      // around domain token are made\n      return existingUserState as SingleUserState<T>;\n    }\n\n    const newUserState = new DefaultSingleUserState<T>(\n      userId,\n      keyDefinition,\n      storageService,\n      this.stateEventRegistrarService,\n    );\n    this.cache[cacheKey] = newUserState;\n    return newUserState;\n  }\n\n  private buildCacheKey(\n    location: string,\n    userId: UserId,\n    keyDefinition: UserKeyDefinition<unknown>,\n  ) {\n    return `${location}_${keyDefinition.fullName}_${userId}`;\n  }\n}\n","import { Observable, filter, of, switchMap, take } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport { DerivedStateDependencies } from \"../../../types/state\";\nimport { DeriveDefinition } from \"../derive-definition\";\nimport { DerivedState } from \"../derived-state\";\nimport { DerivedStateProvider } from \"../derived-state.provider\";\nimport { GlobalStateProvider } from \"../global-state.provider\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateProvider } from \"../state.provider\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserStateProvider, SingleUserStateProvider } from \"../user-state.provider\";\n\nexport class DefaultStateProvider implements StateProvider {\n  activeUserId$: Observable<UserId>;\n  constructor(\n    private readonly activeUserStateProvider: ActiveUserStateProvider,\n    private readonly singleUserStateProvider: SingleUserStateProvider,\n    private readonly globalStateProvider: GlobalStateProvider,\n    private readonly derivedStateProvider: DerivedStateProvider,\n  ) {\n    this.activeUserId$ = this.activeUserStateProvider.activeUserId$;\n  }\n\n  getUserState$<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    userId?: UserId,\n  ): Observable<T> {\n    if (userId) {\n      return this.getUser<T>(userId, keyDefinition).state$;\n    } else {\n      return this.activeUserId$.pipe(\n        filter((userId) => userId != null), // Filter out null-ish user ids since we can't get state for a null user id\n        take(1),\n        switchMap((userId) => this.getUser<T>(userId, keyDefinition).state$),\n      );\n    }\n  }\n\n  getUserStateOrDefault$<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    config: { userId: UserId | undefined; defaultValue?: T },\n  ): Observable<T> {\n    const { userId, defaultValue = null } = config;\n    if (userId) {\n      return this.getUser<T>(userId, keyDefinition).state$;\n    } else {\n      return this.activeUserId$.pipe(\n        take(1),\n        switchMap((userId) =>\n          userId != null ? this.getUser<T>(userId, keyDefinition).state$ : of(defaultValue),\n        ),\n      );\n    }\n  }\n\n  async setUserState<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]> {\n    if (userId) {\n      return [userId, await this.getUser<T>(userId, keyDefinition).update(() => value)];\n    } else {\n      return await this.getActive<T>(keyDefinition).update(() => value);\n    }\n  }\n\n  getActive: InstanceType<typeof ActiveUserStateProvider>[\"get\"] =\n    this.activeUserStateProvider.get.bind(this.activeUserStateProvider);\n  getUser: InstanceType<typeof SingleUserStateProvider>[\"get\"] =\n    this.singleUserStateProvider.get.bind(this.singleUserStateProvider);\n  getGlobal: InstanceType<typeof GlobalStateProvider>[\"get\"] = this.globalStateProvider.get.bind(\n    this.globalStateProvider,\n  );\n  getDerived: <TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<unknown, TTo, TDeps>,\n    dependencies: TDeps,\n  ) => DerivedState<TTo> = this.derivedStateProvider.get.bind(this.derivedStateProvider);\n}\n","import { Observable, concatMap } from \"rxjs\";\n\nimport { DerivedStateDependencies } from \"../../../types/state\";\nimport { DeriveDefinition } from \"../derive-definition\";\nimport { DerivedState } from \"../derived-state\";\nimport { DerivedStateProvider } from \"../derived-state.provider\";\n\nexport class InlineDerivedStateProvider implements DerivedStateProvider {\n  get<TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ): DerivedState<TTo> {\n    return new InlineDerivedState(parentState$, deriveDefinition, dependencies);\n  }\n}\n\nexport class InlineDerivedState<TFrom, TTo, TDeps extends DerivedStateDependencies>\n  implements DerivedState<TTo>\n{\n  constructor(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ) {\n    this.state$ = parentState$.pipe(\n      concatMap(async (value) => await deriveDefinition.derive(value, dependencies)),\n    );\n  }\n\n  state$: Observable<TTo>;\n\n  forceValue(value: TTo): Promise<TTo> {\n    // No need to force anything, we don't keep a cache\n    return Promise.resolve(value);\n  }\n}\n","import { Observable, map } from \"rxjs\";\n\nimport { ThemeType } from \"../enums\";\nimport { GlobalStateProvider, KeyDefinition, THEMING_DISK } from \"../state\";\n\nexport abstract class ThemeStateService {\n  /**\n   * The users selected theme.\n   */\n  abstract selectedTheme$: Observable<ThemeType>;\n\n  /**\n   * A method for updating the current users configured theme.\n   * @param theme The chosen user theme.\n   */\n  abstract setSelectedTheme(theme: ThemeType): Promise<void>;\n}\n\nconst THEME_SELECTION = new KeyDefinition<ThemeType>(THEMING_DISK, \"selection\", {\n  deserializer: (s) => s,\n});\n\nexport class DefaultThemeStateService implements ThemeStateService {\n  private readonly selectedThemeState = this.globalStateProvider.get(THEME_SELECTION);\n\n  selectedTheme$ = this.selectedThemeState.state$.pipe(map((theme) => theme ?? this.defaultTheme));\n\n  constructor(\n    private globalStateProvider: GlobalStateProvider,\n    private defaultTheme: ThemeType = ThemeType.System,\n  ) {}\n\n  async setSelectedTheme(theme: ThemeType): Promise<void> {\n    await this.selectedThemeState.update(() => theme, {\n      shouldUpdate: (currentTheme) => currentTheme !== theme,\n    });\n  }\n}\n","import { BillingSyncConfigApi } from \"../../../billing/models/api/billing-sync-config.api\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { OrganizationConnectionType } from \"../../enums\";\nimport { ScimConfigApi } from \"../api/scim-config.api\";\n\n/**API response config types for OrganizationConnectionResponse */\nexport type OrganizationConnectionConfigApis = BillingSyncConfigApi | ScimConfigApi;\n\nexport class OrganizationConnectionResponse<\n  TConfig extends OrganizationConnectionConfigApis,\n> extends BaseResponse {\n  id: string;\n  type: OrganizationConnectionType;\n  organizationId: string;\n  enabled: boolean;\n  config: TConfig;\n\n  constructor(response: any, configType: { new (response: any): TConfig }) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    const rawConfig = this.getResponseProperty(\"Config\");\n    this.config = rawConfig == null ? null : new configType(rawConfig);\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class CardApi extends BaseResponse {\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.cardholderName = this.getResponseProperty(\"CardholderName\");\n    this.brand = this.getResponseProperty(\"Brand\");\n    this.number = this.getResponseProperty(\"Number\");\n    this.expMonth = this.getResponseProperty(\"ExpMonth\");\n    this.expYear = this.getResponseProperty(\"ExpYear\");\n    this.code = this.getResponseProperty(\"Code\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\n\nexport class FieldApi extends BaseResponse {\n  name: string;\n  value: string;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.value = this.getResponseProperty(\"Value\");\n    this.linkedId = this.getResponseProperty(\"linkedId\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class IdentityApi extends BaseResponse {\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.title = this.getResponseProperty(\"Title\");\n    this.firstName = this.getResponseProperty(\"FirstName\");\n    this.middleName = this.getResponseProperty(\"MiddleName\");\n    this.lastName = this.getResponseProperty(\"LastName\");\n    this.address1 = this.getResponseProperty(\"Address1\");\n    this.address2 = this.getResponseProperty(\"Address2\");\n    this.address3 = this.getResponseProperty(\"Address3\");\n    this.city = this.getResponseProperty(\"City\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.country = this.getResponseProperty(\"Country\");\n    this.company = this.getResponseProperty(\"Company\");\n    this.email = this.getResponseProperty(\"Email\");\n    this.phone = this.getResponseProperty(\"Phone\");\n    this.ssn = this.getResponseProperty(\"SSN\");\n    this.username = this.getResponseProperty(\"Username\");\n    this.passportNumber = this.getResponseProperty(\"PassportNumber\");\n    this.licenseNumber = this.getResponseProperty(\"LicenseNumber\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class Fido2CredentialApi extends BaseResponse {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n\n    this.credentialId = this.getResponseProperty(\"CredentialId\");\n    this.keyType = this.getResponseProperty(\"KeyType\");\n    this.keyAlgorithm = this.getResponseProperty(\"KeyAlgorithm\");\n    this.keyCurve = this.getResponseProperty(\"KeyCurve\");\n    this.keyValue = this.getResponseProperty(\"keyValue\");\n    this.rpId = this.getResponseProperty(\"RpId\");\n    this.userHandle = this.getResponseProperty(\"UserHandle\");\n    this.userName = this.getResponseProperty(\"UserName\");\n    this.counter = this.getResponseProperty(\"Counter\");\n    this.rpName = this.getResponseProperty(\"RpName\");\n    this.userDisplayName = this.getResponseProperty(\"UserDisplayName\");\n    this.discoverable = this.getResponseProperty(\"Discoverable\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n  }\n}\n","import { UriMatchStrategySetting } from \"../../../models/domain/domain-service\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class LoginUriApi extends BaseResponse {\n  uri: string;\n  uriChecksum: string;\n  match: UriMatchStrategySetting = null;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.uri = this.getResponseProperty(\"Uri\");\n    this.uriChecksum = this.getResponseProperty(\"UriChecksum\");\n    const match = this.getResponseProperty(\"Match\");\n    this.match = match != null ? match : null;\n  }\n}\n","import { JsonObject } from \"type-fest\";\n\nimport { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { Fido2CredentialApi } from \"./fido2-credential.api\";\nimport { LoginUriApi } from \"./login-uri.api\";\n\nexport class LoginApi extends BaseResponse {\n  uris: LoginUriApi[];\n  username: string;\n  password: string;\n  passwordRevisionDate: string;\n  totp: string;\n  autofillOnPageLoad: boolean;\n  fido2Credentials?: Fido2CredentialApi[];\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.username = this.getResponseProperty(\"Username\");\n    this.password = this.getResponseProperty(\"Password\");\n    this.passwordRevisionDate = this.getResponseProperty(\"PasswordRevisionDate\");\n    this.totp = this.getResponseProperty(\"Totp\");\n    this.autofillOnPageLoad = this.getResponseProperty(\"AutofillOnPageLoad\");\n\n    const uris = this.getResponseProperty(\"Uris\");\n    if (uris != null) {\n      this.uris = uris.map((u: any) => new LoginUriApi(u));\n    }\n\n    const fido2Credentials = this.getResponseProperty(\"Fido2Credentials\");\n    if (fido2Credentials != null) {\n      this.fido2Credentials = fido2Credentials.map(\n        (key: JsonObject) => new Fido2CredentialApi(key),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { SecureNoteType } from \"../../enums\";\n\nexport class SecureNoteApi extends BaseResponse {\n  type: SecureNoteType;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.type = this.getResponseProperty(\"Type\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class AttachmentResponse extends BaseResponse {\n  id: string;\n  url: string;\n  fileName: string;\n  key: string;\n  size: string;\n  sizeName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.url = this.getResponseProperty(\"Url\");\n    this.fileName = this.getResponseProperty(\"FileName\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.size = this.getResponseProperty(\"Size\");\n    this.sizeName = this.getResponseProperty(\"SizeName\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class PasswordHistoryResponse extends BaseResponse {\n  password: string;\n  lastUsedDate: string;\n\n  constructor(response: any) {\n    super(response);\n    this.password = this.getResponseProperty(\"Password\");\n    this.lastUsedDate = this.getResponseProperty(\"LastUsedDate\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CardApi } from \"../api/card.api\";\nimport { FieldApi } from \"../api/field.api\";\nimport { IdentityApi } from \"../api/identity.api\";\nimport { LoginApi } from \"../api/login.api\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\n\nimport { AttachmentResponse } from \"./attachment.response\";\nimport { PasswordHistoryResponse } from \"./password-history.response\";\n\nexport class CipherResponse extends BaseResponse {\n  id: string;\n  organizationId: string;\n  folderId: string;\n  type: number;\n  name: string;\n  notes: string;\n  fields: FieldApi[];\n  login: LoginApi;\n  card: CardApi;\n  identity: IdentityApi;\n  secureNote: SecureNoteApi;\n  favorite: boolean;\n  edit: boolean;\n  viewPassword: boolean;\n  organizationUseTotp: boolean;\n  revisionDate: string;\n  attachments: AttachmentResponse[];\n  passwordHistory: PasswordHistoryResponse[];\n  collectionIds: string[];\n  creationDate: string;\n  deletedDate: string;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.folderId = this.getResponseProperty(\"FolderId\") || null;\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.notes = this.getResponseProperty(\"Notes\");\n    this.favorite = this.getResponseProperty(\"Favorite\") || false;\n    this.edit = !!this.getResponseProperty(\"Edit\");\n    if (this.getResponseProperty(\"ViewPassword\") == null) {\n      this.viewPassword = true;\n    } else {\n      this.viewPassword = this.getResponseProperty(\"ViewPassword\");\n    }\n    this.organizationUseTotp = this.getResponseProperty(\"OrganizationUseTotp\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.collectionIds = this.getResponseProperty(\"CollectionIds\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.deletedDate = this.getResponseProperty(\"DeletedDate\");\n\n    const login = this.getResponseProperty(\"Login\");\n    if (login != null) {\n      this.login = new LoginApi(login);\n    }\n\n    const card = this.getResponseProperty(\"Card\");\n    if (card != null) {\n      this.card = new CardApi(card);\n    }\n\n    const identity = this.getResponseProperty(\"Identity\");\n    if (identity != null) {\n      this.identity = new IdentityApi(identity);\n    }\n\n    const secureNote = this.getResponseProperty(\"SecureNote\");\n    if (secureNote != null) {\n      this.secureNote = new SecureNoteApi(secureNote);\n    }\n\n    const fields = this.getResponseProperty(\"Fields\");\n    if (fields != null) {\n      this.fields = fields.map((f: any) => new FieldApi(f));\n    }\n\n    const attachments = this.getResponseProperty(\"Attachments\");\n    if (attachments != null) {\n      this.attachments = attachments.map((a: any) => new AttachmentResponse(a));\n    }\n\n    const passwordHistory = this.getResponseProperty(\"PasswordHistory\");\n    if (passwordHistory != null) {\n      this.passwordHistory = passwordHistory.map((h: any) => new PasswordHistoryResponse(h));\n    }\n\n    this.reprompt = this.getResponseProperty(\"Reprompt\") || CipherRepromptType.None;\n    this.key = this.getResponseProperty(\"Key\") || null;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SelectionReadOnlyResponse extends BaseResponse {\n  id: string;\n  readOnly: boolean;\n  hidePasswords: boolean;\n  manage: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.readOnly = this.getResponseProperty(\"ReadOnly\");\n    this.hidePasswords = this.getResponseProperty(\"HidePasswords\");\n    this.manage = this.getResponseProperty(\"Manage\");\n  }\n}\n","import { SelectionReadOnlyResponse } from \"../../../admin-console/models/response/selection-read-only.response\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { CollectionId, OrganizationId } from \"../../../types/guid\";\n\nexport class CollectionResponse extends BaseResponse {\n  id: CollectionId;\n  organizationId: OrganizationId;\n  name: string;\n  externalId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.externalId = this.getResponseProperty(\"ExternalId\");\n  }\n}\n\nexport class CollectionDetailsResponse extends CollectionResponse {\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n\n  /**\n   * Flag indicating the user has been explicitly assigned to this Collection\n   */\n  assigned: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.readOnly = this.getResponseProperty(\"ReadOnly\") || false;\n    this.manage = this.getResponseProperty(\"Manage\") || false;\n    this.hidePasswords = this.getResponseProperty(\"HidePasswords\") || false;\n\n    // Temporary until the API is updated to return this property in AC-2084\n    // For now, we can assume that if the object is 'collectionDetails' then the user is assigned\n    this.assigned = this.getResponseProperty(\"object\") == \"collectionDetails\";\n  }\n}\n\nexport class CollectionAccessDetailsResponse extends CollectionDetailsResponse {\n  groups: SelectionReadOnlyResponse[] = [];\n  users: SelectionReadOnlyResponse[] = [];\n  unmanaged: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.assigned = this.getResponseProperty(\"Assigned\") || false;\n    this.unmanaged = this.getResponseProperty(\"Unmanaged\") || false;\n\n    const groups = this.getResponseProperty(\"Groups\");\n    if (groups != null) {\n      this.groups = groups.map((g: any) => new SelectionReadOnlyResponse(g));\n    }\n\n    const users = this.getResponseProperty(\"Users\");\n    if (users != null) {\n      this.users = users.map((g: any) => new SelectionReadOnlyResponse(g));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { CipherResponse } from \"../../../vault/models/response/cipher.response\";\nimport { CollectionResponse } from \"../../../vault/models/response/collection.response\";\n\nexport class OrganizationExportResponse extends BaseResponse {\n  collections: CollectionResponse[];\n  ciphers: CipherResponse[];\n\n  constructor(response: any) {\n    super(response);\n    const collections = this.getResponseProperty(\"Collections\");\n    if (collections != null) {\n      this.collections = collections.map((c: any) => new CollectionResponse(c));\n    }\n    const ciphers = this.getResponseProperty(\"Ciphers\");\n    if (ciphers != null) {\n      this.ciphers = ciphers.map((c: any) => new CipherResponse(c));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class OrganizationSponsorshipSyncStatusResponse extends BaseResponse {\n  lastSyncDate?: Date;\n\n  constructor(response: any) {\n    super(response);\n    const lastSyncDate = this.getResponseProperty(\"LastSyncDate\");\n    if (lastSyncDate) {\n      this.lastSyncDate = new Date(lastSyncDate);\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class ProviderOrganizationResponse extends BaseResponse {\n  id: string;\n  providerId: string;\n  organizationId: string;\n  key: string;\n  settings: string;\n  creationDate: string;\n  revisionDate: string;\n  userCount: number;\n  seats?: number;\n  plan?: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.settings = this.getResponseProperty(\"Settings\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.userCount = this.getResponseProperty(\"UserCount\");\n    this.seats = this.getResponseProperty(\"Seats\");\n    this.plan = this.getResponseProperty(\"Plan\");\n  }\n}\n\nexport class ProviderOrganizationOrganizationDetailsResponse extends ProviderOrganizationResponse {\n  organizationName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.organizationName = this.getResponseProperty(\"OrganizationName\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class OrganizationUserBulkPublicKeyResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { OrganizationUserBulkPublicKeyResponse } from \"../../../abstractions/organization-user/responses\";\n\nexport class ProviderUserBulkPublicKeyResponse extends OrganizationUserBulkPublicKeyResponse {}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class ProviderUserBulkResponse extends BaseResponse {\n  id: string;\n  error: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.error = this.getResponseProperty(\"Error\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class PermissionsApi extends BaseResponse {\n  accessEventLogs: boolean;\n  accessImportExport: boolean;\n  accessReports: boolean;\n  createNewCollections: boolean;\n  editAnyCollection: boolean;\n  deleteAnyCollection: boolean;\n  editAssignedCollections: boolean;\n  deleteAssignedCollections: boolean;\n  manageCiphers: boolean;\n  manageGroups: boolean;\n  manageSso: boolean;\n  managePolicies: boolean;\n  manageUsers: boolean;\n  manageResetPassword: boolean;\n  manageScim: boolean;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return this;\n    }\n    this.accessEventLogs = this.getResponseProperty(\"AccessEventLogs\");\n    this.accessImportExport = this.getResponseProperty(\"AccessImportExport\");\n    this.accessReports = this.getResponseProperty(\"AccessReports\");\n\n    this.createNewCollections = this.getResponseProperty(\"CreateNewCollections\");\n    this.editAnyCollection = this.getResponseProperty(\"EditAnyCollection\");\n    this.deleteAnyCollection = this.getResponseProperty(\"DeleteAnyCollection\");\n    this.editAssignedCollections = this.getResponseProperty(\"EditAssignedCollections\");\n    this.deleteAssignedCollections = this.getResponseProperty(\"DeleteAssignedCollections\");\n\n    this.manageCiphers = this.getResponseProperty(\"ManageCiphers\");\n    this.manageGroups = this.getResponseProperty(\"ManageGroups\");\n    this.manageSso = this.getResponseProperty(\"ManageSso\");\n    this.managePolicies = this.getResponseProperty(\"ManagePolicies\");\n    this.manageUsers = this.getResponseProperty(\"ManageUsers\");\n    this.manageResetPassword = this.getResponseProperty(\"ManageResetPassword\");\n    this.manageScim = this.getResponseProperty(\"ManageScim\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { ProviderUserStatusType, ProviderUserType } from \"../../../enums\";\nimport { PermissionsApi } from \"../../api/permissions.api\";\n\nexport class ProviderUserResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  type: ProviderUserType;\n  status: ProviderUserStatusType;\n  permissions: PermissionsApi;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"Permissions\"));\n  }\n}\n\nexport class ProviderUserUserDetailsResponse extends ProviderUserResponse {\n  name: string;\n  email: string;\n\n  constructor(response: any) {\n    super(response);\n    this.name = this.getResponseProperty(\"Name\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class ApiKeyResponse extends BaseResponse {\n  apiKey: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.apiKey = this.getResponseProperty(\"ApiKey\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n","import { DeviceType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\n\nconst RequestTimeOut = 60000 * 15; //15 Minutes\n\nexport class AuthRequestResponse extends BaseResponse {\n  id: string;\n  publicKey: string;\n  requestDeviceType: DeviceType;\n  requestIpAddress: string;\n  key: string;\n  masterPasswordHash: string;\n  creationDate: string;\n  requestApproved?: boolean;\n  responseDate?: string;\n  isAnswered: boolean;\n  isExpired: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.publicKey = this.getResponseProperty(\"PublicKey\");\n    this.requestDeviceType = this.getResponseProperty(\"RequestDeviceType\");\n    this.requestIpAddress = this.getResponseProperty(\"RequestIpAddress\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.masterPasswordHash = this.getResponseProperty(\"MasterPasswordHash\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.requestApproved = this.getResponseProperty(\"RequestApproved\");\n    this.responseDate = this.getResponseProperty(\"ResponseDate\");\n\n    const requestDate = new Date(this.creationDate);\n    const requestDateUTC = Date.UTC(\n      requestDate.getUTCFullYear(),\n      requestDate.getUTCMonth(),\n      requestDate.getDate(),\n      requestDate.getUTCHours(),\n      requestDate.getUTCMinutes(),\n      requestDate.getUTCSeconds(),\n      requestDate.getUTCMilliseconds(),\n    );\n\n    const dateNow = new Date(Date.now());\n    const dateNowUTC = Date.UTC(\n      dateNow.getUTCFullYear(),\n      dateNow.getUTCMonth(),\n      dateNow.getDate(),\n      dateNow.getUTCHours(),\n      dateNow.getUTCMinutes(),\n      dateNow.getUTCSeconds(),\n      dateNow.getUTCMilliseconds(),\n    );\n\n    this.isExpired = dateNowUTC - requestDateUTC >= RequestTimeOut;\n    this.isAnswered = this.requestApproved != null && this.responseDate != null;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class DeviceVerificationResponse extends BaseResponse {\n  isDeviceVerificationSectionEnabled: boolean;\n  unknownDeviceVerificationEnabled: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.isDeviceVerificationSectionEnabled = this.getResponseProperty(\n      \"IsDeviceVerificationSectionEnabled\",\n    );\n    this.unknownDeviceVerificationEnabled = this.getResponseProperty(\n      \"UnknownDeviceVerificationEnabled\",\n    );\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class IdentityCaptchaResponse extends BaseResponse {\n  siteKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.siteKey = this.getResponseProperty(\"HCaptcha_SiteKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { TwoFactorProviderType } from \"../../enums/two-factor-provider-type\";\n\nimport { MasterPasswordPolicyResponse } from \"./master-password-policy.response\";\n\nexport class IdentityTwoFactorResponse extends BaseResponse {\n  // contains available two-factor providers\n  twoFactorProviders: TwoFactorProviderType[];\n  // a map of two-factor providers to necessary data for completion\n  twoFactorProviders2: Record<TwoFactorProviderType, Record<string, string>>;\n  captchaToken: string;\n  ssoEmail2faSessionToken: string;\n  email?: string;\n  masterPasswordPolicy?: MasterPasswordPolicyResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.captchaToken = this.getResponseProperty(\"CaptchaBypassToken\");\n    this.twoFactorProviders = this.getResponseProperty(\"TwoFactorProviders\");\n    this.twoFactorProviders2 = this.getResponseProperty(\"TwoFactorProviders2\");\n    this.masterPasswordPolicy = new MasterPasswordPolicyResponse(\n      this.getResponseProperty(\"MasterPasswordPolicy\"),\n    );\n\n    this.ssoEmail2faSessionToken = this.getResponseProperty(\"SsoEmail2faSessionToken\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class KeyConnectorUserKeyResponse extends BaseResponse {\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { KdfType } from \"../../../platform/enums\";\n\nexport class PreloginResponse extends BaseResponse {\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n\n  constructor(response: any) {\n    super(response);\n    this.kdf = this.getResponseProperty(\"Kdf\");\n    this.kdfIterations = this.getResponseProperty(\"KdfIterations\");\n    this.kdfMemory = this.getResponseProperty(\"KdfMemory\");\n    this.kdfParallelism = this.getResponseProperty(\"KdfParallelism\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { ICaptchaProtectedResponse } from \"./captcha-protected.response\";\n\nexport class RegisterResponse extends BaseResponse implements ICaptchaProtectedResponse {\n  captchaBypassToken: string;\n\n  constructor(response: any) {\n    super(response);\n    this.captchaBypassToken = this.getResponseProperty(\"CaptchaBypassToken\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SsoPreValidateResponse extends BaseResponse {\n  token: string;\n\n  constructor(response: any) {\n    super(response);\n    this.token = this.getResponseProperty(\"Token\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorAuthenticatorResponse extends BaseResponse {\n  enabled: boolean;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorDuoResponse extends BaseResponse {\n  enabled: boolean;\n  host: string;\n  secretKey: string;\n  integrationKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.host = this.getResponseProperty(\"Host\");\n    this.secretKey = this.getResponseProperty(\"SecretKey\");\n    this.integrationKey = this.getResponseProperty(\"IntegrationKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorEmailResponse extends BaseResponse {\n  enabled: boolean;\n  email: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { TwoFactorProviderType } from \"../../enums/two-factor-provider-type\";\n\nexport class TwoFactorProviderResponse extends BaseResponse {\n  enabled: boolean;\n  type: TwoFactorProviderType;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.type = this.getResponseProperty(\"Type\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorRecoverResponse extends BaseResponse {\n  code: string;\n\n  constructor(response: any) {\n    super(response);\n    this.code = this.getResponseProperty(\"Code\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { Utils } from \"../../../platform/misc/utils\";\n\nexport class TwoFactorWebAuthnResponse extends BaseResponse {\n  enabled: boolean;\n  keys: KeyResponse[];\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    const keys = this.getResponseProperty(\"Keys\");\n    this.keys = keys == null ? null : keys.map((k: any) => new KeyResponse(k));\n  }\n}\n\nexport class KeyResponse extends BaseResponse {\n  name: string;\n  id: number;\n  migrated: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.name = this.getResponseProperty(\"Name\");\n    this.id = this.getResponseProperty(\"Id\");\n    this.migrated = this.getResponseProperty(\"Migrated\");\n  }\n}\n\nexport class ChallengeResponse extends BaseResponse implements PublicKeyCredentialCreationOptions {\n  attestation?: AttestationConveyancePreference;\n  authenticatorSelection?: AuthenticatorSelectionCriteria;\n  challenge: BufferSource;\n  excludeCredentials?: PublicKeyCredentialDescriptor[];\n  extensions?: AuthenticationExtensionsClientInputs;\n  pubKeyCredParams: PublicKeyCredentialParameters[];\n  rp: PublicKeyCredentialRpEntity;\n  timeout?: number;\n  user: PublicKeyCredentialUserEntity;\n\n  constructor(response: any) {\n    super(response);\n    this.attestation = this.getResponseProperty(\"attestation\");\n    this.authenticatorSelection = this.getResponseProperty(\"authenticatorSelection\");\n    this.challenge = Utils.fromUrlB64ToArray(this.getResponseProperty(\"challenge\"));\n    this.excludeCredentials = this.getResponseProperty(\"excludeCredentials\").map((c: any) => {\n      c.id = Utils.fromUrlB64ToArray(c.id).buffer;\n      return c;\n    });\n    this.extensions = this.getResponseProperty(\"extensions\");\n    this.pubKeyCredParams = this.getResponseProperty(\"pubKeyCredParams\");\n    this.rp = this.getResponseProperty(\"rp\");\n    this.timeout = this.getResponseProperty(\"timeout\");\n\n    const user = this.getResponseProperty(\"user\");\n    user.id = Utils.fromUrlB64ToArray(user.id);\n\n    this.user = user;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorYubiKeyResponse extends BaseResponse {\n  enabled: boolean;\n  key1: string;\n  key2: string;\n  key3: string;\n  key4: string;\n  key5: string;\n  nfc: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.key1 = this.getResponseProperty(\"Key1\");\n    this.key2 = this.getResponseProperty(\"Key2\");\n    this.key3 = this.getResponseProperty(\"Key3\");\n    this.key4 = this.getResponseProperty(\"Key4\");\n    this.key5 = this.getResponseProperty(\"Key5\");\n    this.nfc = this.getResponseProperty(\"Nfc\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { PaymentMethodType, TransactionType } from \"../../enums\";\n\nexport class BillingResponse extends BaseResponse {\n  balance: number;\n  paymentSource: BillingSourceResponse;\n  invoices: BillingInvoiceResponse[] = [];\n  transactions: BillingTransactionResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.balance = this.getResponseProperty(\"Balance\");\n    const paymentSource = this.getResponseProperty(\"PaymentSource\");\n    const transactions = this.getResponseProperty(\"Transactions\");\n    const invoices = this.getResponseProperty(\"Invoices\");\n    this.paymentSource = paymentSource == null ? null : new BillingSourceResponse(paymentSource);\n    if (transactions != null) {\n      this.transactions = transactions.map((t: any) => new BillingTransactionResponse(t));\n    }\n    if (invoices != null) {\n      this.invoices = invoices.map((i: any) => new BillingInvoiceResponse(i));\n    }\n  }\n\n  get hasNoHistory() {\n    return this.invoices.length == 0 && this.transactions.length == 0;\n  }\n}\n\nexport class BillingSourceResponse extends BaseResponse {\n  type: PaymentMethodType;\n  cardBrand: string;\n  description: string;\n  needsVerification: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.cardBrand = this.getResponseProperty(\"CardBrand\");\n    this.description = this.getResponseProperty(\"Description\");\n    this.needsVerification = this.getResponseProperty(\"NeedsVerification\");\n  }\n}\n\nexport class BillingInvoiceResponse extends BaseResponse {\n  url: string;\n  pdfUrl: string;\n  number: string;\n  paid: boolean;\n  date: string;\n  amount: number;\n\n  constructor(response: any) {\n    super(response);\n    this.url = this.getResponseProperty(\"Url\");\n    this.pdfUrl = this.getResponseProperty(\"PdfUrl\");\n    this.number = this.getResponseProperty(\"Number\");\n    this.paid = this.getResponseProperty(\"Paid\");\n    this.date = this.getResponseProperty(\"Date\");\n    this.amount = this.getResponseProperty(\"Amount\");\n  }\n}\n\nexport class BillingTransactionResponse extends BaseResponse {\n  createdDate: string;\n  amount: number;\n  refunded: boolean;\n  partiallyRefunded: boolean;\n  refundedAmount: number;\n  type: TransactionType;\n  paymentMethodType: PaymentMethodType;\n  details: string;\n\n  constructor(response: any) {\n    super(response);\n    this.createdDate = this.getResponseProperty(\"CreatedDate\");\n    this.amount = this.getResponseProperty(\"Amount\");\n    this.refunded = this.getResponseProperty(\"Refunded\");\n    this.partiallyRefunded = this.getResponseProperty(\"PartiallyRefunded\");\n    this.refundedAmount = this.getResponseProperty(\"RefundedAmount\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.paymentMethodType = this.getResponseProperty(\"PaymentMethodType\");\n    this.details = this.getResponseProperty(\"Details\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { BillingInvoiceResponse, BillingTransactionResponse } from \"./billing.response\";\n\nexport class BillingHistoryResponse extends BaseResponse {\n  invoices: BillingInvoiceResponse[] = [];\n  transactions: BillingTransactionResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    const transactions = this.getResponseProperty(\"Transactions\");\n    const invoices = this.getResponseProperty(\"Invoices\");\n    if (transactions != null) {\n      this.transactions = transactions.map((t: any) => new BillingTransactionResponse(t));\n    }\n    if (invoices != null) {\n      this.invoices = invoices.map((i: any) => new BillingInvoiceResponse(i));\n    }\n  }\n\n  get hasNoHistory() {\n    return this.invoices.length == 0 && this.transactions.length == 0;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { BillingSourceResponse } from \"./billing.response\";\n\nexport class BillingPaymentResponse extends BaseResponse {\n  balance: number;\n  paymentSource: BillingSourceResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.balance = this.getResponseProperty(\"Balance\");\n    const paymentSource = this.getResponseProperty(\"PaymentSource\");\n    this.paymentSource = paymentSource == null ? null : new BillingSourceResponse(paymentSource);\n  }\n}\n","import { ProductType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\n\nexport class ProfileOrganizationResponse extends BaseResponse {\n  id: string;\n  name: string;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  key: string;\n  hasPublicAndPrivateKeys: boolean;\n  status: OrganizationUserStatusType;\n  type: OrganizationUserType;\n  enabled: boolean;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  limitCollectionCreationDeletion: boolean;\n  allowAdminAccessToAllCollectionItems: boolean;\n  flexibleCollections: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.usePolicies = this.getResponseProperty(\"UsePolicies\");\n    this.useGroups = this.getResponseProperty(\"UseGroups\");\n    this.useDirectory = this.getResponseProperty(\"UseDirectory\");\n    this.useEvents = this.getResponseProperty(\"UseEvents\");\n    this.useTotp = this.getResponseProperty(\"UseTotp\");\n    this.use2fa = this.getResponseProperty(\"Use2fa\");\n    this.useApi = this.getResponseProperty(\"UseApi\");\n    this.useSso = this.getResponseProperty(\"UseSso\");\n    this.useKeyConnector = this.getResponseProperty(\"UseKeyConnector\") ?? false;\n    this.useScim = this.getResponseProperty(\"UseScim\") ?? false;\n    this.useCustomPermissions = this.getResponseProperty(\"UseCustomPermissions\") ?? false;\n    this.useResetPassword = this.getResponseProperty(\"UseResetPassword\");\n    this.useSecretsManager = this.getResponseProperty(\"UseSecretsManager\");\n    this.usePasswordManager = this.getResponseProperty(\"UsePasswordManager\");\n    this.useActivateAutofillPolicy = this.getResponseProperty(\"UseActivateAutofillPolicy\");\n    this.selfHost = this.getResponseProperty(\"SelfHost\");\n    this.usersGetPremium = this.getResponseProperty(\"UsersGetPremium\");\n    this.seats = this.getResponseProperty(\"Seats\");\n    this.maxCollections = this.getResponseProperty(\"MaxCollections\");\n    this.maxStorageGb = this.getResponseProperty(\"MaxStorageGb\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.hasPublicAndPrivateKeys = this.getResponseProperty(\"HasPublicAndPrivateKeys\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.ssoBound = this.getResponseProperty(\"SsoBound\");\n    this.identifier = this.getResponseProperty(\"Identifier\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"permissions\"));\n    this.resetPasswordEnrolled = this.getResponseProperty(\"ResetPasswordEnrolled\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.providerName = this.getResponseProperty(\"ProviderName\");\n    this.providerType = this.getResponseProperty(\"ProviderType\");\n    this.familySponsorshipFriendlyName = this.getResponseProperty(\"FamilySponsorshipFriendlyName\");\n    this.familySponsorshipAvailable = this.getResponseProperty(\"FamilySponsorshipAvailable\");\n    this.planProductType = this.getResponseProperty(\"PlanProductType\");\n    this.keyConnectorEnabled = this.getResponseProperty(\"KeyConnectorEnabled\") ?? false;\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n    const familySponsorshipLastSyncDateString = this.getResponseProperty(\n      \"FamilySponsorshipLastSyncDate\",\n    );\n    if (familySponsorshipLastSyncDateString) {\n      this.familySponsorshipLastSyncDate = new Date(familySponsorshipLastSyncDateString);\n    }\n    const familySponsorshipValidUntilString = this.getResponseProperty(\n      \"FamilySponsorshipValidUntil\",\n    );\n    if (familySponsorshipValidUntilString) {\n      this.familySponsorshipValidUntil = new Date(familySponsorshipValidUntilString);\n    }\n    this.familySponsorshipToDelete = this.getResponseProperty(\"FamilySponsorshipToDelete\");\n    this.accessSecretsManager = this.getResponseProperty(\"AccessSecretsManager\");\n    this.limitCollectionCreationDeletion = this.getResponseProperty(\n      \"LimitCollectionCreationDeletion\",\n    );\n    this.allowAdminAccessToAllCollectionItems = this.getResponseProperty(\n      \"AllowAdminAccessToAllCollectionItems\",\n    );\n    this.flexibleCollections = this.getResponseProperty(\"FlexibleCollections\");\n  }\n}\n","import { ProfileOrganizationResponse } from \"./profile-organization.response\";\n\nexport class ProfileProviderOrganizationResponse extends ProfileOrganizationResponse {\n  constructor(response: any) {\n    super(response);\n    this.keyConnectorEnabled = false;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { ProviderStatusType, ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\n\nexport class ProfileProviderResponse extends BaseResponse {\n  id: string;\n  name: string;\n  key: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  permissions: PermissionsApi;\n  userId: string;\n  useEvents: boolean;\n  providerStatus: ProviderStatusType;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"permissions\"));\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.useEvents = this.getResponseProperty(\"UseEvents\");\n    this.providerStatus = this.getResponseProperty(\"ProviderStatus\");\n  }\n}\n","import { ProfileOrganizationResponse } from \"../../admin-console/models/response/profile-organization.response\";\nimport { ProfileProviderOrganizationResponse } from \"../../admin-console/models/response/profile-provider-organization.response\";\nimport { ProfileProviderResponse } from \"../../admin-console/models/response/profile-provider.response\";\nimport { UserId } from \"../../types/guid\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class ProfileResponse extends BaseResponse {\n  id: UserId;\n  name: string;\n  email: string;\n  emailVerified: boolean;\n  masterPasswordHint: string;\n  premiumPersonally: boolean;\n  premiumFromOrganization: boolean;\n  culture: string;\n  twoFactorEnabled: boolean;\n  key: string;\n  avatarColor: string;\n  creationDate: string;\n  privateKey: string;\n  securityStamp: string;\n  forcePasswordReset: boolean;\n  usesKeyConnector: boolean;\n  organizations: ProfileOrganizationResponse[] = [];\n  providers: ProfileProviderResponse[] = [];\n  providerOrganizations: ProfileProviderOrganizationResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.email = this.getResponseProperty(\"Email\");\n    this.emailVerified = this.getResponseProperty(\"EmailVerified\");\n    this.masterPasswordHint = this.getResponseProperty(\"MasterPasswordHint\");\n    this.premiumPersonally = this.getResponseProperty(\"Premium\");\n    this.premiumFromOrganization = this.getResponseProperty(\"PremiumFromOrganization\");\n    this.culture = this.getResponseProperty(\"Culture\");\n    this.twoFactorEnabled = this.getResponseProperty(\"TwoFactorEnabled\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.avatarColor = this.getResponseProperty(\"AvatarColor\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.privateKey = this.getResponseProperty(\"PrivateKey\");\n    this.securityStamp = this.getResponseProperty(\"SecurityStamp\");\n    this.forcePasswordReset = this.getResponseProperty(\"ForcePasswordReset\") ?? false;\n    this.usesKeyConnector = this.getResponseProperty(\"UsesKeyConnector\") ?? false;\n\n    const organizations = this.getResponseProperty(\"Organizations\");\n    if (organizations != null) {\n      this.organizations = organizations.map((o: any) => new ProfileOrganizationResponse(o));\n    }\n    const providers = this.getResponseProperty(\"Providers\");\n    if (providers != null) {\n      this.providers = providers.map((o: any) => new ProfileProviderResponse(o));\n    }\n    const providerOrganizations = this.getResponseProperty(\"ProviderOrganizations\");\n    if (providerOrganizations != null) {\n      this.providerOrganizations = providerOrganizations.map(\n        (o: any) => new ProfileProviderOrganizationResponse(o),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\n\nexport class PaymentResponse extends BaseResponse {\n  userProfile: ProfileResponse;\n  paymentIntentClientSecret: string;\n  success: boolean;\n\n  constructor(response: any) {\n    super(response);\n    const userProfile = this.getResponseProperty(\"UserProfile\");\n    if (userProfile != null) {\n      this.userProfile = new ProfileResponse(userProfile);\n    }\n    this.paymentIntentClientSecret = this.getResponseProperty(\"PaymentIntentClientSecret\");\n    this.success = this.getResponseProperty(\"Success\");\n  }\n}\n","import { ProductType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { PlanType } from \"../../enums\";\n\nexport class PlanResponse extends BaseResponse {\n  type: PlanType;\n  product: ProductType;\n  name: string;\n  isAnnual: boolean;\n  nameLocalizationKey: string;\n  descriptionLocalizationKey: string;\n  canBeUsedByBusiness: boolean;\n  trialPeriodDays: number;\n  hasSelfHost: boolean;\n  hasPolicies: boolean;\n  hasGroups: boolean;\n  hasDirectory: boolean;\n  hasEvents: boolean;\n  hasTotp: boolean;\n  has2fa: boolean;\n  hasApi: boolean;\n  hasSso: boolean;\n  hasResetPassword: boolean;\n  usersGetPremium: boolean;\n  upgradeSortOrder: number;\n  displaySortOrder: number;\n  legacyYear: number;\n  disabled: boolean;\n  PasswordManager: PasswordManagerPlanFeaturesResponse;\n  SecretsManager: SecretsManagerPlanFeaturesResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.product = this.getResponseProperty(\"Product\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.isAnnual = this.getResponseProperty(\"IsAnnual\");\n    this.nameLocalizationKey = this.getResponseProperty(\"NameLocalizationKey\");\n    this.descriptionLocalizationKey = this.getResponseProperty(\"DescriptionLocalizationKey\");\n    this.canBeUsedByBusiness = this.getResponseProperty(\"CanBeUsedByBusiness\");\n    this.trialPeriodDays = this.getResponseProperty(\"TrialPeriodDays\");\n    this.hasSelfHost = this.getResponseProperty(\"HasSelfHost\");\n    this.hasPolicies = this.getResponseProperty(\"HasPolicies\");\n    this.hasGroups = this.getResponseProperty(\"HasGroups\");\n    this.hasDirectory = this.getResponseProperty(\"HasDirectory\");\n    this.hasEvents = this.getResponseProperty(\"HasEvents\");\n    this.hasTotp = this.getResponseProperty(\"HasTotp\");\n    this.has2fa = this.getResponseProperty(\"Has2fa\");\n    this.hasApi = this.getResponseProperty(\"HasApi\");\n    this.hasSso = this.getResponseProperty(\"HasSso\");\n    this.hasResetPassword = this.getResponseProperty(\"HasResetPassword\");\n    this.usersGetPremium = this.getResponseProperty(\"UsersGetPremium\");\n    this.upgradeSortOrder = this.getResponseProperty(\"UpgradeSortOrder\");\n    this.displaySortOrder = this.getResponseProperty(\"DisplaySortOrder\");\n    this.legacyYear = this.getResponseProperty(\"LegacyYear\");\n    this.disabled = this.getResponseProperty(\"Disabled\");\n    const passwordManager = this.getResponseProperty(\"PasswordManager\");\n    const secretsManager = this.getResponseProperty(\"SecretsManager\");\n    this.PasswordManager =\n      passwordManager == null ? null : new PasswordManagerPlanFeaturesResponse(passwordManager);\n    this.SecretsManager =\n      secretsManager == null ? null : new SecretsManagerPlanFeaturesResponse(secretsManager);\n  }\n}\n\nexport class SecretsManagerPlanFeaturesResponse extends BaseResponse {\n  // Seats\n  stripeSeatPlanId: string;\n  baseSeats: number;\n  basePrice: number;\n  seatPrice: number;\n  hasAdditionalSeatsOption: boolean;\n  maxAdditionalSeats: number;\n  maxSeats: number;\n\n  // Service accounts\n  stripeServiceAccountPlanId: string;\n  additionalPricePerServiceAccount: number;\n  baseServiceAccount: number;\n  maxServiceAccount: number;\n  hasAdditionalServiceAccountOption: boolean;\n  maxAdditionalServiceAccounts: number;\n\n  // Features\n  maxProjects: number;\n\n  constructor(response: any) {\n    super(response);\n    this.stripeSeatPlanId = this.getResponseProperty(\"StripeSeatPlanId\");\n    this.baseSeats = this.getResponseProperty(\"BaseSeats\");\n    this.basePrice = this.getResponseProperty(\"BasePrice\");\n    this.seatPrice = this.getResponseProperty(\"SeatPrice\");\n    this.hasAdditionalSeatsOption = this.getResponseProperty(\"HasAdditionalSeatsOption\");\n    this.maxAdditionalSeats = this.getResponseProperty(\"MaxAdditionalSeats\");\n    this.maxSeats = this.getResponseProperty(\"MaxSeats\");\n    this.stripeServiceAccountPlanId = this.getResponseProperty(\"StripeServiceAccountPlanId\");\n    this.additionalPricePerServiceAccount = this.getResponseProperty(\n      \"AdditionalPricePerServiceAccount\",\n    );\n    this.baseServiceAccount = this.getResponseProperty(\"BaseServiceAccount\");\n    this.maxServiceAccount = this.getResponseProperty(\"MaxServiceAccount\");\n    this.hasAdditionalServiceAccountOption = this.getResponseProperty(\n      \"HasAdditionalServiceAccountOption\",\n    );\n    this.maxAdditionalServiceAccounts = this.getResponseProperty(\"MaxAdditionalServiceAccounts\");\n    this.maxProjects = this.getResponseProperty(\"MaxProjects\");\n  }\n}\n\nexport class PasswordManagerPlanFeaturesResponse extends BaseResponse {\n  // Seats\n  stripePlanId: string;\n  stripeSeatPlanId: string;\n  stripePremiumAccessPlanId: string;\n  basePrice: number;\n  seatPrice: number;\n  premiumAccessOptionPrice: number;\n  baseSeats: number;\n  maxAdditionalSeats: number;\n  maxSeats: number;\n  hasPremiumAccessOption: boolean;\n\n  // Storage\n  additionalStoragePricePerGb: number;\n  stripeStoragePlanId: string;\n  baseStorageGb: number;\n  hasAdditionalStorageOption: boolean;\n  maxAdditionalStorage: number;\n  hasAdditionalSeatsOption: boolean;\n\n  // Feature\n  maxCollections: number;\n\n  constructor(response: any) {\n    super(response);\n    this.stripePlanId = this.getResponseProperty(\"StripePlanId\");\n    this.stripeSeatPlanId = this.getResponseProperty(\"StripeSeatPlanId\");\n    this.stripeStoragePlanId = this.getResponseProperty(\"StripeStoragePlanId\");\n    this.stripePremiumAccessPlanId = this.getResponseProperty(\"StripePremiumAccessPlanId\");\n    this.basePrice = this.getResponseProperty(\"BasePrice\");\n    this.seatPrice = this.getResponseProperty(\"SeatPrice\");\n    this.baseSeats = this.getResponseProperty(\"BaseSeats\");\n    this.maxAdditionalSeats = this.getResponseProperty(\"MaxAdditionalSeats\");\n    this.premiumAccessOptionPrice = this.getResponseProperty(\"PremiumAccessOptionPrice\");\n    this.maxSeats = this.getResponseProperty(\"MaxSeats\");\n    this.additionalStoragePricePerGb = this.getResponseProperty(\"AdditionalStoragePricePerGb\");\n    this.hasAdditionalSeatsOption = this.getResponseProperty(\"HasAdditionalSeatsOption\");\n    this.baseStorageGb = this.getResponseProperty(\"BaseStorageGb\");\n    this.maxCollections = this.getResponseProperty(\"MaxCollections\");\n    this.hasAdditionalStorageOption = this.getResponseProperty(\"HasAdditionalStorageOption\");\n    this.maxAdditionalStorage = this.getResponseProperty(\"MaxAdditionalStorage\");\n    this.hasPremiumAccessOption = this.getResponseProperty(\"HasPremiumAccessOption\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SubscriptionResponse extends BaseResponse {\n  storageName: string;\n  storageGb: number;\n  maxStorageGb: number;\n  subscription: BillingSubscriptionResponse;\n  upcomingInvoice: BillingSubscriptionUpcomingInvoiceResponse;\n  license: any;\n  expiration: string;\n\n  constructor(response: any) {\n    super(response);\n    this.storageName = this.getResponseProperty(\"StorageName\");\n    this.storageGb = this.getResponseProperty(\"StorageGb\");\n    this.maxStorageGb = this.getResponseProperty(\"MaxStorageGb\");\n    this.license = this.getResponseProperty(\"License\");\n    this.expiration = this.getResponseProperty(\"Expiration\");\n    const subscription = this.getResponseProperty(\"Subscription\");\n    const upcomingInvoice = this.getResponseProperty(\"UpcomingInvoice\");\n    this.subscription = subscription == null ? null : new BillingSubscriptionResponse(subscription);\n    this.upcomingInvoice =\n      upcomingInvoice == null\n        ? null\n        : new BillingSubscriptionUpcomingInvoiceResponse(upcomingInvoice);\n  }\n}\n\nexport class BillingSubscriptionResponse extends BaseResponse {\n  trialStartDate: string;\n  trialEndDate: string;\n  periodStartDate: string;\n  periodEndDate: string;\n  cancelledDate: string;\n  cancelAtEndDate: boolean;\n  status: string;\n  cancelled: boolean;\n  items: BillingSubscriptionItemResponse[] = [];\n  collectionMethod: string;\n  suspensionDate?: string;\n  unpaidPeriodEndDate?: string;\n  gracePeriod?: number;\n\n  constructor(response: any) {\n    super(response);\n    this.trialStartDate = this.getResponseProperty(\"TrialStartDate\");\n    this.trialEndDate = this.getResponseProperty(\"TrialEndDate\");\n    this.periodStartDate = this.getResponseProperty(\"PeriodStartDate\");\n    this.periodEndDate = this.getResponseProperty(\"PeriodEndDate\");\n    this.cancelledDate = this.getResponseProperty(\"CancelledDate\");\n    this.cancelAtEndDate = this.getResponseProperty(\"CancelAtEndDate\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.cancelled = this.getResponseProperty(\"Cancelled\");\n    const items = this.getResponseProperty(\"Items\");\n    if (items != null) {\n      this.items = items.map((i: any) => new BillingSubscriptionItemResponse(i));\n    }\n    this.collectionMethod = this.getResponseProperty(\"CollectionMethod\");\n    this.suspensionDate = this.getResponseProperty(\"SuspensionDate\");\n    this.unpaidPeriodEndDate = this.getResponseProperty(\"unpaidPeriodEndDate\");\n    this.gracePeriod = this.getResponseProperty(\"GracePeriod\");\n  }\n}\n\nexport class BillingSubscriptionItemResponse extends BaseResponse {\n  productId: string;\n  name: string;\n  amount: number;\n  quantity: number;\n  interval: string;\n  sponsoredSubscriptionItem: boolean;\n  addonSubscriptionItem: boolean;\n  productName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.productId = this.getResponseProperty(\"ProductId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.amount = this.getResponseProperty(\"Amount\");\n    this.quantity = this.getResponseProperty(\"Quantity\");\n    this.interval = this.getResponseProperty(\"Interval\");\n    this.sponsoredSubscriptionItem = this.getResponseProperty(\"SponsoredSubscriptionItem\");\n    this.addonSubscriptionItem = this.getResponseProperty(\"AddonSubscriptionItem\");\n  }\n}\n\nexport class BillingSubscriptionUpcomingInvoiceResponse extends BaseResponse {\n  date: string;\n  amount?: number;\n\n  constructor(response: any) {\n    super(response);\n    this.date = this.getResponseProperty(\"Date\");\n    this.amount = this.getResponseProperty(\"Amount\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TaxInfoResponse extends BaseResponse {\n  taxId: string;\n  taxIdType: string;\n  line1: string;\n  line2: string;\n  city: string;\n  state: string;\n  country: string;\n  postalCode: string;\n\n  constructor(response: any) {\n    super(response);\n    this.taxId = this.getResponseProperty(\"TaxIdNumber\");\n    if (!this.taxId) {\n      this.taxId = this.getResponseProperty(\"TaxId\");\n    }\n    this.taxIdType = this.getResponseProperty(\"TaxIdType\");\n    this.line1 = this.getResponseProperty(\"Line1\");\n    this.line2 = this.getResponseProperty(\"Line2\");\n    this.city = this.getResponseProperty(\"City\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.country = this.getResponseProperty(\"Country\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TaxRateResponse extends BaseResponse {\n  id: string;\n  country: string;\n  state: string;\n  postalCode: string;\n  rate: number;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.country = this.getResponseProperty(\"Country\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.rate = this.getResponseProperty(\"Rate\");\n  }\n}\n","export class CollectionBulkDeleteRequest {\n  ids: string[];\n\n  constructor(ids: string[]) {\n    this.ids = ids == null ? [] : ids;\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class BreachAccountResponse extends BaseResponse {\n  addedDate: string;\n  breachDate: string;\n  dataClasses: string[];\n  description: string;\n  domain: string;\n  isActive: boolean;\n  isVerified: boolean;\n  logoPath: string;\n  modifiedDate: string;\n  name: string;\n  pwnCount: number;\n  title: string;\n\n  constructor(response: any) {\n    super(response);\n    this.addedDate = this.getResponseProperty(\"AddedDate\");\n    this.breachDate = this.getResponseProperty(\"BreachDate\");\n    this.dataClasses = this.getResponseProperty(\"DataClasses\");\n    this.description = this.getResponseProperty(\"Description\");\n    this.domain = this.getResponseProperty(\"Domain\");\n    this.isActive = this.getResponseProperty(\"IsActive\");\n    this.isVerified = this.getResponseProperty(\"IsVerified\");\n    this.logoPath = this.getResponseProperty(\"LogoPath\");\n    this.modifiedDate = this.getResponseProperty(\"ModifiedDate\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.pwnCount = this.getResponseProperty(\"PwnCount\");\n    this.title = this.getResponseProperty(\"Title\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class GlobalDomainResponse extends BaseResponse {\n  type: number;\n  domains: string[];\n  excluded: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.domains = this.getResponseProperty(\"Domains\");\n    this.excluded = this.getResponseProperty(\"Excluded\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\nimport { GlobalDomainResponse } from \"./global-domain.response\";\n\nexport class DomainsResponse extends BaseResponse {\n  equivalentDomains: string[][];\n  globalEquivalentDomains: GlobalDomainResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.equivalentDomains = this.getResponseProperty(\"EquivalentDomains\");\n    const globalEquivalentDomains = this.getResponseProperty(\"GlobalEquivalentDomains\");\n    if (globalEquivalentDomains != null) {\n      this.globalEquivalentDomains = globalEquivalentDomains.map(\n        (d: any) => new GlobalDomainResponse(d),\n      );\n    } else {\n      this.globalEquivalentDomains = [];\n    }\n  }\n}\n","import { DeviceType, EventSystemUser, EventType } from \"../../enums\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class EventResponse extends BaseResponse {\n  type: EventType;\n  userId: string;\n  organizationId: string;\n  providerId: string;\n  cipherId: string;\n  collectionId: string;\n  groupId: string;\n  policyId: string;\n  organizationUserId: string;\n  providerUserId: string;\n  providerOrganizationId: string;\n  actingUserId: string;\n  date: string;\n  deviceType: DeviceType;\n  ipAddress: string;\n  installationId: string;\n  systemUser: EventSystemUser;\n  domainName: string;\n  secretId: string;\n  serviceAccountId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.cipherId = this.getResponseProperty(\"CipherId\");\n    this.collectionId = this.getResponseProperty(\"CollectionId\");\n    this.groupId = this.getResponseProperty(\"GroupId\");\n    this.policyId = this.getResponseProperty(\"PolicyId\");\n    this.organizationUserId = this.getResponseProperty(\"OrganizationUserId\");\n    this.providerUserId = this.getResponseProperty(\"ProviderUserId\");\n    this.providerOrganizationId = this.getResponseProperty(\"ProviderOrganizationId\");\n    this.actingUserId = this.getResponseProperty(\"ActingUserId\");\n    this.date = this.getResponseProperty(\"Date\");\n    this.deviceType = this.getResponseProperty(\"DeviceType\");\n    this.ipAddress = this.getResponseProperty(\"IpAddress\");\n    this.installationId = this.getResponseProperty(\"InstallationId\");\n    this.systemUser = this.getResponseProperty(\"SystemUser\");\n    this.domainName = this.getResponseProperty(\"DomainName\");\n    this.secretId = this.getResponseProperty(\"SecretId\");\n    this.serviceAccountId = this.getResponseProperty(\"ServiceAccountId\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class UserKeyResponse extends BaseResponse {\n  userId: string;\n  publicKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.publicKey = this.getResponseProperty(\"PublicKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { FileUploadType } from \"../../../platform/enums\";\n\nimport { CipherResponse } from \"./cipher.response\";\n\nexport class AttachmentUploadDataResponse extends BaseResponse {\n  attachmentId: string;\n  fileUploadType: FileUploadType;\n  cipherResponse: CipherResponse;\n  cipherMiniResponse: CipherResponse;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.attachmentId = this.getResponseProperty(\"AttachmentId\");\n    this.fileUploadType = this.getResponseProperty(\"FileUploadType\");\n    const cipherResponse = this.getResponseProperty(\"CipherResponse\");\n    const cipherMiniResponse = this.getResponseProperty(\"CipherMiniResponse\");\n    this.cipherResponse = cipherResponse == null ? null : new CipherResponse(cipherResponse);\n    this.cipherMiniResponse =\n      cipherMiniResponse == null ? null : new CipherResponse(cipherMiniResponse);\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { CipherResponse } from \"./cipher.response\";\n\nexport class OptionalCipherResponse extends BaseResponse {\n  unavailable: boolean;\n  cipher?: CipherResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.unavailable = this.getResponseProperty(\"Unavailable\");\n    this.cipher = new CipherResponse(this.getResponseProperty(\"Cipher\"));\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendFileApi extends BaseResponse {\n  id: string;\n  fileName: string;\n  size: string;\n  sizeName: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.id = this.getResponseProperty(\"Id\");\n    this.fileName = this.getResponseProperty(\"FileName\");\n    this.size = this.getResponseProperty(\"Size\");\n    this.sizeName = this.getResponseProperty(\"SizeName\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendTextApi extends BaseResponse {\n  text: string;\n  hidden: boolean;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.text = this.getResponseProperty(\"Text\");\n    this.hidden = this.getResponseProperty(\"Hidden\") || false;\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendResponse extends BaseResponse {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: string;\n  notes: string;\n  file: SendFileApi;\n  text: SendTextApi;\n  key: string;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: string;\n  expirationDate: string;\n  deletionDate: string;\n  password: string;\n  disable: boolean;\n  hideEmail: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.accessId = this.getResponseProperty(\"AccessId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.notes = this.getResponseProperty(\"Notes\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.maxAccessCount = this.getResponseProperty(\"MaxAccessCount\");\n    this.accessCount = this.getResponseProperty(\"AccessCount\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.expirationDate = this.getResponseProperty(\"ExpirationDate\");\n    this.deletionDate = this.getResponseProperty(\"DeletionDate\");\n    this.password = this.getResponseProperty(\"Password\");\n    this.disable = this.getResponseProperty(\"Disabled\") || false;\n    this.hideEmail = this.getResponseProperty(\"HideEmail\") || false;\n\n    const text = this.getResponseProperty(\"Text\");\n    if (text != null) {\n      this.text = new SendTextApi(text);\n    }\n\n    const file = this.getResponseProperty(\"File\");\n    if (file != null) {\n      this.file = new SendFileApi(file);\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class FolderResponse extends BaseResponse {\n  id: string;\n  name: string;\n  revisionDate: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n  }\n}\n","import { PolicyResponse } from \"../../../admin-console/models/response/policy.response\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { DomainsResponse } from \"../../../models/response/domains.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\nimport { SendResponse } from \"../../../tools/send/models/response/send.response\";\n\nimport { CipherResponse } from \"./cipher.response\";\nimport { CollectionDetailsResponse } from \"./collection.response\";\nimport { FolderResponse } from \"./folder.response\";\n\nexport class SyncResponse extends BaseResponse {\n  profile?: ProfileResponse;\n  folders: FolderResponse[] = [];\n  collections: CollectionDetailsResponse[] = [];\n  ciphers: CipherResponse[] = [];\n  domains?: DomainsResponse;\n  policies?: PolicyResponse[] = [];\n  sends: SendResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n\n    const profile = this.getResponseProperty(\"Profile\");\n    if (profile != null) {\n      this.profile = new ProfileResponse(profile);\n    }\n\n    const folders = this.getResponseProperty(\"Folders\");\n    if (folders != null) {\n      this.folders = folders.map((f: any) => new FolderResponse(f));\n    }\n\n    const collections = this.getResponseProperty(\"Collections\");\n    if (collections != null) {\n      this.collections = collections.map((c: any) => new CollectionDetailsResponse(c));\n    }\n\n    const ciphers = this.getResponseProperty(\"Ciphers\");\n    if (ciphers != null) {\n      this.ciphers = ciphers.map((c: any) => new CipherResponse(c));\n    }\n\n    const domains = this.getResponseProperty(\"Domains\");\n    if (domains != null) {\n      this.domains = new DomainsResponse(domains);\n    }\n\n    const policies = this.getResponseProperty(\"Policies\");\n    if (policies != null) {\n      this.policies = policies.map((p: any) => new PolicyResponse(p));\n    }\n\n    const sends = this.getResponseProperty(\"Sends\");\n    if (sends != null) {\n      this.sends = sends.map((s: any) => new SendResponse(s));\n    }\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { LogoutReason } from \"@bitwarden/auth/common\";\n\nimport { ApiService as ApiServiceAbstraction } from \"../abstractions/api.service\";\nimport { VaultTimeoutSettingsService } from \"../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { OrganizationConnectionType } from \"../admin-console/enums\";\nimport { OrganizationSponsorshipCreateRequest } from \"../admin-console/models/request/organization/organization-sponsorship-create.request\";\nimport { OrganizationSponsorshipRedeemRequest } from \"../admin-console/models/request/organization/organization-sponsorship-redeem.request\";\nimport { OrganizationConnectionRequest } from \"../admin-console/models/request/organization-connection.request\";\nimport { ProviderAddOrganizationRequest } from \"../admin-console/models/request/provider/provider-add-organization.request\";\nimport { ProviderOrganizationCreateRequest } from \"../admin-console/models/request/provider/provider-organization-create.request\";\nimport { ProviderUserAcceptRequest } from \"../admin-console/models/request/provider/provider-user-accept.request\";\nimport { ProviderUserBulkConfirmRequest } from \"../admin-console/models/request/provider/provider-user-bulk-confirm.request\";\nimport { ProviderUserBulkRequest } from \"../admin-console/models/request/provider/provider-user-bulk.request\";\nimport { ProviderUserConfirmRequest } from \"../admin-console/models/request/provider/provider-user-confirm.request\";\nimport { ProviderUserInviteRequest } from \"../admin-console/models/request/provider/provider-user-invite.request\";\nimport { ProviderUserUpdateRequest } from \"../admin-console/models/request/provider/provider-user-update.request\";\nimport { SelectionReadOnlyRequest } from \"../admin-console/models/request/selection-read-only.request\";\nimport {\n  OrganizationConnectionConfigApis,\n  OrganizationConnectionResponse,\n} from \"../admin-console/models/response/organization-connection.response\";\nimport { OrganizationExportResponse } from \"../admin-console/models/response/organization-export.response\";\nimport { OrganizationSponsorshipSyncStatusResponse } from \"../admin-console/models/response/organization-sponsorship-sync-status.response\";\nimport {\n  ProviderOrganizationOrganizationDetailsResponse,\n  ProviderOrganizationResponse,\n} from \"../admin-console/models/response/provider/provider-organization.response\";\nimport { ProviderUserBulkPublicKeyResponse } from \"../admin-console/models/response/provider/provider-user-bulk-public-key.response\";\nimport { ProviderUserBulkResponse } from \"../admin-console/models/response/provider/provider-user-bulk.response\";\nimport {\n  ProviderUserResponse,\n  ProviderUserUserDetailsResponse,\n} from \"../admin-console/models/response/provider/provider-user.response\";\nimport { SelectionReadOnlyResponse } from \"../admin-console/models/response/selection-read-only.response\";\nimport { TokenService } from \"../auth/abstractions/token.service\";\nimport { CreateAuthRequest } from \"../auth/models/request/create-auth.request\";\nimport { DeviceVerificationRequest } from \"../auth/models/request/device-verification.request\";\nimport { EmailTokenRequest } from \"../auth/models/request/email-token.request\";\nimport { EmailRequest } from \"../auth/models/request/email.request\";\nimport { DeviceRequest } from \"../auth/models/request/identity-token/device.request\";\nimport { PasswordTokenRequest } from \"../auth/models/request/identity-token/password-token.request\";\nimport { SsoTokenRequest } from \"../auth/models/request/identity-token/sso-token.request\";\nimport { TokenTwoFactorRequest } from \"../auth/models/request/identity-token/token-two-factor.request\";\nimport { UserApiTokenRequest } from \"../auth/models/request/identity-token/user-api-token.request\";\nimport { WebAuthnLoginTokenRequest } from \"../auth/models/request/identity-token/webauthn-login-token.request\";\nimport { KeyConnectorUserKeyRequest } from \"../auth/models/request/key-connector-user-key.request\";\nimport { PasswordHintRequest } from \"../auth/models/request/password-hint.request\";\nimport { PasswordRequest } from \"../auth/models/request/password.request\";\nimport { PasswordlessAuthRequest } from \"../auth/models/request/passwordless-auth.request\";\nimport { SecretVerificationRequest } from \"../auth/models/request/secret-verification.request\";\nimport { SetKeyConnectorKeyRequest } from \"../auth/models/request/set-key-connector-key.request\";\nimport { SetPasswordRequest } from \"../auth/models/request/set-password.request\";\nimport { TwoFactorEmailRequest } from \"../auth/models/request/two-factor-email.request\";\nimport { TwoFactorProviderRequest } from \"../auth/models/request/two-factor-provider.request\";\nimport { TwoFactorRecoveryRequest } from \"../auth/models/request/two-factor-recovery.request\";\nimport { UpdateProfileRequest } from \"../auth/models/request/update-profile.request\";\nimport { UpdateTempPasswordRequest } from \"../auth/models/request/update-temp-password.request\";\nimport { UpdateTwoFactorAuthenticatorRequest } from \"../auth/models/request/update-two-factor-authenticator.request\";\nimport { UpdateTwoFactorDuoRequest } from \"../auth/models/request/update-two-factor-duo.request\";\nimport { UpdateTwoFactorEmailRequest } from \"../auth/models/request/update-two-factor-email.request\";\nimport { UpdateTwoFactorWebAuthnDeleteRequest } from \"../auth/models/request/update-two-factor-web-authn-delete.request\";\nimport { UpdateTwoFactorWebAuthnRequest } from \"../auth/models/request/update-two-factor-web-authn.request\";\nimport { UpdateTwoFactorYubioOtpRequest } from \"../auth/models/request/update-two-factor-yubio-otp.request\";\nimport { ApiKeyResponse } from \"../auth/models/response/api-key.response\";\nimport { AuthRequestResponse } from \"../auth/models/response/auth-request.response\";\nimport { DeviceVerificationResponse } from \"../auth/models/response/device-verification.response\";\nimport { IdentityCaptchaResponse } from \"../auth/models/response/identity-captcha.response\";\nimport { IdentityTokenResponse } from \"../auth/models/response/identity-token.response\";\nimport { IdentityTwoFactorResponse } from \"../auth/models/response/identity-two-factor.response\";\nimport { KeyConnectorUserKeyResponse } from \"../auth/models/response/key-connector-user-key.response\";\nimport { MasterPasswordPolicyResponse } from \"../auth/models/response/master-password-policy.response\";\nimport { PreloginResponse } from \"../auth/models/response/prelogin.response\";\nimport { RegisterResponse } from \"../auth/models/response/register.response\";\nimport { SsoPreValidateResponse } from \"../auth/models/response/sso-pre-validate.response\";\nimport { TwoFactorAuthenticatorResponse } from \"../auth/models/response/two-factor-authenticator.response\";\nimport { TwoFactorDuoResponse } from \"../auth/models/response/two-factor-duo.response\";\nimport { TwoFactorEmailResponse } from \"../auth/models/response/two-factor-email.response\";\nimport { TwoFactorProviderResponse } from \"../auth/models/response/two-factor-provider.response\";\nimport { TwoFactorRecoverResponse } from \"../auth/models/response/two-factor-recover.response\";\nimport {\n  ChallengeResponse,\n  TwoFactorWebAuthnResponse,\n} from \"../auth/models/response/two-factor-web-authn.response\";\nimport { TwoFactorYubiKeyResponse } from \"../auth/models/response/two-factor-yubi-key.response\";\nimport { BitPayInvoiceRequest } from \"../billing/models/request/bit-pay-invoice.request\";\nimport { PaymentRequest } from \"../billing/models/request/payment.request\";\nimport { TaxInfoUpdateRequest } from \"../billing/models/request/tax-info-update.request\";\nimport { BillingHistoryResponse } from \"../billing/models/response/billing-history.response\";\nimport { BillingPaymentResponse } from \"../billing/models/response/billing-payment.response\";\nimport { PaymentResponse } from \"../billing/models/response/payment.response\";\nimport { PlanResponse } from \"../billing/models/response/plan.response\";\nimport { SubscriptionResponse } from \"../billing/models/response/subscription.response\";\nimport { TaxInfoResponse } from \"../billing/models/response/tax-info.response\";\nimport { TaxRateResponse } from \"../billing/models/response/tax-rate.response\";\nimport { DeviceType } from \"../enums\";\nimport { VaultTimeoutAction } from \"../enums/vault-timeout-action.enum\";\nimport { CollectionBulkDeleteRequest } from \"../models/request/collection-bulk-delete.request\";\nimport { DeleteRecoverRequest } from \"../models/request/delete-recover.request\";\nimport { EventRequest } from \"../models/request/event.request\";\nimport { KdfRequest } from \"../models/request/kdf.request\";\nimport { KeysRequest } from \"../models/request/keys.request\";\nimport { OrganizationImportRequest } from \"../models/request/organization-import.request\";\nimport { PreloginRequest } from \"../models/request/prelogin.request\";\nimport { RegisterRequest } from \"../models/request/register.request\";\nimport { StorageRequest } from \"../models/request/storage.request\";\nimport { UpdateAvatarRequest } from \"../models/request/update-avatar.request\";\nimport { UpdateDomainsRequest } from \"../models/request/update-domains.request\";\nimport { VerifyDeleteRecoverRequest } from \"../models/request/verify-delete-recover.request\";\nimport { VerifyEmailRequest } from \"../models/request/verify-email.request\";\nimport { BreachAccountResponse } from \"../models/response/breach-account.response\";\nimport { DomainsResponse } from \"../models/response/domains.response\";\nimport { ErrorResponse } from \"../models/response/error.response\";\nimport { EventResponse } from \"../models/response/event.response\";\nimport { ListResponse } from \"../models/response/list.response\";\nimport { ProfileResponse } from \"../models/response/profile.response\";\nimport { UserKeyResponse } from \"../models/response/user-key.response\";\nimport { AppIdService } from \"../platform/abstractions/app-id.service\";\nimport { EnvironmentService } from \"../platform/abstractions/environment.service\";\nimport { LogService } from \"../platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"../platform/abstractions/platform-utils.service\";\nimport { Utils } from \"../platform/misc/utils\";\nimport { UserId } from \"../types/guid\";\nimport { AttachmentRequest } from \"../vault/models/request/attachment.request\";\nimport { CipherBulkDeleteRequest } from \"../vault/models/request/cipher-bulk-delete.request\";\nimport { CipherBulkMoveRequest } from \"../vault/models/request/cipher-bulk-move.request\";\nimport { CipherBulkRestoreRequest } from \"../vault/models/request/cipher-bulk-restore.request\";\nimport { CipherBulkShareRequest } from \"../vault/models/request/cipher-bulk-share.request\";\nimport { CipherCollectionsRequest } from \"../vault/models/request/cipher-collections.request\";\nimport { CipherCreateRequest } from \"../vault/models/request/cipher-create.request\";\nimport { CipherPartialRequest } from \"../vault/models/request/cipher-partial.request\";\nimport { CipherShareRequest } from \"../vault/models/request/cipher-share.request\";\nimport { CipherRequest } from \"../vault/models/request/cipher.request\";\nimport { CollectionRequest } from \"../vault/models/request/collection.request\";\nimport { AttachmentUploadDataResponse } from \"../vault/models/response/attachment-upload-data.response\";\nimport { AttachmentResponse } from \"../vault/models/response/attachment.response\";\nimport { CipherResponse } from \"../vault/models/response/cipher.response\";\nimport {\n  CollectionAccessDetailsResponse,\n  CollectionDetailsResponse,\n  CollectionResponse,\n} from \"../vault/models/response/collection.response\";\nimport { OptionalCipherResponse } from \"../vault/models/response/optional-cipher.response\";\nimport { SyncResponse } from \"../vault/models/response/sync.response\";\n\n/**\n * @deprecated The `ApiService` class is deprecated and calls should be extracted into individual\n * api services. The `send` method is still allowed to be used within api services. For background\n * of this decision please read https://contributing.bitwarden.com/architecture/adr/refactor-api-service.\n */\nexport class ApiService implements ApiServiceAbstraction {\n  private device: DeviceType;\n  private deviceType: string;\n  private isWebClient = false;\n  private isDesktopClient = false;\n\n  constructor(\n    private tokenService: TokenService,\n    private platformUtilsService: PlatformUtilsService,\n    private environmentService: EnvironmentService,\n    private appIdService: AppIdService,\n    private refreshAccessTokenErrorCallback: () => void,\n    private logService: LogService,\n    private logoutCallback: (logoutReason: LogoutReason) => Promise<void>,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n    private customUserAgent: string = null,\n  ) {\n    this.device = platformUtilsService.getDevice();\n    this.deviceType = this.device.toString();\n    this.isWebClient =\n      this.device === DeviceType.IEBrowser ||\n      this.device === DeviceType.ChromeBrowser ||\n      this.device === DeviceType.EdgeBrowser ||\n      this.device === DeviceType.FirefoxBrowser ||\n      this.device === DeviceType.OperaBrowser ||\n      this.device === DeviceType.SafariBrowser ||\n      this.device === DeviceType.UnknownBrowser ||\n      this.device === DeviceType.VivaldiBrowser;\n    this.isDesktopClient =\n      this.device === DeviceType.WindowsDesktop ||\n      this.device === DeviceType.MacOsDesktop ||\n      this.device === DeviceType.LinuxDesktop ||\n      this.device === DeviceType.WindowsCLI ||\n      this.device === DeviceType.MacOsCLI ||\n      this.device === DeviceType.LinuxCLI;\n  }\n\n  // Auth APIs\n\n  async postIdentityToken(\n    request:\n      | UserApiTokenRequest\n      | PasswordTokenRequest\n      | SsoTokenRequest\n      | WebAuthnLoginTokenRequest,\n  ): Promise<IdentityTokenResponse | IdentityTwoFactorResponse | IdentityCaptchaResponse> {\n    const headers = new Headers({\n      \"Content-Type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n    request.alterIdentityTokenHeaders(headers);\n\n    const identityToken =\n      request instanceof UserApiTokenRequest\n        ? request.toIdentityToken()\n        : request.toIdentityToken(this.platformUtilsService.getClientType());\n\n    const env = await firstValueFrom(this.environmentService.environment$);\n\n    const response = await this.fetch(\n      new Request(env.getIdentityUrl() + \"/connect/token\", {\n        body: this.qsStringify(identityToken),\n        credentials: await this.getCredentials(),\n        cache: \"no-store\",\n        headers: headers,\n        method: \"POST\",\n      }),\n    );\n\n    let responseJson: any = null;\n    if (this.isJsonResponse(response)) {\n      responseJson = await response.json();\n    }\n\n    if (responseJson != null) {\n      if (response.status === 200) {\n        return new IdentityTokenResponse(responseJson);\n      } else if (\n        response.status === 400 &&\n        responseJson.TwoFactorProviders2 &&\n        Object.keys(responseJson.TwoFactorProviders2).length\n      ) {\n        return new IdentityTwoFactorResponse(responseJson);\n      } else if (\n        response.status === 400 &&\n        responseJson.HCaptcha_SiteKey &&\n        Object.keys(responseJson.HCaptcha_SiteKey).length\n      ) {\n        return new IdentityCaptchaResponse(responseJson);\n      }\n    }\n\n    return Promise.reject(new ErrorResponse(responseJson, response.status, true));\n  }\n\n  async refreshIdentityToken(): Promise<any> {\n    try {\n      await this.doAuthRefresh();\n    } catch (e) {\n      this.logService.error(\"Error refreshing access token: \", e);\n      throw e;\n    }\n  }\n\n  // TODO: PM-3519: Create and move to AuthRequest Api service\n  async postAuthRequest(request: CreateAuthRequest): Promise<AuthRequestResponse> {\n    const r = await this.send(\"POST\", \"/auth-requests/\", request, false, true);\n    return new AuthRequestResponse(r);\n  }\n  async postAdminAuthRequest(request: CreateAuthRequest): Promise<AuthRequestResponse> {\n    const r = await this.send(\"POST\", \"/auth-requests/admin-request\", request, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthResponse(id: string, accessCode: string): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}/response?code=${accessCode}`;\n    const r = await this.send(\"GET\", path, null, false, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthRequest(id: string): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}`;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async putAuthRequest(id: string, request: PasswordlessAuthRequest): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}`;\n    const r = await this.send(\"PUT\", path, request, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthRequests(): Promise<ListResponse<AuthRequestResponse>> {\n    const path = `/auth-requests/`;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new ListResponse(r, AuthRequestResponse);\n  }\n\n  async getLastAuthRequest(): Promise<AuthRequestResponse> {\n    const requests = await this.getAuthRequests();\n    const activeRequests = requests.data.filter((m) => !m.isAnswered && !m.isExpired);\n    const lastRequest = activeRequests.sort((a: AuthRequestResponse, b: AuthRequestResponse) =>\n      a.creationDate.localeCompare(b.creationDate),\n    )[activeRequests.length - 1];\n    return lastRequest;\n  }\n\n  // Account APIs\n\n  async getProfile(): Promise<ProfileResponse> {\n    const r = await this.send(\"GET\", \"/accounts/profile\", null, true, true);\n    return new ProfileResponse(r);\n  }\n\n  async getUserSubscription(): Promise<SubscriptionResponse> {\n    const r = await this.send(\"GET\", \"/accounts/subscription\", null, true, true);\n    return new SubscriptionResponse(r);\n  }\n\n  async getTaxInfo(): Promise<TaxInfoResponse> {\n    const r = await this.send(\"GET\", \"/accounts/tax\", null, true, true);\n    return new TaxInfoResponse(r);\n  }\n\n  async putProfile(request: UpdateProfileRequest): Promise<ProfileResponse> {\n    const r = await this.send(\"PUT\", \"/accounts/profile\", request, true, true);\n    return new ProfileResponse(r);\n  }\n\n  async putAvatar(request: UpdateAvatarRequest): Promise<ProfileResponse> {\n    const r = await this.send(\"PUT\", \"/accounts/avatar\", request, true, true);\n    return new ProfileResponse(r);\n  }\n\n  putTaxInfo(request: TaxInfoUpdateRequest): Promise<any> {\n    return this.send(\"PUT\", \"/accounts/tax\", request, true, false);\n  }\n\n  async postPrelogin(request: PreloginRequest): Promise<PreloginResponse> {\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const r = await this.send(\n      \"POST\",\n      \"/accounts/prelogin\",\n      request,\n      false,\n      true,\n      env.getIdentityUrl(),\n    );\n    return new PreloginResponse(r);\n  }\n\n  postEmailToken(request: EmailTokenRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/email-token\", request, true, false);\n  }\n\n  postEmail(request: EmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/email\", request, true, false);\n  }\n\n  postPassword(request: PasswordRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/password\", request, true, false);\n  }\n\n  setPassword(request: SetPasswordRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/set-password\", request, true, false);\n  }\n\n  postSetKeyConnectorKey(request: SetKeyConnectorKeyRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/set-key-connector-key\", request, true, false);\n  }\n\n  postSecurityStamp(request: SecretVerificationRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/security-stamp\", request, true, false);\n  }\n\n  async getAccountRevisionDate(): Promise<number> {\n    const r = await this.send(\"GET\", \"/accounts/revision-date\", null, true, true);\n    return r as number;\n  }\n\n  postPasswordHint(request: PasswordHintRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/password-hint\", request, false, false);\n  }\n\n  async postRegister(request: RegisterRequest): Promise<RegisterResponse> {\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const r = await this.send(\n      \"POST\",\n      \"/accounts/register\",\n      request,\n      false,\n      true,\n      env.getIdentityUrl(),\n    );\n    return new RegisterResponse(r);\n  }\n\n  async postPremium(data: FormData): Promise<PaymentResponse> {\n    const r = await this.send(\"POST\", \"/accounts/premium\", data, true, true);\n    return new PaymentResponse(r);\n  }\n\n  postReinstatePremium(): Promise<any> {\n    return this.send(\"POST\", \"/accounts/reinstate-premium\", null, true, false);\n  }\n\n  async postAccountStorage(request: StorageRequest): Promise<PaymentResponse> {\n    const r = await this.send(\"POST\", \"/accounts/storage\", request, true, true);\n    return new PaymentResponse(r);\n  }\n\n  postAccountPayment(request: PaymentRequest): Promise<void> {\n    return this.send(\"POST\", \"/accounts/payment\", request, true, false);\n  }\n\n  postAccountLicense(data: FormData): Promise<any> {\n    return this.send(\"POST\", \"/accounts/license\", data, true, false);\n  }\n\n  postAccountKeys(request: KeysRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/keys\", request, true, false);\n  }\n\n  postAccountVerifyEmail(): Promise<any> {\n    return this.send(\"POST\", \"/accounts/verify-email\", null, true, false);\n  }\n\n  postAccountVerifyEmailToken(request: VerifyEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/verify-email-token\", request, false, false);\n  }\n\n  postAccountVerifyPassword(\n    request: SecretVerificationRequest,\n  ): Promise<MasterPasswordPolicyResponse> {\n    return this.send(\"POST\", \"/accounts/verify-password\", request, true, true);\n  }\n\n  postAccountRecoverDelete(request: DeleteRecoverRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/delete-recover\", request, false, false);\n  }\n\n  postAccountRecoverDeleteToken(request: VerifyDeleteRecoverRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/delete-recover-token\", request, false, false);\n  }\n\n  postAccountKdf(request: KdfRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/kdf\", request, true, false);\n  }\n\n  async deleteSsoUser(organizationId: string): Promise<void> {\n    return this.send(\"DELETE\", \"/accounts/sso/\" + organizationId, null, true, false);\n  }\n\n  async getSsoUserIdentifier(): Promise<string> {\n    return this.send(\"GET\", \"/accounts/sso/user-identifier\", null, true, true);\n  }\n\n  async postUserApiKey(id: string, request: SecretVerificationRequest): Promise<ApiKeyResponse> {\n    const r = await this.send(\"POST\", \"/accounts/api-key\", request, true, true);\n    return new ApiKeyResponse(r);\n  }\n\n  async postUserRotateApiKey(\n    id: string,\n    request: SecretVerificationRequest,\n  ): Promise<ApiKeyResponse> {\n    const r = await this.send(\"POST\", \"/accounts/rotate-api-key\", request, true, true);\n    return new ApiKeyResponse(r);\n  }\n\n  putUpdateTempPassword(request: UpdateTempPasswordRequest): Promise<any> {\n    return this.send(\"PUT\", \"/accounts/update-temp-password\", request, true, false);\n  }\n\n  postConvertToKeyConnector(): Promise<void> {\n    return this.send(\"POST\", \"/accounts/convert-to-key-connector\", null, true, false);\n  }\n\n  // Account Billing APIs\n\n  async getUserBillingHistory(): Promise<BillingHistoryResponse> {\n    const r = await this.send(\"GET\", \"/accounts/billing/history\", null, true, true);\n    return new BillingHistoryResponse(r);\n  }\n\n  async getUserBillingPayment(): Promise<BillingPaymentResponse> {\n    const r = await this.send(\"GET\", \"/accounts/billing/payment-method\", null, true, true);\n    return new BillingPaymentResponse(r);\n  }\n\n  // Cipher APIs\n\n  async getCipher(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id, null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getFullCipherDetails(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id + \"/details\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getCipherAdmin(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id + \"/admin\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getCiphersOrganization(organizationId: string): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/ciphers/organization-details?organizationId=\" + organizationId,\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CipherResponse);\n  }\n\n  async postCipher(request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async postCipherCreate(request: CipherCreateRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/create\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async postCipherAdmin(request: CipherCreateRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/admin\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putCipher(id: string, request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id, request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putPartialCipher(id: string, request: CipherPartialRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/partial\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putCipherAdmin(id: string, request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/admin\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  deleteCipher(id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id, null, true, false);\n  }\n\n  deleteCipherAdmin(id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id + \"/admin\", null, true, false);\n  }\n\n  deleteManyCiphers(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers\", request, true, false);\n  }\n\n  deleteManyCiphersAdmin(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/admin\", request, true, false);\n  }\n\n  putMoveCiphers(request: CipherBulkMoveRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/move\", request, true, false);\n  }\n\n  async putShareCipher(id: string, request: CipherShareRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/share\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  putShareCiphers(request: CipherBulkShareRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/share\", request, true, false);\n  }\n\n  async putCipherCollections(\n    id: string,\n    request: CipherCollectionsRequest,\n  ): Promise<OptionalCipherResponse> {\n    const response = await this.send(\n      \"PUT\",\n      \"/ciphers/\" + id + \"/collections_v2\",\n      request,\n      true,\n      true,\n    );\n    return new OptionalCipherResponse(response);\n  }\n\n  putCipherCollectionsAdmin(id: string, request: CipherCollectionsRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/collections-admin\", request, true, false);\n  }\n\n  postPurgeCiphers(\n    request: SecretVerificationRequest,\n    organizationId: string = null,\n  ): Promise<any> {\n    let path = \"/ciphers/purge\";\n    if (organizationId != null) {\n      path += \"?organizationId=\" + organizationId;\n    }\n    return this.send(\"POST\", path, request, true, false);\n  }\n\n  putDeleteCipher(id: string): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/delete\", null, true, false);\n  }\n\n  putDeleteCipherAdmin(id: string): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/delete-admin\", null, true, false);\n  }\n\n  putDeleteManyCiphers(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/delete\", request, true, false);\n  }\n\n  putDeleteManyCiphersAdmin(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/delete-admin\", request, true, false);\n  }\n\n  async putRestoreCipher(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/restore\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putRestoreCipherAdmin(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/restore-admin\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putRestoreManyCiphers(\n    request: CipherBulkRestoreRequest,\n  ): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\"PUT\", \"/ciphers/restore\", request, true, true);\n    return new ListResponse<CipherResponse>(r, CipherResponse);\n  }\n\n  async putRestoreManyCiphersAdmin(\n    request: CipherBulkRestoreRequest,\n  ): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\"PUT\", \"/ciphers/restore-admin\", request, true, true);\n    return new ListResponse<CipherResponse>(r, CipherResponse);\n  }\n\n  // Attachments APIs\n\n  async getAttachmentData(\n    cipherId: string,\n    attachmentId: string,\n    emergencyAccessId?: string,\n  ): Promise<AttachmentResponse> {\n    const path =\n      (emergencyAccessId != null ? \"/emergency-access/\" + emergencyAccessId + \"/\" : \"/ciphers/\") +\n      cipherId +\n      \"/attachment/\" +\n      attachmentId;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new AttachmentResponse(r);\n  }\n\n  async postCipherAttachment(\n    id: string,\n    request: AttachmentRequest,\n  ): Promise<AttachmentUploadDataResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment/v2\", request, true, true);\n    return new AttachmentUploadDataResponse(r);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postCipherAttachmentLegacy(id: string, data: FormData): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment\", data, true, true);\n    return new CipherResponse(r);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postCipherAttachmentAdminLegacy(id: string, data: FormData): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment-admin\", data, true, true);\n    return new CipherResponse(r);\n  }\n\n  deleteCipherAttachment(id: string, attachmentId: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id + \"/attachment/\" + attachmentId, null, true, false);\n  }\n\n  deleteCipherAttachmentAdmin(id: string, attachmentId: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/admin\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  postShareCipherAttachment(\n    id: string,\n    attachmentId: string,\n    data: FormData,\n    organizationId: string,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/share?organizationId=\" + organizationId,\n      data,\n      true,\n      false,\n    );\n  }\n\n  async renewAttachmentUploadUrl(\n    id: string,\n    attachmentId: string,\n  ): Promise<AttachmentUploadDataResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/renew\",\n      null,\n      true,\n      true,\n    );\n    return new AttachmentUploadDataResponse(r);\n  }\n\n  postAttachmentFile(id: string, attachmentId: string, data: FormData): Promise<any> {\n    return this.send(\"POST\", \"/ciphers/\" + id + \"/attachment/\" + attachmentId, data, true, false);\n  }\n\n  // Collections APIs\n\n  async getCollectionAccessDetails(\n    organizationId: string,\n    id: string,\n  ): Promise<CollectionAccessDetailsResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/details\",\n      null,\n      true,\n      true,\n    );\n    return new CollectionAccessDetailsResponse(r);\n  }\n\n  async getUserCollections(): Promise<ListResponse<CollectionResponse>> {\n    const r = await this.send(\"GET\", \"/collections\", null, true, true);\n    return new ListResponse(r, CollectionResponse);\n  }\n\n  async getCollections(organizationId: string): Promise<ListResponse<CollectionResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CollectionResponse);\n  }\n\n  async getManyCollectionsWithAccessDetails(\n    organizationId: string,\n  ): Promise<ListResponse<CollectionAccessDetailsResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/details\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CollectionAccessDetailsResponse);\n  }\n\n  async getCollectionUsers(\n    organizationId: string,\n    id: string,\n  ): Promise<SelectionReadOnlyResponse[]> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/users\",\n      null,\n      true,\n      true,\n    );\n    return r.map((dr: any) => new SelectionReadOnlyResponse(dr));\n  }\n\n  async postCollection(\n    organizationId: string,\n    request: CollectionRequest,\n  ): Promise<CollectionDetailsResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      request,\n      true,\n      true,\n    );\n    return new CollectionDetailsResponse(r);\n  }\n\n  async putCollection(\n    organizationId: string,\n    id: string,\n    request: CollectionRequest,\n  ): Promise<CollectionDetailsResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id,\n      request,\n      true,\n      true,\n    );\n    return new CollectionDetailsResponse(r);\n  }\n\n  async putCollectionUsers(\n    organizationId: string,\n    id: string,\n    request: SelectionReadOnlyRequest[],\n  ): Promise<any> {\n    await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/users\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  deleteCollection(organizationId: string, id: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id,\n      null,\n      true,\n      false,\n    );\n  }\n\n  deleteManyCollections(organizationId: string, collectionIds: string[]): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      new CollectionBulkDeleteRequest(collectionIds),\n      true,\n      false,\n    );\n  }\n\n  deleteCollectionUser(\n    organizationId: string,\n    id: string,\n    organizationUserId: string,\n  ): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/user/\" + organizationUserId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Groups APIs\n\n  async getGroupUsers(organizationId: string, id: string): Promise<string[]> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/groups/\" + id + \"/users\",\n      null,\n      true,\n      true,\n    );\n    return r;\n  }\n\n  deleteGroupUser(organizationId: string, id: string, organizationUserId: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/groups/\" + id + \"/user/\" + organizationUserId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Plan APIs\n\n  async getPlans(): Promise<ListResponse<PlanResponse>> {\n    const r = await this.send(\"GET\", \"/plans\", null, false, true);\n    return new ListResponse(r, PlanResponse);\n  }\n\n  async postPublicImportDirectory(request: OrganizationImportRequest): Promise<any> {\n    return this.send(\"POST\", \"/public/organization/import\", request, true, false);\n  }\n\n  async getTaxRates(): Promise<ListResponse<TaxRateResponse>> {\n    const r = await this.send(\"GET\", \"/plans/sales-tax-rates/\", null, true, true);\n    return new ListResponse(r, TaxRateResponse);\n  }\n\n  // Settings APIs\n\n  async getSettingsDomains(): Promise<DomainsResponse> {\n    const r = await this.send(\"GET\", \"/settings/domains\", null, true, true);\n    return new DomainsResponse(r);\n  }\n\n  async putSettingsDomains(request: UpdateDomainsRequest): Promise<DomainsResponse> {\n    const r = await this.send(\"PUT\", \"/settings/domains\", request, true, true);\n    return new DomainsResponse(r);\n  }\n\n  // Sync APIs\n\n  async getSync(): Promise<SyncResponse> {\n    const path = this.isDesktopClient || this.isWebClient ? \"/sync?excludeDomains=true\" : \"/sync\";\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new SyncResponse(r);\n  }\n\n  // Two-factor APIs\n\n  async getTwoFactorProviders(): Promise<ListResponse<TwoFactorProviderResponse>> {\n    const r = await this.send(\"GET\", \"/two-factor\", null, true, true);\n    return new ListResponse(r, TwoFactorProviderResponse);\n  }\n\n  async getTwoFactorOrganizationProviders(\n    organizationId: string,\n  ): Promise<ListResponse<TwoFactorProviderResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/two-factor\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, TwoFactorProviderResponse);\n  }\n\n  async getTwoFactorAuthenticator(\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorAuthenticatorResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-authenticator\", request, true, true);\n    return new TwoFactorAuthenticatorResponse(r);\n  }\n\n  async getTwoFactorEmail(request: SecretVerificationRequest): Promise<TwoFactorEmailResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-email\", request, true, true);\n    return new TwoFactorEmailResponse(r);\n  }\n\n  async getTwoFactorDuo(request: SecretVerificationRequest): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-duo\", request, true, true);\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async getTwoFactorOrganizationDuo(\n    organizationId: string,\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/organizations/\" + organizationId + \"/two-factor/get-duo\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async getTwoFactorYubiKey(request: SecretVerificationRequest): Promise<TwoFactorYubiKeyResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-yubikey\", request, true, true);\n    return new TwoFactorYubiKeyResponse(r);\n  }\n\n  async getTwoFactorWebAuthn(\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-webauthn\", request, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async getTwoFactorWebAuthnChallenge(\n    request: SecretVerificationRequest,\n  ): Promise<ChallengeResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-webauthn-challenge\", request, true, true);\n    return new ChallengeResponse(r);\n  }\n\n  async getTwoFactorRecover(request: SecretVerificationRequest): Promise<TwoFactorRecoverResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-recover\", request, true, true);\n    return new TwoFactorRecoverResponse(r);\n  }\n\n  async putTwoFactorAuthenticator(\n    request: UpdateTwoFactorAuthenticatorRequest,\n  ): Promise<TwoFactorAuthenticatorResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/authenticator\", request, true, true);\n    return new TwoFactorAuthenticatorResponse(r);\n  }\n\n  async putTwoFactorEmail(request: UpdateTwoFactorEmailRequest): Promise<TwoFactorEmailResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/email\", request, true, true);\n    return new TwoFactorEmailResponse(r);\n  }\n\n  async putTwoFactorDuo(request: UpdateTwoFactorDuoRequest): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/duo\", request, true, true);\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async putTwoFactorOrganizationDuo(\n    organizationId: string,\n    request: UpdateTwoFactorDuoRequest,\n  ): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/two-factor/duo\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async putTwoFactorYubiKey(\n    request: UpdateTwoFactorYubioOtpRequest,\n  ): Promise<TwoFactorYubiKeyResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/yubikey\", request, true, true);\n    return new TwoFactorYubiKeyResponse(r);\n  }\n\n  async putTwoFactorWebAuthn(\n    request: UpdateTwoFactorWebAuthnRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const response = request.deviceResponse.response as AuthenticatorAttestationResponse;\n    const data: any = Object.assign({}, request);\n\n    data.deviceResponse = {\n      id: request.deviceResponse.id,\n      rawId: btoa(request.deviceResponse.id),\n      type: request.deviceResponse.type,\n      extensions: request.deviceResponse.getClientExtensionResults(),\n      response: {\n        AttestationObject: Utils.fromBufferToB64(response.attestationObject),\n        clientDataJson: Utils.fromBufferToB64(response.clientDataJSON),\n      },\n    };\n\n    const r = await this.send(\"PUT\", \"/two-factor/webauthn\", data, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async deleteTwoFactorWebAuthn(\n    request: UpdateTwoFactorWebAuthnDeleteRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const r = await this.send(\"DELETE\", \"/two-factor/webauthn\", request, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async putTwoFactorDisable(request: TwoFactorProviderRequest): Promise<TwoFactorProviderResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/disable\", request, true, true);\n    return new TwoFactorProviderResponse(r);\n  }\n\n  async putTwoFactorOrganizationDisable(\n    organizationId: string,\n    request: TwoFactorProviderRequest,\n  ): Promise<TwoFactorProviderResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/two-factor/disable\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorProviderResponse(r);\n  }\n\n  postTwoFactorRecover(request: TwoFactorRecoveryRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/recover\", request, false, false);\n  }\n\n  postTwoFactorEmailSetup(request: TwoFactorEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/send-email\", request, true, false);\n  }\n\n  postTwoFactorEmail(request: TwoFactorEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/send-email-login\", request, false, false);\n  }\n\n  async getDeviceVerificationSettings(): Promise<DeviceVerificationResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/two-factor/get-device-verification-settings\",\n      null,\n      true,\n      true,\n    );\n    return new DeviceVerificationResponse(r);\n  }\n\n  async putDeviceVerificationSettings(\n    request: DeviceVerificationRequest,\n  ): Promise<DeviceVerificationResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/two-factor/device-verification-settings\",\n      request,\n      true,\n      true,\n    );\n    return new DeviceVerificationResponse(r);\n  }\n\n  // Organization APIs\n\n  async getCloudCommunicationsEnabled(): Promise<boolean> {\n    const r = await this.send(\"GET\", \"/organizations/connections/enabled\", null, true, true);\n    return r as boolean;\n  }\n\n  async getOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    id: string,\n    type: OrganizationConnectionType,\n    configType: { new (response: any): TConfig },\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\"GET\", `/organizations/connections/${id}/${type}`, null, true, true);\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async createOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    request: OrganizationConnectionRequest,\n    configType: { new (response: any): TConfig },\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\"POST\", \"/organizations/connections/\", request, true, true);\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async updateOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    request: OrganizationConnectionRequest,\n    configType: { new (response: any): TConfig },\n    organizationConnectionId?: string,\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/connections/\" + organizationConnectionId,\n      request,\n      true,\n      true,\n    );\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async deleteOrganizationConnection(id: string): Promise<void> {\n    return this.send(\"DELETE\", \"/organizations/connections/\" + id, null, true, false);\n  }\n\n  // Provider User APIs\n\n  async getProviderUsers(\n    providerId: string,\n  ): Promise<ListResponse<ProviderUserUserDetailsResponse>> {\n    const r = await this.send(\"GET\", \"/providers/\" + providerId + \"/users\", null, true, true);\n    return new ListResponse(r, ProviderUserUserDetailsResponse);\n  }\n\n  async getProviderUser(providerId: string, id: string): Promise<ProviderUserResponse> {\n    const r = await this.send(\"GET\", \"/providers/\" + providerId + \"/users/\" + id, null, true, true);\n    return new ProviderUserResponse(r);\n  }\n\n  postProviderUserInvite(providerId: string, request: ProviderUserInviteRequest): Promise<any> {\n    return this.send(\"POST\", \"/providers/\" + providerId + \"/users/invite\", request, true, false);\n  }\n\n  postProviderUserReinvite(providerId: string, id: string): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/reinvite\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  async postManyProviderUserReinvite(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/reinvite\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  async postProviderUserBulkConfirm(\n    providerId: string,\n    request: ProviderUserBulkConfirmRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/confirm\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  async deleteManyProviderUsers(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\"DELETE\", \"/providers/\" + providerId + \"/users\", request, true, true);\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  postProviderUserAccept(\n    providerId: string,\n    id: string,\n    request: ProviderUserAcceptRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/accept\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  postProviderUserConfirm(\n    providerId: string,\n    id: string,\n    request: ProviderUserConfirmRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/confirm\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postProviderUsersPublicKey(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkPublicKeyResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/public-keys\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkPublicKeyResponse);\n  }\n\n  putProviderUser(\n    providerId: string,\n    id: string,\n    request: ProviderUserUpdateRequest,\n  ): Promise<any> {\n    return this.send(\"PUT\", \"/providers/\" + providerId + \"/users/\" + id, request, true, false);\n  }\n\n  deleteProviderUser(providerId: string, id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/providers/\" + providerId + \"/users/\" + id, null, true, false);\n  }\n\n  // Provider Organization APIs\n\n  async getProviderClients(\n    providerId: string,\n  ): Promise<ListResponse<ProviderOrganizationOrganizationDetailsResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/providers/\" + providerId + \"/organizations\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderOrganizationOrganizationDetailsResponse);\n  }\n\n  postProviderAddOrganization(\n    providerId: string,\n    request: ProviderAddOrganizationRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/organizations/add\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postProviderCreateOrganization(\n    providerId: string,\n    request: ProviderOrganizationCreateRequest,\n  ): Promise<ProviderOrganizationResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/organizations\",\n      request,\n      true,\n      true,\n    );\n    return new ProviderOrganizationResponse(r);\n  }\n\n  deleteProviderOrganization(providerId: string, id: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/providers/\" + providerId + \"/organizations/\" + id,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Event APIs\n\n  async getEvents(start: string, end: string, token: string): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsCipher(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/ciphers/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsOrganization(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/organizations/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsOrganizationUser(\n    organizationId: string,\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\n        \"/organizations/\" + organizationId + \"/users/\" + id + \"/events\",\n        start,\n        end,\n        token,\n      ),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsProvider(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/providers/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsProviderUser(\n    providerId: string,\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\n        \"/providers/\" + providerId + \"/users/\" + id + \"/events\",\n        start,\n        end,\n        token,\n      ),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async postEventsCollect(request: EventRequest[], userId?: UserId): Promise<any> {\n    const authHeader = await this.tokenService.getAccessToken(userId);\n    const headers = new Headers({\n      \"Device-Type\": this.deviceType,\n      Authorization: \"Bearer \" + authHeader,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const response = await this.fetch(\n      new Request(env.getEventsUrl() + \"/collect\", {\n        cache: \"no-store\",\n        credentials: await this.getCredentials(),\n        method: \"POST\",\n        body: JSON.stringify(request),\n        headers: headers,\n      }),\n    );\n    if (response.status !== 200) {\n      return Promise.reject(\"Event post failed.\");\n    }\n  }\n\n  // User APIs\n\n  async getUserPublicKey(id: string): Promise<UserKeyResponse> {\n    const r = await this.send(\"GET\", \"/users/\" + id + \"/public-key\", null, true, true);\n    return new UserKeyResponse(r);\n  }\n\n  // HIBP APIs\n\n  async getHibpBreach(username: string): Promise<BreachAccountResponse[]> {\n    const r = await this.send(\"GET\", \"/hibp/breach?username=\" + username, null, true, true);\n    return r.map((a: any) => new BreachAccountResponse(a));\n  }\n\n  // Misc\n\n  async postBitPayInvoice(request: BitPayInvoiceRequest): Promise<string> {\n    const r = await this.send(\"POST\", \"/bitpay-invoice\", request, true, true);\n    return r as string;\n  }\n\n  async postSetupPayment(): Promise<string> {\n    const r = await this.send(\"POST\", \"/setup-payment\", null, true, true);\n    return r as string;\n  }\n\n  // Key Connector\n\n  async getMasterKeyFromKeyConnector(\n    keyConnectorUrl: string,\n  ): Promise<KeyConnectorUserKeyResponse> {\n    const authHeader = await this.getActiveBearerToken();\n\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/user-keys\", {\n        cache: \"no-store\",\n        method: \"GET\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + authHeader,\n        }),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n\n    return new KeyConnectorUserKeyResponse(await response.json());\n  }\n\n  async postUserKeyToKeyConnector(\n    keyConnectorUrl: string,\n    request: KeyConnectorUserKeyRequest,\n  ): Promise<void> {\n    const authHeader = await this.getActiveBearerToken();\n\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/user-keys\", {\n        cache: \"no-store\",\n        method: \"POST\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + authHeader,\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        }),\n        body: JSON.stringify(request),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async getKeyConnectorAlive(keyConnectorUrl: string) {\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/alive\", {\n        cache: \"no-store\",\n        method: \"GET\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        }),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async getOrganizationExport(organizationId: string): Promise<OrganizationExportResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/export\",\n      null,\n      true,\n      true,\n    );\n    return new OrganizationExportResponse(r);\n  }\n\n  // Helpers\n\n  async getActiveBearerToken(): Promise<string> {\n    let accessToken = await this.tokenService.getAccessToken();\n    if (await this.tokenService.tokenNeedsRefresh()) {\n      await this.doAuthRefresh();\n      accessToken = await this.tokenService.getAccessToken();\n    }\n    return accessToken;\n  }\n\n  async fetch(request: Request): Promise<Response> {\n    if (request.method === \"GET\") {\n      request.headers.set(\"Cache-Control\", \"no-store\");\n      request.headers.set(\"Pragma\", \"no-cache\");\n    }\n    request.headers.set(\"Bitwarden-Client-Name\", this.platformUtilsService.getClientType());\n    request.headers.set(\n      \"Bitwarden-Client-Version\",\n      await this.platformUtilsService.getApplicationVersionNumber(),\n    );\n    return this.nativeFetch(request);\n  }\n\n  nativeFetch(request: Request): Promise<Response> {\n    return fetch(request);\n  }\n\n  async preValidateSso(identifier: string): Promise<SsoPreValidateResponse> {\n    if (identifier == null || identifier === \"\") {\n      throw new Error(\"Organization Identifier was not provided.\");\n    }\n    const headers = new Headers({\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const path = `/sso/prevalidate?domainHint=${encodeURIComponent(identifier)}`;\n    const response = await this.fetch(\n      new Request(env.getIdentityUrl() + path, {\n        cache: \"no-store\",\n        credentials: await this.getCredentials(),\n        headers: headers,\n        method: \"GET\",\n      }),\n    );\n\n    if (response.status === 200) {\n      const body = await response.json();\n      return new SsoPreValidateResponse(body);\n    } else {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async postCreateSponsorship(\n    sponsoredOrgId: string,\n    request: OrganizationSponsorshipCreateRequest,\n  ): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/\" +\n        (this.platformUtilsService.isSelfHost() ? \"self-hosted/\" : \"\") +\n        sponsoredOrgId +\n        \"/families-for-enterprise\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async getSponsorshipSyncStatus(\n    sponsoredOrgId: string,\n  ): Promise<OrganizationSponsorshipSyncStatusResponse> {\n    const response = await this.send(\n      \"GET\",\n      \"/organization/sponsorship/\" + sponsoredOrgId + \"/sync-status\",\n      null,\n      true,\n      true,\n    );\n    return new OrganizationSponsorshipSyncStatusResponse(response);\n  }\n\n  async deleteRevokeSponsorship(sponsoringOrganizationId: string): Promise<void> {\n    return await this.send(\n      \"DELETE\",\n      \"/organization/sponsorship/\" +\n        (this.platformUtilsService.isSelfHost() ? \"self-hosted/\" : \"\") +\n        sponsoringOrganizationId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  async deleteRemoveSponsorship(sponsoringOrgId: string): Promise<void> {\n    return await this.send(\n      \"DELETE\",\n      \"/organization/sponsorship/sponsored/\" + sponsoringOrgId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  async postPreValidateSponsorshipToken(sponsorshipToken: string): Promise<boolean> {\n    const r = await this.send(\n      \"POST\",\n      \"/organization/sponsorship/validate-token?sponsorshipToken=\" +\n        encodeURIComponent(sponsorshipToken),\n      null,\n      true,\n      true,\n    );\n    return r as boolean;\n  }\n\n  async postRedeemSponsorship(\n    sponsorshipToken: string,\n    request: OrganizationSponsorshipRedeemRequest,\n  ): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/redeem?sponsorshipToken=\" + encodeURIComponent(sponsorshipToken),\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postResendSponsorshipOffer(sponsoringOrgId: string): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/\" + sponsoringOrgId + \"/families-for-enterprise/resend\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  protected async doAuthRefresh(): Promise<void> {\n    const refreshToken = await this.tokenService.getRefreshToken();\n    if (refreshToken != null && refreshToken !== \"\") {\n      return this.doRefreshToken();\n    }\n\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n    if (!Utils.isNullOrWhitespace(clientId) && !Utils.isNullOrWhitespace(clientSecret)) {\n      return this.doApiTokenRefresh();\n    }\n\n    this.refreshAccessTokenErrorCallback();\n\n    throw new Error(\"Cannot refresh access token, no refresh token or api keys are stored.\");\n  }\n\n  protected async doRefreshToken(): Promise<void> {\n    const refreshToken = await this.tokenService.getRefreshToken();\n    if (refreshToken == null || refreshToken === \"\") {\n      throw new Error();\n    }\n    const headers = new Headers({\n      \"Content-Type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const decodedToken = await this.tokenService.decodeAccessToken();\n    const response = await this.fetch(\n      new Request(env.getIdentityUrl() + \"/connect/token\", {\n        body: this.qsStringify({\n          grant_type: \"refresh_token\",\n          client_id: decodedToken.client_id,\n          refresh_token: refreshToken,\n        }),\n        cache: \"no-store\",\n        credentials: await this.getCredentials(),\n        headers: headers,\n        method: \"POST\",\n      }),\n    );\n\n    if (response.status === 200) {\n      const responseJson = await response.json();\n      const tokenResponse = new IdentityTokenResponse(responseJson);\n\n      const newDecodedAccessToken = await this.tokenService.decodeAccessToken(\n        tokenResponse.accessToken,\n      );\n      const userId = newDecodedAccessToken.sub;\n\n      const vaultTimeoutAction = await firstValueFrom(\n        this.vaultTimeoutSettingsService.getVaultTimeoutActionByUserId$(userId),\n      );\n      const vaultTimeout = await firstValueFrom(\n        this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n      );\n\n      await this.tokenService.setTokens(\n        tokenResponse.accessToken,\n        vaultTimeoutAction as VaultTimeoutAction,\n        vaultTimeout,\n        tokenResponse.refreshToken,\n      );\n    } else {\n      const error = await this.handleError(response, true, true);\n      return Promise.reject(error);\n    }\n  }\n\n  protected async doApiTokenRefresh(): Promise<void> {\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n\n    const appId = await this.appIdService.getAppId();\n    const deviceRequest = new DeviceRequest(appId, this.platformUtilsService);\n    const tokenRequest = new UserApiTokenRequest(\n      clientId,\n      clientSecret,\n      new TokenTwoFactorRequest(),\n      deviceRequest,\n    );\n\n    const response = await this.postIdentityToken(tokenRequest);\n    if (!(response instanceof IdentityTokenResponse)) {\n      throw new Error(\"Invalid response received when refreshing api token\");\n    }\n\n    const newDecodedAccessToken = await this.tokenService.decodeAccessToken(response.accessToken);\n    const userId = newDecodedAccessToken.sub;\n\n    const vaultTimeoutAction = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutActionByUserId$(userId),\n    );\n    const vaultTimeout = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n    );\n\n    await this.tokenService.setAccessToken(\n      response.accessToken,\n      vaultTimeoutAction as VaultTimeoutAction,\n      vaultTimeout,\n    );\n  }\n\n  async send(\n    method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\",\n    path: string,\n    body: any,\n    authed: boolean,\n    hasResponse: boolean,\n    apiUrl?: string,\n    alterHeaders?: (headers: Headers) => void,\n  ): Promise<any> {\n    const env = await firstValueFrom(this.environmentService.environment$);\n    apiUrl = Utils.isNullOrWhitespace(apiUrl) ? env.getApiUrl() : apiUrl;\n\n    // Prevent directory traversal from malicious paths\n    const pathParts = path.split(\"?\");\n    const requestUrl =\n      apiUrl + Utils.normalizePath(pathParts[0]) + (pathParts.length > 1 ? `?${pathParts[1]}` : \"\");\n\n    const headers = new Headers({\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const requestInit: RequestInit = {\n      cache: \"no-store\",\n      credentials: await this.getCredentials(),\n      method: method,\n    };\n\n    if (authed) {\n      const authHeader = await this.getActiveBearerToken();\n      headers.set(\"Authorization\", \"Bearer \" + authHeader);\n    }\n    if (body != null) {\n      if (typeof body === \"string\") {\n        requestInit.body = body;\n        headers.set(\"Content-Type\", \"application/x-www-form-urlencoded; charset=utf-8\");\n      } else if (typeof body === \"object\") {\n        if (body instanceof FormData) {\n          requestInit.body = body;\n        } else {\n          headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\n          requestInit.body = JSON.stringify(body);\n        }\n      }\n    }\n    if (hasResponse) {\n      headers.set(\"Accept\", \"application/json\");\n    }\n    if (alterHeaders != null) {\n      alterHeaders(headers);\n    }\n\n    requestInit.headers = headers;\n    const response = await this.fetch(new Request(requestUrl, requestInit));\n\n    const responseType = response.headers.get(\"content-type\");\n    const responseIsJson = responseType != null && responseType.indexOf(\"application/json\") !== -1;\n    if (hasResponse && response.status === 200 && responseIsJson) {\n      const responseJson = await response.json();\n      return responseJson;\n    } else if (response.status !== 200) {\n      const error = await this.handleError(response, false, authed);\n      return Promise.reject(error);\n    }\n  }\n\n  private async handleError(\n    response: Response,\n    tokenError: boolean,\n    authed: boolean,\n  ): Promise<ErrorResponse> {\n    let responseJson: any = null;\n    if (this.isJsonResponse(response)) {\n      responseJson = await response.json();\n    } else if (this.isTextResponse(response)) {\n      responseJson = { Message: await response.text() };\n    }\n\n    if (authed) {\n      if (\n        response.status === 401 ||\n        response.status === 403 ||\n        (tokenError &&\n          response.status === 400 &&\n          responseJson != null &&\n          responseJson.error === \"invalid_grant\")\n      ) {\n        await this.logoutCallback(\"invalidGrantError\");\n        return null;\n      }\n    }\n\n    return new ErrorResponse(responseJson, response.status, tokenError);\n  }\n\n  private qsStringify(params: any): string {\n    return Object.keys(params)\n      .map((key) => {\n        return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]);\n      })\n      .join(\"&\");\n  }\n\n  private async getCredentials(): Promise<RequestCredentials> {\n    const env = await firstValueFrom(this.environmentService.environment$);\n    if (!this.isWebClient || env.hasBaseUrl()) {\n      return \"include\";\n    }\n    return undefined;\n  }\n\n  private addEventParameters(base: string, start: string, end: string, token: string) {\n    if (start != null) {\n      base += \"?start=\" + start;\n    }\n    if (end != null) {\n      base += base.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n      base += \"end=\" + end;\n    }\n    if (token != null) {\n      base += base.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n      base += \"continuationToken=\" + token;\n    }\n    return base;\n  }\n\n  private isJsonResponse(response: Response): boolean {\n    const typeHeader = response.headers.get(\"content-type\");\n    return typeHeader != null && typeHeader.indexOf(\"application/json\") > -1;\n  }\n\n  private isTextResponse(response: Response): boolean {\n    const typeHeader = response.headers.get(\"content-type\");\n    return typeHeader != null && typeHeader.indexOf(\"text\") > -1;\n  }\n}\n","import { ApiService } from \"../abstractions/api.service\";\nimport { AuditService as AuditServiceAbstraction } from \"../abstractions/audit.service\";\nimport { BreachAccountResponse } from \"../models/response/breach-account.response\";\nimport { ErrorResponse } from \"../models/response/error.response\";\nimport { CryptoFunctionService } from \"../platform/abstractions/crypto-function.service\";\nimport { throttle } from \"../platform/misc/throttle\";\nimport { Utils } from \"../platform/misc/utils\";\n\nconst PwnedPasswordsApi = \"https://api.pwnedpasswords.com/range/\";\n\nexport class AuditService implements AuditServiceAbstraction {\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private apiService: ApiService,\n  ) {}\n\n  @throttle(100, () => \"passwordLeaked\")\n  async passwordLeaked(password: string): Promise<number> {\n    const hashBytes = await this.cryptoFunctionService.hash(password, \"sha1\");\n    const hash = Utils.fromBufferToHex(hashBytes).toUpperCase();\n    const hashStart = hash.substr(0, 5);\n    const hashEnding = hash.substr(5);\n\n    const response = await this.apiService.nativeFetch(new Request(PwnedPasswordsApi + hashStart));\n    const leakedHashes = await response.text();\n    const match = leakedHashes.split(/\\r?\\n/).find((v) => {\n      return v.split(\":\")[0] === hashEnding;\n    });\n\n    return match != null ? parseInt(match.split(\":\")[1], 10) : 0;\n  }\n\n  async breachedAccounts(username: string): Promise<BreachAccountResponse[]> {\n    try {\n      return await this.apiService.getHibpBreach(username);\n    } catch (e) {\n      const error = e as ErrorResponse;\n      if (error.statusCode === 404) {\n        return [];\n      }\n      throw new Error();\n    }\n  }\n}\n","/**\n * Use as a Decorator on async functions, it will limit how many times the function can be\n * in-flight at a time.\n *\n * Calls beyond the limit will be queued, and run when one of the active calls finishes\n */\nexport function throttle(limit: number, throttleKey: (args: any[]) => string) {\n  return <T>(\n    target: any,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<(...args: any[]) => Promise<T>>,\n  ) => {\n    const originalMethod: () => Promise<T> = descriptor.value;\n    const allThrottles = new Map<any, Map<string, (() => void)[]>>();\n\n    const getThrottles = (obj: any) => {\n      let throttles = allThrottles.get(obj);\n      if (throttles != null) {\n        return throttles;\n      }\n      throttles = new Map<string, (() => void)[]>();\n      allThrottles.set(obj, throttles);\n      return throttles;\n    };\n\n    return {\n      value: function (...args: any[]) {\n        const throttles = getThrottles(this);\n        const argsThrottleKey = throttleKey(args);\n        let queue = throttles.get(argsThrottleKey);\n        if (queue == null) {\n          queue = [];\n          throttles.set(argsThrottleKey, queue);\n        }\n\n        return new Promise<T>((resolve, reject) => {\n          const exec = () => {\n            const onFinally = () => {\n              queue.splice(queue.indexOf(exec), 1);\n              if (queue.length >= limit) {\n                queue[limit - 1]();\n              } else if (queue.length === 0) {\n                throttles.delete(argsThrottleKey);\n                if (throttles.size === 0) {\n                  allThrottles.delete(this);\n                }\n              }\n            };\n            originalMethod\n              .apply(this, args)\n              .then((val: any) => {\n                onFinally();\n                return val;\n              })\n              .catch((err: any) => {\n                onFinally();\n                throw err;\n              })\n              .then(resolve, reject);\n          };\n          queue.push(exec);\n          if (queue.length <= limit) {\n            exec();\n          }\n        });\n      },\n    };\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { EventType } from \"../../enums\";\n\nexport class EventData {\n  type: EventType;\n  cipherId: string;\n  date: string;\n  organizationId: string;\n\n  static fromJSON(obj: Jsonify<EventData>): EventData {\n    return Object.assign(new EventData(), obj);\n  }\n}\n","import { EventData } from \"../../models/data/event.data\";\nimport { EVENT_COLLECTION_DISK, UserKeyDefinition } from \"../../platform/state\";\n\nexport const EVENT_COLLECTION = UserKeyDefinition.array<EventData>(\n  EVENT_COLLECTION_DISK,\n  \"events\",\n  {\n    deserializer: (s) => EventData.fromJSON(s),\n    clearOn: [\"logout\"],\n  },\n);\n","import { firstValueFrom, map, from, zip } from \"rxjs\";\n\nimport { EventCollectionService as EventCollectionServiceAbstraction } from \"../../abstractions/event/event-collection.service\";\nimport { EventUploadService } from \"../../abstractions/event/event-upload.service\";\nimport { OrganizationService } from \"../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { EventType } from \"../../enums\";\nimport { EventData } from \"../../models/data/event.data\";\nimport { StateProvider } from \"../../platform/state\";\nimport { CipherService } from \"../../vault/abstractions/cipher.service\";\n\nimport { EVENT_COLLECTION } from \"./key-definitions\";\n\nexport class EventCollectionService implements EventCollectionServiceAbstraction {\n  constructor(\n    private cipherService: CipherService,\n    private stateProvider: StateProvider,\n    private organizationService: OrganizationService,\n    private eventUploadService: EventUploadService,\n    private authService: AuthService,\n  ) {}\n\n  /** Adds an event to the active user's event collection\n   *  @param eventType the event type to be added\n   *  @param cipherId if provided the id of the cipher involved in the event\n   *  @param uploadImmediately in some cases the recorded events should be uploaded right after being added\n   *  @param organizationId the organizationId involved in the event. If the cipherId is not provided an organizationId is required\n   */\n  async collect(\n    eventType: EventType,\n    cipherId: string = null,\n    uploadImmediately = false,\n    organizationId: string = null,\n  ): Promise<any> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    const eventStore = this.stateProvider.getUser(userId, EVENT_COLLECTION);\n\n    if (!(await this.shouldUpdate(cipherId, organizationId, eventType))) {\n      return;\n    }\n\n    const event = new EventData();\n    event.type = eventType;\n    event.cipherId = cipherId;\n    event.date = new Date().toISOString();\n    event.organizationId = organizationId;\n\n    await eventStore.update((events) => {\n      events = events ?? [];\n      events.push(event);\n      return events;\n    });\n\n    if (uploadImmediately) {\n      await this.eventUploadService.uploadEvents();\n    }\n  }\n\n  /** Verifies if the event collection should be updated for the provided information\n   *  @param cipherId the cipher for the event\n   *  @param organizationId the organization for the event\n   */\n  private async shouldUpdate(\n    cipherId: string = null,\n    organizationId: string = null,\n    eventType: EventType = null,\n  ): Promise<boolean> {\n    const orgIds$ = this.organizationService.organizations$.pipe(\n      map((orgs) => orgs?.filter((o) => o.useEvents)?.map((x) => x.id) ?? []),\n    );\n\n    const cipher$ = from(this.cipherService.get(cipherId));\n\n    const [authStatus, orgIds, cipher] = await firstValueFrom(\n      zip(this.authService.activeAccountStatus$, orgIds$, cipher$),\n    );\n\n    // The user must be authorized\n    if (authStatus != AuthenticationStatus.Unlocked) {\n      return false;\n    }\n\n    // User must have organizations assigned to them\n    if (orgIds == null || orgIds.length == 0) {\n      return false;\n    }\n\n    // Individual vault export doesn't need cipher id or organization id.\n    if (eventType == EventType.User_ClientExportedVault) {\n      return true;\n    }\n\n    // If the cipher is null there must be an organization id provided\n    if (cipher == null && organizationId == null) {\n      return false;\n    }\n\n    // If the cipher is present it must be in the user's org list\n    if (cipher != null && !orgIds.includes(cipher?.organizationId)) {\n      return false;\n    }\n\n    // If the organization id is provided it must be in the user's org list\n    if (organizationId != null && !orgIds.includes(organizationId)) {\n      return false;\n    }\n\n    return true;\n  }\n}\n","import { EventType } from \"../../enums\";\n\nexport class EventRequest {\n  type: EventType;\n  cipherId: string;\n  date: string;\n  organizationId: string;\n}\n","import { firstValueFrom, map } from \"rxjs\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { EventUploadService as EventUploadServiceAbstraction } from \"../../abstractions/event/event-upload.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { EventData } from \"../../models/data/event.data\";\nimport { EventRequest } from \"../../models/request/event.request\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { StateProvider } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\n\nimport { EVENT_COLLECTION } from \"./key-definitions\";\n\nexport class EventUploadService implements EventUploadServiceAbstraction {\n  private inited = false;\n  constructor(\n    private apiService: ApiService,\n    private stateProvider: StateProvider,\n    private logService: LogService,\n    private authService: AuthService,\n  ) {}\n\n  init(checkOnInterval: boolean) {\n    if (this.inited) {\n      return;\n    }\n\n    this.inited = true;\n    if (checkOnInterval) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.uploadEvents();\n      setInterval(() => this.uploadEvents(), 60 * 1000); // check every 60 seconds\n    }\n  }\n\n  /** Upload the event collection from state.\n   *  @param userId upload events for provided user. If not active user will be used.\n   */\n  async uploadEvents(userId?: UserId): Promise<void> {\n    if (!userId) {\n      userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    }\n\n    if (!userId) {\n      return;\n    }\n\n    const isUnlocked = await firstValueFrom(\n      this.authService\n        .authStatusFor$(userId)\n        .pipe(map((status) => status === AuthenticationStatus.Unlocked)),\n    );\n    if (!isUnlocked) {\n      return;\n    }\n\n    const eventCollection = await this.takeEvents(userId);\n\n    if (eventCollection == null || eventCollection.length === 0) {\n      return;\n    }\n    const request = eventCollection.map((e) => {\n      const req = new EventRequest();\n      req.type = e.type;\n      req.cipherId = e.cipherId;\n      req.date = e.date;\n      req.organizationId = e.organizationId;\n      return req;\n    });\n    try {\n      await this.apiService.postEventsCollect(request, userId);\n    } catch (e) {\n      this.logService.error(e);\n      // Add the events back to state if there was an error and they were not uploaded.\n      await this.stateProvider.setUserState(EVENT_COLLECTION, eventCollection, userId);\n    }\n  }\n\n  /** Return user's events and then clear them from state\n   *  @param userId the user to grab and clear events for\n   */\n  private async takeEvents(userId: UserId): Promise<EventData[]> {\n    let taken = null;\n    await this.stateProvider.getUser(userId, EVENT_COLLECTION).update((current) => {\n      taken = current ?? [];\n      return [];\n    });\n\n    return taken;\n  }\n}\n","import { NotificationType } from \"../../enums\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class NotificationResponse extends BaseResponse {\n  contextId: string;\n  type: NotificationType;\n  payload: any;\n\n  constructor(response: any) {\n    super(response);\n    this.contextId = this.getResponseProperty(\"ContextId\");\n    this.type = this.getResponseProperty(\"Type\");\n\n    const payload = this.getResponseProperty(\"Payload\");\n    switch (this.type) {\n      case NotificationType.SyncCipherCreate:\n      case NotificationType.SyncCipherDelete:\n      case NotificationType.SyncCipherUpdate:\n      case NotificationType.SyncLoginDelete:\n        this.payload = new SyncCipherNotification(payload);\n        break;\n      case NotificationType.SyncFolderCreate:\n      case NotificationType.SyncFolderDelete:\n      case NotificationType.SyncFolderUpdate:\n        this.payload = new SyncFolderNotification(payload);\n        break;\n      case NotificationType.SyncVault:\n      case NotificationType.SyncCiphers:\n      case NotificationType.SyncOrganizations:\n      case NotificationType.SyncOrgKeys:\n      case NotificationType.SyncSettings:\n      case NotificationType.LogOut:\n        this.payload = new UserNotification(payload);\n        break;\n      case NotificationType.SyncSendCreate:\n      case NotificationType.SyncSendUpdate:\n      case NotificationType.SyncSendDelete:\n        this.payload = new SyncSendNotification(payload);\n        break;\n      case NotificationType.AuthRequest:\n      case NotificationType.AuthRequestResponse:\n        this.payload = new AuthRequestPushNotification(payload);\n        break;\n      default:\n        break;\n    }\n  }\n}\n\nexport class SyncCipherNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  organizationId: string;\n  collectionIds: string[];\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.collectionIds = this.getResponseProperty(\"CollectionIds\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class SyncFolderNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class UserNotification extends BaseResponse {\n  userId: string;\n  date: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.date = new Date(this.getResponseProperty(\"Date\"));\n  }\n}\n\nexport class SyncSendNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class AuthRequestPushNotification extends BaseResponse {\n  id: string;\n  userId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n  }\n}\n","import * as signalR from \"@microsoft/signalr\";\nimport * as signalRMsgPack from \"@microsoft/signalr-protocol-msgpack\";\nimport { firstValueFrom } from \"rxjs\";\n\nimport { LogoutReason } from \"@bitwarden/auth/common\";\n\nimport { AuthRequestServiceAbstraction } from \"../../../auth/src/common/abstractions\";\nimport { ApiService } from \"../abstractions/api.service\";\nimport { NotificationsService as NotificationsServiceAbstraction } from \"../abstractions/notifications.service\";\nimport { AuthService } from \"../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../auth/enums/authentication-status\";\nimport { NotificationType } from \"../enums\";\nimport {\n  NotificationResponse,\n  SyncCipherNotification,\n  SyncFolderNotification,\n  SyncSendNotification,\n} from \"../models/response/notification.response\";\nimport { AppIdService } from \"../platform/abstractions/app-id.service\";\nimport { EnvironmentService } from \"../platform/abstractions/environment.service\";\nimport { LogService } from \"../platform/abstractions/log.service\";\nimport { MessagingService } from \"../platform/abstractions/messaging.service\";\nimport { StateService } from \"../platform/abstractions/state.service\";\nimport { UserId } from \"../types/guid\";\nimport { SyncService } from \"../vault/abstractions/sync/sync.service.abstraction\";\n\nexport class NotificationsService implements NotificationsServiceAbstraction {\n  private signalrConnection: signalR.HubConnection;\n  private url: string;\n  private connected = false;\n  private inited = false;\n  private inactive = false;\n  private reconnectTimer: any = null;\n\n  constructor(\n    private logService: LogService,\n    private syncService: SyncService,\n    private appIdService: AppIdService,\n    private apiService: ApiService,\n    private environmentService: EnvironmentService,\n    private logoutCallback: (logoutReason: LogoutReason) => Promise<void>,\n    private stateService: StateService,\n    private authService: AuthService,\n    private authRequestService: AuthRequestServiceAbstraction,\n    private messagingService: MessagingService,\n  ) {\n    this.environmentService.environment$.subscribe(() => {\n      if (!this.inited) {\n        return;\n      }\n\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.init();\n    });\n  }\n\n  async init(): Promise<void> {\n    this.inited = false;\n    this.url = (await firstValueFrom(this.environmentService.environment$)).getNotificationsUrl();\n\n    // Set notifications server URL to `https://-` to effectively disable communication\n    // with the notifications server from the client app\n    if (this.url === \"https://-\") {\n      return;\n    }\n\n    if (this.signalrConnection != null) {\n      this.signalrConnection.off(\"ReceiveMessage\");\n      this.signalrConnection.off(\"Heartbeat\");\n      await this.signalrConnection.stop();\n      this.connected = false;\n      this.signalrConnection = null;\n    }\n\n    this.signalrConnection = new signalR.HubConnectionBuilder()\n      .withUrl(this.url + \"/hub\", {\n        accessTokenFactory: () => this.apiService.getActiveBearerToken(),\n        skipNegotiation: true,\n        transport: signalR.HttpTransportType.WebSockets,\n      })\n      .withHubProtocol(new signalRMsgPack.MessagePackHubProtocol() as signalR.IHubProtocol)\n      // .configureLogging(signalR.LogLevel.Trace)\n      .build();\n\n    this.signalrConnection.on(\"ReceiveMessage\", (data: any) =>\n      this.processNotification(new NotificationResponse(data)),\n    );\n    // eslint-disable-next-line\n    this.signalrConnection.on(\"Heartbeat\", (data: any) => {\n      /*console.log('Heartbeat!');*/\n    });\n    this.signalrConnection.onclose(() => {\n      this.connected = false;\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.reconnect(true);\n    });\n    this.inited = true;\n    if (await this.isAuthedAndUnlocked()) {\n      await this.reconnect(false);\n    }\n  }\n\n  async updateConnection(sync = false): Promise<void> {\n    if (!this.inited) {\n      return;\n    }\n    try {\n      if (await this.isAuthedAndUnlocked()) {\n        await this.reconnect(sync);\n      } else {\n        await this.signalrConnection.stop();\n      }\n    } catch (e) {\n      this.logService.error(e.toString());\n    }\n  }\n\n  async reconnectFromActivity(): Promise<void> {\n    this.inactive = false;\n    if (this.inited && !this.connected) {\n      await this.reconnect(true);\n    }\n  }\n\n  async disconnectFromInactivity(): Promise<void> {\n    this.inactive = true;\n    if (this.inited && this.connected) {\n      await this.signalrConnection.stop();\n    }\n  }\n\n  private async processNotification(notification: NotificationResponse) {\n    const appId = await this.appIdService.getAppId();\n    if (notification == null || notification.contextId === appId) {\n      return;\n    }\n\n    const isAuthenticated = await this.stateService.getIsAuthenticated();\n    const payloadUserId = notification.payload.userId || notification.payload.UserId;\n    const myUserId = await this.stateService.getUserId();\n    if (isAuthenticated && payloadUserId != null && payloadUserId !== myUserId) {\n      return;\n    }\n\n    switch (notification.type) {\n      case NotificationType.SyncCipherCreate:\n      case NotificationType.SyncCipherUpdate:\n        await this.syncService.syncUpsertCipher(\n          notification.payload as SyncCipherNotification,\n          notification.type === NotificationType.SyncCipherUpdate,\n        );\n        break;\n      case NotificationType.SyncCipherDelete:\n      case NotificationType.SyncLoginDelete:\n        await this.syncService.syncDeleteCipher(notification.payload as SyncCipherNotification);\n        break;\n      case NotificationType.SyncFolderCreate:\n      case NotificationType.SyncFolderUpdate:\n        await this.syncService.syncUpsertFolder(\n          notification.payload as SyncFolderNotification,\n          notification.type === NotificationType.SyncFolderUpdate,\n        );\n        break;\n      case NotificationType.SyncFolderDelete:\n        await this.syncService.syncDeleteFolder(notification.payload as SyncFolderNotification);\n        break;\n      case NotificationType.SyncVault:\n      case NotificationType.SyncCiphers:\n      case NotificationType.SyncSettings:\n        if (isAuthenticated) {\n          await this.syncService.fullSync(false);\n        }\n        break;\n      case NotificationType.SyncOrganizations:\n        if (isAuthenticated) {\n          // An organization update may not have bumped the user's account revision date, so force a sync\n          await this.syncService.fullSync(true);\n        }\n        break;\n      case NotificationType.SyncOrgKeys:\n        if (isAuthenticated) {\n          await this.syncService.fullSync(true);\n          // Stop so a reconnect can be made\n          await this.signalrConnection.stop();\n        }\n        break;\n      case NotificationType.LogOut:\n        if (isAuthenticated) {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.logoutCallback(\"logoutNotification\");\n        }\n        break;\n      case NotificationType.SyncSendCreate:\n      case NotificationType.SyncSendUpdate:\n        await this.syncService.syncUpsertSend(\n          notification.payload as SyncSendNotification,\n          notification.type === NotificationType.SyncSendUpdate,\n        );\n        break;\n      case NotificationType.SyncSendDelete:\n        await this.syncService.syncDeleteSend(notification.payload as SyncSendNotification);\n        break;\n      case NotificationType.AuthRequest:\n        {\n          const userId = await this.stateService.getUserId();\n          if (await this.authRequestService.getAcceptAuthRequests(userId as UserId)) {\n            this.messagingService.send(\"openLoginApproval\", {\n              notificationId: notification.payload.id,\n            });\n          }\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  private async reconnect(sync: boolean) {\n    if (this.reconnectTimer != null) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n    if (this.connected || !this.inited || this.inactive) {\n      return;\n    }\n    const authedAndUnlocked = await this.isAuthedAndUnlocked();\n    if (!authedAndUnlocked) {\n      return;\n    }\n\n    try {\n      await this.signalrConnection.start();\n      this.connected = true;\n      if (sync) {\n        await this.syncService.fullSync(false);\n      }\n    } catch (e) {\n      this.logService.error(e);\n    }\n\n    if (!this.connected) {\n      this.reconnectTimer = setTimeout(() => this.reconnect(sync), this.random(120000, 300000));\n    }\n  }\n\n  private async isAuthedAndUnlocked() {\n    const authStatus = await this.authService.getAuthStatus();\n    return authStatus >= AuthenticationStatus.Unlocked;\n  }\n\n  private random(min: number, max: number) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  }\n}\n","import * as lunr from \"lunr\";\nimport { Observable, firstValueFrom, map } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { SearchService as SearchServiceAbstraction } from \"../abstractions/search.service\";\nimport { UriMatchStrategy } from \"../models/domain/domain-service\";\nimport { I18nService } from \"../platform/abstractions/i18n.service\";\nimport { LogService } from \"../platform/abstractions/log.service\";\nimport {\n  ActiveUserState,\n  StateProvider,\n  UserKeyDefinition,\n  VAULT_SEARCH_MEMORY,\n} from \"../platform/state\";\nimport { SendView } from \"../tools/send/models/view/send.view\";\nimport { IndexedEntityId } from \"../types/guid\";\nimport { FieldType } from \"../vault/enums\";\nimport { CipherType } from \"../vault/enums/cipher-type\";\nimport { CipherView } from \"../vault/models/view/cipher.view\";\n\nexport type SerializedLunrIndex = {\n  version: string;\n  fields: string[];\n  fieldVectors: [string, number[]];\n  invertedIndex: any[];\n  pipeline: string[];\n};\n\n/**\n * The `KeyDefinition` for accessing the search index in application state.\n * The key definition is configured to clear the index when the user locks the vault.\n */\nexport const LUNR_SEARCH_INDEX = new UserKeyDefinition<SerializedLunrIndex>(\n  VAULT_SEARCH_MEMORY,\n  \"searchIndex\",\n  {\n    deserializer: (obj: Jsonify<SerializedLunrIndex>) => obj,\n    clearOn: [\"lock\", \"logout\"],\n  },\n);\n\n/**\n * The `KeyDefinition` for accessing the ID of the entity currently indexed by Lunr search.\n * The key definition is configured to clear the indexed entity ID when the user locks the vault.\n */\nexport const LUNR_SEARCH_INDEXED_ENTITY_ID = new UserKeyDefinition<IndexedEntityId>(\n  VAULT_SEARCH_MEMORY,\n  \"searchIndexedEntityId\",\n  {\n    deserializer: (obj: Jsonify<IndexedEntityId>) => obj,\n    clearOn: [\"lock\", \"logout\"],\n  },\n);\n\n/**\n * The `KeyDefinition` for accessing the state of Lunr search indexing, indicating whether the Lunr search index is currently being built or updating.\n * The key definition is configured to clear the indexing state when the user locks the vault.\n */\nexport const LUNR_SEARCH_INDEXING = new UserKeyDefinition<boolean>(\n  VAULT_SEARCH_MEMORY,\n  \"isIndexing\",\n  {\n    deserializer: (obj: Jsonify<boolean>) => obj,\n    clearOn: [\"lock\", \"logout\"],\n  },\n);\n\nexport class SearchService implements SearchServiceAbstraction {\n  private static registeredPipeline = false;\n\n  private searchIndexState: ActiveUserState<SerializedLunrIndex> =\n    this.stateProvider.getActive(LUNR_SEARCH_INDEX);\n  private readonly index$: Observable<lunr.Index | null> = this.searchIndexState.state$.pipe(\n    map((searchIndex) => (searchIndex ? lunr.Index.load(searchIndex) : null)),\n  );\n\n  private searchIndexEntityIdState: ActiveUserState<IndexedEntityId> = this.stateProvider.getActive(\n    LUNR_SEARCH_INDEXED_ENTITY_ID,\n  );\n  readonly indexedEntityId$: Observable<IndexedEntityId | null> =\n    this.searchIndexEntityIdState.state$.pipe(map((id) => id));\n\n  private searchIsIndexingState: ActiveUserState<boolean> =\n    this.stateProvider.getActive(LUNR_SEARCH_INDEXING);\n  private readonly searchIsIndexing$: Observable<boolean> = this.searchIsIndexingState.state$.pipe(\n    map((indexing) => indexing ?? false),\n  );\n\n  private readonly immediateSearchLocales: string[] = [\"zh-CN\", \"zh-TW\", \"ja\", \"ko\", \"vi\"];\n  private readonly defaultSearchableMinLength: number = 2;\n  private searchableMinLength: number = this.defaultSearchableMinLength;\n\n  constructor(\n    private logService: LogService,\n    private i18nService: I18nService,\n    private stateProvider: StateProvider,\n  ) {\n    this.i18nService.locale$.subscribe((locale) => {\n      if (this.immediateSearchLocales.indexOf(locale) !== -1) {\n        this.searchableMinLength = 1;\n      } else {\n        this.searchableMinLength = this.defaultSearchableMinLength;\n      }\n    });\n\n    // Currently have to ensure this is only done a single time. Lunr allows you to register a function\n    // multiple times but they will add a warning message to the console. The way they do that breaks when ran on a service worker.\n    if (!SearchService.registeredPipeline) {\n      SearchService.registeredPipeline = true;\n      //register lunr pipeline function\n      lunr.Pipeline.registerFunction(this.normalizeAccentsPipelineFunction, \"normalizeAccents\");\n    }\n  }\n\n  async clearIndex(): Promise<void> {\n    await this.searchIndexEntityIdState.update(() => null);\n    await this.searchIndexState.update(() => null);\n    await this.searchIsIndexingState.update(() => null);\n  }\n\n  async isSearchable(query: string): Promise<boolean> {\n    query = SearchService.normalizeSearchQuery(query);\n    const index = await this.getIndexForSearch();\n    const notSearchable =\n      query == null ||\n      (index == null && query.length < this.searchableMinLength) ||\n      (index != null && query.length < this.searchableMinLength && query.indexOf(\">\") !== 0);\n    return !notSearchable;\n  }\n\n  async indexCiphers(ciphers: CipherView[], indexedEntityId?: string): Promise<void> {\n    if (await this.getIsIndexing()) {\n      return;\n    }\n\n    await this.setIsIndexing(true);\n    await this.setIndexedEntityIdForSearch(indexedEntityId as IndexedEntityId);\n    const builder = new lunr.Builder();\n    builder.pipeline.add(this.normalizeAccentsPipelineFunction);\n    builder.ref(\"id\");\n    builder.field(\"shortid\", { boost: 100, extractor: (c: CipherView) => c.id.substr(0, 8) });\n    builder.field(\"name\", {\n      boost: 10,\n    });\n    builder.field(\"subtitle\", {\n      boost: 5,\n      extractor: (c: CipherView) => {\n        if (c.subTitle != null && c.type === CipherType.Card) {\n          return c.subTitle.replace(/\\*/g, \"\");\n        }\n        return c.subTitle;\n      },\n    });\n    builder.field(\"notes\");\n    builder.field(\"login.username\", {\n      extractor: (c: CipherView) =>\n        c.type === CipherType.Login && c.login != null ? c.login.username : null,\n    });\n    builder.field(\"login.uris\", { boost: 2, extractor: (c: CipherView) => this.uriExtractor(c) });\n    builder.field(\"fields\", { extractor: (c: CipherView) => this.fieldExtractor(c, false) });\n    builder.field(\"fields_joined\", { extractor: (c: CipherView) => this.fieldExtractor(c, true) });\n    builder.field(\"attachments\", {\n      extractor: (c: CipherView) => this.attachmentExtractor(c, false),\n    });\n    builder.field(\"attachments_joined\", {\n      extractor: (c: CipherView) => this.attachmentExtractor(c, true),\n    });\n    builder.field(\"organizationid\", { extractor: (c: CipherView) => c.organizationId });\n    ciphers = ciphers || [];\n    ciphers.forEach((c) => builder.add(c));\n    const index = builder.build();\n\n    await this.setIndexForSearch(index.toJSON() as SerializedLunrIndex);\n\n    await this.setIsIndexing(false);\n\n    this.logService.info(\"Finished search indexing\");\n  }\n\n  async searchCiphers(\n    query: string,\n    filter: ((cipher: CipherView) => boolean) | ((cipher: CipherView) => boolean)[] = null,\n    ciphers: CipherView[],\n  ): Promise<CipherView[]> {\n    const results: CipherView[] = [];\n    if (query != null) {\n      query = SearchService.normalizeSearchQuery(query.trim().toLowerCase());\n    }\n    if (query === \"\") {\n      query = null;\n    }\n\n    if (ciphers == null) {\n      ciphers = [];\n    }\n\n    if (filter != null && Array.isArray(filter) && filter.length > 0) {\n      ciphers = ciphers.filter((c) => filter.every((f) => f == null || f(c)));\n    } else if (filter != null) {\n      ciphers = ciphers.filter(filter as (cipher: CipherView) => boolean);\n    }\n\n    if (!(await this.isSearchable(query))) {\n      return ciphers;\n    }\n\n    if (await this.getIsIndexing()) {\n      await new Promise((r) => setTimeout(r, 250));\n      if (await this.getIsIndexing()) {\n        await new Promise((r) => setTimeout(r, 500));\n      }\n    }\n\n    const index = await this.getIndexForSearch();\n    if (index == null) {\n      // Fall back to basic search if index is not available\n      return this.searchCiphersBasic(ciphers, query);\n    }\n\n    const ciphersMap = new Map<string, CipherView>();\n    ciphers.forEach((c) => ciphersMap.set(c.id, c));\n\n    let searchResults: lunr.Index.Result[] = null;\n    const isQueryString = query != null && query.length > 1 && query.indexOf(\">\") === 0;\n    if (isQueryString) {\n      try {\n        searchResults = index.search(query.substr(1).trim());\n      } catch (e) {\n        this.logService.error(e);\n      }\n    } else {\n      const soWild = lunr.Query.wildcard.LEADING | lunr.Query.wildcard.TRAILING;\n      searchResults = index.query((q) => {\n        lunr.tokenizer(query).forEach((token) => {\n          const t = token.toString();\n          q.term(t, { fields: [\"name\"], wildcard: soWild });\n          q.term(t, { fields: [\"subtitle\"], wildcard: soWild });\n          q.term(t, { fields: [\"login.uris\"], wildcard: soWild });\n          q.term(t, {});\n        });\n      });\n    }\n\n    if (searchResults != null) {\n      searchResults.forEach((r) => {\n        if (ciphersMap.has(r.ref)) {\n          results.push(ciphersMap.get(r.ref));\n        }\n      });\n    }\n    return results;\n  }\n\n  searchCiphersBasic(ciphers: CipherView[], query: string, deleted = false) {\n    query = SearchService.normalizeSearchQuery(query.trim().toLowerCase());\n    return ciphers.filter((c) => {\n      if (deleted !== c.isDeleted) {\n        return false;\n      }\n      if (c.name != null && c.name.toLowerCase().indexOf(query) > -1) {\n        return true;\n      }\n      if (query.length >= 8 && c.id.startsWith(query)) {\n        return true;\n      }\n      if (c.subTitle != null && c.subTitle.toLowerCase().indexOf(query) > -1) {\n        return true;\n      }\n      if (\n        c.login &&\n        c.login.hasUris &&\n        c.login.uris.some((loginUri) => loginUri?.uri?.toLowerCase().indexOf(query) > -1)\n      ) {\n        return true;\n      }\n      return false;\n    });\n  }\n\n  searchSends(sends: SendView[], query: string) {\n    query = SearchService.normalizeSearchQuery(query.trim().toLocaleLowerCase());\n    if (query === null) {\n      return sends;\n    }\n    const sendsMatched: SendView[] = [];\n    const lowPriorityMatched: SendView[] = [];\n    sends.forEach((s) => {\n      if (s.name != null && s.name.toLowerCase().indexOf(query) > -1) {\n        sendsMatched.push(s);\n      } else if (\n        query.length >= 8 &&\n        (s.id.startsWith(query) ||\n          s.accessId.toLocaleLowerCase().startsWith(query) ||\n          (s.file?.id != null && s.file.id.startsWith(query)))\n      ) {\n        lowPriorityMatched.push(s);\n      } else if (s.notes != null && s.notes.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      } else if (s.text?.text != null && s.text.text.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      } else if (s.file?.fileName != null && s.file.fileName.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      }\n    });\n    return sendsMatched.concat(lowPriorityMatched);\n  }\n\n  async getIndexForSearch(): Promise<lunr.Index | null> {\n    return await firstValueFrom(this.index$);\n  }\n\n  private async setIndexForSearch(index: SerializedLunrIndex): Promise<void> {\n    await this.searchIndexState.update(() => index);\n  }\n\n  private async setIndexedEntityIdForSearch(indexedEntityId: IndexedEntityId): Promise<void> {\n    await this.searchIndexEntityIdState.update(() => indexedEntityId);\n  }\n\n  private async setIsIndexing(indexing: boolean): Promise<void> {\n    await this.searchIsIndexingState.update(() => indexing);\n  }\n\n  private async getIsIndexing(): Promise<boolean> {\n    return await firstValueFrom(this.searchIsIndexing$);\n  }\n\n  private fieldExtractor(c: CipherView, joined: boolean) {\n    if (!c.hasFields) {\n      return null;\n    }\n    let fields: string[] = [];\n    c.fields.forEach((f) => {\n      if (f.name != null) {\n        fields.push(f.name);\n      }\n      if (f.type === FieldType.Text && f.value != null) {\n        fields.push(f.value);\n      }\n    });\n    fields = fields.filter((f) => f.trim() !== \"\");\n    if (fields.length === 0) {\n      return null;\n    }\n    return joined ? fields.join(\" \") : fields;\n  }\n\n  private attachmentExtractor(c: CipherView, joined: boolean) {\n    if (!c.hasAttachments) {\n      return null;\n    }\n    let attachments: string[] = [];\n    c.attachments.forEach((a) => {\n      if (a != null && a.fileName != null) {\n        if (joined && a.fileName.indexOf(\".\") > -1) {\n          attachments.push(a.fileName.substr(0, a.fileName.lastIndexOf(\".\")));\n        } else {\n          attachments.push(a.fileName);\n        }\n      }\n    });\n    attachments = attachments.filter((f) => f.trim() !== \"\");\n    if (attachments.length === 0) {\n      return null;\n    }\n    return joined ? attachments.join(\" \") : attachments;\n  }\n\n  private uriExtractor(c: CipherView) {\n    if (c.type !== CipherType.Login || c.login == null || !c.login.hasUris) {\n      return null;\n    }\n    const uris: string[] = [];\n    c.login.uris.forEach((u) => {\n      if (u.uri == null || u.uri === \"\") {\n        return;\n      }\n      if (u.hostname != null) {\n        uris.push(u.hostname);\n        return;\n      }\n      let uri = u.uri;\n      if (u.match !== UriMatchStrategy.RegularExpression) {\n        const protocolIndex = uri.indexOf(\"://\");\n        if (protocolIndex > -1) {\n          uri = uri.substr(protocolIndex + 3);\n        }\n        const queryIndex = uri.search(/\\?|&|#/);\n        if (queryIndex > -1) {\n          uri = uri.substring(0, queryIndex);\n        }\n      }\n      uris.push(uri);\n    });\n    return uris.length > 0 ? uris : null;\n  }\n\n  private normalizeAccentsPipelineFunction(token: lunr.Token): any {\n    const searchableFields = [\"name\", \"login.username\", \"subtitle\", \"notes\"];\n    const fields = (token as any).metadata[\"fields\"];\n    const checkFields = fields.every((i: any) => searchableFields.includes(i));\n\n    if (checkFields) {\n      return SearchService.normalizeSearchQuery(token.toString());\n    }\n\n    return token;\n  }\n\n  // Remove accents/diacritics characters from text. This regex is equivalent to the Diacritic unicode property escape, i.e. it will match all diacritic characters.\n  static normalizeSearchQuery(query: string): string {\n    return query?.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\n  }\n}\n","import { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { UserKeyDefinition, VAULT_TIMEOUT_SETTINGS_DISK_LOCAL } from \"../../platform/state\";\nimport { VaultTimeout } from \"../../types/vault-timeout.type\";\n\n/**\n * Settings use disk storage and local storage on web so settings can persist after logout\n * in order for us to know if the user's chose to never lock their vault or not.\n * When the user has never lock selected, we have to set the user key in memory\n * from the user auto unlock key stored on disk on client bootstrap.\n */\nexport const VAULT_TIMEOUT_ACTION = new UserKeyDefinition<VaultTimeoutAction>(\n  VAULT_TIMEOUT_SETTINGS_DISK_LOCAL,\n  \"vaultTimeoutAction\",\n  {\n    deserializer: (vaultTimeoutAction) => vaultTimeoutAction,\n    clearOn: [], // persisted on logout\n  },\n);\n\nexport const VAULT_TIMEOUT = new UserKeyDefinition<VaultTimeout>(\n  VAULT_TIMEOUT_SETTINGS_DISK_LOCAL,\n  \"vaultTimeout\",\n  {\n    deserializer: (vaultTimeout) => vaultTimeout,\n    clearOn: [], // persisted on logout\n  },\n);\n","import {\n  EMPTY,\n  Observable,\n  catchError,\n  combineLatest,\n  defer,\n  distinctUntilChanged,\n  firstValueFrom,\n  from,\n  map,\n  shareReplay,\n  switchMap,\n  tap,\n} from \"rxjs\";\n\nimport {\n  PinServiceAbstraction,\n  UserDecryptionOptionsServiceAbstraction,\n} from \"@bitwarden/auth/common\";\n\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../admin-console/enums\";\nimport { Policy } from \"../../admin-console/models/domain/policy\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { TokenService } from \"../../auth/abstractions/token.service\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { BiometricStateService } from \"../../platform/biometrics/biometric-state.service\";\nimport { StateProvider } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { VaultTimeout, VaultTimeoutStringType } from \"../../types/vault-timeout.type\";\n\nimport { VAULT_TIMEOUT, VAULT_TIMEOUT_ACTION } from \"./vault-timeout-settings.state\";\n\nexport class VaultTimeoutSettingsService implements VaultTimeoutSettingsServiceAbstraction {\n  constructor(\n    private accountService: AccountService,\n    private pinService: PinServiceAbstraction,\n    private userDecryptionOptionsService: UserDecryptionOptionsServiceAbstraction,\n    private cryptoService: CryptoService,\n    private tokenService: TokenService,\n    private policyService: PolicyService,\n    private biometricStateService: BiometricStateService,\n    private stateProvider: StateProvider,\n    private logService: LogService,\n    private defaultVaultTimeout: VaultTimeout,\n  ) {}\n\n  async setVaultTimeoutOptions(\n    userId: UserId,\n    timeout: VaultTimeout,\n    action: VaultTimeoutAction,\n  ): Promise<void> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot set vault timeout settings.\");\n    }\n\n    if (timeout == null) {\n      throw new Error(\"Vault Timeout cannot be null.\");\n    }\n\n    if (action == null) {\n      throw new Error(\"Vault Timeout Action cannot be null.\");\n    }\n\n    // We swap these tokens from being on disk for lock actions, and in memory for logout actions\n    // Get them here to set them to their new location after changing the timeout action and clearing if needed\n    const accessToken = await this.tokenService.getAccessToken();\n    const refreshToken = await this.tokenService.getRefreshToken();\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n\n    await this.setVaultTimeout(userId, timeout);\n\n    if (timeout != VaultTimeoutStringType.Never && action === VaultTimeoutAction.LogOut) {\n      // if we have a vault timeout and the action is log out, reset tokens\n      // as the tokens were stored on disk and now should be stored in memory\n      await this.tokenService.clearTokens();\n    }\n\n    await this.setVaultTimeoutAction(userId, action);\n\n    await this.tokenService.setTokens(accessToken, action, timeout, refreshToken, [\n      clientId,\n      clientSecret,\n    ]);\n\n    await this.cryptoService.refreshAdditionalKeys();\n  }\n\n  availableVaultTimeoutActions$(userId?: string) {\n    return defer(() => this.getAvailableVaultTimeoutActions(userId));\n  }\n\n  async isBiometricLockSet(userId?: string): Promise<boolean> {\n    const biometricUnlockPromise =\n      userId == null\n        ? firstValueFrom(this.biometricStateService.biometricUnlockEnabled$)\n        : this.biometricStateService.getBiometricUnlockEnabled(userId as UserId);\n    return await biometricUnlockPromise;\n  }\n\n  private async setVaultTimeout(userId: UserId, timeout: VaultTimeout): Promise<void> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot set vault timeout.\");\n    }\n\n    if (timeout == null) {\n      throw new Error(\"Vault Timeout cannot be null.\");\n    }\n\n    await this.stateProvider.setUserState(VAULT_TIMEOUT, timeout, userId);\n  }\n\n  getVaultTimeoutByUserId$(userId: UserId): Observable<VaultTimeout> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot get vault timeout.\");\n    }\n\n    return combineLatest([\n      this.stateProvider.getUserState$(VAULT_TIMEOUT, userId),\n      this.getMaxVaultTimeoutPolicyByUserId$(userId),\n    ]).pipe(\n      switchMap(([currentVaultTimeout, maxVaultTimeoutPolicy]) => {\n        return from(this.determineVaultTimeout(currentVaultTimeout, maxVaultTimeoutPolicy)).pipe(\n          tap((vaultTimeout: VaultTimeout) => {\n            // As a side effect, set the new value determined by determineVaultTimeout into state if it's different from the current\n            if (vaultTimeout !== currentVaultTimeout) {\n              return this.stateProvider.setUserState(VAULT_TIMEOUT, vaultTimeout, userId);\n            }\n          }),\n          catchError((error: unknown) => {\n            // Protect outer observable from canceling on error by catching and returning EMPTY\n            this.logService.error(`Error getting vault timeout: ${error}`);\n            return EMPTY;\n          }),\n        );\n      }),\n      distinctUntilChanged(), // Avoid having the set side effect trigger a new emission of the same action\n      shareReplay({ refCount: true, bufferSize: 1 }),\n    );\n  }\n\n  private async determineVaultTimeout(\n    currentVaultTimeout: VaultTimeout | null,\n    maxVaultTimeoutPolicy: Policy | null,\n  ): Promise<VaultTimeout | null> {\n    // if current vault timeout is null, apply the client specific default\n    currentVaultTimeout = currentVaultTimeout ?? this.defaultVaultTimeout;\n\n    // If no policy applies, return the current vault timeout\n    if (!maxVaultTimeoutPolicy) {\n      return currentVaultTimeout;\n    }\n\n    // User is subject to a max vault timeout policy\n    const maxVaultTimeoutPolicyData = maxVaultTimeoutPolicy.data;\n\n    // If the current vault timeout is not numeric, change it to the policy compliant value\n    if (typeof currentVaultTimeout === \"string\") {\n      return maxVaultTimeoutPolicyData.minutes;\n    }\n\n    // For numeric vault timeouts, ensure they are smaller than maximum allowed value according to policy\n    const policyCompliantTimeout = Math.min(currentVaultTimeout, maxVaultTimeoutPolicyData.minutes);\n\n    return policyCompliantTimeout;\n  }\n\n  private async setVaultTimeoutAction(userId: UserId, action: VaultTimeoutAction): Promise<void> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot set vault timeout action.\");\n    }\n\n    if (!action) {\n      throw new Error(\"Vault Timeout Action cannot be null\");\n    }\n\n    await this.stateProvider.setUserState(VAULT_TIMEOUT_ACTION, action, userId);\n  }\n\n  getVaultTimeoutActionByUserId$(userId: UserId): Observable<VaultTimeoutAction> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot get vault timeout action.\");\n    }\n\n    return combineLatest([\n      this.stateProvider.getUserState$(VAULT_TIMEOUT_ACTION, userId),\n      this.getMaxVaultTimeoutPolicyByUserId$(userId),\n    ]).pipe(\n      switchMap(([currentVaultTimeoutAction, maxVaultTimeoutPolicy]) => {\n        return from(\n          this.determineVaultTimeoutAction(\n            userId,\n            currentVaultTimeoutAction,\n            maxVaultTimeoutPolicy,\n          ),\n        ).pipe(\n          tap((vaultTimeoutAction: VaultTimeoutAction) => {\n            // As a side effect, set the new value determined by determineVaultTimeout into state if it's different from the current\n            // We want to avoid having a null timeout action always so we set it to the default if it is null\n            // and if the user becomes subject to a policy that requires a specific action, we set it to that\n            if (vaultTimeoutAction !== currentVaultTimeoutAction) {\n              return this.stateProvider.setUserState(\n                VAULT_TIMEOUT_ACTION,\n                vaultTimeoutAction,\n                userId,\n              );\n            }\n          }),\n          catchError((error: unknown) => {\n            // Protect outer observable from canceling on error by catching and returning EMPTY\n            this.logService.error(`Error getting vault timeout: ${error}`);\n            return EMPTY;\n          }),\n        );\n      }),\n      distinctUntilChanged(), // Avoid having the set side effect trigger a new emission of the same action\n      shareReplay({ refCount: true, bufferSize: 1 }),\n    );\n  }\n\n  private async determineVaultTimeoutAction(\n    userId: string,\n    currentVaultTimeoutAction: VaultTimeoutAction | null,\n    maxVaultTimeoutPolicy: Policy | null,\n  ): Promise<VaultTimeoutAction> {\n    const availableVaultTimeoutActions = await this.getAvailableVaultTimeoutActions(userId);\n    if (availableVaultTimeoutActions.length === 1) {\n      return availableVaultTimeoutActions[0];\n    }\n\n    if (\n      maxVaultTimeoutPolicy?.data?.action &&\n      availableVaultTimeoutActions.includes(maxVaultTimeoutPolicy.data.action)\n    ) {\n      // return policy defined vault timeout action\n      return maxVaultTimeoutPolicy.data.action;\n    }\n\n    // No policy applies from here on\n    // If the current vault timeout is null and lock is an option, set it as the default\n    if (\n      currentVaultTimeoutAction == null &&\n      availableVaultTimeoutActions.includes(VaultTimeoutAction.Lock)\n    ) {\n      return VaultTimeoutAction.Lock;\n    }\n\n    return currentVaultTimeoutAction;\n  }\n\n  private getMaxVaultTimeoutPolicyByUserId$(userId: UserId): Observable<Policy | null> {\n    if (!userId) {\n      throw new Error(\"User id required. Cannot get max vault timeout policy.\");\n    }\n\n    return this.policyService\n      .getAll$(PolicyType.MaximumVaultTimeout, userId)\n      .pipe(map((policies) => policies[0] ?? null));\n  }\n\n  private async getAvailableVaultTimeoutActions(userId?: string): Promise<VaultTimeoutAction[]> {\n    userId ??= (await firstValueFrom(this.accountService.activeAccount$))?.id;\n\n    const availableActions = [VaultTimeoutAction.LogOut];\n\n    const canLock =\n      (await this.userHasMasterPassword(userId)) ||\n      (await this.pinService.isPinSet(userId as UserId)) ||\n      (await this.isBiometricLockSet(userId));\n\n    if (canLock) {\n      availableActions.push(VaultTimeoutAction.Lock);\n    }\n\n    return availableActions;\n  }\n\n  async clear(userId?: string): Promise<void> {\n    await this.cryptoService.clearPinKeys(userId);\n  }\n\n  private async userHasMasterPassword(userId: string): Promise<boolean> {\n    if (userId) {\n      const decryptionOptions = await firstValueFrom(\n        this.userDecryptionOptionsService.userDecryptionOptionsById$(userId),\n      );\n\n      return !!decryptionOptions?.hasMasterPassword;\n    } else {\n      return await firstValueFrom(this.userDecryptionOptionsService.hasMasterPassword$);\n    }\n  }\n}\n","import { PolicyEvaluator } from \"../abstractions/policy-evaluator.abstraction\";\n\nimport { PasswordGenerationOptions } from \"./password-generation-options\";\nimport { PasswordGeneratorPolicy } from \"./password-generator-policy\";\n\nfunction initializeBoundaries() {\n  const length = Object.freeze({\n    min: 5,\n    max: 128,\n  });\n\n  const minDigits = Object.freeze({\n    min: 0,\n    max: 9,\n  });\n\n  const minSpecialCharacters = Object.freeze({\n    min: 0,\n    max: 9,\n  });\n\n  return Object.freeze({\n    length,\n    minDigits,\n    minSpecialCharacters,\n  });\n}\n\n/** Immutable default boundaries for password generation.\n * These are used when the policy does not override a value.\n */\nexport const DefaultBoundaries = initializeBoundaries();\n\ntype Boundary = {\n  readonly min: number;\n  readonly max: number;\n};\n\n/** Enforces policy for password generation.\n */\nexport class PasswordGeneratorOptionsEvaluator\n  implements PolicyEvaluator<PasswordGeneratorPolicy, PasswordGenerationOptions>\n{\n  // This design is not ideal, but it is a step towards a more robust password\n  // generator. Ideally, `sanitize` would be implemented on an options class,\n  // and `applyPolicy` would be implemented on a policy class, \"mise en place\".\n  //\n  // The current design of the password generator, unfortunately, would require\n  // a substantial rewrite to make this feasible. Hopefully this change can be\n  // applied when the password generator is ported to rust.\n\n  /** Boundaries for the password length. This is always large enough\n   * to accommodate the minimum number of digits and special characters.\n   */\n  readonly length: Boundary;\n\n  /** Boundaries for the minimum number of digits allowed in the password.\n   */\n  readonly minDigits: Boundary;\n\n  /** Boundaries for the minimum number of special characters allowed\n   *  in the password.\n   */\n  readonly minSpecialCharacters: Boundary;\n\n  /** Policy applied by the evaluator.\n   */\n  readonly policy: PasswordGeneratorPolicy;\n\n  /** Instantiates the evaluator.\n   * @param policy The policy applied by the evaluator. When this conflicts with\n   *               the defaults, the policy takes precedence.\n   */\n  constructor(policy: PasswordGeneratorPolicy) {\n    function createBoundary(value: number, defaultBoundary: Boundary): Boundary {\n      const boundary = {\n        min: Math.max(defaultBoundary.min, value),\n        max: Math.max(defaultBoundary.max, value),\n      };\n\n      return boundary;\n    }\n\n    this.policy = structuredClone(policy);\n    this.minDigits = createBoundary(policy.numberCount, DefaultBoundaries.minDigits);\n    this.minSpecialCharacters = createBoundary(\n      policy.specialCount,\n      DefaultBoundaries.minSpecialCharacters,\n    );\n\n    // the overall length should be at least as long as the sum of the minimums\n    const minConsistentLength = this.minDigits.min + this.minSpecialCharacters.min;\n    const minPolicyLength = policy.minLength > 0 ? policy.minLength : DefaultBoundaries.length.min;\n    const minLength = Math.max(minPolicyLength, minConsistentLength, DefaultBoundaries.length.min);\n\n    this.length = {\n      min: minLength,\n      max: Math.max(DefaultBoundaries.length.max, minLength),\n    };\n  }\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect(): boolean {\n    const policies = [\n      this.policy.useUppercase,\n      this.policy.useLowercase,\n      this.policy.useNumbers,\n      this.policy.useSpecial,\n      this.policy.minLength > DefaultBoundaries.length.min,\n      this.policy.numberCount > DefaultBoundaries.minDigits.min,\n      this.policy.specialCount > DefaultBoundaries.minSpecialCharacters.min,\n    ];\n\n    return policies.includes(true);\n  }\n\n  /** {@link PolicyEvaluator.applyPolicy} */\n  applyPolicy(options: PasswordGenerationOptions): PasswordGenerationOptions {\n    function fitToBounds(value: number, boundaries: Boundary) {\n      const { min, max } = boundaries;\n\n      const withUpperBound = Math.min(value || 0, max);\n      const withLowerBound = Math.max(withUpperBound, min);\n\n      return withLowerBound;\n    }\n\n    // apply policy overrides\n    const uppercase = this.policy.useUppercase || options.uppercase || false;\n    const lowercase = this.policy.useLowercase || options.lowercase || false;\n\n    // these overrides can cascade numeric fields to boolean fields\n    const number = this.policy.useNumbers || options.number || options.minNumber > 0;\n    const special = this.policy.useSpecial || options.special || options.minSpecial > 0;\n\n    // apply boundaries; the boundaries can cascade boolean fields to numeric fields\n    const length = fitToBounds(options.length, this.length);\n    const minNumber = fitToBounds(options.minNumber, this.minDigits);\n    const minSpecial = fitToBounds(options.minSpecial, this.minSpecialCharacters);\n\n    return {\n      ...options,\n      length,\n      uppercase,\n      lowercase,\n      number,\n      minNumber,\n      special,\n      minSpecial,\n    };\n  }\n\n  /** {@link PolicyEvaluator.sanitize} */\n  sanitize(options: PasswordGenerationOptions): PasswordGenerationOptions {\n    function cascade(enabled: boolean, value: number): [boolean, number] {\n      const enabledResult = enabled ?? value > 0;\n      const valueResult = enabledResult ? value || 1 : 0;\n\n      return [enabledResult, valueResult];\n    }\n\n    const [lowercase, minLowercase] = cascade(options.lowercase, options.minLowercase);\n    const [uppercase, minUppercase] = cascade(options.uppercase, options.minUppercase);\n    const [number, minNumber] = cascade(options.number, options.minNumber);\n    const [special, minSpecial] = cascade(options.special, options.minSpecial);\n\n    // minimums can only increase the length\n    const minConsistentLength = minLowercase + minUppercase + minNumber + minSpecial;\n    const minLength = Math.max(minConsistentLength, this.length.min);\n    const length = Math.max(options.length ?? minLength, minLength);\n\n    return {\n      ...options,\n      length,\n      minLength,\n      lowercase,\n      minLowercase,\n      uppercase,\n      minUppercase,\n      number,\n      minNumber,\n      special,\n      minSpecial,\n    };\n  }\n}\n","import { DefaultBoundaries } from \"./password-generator-options-evaluator\";\n\n/** Request format for password credential generation.\n *  All members of this type may be `undefined` when the user is\n *  generating a passphrase.\n *\n * @remarks The name of this type is a bit of a misnomer. This type\n *          it is used with the \"password generator\" types. The name\n *          `PasswordGeneratorOptions` is already in use by legacy code.\n */\nexport type PasswordGenerationOptions = {\n  /** The length of the password selected by the user */\n  length?: number;\n\n  /** The minimum length of the password. This defaults to 5, and increases\n   * to ensure `minLength` is at least as large as the sum of the other minimums.\n   */\n  minLength?: number;\n\n  /** `true` when ambiguous characters may be included in the output.\n   *  `false` when ambiguous characters should not be included in the output.\n   */\n  ambiguous?: boolean;\n\n  /** `true` when uppercase ASCII characters should be included in the output\n   * This value defaults to `false.\n   */\n  uppercase?: boolean;\n\n  /** The minimum number of uppercase characters to include in the output.\n   *  The value is ignored when `uppercase` is `false`.\n   *  The value defaults to 1 when `uppercase` is `true`.\n   */\n  minUppercase?: number;\n\n  /** `true` when lowercase ASCII characters should be included in the output.\n   * This value defaults to `false`.\n   */\n  lowercase?: boolean;\n\n  /** The minimum number of lowercase characters to include in the output.\n   * The value defaults to 1 when `lowercase` is `true`.\n   * The value defaults to 0 when `lowercase` is `false`.\n   */\n  minLowercase?: number;\n\n  /** Whether or not to include ASCII digits in the output\n   * This value defaults to `true` when `minNumber` is at least 1.\n   * This value defaults to `false` when `minNumber` is less than 1.\n   */\n  number?: boolean;\n\n  /** The minimum number of digits to include in the output.\n   * The value defaults to 1 when `number` is `true`.\n   * The value defaults to 0 when `number` is `false`.\n   */\n  minNumber?: number;\n\n  /** Whether or not to include special characters in the output.\n   * This value defaults to `true` when `minSpecial` is at least 1.\n   * This value defaults to `false` when `minSpecial` is less than 1.\n   */\n  special?: boolean;\n\n  /** The minimum number of special characters to include in the output.\n   * This value defaults to 1 when `special` is `true`.\n   * This value defaults to 0 when `special` is `false`.\n   */\n  minSpecial?: number;\n};\n\n/** The default options for password generation. */\nexport const DefaultPasswordGenerationOptions: Partial<PasswordGenerationOptions> = Object.freeze({\n  length: 14,\n  minLength: DefaultBoundaries.length.min,\n  ambiguous: true,\n  uppercase: true,\n  lowercase: true,\n  number: true,\n  minNumber: 1,\n  special: false,\n  minSpecial: 0,\n});\n","import { UserKeyDefinition, UserKeyDefinitionOptions } from \"../../platform/state\";\n// eslint-disable-next-line -- `StateDefinition` used as an argument\nimport { StateDefinition } from \"../../platform/state/state-definition\";\n\n/** A set of options for customizing the behavior of a {@link BufferedKeyDefinition}\n */\nexport type BufferedKeyDefinitionOptions<Input, Output, Dependency> =\n  UserKeyDefinitionOptions<Input> & {\n    /** Checks whether the input type can be converted to the output type.\n     *  @param input the data that is rolling over.\n     *  @returns `true` if the definition is valid, otherwise `false`. If this\n     *  function is not specified, any truthy input is valid.\n     *\n     * @remarks this is intended for cases where you're working with validated or\n     * signed data. It should be used to prevent data from being \"laundered\" through\n     * synchronized state.\n     */\n    isValid?: (input: Input, dependency: Dependency) => Promise<boolean>;\n\n    /** Transforms the input data format to its output format.\n     *  @param input the data that is rolling over.\n     *  @returns the converted value. If this function is not specified, the value\n     *  is asserted as the output type.\n     *\n     * @remarks This is intended for converting between, say, a replication format\n     * and a disk format or rotating encryption keys.\n     */\n    map?: (input: Input, dependency: Dependency) => Promise<Output>;\n\n    /** Checks whether an overwrite should occur\n     *  @param dependency the latest value from the dependency observable provided\n     *    to the buffered state.\n     *  @returns `true` if a overwrite should occur, otherwise `false`. If this\n     *   function is not specified, overwrites occur when the dependency is truthy.\n     *\n     *  @remarks This is intended for waiting to overwrite until a dependency becomes\n     *   available (e.g. an encryption key or a user confirmation).\n     */\n    shouldOverwrite?: (dependency: Dependency) => boolean;\n  };\n\n/** Storage and mapping settings for data stored by a `BufferedState`.\n */\nexport class BufferedKeyDefinition<Input, Output = Input, Dependency = true> {\n  /**\n   * Defines a buffered state\n   * @param stateDefinition The domain of the buffer\n   * @param key Domain key that identifies the buffered value. This key must\n   *    not be reused in any capacity.\n   * @param options Configures the operation of the buffered state.\n   */\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    readonly options: BufferedKeyDefinitionOptions<Input, Output, Dependency>,\n  ) {}\n\n  /** Converts the buffered key definition to a state provider\n   *  key definition\n   */\n  toKeyDefinition() {\n    const bufferedKey = new UserKeyDefinition<Input>(this.stateDefinition, this.key, this.options);\n\n    return bufferedKey;\n  }\n\n  /** Checks whether the dependency triggers an overwrite. */\n  shouldOverwrite(dependency: Dependency) {\n    const shouldOverwrite = this.options?.shouldOverwrite;\n    if (shouldOverwrite) {\n      return shouldOverwrite(dependency);\n    }\n\n    return dependency ? true : false;\n  }\n\n  /** Converts the input data format to its output format.\n   *  @returns the converted value.\n   */\n  map(input: Input, dependency: Dependency) {\n    const map = this.options?.map;\n    if (map) {\n      return map(input, dependency);\n    }\n\n    return Promise.resolve(input as unknown as Output);\n  }\n\n  /** Checks whether the input type can be converted to the output type.\n   *  @returns `true` if the definition is defined and valid, otherwise `false`.\n   */\n  isValid(input: Input, dependency: Dependency) {\n    if (input === null) {\n      return Promise.resolve(false);\n    }\n\n    const isValid = this.options?.isValid;\n    if (isValid) {\n      return isValid(input, dependency);\n    }\n\n    return Promise.resolve(input ? true : false);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\n/** Classifies an object's JSON-serializable data by property into\n *  3 categories:\n *  * Disclosed data MAY be stored in plaintext.\n *  * Excluded data MUST NOT be saved.\n *  * The remaining data is secret and MUST be stored using encryption.\n *\n *  This type should not be used to classify functions.\n *  Data that cannot be serialized by JSON.stringify() should\n *  be excluded.\n */\nexport class SecretClassifier<Plaintext extends object, Disclosed, Secret> {\n  private constructor(\n    disclosed: readonly (keyof Jsonify<Disclosed> & keyof Jsonify<Plaintext>)[],\n    excluded: readonly (keyof Plaintext)[],\n  ) {\n    this.disclosed = disclosed;\n    this.excluded = excluded;\n  }\n\n  /** lists the disclosed properties. */\n  readonly disclosed: readonly (keyof Jsonify<Disclosed> & keyof Jsonify<Plaintext>)[];\n\n  /** lists the excluded properties. */\n  readonly excluded: readonly (keyof Plaintext)[];\n\n  /** Creates a classifier where all properties are secret.\n   *  @type {T} The type of secret being classified.\n   */\n  static allSecret<T extends object>() {\n    const disclosed = Object.freeze([]);\n    const excluded = Object.freeze([]);\n    return new SecretClassifier<T, Record<keyof T, never>, T>(disclosed, excluded);\n  }\n\n  /** Classify a property as disclosed.\n   *  @type {PropertyName} Available secrets to disclose.\n   *  @param disclose The property name to disclose.\n   *  @returns a new classifier\n   */\n  disclose<const PropertyName extends keyof Jsonify<Secret>>(disclose: PropertyName) {\n    // move the property from the secret type to the disclose type\n    type NewDisclosed = Disclosed | Record<PropertyName, Jsonify<Secret>[PropertyName]>;\n    type NewSecret = Omit<Secret, PropertyName>;\n\n    // update the fluent interface\n    const newDisclosed = [...this.disclosed, disclose] as (keyof Jsonify<NewDisclosed> &\n      keyof Jsonify<Plaintext>)[];\n    const classifier = new SecretClassifier<Plaintext, NewDisclosed, NewSecret>(\n      // since `NewDisclosed` is opaque to the type checker, it's necessary\n      // to assert the type of the array here.\n      Object.freeze(newDisclosed),\n      this.excluded,\n    );\n\n    return classifier;\n  }\n\n  /** Classify a property as excluded.\n   *  @type {PropertyName} Available secrets to exclude.\n   *  @param exclude The property name to exclude.\n   *  @returns a new classifier\n   */\n  exclude<const PropertyName extends keyof Secret>(excludedPropertyName: PropertyName) {\n    // remove the property from the secret type\n    type NewConfidential = Omit<Secret, PropertyName>;\n\n    // update the fluent interface\n    const newExcluded = [...this.excluded, excludedPropertyName] as (keyof Plaintext)[];\n    const classifier = new SecretClassifier<Plaintext, Disclosed, NewConfidential>(\n      this.disclosed,\n      Object.freeze(newExcluded),\n    );\n\n    return classifier;\n  }\n\n  /** Partitions `secret` into its disclosed properties and secret properties.\n   *  @param value The object to partition\n   *  @returns an object that classifies secrets.\n   *    The `disclosed` member is new and contains disclosed properties.\n   *    The `secret` member is a copy of the secret parameter, including its\n   *    prototype, with all disclosed and excluded properties deleted.\n   */\n  classify(value: Plaintext): { disclosed: Jsonify<Disclosed>; secret: Jsonify<Secret> } {\n    // need to JSONify during classification because the prototype is almost guaranteed\n    // to be invalid when this  method deletes arbitrary properties.\n    const secret = JSON.parse(JSON.stringify(value)) as Record<keyof Plaintext, unknown>;\n\n    for (const excludedProp of this.excluded) {\n      delete secret[excludedProp];\n    }\n\n    const disclosed: Record<PropertyKey, unknown> = {};\n    for (const disclosedProp of this.disclosed) {\n      // disclosedProp is known to be a subset of the keys of `Plaintext`, so these\n      // type assertions are accurate.\n      // FIXME: prove it to the compiler\n      disclosed[disclosedProp] = secret[disclosedProp as keyof Plaintext];\n      delete secret[disclosedProp as keyof Plaintext];\n    }\n\n    return {\n      disclosed: disclosed as Jsonify<Disclosed>,\n      secret: secret as Jsonify<Secret>,\n    };\n  }\n\n  /** Merges the properties of `secret` and `disclosed`. When `secret` and\n   *  `disclosed` contain the same property, the `secret` property overrides\n   *  the `disclosed` property.\n   *  @param disclosed an object whose disclosed properties are merged into\n   *    the output. Unknown properties are ignored.\n   *  @param secret an objects whose properties are merged into the output.\n   *    Excluded properties are ignored. Unknown properties are retained.\n   *  @returns a new object containing the merged data.\n   */\n  // Declassified data is always jsonified--the purpose of classifying it is to Jsonify it,\n  // which causes type conversions.\n  declassify(disclosed: Jsonify<Disclosed>, secret: Jsonify<Secret>): Jsonify<Plaintext> {\n    // removed unknown keys from `disclosed` to prevent any old edit\n    // of plaintext data from being laundered though declassification.\n    const cleaned = {} as Partial<Jsonify<Disclosed>>;\n    for (const disclosedProp of this.disclosed) {\n      cleaned[disclosedProp] = disclosed[disclosedProp];\n    }\n\n    // merge decrypted into cleaned so that secret data clobbers public data\n    const merged: any = Object.assign(cleaned, secret);\n\n    // delete excluded props\n    for (const excludedProp of this.excluded) {\n      delete merged[excludedProp];\n    }\n\n    return merged as Jsonify<Plaintext>;\n  }\n}\n","import { UserKeyDefinitionOptions, UserKeyDefinition } from \"../../platform/state\";\n// eslint-disable-next-line -- `StateDefinition` used as an argument\nimport { StateDefinition } from \"../../platform/state/state-definition\";\nimport { ClassifiedFormat } from \"./classified-format\";\nimport { SecretClassifier } from \"./secret-classifier\";\n\n/** Encryption and storage settings for data stored by a `SecretState`.\n */\nexport class SecretKeyDefinition<Outer, Id, Inner extends object, Disclosed, Secret> {\n  private constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    readonly classifier: SecretClassifier<Inner, Disclosed, Secret>,\n    readonly options: UserKeyDefinitionOptions<Inner>,\n    // type erasure is necessary here because typescript doesn't support\n    // higher kinded types that generalize over collections. The invariants\n    // needed to make this typesafe are maintained by the static factories.\n    readonly deconstruct: (value: any) => [Id, any][],\n    readonly reconstruct: ([inners, ids]: (readonly [Id, any])[]) => Outer,\n  ) {}\n\n  /** Converts the secret key to the `KeyDefinition` used for secret storage. */\n  toEncryptedStateKey() {\n    const secretKey = new UserKeyDefinition<ClassifiedFormat<Id, Disclosed>[]>(\n      this.stateDefinition,\n      this.key,\n      {\n        cleanupDelayMs: this.options.cleanupDelayMs,\n        deserializer: (jsonValue) => jsonValue as ClassifiedFormat<Id, Disclosed>[],\n        // Clear encrypted state on logout\n        clearOn: this.options.clearOn,\n      },\n    );\n\n    return secretKey;\n  }\n\n  /**\n   * Define a secret state for a single value\n   * @param stateDefinition The domain of the secret's durable state.\n   * @param key Domain key that identifies the stored value. This key must not be reused\n   *    in any capacity.\n   * @param classifier Partitions the value into encrypted, discarded, and public data.\n   * @param options Configures the operation of the secret state.\n   */\n  static value<Value extends object, Disclosed, Secret>(\n    stateDefinition: StateDefinition,\n    key: string,\n    classifier: SecretClassifier<Value, Disclosed, Secret>,\n    options: UserKeyDefinitionOptions<Value>,\n  ) {\n    return new SecretKeyDefinition<Value, void, Value, Disclosed, Secret>(\n      stateDefinition,\n      key,\n      classifier,\n      options,\n      (value) => [[null, value]],\n      ([[, inner]]) => inner,\n    );\n  }\n\n  /**\n   * Define a secret state for an array of values. Each item is encrypted separately.\n   * @param stateDefinition The domain of the secret's durable state.\n   * @param key Domain key that identifies the stored items. This key must not be reused\n   *    in any capacity.\n   * @param classifier Partitions each item into encrypted, discarded, and public data.\n   * @param options Configures the operation of the secret state.\n   */\n  static array<Item extends object, Disclosed, Secret>(\n    stateDefinition: StateDefinition,\n    key: string,\n    classifier: SecretClassifier<Item, Disclosed, Secret>,\n    options: UserKeyDefinitionOptions<Item>,\n  ) {\n    return new SecretKeyDefinition<Item[], number, Item, Disclosed, Secret>(\n      stateDefinition,\n      key,\n      classifier,\n      options,\n      (value) => value.map((v: any, id: number) => [id, v]),\n      (values) => values.map(([, v]) => v),\n    );\n  }\n\n  /**\n   * Define a secret state for a record. Each property is encrypted separately.\n   * @param stateDefinition The domain of the secret's durable state.\n   * @param key Domain key that identifies the stored properties. This key must not be reused\n   *    in any capacity.\n   * @param classifier Partitions each property into encrypted, discarded, and public data.\n   * @param options Configures the operation of the secret state.\n   */\n  static record<Item extends object, Disclosed, Secret, Id extends string | number>(\n    stateDefinition: StateDefinition,\n    key: string,\n    classifier: SecretClassifier<Item, Disclosed, Secret>,\n    options: UserKeyDefinitionOptions<Item>,\n  ) {\n    return new SecretKeyDefinition<Record<Id, Item>, Id, Item, Disclosed, Secret>(\n      stateDefinition,\n      key,\n      classifier,\n      options,\n      (value) => Object.entries(value) as [Id, Item][],\n      (values) => Object.fromEntries(values) as Record<Id, Item>,\n    );\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { GeneratorCategory } from \"./options\";\n\n/** A credential generation result */\nexport class GeneratedCredential {\n  /**\n   * Instantiates a generated credential\n   * @param credential The value of the generated credential (e.g. a password)\n   * @param category The kind of credential\n   * @param generationDate The date that the credential was generated.\n   *   Numeric values should are interpreted using {@link Date.valueOf}\n   *   semantics.\n   */\n  constructor(\n    readonly credential: string,\n    readonly category: GeneratorCategory,\n    generationDate: Date | number,\n  ) {\n    if (typeof generationDate === \"number\") {\n      this.generationDate = new Date(generationDate);\n    } else {\n      this.generationDate = generationDate;\n    }\n  }\n\n  /** The date that the credential was generated */\n  generationDate: Date;\n\n  /** Constructs a credential from its `toJSON` representation */\n  static fromJSON(jsonValue: Jsonify<GeneratedCredential>) {\n    return new GeneratedCredential(\n      jsonValue.credential,\n      jsonValue.category,\n      jsonValue.generationDate,\n    );\n  }\n\n  /** Serializes a credential to a JSON-compatible object */\n  toJSON() {\n    return {\n      credential: this.credential,\n      category: this.category,\n      generationDate: this.generationDate.valueOf(),\n    };\n  }\n}\n","export class GeneratedPasswordHistory {\n  password: string;\n  date: number;\n\n  constructor(password: string, date: number) {\n    this.password = password;\n    this.date = date;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { GENERATOR_DISK, UserKeyDefinition } from \"../../platform/state\";\nimport { BufferedKeyDefinition } from \"../state/buffered-key-definition\";\nimport { SecretClassifier } from \"../state/secret-classifier\";\nimport { SecretKeyDefinition } from \"../state/secret-key-definition\";\n\nimport { GeneratedCredential } from \"./history/generated-credential\";\nimport { LegacyPasswordHistoryDecryptor } from \"./history/legacy-password-history-decryptor\";\nimport { GeneratorNavigation } from \"./navigation/generator-navigation\";\nimport { PassphraseGenerationOptions } from \"./passphrase/passphrase-generation-options\";\nimport { GeneratedPasswordHistory } from \"./password/generated-password-history\";\nimport { PasswordGenerationOptions } from \"./password/password-generation-options\";\nimport { CatchallGenerationOptions } from \"./username/catchall-generator-options\";\nimport { EffUsernameGenerationOptions } from \"./username/eff-username-generator-options\";\nimport {\n  ApiOptions,\n  EmailDomainOptions,\n  EmailPrefixOptions,\n  SelfHostedApiOptions,\n} from \"./username/options/forwarder-options\";\nimport { SubaddressGenerationOptions } from \"./username/subaddress-generator-options\";\n\n/** plaintext password generation options */\nexport const GENERATOR_SETTINGS = new UserKeyDefinition<GeneratorNavigation>(\n  GENERATOR_DISK,\n  \"generatorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** plaintext password generation options */\nexport const PASSWORD_SETTINGS = new UserKeyDefinition<PasswordGenerationOptions>(\n  GENERATOR_DISK,\n  \"passwordGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** plaintext passphrase generation options */\nexport const PASSPHRASE_SETTINGS = new UserKeyDefinition<PassphraseGenerationOptions>(\n  GENERATOR_DISK,\n  \"passphraseGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** plaintext username generation options */\nexport const EFF_USERNAME_SETTINGS = new UserKeyDefinition<EffUsernameGenerationOptions>(\n  GENERATOR_DISK,\n  \"effUsernameGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** plaintext configuration for a domain catch-all address. */\nexport const CATCHALL_SETTINGS = new UserKeyDefinition<CatchallGenerationOptions>(\n  GENERATOR_DISK,\n  \"catchallGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** plaintext configuration for an email subaddress. */\nexport const SUBADDRESS_SETTINGS = new UserKeyDefinition<SubaddressGenerationOptions>(\n  GENERATOR_DISK,\n  \"subaddressGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.AddyIo} */\nexport const ADDY_IO_FORWARDER = new UserKeyDefinition<SelfHostedApiOptions & EmailDomainOptions>(\n  GENERATOR_DISK,\n  \"addyIoForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.DuckDuckGo} */\nexport const DUCK_DUCK_GO_FORWARDER = new UserKeyDefinition<ApiOptions>(\n  GENERATOR_DISK,\n  \"duckDuckGoForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.FastMail} */\nexport const FASTMAIL_FORWARDER = new UserKeyDefinition<ApiOptions & EmailPrefixOptions>(\n  GENERATOR_DISK,\n  \"fastmailForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.FireFoxRelay} */\nexport const FIREFOX_RELAY_FORWARDER = new UserKeyDefinition<ApiOptions>(\n  GENERATOR_DISK,\n  \"firefoxRelayForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.ForwardEmail} */\nexport const FORWARD_EMAIL_FORWARDER = new UserKeyDefinition<ApiOptions & EmailDomainOptions>(\n  GENERATOR_DISK,\n  \"forwardEmailForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link forwarders.SimpleLogin} */\nexport const SIMPLE_LOGIN_FORWARDER = new UserKeyDefinition<SelfHostedApiOptions>(\n  GENERATOR_DISK,\n  \"simpleLoginForwarder\",\n  {\n    deserializer: (value) => value,\n    clearOn: [],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.AddyIo} */\nexport const ADDY_IO_BUFFER = new BufferedKeyDefinition<SelfHostedApiOptions & EmailDomainOptions>(\n  GENERATOR_DISK,\n  \"addyIoBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.DuckDuckGo} */\nexport const DUCK_DUCK_GO_BUFFER = new BufferedKeyDefinition<ApiOptions>(\n  GENERATOR_DISK,\n  \"duckDuckGoBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.FastMail} */\nexport const FASTMAIL_BUFFER = new BufferedKeyDefinition<ApiOptions & EmailPrefixOptions>(\n  GENERATOR_DISK,\n  \"fastmailBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.FireFoxRelay} */\nexport const FIREFOX_RELAY_BUFFER = new BufferedKeyDefinition<ApiOptions>(\n  GENERATOR_DISK,\n  \"firefoxRelayBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** backing store configuration for {@link Forwarders.ForwardEmail} */\nexport const FORWARD_EMAIL_BUFFER = new BufferedKeyDefinition<ApiOptions & EmailDomainOptions>(\n  GENERATOR_DISK,\n  \"forwardEmailBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** backing store configuration for {@link forwarders.SimpleLogin} */\nexport const SIMPLE_LOGIN_BUFFER = new BufferedKeyDefinition<SelfHostedApiOptions>(\n  GENERATOR_DISK,\n  \"simpleLoginBuffer\",\n  {\n    deserializer: (value) => value,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** encrypted password generation history */\nexport const GENERATOR_HISTORY = SecretKeyDefinition.array(\n  GENERATOR_DISK,\n  \"localGeneratorHistory\",\n  SecretClassifier.allSecret<GeneratedCredential>(),\n  {\n    deserializer: GeneratedCredential.fromJSON,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** encrypted password generation history subject to migration */\nexport const GENERATOR_HISTORY_BUFFER = new BufferedKeyDefinition<\n  GeneratedPasswordHistory[],\n  GeneratedCredential[],\n  LegacyPasswordHistoryDecryptor\n>(GENERATOR_DISK, \"localGeneratorHistoryBuffer\", {\n  deserializer(history) {\n    const items = history as Jsonify<GeneratedPasswordHistory>[];\n    return items?.map((h) => new GeneratedPasswordHistory(h.password, h.date));\n  },\n  async isValid(history) {\n    return history.length ? true : false;\n  },\n  async map(history, decryptor) {\n    const credentials = await decryptor.decrypt(history);\n    const mapped = credentials.map((c) => new GeneratedCredential(c.password, \"password\", c.date));\n    return mapped;\n  },\n  clearOn: [\"logout\"],\n});\n","import { distinctUntilChanged, map, OperatorFunction } from \"rxjs\";\n\n/**\n * An observable operator that reduces an emitted collection to a single object,\n * returning a default if all items are ignored.\n * @param reduce The reduce function to apply to the filtered collection. The\n *  first argument is the accumulator, and the second is the current item. The\n *  return value is the new accumulator.\n * @param defaultValue The default value to return if the collection is empty. The\n *   default value is also the initial value of the accumulator.\n */\nexport function reduceCollection<Item, Accumulator>(\n  reduce: (acc: Accumulator, value: Item) => Accumulator,\n  defaultValue: Accumulator,\n): OperatorFunction<Item[], Accumulator> {\n  return map((values: Item[]) => {\n    const reduced = (values ?? []).reduce(reduce, structuredClone(defaultValue));\n    return reduced;\n  });\n}\n\n/**\n * An observable operator that emits distinct values by checking that all\n *   values in the previous entry match the next entry. This method emits\n *   when a key is added and does not when a key is removed.\n * @remarks This method checks objects. It does not check items in arrays.\n */\nexport function distinctIfShallowMatch<Item>(): OperatorFunction<Item, Item> {\n  return distinctUntilChanged((previous, current) => {\n    let isDistinct = true;\n\n    for (const key in current) {\n      isDistinct &&= previous[key] === current[key];\n    }\n\n    return isDistinct;\n  });\n}\n","import { PolicyType } from \"../../../admin-console/enums\";\n// FIXME: use index.ts imports once policy abstractions and models\n// implement ADR-0002\nimport { Policy } from \"../../../admin-console/models/domain/policy\";\n\n/** Policy options enforced during password generation. */\nexport type PasswordGeneratorPolicy = {\n  /** The minimum length of generated passwords.\n   *  When this is less than or equal to zero, it is ignored.\n   *  If this is less than the total number of characters required by\n   *  the policy's other settings, then it is ignored.\n   */\n  minLength: number;\n\n  /** When this is true, an uppercase character must be part of\n   *  the generated password.\n   */\n  useUppercase: boolean;\n\n  /** When this is true, a lowercase character must be part of\n   *  the generated password.\n   */\n  useLowercase: boolean;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password.\n   */\n  useNumbers: boolean;\n\n  /** The quantity of digits to include in the generated password.\n   *  When this is less than or equal to zero, it is ignored.\n   */\n  numberCount: number;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password.\n   */\n  useSpecial: boolean;\n\n  /** The quantity of special characters to include in the generated\n   *  password. When this is less than or equal to zero, it is ignored.\n   */\n  specialCount: number;\n};\n\n/** The default options for password generation policy. */\nexport const DisabledPasswordGeneratorPolicy: PasswordGeneratorPolicy = Object.freeze({\n  minLength: 0,\n  useUppercase: false,\n  useLowercase: false,\n  useNumbers: false,\n  numberCount: 0,\n  useSpecial: false,\n  specialCount: 0,\n});\n\n/** Reduces a policy into an accumulator by accepting the most restrictive\n *  values from each policy.\n *  @param acc the accumulator\n *  @param policy the policy to reduce\n *  @returns the most restrictive values between the policy and accumulator.\n */\nexport function leastPrivilege(acc: PasswordGeneratorPolicy, policy: Policy) {\n  if (policy.type !== PolicyType.PasswordGenerator || !policy.enabled) {\n    return acc;\n  }\n\n  return {\n    minLength: Math.max(acc.minLength, policy.data.minLength ?? acc.minLength),\n    useUppercase: policy.data.useUpper || acc.useUppercase,\n    useLowercase: policy.data.useLower || acc.useLowercase,\n    useNumbers: policy.data.useNumbers || acc.useNumbers,\n    numberCount: Math.max(acc.numberCount, policy.data.minNumbers ?? acc.numberCount),\n    useSpecial: policy.data.useSpecial || acc.useSpecial,\n    specialCount: Math.max(acc.specialCount, policy.data.minSpecial ?? acc.specialCount),\n  };\n}\n","import { BehaviorSubject, map, pipe } from \"rxjs\";\n\nimport { GeneratorStrategy } from \"..\";\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { PasswordGenerationServiceAbstraction } from \"../abstractions/password-generation.service.abstraction\";\nimport { PASSWORD_SETTINGS } from \"../key-definitions\";\nimport { distinctIfShallowMatch, reduceCollection } from \"../rx-operators\";\n\nimport {\n  DefaultPasswordGenerationOptions,\n  PasswordGenerationOptions,\n} from \"./password-generation-options\";\nimport { PasswordGeneratorOptionsEvaluator } from \"./password-generator-options-evaluator\";\nimport {\n  DisabledPasswordGeneratorPolicy,\n  PasswordGeneratorPolicy,\n  leastPrivilege,\n} from \"./password-generator-policy\";\n\n/** {@link GeneratorStrategy} */\nexport class PasswordGeneratorStrategy\n  implements GeneratorStrategy<PasswordGenerationOptions, PasswordGeneratorPolicy>\n{\n  /** instantiates the password generator strategy.\n   *  @param legacy generates the password\n   */\n  constructor(\n    private legacy: PasswordGenerationServiceAbstraction,\n    private stateProvider: StateProvider,\n  ) {}\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState(id: UserId) {\n    return this.stateProvider.getUser(id, PASSWORD_SETTINGS);\n  }\n\n  /** Gets the default options. */\n  defaults$(_: UserId) {\n    return new BehaviorSubject({ ...DefaultPasswordGenerationOptions }).asObservable();\n  }\n\n  /** {@link GeneratorStrategy.policy} */\n  get policy() {\n    return PolicyType.PasswordGenerator;\n  }\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator() {\n    return pipe(\n      reduceCollection(leastPrivilege, DisabledPasswordGeneratorPolicy),\n      distinctIfShallowMatch(),\n      map((policy) => new PasswordGeneratorOptionsEvaluator(policy)),\n    );\n  }\n\n  /** {@link GeneratorStrategy.generate} */\n  generate(options: PasswordGenerationOptions): Promise<string> {\n    return this.legacy.generatePassword({ ...options, type: \"password\" });\n  }\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\n\n/** Enterprise policy for the password generator.\n * @see PolicyType.PasswordGenerator\n */\nexport class PasswordGeneratorPolicyOptions extends Domain {\n  /** The default kind of credential to generate */\n  defaultType: \"password\" | \"passphrase\" | \"\" = \"\";\n\n  /** The minimum length of generated passwords.\n   *  When this is less than or equal to zero, it is ignored.\n   *  If this is less than the total number of characters required by\n   *  the policy's other settings, then it is ignored.\n   *  This field is not used for passphrases.\n   */\n  minLength = 0;\n\n  /** When this is true, an uppercase character must be part of\n   *  the generated password.\n   *  This field is not used for passphrases.\n   */\n  useUppercase = false;\n\n  /** When this is true, a lowercase character must be part of\n   *  the generated password. This field is not used for passphrases.\n   */\n  useLowercase = false;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password. This field is not used for passphrases.\n   */\n  useNumbers = false;\n\n  /** The quantity of digits to include in the generated password.\n   *  When this is less than or equal to zero, it is ignored.\n   *  This field is not used for passphrases.\n   */\n  numberCount = 0;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password. This field is not used for passphrases.\n   */\n  useSpecial = false;\n\n  /** The quantity of special characters to include in the generated\n   *  password. When this is less than or equal to zero, it is ignored.\n   *  This field is not used for passphrases.\n   */\n  specialCount = 0;\n\n  /** The minimum number of words required by generated passphrases.\n   *  This field is not used for passwords.\n   */\n  minNumberWords = 0;\n\n  /** When this is true, the first letter of each word in the passphrase\n   *  is capitalized. This field is not used for passwords.\n   */\n  capitalize = false;\n\n  /** When this is true, a number is included within the passphrase.\n   *  This field is not used for passwords.\n   */\n  includeNumber = false;\n\n  /** Checks whether the policy affects the password generator.\n   * @returns True if at least one password or passphrase requirement has been set.\n   * If it returns False, then no requirements have been set and the policy should\n   * not be enforced.\n   */\n  inEffect() {\n    return (\n      this.defaultType ||\n      this.minLength > 0 ||\n      this.numberCount > 0 ||\n      this.specialCount > 0 ||\n      this.useUppercase ||\n      this.useLowercase ||\n      this.useNumbers ||\n      this.useSpecial ||\n      this.minNumberWords > 0 ||\n      this.capitalize ||\n      this.includeNumber\n    );\n  }\n\n  /** Creates a copy of the policy.\n   */\n  clone() {\n    const policy = new PasswordGeneratorPolicyOptions();\n    Object.assign(policy, this);\n    return policy;\n  }\n}\n","// EFF's Long Wordlist from https://www.eff.org/dice\nexport const EFFLongWordList = [\n  \"abacus\",\n  \"abdomen\",\n  \"abdominal\",\n  \"abide\",\n  \"abiding\",\n  \"ability\",\n  \"ablaze\",\n  \"able\",\n  \"abnormal\",\n  \"abrasion\",\n  \"abrasive\",\n  \"abreast\",\n  \"abridge\",\n  \"abroad\",\n  \"abruptly\",\n  \"absence\",\n  \"absentee\",\n  \"absently\",\n  \"absinthe\",\n  \"absolute\",\n  \"absolve\",\n  \"abstain\",\n  \"abstract\",\n  \"absurd\",\n  \"accent\",\n  \"acclaim\",\n  \"acclimate\",\n  \"accompany\",\n  \"account\",\n  \"accuracy\",\n  \"accurate\",\n  \"accustom\",\n  \"acetone\",\n  \"achiness\",\n  \"aching\",\n  \"acid\",\n  \"acorn\",\n  \"acquaint\",\n  \"acquire\",\n  \"acre\",\n  \"acrobat\",\n  \"acronym\",\n  \"acting\",\n  \"action\",\n  \"activate\",\n  \"activator\",\n  \"active\",\n  \"activism\",\n  \"activist\",\n  \"activity\",\n  \"actress\",\n  \"acts\",\n  \"acutely\",\n  \"acuteness\",\n  \"aeration\",\n  \"aerobics\",\n  \"aerosol\",\n  \"aerospace\",\n  \"afar\",\n  \"affair\",\n  \"affected\",\n  \"affecting\",\n  \"affection\",\n  \"affidavit\",\n  \"affiliate\",\n  \"affirm\",\n  \"affix\",\n  \"afflicted\",\n  \"affluent\",\n  \"afford\",\n  \"affront\",\n  \"aflame\",\n  \"afloat\",\n  \"aflutter\",\n  \"afoot\",\n  \"afraid\",\n  \"afterglow\",\n  \"afterlife\",\n  \"aftermath\",\n  \"aftermost\",\n  \"afternoon\",\n  \"aged\",\n  \"ageless\",\n  \"agency\",\n  \"agenda\",\n  \"agent\",\n  \"aggregate\",\n  \"aghast\",\n  \"agile\",\n  \"agility\",\n  \"aging\",\n  \"agnostic\",\n  \"agonize\",\n  \"agonizing\",\n  \"agony\",\n  \"agreeable\",\n  \"agreeably\",\n  \"agreed\",\n  \"agreeing\",\n  \"agreement\",\n  \"aground\",\n  \"ahead\",\n  \"ahoy\",\n  \"aide\",\n  \"aids\",\n  \"aim\",\n  \"ajar\",\n  \"alabaster\",\n  \"alarm\",\n  \"albatross\",\n  \"album\",\n  \"alfalfa\",\n  \"algebra\",\n  \"algorithm\",\n  \"alias\",\n  \"alibi\",\n  \"alienable\",\n  \"alienate\",\n  \"aliens\",\n  \"alike\",\n  \"alive\",\n  \"alkaline\",\n  \"alkalize\",\n  \"almanac\",\n  \"almighty\",\n  \"almost\",\n  \"aloe\",\n  \"aloft\",\n  \"aloha\",\n  \"alone\",\n  \"alongside\",\n  \"aloof\",\n  \"alphabet\",\n  \"alright\",\n  \"although\",\n  \"altitude\",\n  \"alto\",\n  \"aluminum\",\n  \"alumni\",\n  \"always\",\n  \"amaretto\",\n  \"amaze\",\n  \"amazingly\",\n  \"amber\",\n  \"ambiance\",\n  \"ambiguity\",\n  \"ambiguous\",\n  \"ambition\",\n  \"ambitious\",\n  \"ambulance\",\n  \"ambush\",\n  \"amendable\",\n  \"amendment\",\n  \"amends\",\n  \"amenity\",\n  \"amiable\",\n  \"amicably\",\n  \"amid\",\n  \"amigo\",\n  \"amino\",\n  \"amiss\",\n  \"ammonia\",\n  \"ammonium\",\n  \"amnesty\",\n  \"amniotic\",\n  \"among\",\n  \"amount\",\n  \"amperage\",\n  \"ample\",\n  \"amplifier\",\n  \"amplify\",\n  \"amply\",\n  \"amuck\",\n  \"amulet\",\n  \"amusable\",\n  \"amused\",\n  \"amusement\",\n  \"amuser\",\n  \"amusing\",\n  \"anaconda\",\n  \"anaerobic\",\n  \"anagram\",\n  \"anatomist\",\n  \"anatomy\",\n  \"anchor\",\n  \"anchovy\",\n  \"ancient\",\n  \"android\",\n  \"anemia\",\n  \"anemic\",\n  \"aneurism\",\n  \"anew\",\n  \"angelfish\",\n  \"angelic\",\n  \"anger\",\n  \"angled\",\n  \"angler\",\n  \"angles\",\n  \"angling\",\n  \"angrily\",\n  \"angriness\",\n  \"anguished\",\n  \"angular\",\n  \"animal\",\n  \"animate\",\n  \"animating\",\n  \"animation\",\n  \"animator\",\n  \"anime\",\n  \"animosity\",\n  \"ankle\",\n  \"annex\",\n  \"annotate\",\n  \"announcer\",\n  \"annoying\",\n  \"annually\",\n  \"annuity\",\n  \"anointer\",\n  \"another\",\n  \"answering\",\n  \"antacid\",\n  \"antarctic\",\n  \"anteater\",\n  \"antelope\",\n  \"antennae\",\n  \"anthem\",\n  \"anthill\",\n  \"anthology\",\n  \"antibody\",\n  \"antics\",\n  \"antidote\",\n  \"antihero\",\n  \"antiquely\",\n  \"antiques\",\n  \"antiquity\",\n  \"antirust\",\n  \"antitoxic\",\n  \"antitrust\",\n  \"antiviral\",\n  \"antivirus\",\n  \"antler\",\n  \"antonym\",\n  \"antsy\",\n  \"anvil\",\n  \"anybody\",\n  \"anyhow\",\n  \"anymore\",\n  \"anyone\",\n  \"anyplace\",\n  \"anything\",\n  \"anytime\",\n  \"anyway\",\n  \"anywhere\",\n  \"aorta\",\n  \"apache\",\n  \"apostle\",\n  \"appealing\",\n  \"appear\",\n  \"appease\",\n  \"appeasing\",\n  \"appendage\",\n  \"appendix\",\n  \"appetite\",\n  \"appetizer\",\n  \"applaud\",\n  \"applause\",\n  \"apple\",\n  \"appliance\",\n  \"applicant\",\n  \"applied\",\n  \"apply\",\n  \"appointee\",\n  \"appraisal\",\n  \"appraiser\",\n  \"apprehend\",\n  \"approach\",\n  \"approval\",\n  \"approve\",\n  \"apricot\",\n  \"april\",\n  \"apron\",\n  \"aptitude\",\n  \"aptly\",\n  \"aqua\",\n  \"aqueduct\",\n  \"arbitrary\",\n  \"arbitrate\",\n  \"ardently\",\n  \"area\",\n  \"arena\",\n  \"arguable\",\n  \"arguably\",\n  \"argue\",\n  \"arise\",\n  \"armadillo\",\n  \"armband\",\n  \"armchair\",\n  \"armed\",\n  \"armful\",\n  \"armhole\",\n  \"arming\",\n  \"armless\",\n  \"armoire\",\n  \"armored\",\n  \"armory\",\n  \"armrest\",\n  \"army\",\n  \"aroma\",\n  \"arose\",\n  \"around\",\n  \"arousal\",\n  \"arrange\",\n  \"array\",\n  \"arrest\",\n  \"arrival\",\n  \"arrive\",\n  \"arrogance\",\n  \"arrogant\",\n  \"arson\",\n  \"art\",\n  \"ascend\",\n  \"ascension\",\n  \"ascent\",\n  \"ascertain\",\n  \"ashamed\",\n  \"ashen\",\n  \"ashes\",\n  \"ashy\",\n  \"aside\",\n  \"askew\",\n  \"asleep\",\n  \"asparagus\",\n  \"aspect\",\n  \"aspirate\",\n  \"aspire\",\n  \"aspirin\",\n  \"astonish\",\n  \"astound\",\n  \"astride\",\n  \"astrology\",\n  \"astronaut\",\n  \"astronomy\",\n  \"astute\",\n  \"atlantic\",\n  \"atlas\",\n  \"atom\",\n  \"atonable\",\n  \"atop\",\n  \"atrium\",\n  \"atrocious\",\n  \"atrophy\",\n  \"attach\",\n  \"attain\",\n  \"attempt\",\n  \"attendant\",\n  \"attendee\",\n  \"attention\",\n  \"attentive\",\n  \"attest\",\n  \"attic\",\n  \"attire\",\n  \"attitude\",\n  \"attractor\",\n  \"attribute\",\n  \"atypical\",\n  \"auction\",\n  \"audacious\",\n  \"audacity\",\n  \"audible\",\n  \"audibly\",\n  \"audience\",\n  \"audio\",\n  \"audition\",\n  \"augmented\",\n  \"august\",\n  \"authentic\",\n  \"author\",\n  \"autism\",\n  \"autistic\",\n  \"autograph\",\n  \"automaker\",\n  \"automated\",\n  \"automatic\",\n  \"autopilot\",\n  \"available\",\n  \"avalanche\",\n  \"avatar\",\n  \"avenge\",\n  \"avenging\",\n  \"avenue\",\n  \"average\",\n  \"aversion\",\n  \"avert\",\n  \"aviation\",\n  \"aviator\",\n  \"avid\",\n  \"avoid\",\n  \"await\",\n  \"awaken\",\n  \"award\",\n  \"aware\",\n  \"awhile\",\n  \"awkward\",\n  \"awning\",\n  \"awoke\",\n  \"awry\",\n  \"axis\",\n  \"babble\",\n  \"babbling\",\n  \"babied\",\n  \"baboon\",\n  \"backache\",\n  \"backboard\",\n  \"backboned\",\n  \"backdrop\",\n  \"backed\",\n  \"backer\",\n  \"backfield\",\n  \"backfire\",\n  \"backhand\",\n  \"backing\",\n  \"backlands\",\n  \"backlash\",\n  \"backless\",\n  \"backlight\",\n  \"backlit\",\n  \"backlog\",\n  \"backpack\",\n  \"backpedal\",\n  \"backrest\",\n  \"backroom\",\n  \"backshift\",\n  \"backside\",\n  \"backslid\",\n  \"backspace\",\n  \"backspin\",\n  \"backstab\",\n  \"backstage\",\n  \"backtalk\",\n  \"backtrack\",\n  \"backup\",\n  \"backward\",\n  \"backwash\",\n  \"backwater\",\n  \"backyard\",\n  \"bacon\",\n  \"bacteria\",\n  \"bacterium\",\n  \"badass\",\n  \"badge\",\n  \"badland\",\n  \"badly\",\n  \"badness\",\n  \"baffle\",\n  \"baffling\",\n  \"bagel\",\n  \"bagful\",\n  \"baggage\",\n  \"bagged\",\n  \"baggie\",\n  \"bagginess\",\n  \"bagging\",\n  \"baggy\",\n  \"bagpipe\",\n  \"baguette\",\n  \"baked\",\n  \"bakery\",\n  \"bakeshop\",\n  \"baking\",\n  \"balance\",\n  \"balancing\",\n  \"balcony\",\n  \"balmy\",\n  \"balsamic\",\n  \"bamboo\",\n  \"banana\",\n  \"banish\",\n  \"banister\",\n  \"banjo\",\n  \"bankable\",\n  \"bankbook\",\n  \"banked\",\n  \"banker\",\n  \"banking\",\n  \"banknote\",\n  \"bankroll\",\n  \"banner\",\n  \"bannister\",\n  \"banshee\",\n  \"banter\",\n  \"barbecue\",\n  \"barbed\",\n  \"barbell\",\n  \"barber\",\n  \"barcode\",\n  \"barge\",\n  \"bargraph\",\n  \"barista\",\n  \"baritone\",\n  \"barley\",\n  \"barmaid\",\n  \"barman\",\n  \"barn\",\n  \"barometer\",\n  \"barrack\",\n  \"barracuda\",\n  \"barrel\",\n  \"barrette\",\n  \"barricade\",\n  \"barrier\",\n  \"barstool\",\n  \"bartender\",\n  \"barterer\",\n  \"bash\",\n  \"basically\",\n  \"basics\",\n  \"basil\",\n  \"basin\",\n  \"basis\",\n  \"basket\",\n  \"batboy\",\n  \"batch\",\n  \"bath\",\n  \"baton\",\n  \"bats\",\n  \"battalion\",\n  \"battered\",\n  \"battering\",\n  \"battery\",\n  \"batting\",\n  \"battle\",\n  \"bauble\",\n  \"bazooka\",\n  \"blabber\",\n  \"bladder\",\n  \"blade\",\n  \"blah\",\n  \"blame\",\n  \"blaming\",\n  \"blanching\",\n  \"blandness\",\n  \"blank\",\n  \"blaspheme\",\n  \"blasphemy\",\n  \"blast\",\n  \"blatancy\",\n  \"blatantly\",\n  \"blazer\",\n  \"blazing\",\n  \"bleach\",\n  \"bleak\",\n  \"bleep\",\n  \"blemish\",\n  \"blend\",\n  \"bless\",\n  \"blighted\",\n  \"blimp\",\n  \"bling\",\n  \"blinked\",\n  \"blinker\",\n  \"blinking\",\n  \"blinks\",\n  \"blip\",\n  \"blissful\",\n  \"blitz\",\n  \"blizzard\",\n  \"bloated\",\n  \"bloating\",\n  \"blob\",\n  \"blog\",\n  \"bloomers\",\n  \"blooming\",\n  \"blooper\",\n  \"blot\",\n  \"blouse\",\n  \"blubber\",\n  \"bluff\",\n  \"bluish\",\n  \"blunderer\",\n  \"blunt\",\n  \"blurb\",\n  \"blurred\",\n  \"blurry\",\n  \"blurt\",\n  \"blush\",\n  \"blustery\",\n  \"boaster\",\n  \"boastful\",\n  \"boasting\",\n  \"boat\",\n  \"bobbed\",\n  \"bobbing\",\n  \"bobble\",\n  \"bobcat\",\n  \"bobsled\",\n  \"bobtail\",\n  \"bodacious\",\n  \"body\",\n  \"bogged\",\n  \"boggle\",\n  \"bogus\",\n  \"boil\",\n  \"bok\",\n  \"bolster\",\n  \"bolt\",\n  \"bonanza\",\n  \"bonded\",\n  \"bonding\",\n  \"bondless\",\n  \"boned\",\n  \"bonehead\",\n  \"boneless\",\n  \"bonelike\",\n  \"boney\",\n  \"bonfire\",\n  \"bonnet\",\n  \"bonsai\",\n  \"bonus\",\n  \"bony\",\n  \"boogeyman\",\n  \"boogieman\",\n  \"book\",\n  \"boondocks\",\n  \"booted\",\n  \"booth\",\n  \"bootie\",\n  \"booting\",\n  \"bootlace\",\n  \"bootleg\",\n  \"boots\",\n  \"boozy\",\n  \"borax\",\n  \"boring\",\n  \"borough\",\n  \"borrower\",\n  \"borrowing\",\n  \"boss\",\n  \"botanical\",\n  \"botanist\",\n  \"botany\",\n  \"botch\",\n  \"both\",\n  \"bottle\",\n  \"bottling\",\n  \"bottom\",\n  \"bounce\",\n  \"bouncing\",\n  \"bouncy\",\n  \"bounding\",\n  \"boundless\",\n  \"bountiful\",\n  \"bovine\",\n  \"boxcar\",\n  \"boxer\",\n  \"boxing\",\n  \"boxlike\",\n  \"boxy\",\n  \"breach\",\n  \"breath\",\n  \"breeches\",\n  \"breeching\",\n  \"breeder\",\n  \"breeding\",\n  \"breeze\",\n  \"breezy\",\n  \"brethren\",\n  \"brewery\",\n  \"brewing\",\n  \"briar\",\n  \"bribe\",\n  \"brick\",\n  \"bride\",\n  \"bridged\",\n  \"brigade\",\n  \"bright\",\n  \"brilliant\",\n  \"brim\",\n  \"bring\",\n  \"brink\",\n  \"brisket\",\n  \"briskly\",\n  \"briskness\",\n  \"bristle\",\n  \"brittle\",\n  \"broadband\",\n  \"broadcast\",\n  \"broaden\",\n  \"broadly\",\n  \"broadness\",\n  \"broadside\",\n  \"broadways\",\n  \"broiler\",\n  \"broiling\",\n  \"broken\",\n  \"broker\",\n  \"bronchial\",\n  \"bronco\",\n  \"bronze\",\n  \"bronzing\",\n  \"brook\",\n  \"broom\",\n  \"brought\",\n  \"browbeat\",\n  \"brownnose\",\n  \"browse\",\n  \"browsing\",\n  \"bruising\",\n  \"brunch\",\n  \"brunette\",\n  \"brunt\",\n  \"brush\",\n  \"brussels\",\n  \"brute\",\n  \"brutishly\",\n  \"bubble\",\n  \"bubbling\",\n  \"bubbly\",\n  \"buccaneer\",\n  \"bucked\",\n  \"bucket\",\n  \"buckle\",\n  \"buckshot\",\n  \"buckskin\",\n  \"bucktooth\",\n  \"buckwheat\",\n  \"buddhism\",\n  \"buddhist\",\n  \"budding\",\n  \"buddy\",\n  \"budget\",\n  \"buffalo\",\n  \"buffed\",\n  \"buffer\",\n  \"buffing\",\n  \"buffoon\",\n  \"buggy\",\n  \"bulb\",\n  \"bulge\",\n  \"bulginess\",\n  \"bulgur\",\n  \"bulk\",\n  \"bulldog\",\n  \"bulldozer\",\n  \"bullfight\",\n  \"bullfrog\",\n  \"bullhorn\",\n  \"bullion\",\n  \"bullish\",\n  \"bullpen\",\n  \"bullring\",\n  \"bullseye\",\n  \"bullwhip\",\n  \"bully\",\n  \"bunch\",\n  \"bundle\",\n  \"bungee\",\n  \"bunion\",\n  \"bunkbed\",\n  \"bunkhouse\",\n  \"bunkmate\",\n  \"bunny\",\n  \"bunt\",\n  \"busboy\",\n  \"bush\",\n  \"busily\",\n  \"busload\",\n  \"bust\",\n  \"busybody\",\n  \"buzz\",\n  \"cabana\",\n  \"cabbage\",\n  \"cabbie\",\n  \"cabdriver\",\n  \"cable\",\n  \"caboose\",\n  \"cache\",\n  \"cackle\",\n  \"cacti\",\n  \"cactus\",\n  \"caddie\",\n  \"caddy\",\n  \"cadet\",\n  \"cadillac\",\n  \"cadmium\",\n  \"cage\",\n  \"cahoots\",\n  \"cake\",\n  \"calamari\",\n  \"calamity\",\n  \"calcium\",\n  \"calculate\",\n  \"calculus\",\n  \"caliber\",\n  \"calibrate\",\n  \"calm\",\n  \"caloric\",\n  \"calorie\",\n  \"calzone\",\n  \"camcorder\",\n  \"cameo\",\n  \"camera\",\n  \"camisole\",\n  \"camper\",\n  \"campfire\",\n  \"camping\",\n  \"campsite\",\n  \"campus\",\n  \"canal\",\n  \"canary\",\n  \"cancel\",\n  \"candied\",\n  \"candle\",\n  \"candy\",\n  \"cane\",\n  \"canine\",\n  \"canister\",\n  \"cannabis\",\n  \"canned\",\n  \"canning\",\n  \"cannon\",\n  \"cannot\",\n  \"canola\",\n  \"canon\",\n  \"canopener\",\n  \"canopy\",\n  \"canteen\",\n  \"canyon\",\n  \"capable\",\n  \"capably\",\n  \"capacity\",\n  \"cape\",\n  \"capillary\",\n  \"capital\",\n  \"capitol\",\n  \"capped\",\n  \"capricorn\",\n  \"capsize\",\n  \"capsule\",\n  \"caption\",\n  \"captivate\",\n  \"captive\",\n  \"captivity\",\n  \"capture\",\n  \"caramel\",\n  \"carat\",\n  \"caravan\",\n  \"carbon\",\n  \"cardboard\",\n  \"carded\",\n  \"cardiac\",\n  \"cardigan\",\n  \"cardinal\",\n  \"cardstock\",\n  \"carefully\",\n  \"caregiver\",\n  \"careless\",\n  \"caress\",\n  \"caretaker\",\n  \"cargo\",\n  \"caring\",\n  \"carless\",\n  \"carload\",\n  \"carmaker\",\n  \"carnage\",\n  \"carnation\",\n  \"carnival\",\n  \"carnivore\",\n  \"carol\",\n  \"carpenter\",\n  \"carpentry\",\n  \"carpool\",\n  \"carport\",\n  \"carried\",\n  \"carrot\",\n  \"carrousel\",\n  \"carry\",\n  \"cartel\",\n  \"cartload\",\n  \"carton\",\n  \"cartoon\",\n  \"cartridge\",\n  \"cartwheel\",\n  \"carve\",\n  \"carving\",\n  \"carwash\",\n  \"cascade\",\n  \"case\",\n  \"cash\",\n  \"casing\",\n  \"casino\",\n  \"casket\",\n  \"cassette\",\n  \"casually\",\n  \"casualty\",\n  \"catacomb\",\n  \"catalog\",\n  \"catalyst\",\n  \"catalyze\",\n  \"catapult\",\n  \"cataract\",\n  \"catatonic\",\n  \"catcall\",\n  \"catchable\",\n  \"catcher\",\n  \"catching\",\n  \"catchy\",\n  \"caterer\",\n  \"catering\",\n  \"catfight\",\n  \"catfish\",\n  \"cathedral\",\n  \"cathouse\",\n  \"catlike\",\n  \"catnap\",\n  \"catnip\",\n  \"catsup\",\n  \"cattail\",\n  \"cattishly\",\n  \"cattle\",\n  \"catty\",\n  \"catwalk\",\n  \"caucasian\",\n  \"caucus\",\n  \"causal\",\n  \"causation\",\n  \"cause\",\n  \"causing\",\n  \"cauterize\",\n  \"caution\",\n  \"cautious\",\n  \"cavalier\",\n  \"cavalry\",\n  \"caviar\",\n  \"cavity\",\n  \"cedar\",\n  \"celery\",\n  \"celestial\",\n  \"celibacy\",\n  \"celibate\",\n  \"celtic\",\n  \"cement\",\n  \"census\",\n  \"ceramics\",\n  \"ceremony\",\n  \"certainly\",\n  \"certainty\",\n  \"certified\",\n  \"certify\",\n  \"cesarean\",\n  \"cesspool\",\n  \"chafe\",\n  \"chaffing\",\n  \"chain\",\n  \"chair\",\n  \"chalice\",\n  \"challenge\",\n  \"chamber\",\n  \"chamomile\",\n  \"champion\",\n  \"chance\",\n  \"change\",\n  \"channel\",\n  \"chant\",\n  \"chaos\",\n  \"chaperone\",\n  \"chaplain\",\n  \"chapped\",\n  \"chaps\",\n  \"chapter\",\n  \"character\",\n  \"charbroil\",\n  \"charcoal\",\n  \"charger\",\n  \"charging\",\n  \"chariot\",\n  \"charity\",\n  \"charm\",\n  \"charred\",\n  \"charter\",\n  \"charting\",\n  \"chase\",\n  \"chasing\",\n  \"chaste\",\n  \"chastise\",\n  \"chastity\",\n  \"chatroom\",\n  \"chatter\",\n  \"chatting\",\n  \"chatty\",\n  \"cheating\",\n  \"cheddar\",\n  \"cheek\",\n  \"cheer\",\n  \"cheese\",\n  \"cheesy\",\n  \"chef\",\n  \"chemicals\",\n  \"chemist\",\n  \"chemo\",\n  \"cherisher\",\n  \"cherub\",\n  \"chess\",\n  \"chest\",\n  \"chevron\",\n  \"chevy\",\n  \"chewable\",\n  \"chewer\",\n  \"chewing\",\n  \"chewy\",\n  \"chief\",\n  \"chihuahua\",\n  \"childcare\",\n  \"childhood\",\n  \"childish\",\n  \"childless\",\n  \"childlike\",\n  \"chili\",\n  \"chill\",\n  \"chimp\",\n  \"chip\",\n  \"chirping\",\n  \"chirpy\",\n  \"chitchat\",\n  \"chivalry\",\n  \"chive\",\n  \"chloride\",\n  \"chlorine\",\n  \"choice\",\n  \"chokehold\",\n  \"choking\",\n  \"chomp\",\n  \"chooser\",\n  \"choosing\",\n  \"choosy\",\n  \"chop\",\n  \"chosen\",\n  \"chowder\",\n  \"chowtime\",\n  \"chrome\",\n  \"chubby\",\n  \"chuck\",\n  \"chug\",\n  \"chummy\",\n  \"chump\",\n  \"chunk\",\n  \"churn\",\n  \"chute\",\n  \"cider\",\n  \"cilantro\",\n  \"cinch\",\n  \"cinema\",\n  \"cinnamon\",\n  \"circle\",\n  \"circling\",\n  \"circular\",\n  \"circulate\",\n  \"circus\",\n  \"citable\",\n  \"citadel\",\n  \"citation\",\n  \"citizen\",\n  \"citric\",\n  \"citrus\",\n  \"city\",\n  \"civic\",\n  \"civil\",\n  \"clad\",\n  \"claim\",\n  \"clambake\",\n  \"clammy\",\n  \"clamor\",\n  \"clamp\",\n  \"clamshell\",\n  \"clang\",\n  \"clanking\",\n  \"clapped\",\n  \"clapper\",\n  \"clapping\",\n  \"clarify\",\n  \"clarinet\",\n  \"clarity\",\n  \"clash\",\n  \"clasp\",\n  \"class\",\n  \"clatter\",\n  \"clause\",\n  \"clavicle\",\n  \"claw\",\n  \"clay\",\n  \"clean\",\n  \"clear\",\n  \"cleat\",\n  \"cleaver\",\n  \"cleft\",\n  \"clench\",\n  \"clergyman\",\n  \"clerical\",\n  \"clerk\",\n  \"clever\",\n  \"clicker\",\n  \"client\",\n  \"climate\",\n  \"climatic\",\n  \"cling\",\n  \"clinic\",\n  \"clinking\",\n  \"clip\",\n  \"clique\",\n  \"cloak\",\n  \"clobber\",\n  \"clock\",\n  \"clone\",\n  \"cloning\",\n  \"closable\",\n  \"closure\",\n  \"clothes\",\n  \"clothing\",\n  \"cloud\",\n  \"clover\",\n  \"clubbed\",\n  \"clubbing\",\n  \"clubhouse\",\n  \"clump\",\n  \"clumsily\",\n  \"clumsy\",\n  \"clunky\",\n  \"clustered\",\n  \"clutch\",\n  \"clutter\",\n  \"coach\",\n  \"coagulant\",\n  \"coastal\",\n  \"coaster\",\n  \"coasting\",\n  \"coastland\",\n  \"coastline\",\n  \"coat\",\n  \"coauthor\",\n  \"cobalt\",\n  \"cobbler\",\n  \"cobweb\",\n  \"cocoa\",\n  \"coconut\",\n  \"cod\",\n  \"coeditor\",\n  \"coerce\",\n  \"coexist\",\n  \"coffee\",\n  \"cofounder\",\n  \"cognition\",\n  \"cognitive\",\n  \"cogwheel\",\n  \"coherence\",\n  \"coherent\",\n  \"cohesive\",\n  \"coil\",\n  \"coke\",\n  \"cola\",\n  \"cold\",\n  \"coleslaw\",\n  \"coliseum\",\n  \"collage\",\n  \"collapse\",\n  \"collar\",\n  \"collected\",\n  \"collector\",\n  \"collide\",\n  \"collie\",\n  \"collision\",\n  \"colonial\",\n  \"colonist\",\n  \"colonize\",\n  \"colony\",\n  \"colossal\",\n  \"colt\",\n  \"coma\",\n  \"come\",\n  \"comfort\",\n  \"comfy\",\n  \"comic\",\n  \"coming\",\n  \"comma\",\n  \"commence\",\n  \"commend\",\n  \"comment\",\n  \"commerce\",\n  \"commode\",\n  \"commodity\",\n  \"commodore\",\n  \"common\",\n  \"commotion\",\n  \"commute\",\n  \"commuting\",\n  \"compacted\",\n  \"compacter\",\n  \"compactly\",\n  \"compactor\",\n  \"companion\",\n  \"company\",\n  \"compare\",\n  \"compel\",\n  \"compile\",\n  \"comply\",\n  \"component\",\n  \"composed\",\n  \"composer\",\n  \"composite\",\n  \"compost\",\n  \"composure\",\n  \"compound\",\n  \"compress\",\n  \"comprised\",\n  \"computer\",\n  \"computing\",\n  \"comrade\",\n  \"concave\",\n  \"conceal\",\n  \"conceded\",\n  \"concept\",\n  \"concerned\",\n  \"concert\",\n  \"conch\",\n  \"concierge\",\n  \"concise\",\n  \"conclude\",\n  \"concrete\",\n  \"concur\",\n  \"condense\",\n  \"condiment\",\n  \"condition\",\n  \"condone\",\n  \"conducive\",\n  \"conductor\",\n  \"conduit\",\n  \"cone\",\n  \"confess\",\n  \"confetti\",\n  \"confidant\",\n  \"confident\",\n  \"confider\",\n  \"confiding\",\n  \"configure\",\n  \"confined\",\n  \"confining\",\n  \"confirm\",\n  \"conflict\",\n  \"conform\",\n  \"confound\",\n  \"confront\",\n  \"confused\",\n  \"confusing\",\n  \"confusion\",\n  \"congenial\",\n  \"congested\",\n  \"congrats\",\n  \"congress\",\n  \"conical\",\n  \"conjoined\",\n  \"conjure\",\n  \"conjuror\",\n  \"connected\",\n  \"connector\",\n  \"consensus\",\n  \"consent\",\n  \"console\",\n  \"consoling\",\n  \"consonant\",\n  \"constable\",\n  \"constant\",\n  \"constrain\",\n  \"constrict\",\n  \"construct\",\n  \"consult\",\n  \"consumer\",\n  \"consuming\",\n  \"contact\",\n  \"container\",\n  \"contempt\",\n  \"contend\",\n  \"contented\",\n  \"contently\",\n  \"contents\",\n  \"contest\",\n  \"context\",\n  \"contort\",\n  \"contour\",\n  \"contrite\",\n  \"control\",\n  \"contusion\",\n  \"convene\",\n  \"convent\",\n  \"copartner\",\n  \"cope\",\n  \"copied\",\n  \"copier\",\n  \"copilot\",\n  \"coping\",\n  \"copious\",\n  \"copper\",\n  \"copy\",\n  \"coral\",\n  \"cork\",\n  \"cornball\",\n  \"cornbread\",\n  \"corncob\",\n  \"cornea\",\n  \"corned\",\n  \"corner\",\n  \"cornfield\",\n  \"cornflake\",\n  \"cornhusk\",\n  \"cornmeal\",\n  \"cornstalk\",\n  \"corny\",\n  \"coronary\",\n  \"coroner\",\n  \"corporal\",\n  \"corporate\",\n  \"corral\",\n  \"correct\",\n  \"corridor\",\n  \"corrode\",\n  \"corroding\",\n  \"corrosive\",\n  \"corsage\",\n  \"corset\",\n  \"cortex\",\n  \"cosigner\",\n  \"cosmetics\",\n  \"cosmic\",\n  \"cosmos\",\n  \"cosponsor\",\n  \"cost\",\n  \"cottage\",\n  \"cotton\",\n  \"couch\",\n  \"cough\",\n  \"could\",\n  \"countable\",\n  \"countdown\",\n  \"counting\",\n  \"countless\",\n  \"country\",\n  \"county\",\n  \"courier\",\n  \"covenant\",\n  \"cover\",\n  \"coveted\",\n  \"coveting\",\n  \"coyness\",\n  \"cozily\",\n  \"coziness\",\n  \"cozy\",\n  \"crabbing\",\n  \"crabgrass\",\n  \"crablike\",\n  \"crabmeat\",\n  \"cradle\",\n  \"cradling\",\n  \"crafter\",\n  \"craftily\",\n  \"craftsman\",\n  \"craftwork\",\n  \"crafty\",\n  \"cramp\",\n  \"cranberry\",\n  \"crane\",\n  \"cranial\",\n  \"cranium\",\n  \"crank\",\n  \"crate\",\n  \"crave\",\n  \"craving\",\n  \"crawfish\",\n  \"crawlers\",\n  \"crawling\",\n  \"crayfish\",\n  \"crayon\",\n  \"crazed\",\n  \"crazily\",\n  \"craziness\",\n  \"crazy\",\n  \"creamed\",\n  \"creamer\",\n  \"creamlike\",\n  \"crease\",\n  \"creasing\",\n  \"creatable\",\n  \"create\",\n  \"creation\",\n  \"creative\",\n  \"creature\",\n  \"credible\",\n  \"credibly\",\n  \"credit\",\n  \"creed\",\n  \"creme\",\n  \"creole\",\n  \"crepe\",\n  \"crept\",\n  \"crescent\",\n  \"crested\",\n  \"cresting\",\n  \"crestless\",\n  \"crevice\",\n  \"crewless\",\n  \"crewman\",\n  \"crewmate\",\n  \"crib\",\n  \"cricket\",\n  \"cried\",\n  \"crier\",\n  \"crimp\",\n  \"crimson\",\n  \"cringe\",\n  \"cringing\",\n  \"crinkle\",\n  \"crinkly\",\n  \"crisped\",\n  \"crisping\",\n  \"crisply\",\n  \"crispness\",\n  \"crispy\",\n  \"criteria\",\n  \"critter\",\n  \"croak\",\n  \"crock\",\n  \"crook\",\n  \"croon\",\n  \"crop\",\n  \"cross\",\n  \"crouch\",\n  \"crouton\",\n  \"crowbar\",\n  \"crowd\",\n  \"crown\",\n  \"crucial\",\n  \"crudely\",\n  \"crudeness\",\n  \"cruelly\",\n  \"cruelness\",\n  \"cruelty\",\n  \"crumb\",\n  \"crummiest\",\n  \"crummy\",\n  \"crumpet\",\n  \"crumpled\",\n  \"cruncher\",\n  \"crunching\",\n  \"crunchy\",\n  \"crusader\",\n  \"crushable\",\n  \"crushed\",\n  \"crusher\",\n  \"crushing\",\n  \"crust\",\n  \"crux\",\n  \"crying\",\n  \"cryptic\",\n  \"crystal\",\n  \"cubbyhole\",\n  \"cube\",\n  \"cubical\",\n  \"cubicle\",\n  \"cucumber\",\n  \"cuddle\",\n  \"cuddly\",\n  \"cufflink\",\n  \"culinary\",\n  \"culminate\",\n  \"culpable\",\n  \"culprit\",\n  \"cultivate\",\n  \"cultural\",\n  \"culture\",\n  \"cupbearer\",\n  \"cupcake\",\n  \"cupid\",\n  \"cupped\",\n  \"cupping\",\n  \"curable\",\n  \"curator\",\n  \"curdle\",\n  \"cure\",\n  \"curfew\",\n  \"curing\",\n  \"curled\",\n  \"curler\",\n  \"curliness\",\n  \"curling\",\n  \"curly\",\n  \"curry\",\n  \"curse\",\n  \"cursive\",\n  \"cursor\",\n  \"curtain\",\n  \"curtly\",\n  \"curtsy\",\n  \"curvature\",\n  \"curve\",\n  \"curvy\",\n  \"cushy\",\n  \"cusp\",\n  \"cussed\",\n  \"custard\",\n  \"custodian\",\n  \"custody\",\n  \"customary\",\n  \"customer\",\n  \"customize\",\n  \"customs\",\n  \"cut\",\n  \"cycle\",\n  \"cyclic\",\n  \"cycling\",\n  \"cyclist\",\n  \"cylinder\",\n  \"cymbal\",\n  \"cytoplasm\",\n  \"cytoplast\",\n  \"dab\",\n  \"dad\",\n  \"daffodil\",\n  \"dagger\",\n  \"daily\",\n  \"daintily\",\n  \"dainty\",\n  \"dairy\",\n  \"daisy\",\n  \"dallying\",\n  \"dance\",\n  \"dancing\",\n  \"dandelion\",\n  \"dander\",\n  \"dandruff\",\n  \"dandy\",\n  \"danger\",\n  \"dangle\",\n  \"dangling\",\n  \"daredevil\",\n  \"dares\",\n  \"daringly\",\n  \"darkened\",\n  \"darkening\",\n  \"darkish\",\n  \"darkness\",\n  \"darkroom\",\n  \"darling\",\n  \"darn\",\n  \"dart\",\n  \"darwinism\",\n  \"dash\",\n  \"dastardly\",\n  \"data\",\n  \"datebook\",\n  \"dating\",\n  \"daughter\",\n  \"daunting\",\n  \"dawdler\",\n  \"dawn\",\n  \"daybed\",\n  \"daybreak\",\n  \"daycare\",\n  \"daydream\",\n  \"daylight\",\n  \"daylong\",\n  \"dayroom\",\n  \"daytime\",\n  \"dazzler\",\n  \"dazzling\",\n  \"deacon\",\n  \"deafening\",\n  \"deafness\",\n  \"dealer\",\n  \"dealing\",\n  \"dealmaker\",\n  \"dealt\",\n  \"dean\",\n  \"debatable\",\n  \"debate\",\n  \"debating\",\n  \"debit\",\n  \"debrief\",\n  \"debtless\",\n  \"debtor\",\n  \"debug\",\n  \"debunk\",\n  \"decade\",\n  \"decaf\",\n  \"decal\",\n  \"decathlon\",\n  \"decay\",\n  \"deceased\",\n  \"deceit\",\n  \"deceiver\",\n  \"deceiving\",\n  \"december\",\n  \"decency\",\n  \"decent\",\n  \"deception\",\n  \"deceptive\",\n  \"decibel\",\n  \"decidable\",\n  \"decimal\",\n  \"decimeter\",\n  \"decipher\",\n  \"deck\",\n  \"declared\",\n  \"decline\",\n  \"decode\",\n  \"decompose\",\n  \"decorated\",\n  \"decorator\",\n  \"decoy\",\n  \"decrease\",\n  \"decree\",\n  \"dedicate\",\n  \"dedicator\",\n  \"deduce\",\n  \"deduct\",\n  \"deed\",\n  \"deem\",\n  \"deepen\",\n  \"deeply\",\n  \"deepness\",\n  \"deface\",\n  \"defacing\",\n  \"defame\",\n  \"default\",\n  \"defeat\",\n  \"defection\",\n  \"defective\",\n  \"defendant\",\n  \"defender\",\n  \"defense\",\n  \"defensive\",\n  \"deferral\",\n  \"deferred\",\n  \"defiance\",\n  \"defiant\",\n  \"defile\",\n  \"defiling\",\n  \"define\",\n  \"definite\",\n  \"deflate\",\n  \"deflation\",\n  \"deflator\",\n  \"deflected\",\n  \"deflector\",\n  \"defog\",\n  \"deforest\",\n  \"defraud\",\n  \"defrost\",\n  \"deftly\",\n  \"defuse\",\n  \"defy\",\n  \"degraded\",\n  \"degrading\",\n  \"degrease\",\n  \"degree\",\n  \"dehydrate\",\n  \"deity\",\n  \"dejected\",\n  \"delay\",\n  \"delegate\",\n  \"delegator\",\n  \"delete\",\n  \"deletion\",\n  \"delicacy\",\n  \"delicate\",\n  \"delicious\",\n  \"delighted\",\n  \"delirious\",\n  \"delirium\",\n  \"deliverer\",\n  \"delivery\",\n  \"delouse\",\n  \"delta\",\n  \"deluge\",\n  \"delusion\",\n  \"deluxe\",\n  \"demanding\",\n  \"demeaning\",\n  \"demeanor\",\n  \"demise\",\n  \"democracy\",\n  \"democrat\",\n  \"demote\",\n  \"demotion\",\n  \"demystify\",\n  \"denatured\",\n  \"deniable\",\n  \"denial\",\n  \"denim\",\n  \"denote\",\n  \"dense\",\n  \"density\",\n  \"dental\",\n  \"dentist\",\n  \"denture\",\n  \"deny\",\n  \"deodorant\",\n  \"deodorize\",\n  \"departed\",\n  \"departure\",\n  \"depict\",\n  \"deplete\",\n  \"depletion\",\n  \"deplored\",\n  \"deploy\",\n  \"deport\",\n  \"depose\",\n  \"depraved\",\n  \"depravity\",\n  \"deprecate\",\n  \"depress\",\n  \"deprive\",\n  \"depth\",\n  \"deputize\",\n  \"deputy\",\n  \"derail\",\n  \"deranged\",\n  \"derby\",\n  \"derived\",\n  \"desecrate\",\n  \"deserve\",\n  \"deserving\",\n  \"designate\",\n  \"designed\",\n  \"designer\",\n  \"designing\",\n  \"deskbound\",\n  \"desktop\",\n  \"deskwork\",\n  \"desolate\",\n  \"despair\",\n  \"despise\",\n  \"despite\",\n  \"destiny\",\n  \"destitute\",\n  \"destruct\",\n  \"detached\",\n  \"detail\",\n  \"detection\",\n  \"detective\",\n  \"detector\",\n  \"detention\",\n  \"detergent\",\n  \"detest\",\n  \"detonate\",\n  \"detonator\",\n  \"detoxify\",\n  \"detract\",\n  \"deuce\",\n  \"devalue\",\n  \"deviancy\",\n  \"deviant\",\n  \"deviate\",\n  \"deviation\",\n  \"deviator\",\n  \"device\",\n  \"devious\",\n  \"devotedly\",\n  \"devotee\",\n  \"devotion\",\n  \"devourer\",\n  \"devouring\",\n  \"devoutly\",\n  \"dexterity\",\n  \"dexterous\",\n  \"diabetes\",\n  \"diabetic\",\n  \"diabolic\",\n  \"diagnoses\",\n  \"diagnosis\",\n  \"diagram\",\n  \"dial\",\n  \"diameter\",\n  \"diaper\",\n  \"diaphragm\",\n  \"diary\",\n  \"dice\",\n  \"dicing\",\n  \"dictate\",\n  \"dictation\",\n  \"dictator\",\n  \"difficult\",\n  \"diffused\",\n  \"diffuser\",\n  \"diffusion\",\n  \"diffusive\",\n  \"dig\",\n  \"dilation\",\n  \"diligence\",\n  \"diligent\",\n  \"dill\",\n  \"dilute\",\n  \"dime\",\n  \"diminish\",\n  \"dimly\",\n  \"dimmed\",\n  \"dimmer\",\n  \"dimness\",\n  \"dimple\",\n  \"diner\",\n  \"dingbat\",\n  \"dinghy\",\n  \"dinginess\",\n  \"dingo\",\n  \"dingy\",\n  \"dining\",\n  \"dinner\",\n  \"diocese\",\n  \"dioxide\",\n  \"diploma\",\n  \"dipped\",\n  \"dipper\",\n  \"dipping\",\n  \"directed\",\n  \"direction\",\n  \"directive\",\n  \"directly\",\n  \"directory\",\n  \"direness\",\n  \"dirtiness\",\n  \"disabled\",\n  \"disagree\",\n  \"disallow\",\n  \"disarm\",\n  \"disarray\",\n  \"disaster\",\n  \"disband\",\n  \"disbelief\",\n  \"disburse\",\n  \"discard\",\n  \"discern\",\n  \"discharge\",\n  \"disclose\",\n  \"discolor\",\n  \"discount\",\n  \"discourse\",\n  \"discover\",\n  \"discuss\",\n  \"disdain\",\n  \"disengage\",\n  \"disfigure\",\n  \"disgrace\",\n  \"dish\",\n  \"disinfect\",\n  \"disjoin\",\n  \"disk\",\n  \"dislike\",\n  \"disliking\",\n  \"dislocate\",\n  \"dislodge\",\n  \"disloyal\",\n  \"dismantle\",\n  \"dismay\",\n  \"dismiss\",\n  \"dismount\",\n  \"disobey\",\n  \"disorder\",\n  \"disown\",\n  \"disparate\",\n  \"disparity\",\n  \"dispatch\",\n  \"dispense\",\n  \"dispersal\",\n  \"dispersed\",\n  \"disperser\",\n  \"displace\",\n  \"display\",\n  \"displease\",\n  \"disposal\",\n  \"dispose\",\n  \"disprove\",\n  \"dispute\",\n  \"disregard\",\n  \"disrupt\",\n  \"dissuade\",\n  \"distance\",\n  \"distant\",\n  \"distaste\",\n  \"distill\",\n  \"distinct\",\n  \"distort\",\n  \"distract\",\n  \"distress\",\n  \"district\",\n  \"distrust\",\n  \"ditch\",\n  \"ditto\",\n  \"ditzy\",\n  \"dividable\",\n  \"divided\",\n  \"dividend\",\n  \"dividers\",\n  \"dividing\",\n  \"divinely\",\n  \"diving\",\n  \"divinity\",\n  \"divisible\",\n  \"divisibly\",\n  \"division\",\n  \"divisive\",\n  \"divorcee\",\n  \"dizziness\",\n  \"dizzy\",\n  \"doable\",\n  \"docile\",\n  \"dock\",\n  \"doctrine\",\n  \"document\",\n  \"dodge\",\n  \"dodgy\",\n  \"doily\",\n  \"doing\",\n  \"dole\",\n  \"dollar\",\n  \"dollhouse\",\n  \"dollop\",\n  \"dolly\",\n  \"dolphin\",\n  \"domain\",\n  \"domelike\",\n  \"domestic\",\n  \"dominion\",\n  \"dominoes\",\n  \"donated\",\n  \"donation\",\n  \"donator\",\n  \"donor\",\n  \"donut\",\n  \"doodle\",\n  \"doorbell\",\n  \"doorframe\",\n  \"doorknob\",\n  \"doorman\",\n  \"doormat\",\n  \"doornail\",\n  \"doorpost\",\n  \"doorstep\",\n  \"doorstop\",\n  \"doorway\",\n  \"doozy\",\n  \"dork\",\n  \"dormitory\",\n  \"dorsal\",\n  \"dosage\",\n  \"dose\",\n  \"dotted\",\n  \"doubling\",\n  \"douche\",\n  \"dove\",\n  \"down\",\n  \"dowry\",\n  \"doze\",\n  \"drab\",\n  \"dragging\",\n  \"dragonfly\",\n  \"dragonish\",\n  \"dragster\",\n  \"drainable\",\n  \"drainage\",\n  \"drained\",\n  \"drainer\",\n  \"drainpipe\",\n  \"dramatic\",\n  \"dramatize\",\n  \"drank\",\n  \"drapery\",\n  \"drastic\",\n  \"draw\",\n  \"dreaded\",\n  \"dreadful\",\n  \"dreadlock\",\n  \"dreamboat\",\n  \"dreamily\",\n  \"dreamland\",\n  \"dreamless\",\n  \"dreamlike\",\n  \"dreamt\",\n  \"dreamy\",\n  \"drearily\",\n  \"dreary\",\n  \"drench\",\n  \"dress\",\n  \"drew\",\n  \"dribble\",\n  \"dried\",\n  \"drier\",\n  \"drift\",\n  \"driller\",\n  \"drilling\",\n  \"drinkable\",\n  \"drinking\",\n  \"dripping\",\n  \"drippy\",\n  \"drivable\",\n  \"driven\",\n  \"driver\",\n  \"driveway\",\n  \"driving\",\n  \"drizzle\",\n  \"drizzly\",\n  \"drone\",\n  \"drool\",\n  \"droop\",\n  \"drop-down\",\n  \"dropbox\",\n  \"dropkick\",\n  \"droplet\",\n  \"dropout\",\n  \"dropper\",\n  \"drove\",\n  \"drown\",\n  \"drowsily\",\n  \"drudge\",\n  \"drum\",\n  \"dry\",\n  \"dubbed\",\n  \"dubiously\",\n  \"duchess\",\n  \"duckbill\",\n  \"ducking\",\n  \"duckling\",\n  \"ducktail\",\n  \"ducky\",\n  \"duct\",\n  \"dude\",\n  \"duffel\",\n  \"dugout\",\n  \"duh\",\n  \"duke\",\n  \"duller\",\n  \"dullness\",\n  \"duly\",\n  \"dumping\",\n  \"dumpling\",\n  \"dumpster\",\n  \"duo\",\n  \"dupe\",\n  \"duplex\",\n  \"duplicate\",\n  \"duplicity\",\n  \"durable\",\n  \"durably\",\n  \"duration\",\n  \"duress\",\n  \"during\",\n  \"dusk\",\n  \"dust\",\n  \"dutiful\",\n  \"duty\",\n  \"duvet\",\n  \"dwarf\",\n  \"dweeb\",\n  \"dwelled\",\n  \"dweller\",\n  \"dwelling\",\n  \"dwindle\",\n  \"dwindling\",\n  \"dynamic\",\n  \"dynamite\",\n  \"dynasty\",\n  \"dyslexia\",\n  \"dyslexic\",\n  \"each\",\n  \"eagle\",\n  \"earache\",\n  \"eardrum\",\n  \"earflap\",\n  \"earful\",\n  \"earlobe\",\n  \"early\",\n  \"earmark\",\n  \"earmuff\",\n  \"earphone\",\n  \"earpiece\",\n  \"earplugs\",\n  \"earring\",\n  \"earshot\",\n  \"earthen\",\n  \"earthlike\",\n  \"earthling\",\n  \"earthly\",\n  \"earthworm\",\n  \"earthy\",\n  \"earwig\",\n  \"easeful\",\n  \"easel\",\n  \"easiest\",\n  \"easily\",\n  \"easiness\",\n  \"easing\",\n  \"eastbound\",\n  \"eastcoast\",\n  \"easter\",\n  \"eastward\",\n  \"eatable\",\n  \"eaten\",\n  \"eatery\",\n  \"eating\",\n  \"eats\",\n  \"ebay\",\n  \"ebony\",\n  \"ebook\",\n  \"ecard\",\n  \"eccentric\",\n  \"echo\",\n  \"eclair\",\n  \"eclipse\",\n  \"ecologist\",\n  \"ecology\",\n  \"economic\",\n  \"economist\",\n  \"economy\",\n  \"ecosphere\",\n  \"ecosystem\",\n  \"edge\",\n  \"edginess\",\n  \"edging\",\n  \"edgy\",\n  \"edition\",\n  \"editor\",\n  \"educated\",\n  \"education\",\n  \"educator\",\n  \"eel\",\n  \"effective\",\n  \"effects\",\n  \"efficient\",\n  \"effort\",\n  \"eggbeater\",\n  \"egging\",\n  \"eggnog\",\n  \"eggplant\",\n  \"eggshell\",\n  \"egomaniac\",\n  \"egotism\",\n  \"egotistic\",\n  \"either\",\n  \"eject\",\n  \"elaborate\",\n  \"elastic\",\n  \"elated\",\n  \"elbow\",\n  \"eldercare\",\n  \"elderly\",\n  \"eldest\",\n  \"electable\",\n  \"election\",\n  \"elective\",\n  \"elephant\",\n  \"elevate\",\n  \"elevating\",\n  \"elevation\",\n  \"elevator\",\n  \"eleven\",\n  \"elf\",\n  \"eligible\",\n  \"eligibly\",\n  \"eliminate\",\n  \"elite\",\n  \"elitism\",\n  \"elixir\",\n  \"elk\",\n  \"ellipse\",\n  \"elliptic\",\n  \"elm\",\n  \"elongated\",\n  \"elope\",\n  \"eloquence\",\n  \"eloquent\",\n  \"elsewhere\",\n  \"elude\",\n  \"elusive\",\n  \"elves\",\n  \"email\",\n  \"embargo\",\n  \"embark\",\n  \"embassy\",\n  \"embattled\",\n  \"embellish\",\n  \"ember\",\n  \"embezzle\",\n  \"emblaze\",\n  \"emblem\",\n  \"embody\",\n  \"embolism\",\n  \"emboss\",\n  \"embroider\",\n  \"emcee\",\n  \"emerald\",\n  \"emergency\",\n  \"emission\",\n  \"emit\",\n  \"emote\",\n  \"emoticon\",\n  \"emotion\",\n  \"empathic\",\n  \"empathy\",\n  \"emperor\",\n  \"emphases\",\n  \"emphasis\",\n  \"emphasize\",\n  \"emphatic\",\n  \"empirical\",\n  \"employed\",\n  \"employee\",\n  \"employer\",\n  \"emporium\",\n  \"empower\",\n  \"emptier\",\n  \"emptiness\",\n  \"empty\",\n  \"emu\",\n  \"enable\",\n  \"enactment\",\n  \"enamel\",\n  \"enchanted\",\n  \"enchilada\",\n  \"encircle\",\n  \"enclose\",\n  \"enclosure\",\n  \"encode\",\n  \"encore\",\n  \"encounter\",\n  \"encourage\",\n  \"encroach\",\n  \"encrust\",\n  \"encrypt\",\n  \"endanger\",\n  \"endeared\",\n  \"endearing\",\n  \"ended\",\n  \"ending\",\n  \"endless\",\n  \"endnote\",\n  \"endocrine\",\n  \"endorphin\",\n  \"endorse\",\n  \"endowment\",\n  \"endpoint\",\n  \"endurable\",\n  \"endurance\",\n  \"enduring\",\n  \"energetic\",\n  \"energize\",\n  \"energy\",\n  \"enforced\",\n  \"enforcer\",\n  \"engaged\",\n  \"engaging\",\n  \"engine\",\n  \"engorge\",\n  \"engraved\",\n  \"engraver\",\n  \"engraving\",\n  \"engross\",\n  \"engulf\",\n  \"enhance\",\n  \"enigmatic\",\n  \"enjoyable\",\n  \"enjoyably\",\n  \"enjoyer\",\n  \"enjoying\",\n  \"enjoyment\",\n  \"enlarged\",\n  \"enlarging\",\n  \"enlighten\",\n  \"enlisted\",\n  \"enquirer\",\n  \"enrage\",\n  \"enrich\",\n  \"enroll\",\n  \"enslave\",\n  \"ensnare\",\n  \"ensure\",\n  \"entail\",\n  \"entangled\",\n  \"entering\",\n  \"entertain\",\n  \"enticing\",\n  \"entire\",\n  \"entitle\",\n  \"entity\",\n  \"entomb\",\n  \"entourage\",\n  \"entrap\",\n  \"entree\",\n  \"entrench\",\n  \"entrust\",\n  \"entryway\",\n  \"entwine\",\n  \"enunciate\",\n  \"envelope\",\n  \"enviable\",\n  \"enviably\",\n  \"envious\",\n  \"envision\",\n  \"envoy\",\n  \"envy\",\n  \"enzyme\",\n  \"epic\",\n  \"epidemic\",\n  \"epidermal\",\n  \"epidermis\",\n  \"epidural\",\n  \"epilepsy\",\n  \"epileptic\",\n  \"epilogue\",\n  \"epiphany\",\n  \"episode\",\n  \"equal\",\n  \"equate\",\n  \"equation\",\n  \"equator\",\n  \"equinox\",\n  \"equipment\",\n  \"equity\",\n  \"equivocal\",\n  \"eradicate\",\n  \"erasable\",\n  \"erased\",\n  \"eraser\",\n  \"erasure\",\n  \"ergonomic\",\n  \"errand\",\n  \"errant\",\n  \"erratic\",\n  \"error\",\n  \"erupt\",\n  \"escalate\",\n  \"escalator\",\n  \"escapable\",\n  \"escapade\",\n  \"escapist\",\n  \"escargot\",\n  \"eskimo\",\n  \"esophagus\",\n  \"espionage\",\n  \"espresso\",\n  \"esquire\",\n  \"essay\",\n  \"essence\",\n  \"essential\",\n  \"establish\",\n  \"estate\",\n  \"esteemed\",\n  \"estimate\",\n  \"estimator\",\n  \"estranged\",\n  \"estrogen\",\n  \"etching\",\n  \"eternal\",\n  \"eternity\",\n  \"ethanol\",\n  \"ether\",\n  \"ethically\",\n  \"ethics\",\n  \"euphemism\",\n  \"evacuate\",\n  \"evacuee\",\n  \"evade\",\n  \"evaluate\",\n  \"evaluator\",\n  \"evaporate\",\n  \"evasion\",\n  \"evasive\",\n  \"even\",\n  \"everglade\",\n  \"evergreen\",\n  \"everybody\",\n  \"everyday\",\n  \"everyone\",\n  \"evict\",\n  \"evidence\",\n  \"evident\",\n  \"evil\",\n  \"evoke\",\n  \"evolution\",\n  \"evolve\",\n  \"exact\",\n  \"exalted\",\n  \"example\",\n  \"excavate\",\n  \"excavator\",\n  \"exceeding\",\n  \"exception\",\n  \"excess\",\n  \"exchange\",\n  \"excitable\",\n  \"exciting\",\n  \"exclaim\",\n  \"exclude\",\n  \"excluding\",\n  \"exclusion\",\n  \"exclusive\",\n  \"excretion\",\n  \"excretory\",\n  \"excursion\",\n  \"excusable\",\n  \"excusably\",\n  \"excuse\",\n  \"exemplary\",\n  \"exemplify\",\n  \"exemption\",\n  \"exerciser\",\n  \"exert\",\n  \"exes\",\n  \"exfoliate\",\n  \"exhale\",\n  \"exhaust\",\n  \"exhume\",\n  \"exile\",\n  \"existing\",\n  \"exit\",\n  \"exodus\",\n  \"exonerate\",\n  \"exorcism\",\n  \"exorcist\",\n  \"expand\",\n  \"expanse\",\n  \"expansion\",\n  \"expansive\",\n  \"expectant\",\n  \"expedited\",\n  \"expediter\",\n  \"expel\",\n  \"expend\",\n  \"expenses\",\n  \"expensive\",\n  \"expert\",\n  \"expire\",\n  \"expiring\",\n  \"explain\",\n  \"expletive\",\n  \"explicit\",\n  \"explode\",\n  \"exploit\",\n  \"explore\",\n  \"exploring\",\n  \"exponent\",\n  \"exporter\",\n  \"exposable\",\n  \"expose\",\n  \"exposure\",\n  \"express\",\n  \"expulsion\",\n  \"exquisite\",\n  \"extended\",\n  \"extending\",\n  \"extent\",\n  \"extenuate\",\n  \"exterior\",\n  \"external\",\n  \"extinct\",\n  \"extortion\",\n  \"extradite\",\n  \"extras\",\n  \"extrovert\",\n  \"extrude\",\n  \"extruding\",\n  \"exuberant\",\n  \"fable\",\n  \"fabric\",\n  \"fabulous\",\n  \"facebook\",\n  \"facecloth\",\n  \"facedown\",\n  \"faceless\",\n  \"facelift\",\n  \"faceplate\",\n  \"faceted\",\n  \"facial\",\n  \"facility\",\n  \"facing\",\n  \"facsimile\",\n  \"faction\",\n  \"factoid\",\n  \"factor\",\n  \"factsheet\",\n  \"factual\",\n  \"faculty\",\n  \"fade\",\n  \"fading\",\n  \"failing\",\n  \"falcon\",\n  \"fall\",\n  \"false\",\n  \"falsify\",\n  \"fame\",\n  \"familiar\",\n  \"family\",\n  \"famine\",\n  \"famished\",\n  \"fanatic\",\n  \"fancied\",\n  \"fanciness\",\n  \"fancy\",\n  \"fanfare\",\n  \"fang\",\n  \"fanning\",\n  \"fantasize\",\n  \"fantastic\",\n  \"fantasy\",\n  \"fascism\",\n  \"fastball\",\n  \"faster\",\n  \"fasting\",\n  \"fastness\",\n  \"faucet\",\n  \"favorable\",\n  \"favorably\",\n  \"favored\",\n  \"favoring\",\n  \"favorite\",\n  \"fax\",\n  \"feast\",\n  \"federal\",\n  \"fedora\",\n  \"feeble\",\n  \"feed\",\n  \"feel\",\n  \"feisty\",\n  \"feline\",\n  \"felt-tip\",\n  \"feminine\",\n  \"feminism\",\n  \"feminist\",\n  \"feminize\",\n  \"femur\",\n  \"fence\",\n  \"fencing\",\n  \"fender\",\n  \"ferment\",\n  \"fernlike\",\n  \"ferocious\",\n  \"ferocity\",\n  \"ferret\",\n  \"ferris\",\n  \"ferry\",\n  \"fervor\",\n  \"fester\",\n  \"festival\",\n  \"festive\",\n  \"festivity\",\n  \"fetal\",\n  \"fetch\",\n  \"fever\",\n  \"fiber\",\n  \"fiction\",\n  \"fiddle\",\n  \"fiddling\",\n  \"fidelity\",\n  \"fidgeting\",\n  \"fidgety\",\n  \"fifteen\",\n  \"fifth\",\n  \"fiftieth\",\n  \"fifty\",\n  \"figment\",\n  \"figure\",\n  \"figurine\",\n  \"filing\",\n  \"filled\",\n  \"filler\",\n  \"filling\",\n  \"film\",\n  \"filter\",\n  \"filth\",\n  \"filtrate\",\n  \"finale\",\n  \"finalist\",\n  \"finalize\",\n  \"finally\",\n  \"finance\",\n  \"financial\",\n  \"finch\",\n  \"fineness\",\n  \"finer\",\n  \"finicky\",\n  \"finished\",\n  \"finisher\",\n  \"finishing\",\n  \"finite\",\n  \"finless\",\n  \"finlike\",\n  \"fiscally\",\n  \"fit\",\n  \"five\",\n  \"flaccid\",\n  \"flagman\",\n  \"flagpole\",\n  \"flagship\",\n  \"flagstick\",\n  \"flagstone\",\n  \"flail\",\n  \"flakily\",\n  \"flaky\",\n  \"flame\",\n  \"flammable\",\n  \"flanked\",\n  \"flanking\",\n  \"flannels\",\n  \"flap\",\n  \"flaring\",\n  \"flashback\",\n  \"flashbulb\",\n  \"flashcard\",\n  \"flashily\",\n  \"flashing\",\n  \"flashy\",\n  \"flask\",\n  \"flatbed\",\n  \"flatfoot\",\n  \"flatly\",\n  \"flatness\",\n  \"flatten\",\n  \"flattered\",\n  \"flatterer\",\n  \"flattery\",\n  \"flattop\",\n  \"flatware\",\n  \"flatworm\",\n  \"flavored\",\n  \"flavorful\",\n  \"flavoring\",\n  \"flaxseed\",\n  \"fled\",\n  \"fleshed\",\n  \"fleshy\",\n  \"flick\",\n  \"flier\",\n  \"flight\",\n  \"flinch\",\n  \"fling\",\n  \"flint\",\n  \"flip\",\n  \"flirt\",\n  \"float\",\n  \"flock\",\n  \"flogging\",\n  \"flop\",\n  \"floral\",\n  \"florist\",\n  \"floss\",\n  \"flounder\",\n  \"flyable\",\n  \"flyaway\",\n  \"flyer\",\n  \"flying\",\n  \"flyover\",\n  \"flypaper\",\n  \"foam\",\n  \"foe\",\n  \"fog\",\n  \"foil\",\n  \"folic\",\n  \"folk\",\n  \"follicle\",\n  \"follow\",\n  \"fondling\",\n  \"fondly\",\n  \"fondness\",\n  \"fondue\",\n  \"font\",\n  \"food\",\n  \"fool\",\n  \"footage\",\n  \"football\",\n  \"footbath\",\n  \"footboard\",\n  \"footer\",\n  \"footgear\",\n  \"foothill\",\n  \"foothold\",\n  \"footing\",\n  \"footless\",\n  \"footman\",\n  \"footnote\",\n  \"footpad\",\n  \"footpath\",\n  \"footprint\",\n  \"footrest\",\n  \"footsie\",\n  \"footsore\",\n  \"footwear\",\n  \"footwork\",\n  \"fossil\",\n  \"foster\",\n  \"founder\",\n  \"founding\",\n  \"fountain\",\n  \"fox\",\n  \"foyer\",\n  \"fraction\",\n  \"fracture\",\n  \"fragile\",\n  \"fragility\",\n  \"fragment\",\n  \"fragrance\",\n  \"fragrant\",\n  \"frail\",\n  \"frame\",\n  \"framing\",\n  \"frantic\",\n  \"fraternal\",\n  \"frayed\",\n  \"fraying\",\n  \"frays\",\n  \"freckled\",\n  \"freckles\",\n  \"freebase\",\n  \"freebee\",\n  \"freebie\",\n  \"freedom\",\n  \"freefall\",\n  \"freehand\",\n  \"freeing\",\n  \"freeload\",\n  \"freely\",\n  \"freemason\",\n  \"freeness\",\n  \"freestyle\",\n  \"freeware\",\n  \"freeway\",\n  \"freewill\",\n  \"freezable\",\n  \"freezing\",\n  \"freight\",\n  \"french\",\n  \"frenzied\",\n  \"frenzy\",\n  \"frequency\",\n  \"frequent\",\n  \"fresh\",\n  \"fretful\",\n  \"fretted\",\n  \"friction\",\n  \"friday\",\n  \"fridge\",\n  \"fried\",\n  \"friend\",\n  \"frighten\",\n  \"frightful\",\n  \"frigidity\",\n  \"frigidly\",\n  \"frill\",\n  \"fringe\",\n  \"frisbee\",\n  \"frisk\",\n  \"fritter\",\n  \"frivolous\",\n  \"frolic\",\n  \"from\",\n  \"front\",\n  \"frostbite\",\n  \"frosted\",\n  \"frostily\",\n  \"frosting\",\n  \"frostlike\",\n  \"frosty\",\n  \"froth\",\n  \"frown\",\n  \"frozen\",\n  \"fructose\",\n  \"frugality\",\n  \"frugally\",\n  \"fruit\",\n  \"frustrate\",\n  \"frying\",\n  \"gab\",\n  \"gaffe\",\n  \"gag\",\n  \"gainfully\",\n  \"gaining\",\n  \"gains\",\n  \"gala\",\n  \"gallantly\",\n  \"galleria\",\n  \"gallery\",\n  \"galley\",\n  \"gallon\",\n  \"gallows\",\n  \"gallstone\",\n  \"galore\",\n  \"galvanize\",\n  \"gambling\",\n  \"game\",\n  \"gaming\",\n  \"gamma\",\n  \"gander\",\n  \"gangly\",\n  \"gangrene\",\n  \"gangway\",\n  \"gap\",\n  \"garage\",\n  \"garbage\",\n  \"garden\",\n  \"gargle\",\n  \"garland\",\n  \"garlic\",\n  \"garment\",\n  \"garnet\",\n  \"garnish\",\n  \"garter\",\n  \"gas\",\n  \"gatherer\",\n  \"gathering\",\n  \"gating\",\n  \"gauging\",\n  \"gauntlet\",\n  \"gauze\",\n  \"gave\",\n  \"gawk\",\n  \"gazing\",\n  \"gear\",\n  \"gecko\",\n  \"geek\",\n  \"geiger\",\n  \"gem\",\n  \"gender\",\n  \"generic\",\n  \"generous\",\n  \"genetics\",\n  \"genre\",\n  \"gentile\",\n  \"gentleman\",\n  \"gently\",\n  \"gents\",\n  \"geography\",\n  \"geologic\",\n  \"geologist\",\n  \"geology\",\n  \"geometric\",\n  \"geometry\",\n  \"geranium\",\n  \"gerbil\",\n  \"geriatric\",\n  \"germicide\",\n  \"germinate\",\n  \"germless\",\n  \"germproof\",\n  \"gestate\",\n  \"gestation\",\n  \"gesture\",\n  \"getaway\",\n  \"getting\",\n  \"getup\",\n  \"giant\",\n  \"gibberish\",\n  \"giblet\",\n  \"giddily\",\n  \"giddiness\",\n  \"giddy\",\n  \"gift\",\n  \"gigabyte\",\n  \"gigahertz\",\n  \"gigantic\",\n  \"giggle\",\n  \"giggling\",\n  \"giggly\",\n  \"gigolo\",\n  \"gilled\",\n  \"gills\",\n  \"gimmick\",\n  \"girdle\",\n  \"giveaway\",\n  \"given\",\n  \"giver\",\n  \"giving\",\n  \"gizmo\",\n  \"gizzard\",\n  \"glacial\",\n  \"glacier\",\n  \"glade\",\n  \"gladiator\",\n  \"gladly\",\n  \"glamorous\",\n  \"glamour\",\n  \"glance\",\n  \"glancing\",\n  \"glandular\",\n  \"glare\",\n  \"glaring\",\n  \"glass\",\n  \"glaucoma\",\n  \"glazing\",\n  \"gleaming\",\n  \"gleeful\",\n  \"glider\",\n  \"gliding\",\n  \"glimmer\",\n  \"glimpse\",\n  \"glisten\",\n  \"glitch\",\n  \"glitter\",\n  \"glitzy\",\n  \"gloater\",\n  \"gloating\",\n  \"gloomily\",\n  \"gloomy\",\n  \"glorified\",\n  \"glorifier\",\n  \"glorify\",\n  \"glorious\",\n  \"glory\",\n  \"gloss\",\n  \"glove\",\n  \"glowing\",\n  \"glowworm\",\n  \"glucose\",\n  \"glue\",\n  \"gluten\",\n  \"glutinous\",\n  \"glutton\",\n  \"gnarly\",\n  \"gnat\",\n  \"goal\",\n  \"goatskin\",\n  \"goes\",\n  \"goggles\",\n  \"going\",\n  \"goldfish\",\n  \"goldmine\",\n  \"goldsmith\",\n  \"golf\",\n  \"goliath\",\n  \"gonad\",\n  \"gondola\",\n  \"gone\",\n  \"gong\",\n  \"good\",\n  \"gooey\",\n  \"goofball\",\n  \"goofiness\",\n  \"goofy\",\n  \"google\",\n  \"goon\",\n  \"gopher\",\n  \"gore\",\n  \"gorged\",\n  \"gorgeous\",\n  \"gory\",\n  \"gosling\",\n  \"gossip\",\n  \"gothic\",\n  \"gotten\",\n  \"gout\",\n  \"gown\",\n  \"grab\",\n  \"graceful\",\n  \"graceless\",\n  \"gracious\",\n  \"gradation\",\n  \"graded\",\n  \"grader\",\n  \"gradient\",\n  \"grading\",\n  \"gradually\",\n  \"graduate\",\n  \"graffiti\",\n  \"grafted\",\n  \"grafting\",\n  \"grain\",\n  \"granddad\",\n  \"grandkid\",\n  \"grandly\",\n  \"grandma\",\n  \"grandpa\",\n  \"grandson\",\n  \"granite\",\n  \"granny\",\n  \"granola\",\n  \"grant\",\n  \"granular\",\n  \"grape\",\n  \"graph\",\n  \"grapple\",\n  \"grappling\",\n  \"grasp\",\n  \"grass\",\n  \"gratified\",\n  \"gratify\",\n  \"grating\",\n  \"gratitude\",\n  \"gratuity\",\n  \"gravel\",\n  \"graveness\",\n  \"graves\",\n  \"graveyard\",\n  \"gravitate\",\n  \"gravity\",\n  \"gravy\",\n  \"gray\",\n  \"grazing\",\n  \"greasily\",\n  \"greedily\",\n  \"greedless\",\n  \"greedy\",\n  \"green\",\n  \"greeter\",\n  \"greeting\",\n  \"grew\",\n  \"greyhound\",\n  \"grid\",\n  \"grief\",\n  \"grievance\",\n  \"grieving\",\n  \"grievous\",\n  \"grill\",\n  \"grimace\",\n  \"grimacing\",\n  \"grime\",\n  \"griminess\",\n  \"grimy\",\n  \"grinch\",\n  \"grinning\",\n  \"grip\",\n  \"gristle\",\n  \"grit\",\n  \"groggily\",\n  \"groggy\",\n  \"groin\",\n  \"groom\",\n  \"groove\",\n  \"grooving\",\n  \"groovy\",\n  \"grope\",\n  \"ground\",\n  \"grouped\",\n  \"grout\",\n  \"grove\",\n  \"grower\",\n  \"growing\",\n  \"growl\",\n  \"grub\",\n  \"grudge\",\n  \"grudging\",\n  \"grueling\",\n  \"gruffly\",\n  \"grumble\",\n  \"grumbling\",\n  \"grumbly\",\n  \"grumpily\",\n  \"grunge\",\n  \"grunt\",\n  \"guacamole\",\n  \"guidable\",\n  \"guidance\",\n  \"guide\",\n  \"guiding\",\n  \"guileless\",\n  \"guise\",\n  \"gulf\",\n  \"gullible\",\n  \"gully\",\n  \"gulp\",\n  \"gumball\",\n  \"gumdrop\",\n  \"gumminess\",\n  \"gumming\",\n  \"gummy\",\n  \"gurgle\",\n  \"gurgling\",\n  \"guru\",\n  \"gush\",\n  \"gusto\",\n  \"gusty\",\n  \"gutless\",\n  \"guts\",\n  \"gutter\",\n  \"guy\",\n  \"guzzler\",\n  \"gyration\",\n  \"habitable\",\n  \"habitant\",\n  \"habitat\",\n  \"habitual\",\n  \"hacked\",\n  \"hacker\",\n  \"hacking\",\n  \"hacksaw\",\n  \"had\",\n  \"haggler\",\n  \"haiku\",\n  \"half\",\n  \"halogen\",\n  \"halt\",\n  \"halved\",\n  \"halves\",\n  \"hamburger\",\n  \"hamlet\",\n  \"hammock\",\n  \"hamper\",\n  \"hamster\",\n  \"hamstring\",\n  \"handbag\",\n  \"handball\",\n  \"handbook\",\n  \"handbrake\",\n  \"handcart\",\n  \"handclap\",\n  \"handclasp\",\n  \"handcraft\",\n  \"handcuff\",\n  \"handed\",\n  \"handful\",\n  \"handgrip\",\n  \"handgun\",\n  \"handheld\",\n  \"handiness\",\n  \"handiwork\",\n  \"handlebar\",\n  \"handled\",\n  \"handler\",\n  \"handling\",\n  \"handmade\",\n  \"handoff\",\n  \"handpick\",\n  \"handprint\",\n  \"handrail\",\n  \"handsaw\",\n  \"handset\",\n  \"handsfree\",\n  \"handshake\",\n  \"handstand\",\n  \"handwash\",\n  \"handwork\",\n  \"handwoven\",\n  \"handwrite\",\n  \"handyman\",\n  \"hangnail\",\n  \"hangout\",\n  \"hangover\",\n  \"hangup\",\n  \"hankering\",\n  \"hankie\",\n  \"hanky\",\n  \"haphazard\",\n  \"happening\",\n  \"happier\",\n  \"happiest\",\n  \"happily\",\n  \"happiness\",\n  \"happy\",\n  \"harbor\",\n  \"hardcopy\",\n  \"hardcore\",\n  \"hardcover\",\n  \"harddisk\",\n  \"hardened\",\n  \"hardener\",\n  \"hardening\",\n  \"hardhat\",\n  \"hardhead\",\n  \"hardiness\",\n  \"hardly\",\n  \"hardness\",\n  \"hardship\",\n  \"hardware\",\n  \"hardwired\",\n  \"hardwood\",\n  \"hardy\",\n  \"harmful\",\n  \"harmless\",\n  \"harmonica\",\n  \"harmonics\",\n  \"harmonize\",\n  \"harmony\",\n  \"harness\",\n  \"harpist\",\n  \"harsh\",\n  \"harvest\",\n  \"hash\",\n  \"hassle\",\n  \"haste\",\n  \"hastily\",\n  \"hastiness\",\n  \"hasty\",\n  \"hatbox\",\n  \"hatchback\",\n  \"hatchery\",\n  \"hatchet\",\n  \"hatching\",\n  \"hatchling\",\n  \"hate\",\n  \"hatless\",\n  \"hatred\",\n  \"haunt\",\n  \"haven\",\n  \"hazard\",\n  \"hazelnut\",\n  \"hazily\",\n  \"haziness\",\n  \"hazing\",\n  \"hazy\",\n  \"headache\",\n  \"headband\",\n  \"headboard\",\n  \"headcount\",\n  \"headdress\",\n  \"headed\",\n  \"header\",\n  \"headfirst\",\n  \"headgear\",\n  \"heading\",\n  \"headlamp\",\n  \"headless\",\n  \"headlock\",\n  \"headphone\",\n  \"headpiece\",\n  \"headrest\",\n  \"headroom\",\n  \"headscarf\",\n  \"headset\",\n  \"headsman\",\n  \"headstand\",\n  \"headstone\",\n  \"headway\",\n  \"headwear\",\n  \"heap\",\n  \"heat\",\n  \"heave\",\n  \"heavily\",\n  \"heaviness\",\n  \"heaving\",\n  \"hedge\",\n  \"hedging\",\n  \"heftiness\",\n  \"hefty\",\n  \"helium\",\n  \"helmet\",\n  \"helper\",\n  \"helpful\",\n  \"helping\",\n  \"helpless\",\n  \"helpline\",\n  \"hemlock\",\n  \"hemstitch\",\n  \"hence\",\n  \"henchman\",\n  \"henna\",\n  \"herald\",\n  \"herbal\",\n  \"herbicide\",\n  \"herbs\",\n  \"heritage\",\n  \"hermit\",\n  \"heroics\",\n  \"heroism\",\n  \"herring\",\n  \"herself\",\n  \"hertz\",\n  \"hesitancy\",\n  \"hesitant\",\n  \"hesitate\",\n  \"hexagon\",\n  \"hexagram\",\n  \"hubcap\",\n  \"huddle\",\n  \"huddling\",\n  \"huff\",\n  \"hug\",\n  \"hula\",\n  \"hulk\",\n  \"hull\",\n  \"human\",\n  \"humble\",\n  \"humbling\",\n  \"humbly\",\n  \"humid\",\n  \"humiliate\",\n  \"humility\",\n  \"humming\",\n  \"hummus\",\n  \"humongous\",\n  \"humorist\",\n  \"humorless\",\n  \"humorous\",\n  \"humpback\",\n  \"humped\",\n  \"humvee\",\n  \"hunchback\",\n  \"hundredth\",\n  \"hunger\",\n  \"hungrily\",\n  \"hungry\",\n  \"hunk\",\n  \"hunter\",\n  \"hunting\",\n  \"huntress\",\n  \"huntsman\",\n  \"hurdle\",\n  \"hurled\",\n  \"hurler\",\n  \"hurling\",\n  \"hurray\",\n  \"hurricane\",\n  \"hurried\",\n  \"hurry\",\n  \"hurt\",\n  \"husband\",\n  \"hush\",\n  \"husked\",\n  \"huskiness\",\n  \"hut\",\n  \"hybrid\",\n  \"hydrant\",\n  \"hydrated\",\n  \"hydration\",\n  \"hydrogen\",\n  \"hydroxide\",\n  \"hyperlink\",\n  \"hypertext\",\n  \"hyphen\",\n  \"hypnoses\",\n  \"hypnosis\",\n  \"hypnotic\",\n  \"hypnotism\",\n  \"hypnotist\",\n  \"hypnotize\",\n  \"hypocrisy\",\n  \"hypocrite\",\n  \"ibuprofen\",\n  \"ice\",\n  \"iciness\",\n  \"icing\",\n  \"icky\",\n  \"icon\",\n  \"icy\",\n  \"idealism\",\n  \"idealist\",\n  \"idealize\",\n  \"ideally\",\n  \"idealness\",\n  \"identical\",\n  \"identify\",\n  \"identity\",\n  \"ideology\",\n  \"idiocy\",\n  \"idiom\",\n  \"idly\",\n  \"igloo\",\n  \"ignition\",\n  \"ignore\",\n  \"iguana\",\n  \"illicitly\",\n  \"illusion\",\n  \"illusive\",\n  \"image\",\n  \"imaginary\",\n  \"imagines\",\n  \"imaging\",\n  \"imbecile\",\n  \"imitate\",\n  \"imitation\",\n  \"immature\",\n  \"immerse\",\n  \"immersion\",\n  \"imminent\",\n  \"immobile\",\n  \"immodest\",\n  \"immorally\",\n  \"immortal\",\n  \"immovable\",\n  \"immovably\",\n  \"immunity\",\n  \"immunize\",\n  \"impaired\",\n  \"impale\",\n  \"impart\",\n  \"impatient\",\n  \"impeach\",\n  \"impeding\",\n  \"impending\",\n  \"imperfect\",\n  \"imperial\",\n  \"impish\",\n  \"implant\",\n  \"implement\",\n  \"implicate\",\n  \"implicit\",\n  \"implode\",\n  \"implosion\",\n  \"implosive\",\n  \"imply\",\n  \"impolite\",\n  \"important\",\n  \"importer\",\n  \"impose\",\n  \"imposing\",\n  \"impotence\",\n  \"impotency\",\n  \"impotent\",\n  \"impound\",\n  \"imprecise\",\n  \"imprint\",\n  \"imprison\",\n  \"impromptu\",\n  \"improper\",\n  \"improve\",\n  \"improving\",\n  \"improvise\",\n  \"imprudent\",\n  \"impulse\",\n  \"impulsive\",\n  \"impure\",\n  \"impurity\",\n  \"iodine\",\n  \"iodize\",\n  \"ion\",\n  \"ipad\",\n  \"iphone\",\n  \"ipod\",\n  \"irate\",\n  \"irk\",\n  \"iron\",\n  \"irregular\",\n  \"irrigate\",\n  \"irritable\",\n  \"irritably\",\n  \"irritant\",\n  \"irritate\",\n  \"islamic\",\n  \"islamist\",\n  \"isolated\",\n  \"isolating\",\n  \"isolation\",\n  \"isotope\",\n  \"issue\",\n  \"issuing\",\n  \"italicize\",\n  \"italics\",\n  \"item\",\n  \"itinerary\",\n  \"itunes\",\n  \"ivory\",\n  \"ivy\",\n  \"jab\",\n  \"jackal\",\n  \"jacket\",\n  \"jackknife\",\n  \"jackpot\",\n  \"jailbird\",\n  \"jailbreak\",\n  \"jailer\",\n  \"jailhouse\",\n  \"jalapeno\",\n  \"jam\",\n  \"janitor\",\n  \"january\",\n  \"jargon\",\n  \"jarring\",\n  \"jasmine\",\n  \"jaundice\",\n  \"jaunt\",\n  \"java\",\n  \"jawed\",\n  \"jawless\",\n  \"jawline\",\n  \"jaws\",\n  \"jaybird\",\n  \"jaywalker\",\n  \"jazz\",\n  \"jeep\",\n  \"jeeringly\",\n  \"jellied\",\n  \"jelly\",\n  \"jersey\",\n  \"jester\",\n  \"jet\",\n  \"jiffy\",\n  \"jigsaw\",\n  \"jimmy\",\n  \"jingle\",\n  \"jingling\",\n  \"jinx\",\n  \"jitters\",\n  \"jittery\",\n  \"job\",\n  \"jockey\",\n  \"jockstrap\",\n  \"jogger\",\n  \"jogging\",\n  \"john\",\n  \"joining\",\n  \"jokester\",\n  \"jokingly\",\n  \"jolliness\",\n  \"jolly\",\n  \"jolt\",\n  \"jot\",\n  \"jovial\",\n  \"joyfully\",\n  \"joylessly\",\n  \"joyous\",\n  \"joyride\",\n  \"joystick\",\n  \"jubilance\",\n  \"jubilant\",\n  \"judge\",\n  \"judgingly\",\n  \"judicial\",\n  \"judiciary\",\n  \"judo\",\n  \"juggle\",\n  \"juggling\",\n  \"jugular\",\n  \"juice\",\n  \"juiciness\",\n  \"juicy\",\n  \"jujitsu\",\n  \"jukebox\",\n  \"july\",\n  \"jumble\",\n  \"jumbo\",\n  \"jump\",\n  \"junction\",\n  \"juncture\",\n  \"june\",\n  \"junior\",\n  \"juniper\",\n  \"junkie\",\n  \"junkman\",\n  \"junkyard\",\n  \"jurist\",\n  \"juror\",\n  \"jury\",\n  \"justice\",\n  \"justifier\",\n  \"justify\",\n  \"justly\",\n  \"justness\",\n  \"juvenile\",\n  \"kabob\",\n  \"kangaroo\",\n  \"karaoke\",\n  \"karate\",\n  \"karma\",\n  \"kebab\",\n  \"keenly\",\n  \"keenness\",\n  \"keep\",\n  \"keg\",\n  \"kelp\",\n  \"kennel\",\n  \"kept\",\n  \"kerchief\",\n  \"kerosene\",\n  \"kettle\",\n  \"kick\",\n  \"kiln\",\n  \"kilobyte\",\n  \"kilogram\",\n  \"kilometer\",\n  \"kilowatt\",\n  \"kilt\",\n  \"kimono\",\n  \"kindle\",\n  \"kindling\",\n  \"kindly\",\n  \"kindness\",\n  \"kindred\",\n  \"kinetic\",\n  \"kinfolk\",\n  \"king\",\n  \"kinship\",\n  \"kinsman\",\n  \"kinswoman\",\n  \"kissable\",\n  \"kisser\",\n  \"kissing\",\n  \"kitchen\",\n  \"kite\",\n  \"kitten\",\n  \"kitty\",\n  \"kiwi\",\n  \"kleenex\",\n  \"knapsack\",\n  \"knee\",\n  \"knelt\",\n  \"knickers\",\n  \"knoll\",\n  \"koala\",\n  \"kooky\",\n  \"kosher\",\n  \"krypton\",\n  \"kudos\",\n  \"kung\",\n  \"labored\",\n  \"laborer\",\n  \"laboring\",\n  \"laborious\",\n  \"labrador\",\n  \"ladder\",\n  \"ladies\",\n  \"ladle\",\n  \"ladybug\",\n  \"ladylike\",\n  \"lagged\",\n  \"lagging\",\n  \"lagoon\",\n  \"lair\",\n  \"lake\",\n  \"lance\",\n  \"landed\",\n  \"landfall\",\n  \"landfill\",\n  \"landing\",\n  \"landlady\",\n  \"landless\",\n  \"landline\",\n  \"landlord\",\n  \"landmark\",\n  \"landmass\",\n  \"landmine\",\n  \"landowner\",\n  \"landscape\",\n  \"landside\",\n  \"landslide\",\n  \"language\",\n  \"lankiness\",\n  \"lanky\",\n  \"lantern\",\n  \"lapdog\",\n  \"lapel\",\n  \"lapped\",\n  \"lapping\",\n  \"laptop\",\n  \"lard\",\n  \"large\",\n  \"lark\",\n  \"lash\",\n  \"lasso\",\n  \"last\",\n  \"latch\",\n  \"late\",\n  \"lather\",\n  \"latitude\",\n  \"latrine\",\n  \"latter\",\n  \"latticed\",\n  \"launch\",\n  \"launder\",\n  \"laundry\",\n  \"laurel\",\n  \"lavender\",\n  \"lavish\",\n  \"laxative\",\n  \"lazily\",\n  \"laziness\",\n  \"lazy\",\n  \"lecturer\",\n  \"left\",\n  \"legacy\",\n  \"legal\",\n  \"legend\",\n  \"legged\",\n  \"leggings\",\n  \"legible\",\n  \"legibly\",\n  \"legislate\",\n  \"lego\",\n  \"legroom\",\n  \"legume\",\n  \"legwarmer\",\n  \"legwork\",\n  \"lemon\",\n  \"lend\",\n  \"length\",\n  \"lens\",\n  \"lent\",\n  \"leotard\",\n  \"lesser\",\n  \"letdown\",\n  \"lethargic\",\n  \"lethargy\",\n  \"letter\",\n  \"lettuce\",\n  \"level\",\n  \"leverage\",\n  \"levers\",\n  \"levitate\",\n  \"levitator\",\n  \"liability\",\n  \"liable\",\n  \"liberty\",\n  \"librarian\",\n  \"library\",\n  \"licking\",\n  \"licorice\",\n  \"lid\",\n  \"life\",\n  \"lifter\",\n  \"lifting\",\n  \"liftoff\",\n  \"ligament\",\n  \"likely\",\n  \"likeness\",\n  \"likewise\",\n  \"liking\",\n  \"lilac\",\n  \"lilly\",\n  \"lily\",\n  \"limb\",\n  \"limeade\",\n  \"limelight\",\n  \"limes\",\n  \"limit\",\n  \"limping\",\n  \"limpness\",\n  \"line\",\n  \"lingo\",\n  \"linguini\",\n  \"linguist\",\n  \"lining\",\n  \"linked\",\n  \"linoleum\",\n  \"linseed\",\n  \"lint\",\n  \"lion\",\n  \"lip\",\n  \"liquefy\",\n  \"liqueur\",\n  \"liquid\",\n  \"lisp\",\n  \"list\",\n  \"litigate\",\n  \"litigator\",\n  \"litmus\",\n  \"litter\",\n  \"little\",\n  \"livable\",\n  \"lived\",\n  \"lively\",\n  \"liver\",\n  \"livestock\",\n  \"lividly\",\n  \"living\",\n  \"lizard\",\n  \"lubricant\",\n  \"lubricate\",\n  \"lucid\",\n  \"luckily\",\n  \"luckiness\",\n  \"luckless\",\n  \"lucrative\",\n  \"ludicrous\",\n  \"lugged\",\n  \"lukewarm\",\n  \"lullaby\",\n  \"lumber\",\n  \"luminance\",\n  \"luminous\",\n  \"lumpiness\",\n  \"lumping\",\n  \"lumpish\",\n  \"lunacy\",\n  \"lunar\",\n  \"lunchbox\",\n  \"luncheon\",\n  \"lunchroom\",\n  \"lunchtime\",\n  \"lung\",\n  \"lurch\",\n  \"lure\",\n  \"luridness\",\n  \"lurk\",\n  \"lushly\",\n  \"lushness\",\n  \"luster\",\n  \"lustfully\",\n  \"lustily\",\n  \"lustiness\",\n  \"lustrous\",\n  \"lusty\",\n  \"luxurious\",\n  \"luxury\",\n  \"lying\",\n  \"lyrically\",\n  \"lyricism\",\n  \"lyricist\",\n  \"lyrics\",\n  \"macarena\",\n  \"macaroni\",\n  \"macaw\",\n  \"mace\",\n  \"machine\",\n  \"machinist\",\n  \"magazine\",\n  \"magenta\",\n  \"maggot\",\n  \"magical\",\n  \"magician\",\n  \"magma\",\n  \"magnesium\",\n  \"magnetic\",\n  \"magnetism\",\n  \"magnetize\",\n  \"magnifier\",\n  \"magnify\",\n  \"magnitude\",\n  \"magnolia\",\n  \"mahogany\",\n  \"maimed\",\n  \"majestic\",\n  \"majesty\",\n  \"majorette\",\n  \"majority\",\n  \"makeover\",\n  \"maker\",\n  \"makeshift\",\n  \"making\",\n  \"malformed\",\n  \"malt\",\n  \"mama\",\n  \"mammal\",\n  \"mammary\",\n  \"mammogram\",\n  \"manager\",\n  \"managing\",\n  \"manatee\",\n  \"mandarin\",\n  \"mandate\",\n  \"mandatory\",\n  \"mandolin\",\n  \"manger\",\n  \"mangle\",\n  \"mango\",\n  \"mangy\",\n  \"manhandle\",\n  \"manhole\",\n  \"manhood\",\n  \"manhunt\",\n  \"manicotti\",\n  \"manicure\",\n  \"manifesto\",\n  \"manila\",\n  \"mankind\",\n  \"manlike\",\n  \"manliness\",\n  \"manly\",\n  \"manmade\",\n  \"manned\",\n  \"mannish\",\n  \"manor\",\n  \"manpower\",\n  \"mantis\",\n  \"mantra\",\n  \"manual\",\n  \"many\",\n  \"map\",\n  \"marathon\",\n  \"marauding\",\n  \"marbled\",\n  \"marbles\",\n  \"marbling\",\n  \"march\",\n  \"mardi\",\n  \"margarine\",\n  \"margarita\",\n  \"margin\",\n  \"marigold\",\n  \"marina\",\n  \"marine\",\n  \"marital\",\n  \"maritime\",\n  \"marlin\",\n  \"marmalade\",\n  \"maroon\",\n  \"married\",\n  \"marrow\",\n  \"marry\",\n  \"marshland\",\n  \"marshy\",\n  \"marsupial\",\n  \"marvelous\",\n  \"marxism\",\n  \"mascot\",\n  \"masculine\",\n  \"mashed\",\n  \"mashing\",\n  \"massager\",\n  \"masses\",\n  \"massive\",\n  \"mastiff\",\n  \"matador\",\n  \"matchbook\",\n  \"matchbox\",\n  \"matcher\",\n  \"matching\",\n  \"matchless\",\n  \"material\",\n  \"maternal\",\n  \"maternity\",\n  \"math\",\n  \"mating\",\n  \"matriarch\",\n  \"matrimony\",\n  \"matrix\",\n  \"matron\",\n  \"matted\",\n  \"matter\",\n  \"maturely\",\n  \"maturing\",\n  \"maturity\",\n  \"mauve\",\n  \"maverick\",\n  \"maximize\",\n  \"maximum\",\n  \"maybe\",\n  \"mayday\",\n  \"mayflower\",\n  \"moaner\",\n  \"moaning\",\n  \"mobile\",\n  \"mobility\",\n  \"mobilize\",\n  \"mobster\",\n  \"mocha\",\n  \"mocker\",\n  \"mockup\",\n  \"modified\",\n  \"modify\",\n  \"modular\",\n  \"modulator\",\n  \"module\",\n  \"moisten\",\n  \"moistness\",\n  \"moisture\",\n  \"molar\",\n  \"molasses\",\n  \"mold\",\n  \"molecular\",\n  \"molecule\",\n  \"molehill\",\n  \"mollusk\",\n  \"mom\",\n  \"monastery\",\n  \"monday\",\n  \"monetary\",\n  \"monetize\",\n  \"moneybags\",\n  \"moneyless\",\n  \"moneywise\",\n  \"mongoose\",\n  \"mongrel\",\n  \"monitor\",\n  \"monkhood\",\n  \"monogamy\",\n  \"monogram\",\n  \"monologue\",\n  \"monopoly\",\n  \"monorail\",\n  \"monotone\",\n  \"monotype\",\n  \"monoxide\",\n  \"monsieur\",\n  \"monsoon\",\n  \"monstrous\",\n  \"monthly\",\n  \"monument\",\n  \"moocher\",\n  \"moodiness\",\n  \"moody\",\n  \"mooing\",\n  \"moonbeam\",\n  \"mooned\",\n  \"moonlight\",\n  \"moonlike\",\n  \"moonlit\",\n  \"moonrise\",\n  \"moonscape\",\n  \"moonshine\",\n  \"moonstone\",\n  \"moonwalk\",\n  \"mop\",\n  \"morale\",\n  \"morality\",\n  \"morally\",\n  \"morbidity\",\n  \"morbidly\",\n  \"morphine\",\n  \"morphing\",\n  \"morse\",\n  \"mortality\",\n  \"mortally\",\n  \"mortician\",\n  \"mortified\",\n  \"mortify\",\n  \"mortuary\",\n  \"mosaic\",\n  \"mossy\",\n  \"most\",\n  \"mothball\",\n  \"mothproof\",\n  \"motion\",\n  \"motivate\",\n  \"motivator\",\n  \"motive\",\n  \"motocross\",\n  \"motor\",\n  \"motto\",\n  \"mountable\",\n  \"mountain\",\n  \"mounted\",\n  \"mounting\",\n  \"mourner\",\n  \"mournful\",\n  \"mouse\",\n  \"mousiness\",\n  \"moustache\",\n  \"mousy\",\n  \"mouth\",\n  \"movable\",\n  \"move\",\n  \"movie\",\n  \"moving\",\n  \"mower\",\n  \"mowing\",\n  \"much\",\n  \"muck\",\n  \"mud\",\n  \"mug\",\n  \"mulberry\",\n  \"mulch\",\n  \"mule\",\n  \"mulled\",\n  \"mullets\",\n  \"multiple\",\n  \"multiply\",\n  \"multitask\",\n  \"multitude\",\n  \"mumble\",\n  \"mumbling\",\n  \"mumbo\",\n  \"mummified\",\n  \"mummify\",\n  \"mummy\",\n  \"mumps\",\n  \"munchkin\",\n  \"mundane\",\n  \"municipal\",\n  \"muppet\",\n  \"mural\",\n  \"murkiness\",\n  \"murky\",\n  \"murmuring\",\n  \"muscular\",\n  \"museum\",\n  \"mushily\",\n  \"mushiness\",\n  \"mushroom\",\n  \"mushy\",\n  \"music\",\n  \"musket\",\n  \"muskiness\",\n  \"musky\",\n  \"mustang\",\n  \"mustard\",\n  \"muster\",\n  \"mustiness\",\n  \"musty\",\n  \"mutable\",\n  \"mutate\",\n  \"mutation\",\n  \"mute\",\n  \"mutilated\",\n  \"mutilator\",\n  \"mutiny\",\n  \"mutt\",\n  \"mutual\",\n  \"muzzle\",\n  \"myself\",\n  \"myspace\",\n  \"mystified\",\n  \"mystify\",\n  \"myth\",\n  \"nacho\",\n  \"nag\",\n  \"nail\",\n  \"name\",\n  \"naming\",\n  \"nanny\",\n  \"nanometer\",\n  \"nape\",\n  \"napkin\",\n  \"napped\",\n  \"napping\",\n  \"nappy\",\n  \"narrow\",\n  \"nastily\",\n  \"nastiness\",\n  \"national\",\n  \"native\",\n  \"nativity\",\n  \"natural\",\n  \"nature\",\n  \"naturist\",\n  \"nautical\",\n  \"navigate\",\n  \"navigator\",\n  \"navy\",\n  \"nearby\",\n  \"nearest\",\n  \"nearly\",\n  \"nearness\",\n  \"neatly\",\n  \"neatness\",\n  \"nebula\",\n  \"nebulizer\",\n  \"nectar\",\n  \"negate\",\n  \"negation\",\n  \"negative\",\n  \"neglector\",\n  \"negligee\",\n  \"negligent\",\n  \"negotiate\",\n  \"nemeses\",\n  \"nemesis\",\n  \"neon\",\n  \"nephew\",\n  \"nerd\",\n  \"nervous\",\n  \"nervy\",\n  \"nest\",\n  \"net\",\n  \"neurology\",\n  \"neuron\",\n  \"neurosis\",\n  \"neurotic\",\n  \"neuter\",\n  \"neutron\",\n  \"never\",\n  \"next\",\n  \"nibble\",\n  \"nickname\",\n  \"nicotine\",\n  \"niece\",\n  \"nifty\",\n  \"nimble\",\n  \"nimbly\",\n  \"nineteen\",\n  \"ninetieth\",\n  \"ninja\",\n  \"nintendo\",\n  \"ninth\",\n  \"nuclear\",\n  \"nuclei\",\n  \"nucleus\",\n  \"nugget\",\n  \"nullify\",\n  \"number\",\n  \"numbing\",\n  \"numbly\",\n  \"numbness\",\n  \"numeral\",\n  \"numerate\",\n  \"numerator\",\n  \"numeric\",\n  \"numerous\",\n  \"nuptials\",\n  \"nursery\",\n  \"nursing\",\n  \"nurture\",\n  \"nutcase\",\n  \"nutlike\",\n  \"nutmeg\",\n  \"nutrient\",\n  \"nutshell\",\n  \"nuttiness\",\n  \"nutty\",\n  \"nuzzle\",\n  \"nylon\",\n  \"oaf\",\n  \"oak\",\n  \"oasis\",\n  \"oat\",\n  \"obedience\",\n  \"obedient\",\n  \"obituary\",\n  \"object\",\n  \"obligate\",\n  \"obliged\",\n  \"oblivion\",\n  \"oblivious\",\n  \"oblong\",\n  \"obnoxious\",\n  \"oboe\",\n  \"obscure\",\n  \"obscurity\",\n  \"observant\",\n  \"observer\",\n  \"observing\",\n  \"obsessed\",\n  \"obsession\",\n  \"obsessive\",\n  \"obsolete\",\n  \"obstacle\",\n  \"obstinate\",\n  \"obstruct\",\n  \"obtain\",\n  \"obtrusive\",\n  \"obtuse\",\n  \"obvious\",\n  \"occultist\",\n  \"occupancy\",\n  \"occupant\",\n  \"occupier\",\n  \"occupy\",\n  \"ocean\",\n  \"ocelot\",\n  \"octagon\",\n  \"octane\",\n  \"october\",\n  \"octopus\",\n  \"ogle\",\n  \"oil\",\n  \"oink\",\n  \"ointment\",\n  \"okay\",\n  \"old\",\n  \"olive\",\n  \"olympics\",\n  \"omega\",\n  \"omen\",\n  \"ominous\",\n  \"omission\",\n  \"omit\",\n  \"omnivore\",\n  \"onboard\",\n  \"oncoming\",\n  \"ongoing\",\n  \"onion\",\n  \"online\",\n  \"onlooker\",\n  \"only\",\n  \"onscreen\",\n  \"onset\",\n  \"onshore\",\n  \"onslaught\",\n  \"onstage\",\n  \"onto\",\n  \"onward\",\n  \"onyx\",\n  \"oops\",\n  \"ooze\",\n  \"oozy\",\n  \"opacity\",\n  \"opal\",\n  \"open\",\n  \"operable\",\n  \"operate\",\n  \"operating\",\n  \"operation\",\n  \"operative\",\n  \"operator\",\n  \"opium\",\n  \"opossum\",\n  \"opponent\",\n  \"oppose\",\n  \"opposing\",\n  \"opposite\",\n  \"oppressed\",\n  \"oppressor\",\n  \"opt\",\n  \"opulently\",\n  \"osmosis\",\n  \"other\",\n  \"otter\",\n  \"ouch\",\n  \"ought\",\n  \"ounce\",\n  \"outage\",\n  \"outback\",\n  \"outbid\",\n  \"outboard\",\n  \"outbound\",\n  \"outbreak\",\n  \"outburst\",\n  \"outcast\",\n  \"outclass\",\n  \"outcome\",\n  \"outdated\",\n  \"outdoors\",\n  \"outer\",\n  \"outfield\",\n  \"outfit\",\n  \"outflank\",\n  \"outgoing\",\n  \"outgrow\",\n  \"outhouse\",\n  \"outing\",\n  \"outlast\",\n  \"outlet\",\n  \"outline\",\n  \"outlook\",\n  \"outlying\",\n  \"outmatch\",\n  \"outmost\",\n  \"outnumber\",\n  \"outplayed\",\n  \"outpost\",\n  \"outpour\",\n  \"output\",\n  \"outrage\",\n  \"outrank\",\n  \"outreach\",\n  \"outright\",\n  \"outscore\",\n  \"outsell\",\n  \"outshine\",\n  \"outshoot\",\n  \"outsider\",\n  \"outskirts\",\n  \"outsmart\",\n  \"outsource\",\n  \"outspoken\",\n  \"outtakes\",\n  \"outthink\",\n  \"outward\",\n  \"outweigh\",\n  \"outwit\",\n  \"oval\",\n  \"ovary\",\n  \"oven\",\n  \"overact\",\n  \"overall\",\n  \"overarch\",\n  \"overbid\",\n  \"overbill\",\n  \"overbite\",\n  \"overblown\",\n  \"overboard\",\n  \"overbook\",\n  \"overbuilt\",\n  \"overcast\",\n  \"overcoat\",\n  \"overcome\",\n  \"overcook\",\n  \"overcrowd\",\n  \"overdraft\",\n  \"overdrawn\",\n  \"overdress\",\n  \"overdrive\",\n  \"overdue\",\n  \"overeager\",\n  \"overeater\",\n  \"overexert\",\n  \"overfed\",\n  \"overfeed\",\n  \"overfill\",\n  \"overflow\",\n  \"overfull\",\n  \"overgrown\",\n  \"overhand\",\n  \"overhang\",\n  \"overhaul\",\n  \"overhead\",\n  \"overhear\",\n  \"overheat\",\n  \"overhung\",\n  \"overjoyed\",\n  \"overkill\",\n  \"overlabor\",\n  \"overlaid\",\n  \"overlap\",\n  \"overlay\",\n  \"overload\",\n  \"overlook\",\n  \"overlord\",\n  \"overlying\",\n  \"overnight\",\n  \"overpass\",\n  \"overpay\",\n  \"overplant\",\n  \"overplay\",\n  \"overpower\",\n  \"overprice\",\n  \"overrate\",\n  \"overreach\",\n  \"overreact\",\n  \"override\",\n  \"overripe\",\n  \"overrule\",\n  \"overrun\",\n  \"overshoot\",\n  \"overshot\",\n  \"oversight\",\n  \"oversized\",\n  \"oversleep\",\n  \"oversold\",\n  \"overspend\",\n  \"overstate\",\n  \"overstay\",\n  \"overstep\",\n  \"overstock\",\n  \"overstuff\",\n  \"oversweet\",\n  \"overtake\",\n  \"overthrow\",\n  \"overtime\",\n  \"overtly\",\n  \"overtone\",\n  \"overture\",\n  \"overturn\",\n  \"overuse\",\n  \"overvalue\",\n  \"overview\",\n  \"overwrite\",\n  \"owl\",\n  \"oxford\",\n  \"oxidant\",\n  \"oxidation\",\n  \"oxidize\",\n  \"oxidizing\",\n  \"oxygen\",\n  \"oxymoron\",\n  \"oyster\",\n  \"ozone\",\n  \"paced\",\n  \"pacemaker\",\n  \"pacific\",\n  \"pacifier\",\n  \"pacifism\",\n  \"pacifist\",\n  \"pacify\",\n  \"padded\",\n  \"padding\",\n  \"paddle\",\n  \"paddling\",\n  \"padlock\",\n  \"pagan\",\n  \"pager\",\n  \"paging\",\n  \"pajamas\",\n  \"palace\",\n  \"palatable\",\n  \"palm\",\n  \"palpable\",\n  \"palpitate\",\n  \"paltry\",\n  \"pampered\",\n  \"pamperer\",\n  \"pampers\",\n  \"pamphlet\",\n  \"panama\",\n  \"pancake\",\n  \"pancreas\",\n  \"panda\",\n  \"pandemic\",\n  \"pang\",\n  \"panhandle\",\n  \"panic\",\n  \"panning\",\n  \"panorama\",\n  \"panoramic\",\n  \"panther\",\n  \"pantomime\",\n  \"pantry\",\n  \"pants\",\n  \"pantyhose\",\n  \"paparazzi\",\n  \"papaya\",\n  \"paper\",\n  \"paprika\",\n  \"papyrus\",\n  \"parabola\",\n  \"parachute\",\n  \"parade\",\n  \"paradox\",\n  \"paragraph\",\n  \"parakeet\",\n  \"paralegal\",\n  \"paralyses\",\n  \"paralysis\",\n  \"paralyze\",\n  \"paramedic\",\n  \"parameter\",\n  \"paramount\",\n  \"parasail\",\n  \"parasite\",\n  \"parasitic\",\n  \"parcel\",\n  \"parched\",\n  \"parchment\",\n  \"pardon\",\n  \"parish\",\n  \"parka\",\n  \"parking\",\n  \"parkway\",\n  \"parlor\",\n  \"parmesan\",\n  \"parole\",\n  \"parrot\",\n  \"parsley\",\n  \"parsnip\",\n  \"partake\",\n  \"parted\",\n  \"parting\",\n  \"partition\",\n  \"partly\",\n  \"partner\",\n  \"partridge\",\n  \"party\",\n  \"passable\",\n  \"passably\",\n  \"passage\",\n  \"passcode\",\n  \"passenger\",\n  \"passerby\",\n  \"passing\",\n  \"passion\",\n  \"passive\",\n  \"passivism\",\n  \"passover\",\n  \"passport\",\n  \"password\",\n  \"pasta\",\n  \"pasted\",\n  \"pastel\",\n  \"pastime\",\n  \"pastor\",\n  \"pastrami\",\n  \"pasture\",\n  \"pasty\",\n  \"patchwork\",\n  \"patchy\",\n  \"paternal\",\n  \"paternity\",\n  \"path\",\n  \"patience\",\n  \"patient\",\n  \"patio\",\n  \"patriarch\",\n  \"patriot\",\n  \"patrol\",\n  \"patronage\",\n  \"patronize\",\n  \"pauper\",\n  \"pavement\",\n  \"paver\",\n  \"pavestone\",\n  \"pavilion\",\n  \"paving\",\n  \"pawing\",\n  \"payable\",\n  \"payback\",\n  \"paycheck\",\n  \"payday\",\n  \"payee\",\n  \"payer\",\n  \"paying\",\n  \"payment\",\n  \"payphone\",\n  \"payroll\",\n  \"pebble\",\n  \"pebbly\",\n  \"pecan\",\n  \"pectin\",\n  \"peculiar\",\n  \"peddling\",\n  \"pediatric\",\n  \"pedicure\",\n  \"pedigree\",\n  \"pedometer\",\n  \"pegboard\",\n  \"pelican\",\n  \"pellet\",\n  \"pelt\",\n  \"pelvis\",\n  \"penalize\",\n  \"penalty\",\n  \"pencil\",\n  \"pendant\",\n  \"pending\",\n  \"penholder\",\n  \"penknife\",\n  \"pennant\",\n  \"penniless\",\n  \"penny\",\n  \"penpal\",\n  \"pension\",\n  \"pentagon\",\n  \"pentagram\",\n  \"pep\",\n  \"perceive\",\n  \"percent\",\n  \"perch\",\n  \"percolate\",\n  \"perennial\",\n  \"perfected\",\n  \"perfectly\",\n  \"perfume\",\n  \"periscope\",\n  \"perish\",\n  \"perjurer\",\n  \"perjury\",\n  \"perkiness\",\n  \"perky\",\n  \"perm\",\n  \"peroxide\",\n  \"perpetual\",\n  \"perplexed\",\n  \"persecute\",\n  \"persevere\",\n  \"persuaded\",\n  \"persuader\",\n  \"pesky\",\n  \"peso\",\n  \"pessimism\",\n  \"pessimist\",\n  \"pester\",\n  \"pesticide\",\n  \"petal\",\n  \"petite\",\n  \"petition\",\n  \"petri\",\n  \"petroleum\",\n  \"petted\",\n  \"petticoat\",\n  \"pettiness\",\n  \"petty\",\n  \"petunia\",\n  \"phantom\",\n  \"phobia\",\n  \"phoenix\",\n  \"phonebook\",\n  \"phoney\",\n  \"phonics\",\n  \"phoniness\",\n  \"phony\",\n  \"phosphate\",\n  \"photo\",\n  \"phrase\",\n  \"phrasing\",\n  \"placard\",\n  \"placate\",\n  \"placidly\",\n  \"plank\",\n  \"planner\",\n  \"plant\",\n  \"plasma\",\n  \"plaster\",\n  \"plastic\",\n  \"plated\",\n  \"platform\",\n  \"plating\",\n  \"platinum\",\n  \"platonic\",\n  \"platter\",\n  \"platypus\",\n  \"plausible\",\n  \"plausibly\",\n  \"playable\",\n  \"playback\",\n  \"player\",\n  \"playful\",\n  \"playgroup\",\n  \"playhouse\",\n  \"playing\",\n  \"playlist\",\n  \"playmaker\",\n  \"playmate\",\n  \"playoff\",\n  \"playpen\",\n  \"playroom\",\n  \"playset\",\n  \"plaything\",\n  \"playtime\",\n  \"plaza\",\n  \"pleading\",\n  \"pleat\",\n  \"pledge\",\n  \"plentiful\",\n  \"plenty\",\n  \"plethora\",\n  \"plexiglas\",\n  \"pliable\",\n  \"plod\",\n  \"plop\",\n  \"plot\",\n  \"plow\",\n  \"ploy\",\n  \"pluck\",\n  \"plug\",\n  \"plunder\",\n  \"plunging\",\n  \"plural\",\n  \"plus\",\n  \"plutonium\",\n  \"plywood\",\n  \"poach\",\n  \"pod\",\n  \"poem\",\n  \"poet\",\n  \"pogo\",\n  \"pointed\",\n  \"pointer\",\n  \"pointing\",\n  \"pointless\",\n  \"pointy\",\n  \"poise\",\n  \"poison\",\n  \"poker\",\n  \"poking\",\n  \"polar\",\n  \"police\",\n  \"policy\",\n  \"polio\",\n  \"polish\",\n  \"politely\",\n  \"polka\",\n  \"polo\",\n  \"polyester\",\n  \"polygon\",\n  \"polygraph\",\n  \"polymer\",\n  \"poncho\",\n  \"pond\",\n  \"pony\",\n  \"popcorn\",\n  \"pope\",\n  \"poplar\",\n  \"popper\",\n  \"poppy\",\n  \"popsicle\",\n  \"populace\",\n  \"popular\",\n  \"populate\",\n  \"porcupine\",\n  \"pork\",\n  \"porous\",\n  \"porridge\",\n  \"portable\",\n  \"portal\",\n  \"portfolio\",\n  \"porthole\",\n  \"portion\",\n  \"portly\",\n  \"portside\",\n  \"poser\",\n  \"posh\",\n  \"posing\",\n  \"possible\",\n  \"possibly\",\n  \"possum\",\n  \"postage\",\n  \"postal\",\n  \"postbox\",\n  \"postcard\",\n  \"posted\",\n  \"poster\",\n  \"posting\",\n  \"postnasal\",\n  \"posture\",\n  \"postwar\",\n  \"pouch\",\n  \"pounce\",\n  \"pouncing\",\n  \"pound\",\n  \"pouring\",\n  \"pout\",\n  \"powdered\",\n  \"powdering\",\n  \"powdery\",\n  \"power\",\n  \"powwow\",\n  \"pox\",\n  \"praising\",\n  \"prance\",\n  \"prancing\",\n  \"pranker\",\n  \"prankish\",\n  \"prankster\",\n  \"prayer\",\n  \"praying\",\n  \"preacher\",\n  \"preaching\",\n  \"preachy\",\n  \"preamble\",\n  \"precinct\",\n  \"precise\",\n  \"precision\",\n  \"precook\",\n  \"precut\",\n  \"predator\",\n  \"predefine\",\n  \"predict\",\n  \"preface\",\n  \"prefix\",\n  \"preflight\",\n  \"preformed\",\n  \"pregame\",\n  \"pregnancy\",\n  \"pregnant\",\n  \"preheated\",\n  \"prelaunch\",\n  \"prelaw\",\n  \"prelude\",\n  \"premiere\",\n  \"premises\",\n  \"premium\",\n  \"prenatal\",\n  \"preoccupy\",\n  \"preorder\",\n  \"prepaid\",\n  \"prepay\",\n  \"preplan\",\n  \"preppy\",\n  \"preschool\",\n  \"prescribe\",\n  \"preseason\",\n  \"preset\",\n  \"preshow\",\n  \"president\",\n  \"presoak\",\n  \"press\",\n  \"presume\",\n  \"presuming\",\n  \"preteen\",\n  \"pretended\",\n  \"pretender\",\n  \"pretense\",\n  \"pretext\",\n  \"pretty\",\n  \"pretzel\",\n  \"prevail\",\n  \"prevalent\",\n  \"prevent\",\n  \"preview\",\n  \"previous\",\n  \"prewar\",\n  \"prewashed\",\n  \"prideful\",\n  \"pried\",\n  \"primal\",\n  \"primarily\",\n  \"primary\",\n  \"primate\",\n  \"primer\",\n  \"primp\",\n  \"princess\",\n  \"print\",\n  \"prior\",\n  \"prism\",\n  \"prison\",\n  \"prissy\",\n  \"pristine\",\n  \"privacy\",\n  \"private\",\n  \"privatize\",\n  \"prize\",\n  \"proactive\",\n  \"probable\",\n  \"probably\",\n  \"probation\",\n  \"probe\",\n  \"probing\",\n  \"probiotic\",\n  \"problem\",\n  \"procedure\",\n  \"process\",\n  \"proclaim\",\n  \"procreate\",\n  \"procurer\",\n  \"prodigal\",\n  \"prodigy\",\n  \"produce\",\n  \"product\",\n  \"profane\",\n  \"profanity\",\n  \"professed\",\n  \"professor\",\n  \"profile\",\n  \"profound\",\n  \"profusely\",\n  \"progeny\",\n  \"prognosis\",\n  \"program\",\n  \"progress\",\n  \"projector\",\n  \"prologue\",\n  \"prolonged\",\n  \"promenade\",\n  \"prominent\",\n  \"promoter\",\n  \"promotion\",\n  \"prompter\",\n  \"promptly\",\n  \"prone\",\n  \"prong\",\n  \"pronounce\",\n  \"pronto\",\n  \"proofing\",\n  \"proofread\",\n  \"proofs\",\n  \"propeller\",\n  \"properly\",\n  \"property\",\n  \"proponent\",\n  \"proposal\",\n  \"propose\",\n  \"props\",\n  \"prorate\",\n  \"protector\",\n  \"protegee\",\n  \"proton\",\n  \"prototype\",\n  \"protozoan\",\n  \"protract\",\n  \"protrude\",\n  \"proud\",\n  \"provable\",\n  \"proved\",\n  \"proven\",\n  \"provided\",\n  \"provider\",\n  \"providing\",\n  \"province\",\n  \"proving\",\n  \"provoke\",\n  \"provoking\",\n  \"provolone\",\n  \"prowess\",\n  \"prowler\",\n  \"prowling\",\n  \"proximity\",\n  \"proxy\",\n  \"prozac\",\n  \"prude\",\n  \"prudishly\",\n  \"prune\",\n  \"pruning\",\n  \"pry\",\n  \"psychic\",\n  \"public\",\n  \"publisher\",\n  \"pucker\",\n  \"pueblo\",\n  \"pug\",\n  \"pull\",\n  \"pulmonary\",\n  \"pulp\",\n  \"pulsate\",\n  \"pulse\",\n  \"pulverize\",\n  \"puma\",\n  \"pumice\",\n  \"pummel\",\n  \"punch\",\n  \"punctual\",\n  \"punctuate\",\n  \"punctured\",\n  \"pungent\",\n  \"punisher\",\n  \"punk\",\n  \"pupil\",\n  \"puppet\",\n  \"puppy\",\n  \"purchase\",\n  \"pureblood\",\n  \"purebred\",\n  \"purely\",\n  \"pureness\",\n  \"purgatory\",\n  \"purge\",\n  \"purging\",\n  \"purifier\",\n  \"purify\",\n  \"purist\",\n  \"puritan\",\n  \"purity\",\n  \"purple\",\n  \"purplish\",\n  \"purposely\",\n  \"purr\",\n  \"purse\",\n  \"pursuable\",\n  \"pursuant\",\n  \"pursuit\",\n  \"purveyor\",\n  \"pushcart\",\n  \"pushchair\",\n  \"pusher\",\n  \"pushiness\",\n  \"pushing\",\n  \"pushover\",\n  \"pushpin\",\n  \"pushup\",\n  \"pushy\",\n  \"putdown\",\n  \"putt\",\n  \"puzzle\",\n  \"puzzling\",\n  \"pyramid\",\n  \"pyromania\",\n  \"python\",\n  \"quack\",\n  \"quadrant\",\n  \"quail\",\n  \"quaintly\",\n  \"quake\",\n  \"quaking\",\n  \"qualified\",\n  \"qualifier\",\n  \"qualify\",\n  \"quality\",\n  \"qualm\",\n  \"quantum\",\n  \"quarrel\",\n  \"quarry\",\n  \"quartered\",\n  \"quarterly\",\n  \"quarters\",\n  \"quartet\",\n  \"quench\",\n  \"query\",\n  \"quicken\",\n  \"quickly\",\n  \"quickness\",\n  \"quicksand\",\n  \"quickstep\",\n  \"quiet\",\n  \"quill\",\n  \"quilt\",\n  \"quintet\",\n  \"quintuple\",\n  \"quirk\",\n  \"quit\",\n  \"quiver\",\n  \"quizzical\",\n  \"quotable\",\n  \"quotation\",\n  \"quote\",\n  \"rabid\",\n  \"race\",\n  \"racing\",\n  \"racism\",\n  \"rack\",\n  \"racoon\",\n  \"radar\",\n  \"radial\",\n  \"radiance\",\n  \"radiantly\",\n  \"radiated\",\n  \"radiation\",\n  \"radiator\",\n  \"radio\",\n  \"radish\",\n  \"raffle\",\n  \"raft\",\n  \"rage\",\n  \"ragged\",\n  \"raging\",\n  \"ragweed\",\n  \"raider\",\n  \"railcar\",\n  \"railing\",\n  \"railroad\",\n  \"railway\",\n  \"raisin\",\n  \"rake\",\n  \"raking\",\n  \"rally\",\n  \"ramble\",\n  \"rambling\",\n  \"ramp\",\n  \"ramrod\",\n  \"ranch\",\n  \"rancidity\",\n  \"random\",\n  \"ranged\",\n  \"ranger\",\n  \"ranging\",\n  \"ranked\",\n  \"ranking\",\n  \"ransack\",\n  \"ranting\",\n  \"rants\",\n  \"rare\",\n  \"rarity\",\n  \"rascal\",\n  \"rash\",\n  \"rasping\",\n  \"ravage\",\n  \"raven\",\n  \"ravine\",\n  \"raving\",\n  \"ravioli\",\n  \"ravishing\",\n  \"reabsorb\",\n  \"reach\",\n  \"reacquire\",\n  \"reaction\",\n  \"reactive\",\n  \"reactor\",\n  \"reaffirm\",\n  \"ream\",\n  \"reanalyze\",\n  \"reappear\",\n  \"reapply\",\n  \"reappoint\",\n  \"reapprove\",\n  \"rearrange\",\n  \"rearview\",\n  \"reason\",\n  \"reassign\",\n  \"reassure\",\n  \"reattach\",\n  \"reawake\",\n  \"rebalance\",\n  \"rebate\",\n  \"rebel\",\n  \"rebirth\",\n  \"reboot\",\n  \"reborn\",\n  \"rebound\",\n  \"rebuff\",\n  \"rebuild\",\n  \"rebuilt\",\n  \"reburial\",\n  \"rebuttal\",\n  \"recall\",\n  \"recant\",\n  \"recapture\",\n  \"recast\",\n  \"recede\",\n  \"recent\",\n  \"recess\",\n  \"recharger\",\n  \"recipient\",\n  \"recital\",\n  \"recite\",\n  \"reckless\",\n  \"reclaim\",\n  \"recliner\",\n  \"reclining\",\n  \"recluse\",\n  \"reclusive\",\n  \"recognize\",\n  \"recoil\",\n  \"recollect\",\n  \"recolor\",\n  \"reconcile\",\n  \"reconfirm\",\n  \"reconvene\",\n  \"recopy\",\n  \"record\",\n  \"recount\",\n  \"recoup\",\n  \"recovery\",\n  \"recreate\",\n  \"rectal\",\n  \"rectangle\",\n  \"rectified\",\n  \"rectify\",\n  \"recycled\",\n  \"recycler\",\n  \"recycling\",\n  \"reemerge\",\n  \"reenact\",\n  \"reenter\",\n  \"reentry\",\n  \"reexamine\",\n  \"referable\",\n  \"referee\",\n  \"reference\",\n  \"refill\",\n  \"refinance\",\n  \"refined\",\n  \"refinery\",\n  \"refining\",\n  \"refinish\",\n  \"reflected\",\n  \"reflector\",\n  \"reflex\",\n  \"reflux\",\n  \"refocus\",\n  \"refold\",\n  \"reforest\",\n  \"reformat\",\n  \"reformed\",\n  \"reformer\",\n  \"reformist\",\n  \"refract\",\n  \"refrain\",\n  \"refreeze\",\n  \"refresh\",\n  \"refried\",\n  \"refueling\",\n  \"refund\",\n  \"refurbish\",\n  \"refurnish\",\n  \"refusal\",\n  \"refuse\",\n  \"refusing\",\n  \"refutable\",\n  \"refute\",\n  \"regain\",\n  \"regalia\",\n  \"regally\",\n  \"reggae\",\n  \"regime\",\n  \"region\",\n  \"register\",\n  \"registrar\",\n  \"registry\",\n  \"regress\",\n  \"regretful\",\n  \"regroup\",\n  \"regular\",\n  \"regulate\",\n  \"regulator\",\n  \"rehab\",\n  \"reheat\",\n  \"rehire\",\n  \"rehydrate\",\n  \"reimburse\",\n  \"reissue\",\n  \"reiterate\",\n  \"rejoice\",\n  \"rejoicing\",\n  \"rejoin\",\n  \"rekindle\",\n  \"relapse\",\n  \"relapsing\",\n  \"relatable\",\n  \"related\",\n  \"relation\",\n  \"relative\",\n  \"relax\",\n  \"relay\",\n  \"relearn\",\n  \"release\",\n  \"relenting\",\n  \"reliable\",\n  \"reliably\",\n  \"reliance\",\n  \"reliant\",\n  \"relic\",\n  \"relieve\",\n  \"relieving\",\n  \"relight\",\n  \"relish\",\n  \"relive\",\n  \"reload\",\n  \"relocate\",\n  \"relock\",\n  \"reluctant\",\n  \"rely\",\n  \"remake\",\n  \"remark\",\n  \"remarry\",\n  \"rematch\",\n  \"remedial\",\n  \"remedy\",\n  \"remember\",\n  \"reminder\",\n  \"remindful\",\n  \"remission\",\n  \"remix\",\n  \"remnant\",\n  \"remodeler\",\n  \"remold\",\n  \"remorse\",\n  \"remote\",\n  \"removable\",\n  \"removal\",\n  \"removed\",\n  \"remover\",\n  \"removing\",\n  \"rename\",\n  \"renderer\",\n  \"rendering\",\n  \"rendition\",\n  \"renegade\",\n  \"renewable\",\n  \"renewably\",\n  \"renewal\",\n  \"renewed\",\n  \"renounce\",\n  \"renovate\",\n  \"renovator\",\n  \"rentable\",\n  \"rental\",\n  \"rented\",\n  \"renter\",\n  \"reoccupy\",\n  \"reoccur\",\n  \"reopen\",\n  \"reorder\",\n  \"repackage\",\n  \"repacking\",\n  \"repaint\",\n  \"repair\",\n  \"repave\",\n  \"repaying\",\n  \"repayment\",\n  \"repeal\",\n  \"repeated\",\n  \"repeater\",\n  \"repent\",\n  \"rephrase\",\n  \"replace\",\n  \"replay\",\n  \"replica\",\n  \"reply\",\n  \"reporter\",\n  \"repose\",\n  \"repossess\",\n  \"repost\",\n  \"repressed\",\n  \"reprimand\",\n  \"reprint\",\n  \"reprise\",\n  \"reproach\",\n  \"reprocess\",\n  \"reproduce\",\n  \"reprogram\",\n  \"reps\",\n  \"reptile\",\n  \"reptilian\",\n  \"repugnant\",\n  \"repulsion\",\n  \"repulsive\",\n  \"repurpose\",\n  \"reputable\",\n  \"reputably\",\n  \"request\",\n  \"require\",\n  \"requisite\",\n  \"reroute\",\n  \"rerun\",\n  \"resale\",\n  \"resample\",\n  \"rescuer\",\n  \"reseal\",\n  \"research\",\n  \"reselect\",\n  \"reseller\",\n  \"resemble\",\n  \"resend\",\n  \"resent\",\n  \"reset\",\n  \"reshape\",\n  \"reshoot\",\n  \"reshuffle\",\n  \"residence\",\n  \"residency\",\n  \"resident\",\n  \"residual\",\n  \"residue\",\n  \"resigned\",\n  \"resilient\",\n  \"resistant\",\n  \"resisting\",\n  \"resize\",\n  \"resolute\",\n  \"resolved\",\n  \"resonant\",\n  \"resonate\",\n  \"resort\",\n  \"resource\",\n  \"respect\",\n  \"resubmit\",\n  \"result\",\n  \"resume\",\n  \"resupply\",\n  \"resurface\",\n  \"resurrect\",\n  \"retail\",\n  \"retainer\",\n  \"retaining\",\n  \"retake\",\n  \"retaliate\",\n  \"retention\",\n  \"rethink\",\n  \"retinal\",\n  \"retired\",\n  \"retiree\",\n  \"retiring\",\n  \"retold\",\n  \"retool\",\n  \"retorted\",\n  \"retouch\",\n  \"retrace\",\n  \"retract\",\n  \"retrain\",\n  \"retread\",\n  \"retreat\",\n  \"retrial\",\n  \"retrieval\",\n  \"retriever\",\n  \"retry\",\n  \"return\",\n  \"retying\",\n  \"retype\",\n  \"reunion\",\n  \"reunite\",\n  \"reusable\",\n  \"reuse\",\n  \"reveal\",\n  \"reveler\",\n  \"revenge\",\n  \"revenue\",\n  \"reverb\",\n  \"revered\",\n  \"reverence\",\n  \"reverend\",\n  \"reversal\",\n  \"reverse\",\n  \"reversing\",\n  \"reversion\",\n  \"revert\",\n  \"revisable\",\n  \"revise\",\n  \"revision\",\n  \"revisit\",\n  \"revivable\",\n  \"revival\",\n  \"reviver\",\n  \"reviving\",\n  \"revocable\",\n  \"revoke\",\n  \"revolt\",\n  \"revolver\",\n  \"revolving\",\n  \"reward\",\n  \"rewash\",\n  \"rewind\",\n  \"rewire\",\n  \"reword\",\n  \"rework\",\n  \"rewrap\",\n  \"rewrite\",\n  \"rhyme\",\n  \"ribbon\",\n  \"ribcage\",\n  \"rice\",\n  \"riches\",\n  \"richly\",\n  \"richness\",\n  \"rickety\",\n  \"ricotta\",\n  \"riddance\",\n  \"ridden\",\n  \"ride\",\n  \"riding\",\n  \"rifling\",\n  \"rift\",\n  \"rigging\",\n  \"rigid\",\n  \"rigor\",\n  \"rimless\",\n  \"rimmed\",\n  \"rind\",\n  \"rink\",\n  \"rinse\",\n  \"rinsing\",\n  \"riot\",\n  \"ripcord\",\n  \"ripeness\",\n  \"ripening\",\n  \"ripping\",\n  \"ripple\",\n  \"rippling\",\n  \"riptide\",\n  \"rise\",\n  \"rising\",\n  \"risk\",\n  \"risotto\",\n  \"ritalin\",\n  \"ritzy\",\n  \"rival\",\n  \"riverbank\",\n  \"riverbed\",\n  \"riverboat\",\n  \"riverside\",\n  \"riveter\",\n  \"riveting\",\n  \"roamer\",\n  \"roaming\",\n  \"roast\",\n  \"robbing\",\n  \"robe\",\n  \"robin\",\n  \"robotics\",\n  \"robust\",\n  \"rockband\",\n  \"rocker\",\n  \"rocket\",\n  \"rockfish\",\n  \"rockiness\",\n  \"rocking\",\n  \"rocklike\",\n  \"rockslide\",\n  \"rockstar\",\n  \"rocky\",\n  \"rogue\",\n  \"roman\",\n  \"romp\",\n  \"rope\",\n  \"roping\",\n  \"roster\",\n  \"rosy\",\n  \"rotten\",\n  \"rotting\",\n  \"rotunda\",\n  \"roulette\",\n  \"rounding\",\n  \"roundish\",\n  \"roundness\",\n  \"roundup\",\n  \"roundworm\",\n  \"routine\",\n  \"routing\",\n  \"rover\",\n  \"roving\",\n  \"royal\",\n  \"rubbed\",\n  \"rubber\",\n  \"rubbing\",\n  \"rubble\",\n  \"rubdown\",\n  \"ruby\",\n  \"ruckus\",\n  \"rudder\",\n  \"rug\",\n  \"ruined\",\n  \"rule\",\n  \"rumble\",\n  \"rumbling\",\n  \"rummage\",\n  \"rumor\",\n  \"runaround\",\n  \"rundown\",\n  \"runner\",\n  \"running\",\n  \"runny\",\n  \"runt\",\n  \"runway\",\n  \"rupture\",\n  \"rural\",\n  \"ruse\",\n  \"rush\",\n  \"rust\",\n  \"rut\",\n  \"sabbath\",\n  \"sabotage\",\n  \"sacrament\",\n  \"sacred\",\n  \"sacrifice\",\n  \"sadden\",\n  \"saddlebag\",\n  \"saddled\",\n  \"saddling\",\n  \"sadly\",\n  \"sadness\",\n  \"safari\",\n  \"safeguard\",\n  \"safehouse\",\n  \"safely\",\n  \"safeness\",\n  \"saffron\",\n  \"saga\",\n  \"sage\",\n  \"sagging\",\n  \"saggy\",\n  \"said\",\n  \"saint\",\n  \"sake\",\n  \"salad\",\n  \"salami\",\n  \"salaried\",\n  \"salary\",\n  \"saline\",\n  \"salon\",\n  \"saloon\",\n  \"salsa\",\n  \"salt\",\n  \"salutary\",\n  \"salute\",\n  \"salvage\",\n  \"salvaging\",\n  \"salvation\",\n  \"same\",\n  \"sample\",\n  \"sampling\",\n  \"sanction\",\n  \"sanctity\",\n  \"sanctuary\",\n  \"sandal\",\n  \"sandbag\",\n  \"sandbank\",\n  \"sandbar\",\n  \"sandblast\",\n  \"sandbox\",\n  \"sanded\",\n  \"sandfish\",\n  \"sanding\",\n  \"sandlot\",\n  \"sandpaper\",\n  \"sandpit\",\n  \"sandstone\",\n  \"sandstorm\",\n  \"sandworm\",\n  \"sandy\",\n  \"sanitary\",\n  \"sanitizer\",\n  \"sank\",\n  \"santa\",\n  \"sapling\",\n  \"sappiness\",\n  \"sappy\",\n  \"sarcasm\",\n  \"sarcastic\",\n  \"sardine\",\n  \"sash\",\n  \"sasquatch\",\n  \"sassy\",\n  \"satchel\",\n  \"satiable\",\n  \"satin\",\n  \"satirical\",\n  \"satisfied\",\n  \"satisfy\",\n  \"saturate\",\n  \"saturday\",\n  \"sauciness\",\n  \"saucy\",\n  \"sauna\",\n  \"savage\",\n  \"savanna\",\n  \"saved\",\n  \"savings\",\n  \"savior\",\n  \"savor\",\n  \"saxophone\",\n  \"say\",\n  \"scabbed\",\n  \"scabby\",\n  \"scalded\",\n  \"scalding\",\n  \"scale\",\n  \"scaling\",\n  \"scallion\",\n  \"scallop\",\n  \"scalping\",\n  \"scam\",\n  \"scandal\",\n  \"scanner\",\n  \"scanning\",\n  \"scant\",\n  \"scapegoat\",\n  \"scarce\",\n  \"scarcity\",\n  \"scarecrow\",\n  \"scared\",\n  \"scarf\",\n  \"scarily\",\n  \"scariness\",\n  \"scarring\",\n  \"scary\",\n  \"scavenger\",\n  \"scenic\",\n  \"schedule\",\n  \"schematic\",\n  \"scheme\",\n  \"scheming\",\n  \"schilling\",\n  \"schnapps\",\n  \"scholar\",\n  \"science\",\n  \"scientist\",\n  \"scion\",\n  \"scoff\",\n  \"scolding\",\n  \"scone\",\n  \"scoop\",\n  \"scooter\",\n  \"scope\",\n  \"scorch\",\n  \"scorebook\",\n  \"scorecard\",\n  \"scored\",\n  \"scoreless\",\n  \"scorer\",\n  \"scoring\",\n  \"scorn\",\n  \"scorpion\",\n  \"scotch\",\n  \"scoundrel\",\n  \"scoured\",\n  \"scouring\",\n  \"scouting\",\n  \"scouts\",\n  \"scowling\",\n  \"scrabble\",\n  \"scraggly\",\n  \"scrambled\",\n  \"scrambler\",\n  \"scrap\",\n  \"scratch\",\n  \"scrawny\",\n  \"screen\",\n  \"scribble\",\n  \"scribe\",\n  \"scribing\",\n  \"scrimmage\",\n  \"script\",\n  \"scroll\",\n  \"scrooge\",\n  \"scrounger\",\n  \"scrubbed\",\n  \"scrubber\",\n  \"scruffy\",\n  \"scrunch\",\n  \"scrutiny\",\n  \"scuba\",\n  \"scuff\",\n  \"sculptor\",\n  \"sculpture\",\n  \"scurvy\",\n  \"scuttle\",\n  \"secluded\",\n  \"secluding\",\n  \"seclusion\",\n  \"second\",\n  \"secrecy\",\n  \"secret\",\n  \"sectional\",\n  \"sector\",\n  \"secular\",\n  \"securely\",\n  \"security\",\n  \"sedan\",\n  \"sedate\",\n  \"sedation\",\n  \"sedative\",\n  \"sediment\",\n  \"seduce\",\n  \"seducing\",\n  \"segment\",\n  \"seismic\",\n  \"seizing\",\n  \"seldom\",\n  \"selected\",\n  \"selection\",\n  \"selective\",\n  \"selector\",\n  \"self\",\n  \"seltzer\",\n  \"semantic\",\n  \"semester\",\n  \"semicolon\",\n  \"semifinal\",\n  \"seminar\",\n  \"semisoft\",\n  \"semisweet\",\n  \"senate\",\n  \"senator\",\n  \"send\",\n  \"senior\",\n  \"senorita\",\n  \"sensation\",\n  \"sensitive\",\n  \"sensitize\",\n  \"sensually\",\n  \"sensuous\",\n  \"sepia\",\n  \"september\",\n  \"septic\",\n  \"septum\",\n  \"sequel\",\n  \"sequence\",\n  \"sequester\",\n  \"series\",\n  \"sermon\",\n  \"serotonin\",\n  \"serpent\",\n  \"serrated\",\n  \"serve\",\n  \"service\",\n  \"serving\",\n  \"sesame\",\n  \"sessions\",\n  \"setback\",\n  \"setting\",\n  \"settle\",\n  \"settling\",\n  \"setup\",\n  \"sevenfold\",\n  \"seventeen\",\n  \"seventh\",\n  \"seventy\",\n  \"severity\",\n  \"shabby\",\n  \"shack\",\n  \"shaded\",\n  \"shadily\",\n  \"shadiness\",\n  \"shading\",\n  \"shadow\",\n  \"shady\",\n  \"shaft\",\n  \"shakable\",\n  \"shakily\",\n  \"shakiness\",\n  \"shaking\",\n  \"shaky\",\n  \"shale\",\n  \"shallot\",\n  \"shallow\",\n  \"shame\",\n  \"shampoo\",\n  \"shamrock\",\n  \"shank\",\n  \"shanty\",\n  \"shape\",\n  \"shaping\",\n  \"share\",\n  \"sharpener\",\n  \"sharper\",\n  \"sharpie\",\n  \"sharply\",\n  \"sharpness\",\n  \"shawl\",\n  \"sheath\",\n  \"shed\",\n  \"sheep\",\n  \"sheet\",\n  \"shelf\",\n  \"shell\",\n  \"shelter\",\n  \"shelve\",\n  \"shelving\",\n  \"sherry\",\n  \"shield\",\n  \"shifter\",\n  \"shifting\",\n  \"shiftless\",\n  \"shifty\",\n  \"shimmer\",\n  \"shimmy\",\n  \"shindig\",\n  \"shine\",\n  \"shingle\",\n  \"shininess\",\n  \"shining\",\n  \"shiny\",\n  \"ship\",\n  \"shirt\",\n  \"shivering\",\n  \"shock\",\n  \"shone\",\n  \"shoplift\",\n  \"shopper\",\n  \"shopping\",\n  \"shoptalk\",\n  \"shore\",\n  \"shortage\",\n  \"shortcake\",\n  \"shortcut\",\n  \"shorten\",\n  \"shorter\",\n  \"shorthand\",\n  \"shortlist\",\n  \"shortly\",\n  \"shortness\",\n  \"shorts\",\n  \"shortwave\",\n  \"shorty\",\n  \"shout\",\n  \"shove\",\n  \"showbiz\",\n  \"showcase\",\n  \"showdown\",\n  \"shower\",\n  \"showgirl\",\n  \"showing\",\n  \"showman\",\n  \"shown\",\n  \"showoff\",\n  \"showpiece\",\n  \"showplace\",\n  \"showroom\",\n  \"showy\",\n  \"shrank\",\n  \"shrapnel\",\n  \"shredder\",\n  \"shredding\",\n  \"shrewdly\",\n  \"shriek\",\n  \"shrill\",\n  \"shrimp\",\n  \"shrine\",\n  \"shrink\",\n  \"shrivel\",\n  \"shrouded\",\n  \"shrubbery\",\n  \"shrubs\",\n  \"shrug\",\n  \"shrunk\",\n  \"shucking\",\n  \"shudder\",\n  \"shuffle\",\n  \"shuffling\",\n  \"shun\",\n  \"shush\",\n  \"shut\",\n  \"shy\",\n  \"siamese\",\n  \"siberian\",\n  \"sibling\",\n  \"siding\",\n  \"sierra\",\n  \"siesta\",\n  \"sift\",\n  \"sighing\",\n  \"silenced\",\n  \"silencer\",\n  \"silent\",\n  \"silica\",\n  \"silicon\",\n  \"silk\",\n  \"silliness\",\n  \"silly\",\n  \"silo\",\n  \"silt\",\n  \"silver\",\n  \"similarly\",\n  \"simile\",\n  \"simmering\",\n  \"simple\",\n  \"simplify\",\n  \"simply\",\n  \"sincere\",\n  \"sincerity\",\n  \"singer\",\n  \"singing\",\n  \"single\",\n  \"singular\",\n  \"sinister\",\n  \"sinless\",\n  \"sinner\",\n  \"sinuous\",\n  \"sip\",\n  \"siren\",\n  \"sister\",\n  \"sitcom\",\n  \"sitter\",\n  \"sitting\",\n  \"situated\",\n  \"situation\",\n  \"sixfold\",\n  \"sixteen\",\n  \"sixth\",\n  \"sixties\",\n  \"sixtieth\",\n  \"sixtyfold\",\n  \"sizable\",\n  \"sizably\",\n  \"size\",\n  \"sizing\",\n  \"sizzle\",\n  \"sizzling\",\n  \"skater\",\n  \"skating\",\n  \"skedaddle\",\n  \"skeletal\",\n  \"skeleton\",\n  \"skeptic\",\n  \"sketch\",\n  \"skewed\",\n  \"skewer\",\n  \"skid\",\n  \"skied\",\n  \"skier\",\n  \"skies\",\n  \"skiing\",\n  \"skilled\",\n  \"skillet\",\n  \"skillful\",\n  \"skimmed\",\n  \"skimmer\",\n  \"skimming\",\n  \"skimpily\",\n  \"skincare\",\n  \"skinhead\",\n  \"skinless\",\n  \"skinning\",\n  \"skinny\",\n  \"skintight\",\n  \"skipper\",\n  \"skipping\",\n  \"skirmish\",\n  \"skirt\",\n  \"skittle\",\n  \"skydiver\",\n  \"skylight\",\n  \"skyline\",\n  \"skype\",\n  \"skyrocket\",\n  \"skyward\",\n  \"slab\",\n  \"slacked\",\n  \"slacker\",\n  \"slacking\",\n  \"slackness\",\n  \"slacks\",\n  \"slain\",\n  \"slam\",\n  \"slander\",\n  \"slang\",\n  \"slapping\",\n  \"slapstick\",\n  \"slashed\",\n  \"slashing\",\n  \"slate\",\n  \"slather\",\n  \"slaw\",\n  \"sled\",\n  \"sleek\",\n  \"sleep\",\n  \"sleet\",\n  \"sleeve\",\n  \"slept\",\n  \"sliceable\",\n  \"sliced\",\n  \"slicer\",\n  \"slicing\",\n  \"slick\",\n  \"slider\",\n  \"slideshow\",\n  \"sliding\",\n  \"slighted\",\n  \"slighting\",\n  \"slightly\",\n  \"slimness\",\n  \"slimy\",\n  \"slinging\",\n  \"slingshot\",\n  \"slinky\",\n  \"slip\",\n  \"slit\",\n  \"sliver\",\n  \"slobbery\",\n  \"slogan\",\n  \"sloped\",\n  \"sloping\",\n  \"sloppily\",\n  \"sloppy\",\n  \"slot\",\n  \"slouching\",\n  \"slouchy\",\n  \"sludge\",\n  \"slug\",\n  \"slum\",\n  \"slurp\",\n  \"slush\",\n  \"sly\",\n  \"small\",\n  \"smartly\",\n  \"smartness\",\n  \"smasher\",\n  \"smashing\",\n  \"smashup\",\n  \"smell\",\n  \"smelting\",\n  \"smile\",\n  \"smilingly\",\n  \"smirk\",\n  \"smite\",\n  \"smith\",\n  \"smitten\",\n  \"smock\",\n  \"smog\",\n  \"smoked\",\n  \"smokeless\",\n  \"smokiness\",\n  \"smoking\",\n  \"smoky\",\n  \"smolder\",\n  \"smooth\",\n  \"smother\",\n  \"smudge\",\n  \"smudgy\",\n  \"smuggler\",\n  \"smuggling\",\n  \"smugly\",\n  \"smugness\",\n  \"snack\",\n  \"snagged\",\n  \"snaking\",\n  \"snap\",\n  \"snare\",\n  \"snarl\",\n  \"snazzy\",\n  \"sneak\",\n  \"sneer\",\n  \"sneeze\",\n  \"sneezing\",\n  \"snide\",\n  \"sniff\",\n  \"snippet\",\n  \"snipping\",\n  \"snitch\",\n  \"snooper\",\n  \"snooze\",\n  \"snore\",\n  \"snoring\",\n  \"snorkel\",\n  \"snort\",\n  \"snout\",\n  \"snowbird\",\n  \"snowboard\",\n  \"snowbound\",\n  \"snowcap\",\n  \"snowdrift\",\n  \"snowdrop\",\n  \"snowfall\",\n  \"snowfield\",\n  \"snowflake\",\n  \"snowiness\",\n  \"snowless\",\n  \"snowman\",\n  \"snowplow\",\n  \"snowshoe\",\n  \"snowstorm\",\n  \"snowsuit\",\n  \"snowy\",\n  \"snub\",\n  \"snuff\",\n  \"snuggle\",\n  \"snugly\",\n  \"snugness\",\n  \"speak\",\n  \"spearfish\",\n  \"spearhead\",\n  \"spearman\",\n  \"spearmint\",\n  \"species\",\n  \"specimen\",\n  \"specked\",\n  \"speckled\",\n  \"specks\",\n  \"spectacle\",\n  \"spectator\",\n  \"spectrum\",\n  \"speculate\",\n  \"speech\",\n  \"speed\",\n  \"spellbind\",\n  \"speller\",\n  \"spelling\",\n  \"spendable\",\n  \"spender\",\n  \"spending\",\n  \"spent\",\n  \"spew\",\n  \"sphere\",\n  \"spherical\",\n  \"sphinx\",\n  \"spider\",\n  \"spied\",\n  \"spiffy\",\n  \"spill\",\n  \"spilt\",\n  \"spinach\",\n  \"spinal\",\n  \"spindle\",\n  \"spinner\",\n  \"spinning\",\n  \"spinout\",\n  \"spinster\",\n  \"spiny\",\n  \"spiral\",\n  \"spirited\",\n  \"spiritism\",\n  \"spirits\",\n  \"spiritual\",\n  \"splashed\",\n  \"splashing\",\n  \"splashy\",\n  \"splatter\",\n  \"spleen\",\n  \"splendid\",\n  \"splendor\",\n  \"splice\",\n  \"splicing\",\n  \"splinter\",\n  \"splotchy\",\n  \"splurge\",\n  \"spoilage\",\n  \"spoiled\",\n  \"spoiler\",\n  \"spoiling\",\n  \"spoils\",\n  \"spoken\",\n  \"spokesman\",\n  \"sponge\",\n  \"spongy\",\n  \"sponsor\",\n  \"spoof\",\n  \"spookily\",\n  \"spooky\",\n  \"spool\",\n  \"spoon\",\n  \"spore\",\n  \"sporting\",\n  \"sports\",\n  \"sporty\",\n  \"spotless\",\n  \"spotlight\",\n  \"spotted\",\n  \"spotter\",\n  \"spotting\",\n  \"spotty\",\n  \"spousal\",\n  \"spouse\",\n  \"spout\",\n  \"sprain\",\n  \"sprang\",\n  \"sprawl\",\n  \"spray\",\n  \"spree\",\n  \"sprig\",\n  \"spring\",\n  \"sprinkled\",\n  \"sprinkler\",\n  \"sprint\",\n  \"sprite\",\n  \"sprout\",\n  \"spruce\",\n  \"sprung\",\n  \"spry\",\n  \"spud\",\n  \"spur\",\n  \"sputter\",\n  \"spyglass\",\n  \"squabble\",\n  \"squad\",\n  \"squall\",\n  \"squander\",\n  \"squash\",\n  \"squatted\",\n  \"squatter\",\n  \"squatting\",\n  \"squeak\",\n  \"squealer\",\n  \"squealing\",\n  \"squeamish\",\n  \"squeegee\",\n  \"squeeze\",\n  \"squeezing\",\n  \"squid\",\n  \"squiggle\",\n  \"squiggly\",\n  \"squint\",\n  \"squire\",\n  \"squirt\",\n  \"squishier\",\n  \"squishy\",\n  \"stability\",\n  \"stabilize\",\n  \"stable\",\n  \"stack\",\n  \"stadium\",\n  \"staff\",\n  \"stage\",\n  \"staging\",\n  \"stagnant\",\n  \"stagnate\",\n  \"stainable\",\n  \"stained\",\n  \"staining\",\n  \"stainless\",\n  \"stalemate\",\n  \"staleness\",\n  \"stalling\",\n  \"stallion\",\n  \"stamina\",\n  \"stammer\",\n  \"stamp\",\n  \"stand\",\n  \"stank\",\n  \"staple\",\n  \"stapling\",\n  \"starboard\",\n  \"starch\",\n  \"stardom\",\n  \"stardust\",\n  \"starfish\",\n  \"stargazer\",\n  \"staring\",\n  \"stark\",\n  \"starless\",\n  \"starlet\",\n  \"starlight\",\n  \"starlit\",\n  \"starring\",\n  \"starry\",\n  \"starship\",\n  \"starter\",\n  \"starting\",\n  \"startle\",\n  \"startling\",\n  \"startup\",\n  \"starved\",\n  \"starving\",\n  \"stash\",\n  \"state\",\n  \"static\",\n  \"statistic\",\n  \"statue\",\n  \"stature\",\n  \"status\",\n  \"statute\",\n  \"statutory\",\n  \"staunch\",\n  \"stays\",\n  \"steadfast\",\n  \"steadier\",\n  \"steadily\",\n  \"steadying\",\n  \"steam\",\n  \"steed\",\n  \"steep\",\n  \"steerable\",\n  \"steering\",\n  \"steersman\",\n  \"stegosaur\",\n  \"stellar\",\n  \"stem\",\n  \"stench\",\n  \"stencil\",\n  \"step\",\n  \"stereo\",\n  \"sterile\",\n  \"sterility\",\n  \"sterilize\",\n  \"sterling\",\n  \"sternness\",\n  \"sternum\",\n  \"stew\",\n  \"stick\",\n  \"stiffen\",\n  \"stiffly\",\n  \"stiffness\",\n  \"stifle\",\n  \"stifling\",\n  \"stillness\",\n  \"stilt\",\n  \"stimulant\",\n  \"stimulate\",\n  \"stimuli\",\n  \"stimulus\",\n  \"stinger\",\n  \"stingily\",\n  \"stinging\",\n  \"stingray\",\n  \"stingy\",\n  \"stinking\",\n  \"stinky\",\n  \"stipend\",\n  \"stipulate\",\n  \"stir\",\n  \"stitch\",\n  \"stock\",\n  \"stoic\",\n  \"stoke\",\n  \"stole\",\n  \"stomp\",\n  \"stonewall\",\n  \"stoneware\",\n  \"stonework\",\n  \"stoning\",\n  \"stony\",\n  \"stood\",\n  \"stooge\",\n  \"stool\",\n  \"stoop\",\n  \"stoplight\",\n  \"stoppable\",\n  \"stoppage\",\n  \"stopped\",\n  \"stopper\",\n  \"stopping\",\n  \"stopwatch\",\n  \"storable\",\n  \"storage\",\n  \"storeroom\",\n  \"storewide\",\n  \"storm\",\n  \"stout\",\n  \"stove\",\n  \"stowaway\",\n  \"stowing\",\n  \"straddle\",\n  \"straggler\",\n  \"strained\",\n  \"strainer\",\n  \"straining\",\n  \"strangely\",\n  \"stranger\",\n  \"strangle\",\n  \"strategic\",\n  \"strategy\",\n  \"stratus\",\n  \"straw\",\n  \"stray\",\n  \"streak\",\n  \"stream\",\n  \"street\",\n  \"strength\",\n  \"strenuous\",\n  \"strep\",\n  \"stress\",\n  \"stretch\",\n  \"strewn\",\n  \"stricken\",\n  \"strict\",\n  \"stride\",\n  \"strife\",\n  \"strike\",\n  \"striking\",\n  \"strive\",\n  \"striving\",\n  \"strobe\",\n  \"strode\",\n  \"stroller\",\n  \"strongbox\",\n  \"strongly\",\n  \"strongman\",\n  \"struck\",\n  \"structure\",\n  \"strudel\",\n  \"struggle\",\n  \"strum\",\n  \"strung\",\n  \"strut\",\n  \"stubbed\",\n  \"stubble\",\n  \"stubbly\",\n  \"stubborn\",\n  \"stucco\",\n  \"stuck\",\n  \"student\",\n  \"studied\",\n  \"studio\",\n  \"study\",\n  \"stuffed\",\n  \"stuffing\",\n  \"stuffy\",\n  \"stumble\",\n  \"stumbling\",\n  \"stump\",\n  \"stung\",\n  \"stunned\",\n  \"stunner\",\n  \"stunning\",\n  \"stunt\",\n  \"stupor\",\n  \"sturdily\",\n  \"sturdy\",\n  \"styling\",\n  \"stylishly\",\n  \"stylist\",\n  \"stylized\",\n  \"stylus\",\n  \"suave\",\n  \"subarctic\",\n  \"subatomic\",\n  \"subdivide\",\n  \"subdued\",\n  \"subduing\",\n  \"subfloor\",\n  \"subgroup\",\n  \"subheader\",\n  \"subject\",\n  \"sublease\",\n  \"sublet\",\n  \"sublevel\",\n  \"sublime\",\n  \"submarine\",\n  \"submerge\",\n  \"submersed\",\n  \"submitter\",\n  \"subpanel\",\n  \"subpar\",\n  \"subplot\",\n  \"subprime\",\n  \"subscribe\",\n  \"subscript\",\n  \"subsector\",\n  \"subside\",\n  \"subsiding\",\n  \"subsidize\",\n  \"subsidy\",\n  \"subsoil\",\n  \"subsonic\",\n  \"substance\",\n  \"subsystem\",\n  \"subtext\",\n  \"subtitle\",\n  \"subtly\",\n  \"subtotal\",\n  \"subtract\",\n  \"subtype\",\n  \"suburb\",\n  \"subway\",\n  \"subwoofer\",\n  \"subzero\",\n  \"succulent\",\n  \"such\",\n  \"suction\",\n  \"sudden\",\n  \"sudoku\",\n  \"suds\",\n  \"sufferer\",\n  \"suffering\",\n  \"suffice\",\n  \"suffix\",\n  \"suffocate\",\n  \"suffrage\",\n  \"sugar\",\n  \"suggest\",\n  \"suing\",\n  \"suitable\",\n  \"suitably\",\n  \"suitcase\",\n  \"suitor\",\n  \"sulfate\",\n  \"sulfide\",\n  \"sulfite\",\n  \"sulfur\",\n  \"sulk\",\n  \"sullen\",\n  \"sulphate\",\n  \"sulphuric\",\n  \"sultry\",\n  \"superbowl\",\n  \"superglue\",\n  \"superhero\",\n  \"superior\",\n  \"superjet\",\n  \"superman\",\n  \"supermom\",\n  \"supernova\",\n  \"supervise\",\n  \"supper\",\n  \"supplier\",\n  \"supply\",\n  \"support\",\n  \"supremacy\",\n  \"supreme\",\n  \"surcharge\",\n  \"surely\",\n  \"sureness\",\n  \"surface\",\n  \"surfacing\",\n  \"surfboard\",\n  \"surfer\",\n  \"surgery\",\n  \"surgical\",\n  \"surging\",\n  \"surname\",\n  \"surpass\",\n  \"surplus\",\n  \"surprise\",\n  \"surreal\",\n  \"surrender\",\n  \"surrogate\",\n  \"surround\",\n  \"survey\",\n  \"survival\",\n  \"survive\",\n  \"surviving\",\n  \"survivor\",\n  \"sushi\",\n  \"suspect\",\n  \"suspend\",\n  \"suspense\",\n  \"sustained\",\n  \"sustainer\",\n  \"swab\",\n  \"swaddling\",\n  \"swagger\",\n  \"swampland\",\n  \"swan\",\n  \"swapping\",\n  \"swarm\",\n  \"sway\",\n  \"swear\",\n  \"sweat\",\n  \"sweep\",\n  \"swell\",\n  \"swept\",\n  \"swerve\",\n  \"swifter\",\n  \"swiftly\",\n  \"swiftness\",\n  \"swimmable\",\n  \"swimmer\",\n  \"swimming\",\n  \"swimsuit\",\n  \"swimwear\",\n  \"swinger\",\n  \"swinging\",\n  \"swipe\",\n  \"swirl\",\n  \"switch\",\n  \"swivel\",\n  \"swizzle\",\n  \"swooned\",\n  \"swoop\",\n  \"swoosh\",\n  \"swore\",\n  \"sworn\",\n  \"swung\",\n  \"sycamore\",\n  \"sympathy\",\n  \"symphonic\",\n  \"symphony\",\n  \"symptom\",\n  \"synapse\",\n  \"syndrome\",\n  \"synergy\",\n  \"synopses\",\n  \"synopsis\",\n  \"synthesis\",\n  \"synthetic\",\n  \"syrup\",\n  \"system\",\n  \"t-shirt\",\n  \"tabasco\",\n  \"tabby\",\n  \"tableful\",\n  \"tables\",\n  \"tablet\",\n  \"tableware\",\n  \"tabloid\",\n  \"tackiness\",\n  \"tacking\",\n  \"tackle\",\n  \"tackling\",\n  \"tacky\",\n  \"taco\",\n  \"tactful\",\n  \"tactical\",\n  \"tactics\",\n  \"tactile\",\n  \"tactless\",\n  \"tadpole\",\n  \"taekwondo\",\n  \"tag\",\n  \"tainted\",\n  \"take\",\n  \"taking\",\n  \"talcum\",\n  \"talisman\",\n  \"tall\",\n  \"talon\",\n  \"tamale\",\n  \"tameness\",\n  \"tamer\",\n  \"tamper\",\n  \"tank\",\n  \"tanned\",\n  \"tannery\",\n  \"tanning\",\n  \"tantrum\",\n  \"tapeless\",\n  \"tapered\",\n  \"tapering\",\n  \"tapestry\",\n  \"tapioca\",\n  \"tapping\",\n  \"taps\",\n  \"tarantula\",\n  \"target\",\n  \"tarmac\",\n  \"tarnish\",\n  \"tarot\",\n  \"tartar\",\n  \"tartly\",\n  \"tartness\",\n  \"task\",\n  \"tassel\",\n  \"taste\",\n  \"tastiness\",\n  \"tasting\",\n  \"tasty\",\n  \"tattered\",\n  \"tattle\",\n  \"tattling\",\n  \"tattoo\",\n  \"taunt\",\n  \"tavern\",\n  \"thank\",\n  \"that\",\n  \"thaw\",\n  \"theater\",\n  \"theatrics\",\n  \"thee\",\n  \"theft\",\n  \"theme\",\n  \"theology\",\n  \"theorize\",\n  \"thermal\",\n  \"thermos\",\n  \"thesaurus\",\n  \"these\",\n  \"thesis\",\n  \"thespian\",\n  \"thicken\",\n  \"thicket\",\n  \"thickness\",\n  \"thieving\",\n  \"thievish\",\n  \"thigh\",\n  \"thimble\",\n  \"thing\",\n  \"think\",\n  \"thinly\",\n  \"thinner\",\n  \"thinness\",\n  \"thinning\",\n  \"thirstily\",\n  \"thirsting\",\n  \"thirsty\",\n  \"thirteen\",\n  \"thirty\",\n  \"thong\",\n  \"thorn\",\n  \"those\",\n  \"thousand\",\n  \"thrash\",\n  \"thread\",\n  \"threaten\",\n  \"threefold\",\n  \"thrift\",\n  \"thrill\",\n  \"thrive\",\n  \"thriving\",\n  \"throat\",\n  \"throbbing\",\n  \"throng\",\n  \"throttle\",\n  \"throwaway\",\n  \"throwback\",\n  \"thrower\",\n  \"throwing\",\n  \"thud\",\n  \"thumb\",\n  \"thumping\",\n  \"thursday\",\n  \"thus\",\n  \"thwarting\",\n  \"thyself\",\n  \"tiara\",\n  \"tibia\",\n  \"tidal\",\n  \"tidbit\",\n  \"tidiness\",\n  \"tidings\",\n  \"tidy\",\n  \"tiger\",\n  \"tighten\",\n  \"tightly\",\n  \"tightness\",\n  \"tightrope\",\n  \"tightwad\",\n  \"tigress\",\n  \"tile\",\n  \"tiling\",\n  \"till\",\n  \"tilt\",\n  \"timid\",\n  \"timing\",\n  \"timothy\",\n  \"tinderbox\",\n  \"tinfoil\",\n  \"tingle\",\n  \"tingling\",\n  \"tingly\",\n  \"tinker\",\n  \"tinkling\",\n  \"tinsel\",\n  \"tinsmith\",\n  \"tint\",\n  \"tinwork\",\n  \"tiny\",\n  \"tipoff\",\n  \"tipped\",\n  \"tipper\",\n  \"tipping\",\n  \"tiptoeing\",\n  \"tiptop\",\n  \"tiring\",\n  \"tissue\",\n  \"trace\",\n  \"tracing\",\n  \"track\",\n  \"traction\",\n  \"tractor\",\n  \"trade\",\n  \"trading\",\n  \"tradition\",\n  \"traffic\",\n  \"tragedy\",\n  \"trailing\",\n  \"trailside\",\n  \"train\",\n  \"traitor\",\n  \"trance\",\n  \"tranquil\",\n  \"transfer\",\n  \"transform\",\n  \"translate\",\n  \"transpire\",\n  \"transport\",\n  \"transpose\",\n  \"trapdoor\",\n  \"trapeze\",\n  \"trapezoid\",\n  \"trapped\",\n  \"trapper\",\n  \"trapping\",\n  \"traps\",\n  \"trash\",\n  \"travel\",\n  \"traverse\",\n  \"travesty\",\n  \"tray\",\n  \"treachery\",\n  \"treading\",\n  \"treadmill\",\n  \"treason\",\n  \"treat\",\n  \"treble\",\n  \"tree\",\n  \"trekker\",\n  \"tremble\",\n  \"trembling\",\n  \"tremor\",\n  \"trench\",\n  \"trend\",\n  \"trespass\",\n  \"triage\",\n  \"trial\",\n  \"triangle\",\n  \"tribesman\",\n  \"tribunal\",\n  \"tribune\",\n  \"tributary\",\n  \"tribute\",\n  \"triceps\",\n  \"trickery\",\n  \"trickily\",\n  \"tricking\",\n  \"trickle\",\n  \"trickster\",\n  \"tricky\",\n  \"tricolor\",\n  \"tricycle\",\n  \"trident\",\n  \"tried\",\n  \"trifle\",\n  \"trifocals\",\n  \"trillion\",\n  \"trilogy\",\n  \"trimester\",\n  \"trimmer\",\n  \"trimming\",\n  \"trimness\",\n  \"trinity\",\n  \"trio\",\n  \"tripod\",\n  \"tripping\",\n  \"triumph\",\n  \"trivial\",\n  \"trodden\",\n  \"trolling\",\n  \"trombone\",\n  \"trophy\",\n  \"tropical\",\n  \"tropics\",\n  \"trouble\",\n  \"troubling\",\n  \"trough\",\n  \"trousers\",\n  \"trout\",\n  \"trowel\",\n  \"truce\",\n  \"truck\",\n  \"truffle\",\n  \"trump\",\n  \"trunks\",\n  \"trustable\",\n  \"trustee\",\n  \"trustful\",\n  \"trusting\",\n  \"trustless\",\n  \"truth\",\n  \"try\",\n  \"tubby\",\n  \"tubeless\",\n  \"tubular\",\n  \"tucking\",\n  \"tuesday\",\n  \"tug\",\n  \"tuition\",\n  \"tulip\",\n  \"tumble\",\n  \"tumbling\",\n  \"tummy\",\n  \"turban\",\n  \"turbine\",\n  \"turbofan\",\n  \"turbojet\",\n  \"turbulent\",\n  \"turf\",\n  \"turkey\",\n  \"turmoil\",\n  \"turret\",\n  \"turtle\",\n  \"tusk\",\n  \"tutor\",\n  \"tutu\",\n  \"tux\",\n  \"tweak\",\n  \"tweed\",\n  \"tweet\",\n  \"tweezers\",\n  \"twelve\",\n  \"twentieth\",\n  \"twenty\",\n  \"twerp\",\n  \"twice\",\n  \"twiddle\",\n  \"twiddling\",\n  \"twig\",\n  \"twilight\",\n  \"twine\",\n  \"twins\",\n  \"twirl\",\n  \"twistable\",\n  \"twisted\",\n  \"twister\",\n  \"twisting\",\n  \"twisty\",\n  \"twitch\",\n  \"twitter\",\n  \"tycoon\",\n  \"tying\",\n  \"tyke\",\n  \"udder\",\n  \"ultimate\",\n  \"ultimatum\",\n  \"ultra\",\n  \"umbilical\",\n  \"umbrella\",\n  \"umpire\",\n  \"unabashed\",\n  \"unable\",\n  \"unadorned\",\n  \"unadvised\",\n  \"unafraid\",\n  \"unaired\",\n  \"unaligned\",\n  \"unaltered\",\n  \"unarmored\",\n  \"unashamed\",\n  \"unaudited\",\n  \"unawake\",\n  \"unaware\",\n  \"unbaked\",\n  \"unbalance\",\n  \"unbeaten\",\n  \"unbend\",\n  \"unbent\",\n  \"unbiased\",\n  \"unbitten\",\n  \"unblended\",\n  \"unblessed\",\n  \"unblock\",\n  \"unbolted\",\n  \"unbounded\",\n  \"unboxed\",\n  \"unbraided\",\n  \"unbridle\",\n  \"unbroken\",\n  \"unbuckled\",\n  \"unbundle\",\n  \"unburned\",\n  \"unbutton\",\n  \"uncanny\",\n  \"uncapped\",\n  \"uncaring\",\n  \"uncertain\",\n  \"unchain\",\n  \"unchanged\",\n  \"uncharted\",\n  \"uncheck\",\n  \"uncivil\",\n  \"unclad\",\n  \"unclaimed\",\n  \"unclamped\",\n  \"unclasp\",\n  \"uncle\",\n  \"unclip\",\n  \"uncloak\",\n  \"unclog\",\n  \"unclothed\",\n  \"uncoated\",\n  \"uncoiled\",\n  \"uncolored\",\n  \"uncombed\",\n  \"uncommon\",\n  \"uncooked\",\n  \"uncork\",\n  \"uncorrupt\",\n  \"uncounted\",\n  \"uncouple\",\n  \"uncouth\",\n  \"uncover\",\n  \"uncross\",\n  \"uncrown\",\n  \"uncrushed\",\n  \"uncured\",\n  \"uncurious\",\n  \"uncurled\",\n  \"uncut\",\n  \"undamaged\",\n  \"undated\",\n  \"undaunted\",\n  \"undead\",\n  \"undecided\",\n  \"undefined\",\n  \"underage\",\n  \"underarm\",\n  \"undercoat\",\n  \"undercook\",\n  \"undercut\",\n  \"underdog\",\n  \"underdone\",\n  \"underfed\",\n  \"underfeed\",\n  \"underfoot\",\n  \"undergo\",\n  \"undergrad\",\n  \"underhand\",\n  \"underline\",\n  \"underling\",\n  \"undermine\",\n  \"undermost\",\n  \"underpaid\",\n  \"underpass\",\n  \"underpay\",\n  \"underrate\",\n  \"undertake\",\n  \"undertone\",\n  \"undertook\",\n  \"undertow\",\n  \"underuse\",\n  \"underwear\",\n  \"underwent\",\n  \"underwire\",\n  \"undesired\",\n  \"undiluted\",\n  \"undivided\",\n  \"undocked\",\n  \"undoing\",\n  \"undone\",\n  \"undrafted\",\n  \"undress\",\n  \"undrilled\",\n  \"undusted\",\n  \"undying\",\n  \"unearned\",\n  \"unearth\",\n  \"unease\",\n  \"uneasily\",\n  \"uneasy\",\n  \"uneatable\",\n  \"uneaten\",\n  \"unedited\",\n  \"unelected\",\n  \"unending\",\n  \"unengaged\",\n  \"unenvied\",\n  \"unequal\",\n  \"unethical\",\n  \"uneven\",\n  \"unexpired\",\n  \"unexposed\",\n  \"unfailing\",\n  \"unfair\",\n  \"unfasten\",\n  \"unfazed\",\n  \"unfeeling\",\n  \"unfiled\",\n  \"unfilled\",\n  \"unfitted\",\n  \"unfitting\",\n  \"unfixable\",\n  \"unfixed\",\n  \"unflawed\",\n  \"unfocused\",\n  \"unfold\",\n  \"unfounded\",\n  \"unframed\",\n  \"unfreeze\",\n  \"unfrosted\",\n  \"unfrozen\",\n  \"unfunded\",\n  \"unglazed\",\n  \"ungloved\",\n  \"unglue\",\n  \"ungodly\",\n  \"ungraded\",\n  \"ungreased\",\n  \"unguarded\",\n  \"unguided\",\n  \"unhappily\",\n  \"unhappy\",\n  \"unharmed\",\n  \"unhealthy\",\n  \"unheard\",\n  \"unhearing\",\n  \"unheated\",\n  \"unhelpful\",\n  \"unhidden\",\n  \"unhinge\",\n  \"unhitched\",\n  \"unholy\",\n  \"unhook\",\n  \"unicorn\",\n  \"unicycle\",\n  \"unified\",\n  \"unifier\",\n  \"uniformed\",\n  \"uniformly\",\n  \"unify\",\n  \"unimpeded\",\n  \"uninjured\",\n  \"uninstall\",\n  \"uninsured\",\n  \"uninvited\",\n  \"union\",\n  \"uniquely\",\n  \"unisexual\",\n  \"unison\",\n  \"unissued\",\n  \"unit\",\n  \"universal\",\n  \"universe\",\n  \"unjustly\",\n  \"unkempt\",\n  \"unkind\",\n  \"unknotted\",\n  \"unknowing\",\n  \"unknown\",\n  \"unlaced\",\n  \"unlatch\",\n  \"unlawful\",\n  \"unleaded\",\n  \"unlearned\",\n  \"unleash\",\n  \"unless\",\n  \"unleveled\",\n  \"unlighted\",\n  \"unlikable\",\n  \"unlimited\",\n  \"unlined\",\n  \"unlinked\",\n  \"unlisted\",\n  \"unlit\",\n  \"unlivable\",\n  \"unloaded\",\n  \"unloader\",\n  \"unlocked\",\n  \"unlocking\",\n  \"unlovable\",\n  \"unloved\",\n  \"unlovely\",\n  \"unloving\",\n  \"unluckily\",\n  \"unlucky\",\n  \"unmade\",\n  \"unmanaged\",\n  \"unmanned\",\n  \"unmapped\",\n  \"unmarked\",\n  \"unmasked\",\n  \"unmasking\",\n  \"unmatched\",\n  \"unmindful\",\n  \"unmixable\",\n  \"unmixed\",\n  \"unmolded\",\n  \"unmoral\",\n  \"unmovable\",\n  \"unmoved\",\n  \"unmoving\",\n  \"unnamable\",\n  \"unnamed\",\n  \"unnatural\",\n  \"unneeded\",\n  \"unnerve\",\n  \"unnerving\",\n  \"unnoticed\",\n  \"unopened\",\n  \"unopposed\",\n  \"unpack\",\n  \"unpadded\",\n  \"unpaid\",\n  \"unpainted\",\n  \"unpaired\",\n  \"unpaved\",\n  \"unpeeled\",\n  \"unpicked\",\n  \"unpiloted\",\n  \"unpinned\",\n  \"unplanned\",\n  \"unplanted\",\n  \"unpleased\",\n  \"unpledged\",\n  \"unplowed\",\n  \"unplug\",\n  \"unpopular\",\n  \"unproven\",\n  \"unquote\",\n  \"unranked\",\n  \"unrated\",\n  \"unraveled\",\n  \"unreached\",\n  \"unread\",\n  \"unreal\",\n  \"unreeling\",\n  \"unrefined\",\n  \"unrelated\",\n  \"unrented\",\n  \"unrest\",\n  \"unretired\",\n  \"unrevised\",\n  \"unrigged\",\n  \"unripe\",\n  \"unrivaled\",\n  \"unroasted\",\n  \"unrobed\",\n  \"unroll\",\n  \"unruffled\",\n  \"unruly\",\n  \"unrushed\",\n  \"unsaddle\",\n  \"unsafe\",\n  \"unsaid\",\n  \"unsalted\",\n  \"unsaved\",\n  \"unsavory\",\n  \"unscathed\",\n  \"unscented\",\n  \"unscrew\",\n  \"unsealed\",\n  \"unseated\",\n  \"unsecured\",\n  \"unseeing\",\n  \"unseemly\",\n  \"unseen\",\n  \"unselect\",\n  \"unselfish\",\n  \"unsent\",\n  \"unsettled\",\n  \"unshackle\",\n  \"unshaken\",\n  \"unshaved\",\n  \"unshaven\",\n  \"unsheathe\",\n  \"unshipped\",\n  \"unsightly\",\n  \"unsigned\",\n  \"unskilled\",\n  \"unsliced\",\n  \"unsmooth\",\n  \"unsnap\",\n  \"unsocial\",\n  \"unsoiled\",\n  \"unsold\",\n  \"unsolved\",\n  \"unsorted\",\n  \"unspoiled\",\n  \"unspoken\",\n  \"unstable\",\n  \"unstaffed\",\n  \"unstamped\",\n  \"unsteady\",\n  \"unsterile\",\n  \"unstirred\",\n  \"unstitch\",\n  \"unstopped\",\n  \"unstuck\",\n  \"unstuffed\",\n  \"unstylish\",\n  \"unsubtle\",\n  \"unsubtly\",\n  \"unsuited\",\n  \"unsure\",\n  \"unsworn\",\n  \"untagged\",\n  \"untainted\",\n  \"untaken\",\n  \"untamed\",\n  \"untangled\",\n  \"untapped\",\n  \"untaxed\",\n  \"unthawed\",\n  \"unthread\",\n  \"untidy\",\n  \"untie\",\n  \"until\",\n  \"untimed\",\n  \"untimely\",\n  \"untitled\",\n  \"untoasted\",\n  \"untold\",\n  \"untouched\",\n  \"untracked\",\n  \"untrained\",\n  \"untreated\",\n  \"untried\",\n  \"untrimmed\",\n  \"untrue\",\n  \"untruth\",\n  \"unturned\",\n  \"untwist\",\n  \"untying\",\n  \"unusable\",\n  \"unused\",\n  \"unusual\",\n  \"unvalued\",\n  \"unvaried\",\n  \"unvarying\",\n  \"unveiled\",\n  \"unveiling\",\n  \"unvented\",\n  \"unviable\",\n  \"unvisited\",\n  \"unvocal\",\n  \"unwanted\",\n  \"unwarlike\",\n  \"unwary\",\n  \"unwashed\",\n  \"unwatched\",\n  \"unweave\",\n  \"unwed\",\n  \"unwelcome\",\n  \"unwell\",\n  \"unwieldy\",\n  \"unwilling\",\n  \"unwind\",\n  \"unwired\",\n  \"unwitting\",\n  \"unwomanly\",\n  \"unworldly\",\n  \"unworn\",\n  \"unworried\",\n  \"unworthy\",\n  \"unwound\",\n  \"unwoven\",\n  \"unwrapped\",\n  \"unwritten\",\n  \"unzip\",\n  \"upbeat\",\n  \"upchuck\",\n  \"upcoming\",\n  \"upcountry\",\n  \"update\",\n  \"upfront\",\n  \"upgrade\",\n  \"upheaval\",\n  \"upheld\",\n  \"uphill\",\n  \"uphold\",\n  \"uplifted\",\n  \"uplifting\",\n  \"upload\",\n  \"upon\",\n  \"upper\",\n  \"upright\",\n  \"uprising\",\n  \"upriver\",\n  \"uproar\",\n  \"uproot\",\n  \"upscale\",\n  \"upside\",\n  \"upstage\",\n  \"upstairs\",\n  \"upstart\",\n  \"upstate\",\n  \"upstream\",\n  \"upstroke\",\n  \"upswing\",\n  \"uptake\",\n  \"uptight\",\n  \"uptown\",\n  \"upturned\",\n  \"upward\",\n  \"upwind\",\n  \"uranium\",\n  \"urban\",\n  \"urchin\",\n  \"urethane\",\n  \"urgency\",\n  \"urgent\",\n  \"urging\",\n  \"urologist\",\n  \"urology\",\n  \"usable\",\n  \"usage\",\n  \"useable\",\n  \"used\",\n  \"uselessly\",\n  \"user\",\n  \"usher\",\n  \"usual\",\n  \"utensil\",\n  \"utility\",\n  \"utilize\",\n  \"utmost\",\n  \"utopia\",\n  \"utter\",\n  \"vacancy\",\n  \"vacant\",\n  \"vacate\",\n  \"vacation\",\n  \"vagabond\",\n  \"vagrancy\",\n  \"vagrantly\",\n  \"vaguely\",\n  \"vagueness\",\n  \"valiant\",\n  \"valid\",\n  \"valium\",\n  \"valley\",\n  \"valuables\",\n  \"value\",\n  \"vanilla\",\n  \"vanish\",\n  \"vanity\",\n  \"vanquish\",\n  \"vantage\",\n  \"vaporizer\",\n  \"variable\",\n  \"variably\",\n  \"varied\",\n  \"variety\",\n  \"various\",\n  \"varmint\",\n  \"varnish\",\n  \"varsity\",\n  \"varying\",\n  \"vascular\",\n  \"vaseline\",\n  \"vastly\",\n  \"vastness\",\n  \"veal\",\n  \"vegan\",\n  \"veggie\",\n  \"vehicular\",\n  \"velcro\",\n  \"velocity\",\n  \"velvet\",\n  \"vendetta\",\n  \"vending\",\n  \"vendor\",\n  \"veneering\",\n  \"vengeful\",\n  \"venomous\",\n  \"ventricle\",\n  \"venture\",\n  \"venue\",\n  \"venus\",\n  \"verbalize\",\n  \"verbally\",\n  \"verbose\",\n  \"verdict\",\n  \"verify\",\n  \"verse\",\n  \"version\",\n  \"versus\",\n  \"vertebrae\",\n  \"vertical\",\n  \"vertigo\",\n  \"very\",\n  \"vessel\",\n  \"vest\",\n  \"veteran\",\n  \"veto\",\n  \"vexingly\",\n  \"viability\",\n  \"viable\",\n  \"vibes\",\n  \"vice\",\n  \"vicinity\",\n  \"victory\",\n  \"video\",\n  \"viewable\",\n  \"viewer\",\n  \"viewing\",\n  \"viewless\",\n  \"viewpoint\",\n  \"vigorous\",\n  \"village\",\n  \"villain\",\n  \"vindicate\",\n  \"vineyard\",\n  \"vintage\",\n  \"violate\",\n  \"violation\",\n  \"violator\",\n  \"violet\",\n  \"violin\",\n  \"viper\",\n  \"viral\",\n  \"virtual\",\n  \"virtuous\",\n  \"virus\",\n  \"visa\",\n  \"viscosity\",\n  \"viscous\",\n  \"viselike\",\n  \"visible\",\n  \"visibly\",\n  \"vision\",\n  \"visiting\",\n  \"visitor\",\n  \"visor\",\n  \"vista\",\n  \"vitality\",\n  \"vitalize\",\n  \"vitally\",\n  \"vitamins\",\n  \"vivacious\",\n  \"vividly\",\n  \"vividness\",\n  \"vixen\",\n  \"vocalist\",\n  \"vocalize\",\n  \"vocally\",\n  \"vocation\",\n  \"voice\",\n  \"voicing\",\n  \"void\",\n  \"volatile\",\n  \"volley\",\n  \"voltage\",\n  \"volumes\",\n  \"voter\",\n  \"voting\",\n  \"voucher\",\n  \"vowed\",\n  \"vowel\",\n  \"voyage\",\n  \"wackiness\",\n  \"wad\",\n  \"wafer\",\n  \"waffle\",\n  \"waged\",\n  \"wager\",\n  \"wages\",\n  \"waggle\",\n  \"wagon\",\n  \"wake\",\n  \"waking\",\n  \"walk\",\n  \"walmart\",\n  \"walnut\",\n  \"walrus\",\n  \"waltz\",\n  \"wand\",\n  \"wannabe\",\n  \"wanted\",\n  \"wanting\",\n  \"wasabi\",\n  \"washable\",\n  \"washbasin\",\n  \"washboard\",\n  \"washbowl\",\n  \"washcloth\",\n  \"washday\",\n  \"washed\",\n  \"washer\",\n  \"washhouse\",\n  \"washing\",\n  \"washout\",\n  \"washroom\",\n  \"washstand\",\n  \"washtub\",\n  \"wasp\",\n  \"wasting\",\n  \"watch\",\n  \"water\",\n  \"waviness\",\n  \"waving\",\n  \"wavy\",\n  \"whacking\",\n  \"whacky\",\n  \"wham\",\n  \"wharf\",\n  \"wheat\",\n  \"whenever\",\n  \"whiff\",\n  \"whimsical\",\n  \"whinny\",\n  \"whiny\",\n  \"whisking\",\n  \"whoever\",\n  \"whole\",\n  \"whomever\",\n  \"whoopee\",\n  \"whooping\",\n  \"whoops\",\n  \"why\",\n  \"wick\",\n  \"widely\",\n  \"widen\",\n  \"widget\",\n  \"widow\",\n  \"width\",\n  \"wieldable\",\n  \"wielder\",\n  \"wife\",\n  \"wifi\",\n  \"wikipedia\",\n  \"wildcard\",\n  \"wildcat\",\n  \"wilder\",\n  \"wildfire\",\n  \"wildfowl\",\n  \"wildland\",\n  \"wildlife\",\n  \"wildly\",\n  \"wildness\",\n  \"willed\",\n  \"willfully\",\n  \"willing\",\n  \"willow\",\n  \"willpower\",\n  \"wilt\",\n  \"wimp\",\n  \"wince\",\n  \"wincing\",\n  \"wind\",\n  \"wing\",\n  \"winking\",\n  \"winner\",\n  \"winnings\",\n  \"winter\",\n  \"wipe\",\n  \"wired\",\n  \"wireless\",\n  \"wiring\",\n  \"wiry\",\n  \"wisdom\",\n  \"wise\",\n  \"wish\",\n  \"wisplike\",\n  \"wispy\",\n  \"wistful\",\n  \"wizard\",\n  \"wobble\",\n  \"wobbling\",\n  \"wobbly\",\n  \"wok\",\n  \"wolf\",\n  \"wolverine\",\n  \"womanhood\",\n  \"womankind\",\n  \"womanless\",\n  \"womanlike\",\n  \"womanly\",\n  \"womb\",\n  \"woof\",\n  \"wooing\",\n  \"wool\",\n  \"woozy\",\n  \"word\",\n  \"work\",\n  \"worried\",\n  \"worrier\",\n  \"worrisome\",\n  \"worry\",\n  \"worsening\",\n  \"worshiper\",\n  \"worst\",\n  \"wound\",\n  \"woven\",\n  \"wow\",\n  \"wrangle\",\n  \"wrath\",\n  \"wreath\",\n  \"wreckage\",\n  \"wrecker\",\n  \"wrecking\",\n  \"wrench\",\n  \"wriggle\",\n  \"wriggly\",\n  \"wrinkle\",\n  \"wrinkly\",\n  \"wrist\",\n  \"writing\",\n  \"written\",\n  \"wrongdoer\",\n  \"wronged\",\n  \"wrongful\",\n  \"wrongly\",\n  \"wrongness\",\n  \"wrought\",\n  \"xbox\",\n  \"xerox\",\n  \"yahoo\",\n  \"yam\",\n  \"yanking\",\n  \"yapping\",\n  \"yard\",\n  \"yarn\",\n  \"yeah\",\n  \"yearbook\",\n  \"yearling\",\n  \"yearly\",\n  \"yearning\",\n  \"yeast\",\n  \"yelling\",\n  \"yelp\",\n  \"yen\",\n  \"yesterday\",\n  \"yiddish\",\n  \"yield\",\n  \"yin\",\n  \"yippee\",\n  \"yo-yo\",\n  \"yodel\",\n  \"yoga\",\n  \"yogurt\",\n  \"yonder\",\n  \"yoyo\",\n  \"yummy\",\n  \"zap\",\n  \"zealous\",\n  \"zebra\",\n  \"zen\",\n  \"zeppelin\",\n  \"zero\",\n  \"zestfully\",\n  \"zesty\",\n  \"zigzagged\",\n  \"zipfile\",\n  \"zipping\",\n  \"zippy\",\n  \"zips\",\n  \"zit\",\n  \"zodiac\",\n  \"zombie\",\n  \"zone\",\n  \"zoning\",\n  \"zookeeper\",\n  \"zoologist\",\n  \"zoology\",\n  \"zoom\",\n];\n","/** Request format for passphrase credential generation.\n *  The members of this type may be `undefined` when the user is\n *  generating a password.\n */\nexport type PassphraseGenerationOptions = {\n  /** The number of words to include in the passphrase.\n   * This value defaults to 3.\n   */\n  numWords?: number;\n\n  /** The ASCII separator character to use between words in the passphrase.\n   * This value defaults to a dash.\n   * If multiple characters appear in the string, only the first character is used.\n   */\n  wordSeparator?: string;\n\n  /** `true` when the first character of every word should be capitalized.\n   * This value defaults to `false`.\n   */\n  capitalize?: boolean;\n\n  /** `true` when a number should be included in the passphrase.\n   * This value defaults to `false`.\n   */\n  includeNumber?: boolean;\n};\n\n/** The default options for passphrase generation. */\nexport const DefaultPassphraseGenerationOptions: Partial<PassphraseGenerationOptions> =\n  Object.freeze({\n    numWords: 3,\n    wordSeparator: \"-\",\n    capitalize: false,\n    includeNumber: false,\n  });\n","import { PolicyEvaluator } from \"../abstractions/policy-evaluator.abstraction\";\n\nimport {\n  DefaultPassphraseGenerationOptions,\n  PassphraseGenerationOptions,\n} from \"./passphrase-generation-options\";\nimport { PassphraseGeneratorPolicy } from \"./passphrase-generator-policy\";\n\ntype Boundary = {\n  readonly min: number;\n  readonly max: number;\n};\n\nfunction initializeBoundaries() {\n  const numWords = Object.freeze({\n    min: 3,\n    max: 20,\n  });\n\n  return Object.freeze({\n    numWords,\n  });\n}\n\n/** Immutable default boundaries for passphrase generation.\n * These are used when the policy does not override a value.\n */\nexport const DefaultBoundaries = initializeBoundaries();\n\n/** Enforces policy for passphrase generation options.\n */\nexport class PassphraseGeneratorOptionsEvaluator\n  implements PolicyEvaluator<PassphraseGeneratorPolicy, PassphraseGenerationOptions>\n{\n  // This design is not ideal, but it is a step towards a more robust passphrase\n  // generator. Ideally, `sanitize` would be implemented on an options class,\n  // and `applyPolicy` would be implemented on a policy class, \"mise en place\".\n  //\n  // The current design of the passphrase generator, unfortunately, would require\n  // a substantial rewrite to make this feasible. Hopefully this change can be\n  // applied when the passphrase generator is ported to rust.\n\n  /** Policy applied by the evaluator.\n   */\n  readonly policy: PassphraseGeneratorPolicy;\n\n  /** Boundaries for the number of words allowed in the password.\n   */\n  readonly numWords: Boundary;\n\n  /** Instantiates the evaluator.\n   * @param policy The policy applied by the evaluator. When this conflicts with\n   *               the defaults, the policy takes precedence.\n   */\n  constructor(policy: PassphraseGeneratorPolicy) {\n    function createBoundary(value: number, defaultBoundary: Boundary): Boundary {\n      const boundary = {\n        min: Math.max(defaultBoundary.min, value),\n        max: Math.max(defaultBoundary.max, value),\n      };\n\n      return boundary;\n    }\n\n    this.policy = structuredClone(policy);\n    this.numWords = createBoundary(policy.minNumberWords, DefaultBoundaries.numWords);\n  }\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect(): boolean {\n    const policies = [\n      this.policy.capitalize,\n      this.policy.includeNumber,\n      this.policy.minNumberWords > DefaultBoundaries.numWords.min,\n    ];\n\n    return policies.includes(true);\n  }\n\n  /** Apply policy to the input options.\n   *  @param options The options to build from. These options are not altered.\n   *  @returns A new password generation request with policy applied.\n   */\n  applyPolicy(options: PassphraseGenerationOptions): PassphraseGenerationOptions {\n    function fitToBounds(value: number, boundaries: Boundary) {\n      const { min, max } = boundaries;\n\n      const withUpperBound = Math.min(value ?? boundaries.min, max);\n      const withLowerBound = Math.max(withUpperBound, min);\n\n      return withLowerBound;\n    }\n\n    // apply policy overrides\n    const capitalize = this.policy.capitalize || options.capitalize || false;\n    const includeNumber = this.policy.includeNumber || options.includeNumber || false;\n\n    // apply boundaries\n    const numWords = fitToBounds(options.numWords, this.numWords);\n\n    return {\n      ...options,\n      numWords,\n      capitalize,\n      includeNumber,\n    };\n  }\n\n  /** Ensures internal options consistency.\n   *  @param options The options to cascade. These options are not altered.\n   *  @returns A passphrase generation request with cascade applied.\n   */\n  sanitize(options: PassphraseGenerationOptions): PassphraseGenerationOptions {\n    // ensure words are separated by a single character or the empty string\n    const wordSeparator =\n      options.wordSeparator === \"\"\n        ? \"\"\n        : options.wordSeparator?.[0] ?? DefaultPassphraseGenerationOptions.wordSeparator;\n\n    return {\n      ...options,\n      wordSeparator,\n    };\n  }\n}\n","import { from } from \"rxjs\";\n\nimport { PolicyService } from \"../../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { PasswordGeneratorPolicyOptions } from \"../../../admin-console/models/domain/password-generator-policy-options\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { EFFLongWordList } from \"../../../platform/misc/wordlist\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { PasswordGenerationServiceAbstraction } from \"../abstractions/password-generation.service.abstraction\";\nimport { PassphraseGeneratorOptionsEvaluator } from \"../passphrase/passphrase-generator-options-evaluator\";\n\nimport { GeneratedPasswordHistory } from \"./generated-password-history\";\nimport { PasswordGeneratorOptions } from \"./password-generator-options\";\nimport { PasswordGeneratorOptionsEvaluator } from \"./password-generator-options-evaluator\";\n\nconst DefaultOptions: PasswordGeneratorOptions = {\n  length: 14,\n  minLength: 5,\n  ambiguous: false,\n  number: true,\n  minNumber: 1,\n  uppercase: true,\n  minUppercase: 0,\n  lowercase: true,\n  minLowercase: 0,\n  special: false,\n  minSpecial: 0,\n  type: \"password\",\n  numWords: 3,\n  wordSeparator: \"-\",\n  capitalize: false,\n  includeNumber: false,\n};\n\nconst DefaultPolicy = new PasswordGeneratorPolicyOptions();\n\nconst MaxPasswordsInHistory = 100;\n\nexport class PasswordGenerationService implements PasswordGenerationServiceAbstraction {\n  constructor(\n    private cryptoService: CryptoService,\n    private policyService: PolicyService,\n    private stateService: StateService,\n  ) {}\n\n  async generatePassword(options: PasswordGeneratorOptions): Promise<string> {\n    if ((options.type ?? DefaultOptions.type) === \"passphrase\") {\n      return this.generatePassphrase({ ...DefaultOptions, ...options });\n    }\n\n    const evaluator = new PasswordGeneratorOptionsEvaluator(DefaultPolicy);\n    const o = evaluator.sanitize({ ...DefaultOptions, ...options });\n\n    const positions: string[] = [];\n    if (o.lowercase && o.minLowercase > 0) {\n      for (let i = 0; i < o.minLowercase; i++) {\n        positions.push(\"l\");\n      }\n    }\n    if (o.uppercase && o.minUppercase > 0) {\n      for (let i = 0; i < o.minUppercase; i++) {\n        positions.push(\"u\");\n      }\n    }\n    if (o.number && o.minNumber > 0) {\n      for (let i = 0; i < o.minNumber; i++) {\n        positions.push(\"n\");\n      }\n    }\n    if (o.special && o.minSpecial > 0) {\n      for (let i = 0; i < o.minSpecial; i++) {\n        positions.push(\"s\");\n      }\n    }\n    while (positions.length < o.length) {\n      positions.push(\"a\");\n    }\n\n    // shuffle\n    await this.shuffleArray(positions);\n\n    // build out the char sets\n    let allCharSet = \"\";\n\n    let lowercaseCharSet = \"abcdefghijkmnopqrstuvwxyz\";\n    if (o.ambiguous) {\n      lowercaseCharSet += \"l\";\n    }\n    if (o.lowercase) {\n      allCharSet += lowercaseCharSet;\n    }\n\n    let uppercaseCharSet = \"ABCDEFGHJKLMNPQRSTUVWXYZ\";\n    if (o.ambiguous) {\n      uppercaseCharSet += \"IO\";\n    }\n    if (o.uppercase) {\n      allCharSet += uppercaseCharSet;\n    }\n\n    let numberCharSet = \"23456789\";\n    if (o.ambiguous) {\n      numberCharSet += \"01\";\n    }\n    if (o.number) {\n      allCharSet += numberCharSet;\n    }\n\n    const specialCharSet = \"!@#$%^&*\";\n    if (o.special) {\n      allCharSet += specialCharSet;\n    }\n\n    let password = \"\";\n    for (let i = 0; i < o.length; i++) {\n      let positionChars: string;\n      switch (positions[i]) {\n        case \"l\":\n          positionChars = lowercaseCharSet;\n          break;\n        case \"u\":\n          positionChars = uppercaseCharSet;\n          break;\n        case \"n\":\n          positionChars = numberCharSet;\n          break;\n        case \"s\":\n          positionChars = specialCharSet;\n          break;\n        case \"a\":\n          positionChars = allCharSet;\n          break;\n        default:\n          break;\n      }\n\n      const randomCharIndex = await this.cryptoService.randomNumber(0, positionChars.length - 1);\n      password += positionChars.charAt(randomCharIndex);\n    }\n\n    return password;\n  }\n\n  async generatePassphrase(options: PasswordGeneratorOptions): Promise<string> {\n    const evaluator = new PassphraseGeneratorOptionsEvaluator(DefaultPolicy);\n    const o = evaluator.sanitize({ ...DefaultOptions, ...options });\n\n    if (o.numWords == null || o.numWords <= 2) {\n      o.numWords = DefaultOptions.numWords;\n    }\n    if (o.capitalize == null) {\n      o.capitalize = false;\n    }\n    if (o.includeNumber == null) {\n      o.includeNumber = false;\n    }\n\n    const listLength = EFFLongWordList.length - 1;\n    const wordList = new Array(o.numWords);\n    for (let i = 0; i < o.numWords; i++) {\n      const wordIndex = await this.cryptoService.randomNumber(0, listLength);\n      if (o.capitalize) {\n        wordList[i] = this.capitalize(EFFLongWordList[wordIndex]);\n      } else {\n        wordList[i] = EFFLongWordList[wordIndex];\n      }\n    }\n\n    if (o.includeNumber) {\n      await this.appendRandomNumberToRandomWord(wordList);\n    }\n    return wordList.join(o.wordSeparator);\n  }\n\n  getOptions$() {\n    return from(this.getOptions());\n  }\n\n  async getOptions(): Promise<[PasswordGeneratorOptions, PasswordGeneratorPolicyOptions]> {\n    let options = await this.stateService.getPasswordGenerationOptions();\n    if (options == null) {\n      options = Object.assign({}, DefaultOptions);\n    } else {\n      options = Object.assign({}, DefaultOptions, options);\n    }\n    await this.stateService.setPasswordGenerationOptions(options);\n    const enforcedOptions = await this.enforcePasswordGeneratorPoliciesOnOptions(options);\n    options = enforcedOptions[0];\n    return [options, enforcedOptions[1]];\n  }\n\n  async enforcePasswordGeneratorPoliciesOnOptions(\n    options: PasswordGeneratorOptions,\n  ): Promise<[PasswordGeneratorOptions, PasswordGeneratorPolicyOptions]> {\n    let policy = await this.getPasswordGeneratorPolicyOptions();\n    policy = policy ?? new PasswordGeneratorPolicyOptions();\n\n    // Force default type if password/passphrase selected via policy\n    if (policy.defaultType === \"password\" || policy.defaultType === \"passphrase\") {\n      options.type = policy.defaultType;\n    }\n\n    const evaluator =\n      options.type == \"password\"\n        ? new PasswordGeneratorOptionsEvaluator(policy)\n        : new PassphraseGeneratorOptionsEvaluator(policy);\n\n    // Ensure the options to pass the current rules\n    const withPolicy = evaluator.applyPolicy(options);\n    const sanitized = evaluator.sanitize(withPolicy);\n\n    // callers assume this function updates the options parameter\n    const result = Object.assign(options, sanitized);\n    return [result, policy];\n  }\n\n  async getPasswordGeneratorPolicyOptions(): Promise<PasswordGeneratorPolicyOptions> {\n    const policies = await this.policyService?.getAll(PolicyType.PasswordGenerator);\n    let enforcedOptions: PasswordGeneratorPolicyOptions = null;\n\n    if (policies == null || policies.length === 0) {\n      return enforcedOptions;\n    }\n\n    policies.forEach((currentPolicy) => {\n      if (!currentPolicy.enabled || currentPolicy.data == null) {\n        return;\n      }\n\n      if (enforcedOptions == null) {\n        enforcedOptions = new PasswordGeneratorPolicyOptions();\n      }\n\n      // Password wins in multi-org collisions\n      if (currentPolicy.data.defaultType != null && enforcedOptions.defaultType !== \"password\") {\n        enforcedOptions.defaultType = currentPolicy.data.defaultType;\n      }\n\n      if (\n        currentPolicy.data.minLength != null &&\n        currentPolicy.data.minLength > enforcedOptions.minLength\n      ) {\n        enforcedOptions.minLength = currentPolicy.data.minLength;\n      }\n\n      if (currentPolicy.data.useUpper) {\n        enforcedOptions.useUppercase = true;\n      }\n\n      if (currentPolicy.data.useLower) {\n        enforcedOptions.useLowercase = true;\n      }\n\n      if (currentPolicy.data.useNumbers) {\n        enforcedOptions.useNumbers = true;\n      }\n\n      if (\n        currentPolicy.data.minNumbers != null &&\n        currentPolicy.data.minNumbers > enforcedOptions.numberCount\n      ) {\n        enforcedOptions.numberCount = currentPolicy.data.minNumbers;\n      }\n\n      if (currentPolicy.data.useSpecial) {\n        enforcedOptions.useSpecial = true;\n      }\n\n      if (\n        currentPolicy.data.minSpecial != null &&\n        currentPolicy.data.minSpecial > enforcedOptions.specialCount\n      ) {\n        enforcedOptions.specialCount = currentPolicy.data.minSpecial;\n      }\n\n      if (\n        currentPolicy.data.minNumberWords != null &&\n        currentPolicy.data.minNumberWords > enforcedOptions.minNumberWords\n      ) {\n        enforcedOptions.minNumberWords = currentPolicy.data.minNumberWords;\n      }\n\n      if (currentPolicy.data.capitalize) {\n        enforcedOptions.capitalize = true;\n      }\n\n      if (currentPolicy.data.includeNumber) {\n        enforcedOptions.includeNumber = true;\n      }\n    });\n\n    return enforcedOptions;\n  }\n\n  async saveOptions(options: PasswordGeneratorOptions) {\n    await this.stateService.setPasswordGenerationOptions(options);\n  }\n\n  async getHistory(): Promise<GeneratedPasswordHistory[]> {\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      return new Array<GeneratedPasswordHistory>();\n    }\n\n    if ((await this.stateService.getDecryptedPasswordGenerationHistory()) == null) {\n      const encrypted = await this.stateService.getEncryptedPasswordGenerationHistory();\n      const decrypted = await this.decryptHistory(encrypted);\n      await this.stateService.setDecryptedPasswordGenerationHistory(decrypted);\n    }\n\n    const passwordGenerationHistory =\n      await this.stateService.getDecryptedPasswordGenerationHistory();\n    return passwordGenerationHistory != null\n      ? passwordGenerationHistory\n      : new Array<GeneratedPasswordHistory>();\n  }\n\n  async addHistory(password: string): Promise<void> {\n    // Cannot add new history if no key is available\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      return;\n    }\n\n    const currentHistory = await this.getHistory();\n\n    // Prevent duplicates\n    if (this.matchesPrevious(password, currentHistory)) {\n      return;\n    }\n\n    currentHistory.unshift(new GeneratedPasswordHistory(password, Date.now()));\n\n    // Remove old items.\n    if (currentHistory.length > MaxPasswordsInHistory) {\n      currentHistory.pop();\n    }\n\n    const newHistory = await this.encryptHistory(currentHistory);\n    await this.stateService.setDecryptedPasswordGenerationHistory(currentHistory);\n    return await this.stateService.setEncryptedPasswordGenerationHistory(newHistory);\n  }\n\n  async clear(userId?: string): Promise<GeneratedPasswordHistory[]> {\n    await this.stateService.setEncryptedPasswordGenerationHistory(null, { userId: userId });\n    await this.stateService.setDecryptedPasswordGenerationHistory(null, { userId: userId });\n    return [];\n  }\n\n  private capitalize(str: string) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  }\n\n  private async appendRandomNumberToRandomWord(wordList: string[]) {\n    if (wordList == null || wordList.length <= 0) {\n      return;\n    }\n    const index = await this.cryptoService.randomNumber(0, wordList.length - 1);\n    const num = await this.cryptoService.randomNumber(0, 9);\n    wordList[index] = wordList[index] + num;\n  }\n\n  private async encryptHistory(\n    history: GeneratedPasswordHistory[],\n  ): Promise<GeneratedPasswordHistory[]> {\n    if (history == null || history.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    const promises = history.map(async (item) => {\n      const encrypted = await this.cryptoService.encrypt(item.password);\n      return new GeneratedPasswordHistory(encrypted.encryptedString, item.date);\n    });\n\n    return await Promise.all(promises);\n  }\n\n  private async decryptHistory(\n    history: GeneratedPasswordHistory[],\n  ): Promise<GeneratedPasswordHistory[]> {\n    if (history == null || history.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    const promises = history.map(async (item) => {\n      const decrypted = await this.cryptoService.decryptToUtf8(new EncString(item.password));\n      return new GeneratedPasswordHistory(decrypted, item.date);\n    });\n\n    return await Promise.all(promises);\n  }\n\n  private matchesPrevious(password: string, history: GeneratedPasswordHistory[]): boolean {\n    if (history == null || history.length === 0) {\n      return false;\n    }\n\n    return history[history.length - 1].password === password;\n  }\n\n  // ref: https://stackoverflow.com/a/12646864/1090359\n  private async shuffleArray(array: string[]) {\n    for (let i = array.length - 1; i > 0; i--) {\n      const j = await this.cryptoService.randomNumber(0, i);\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  }\n}\n","import { firstValueFrom, share, timer, ReplaySubject, Observable } from \"rxjs\";\n\n// FIXME: use index.ts imports once policy abstractions and models\n// implement ADR-0002\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { UserId } from \"../../types/guid\";\n\nimport { GeneratorStrategy, GeneratorService, PolicyEvaluator } from \"./abstractions\";\n\ntype DefaultGeneratorServiceTuning = {\n  /* amount of time to keep the most recent policy after a subscription ends. Once the\n   * cache expires, the ignoreQty and timeoutMs settings apply to the next lookup.\n   */\n  policyCacheMs: number;\n};\n\n/** {@link GeneratorServiceAbstraction} */\nexport class DefaultGeneratorService<Options, Policy> implements GeneratorService<Options, Policy> {\n  /** Instantiates the generator service\n   * @param strategy tailors the service to a specific generator type\n   *            (e.g. password, passphrase)\n   * @param policy provides the policy to enforce\n   */\n  constructor(\n    private strategy: GeneratorStrategy<Options, Policy>,\n    private policy: PolicyService,\n    tuning: Partial<DefaultGeneratorServiceTuning> = {},\n  ) {\n    this.tuning = Object.assign(\n      {\n        // a minute\n        policyCacheMs: 60000,\n      },\n      tuning,\n    );\n  }\n\n  private tuning: DefaultGeneratorServiceTuning;\n  private _evaluators$ = new Map<UserId, Observable<PolicyEvaluator<Policy, Options>>>();\n\n  /** {@link GeneratorService.options$} */\n  options$(userId: UserId) {\n    return this.strategy.durableState(userId).state$;\n  }\n\n  /** {@link GeneratorService.defaults$} */\n  defaults$(userId: UserId) {\n    return this.strategy.defaults$(userId);\n  }\n\n  /** {@link GeneratorService.saveOptions} */\n  async saveOptions(userId: UserId, options: Options): Promise<void> {\n    await this.strategy.durableState(userId).update(() => options);\n  }\n\n  /** {@link GeneratorService.evaluator$} */\n  evaluator$(userId: UserId) {\n    let evaluator$ = this._evaluators$.get(userId);\n\n    if (!evaluator$) {\n      evaluator$ = this.createEvaluator(userId);\n      this._evaluators$.set(userId, evaluator$);\n    }\n\n    return evaluator$;\n  }\n\n  private createEvaluator(userId: UserId) {\n    const evaluator$ = this.policy.getAll$(this.strategy.policy, userId).pipe(\n      // create the evaluator from the policies\n      this.strategy.toEvaluator(),\n\n      // cache evaluator in a replay subject to amortize creation cost\n      // and reduce GC pressure.\n      share({\n        connector: () => new ReplaySubject(1),\n        resetOnRefCountZero: () => timer(this.tuning.policyCacheMs),\n      }),\n    );\n\n    return evaluator$;\n  }\n\n  /** {@link GeneratorService.enforcePolicy} */\n  async enforcePolicy(userId: UserId, options: Options): Promise<Options> {\n    const policy = await firstValueFrom(this.evaluator$(userId));\n    const evaluated = policy.applyPolicy(options);\n    const sanitized = policy.sanitize(evaluated);\n    return sanitized;\n  }\n\n  /** {@link GeneratorService.generate} */\n  async generate(options: Options): Promise<string> {\n    return await this.strategy.generate(options);\n  }\n}\n","import { Observable, combineLatest, concatMap, filter, map, of, concat, merge } from \"rxjs\";\n\nimport {\n  StateProvider,\n  SingleUserState,\n  CombinedState,\n  StateUpdateOptions,\n} from \"../../platform/state\";\n\nimport { BufferedKeyDefinition } from \"./buffered-key-definition\";\n\n/** Stateful storage that overwrites one state with a buffered state.\n *  When a overwrite occurs, the input state is automatically deleted.\n *  @remarks The buffered state can only overwrite non-nullish values. If the\n *   buffer key contains `null` or `undefined`, it will do nothing.\n */\nexport class BufferedState<Input, Output, Dependency> implements SingleUserState<Output> {\n  /**\n   * Instantiate a buffered state\n   * @param provider constructs the buffer.\n   * @param key defines the buffer location.\n   * @param output updates when a overwrite occurs\n   * @param dependency$ provides data the buffer depends upon to evaluate and\n   *   transform its data. If this is omitted, then `true` is injected as\n   *   a dependency, which with a default output will trigger a overwrite immediately.\n   *\n   * @remarks `dependency$` enables overwrite control during dynamic circumstances,\n   *   such as when a overwrite should occur only if a user key is available.\n   */\n  constructor(\n    provider: StateProvider,\n    private key: BufferedKeyDefinition<Input, Output, Dependency>,\n    private output: SingleUserState<Output>,\n    dependency$: Observable<Dependency> = null,\n  ) {\n    this.bufferedState = provider.getUser(output.userId, key.toKeyDefinition());\n\n    // overwrite the output value\n    const hasValue$ = concat(of(null), this.bufferedState.state$).pipe(\n      map((buffer) => (buffer ?? null) !== null),\n    );\n    const overwriteDependency$ = (dependency$ ?? of(true as unknown as Dependency)).pipe(\n      map((dependency) => [key.shouldOverwrite(dependency), dependency] as const),\n    );\n    const overwrite$ = combineLatest([hasValue$, overwriteDependency$]).pipe(\n      concatMap(async ([hasValue, [shouldOverwrite, dependency]]) => {\n        if (hasValue && shouldOverwrite) {\n          await this.overwriteOutput(dependency);\n        }\n        return [false, null] as const;\n      }),\n    );\n\n    // drive overwrites only when there's a subscription;\n    // the output state determines when emissions occur\n    const output$ = this.output.state$.pipe(map((output) => [true, output] as const));\n    this.state$ = merge(overwrite$, output$).pipe(\n      filter(([emit]) => emit),\n      map(([, output]) => output),\n    );\n\n    this.combinedState$ = this.state$.pipe(map((state) => [this.output.userId, state]));\n\n    this.bufferedState$ = this.bufferedState.state$;\n  }\n\n  private bufferedState: SingleUserState<Input>;\n\n  private async overwriteOutput(dependency: Dependency) {\n    // take the latest value from the buffer\n    let buffered: Input;\n    await this.bufferedState.update((state) => {\n      buffered = state ?? null;\n      return null;\n    });\n\n    // update the output state\n    const isValid = await this.key.isValid(buffered, dependency);\n    if (isValid) {\n      const output = await this.key.map(buffered, dependency);\n      await this.output.update(() => output);\n    }\n  }\n\n  /** {@link SingleUserState.userId} */\n  get userId() {\n    return this.output.userId;\n  }\n\n  /** Observes changes to the output state. This updates when the output\n   *  state updates, when the buffer is moved to the output, and when `BufferedState.buffer`\n   *  is invoked.\n   */\n  readonly state$: Observable<Output>;\n\n  /** {@link SingleUserState.combinedState$} */\n  readonly combinedState$: Observable<CombinedState<Output>>;\n\n  /** Buffers a value state. The buffered state overwrites the output\n   *  state when a subscription occurs.\n   *  @param value the state to roll over. Setting this to `null` or `undefined`\n   *  has no effect.\n   */\n  async buffer(value: Input): Promise<void> {\n    const normalized = value ?? null;\n    if (normalized !== null) {\n      await this.bufferedState.update(() => normalized);\n    }\n  }\n\n  /** The data presently being buffered. This emits the pending value each time\n   *  new buffer data is provided. It emits null when the buffer is empty.\n   */\n  readonly bufferedState$: Observable<Input>;\n\n  /** Updates the output state.\n   *  @param configureState a callback that returns an updated output\n   *   state. The callback receives the state's present value as its\n   *   first argument and the dependencies listed in `options.combinedLatestWith`\n   *   as its second argument.\n   *  @param options configures how the update is applied. See {@link StateUpdateOptions}.\n   */\n  update<TCombine>(\n    configureState: (state: Output, dependencies: TCombine) => Output,\n    options: StateUpdateOptions<Output, TCombine> = null,\n  ): Promise<Output> {\n    return this.output.update(configureState, options);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\n/** A packing strategy that packs data into a string.\n */\nexport abstract class DataPacker {\n  /**\n   * Packs value into a string format.\n   * @type {Data} is the type of data being protected.\n   * @param value is packed into the string\n   * @returns the packed string\n   */\n  abstract pack<Data>(value: Jsonify<Data>): string;\n\n  /** Unpacks a string produced by pack.\n   * @param packedValue is the string to unpack\n   * @type {Data} is the type of data being protected.\n   * @returns the data stored within the secret.\n   * @throws when `packedValue` has an invalid format.\n   */\n  abstract unpack<Data>(packedValue: string): Jsonify<Data>;\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../platform/misc/utils\";\n\nimport { DataPacker as DataPackerAbstraction } from \"./data-packer.abstraction\";\n\nconst DATA_PACKING = Object.freeze({\n  /** The character to use for padding. */\n  padding: \"0\",\n\n  /** The character dividing packed data. */\n  divider: \"|\",\n\n  /** A regular expression for detecting invalid padding. When the character\n   *  changes, this should be updated to include the new padding pattern.\n   */\n  hasInvalidPadding: /[^0]/,\n});\n\n/** A packing strategy that conceals the length of secret data by padding it\n *  to a multiple of the frame size.\n *  @example\n *  // packed === \"24|e2Zvbzp0cnVlfQ==|0000\"\n *  const packer = new SecretPacker(24);\n *  const packed = packer.pack({ foo: true });\n */\nexport class PaddedDataPacker extends DataPackerAbstraction {\n  /** Instantiates the padded data packer\n   *  @param frameSize The size of the dataframe used to pad encrypted values.\n   */\n  constructor(private readonly frameSize: number) {\n    super();\n  }\n\n  /**\n   * Packs value into a string format that conceals the length by obscuring it\n   * with the frameSize.\n   * @see {@link DataPackerAbstraction.unpack}\n   */\n  pack<Secret>(value: Jsonify<Secret>) {\n    // encode the value\n    const json = JSON.stringify(value);\n    const b64 = Utils.fromUtf8ToB64(json);\n\n    // calculate packing metadata\n    const frameSize = JSON.stringify(this.frameSize);\n    const separatorLength = 2 * DATA_PACKING.divider.length; // there are 2 separators\n    const payloadLength = b64.length + frameSize.length + separatorLength;\n    const paddingLength = this.frameSize - (payloadLength % this.frameSize);\n\n    // pack the data, thereby concealing its length\n    const padding = DATA_PACKING.padding.repeat(paddingLength);\n    const packed = `${frameSize}|${b64}|${padding}`;\n\n    return packed;\n  }\n\n  /** {@link DataPackerAbstraction.unpack} */\n  unpack<Secret>(secret: string): Jsonify<Secret> {\n    // frame size is stored before the JSON payload in base 10\n    const frameEndIndex = secret.indexOf(DATA_PACKING.divider);\n    if (frameEndIndex < 1) {\n      throw new Error(\"missing frame size\");\n    }\n    const frameSize = parseInt(secret.slice(0, frameEndIndex), 10);\n    const dataStartIndex = frameEndIndex + 1;\n\n    // The decrypted string should be a multiple of the frame length\n    if (secret.length % frameSize > 0) {\n      throw new Error(\"invalid length\");\n    }\n\n    // encoded data terminates with the divider, followed by the padding character\n    const dataEndIndex = secret.lastIndexOf(DATA_PACKING.divider);\n    if (dataEndIndex == frameEndIndex) {\n      throw new Error(\"missing json object\");\n    }\n    const paddingStartIndex = dataEndIndex + 1;\n\n    // If the padding contains invalid padding characters then the padding could be used\n    // as a side channel for arbitrary data.\n    if (secret.slice(paddingStartIndex).match(DATA_PACKING.hasInvalidPadding)) {\n      throw new Error(\"invalid padding\");\n    }\n\n    // remove frame size and padding\n    const b64 = secret.slice(dataStartIndex, dataEndIndex);\n\n    // unpack the stored data\n    const json = Utils.fromB64ToUtf8(b64);\n    const unpacked = JSON.parse(json);\n\n    return unpacked;\n  }\n}\n","import { Observable, map, concatMap, share, ReplaySubject, timer } from \"rxjs\";\n\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport {\n  SingleUserState,\n  StateProvider,\n  StateUpdateOptions,\n  CombinedState,\n} from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\n\nimport { ClassifiedFormat } from \"./classified-format\";\nimport { SecretKeyDefinition } from \"./secret-key-definition\";\nimport { UserEncryptor } from \"./user-encryptor.abstraction\";\n\nconst ONE_MINUTE = 1000 * 60;\n\n/** Stores account-specific secrets protected by a UserKeyEncryptor.\n *\n *  @remarks This state store changes the structure of `Plaintext` during\n *  storage, and requires user keys to operate. It is incompatible with sync,\n *  which expects the disk storage format to be identical to the sync format.\n *\n *  DO NOT USE THIS for synchronized data.\n */\nexport class SecretState<Outer, Id, Plaintext extends object, Disclosed, Secret>\n  implements SingleUserState<Outer>\n{\n  // The constructor is private to avoid creating a circular dependency when\n  // wiring the derived and secret states together.\n  private constructor(\n    private readonly key: SecretKeyDefinition<Outer, Id, Plaintext, Disclosed, Secret>,\n    private readonly encryptor: UserEncryptor,\n    userId: UserId,\n    provider: StateProvider,\n  ) {\n    // construct the backing store\n    this.encryptedState = provider.getUser(userId, key.toEncryptedStateKey());\n\n    // cache plaintext\n    this.combinedState$ = this.encryptedState.combinedState$.pipe(\n      concatMap(\n        async ([userId, state]) => [userId, await this.declassifyAll(state)] as [UserId, Outer],\n      ),\n      share({\n        connector: () => {\n          return new ReplaySubject<[UserId, Outer]>(1);\n        },\n        resetOnRefCountZero: () => timer(key.options.cleanupDelayMs ?? ONE_MINUTE),\n      }),\n    );\n\n    this.state$ = this.combinedState$.pipe(map(([, state]) => state));\n  }\n\n  private readonly encryptedState: SingleUserState<ClassifiedFormat<Id, Disclosed>[]>;\n\n  /** {@link SingleUserState.userId} */\n  get userId() {\n    return this.encryptedState.userId;\n  }\n\n  /** Observes changes to the decrypted secret state. The observer\n   *  updates after the secret has been recorded to state storage.\n   *  @returns `undefined` when the account is locked.\n   */\n  readonly state$: Observable<Outer>;\n\n  /** {@link SingleUserState.combinedState$} */\n  readonly combinedState$: Observable<CombinedState<Outer>>;\n\n  /** Creates a secret state bound to an account encryptor. The account must be unlocked\n   *  when this method is called.\n   *  @param userId: the user to which the secret state is bound.\n   *  @param key Converts between a declassified secret and its formal type.\n   *  @param provider constructs state objects.\n   *  @param encryptor protects `Secret` data.\n   *  @throws when `key.stateDefinition` is backed by memory storage.\n   *  @remarks Secrets are written to a secret store as a named tuple. Data classification is\n   *    determined by the encryptor's classifier. Secret-classification data is jsonified,\n   *    encrypted, and stored in a `secret` property. Disclosed-classification data is stored\n   *    in a `disclosed` property. Omitted-classification data is not stored.\n   */\n  static from<Outer, Id, TFrom extends object, Disclosed, Secret>(\n    userId: UserId,\n    key: SecretKeyDefinition<Outer, Id, TFrom, Disclosed, Secret>,\n    provider: StateProvider,\n    encryptor: UserEncryptor,\n  ) {\n    const secretState = new SecretState(key, encryptor, userId, provider);\n    return secretState;\n  }\n\n  private async declassifyItem({ id, secret, disclosed }: ClassifiedFormat<Id, Disclosed>) {\n    const encrypted = EncString.fromJSON(secret);\n    const decrypted = await this.encryptor.decrypt(encrypted, this.encryptedState.userId);\n\n    const declassified = this.key.classifier.declassify(disclosed, decrypted);\n    const result = [id, this.key.options.deserializer(declassified)] as const;\n\n    return result;\n  }\n\n  private async declassifyAll(data: ClassifiedFormat<Id, Disclosed>[]) {\n    // fail fast if there's no value\n    if (data === null || data === undefined) {\n      return null;\n    }\n\n    // decrypt each item\n    const decryptTasks = data.map(async (item) => this.declassifyItem(item));\n\n    // reconstruct expected type\n    const results = await Promise.all(decryptTasks);\n    const result = this.key.reconstruct(results);\n\n    return result;\n  }\n\n  private async classifyItem([id, item]: [Id, Plaintext]) {\n    const classified = this.key.classifier.classify(item);\n    const encrypted = await this.encryptor.encrypt(classified.secret, this.encryptedState.userId);\n\n    // the deserializer in the plaintextState's `derive` configuration always runs, but\n    // `encryptedState` is not guaranteed to serialize the data, so it's necessary to\n    // round-trip `encrypted` proactively.\n    const serialized = {\n      id,\n      secret: JSON.parse(JSON.stringify(encrypted)),\n      disclosed: classified.disclosed,\n    } as ClassifiedFormat<Id, Disclosed>;\n\n    return serialized;\n  }\n\n  private async classifyAll(data: Outer) {\n    // fail fast if there's no value\n    if (data === null || data === undefined) {\n      return null;\n    }\n\n    // convert the object to a list format so that all encrypt and decrypt\n    // operations are self-similar\n    const desconstructed = this.key.deconstruct(data);\n\n    // encrypt each value individually\n    const classifyTasks = desconstructed.map(async (item) => this.classifyItem(item));\n    const classified = await Promise.all(classifyTasks);\n\n    return classified;\n  }\n\n  /** Updates the secret stored by this state.\n   *  @param configureState a callback that returns an updated decrypted\n   *   secret state. The callback receives the state's present value as its\n   *   first argument and the dependencies listed in `options.combinedLatestWith`\n   *   as its second argument.\n   *  @param options configures how the update is applied. See {@link StateUpdateOptions}.\n   *  @returns a promise that resolves with the updated value read from the state.\n   *   The round-trip encrypts, decrypts, and deserializes the data, producing a new\n   *   object.\n   *  @remarks `configureState` must return a JSON-serializable object.\n   *   If there are properties of your class which are not JSON-serializable,\n   *   they can be lost when the secret state updates its backing store.\n   */\n  async update<TCombine>(\n    configureState: (state: Outer, dependencies: TCombine) => Outer,\n    options: StateUpdateOptions<Outer, TCombine> = null,\n  ): Promise<Outer> {\n    // read the backing store\n    let latestClassified: ClassifiedFormat<Id, Disclosed>[];\n    let latestCombined: TCombine;\n    await this.encryptedState.update((c) => c, {\n      shouldUpdate: (latest, combined) => {\n        latestClassified = latest;\n        latestCombined = combined;\n        return false;\n      },\n      combineLatestWith: options?.combineLatestWith,\n    });\n\n    // exit early if there's no update to apply\n    const latestDeclassified = await this.declassifyAll(latestClassified);\n    const shouldUpdate = options?.shouldUpdate?.(latestDeclassified, latestCombined) ?? true;\n    if (!shouldUpdate) {\n      return latestDeclassified;\n    }\n\n    // apply the update\n    const updatedDeclassified = configureState(latestDeclassified, latestCombined);\n    const updatedClassified = await this.classifyAll(updatedDeclassified);\n    await this.encryptedState.update(() => updatedClassified);\n\n    return updatedDeclassified;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { UserId } from \"../../types/guid\";\n\n/** A classification strategy that protects a type's secrets with\n *  user-specific information. The specific kind of information is\n *  determined by the classification strategy.\n */\nexport abstract class UserEncryptor {\n  /** Protects secrets in `value` with a user-specific key.\n   *  @param secret the object to protect. This object is mutated during encryption.\n   *  @param userId identifies the user-specific information used to protect\n   *    the secret.\n   *  @returns a promise that resolves to a tuple. The tuple's first property contains\n   *    the encrypted secret and whose second property contains an object w/ disclosed\n   *    properties.\n   *   @throws If `value` is `null` or `undefined`, the promise rejects with an error.\n   */\n  abstract encrypt<Secret>(secret: Jsonify<Secret>, userId: UserId): Promise<EncString>;\n\n  /** Combines protected secrets and disclosed data into a type that can be\n   *  rehydrated into a domain object.\n   *  @param secret an encrypted JSON payload containing encrypted secrets.\n   *  @param userId identifies the user-specific information used to protect\n   *    the secret.\n   *  @returns a promise that resolves to the raw state. This state *is not* a\n   *    class. It contains only data that can be round-tripped through JSON,\n   *    and lacks members such as a prototype or bound functions.\n   *  @throws If `secret` or `disclosed` is `null` or `undefined`, the promise\n   *    rejects with an error.\n   */\n  abstract decrypt<Secret>(secret: EncString, userId: UserId): Promise<Jsonify<Secret>>;\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { UserId } from \"../../types/guid\";\n\nimport { DataPacker } from \"./data-packer.abstraction\";\nimport { UserEncryptor } from \"./user-encryptor.abstraction\";\n\n/** A classification strategy that protects a type's secrets by encrypting them\n *  with a `UserKey`\n */\nexport class UserKeyEncryptor extends UserEncryptor {\n  /** Instantiates the encryptor\n   *  @param encryptService protects properties of `Secret`.\n   *  @param keyService looks up the user key when protecting data.\n   *  @param dataPacker packs and unpacks data classified as secrets.\n   */\n  constructor(\n    private readonly encryptService: EncryptService,\n    private readonly keyService: CryptoService,\n    private readonly dataPacker: DataPacker,\n  ) {\n    super();\n  }\n\n  /** {@link UserEncryptor.encrypt} */\n  async encrypt<Secret>(secret: Jsonify<Secret>, userId: UserId): Promise<EncString> {\n    this.assertHasValue(\"secret\", secret);\n    this.assertHasValue(\"userId\", userId);\n\n    let packed = this.dataPacker.pack(secret);\n\n    // encrypt the data and drop the key\n    let key = await this.keyService.getUserKey(userId);\n    const encrypted = await this.encryptService.encrypt(packed, key);\n    packed = null;\n    key = null;\n\n    return encrypted;\n  }\n\n  /** {@link UserEncryptor.decrypt} */\n  async decrypt<Secret>(secret: EncString, userId: UserId): Promise<Jsonify<Secret>> {\n    this.assertHasValue(\"secret\", secret);\n    this.assertHasValue(\"userId\", userId);\n\n    // decrypt the data and drop the key\n    let key = await this.keyService.getUserKey(userId);\n    let decrypted = await this.encryptService.decryptToUtf8(secret, key);\n    key = null;\n\n    // reconstruct TFrom's data\n    const unpacked = this.dataPacker.unpack<Secret>(decrypted);\n    decrypted = null;\n\n    return unpacked;\n  }\n\n  private assertHasValue(name: string, value: any) {\n    if (value === undefined || value === null) {\n      throw new Error(`${name} cannot be null or undefined`);\n    }\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratedCredential, GeneratorCategory } from \"../history\";\n\n/** Tracks the history of password generations.\n *  Each user gets their own store.\n */\nexport abstract class GeneratorHistoryService {\n  /** Tracks a new credential. When an item with the same `credential` value\n   *  is found, this method does nothing. When the total number of items exceeds\n   *  {@link HistoryServiceOptions.maxTotal}, then the oldest items exceeding the total\n   *  are deleted.\n   *  @param userId identifies the user storing the credential.\n   *  @param credential stored by the history service.\n   *  @param date when the credential was generated. If this is omitted, then the generator\n   *    uses the date the credential was added to the store instead.\n   *  @returns a promise that completes with the added credential. If the credential\n   *    wasn't added, then the promise completes with `null`.\n   *  @remarks this service is not suitable for use with vault items/ciphers. It models only\n   *    a history of an individually generated credential, while a vault item's history\n   *    may contain several credentials that are better modelled as atomic versions of the\n   *    vault item itself.\n   */\n  track: (\n    userId: UserId,\n    credential: string,\n    category: GeneratorCategory,\n    date?: Date,\n  ) => Promise<GeneratedCredential | null>;\n\n  /** Removes a matching credential from the history service.\n   *  @param userId identifies the user taking the credential.\n   *  @param credential to match in the history service.\n   *  @returns A promise that completes with the credential read. If the credential wasn't found,\n   *    the promise completes with null.\n   *  @remarks this can be used to extract an entry when a credential is stored in the vault.\n   */\n  take: (userId: UserId, credential: string) => Promise<GeneratedCredential | null>;\n\n  /** Deletes a user's credential history.\n   *  @param userId identifies the user taking the credential.\n   *  @returns A promise that completes when the history is cleared.\n   */\n  clear: (userId: UserId) => Promise<GeneratedCredential[]>;\n\n  /** Lists all credentials for a user.\n   *  @param userId identifies the user listing the credential.\n   *  @remarks This field is eventually consistent with `track` and `take` operations.\n   *    It is not guaranteed to immediately reflect those changes.\n   */\n  credentials$: (userId: UserId) => Observable<GeneratedCredential[]>;\n}\n","import { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratedPasswordHistory } from \"../password/generated-password-history\";\n\n/** Strategy that decrypts a password history */\nexport class LegacyPasswordHistoryDecryptor {\n  constructor(\n    private userId: UserId,\n    private cryptoService: CryptoService,\n    private encryptService: EncryptService,\n  ) {}\n\n  /** Decrypts a password history. */\n  async decrypt(history: GeneratedPasswordHistory[]): Promise<GeneratedPasswordHistory[]> {\n    const key = await this.cryptoService.getUserKey(this.userId);\n\n    const promises = (history ?? []).map(async (item) => {\n      const encrypted = new EncString(item.password);\n      const decrypted = await this.encryptService.decryptToUtf8(encrypted, key);\n      return new GeneratedPasswordHistory(decrypted, item.date);\n    });\n\n    const decrypted = await Promise.all(promises);\n\n    return decrypted;\n  }\n}\n","import { map } from \"rxjs\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { SingleUserState, StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { BufferedState } from \"../../state/buffered-state\";\nimport { PaddedDataPacker } from \"../../state/padded-data-packer\";\nimport { SecretState } from \"../../state/secret-state\";\nimport { UserKeyEncryptor } from \"../../state/user-key-encryptor\";\nimport { GeneratorHistoryService } from \"../abstractions/generator-history.abstraction\";\nimport { GENERATOR_HISTORY, GENERATOR_HISTORY_BUFFER } from \"../key-definitions\";\n\nimport { GeneratedCredential } from \"./generated-credential\";\nimport { LegacyPasswordHistoryDecryptor } from \"./legacy-password-history-decryptor\";\nimport { GeneratorCategory, HistoryServiceOptions } from \"./options\";\n\nconst OPTIONS_FRAME_SIZE = 2048;\n\n/** Tracks the history of password generations local to a device.\n *  {@link GeneratorHistoryService}\n */\nexport class LocalGeneratorHistoryService extends GeneratorHistoryService {\n  constructor(\n    private readonly encryptService: EncryptService,\n    private readonly keyService: CryptoService,\n    private readonly stateProvider: StateProvider,\n    private readonly options: HistoryServiceOptions = { maxTotal: 100 },\n  ) {\n    super();\n  }\n\n  private _credentialStates = new Map<UserId, SingleUserState<GeneratedCredential[]>>();\n\n  /** {@link GeneratorHistoryService.track} */\n  track = async (userId: UserId, credential: string, category: GeneratorCategory, date?: Date) => {\n    const state = this.getCredentialState(userId);\n    let result: GeneratedCredential = null;\n\n    await state.update(\n      (credentials) => {\n        credentials = credentials ?? [];\n\n        // add the result\n        result = new GeneratedCredential(credential, category, date ?? Date.now());\n        credentials.unshift(result);\n\n        // trim history\n        const removeAt = Math.max(0, this.options.maxTotal);\n        credentials.splice(removeAt, Infinity);\n\n        return credentials;\n      },\n      {\n        shouldUpdate: (credentials) =>\n          !(credentials?.some((f) => f.credential === credential) ?? false),\n      },\n    );\n\n    return result;\n  };\n\n  /** {@link GeneratorHistoryService.take} */\n  take = async (userId: UserId, credential: string) => {\n    const state = this.getCredentialState(userId);\n    let credentialIndex: number;\n    let result: GeneratedCredential = null;\n\n    await state.update(\n      (credentials) => {\n        credentials = credentials ?? [];\n\n        [result] = credentials.splice(credentialIndex, 1);\n        return credentials;\n      },\n      {\n        shouldUpdate: (credentials) => {\n          credentialIndex = credentials?.findIndex((f) => f.credential === credential) ?? -1;\n          return credentialIndex >= 0;\n        },\n      },\n    );\n\n    return result;\n  };\n\n  /** {@link GeneratorHistoryService.take} */\n  clear = async (userId: UserId) => {\n    const state = this.getCredentialState(userId);\n    const result = (await state.update(() => null)) ?? [];\n    return result;\n  };\n\n  /** {@link GeneratorHistoryService.credentials$} */\n  credentials$ = (userId: UserId) => {\n    return this.getCredentialState(userId).state$.pipe(map((credentials) => credentials ?? []));\n  };\n\n  private getCredentialState(userId: UserId) {\n    let state = this._credentialStates.get(userId);\n\n    if (!state) {\n      state = this.createSecretState(userId);\n      this._credentialStates.set(userId, state);\n    }\n\n    return state;\n  }\n\n  private createSecretState(userId: UserId): SingleUserState<GeneratedCredential[]> {\n    // construct the encryptor\n    const packer = new PaddedDataPacker(OPTIONS_FRAME_SIZE);\n    const encryptor = new UserKeyEncryptor(this.encryptService, this.keyService, packer);\n\n    // construct the durable state\n    const state = SecretState.from<\n      GeneratedCredential[],\n      number,\n      GeneratedCredential,\n      Record<keyof GeneratedCredential, never>,\n      GeneratedCredential\n    >(userId, GENERATOR_HISTORY, this.stateProvider, encryptor);\n\n    // decryptor is just an algorithm, but it can't run until the key is available;\n    // providing it via an observable makes running it early impossible\n    const decryptor = new LegacyPasswordHistoryDecryptor(\n      userId,\n      this.keyService,\n      this.encryptService,\n    );\n    const decryptor$ = this.keyService\n      .getInMemoryUserKeyFor$(userId)\n      .pipe(map((key) => key && decryptor));\n\n    // move data from the old password history once decryptor is available\n    const buffer = new BufferedState(\n      this.stateProvider,\n      GENERATOR_HISTORY_BUFFER,\n      state,\n      decryptor$,\n    );\n\n    return buffer;\n  }\n}\n","import { GeneratorType } from \"../generator-type\";\nimport { ForwarderId } from \"../username/options\";\nimport { UsernameGeneratorType } from \"../username/options/generator-options\";\n\n/** Stores credential generator UI state. */\n\nexport type GeneratorNavigation = {\n  /** The kind of credential being generated.\n   * @remarks The legacy generator only supports \"password\" and \"passphrase\".\n   *  The componentized generator supports all values.\n   */\n  type?: GeneratorType;\n\n  /** When `type === \"username\"`, this stores the username algorithm. */\n  username?: UsernameGeneratorType;\n\n  /** When `username === \"forwarded\"`, this stores the forwarder implementation. */\n  forwarder?: ForwarderId | \"\";\n};\n/** The default options for password generation. */\n\nexport const DefaultGeneratorNavigation: Partial<GeneratorNavigation> = Object.freeze({\n  type: \"password\",\n  username: \"word\",\n  forwarder: \"\",\n});\n","import { PolicyEvaluator } from \"../abstractions\";\n\nimport { DefaultGeneratorNavigation, GeneratorNavigation } from \"./generator-navigation\";\nimport { GeneratorNavigationPolicy } from \"./generator-navigation-policy\";\n\n/** Enforces policy for generator navigation options.\n */\nexport class GeneratorNavigationEvaluator\n  implements PolicyEvaluator<GeneratorNavigationPolicy, GeneratorNavigation>\n{\n  /** Instantiates the evaluator.\n   * @param policy The policy applied by the evaluator. When this conflicts with\n   *               the defaults, the policy takes precedence.\n   */\n  constructor(readonly policy: GeneratorNavigationPolicy) {}\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect(): boolean {\n    return this.policy?.defaultType ? true : false;\n  }\n\n  /** Apply policy to the input options.\n   *  @param options The options to build from. These options are not altered.\n   *  @returns A new password generation request with policy applied.\n   */\n  applyPolicy(options: GeneratorNavigation): GeneratorNavigation {\n    return options;\n  }\n\n  /** Ensures internal options consistency.\n   *  @param options The options to cascade. These options are not altered.\n   *  @returns A passphrase generation request with cascade applied.\n   */\n  sanitize(options: GeneratorNavigation): GeneratorNavigation {\n    const defaultType = this.policyInEffect\n      ? this.policy.defaultType\n      : DefaultGeneratorNavigation.type;\n    return {\n      ...options,\n      type: options.type ?? defaultType,\n    };\n  }\n}\n","import { PolicyType } from \"../../../admin-console/enums\";\n// FIXME: use index.ts imports once policy abstractions and models\n// implement ADR-0002\nimport { Policy } from \"../../../admin-console/models/domain/policy\";\nimport { GeneratorType } from \"../generator-type\";\n\n/** Policy settings affecting password generator navigation */\nexport type GeneratorNavigationPolicy = {\n  /** The type of generator that should be shown by default when opening\n   *  the password generator.\n   */\n  defaultType?: GeneratorType;\n};\n\n/** Reduces a policy into an accumulator by preferring the password generator\n *  type to other generator types.\n *  @param acc the accumulator\n *  @param policy the policy to reduce\n *  @returns the resulting `GeneratorNavigationPolicy`\n */\nexport function preferPassword(\n  acc: GeneratorNavigationPolicy,\n  policy: Policy,\n): GeneratorNavigationPolicy {\n  const isEnabled = policy.type === PolicyType.PasswordGenerator && policy.enabled;\n  if (!isEnabled) {\n    return acc;\n  }\n\n  const isOverridable = acc.defaultType !== \"password\" && policy.data.defaultType;\n  const result = isOverridable ? { ...acc, defaultType: policy.data.defaultType } : acc;\n\n  return result;\n}\n\n/** The default options for password generation policy. */\nexport const DisabledGeneratorNavigationPolicy: GeneratorNavigationPolicy = Object.freeze({\n  defaultType: undefined,\n});\n","import { BehaviorSubject, Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { PolicyService } from \"../../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratorNavigationService } from \"../abstractions/generator-navigation.service.abstraction\";\nimport { GENERATOR_SETTINGS } from \"../key-definitions\";\nimport { distinctIfShallowMatch, reduceCollection } from \"../rx-operators\";\n\nimport { DefaultGeneratorNavigation, GeneratorNavigation } from \"./generator-navigation\";\nimport { GeneratorNavigationEvaluator } from \"./generator-navigation-evaluator\";\nimport { DisabledGeneratorNavigationPolicy, preferPassword } from \"./generator-navigation-policy\";\n\nexport class DefaultGeneratorNavigationService implements GeneratorNavigationService {\n  /** instantiates the password generator strategy.\n   * @param stateProvider provides durable state\n   * @param policy provides the policy to enforce\n   */\n  constructor(\n    private readonly stateProvider: StateProvider,\n    private readonly policy: PolicyService,\n  ) {}\n\n  /** An observable monitoring the options saved to disk.\n   *  The observable updates when the options are saved.\n   *   @param userId: Identifies the user making the request\n   */\n  options$(userId: UserId): Observable<GeneratorNavigation> {\n    return this.stateProvider.getUserState$(GENERATOR_SETTINGS, userId);\n  }\n\n  /** Gets the default options. */\n  defaults$(userId: UserId): Observable<GeneratorNavigation> {\n    return new BehaviorSubject({ ...DefaultGeneratorNavigation });\n  }\n\n  /** An observable monitoring the options used to enforce policy.\n   *  The observable updates when the policy changes.\n   *  @param userId: Identifies the user making the request\n   */\n  evaluator$(userId: UserId) {\n    const evaluator$ = this.policy.getAll$(PolicyType.PasswordGenerator, userId).pipe(\n      reduceCollection(preferPassword, DisabledGeneratorNavigationPolicy),\n      distinctIfShallowMatch(),\n      map((policy) => new GeneratorNavigationEvaluator(policy)),\n    );\n\n    return evaluator$;\n  }\n\n  /** Enforces the policy on the given options\n   * @param userId: Identifies the user making the request\n   * @param options the options to enforce the policy on\n   * @returns a new instance of the options with the policy enforced\n   */\n  async enforcePolicy(userId: UserId, options: GeneratorNavigation) {\n    const evaluator = await firstValueFrom(this.evaluator$(userId));\n    const applied = evaluator.applyPolicy(options);\n    const sanitized = evaluator.sanitize(applied);\n    return sanitized;\n  }\n\n  /** Saves the navigation options to disk.\n   * @param userId: Identifies the user making the request\n   * @param options the options to save\n   * @returns a promise that resolves when the options are saved\n   */\n  async saveOptions(userId: UserId, options: GeneratorNavigation): Promise<void> {\n    await this.stateProvider.setUserState(GENERATOR_SETTINGS, options, userId);\n  }\n}\n","import { PolicyType } from \"../../../admin-console/enums\";\n// FIXME: use index.ts imports once policy abstractions and models\n// implement ADR-0002\nimport { Policy } from \"../../../admin-console/models/domain/policy\";\n\n/** Policy options enforced during passphrase generation. */\nexport type PassphraseGeneratorPolicy = {\n  minNumberWords: number;\n  capitalize: boolean;\n  includeNumber: boolean;\n};\n\n/** The default options for password generation policy. */\nexport const DisabledPassphraseGeneratorPolicy: PassphraseGeneratorPolicy = Object.freeze({\n  minNumberWords: 0,\n  capitalize: false,\n  includeNumber: false,\n});\n\n/** Reduces a policy into an accumulator by accepting the most restrictive\n *  values from each policy.\n *  @param acc the accumulator\n *  @param policy the policy to reduce\n *  @returns the most restrictive values between the policy and accumulator.\n */\nexport function leastPrivilege(\n  acc: PassphraseGeneratorPolicy,\n  policy: Policy,\n): PassphraseGeneratorPolicy {\n  if (policy.type !== PolicyType.PasswordGenerator) {\n    return acc;\n  }\n\n  return {\n    minNumberWords: Math.max(acc.minNumberWords, policy.data.minNumberWords ?? acc.minNumberWords),\n    capitalize: policy.data.capitalize || acc.capitalize,\n    includeNumber: policy.data.includeNumber || acc.includeNumber,\n  };\n}\n","import { BehaviorSubject, map, pipe } from \"rxjs\";\n\nimport { GeneratorStrategy } from \"..\";\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { PasswordGenerationServiceAbstraction } from \"../abstractions/password-generation.service.abstraction\";\nimport { PASSPHRASE_SETTINGS } from \"../key-definitions\";\nimport { distinctIfShallowMatch, reduceCollection } from \"../rx-operators\";\n\nimport {\n  PassphraseGenerationOptions,\n  DefaultPassphraseGenerationOptions,\n} from \"./passphrase-generation-options\";\nimport { PassphraseGeneratorOptionsEvaluator } from \"./passphrase-generator-options-evaluator\";\nimport {\n  DisabledPassphraseGeneratorPolicy,\n  PassphraseGeneratorPolicy,\n  leastPrivilege,\n} from \"./passphrase-generator-policy\";\n\n/** {@link GeneratorStrategy} */\nexport class PassphraseGeneratorStrategy\n  implements GeneratorStrategy<PassphraseGenerationOptions, PassphraseGeneratorPolicy>\n{\n  /** instantiates the password generator strategy.\n   *  @param legacy generates the passphrase\n   *  @param stateProvider provides durable state\n   */\n  constructor(\n    private legacy: PasswordGenerationServiceAbstraction,\n    private stateProvider: StateProvider,\n  ) {}\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState(id: UserId) {\n    return this.stateProvider.getUser(id, PASSPHRASE_SETTINGS);\n  }\n\n  /** Gets the default options. */\n  defaults$(_: UserId) {\n    return new BehaviorSubject({ ...DefaultPassphraseGenerationOptions }).asObservable();\n  }\n\n  /** {@link GeneratorStrategy.policy} */\n  get policy() {\n    return PolicyType.PasswordGenerator;\n  }\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator() {\n    return pipe(\n      reduceCollection(leastPrivilege, DisabledPassphraseGeneratorPolicy),\n      distinctIfShallowMatch(),\n      map((policy) => new PassphraseGeneratorOptionsEvaluator(policy)),\n    );\n  }\n\n  /** {@link GeneratorStrategy.generate} */\n  generate(options: PassphraseGenerationOptions): Promise<string> {\n    return this.legacy.generatePassphrase({ ...options, type: \"passphrase\" });\n  }\n}\n","import {\n  concatMap,\n  zip,\n  map,\n  firstValueFrom,\n  combineLatest,\n  pairwise,\n  of,\n  concat,\n  Observable,\n  filter,\n  timeout,\n} from \"rxjs\";\n\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PasswordGeneratorPolicyOptions } from \"../../admin-console/models/domain/password-generator-policy-options\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { StateProvider } from \"../../platform/state\";\n\nimport {\n  GeneratorHistoryService,\n  GeneratorService,\n  GeneratorNavigationService,\n  PolicyEvaluator,\n} from \"./abstractions\";\nimport { PasswordGenerationServiceAbstraction } from \"./abstractions/password-generation.service.abstraction\";\nimport { DefaultGeneratorService } from \"./default-generator.service\";\nimport { GeneratedCredential } from \"./history\";\nimport { LocalGeneratorHistoryService } from \"./history/local-generator-history.service\";\nimport { GeneratorNavigation } from \"./navigation\";\nimport { DefaultGeneratorNavigationService } from \"./navigation/default-generator-navigation.service\";\nimport { GeneratorNavigationPolicy } from \"./navigation/generator-navigation-policy\";\nimport {\n  PassphraseGenerationOptions,\n  PassphraseGeneratorPolicy,\n  PassphraseGeneratorStrategy,\n} from \"./passphrase\";\nimport {\n  GeneratedPasswordHistory,\n  PasswordGenerationOptions,\n  PasswordGenerationService,\n  PasswordGeneratorOptions,\n  PasswordGeneratorPolicy,\n  PasswordGeneratorStrategy,\n} from \"./password\";\n\ntype MappedOptions = {\n  generator: GeneratorNavigation;\n  password: PasswordGenerationOptions;\n  passphrase: PassphraseGenerationOptions;\n  policyUpdated: boolean;\n};\n\nexport function legacyPasswordGenerationServiceFactory(\n  encryptService: EncryptService,\n  cryptoService: CryptoService,\n  policyService: PolicyService,\n  accountService: AccountService,\n  stateProvider: StateProvider,\n): PasswordGenerationServiceAbstraction {\n  // FIXME: Once the password generation service is replaced with this service\n  // in the clients, factor out the deprecated service in its entirety.\n  const deprecatedService = new PasswordGenerationService(cryptoService, null, null);\n\n  const passwords = new DefaultGeneratorService(\n    new PasswordGeneratorStrategy(deprecatedService, stateProvider),\n    policyService,\n  );\n\n  const passphrases = new DefaultGeneratorService(\n    new PassphraseGeneratorStrategy(deprecatedService, stateProvider),\n    policyService,\n  );\n\n  const navigation = new DefaultGeneratorNavigationService(stateProvider, policyService);\n\n  const history = new LocalGeneratorHistoryService(encryptService, cryptoService, stateProvider);\n\n  return new LegacyPasswordGenerationService(\n    accountService,\n    navigation,\n    passwords,\n    passphrases,\n    history,\n  );\n}\n\n/** Adapts the generator 2.0 design to 1.0 angular services. */\nexport class LegacyPasswordGenerationService implements PasswordGenerationServiceAbstraction {\n  constructor(\n    private readonly accountService: AccountService,\n    private readonly navigation: GeneratorNavigationService,\n    private readonly passwords: GeneratorService<\n      PasswordGenerationOptions,\n      PasswordGeneratorPolicy\n    >,\n    private readonly passphrases: GeneratorService<\n      PassphraseGenerationOptions,\n      PassphraseGeneratorPolicy\n    >,\n    private readonly history: GeneratorHistoryService,\n  ) {}\n\n  generatePassword(options: PasswordGeneratorOptions) {\n    if (options.type === \"password\") {\n      return this.passwords.generate(options);\n    } else {\n      return this.passphrases.generate(options);\n    }\n  }\n\n  generatePassphrase(options: PasswordGeneratorOptions) {\n    return this.passphrases.generate(options);\n  }\n\n  private getRawOptions$() {\n    // give the typechecker a nudge to avoid \"implicit any\" errors\n    type RawOptionsIntermediateType = [\n      PasswordGenerationOptions,\n      PasswordGenerationOptions,\n      [PolicyEvaluator<PasswordGeneratorPolicy, PasswordGenerationOptions>, number],\n      PassphraseGenerationOptions,\n      PassphraseGenerationOptions,\n      [PolicyEvaluator<PassphraseGeneratorPolicy, PassphraseGenerationOptions>, number],\n      GeneratorNavigation,\n      GeneratorNavigation,\n      [PolicyEvaluator<GeneratorNavigationPolicy, GeneratorNavigation>, number],\n    ];\n\n    function withSequenceNumber<T>(observable$: Observable<T>) {\n      return observable$.pipe(map((evaluator, i) => [evaluator, i] as const));\n    }\n\n    // initial array ensures that destructuring never fails; sequence numbers\n    // set to `-1` so that the first update reflects that the policy changed from\n    // \"unknown\" to \"whatever was provided by the service\". This needs to be called\n    // each time the active user changes or the `concat` will block.\n    function initial$() {\n      const initial: RawOptionsIntermediateType = [\n        null,\n        null,\n        [null, -1],\n        null,\n        null,\n        [null, -1],\n        null,\n        null,\n        [null, -1],\n      ];\n\n      return of(initial);\n    }\n\n    function intermediatePairsToRawOptions([previous, current]: [\n      RawOptionsIntermediateType,\n      RawOptionsIntermediateType,\n    ]) {\n      const [, , [, passwordPrevious], , , [, passphrasePrevious], , , [, generatorPrevious]] =\n        previous;\n      const [\n        passwordOptions,\n        passwordDefaults,\n        [passwordEvaluator, passwordCurrent],\n        passphraseOptions,\n        passphraseDefaults,\n        [passphraseEvaluator, passphraseCurrent],\n        generatorOptions,\n        generatorDefaults,\n        [generatorEvaluator, generatorCurrent],\n      ] = current;\n\n      // when any of the sequence numbers change, the emission occurs as the result of\n      // a policy update\n      const policyEmitted =\n        passwordPrevious < passwordCurrent ||\n        passphrasePrevious < passphraseCurrent ||\n        generatorPrevious < generatorCurrent;\n\n      const result = [\n        passwordOptions,\n        passwordDefaults,\n        passwordEvaluator,\n        passphraseOptions,\n        passphraseDefaults,\n        passphraseEvaluator,\n        generatorOptions,\n        generatorDefaults,\n        generatorEvaluator,\n        policyEmitted,\n      ] as const;\n\n      return result;\n    }\n\n    // look upon my works, ye mighty, and despair!\n    const rawOptions$ = this.accountService.activeAccount$.pipe(\n      concatMap((activeUser) =>\n        concat(\n          initial$(),\n          combineLatest([\n            this.passwords.options$(activeUser.id),\n            this.passwords.defaults$(activeUser.id),\n            withSequenceNumber(this.passwords.evaluator$(activeUser.id)),\n            this.passphrases.options$(activeUser.id),\n            this.passphrases.defaults$(activeUser.id),\n            withSequenceNumber(this.passphrases.evaluator$(activeUser.id)),\n            this.navigation.options$(activeUser.id),\n            this.navigation.defaults$(activeUser.id),\n            withSequenceNumber(this.navigation.evaluator$(activeUser.id)),\n          ]),\n        ),\n      ),\n      pairwise(),\n      map(intermediatePairsToRawOptions),\n    );\n\n    return rawOptions$;\n  }\n\n  getOptions$() {\n    const options$ = this.getRawOptions$().pipe(\n      map(\n        ([\n          passwordOptions,\n          passwordDefaults,\n          passwordEvaluator,\n          passphraseOptions,\n          passphraseDefaults,\n          passphraseEvaluator,\n          generatorOptions,\n          generatorDefaults,\n          generatorEvaluator,\n          policyUpdated,\n        ]) => {\n          const passwordOptionsWithPolicy = passwordEvaluator.applyPolicy(\n            passwordOptions ?? passwordDefaults,\n          );\n          const passphraseOptionsWithPolicy = passphraseEvaluator.applyPolicy(\n            passphraseOptions ?? passphraseDefaults,\n          );\n          const generatorOptionsWithPolicy = generatorEvaluator.applyPolicy(\n            generatorOptions ?? generatorDefaults,\n          );\n\n          const options = this.toPasswordGeneratorOptions({\n            password: passwordEvaluator.sanitize(passwordOptionsWithPolicy),\n            passphrase: passphraseEvaluator.sanitize(passphraseOptionsWithPolicy),\n            generator: generatorEvaluator.sanitize(generatorOptionsWithPolicy),\n            policyUpdated,\n          });\n\n          const policy = Object.assign(\n            new PasswordGeneratorPolicyOptions(),\n            passwordEvaluator.policy,\n            passphraseEvaluator.policy,\n            generatorEvaluator.policy,\n          );\n\n          return [options, policy] as [PasswordGeneratorOptions, PasswordGeneratorPolicyOptions];\n        },\n      ),\n    );\n\n    return options$;\n  }\n\n  async getOptions() {\n    return await firstValueFrom(this.getOptions$());\n  }\n\n  async enforcePasswordGeneratorPoliciesOnOptions(options: PasswordGeneratorOptions) {\n    const options$ = this.accountService.activeAccount$.pipe(\n      concatMap((activeUser) =>\n        zip(\n          this.passwords.evaluator$(activeUser.id),\n          this.passphrases.evaluator$(activeUser.id),\n          this.navigation.evaluator$(activeUser.id),\n        ),\n      ),\n      map(([passwordEvaluator, passphraseEvaluator, navigationEvaluator]) => {\n        const policy = Object.assign(\n          new PasswordGeneratorPolicyOptions(),\n          passwordEvaluator.policy,\n          passphraseEvaluator.policy,\n          navigationEvaluator.policy,\n        );\n\n        const navigationApplied = navigationEvaluator.applyPolicy(options);\n        const navigationSanitized = {\n          ...options,\n          ...navigationEvaluator.sanitize(navigationApplied),\n        };\n        if (options.type === \"password\") {\n          const applied = passwordEvaluator.applyPolicy(navigationSanitized);\n          const sanitized = passwordEvaluator.sanitize(applied);\n          return [sanitized, policy];\n        } else {\n          const applied = passphraseEvaluator.applyPolicy(navigationSanitized);\n          const sanitized = passphraseEvaluator.sanitize(applied);\n          return [sanitized, policy];\n        }\n      }),\n    );\n\n    const [sanitized, policy] = await firstValueFrom(options$);\n    return [\n      // callers assume this function updates the options parameter\n      Object.assign(options, sanitized),\n      policy,\n    ] as [PasswordGeneratorOptions, PasswordGeneratorPolicyOptions];\n  }\n\n  async saveOptions(options: PasswordGeneratorOptions) {\n    const stored = this.toStoredOptions(options);\n    const activeAccount = await firstValueFrom(this.accountService.activeAccount$);\n\n    // generator settings needs to preserve whether password or passphrase is selected,\n    // so `navigationOptions` is mutated.\n    const navigationOptions$ = zip(\n      this.navigation.options$(activeAccount.id),\n      this.navigation.defaults$(activeAccount.id),\n    ).pipe(map(([options, defaults]) => options ?? defaults));\n    let navigationOptions = await firstValueFrom(navigationOptions$);\n    navigationOptions = Object.assign(navigationOptions, stored.generator);\n    await this.navigation.saveOptions(activeAccount.id, navigationOptions);\n\n    // overwrite all other settings with latest values\n    await this.passwords.saveOptions(activeAccount.id, stored.password);\n    await this.passphrases.saveOptions(activeAccount.id, stored.passphrase);\n  }\n\n  private toStoredOptions(options: PasswordGeneratorOptions): MappedOptions {\n    return {\n      generator: {\n        type: options.type,\n      },\n      password: {\n        length: options.length,\n        minLength: options.minLength,\n        ambiguous: options.ambiguous,\n        uppercase: options.uppercase,\n        minUppercase: options.minUppercase,\n        lowercase: options.lowercase,\n        minLowercase: options.minLowercase,\n        number: options.number,\n        minNumber: options.minNumber,\n        special: options.special,\n        minSpecial: options.minSpecial,\n      },\n      passphrase: {\n        numWords: options.numWords,\n        wordSeparator: options.wordSeparator,\n        capitalize: options.capitalize,\n        includeNumber: options.includeNumber,\n      },\n      policyUpdated: false,\n    };\n  }\n\n  private toPasswordGeneratorOptions(options: MappedOptions): PasswordGeneratorOptions {\n    return {\n      type: options.generator.type,\n      length: options.password.length,\n      minLength: options.password.minLength,\n      ambiguous: options.password.ambiguous,\n      uppercase: options.password.uppercase,\n      minUppercase: options.password.minUppercase,\n      lowercase: options.password.lowercase,\n      minLowercase: options.password.minLowercase,\n      number: options.password.number,\n      minNumber: options.password.minNumber,\n      special: options.password.special,\n      minSpecial: options.password.minSpecial,\n      numWords: options.passphrase.numWords,\n      wordSeparator: options.passphrase.wordSeparator,\n      capitalize: options.passphrase.capitalize,\n      includeNumber: options.passphrase.includeNumber,\n      policyUpdated: options.policyUpdated,\n    };\n  }\n\n  getHistory() {\n    const history = this.accountService.activeAccount$.pipe(\n      concatMap((account) => this.history.credentials$(account.id)),\n      timeout({\n        // timeout after 1 second\n        each: 1000,\n        with() {\n          return [];\n        },\n      }),\n      map((history) => history.map(toGeneratedPasswordHistory)),\n    );\n\n    return firstValueFrom(history);\n  }\n\n  async addHistory(password: string) {\n    const account = await firstValueFrom(this.accountService.activeAccount$);\n    if (account?.id) {\n      // legacy service doesn't distinguish credential types\n      await this.history.track(account.id, password, \"password\");\n    }\n  }\n\n  clear() {\n    const history$ = this.accountService.activeAccount$.pipe(\n      filter((account) => !!account?.id),\n      concatMap((account) => this.history.clear(account.id)),\n      timeout({\n        // timeout after 1 second\n        each: 1000,\n        with() {\n          return [];\n        },\n      }),\n      map((history) => history.map(toGeneratedPasswordHistory)),\n    );\n\n    return firstValueFrom(history$);\n  }\n}\n\nfunction toGeneratedPasswordHistory(value: GeneratedCredential) {\n  return new GeneratedPasswordHistory(value.credential, value.generationDate.valueOf());\n}\n","import { PolicyEvaluator } from \"./abstractions\";\nimport { NoPolicy } from \"./no-policy\";\n\n/** A policy evaluator that does not apply any policy */\nexport class DefaultPolicyEvaluator<PolicyTarget>\n  implements PolicyEvaluator<NoPolicy, PolicyTarget>\n{\n  /** {@link PolicyEvaluator.policy} */\n  get policy() {\n    return {};\n  }\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect() {\n    return false;\n  }\n\n  /** {@link PolicyEvaluator.applyPolicy} */\n  applyPolicy(options: PolicyTarget) {\n    return options;\n  }\n\n  /** {@link PolicyEvaluator.sanitize} */\n  sanitize(options: PolicyTarget) {\n    return options;\n  }\n}\n","import { RequestOptions } from \"./options/forwarder-options\";\n\n/** Settings supported when generating a username using the EFF word list */\nexport type EffUsernameGenerationOptions = {\n  /** when true, the word is capitalized */\n  wordCapitalize?: boolean;\n\n  /** when true, a random number is appended to the username */\n  wordIncludeNumber?: boolean;\n} & RequestOptions;\n\n/** The default options for EFF long word generation. */\nexport const DefaultEffUsernameOptions: EffUsernameGenerationOptions = Object.freeze({\n  wordCapitalize: false,\n  wordIncludeNumber: false,\n  website: null,\n});\n","import { BehaviorSubject, map, pipe } from \"rxjs\";\n\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratorStrategy } from \"../abstractions\";\nimport { UsernameGenerationServiceAbstraction } from \"../abstractions/username-generation.service.abstraction\";\nimport { DefaultPolicyEvaluator } from \"../default-policy-evaluator\";\nimport { EFF_USERNAME_SETTINGS } from \"../key-definitions\";\nimport { NoPolicy } from \"../no-policy\";\n\nimport {\n  DefaultEffUsernameOptions,\n  EffUsernameGenerationOptions,\n} from \"./eff-username-generator-options\";\n\n/** Strategy for creating usernames from the EFF wordlist */\nexport class EffUsernameGeneratorStrategy\n  implements GeneratorStrategy<EffUsernameGenerationOptions, NoPolicy>\n{\n  /** Instantiates the generation strategy\n   *  @param usernameService generates a username from EFF word list\n   */\n  constructor(\n    private usernameService: UsernameGenerationServiceAbstraction,\n    private stateProvider: StateProvider,\n  ) {}\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState(id: UserId) {\n    return this.stateProvider.getUser(id, EFF_USERNAME_SETTINGS);\n  }\n\n  /** {@link GeneratorStrategy.defaults$} */\n  defaults$(userId: UserId) {\n    return new BehaviorSubject({ ...DefaultEffUsernameOptions }).asObservable();\n  }\n\n  /** {@link GeneratorStrategy.policy} */\n  get policy() {\n    // Uses password generator since there aren't policies\n    // specific to usernames.\n    return PolicyType.PasswordGenerator;\n  }\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator() {\n    return pipe(map((_) => new DefaultPolicyEvaluator<EffUsernameGenerationOptions>()));\n  }\n\n  /** {@link GeneratorStrategy.generate} */\n  generate(options: EffUsernameGenerationOptions) {\n    return this.usernameService.generateWord(options);\n  }\n}\n","import { RequestOptions } from \"./options/forwarder-options\";\nimport { UsernameGenerationMode } from \"./options/generator-options\";\n\n/** Settings supported when generating an email subaddress */\nexport type CatchallGenerationOptions = {\n  /** selects the generation algorithm for the catchall email address. */\n  catchallType?: UsernameGenerationMode;\n\n  /** The domain part of the generated email address.\n   *  @example If the domain is `domain.io` and the generated username\n   *  is `jd`, then the generated email address will be `jd@mydomain.io`\n   */\n  catchallDomain?: string;\n} & RequestOptions;\n\n/** The default options for catchall address generation. */\nexport const DefaultCatchallOptions: CatchallGenerationOptions = Object.freeze({\n  catchallType: \"random\",\n  catchallDomain: \"\",\n  website: null,\n});\n","import { BehaviorSubject, map, pipe } from \"rxjs\";\n\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratorStrategy } from \"../abstractions\";\nimport { UsernameGenerationServiceAbstraction } from \"../abstractions/username-generation.service.abstraction\";\nimport { DefaultPolicyEvaluator } from \"../default-policy-evaluator\";\nimport { CATCHALL_SETTINGS } from \"../key-definitions\";\nimport { NoPolicy } from \"../no-policy\";\n\nimport { CatchallGenerationOptions, DefaultCatchallOptions } from \"./catchall-generator-options\";\n\n/** Strategy for creating usernames using a catchall email address */\nexport class CatchallGeneratorStrategy\n  implements GeneratorStrategy<CatchallGenerationOptions, NoPolicy>\n{\n  /** Instantiates the generation strategy\n   *  @param usernameService generates a catchall address for a domain\n   */\n  constructor(\n    private usernameService: UsernameGenerationServiceAbstraction,\n    private stateProvider: StateProvider,\n  ) {}\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState(id: UserId) {\n    return this.stateProvider.getUser(id, CATCHALL_SETTINGS);\n  }\n\n  /** {@link GeneratorStrategy.defaults$} */\n  defaults$(userId: UserId) {\n    return new BehaviorSubject({ ...DefaultCatchallOptions }).asObservable();\n  }\n\n  /** {@link GeneratorStrategy.policy} */\n  get policy() {\n    // Uses password generator since there aren't policies\n    // specific to usernames.\n    return PolicyType.PasswordGenerator;\n  }\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator() {\n    return pipe(map((_) => new DefaultPolicyEvaluator<CatchallGenerationOptions>()));\n  }\n\n  /** {@link GeneratorStrategy.generate} */\n  generate(options: CatchallGenerationOptions) {\n    return this.usernameService.generateCatchall(options);\n  }\n}\n","import { RequestOptions } from \"./options/forwarder-options\";\nimport { UsernameGenerationMode } from \"./options/generator-options\";\n\n/** Settings supported when generating an email subaddress */\nexport type SubaddressGenerationOptions = {\n  /** selects the generation algorithm for the catchall email address. */\n  subaddressType?: UsernameGenerationMode;\n\n  /** the email address the subaddress is applied to. */\n  subaddressEmail?: string;\n} & RequestOptions;\n\n/** The default options for email subaddress generation. */\nexport const DefaultSubaddressOptions: SubaddressGenerationOptions = Object.freeze({\n  subaddressType: \"random\",\n  subaddressEmail: \"\",\n  website: null,\n});\n","import { BehaviorSubject, map, pipe } from \"rxjs\";\n\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { GeneratorStrategy } from \"../abstractions\";\nimport { UsernameGenerationServiceAbstraction } from \"../abstractions/username-generation.service.abstraction\";\nimport { DefaultPolicyEvaluator } from \"../default-policy-evaluator\";\nimport { SUBADDRESS_SETTINGS } from \"../key-definitions\";\nimport { NoPolicy } from \"../no-policy\";\n\nimport {\n  DefaultSubaddressOptions,\n  SubaddressGenerationOptions,\n} from \"./subaddress-generator-options\";\n\n/** Strategy for creating an email subaddress\n *  @remarks The subaddress is the part following the `+`.\n *  For example, if the email address is `jd+xyz@domain.io`,\n *  the subaddress is `xyz`.\n */\nexport class SubaddressGeneratorStrategy\n  implements GeneratorStrategy<SubaddressGenerationOptions, NoPolicy>\n{\n  /** Instantiates the generation strategy\n   *  @param usernameService generates an email subaddress from an email address\n   */\n  constructor(\n    private usernameService: UsernameGenerationServiceAbstraction,\n    private stateProvider: StateProvider,\n  ) {}\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState(id: UserId) {\n    return this.stateProvider.getUser(id, SUBADDRESS_SETTINGS);\n  }\n\n  /** {@link GeneratorStrategy.defaults$} */\n  defaults$(userId: UserId) {\n    return new BehaviorSubject({ ...DefaultSubaddressOptions }).asObservable();\n  }\n\n  /** {@link GeneratorStrategy.policy} */\n  get policy() {\n    // Uses password generator since there aren't policies\n    // specific to usernames.\n    return PolicyType.PasswordGenerator;\n  }\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator() {\n    return pipe(map((_) => new DefaultPolicyEvaluator<SubaddressGenerationOptions>()));\n  }\n\n  /** {@link GeneratorStrategy.generate} */\n  generate(options: SubaddressGenerationOptions) {\n    return this.usernameService.generateSubaddress(options);\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class AnonAddyForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid addy.io API token.\";\n    }\n    if (options.anonaddy?.domain == null || options.anonaddy.domain === \"\") {\n      throw \"Invalid addy.io domain.\";\n    }\n    if (options.anonaddy?.baseUrl == null || options.anonaddy.baseUrl === \"\") {\n      throw \"Invalid addy.io url.\";\n    }\n\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n        \"X-Requested-With\": \"XMLHttpRequest\",\n      }),\n    };\n    const url = options.anonaddy.baseUrl + \"/api/v1/aliases\";\n    requestInit.body = JSON.stringify({\n      domain: options.anonaddy.domain,\n      description:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.data?.email;\n    }\n    if (response.status === 401) {\n      throw \"Invalid addy.io API token.\";\n    }\n    if (response?.statusText != null) {\n      throw \"addy.io error:\\n\" + response.statusText;\n    }\n    throw \"Unknown addy.io error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class DuckDuckGoForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid DuckDuckGo API token.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://quack.duckduckgo.com/api/email/addresses\";\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      if (json.address) {\n        return `${json.address}@duck.com`;\n      }\n    } else if (response.status === 401) {\n      throw \"Invalid DuckDuckGo API token.\";\n    }\n    throw \"Unknown DuckDuckGo error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class FastmailForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Fastmail API token.\";\n    }\n\n    const accountId = await this.getAccountId(apiService, options);\n    if (accountId == null || accountId === \"\") {\n      throw \"Unable to obtain Fastmail masked email account ID.\";\n    }\n\n    const forDomain = options.website || \"\";\n\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://api.fastmail.com/jmap/api/\";\n    requestInit.body = JSON.stringify({\n      using: [\"https://www.fastmail.com/dev/maskedemail\", \"urn:ietf:params:jmap:core\"],\n      methodCalls: [\n        [\n          \"MaskedEmail/set\",\n          {\n            accountId: accountId,\n            create: {\n              \"new-masked-email\": {\n                state: \"enabled\",\n                description: \"\",\n                forDomain: forDomain,\n                emailPrefix: options.fastmail.prefix,\n              },\n            },\n          },\n          \"0\",\n        ],\n      ],\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (\n        json.methodResponses != null &&\n        json.methodResponses.length > 0 &&\n        json.methodResponses[0].length > 0\n      ) {\n        if (json.methodResponses[0][0] === \"MaskedEmail/set\") {\n          if (json.methodResponses[0][1]?.created?.[\"new-masked-email\"] != null) {\n            return json.methodResponses[0][1]?.created?.[\"new-masked-email\"]?.email;\n          }\n          if (json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"] != null) {\n            throw (\n              \"Fastmail error: \" +\n              json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"]?.description\n            );\n          }\n        } else if (json.methodResponses[0][0] === \"error\") {\n          throw \"Fastmail error: \" + json.methodResponses[0][1]?.description;\n        }\n      }\n    }\n    if (response.status === 401 || response.status === 403) {\n      throw \"Invalid Fastmail API token.\";\n    }\n    throw \"Unknown Fastmail error occurred.\";\n  }\n\n  private async getAccountId(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    const requestInit: RequestInit = {\n      cache: \"no-store\",\n      method: \"GET\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n      }),\n    };\n    const url = \"https://api.fastmail.com/.well-known/jmap\";\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (json.primaryAccounts != null) {\n        return json.primaryAccounts[\"https://www.fastmail.com/dev/maskedemail\"];\n      }\n    }\n    return null;\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class FirefoxRelayForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Firefox Relay API token.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Token \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://relay.firefox.com/api/v1/relayaddresses/\";\n    requestInit.body = JSON.stringify({\n      enabled: true,\n      generated_for: options.website,\n      description:\n        (options.website != null ? options.website + \" - \" : \"\") + \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.full_address;\n    }\n    if (response.status === 401) {\n      throw \"Invalid Firefox Relay API token.\";\n    }\n    throw \"Unknown Firefox Relay error occurred.\";\n  }\n}\n","export class ForwarderOptions {\n  apiKey: string;\n  website: string;\n  fastmail = new FastmailForwarderOptions();\n  anonaddy = new AnonAddyForwarderOptions();\n  forwardemail = new ForwardEmailForwarderOptions();\n  simplelogin = new SimpleLoginForwarderOptions();\n}\n\nexport class FastmailForwarderOptions {\n  prefix: string;\n}\n\nexport class AnonAddyForwarderOptions {\n  domain: string;\n  baseUrl: string;\n}\n\nexport class ForwardEmailForwarderOptions {\n  domain: string;\n}\n\nexport class SimpleLoginForwarderOptions {\n  baseUrl: string;\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class SimpleLoginForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid SimpleLogin API key.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authentication: options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    let url = options.simplelogin.baseUrl + \"/api/alias/random/new\";\n    if (options.website != null) {\n      url += \"?hostname=\" + options.website;\n    }\n    requestInit.body = JSON.stringify({\n      note:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json.alias;\n    }\n    if (response.status === 401) {\n      throw \"Invalid SimpleLogin API key.\";\n    }\n    const json = await response.json();\n    if (json?.error != null) {\n      throw \"SimpleLogin error:\" + json.error;\n    }\n    throw \"Unknown SimpleLogin error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\nimport { Utils } from \"../../../../platform/misc/utils\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class ForwardEmailForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Forward Email API key.\";\n    }\n    if (options.forwardemail?.domain == null || options.forwardemail.domain === \"\") {\n      throw \"Invalid Forward Email domain.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Basic \" + Utils.fromUtf8ToB64(options.apiKey + \":\"),\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = `https://api.forwardemail.net/v1/domains/${options.forwardemail.domain}/aliases`;\n    requestInit.body = JSON.stringify({\n      labels: options.website,\n      description:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.name + \"@\" + (json?.domain?.name || options.forwardemail.domain);\n    }\n    if (response.status === 401) {\n      throw \"Invalid Forward Email API key.\";\n    }\n    const json = await response.json();\n    if (json?.message != null) {\n      throw \"Forward Email error:\\n\" + json.message;\n    }\n    if (json?.error != null) {\n      throw \"Forward Email error:\\n\" + json.error;\n    }\n    throw \"Unknown Forward Email error occurred.\";\n  }\n}\n","import { from } from \"rxjs\";\n\nimport { ApiService } from \"../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { EFFLongWordList } from \"../../../platform/misc/wordlist\";\nimport { UsernameGenerationServiceAbstraction } from \"../abstractions/username-generation.service.abstraction\";\n\nimport {\n  AnonAddyForwarder,\n  DuckDuckGoForwarder,\n  FastmailForwarder,\n  FirefoxRelayForwarder,\n  ForwardEmailForwarder,\n  Forwarder,\n  ForwarderOptions,\n  SimpleLoginForwarder,\n} from \"./email-forwarders\";\nimport { UsernameGeneratorOptions } from \"./username-generation-options\";\n\nconst DefaultOptions: UsernameGeneratorOptions = {\n  type: \"word\",\n  website: null,\n  wordCapitalize: true,\n  wordIncludeNumber: true,\n  subaddressType: \"random\",\n  catchallType: \"random\",\n  forwardedService: \"\",\n  forwardedAnonAddyDomain: \"anonaddy.me\",\n  forwardedAnonAddyBaseUrl: \"https://app.addy.io\",\n  forwardedForwardEmailDomain: \"hideaddress.net\",\n  forwardedSimpleLoginBaseUrl: \"https://app.simplelogin.io\",\n};\n\nexport class UsernameGenerationService implements UsernameGenerationServiceAbstraction {\n  constructor(\n    private cryptoService: CryptoService,\n    private stateService: StateService,\n    private apiService: ApiService,\n  ) {}\n\n  generateUsername(options: UsernameGeneratorOptions): Promise<string> {\n    if (options.type === \"catchall\") {\n      return this.generateCatchall(options);\n    } else if (options.type === \"subaddress\") {\n      return this.generateSubaddress(options);\n    } else if (options.type === \"forwarded\") {\n      return this.generateForwarded(options);\n    } else {\n      return this.generateWord(options);\n    }\n  }\n\n  async generateWord(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.wordCapitalize == null) {\n      o.wordCapitalize = true;\n    }\n    if (o.wordIncludeNumber == null) {\n      o.wordIncludeNumber = true;\n    }\n\n    const wordIndex = await this.cryptoService.randomNumber(0, EFFLongWordList.length - 1);\n    let word = EFFLongWordList[wordIndex];\n    if (o.wordCapitalize) {\n      word = word.charAt(0).toUpperCase() + word.slice(1);\n    }\n    if (o.wordIncludeNumber) {\n      const num = await this.cryptoService.randomNumber(1, 9999);\n      word = word + this.zeroPad(num.toString(), 4);\n    }\n    return word;\n  }\n\n  async generateSubaddress(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    const subaddressEmail = o.subaddressEmail;\n    if (subaddressEmail == null || subaddressEmail.length < 3) {\n      return o.subaddressEmail;\n    }\n    const atIndex = subaddressEmail.indexOf(\"@\");\n    if (atIndex < 1 || atIndex >= subaddressEmail.length - 1) {\n      return subaddressEmail;\n    }\n    if (o.subaddressType == null) {\n      o.subaddressType = \"random\";\n    }\n\n    const emailBeginning = subaddressEmail.substr(0, atIndex);\n    const emailEnding = subaddressEmail.substr(atIndex + 1, subaddressEmail.length);\n\n    let subaddressString = \"\";\n    if (o.subaddressType === \"random\") {\n      subaddressString = await this.randomString(8);\n    } else if (o.subaddressType === \"website-name\") {\n      subaddressString = o.website;\n    }\n    return emailBeginning + \"+\" + subaddressString + \"@\" + emailEnding;\n  }\n\n  async generateCatchall(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.catchallDomain == null || o.catchallDomain === \"\") {\n      return null;\n    }\n    if (o.catchallType == null) {\n      o.catchallType = \"random\";\n    }\n\n    let startString = \"\";\n    if (o.catchallType === \"random\") {\n      startString = await this.randomString(8);\n    } else if (o.catchallType === \"website-name\") {\n      startString = o.website;\n    }\n    return startString + \"@\" + o.catchallDomain;\n  }\n\n  async generateForwarded(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.forwardedService == null) {\n      return null;\n    }\n\n    let forwarder: Forwarder = null;\n    const forwarderOptions = new ForwarderOptions();\n    forwarderOptions.website = o.website;\n    if (o.forwardedService === \"simplelogin\") {\n      forwarder = new SimpleLoginForwarder();\n      forwarderOptions.apiKey = o.forwardedSimpleLoginApiKey;\n      forwarderOptions.simplelogin.baseUrl = o.forwardedSimpleLoginBaseUrl;\n    } else if (o.forwardedService === \"anonaddy\") {\n      forwarder = new AnonAddyForwarder();\n      forwarderOptions.apiKey = o.forwardedAnonAddyApiToken;\n      forwarderOptions.anonaddy.domain = o.forwardedAnonAddyDomain;\n      forwarderOptions.anonaddy.baseUrl = o.forwardedAnonAddyBaseUrl;\n    } else if (o.forwardedService === \"firefoxrelay\") {\n      forwarder = new FirefoxRelayForwarder();\n      forwarderOptions.apiKey = o.forwardedFirefoxApiToken;\n    } else if (o.forwardedService === \"fastmail\") {\n      forwarder = new FastmailForwarder();\n      forwarderOptions.apiKey = o.forwardedFastmailApiToken;\n    } else if (o.forwardedService === \"duckduckgo\") {\n      forwarder = new DuckDuckGoForwarder();\n      forwarderOptions.apiKey = o.forwardedDuckDuckGoToken;\n    } else if (o.forwardedService === \"forwardemail\") {\n      forwarder = new ForwardEmailForwarder();\n      forwarderOptions.apiKey = o.forwardedForwardEmailApiToken;\n      forwarderOptions.forwardemail.domain = o.forwardedForwardEmailDomain;\n    }\n\n    if (forwarder == null) {\n      return null;\n    }\n\n    return forwarder.generate(this.apiService, forwarderOptions);\n  }\n\n  getOptions$() {\n    return from(this.getOptions());\n  }\n\n  async getOptions(): Promise<UsernameGeneratorOptions> {\n    let options = await this.stateService.getUsernameGenerationOptions();\n    if (options == null) {\n      options = Object.assign({}, DefaultOptions);\n    } else {\n      options = Object.assign({}, DefaultOptions, options);\n    }\n    await this.stateService.setUsernameGenerationOptions(options);\n    return options;\n  }\n\n  async saveOptions(options: UsernameGeneratorOptions) {\n    await this.stateService.setUsernameGenerationOptions(options);\n  }\n\n  private async randomString(length: number) {\n    let str = \"\";\n    const charSet = \"abcdefghijklmnopqrstuvwxyz1234567890\";\n    for (let i = 0; i < length; i++) {\n      const randomCharIndex = await this.cryptoService.randomNumber(0, charSet.length - 1);\n      str += charSet.charAt(randomCharIndex);\n    }\n    return str;\n  }\n\n  // ref: https://stackoverflow.com/a/10073788\n  private zeroPad(number: string, width: number) {\n    return number.length >= width\n      ? number\n      : new Array(width - number.length + 1).join(\"0\") + number;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { PolicyType } from \"../../../admin-console/enums\";\n// FIXME: use index.ts imports once policy abstractions and models\n// implement ADR-0002\nimport { Policy as AdminPolicy } from \"../../../admin-console/models/domain/policy\";\nimport { SingleUserState } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\n\nimport { PolicyEvaluator } from \"./policy-evaluator.abstraction\";\n\n/** Tailors the generator service to generate a specific kind of credentials */\nexport abstract class GeneratorStrategy<Options, Policy> {\n  /** Retrieve application state that persists across locks.\n   *  @param userId: identifies the user state to retrieve\n   *  @returns the strategy's durable user state\n   */\n  durableState: (userId: UserId) => SingleUserState<Options>;\n\n  /** Gets the default options. */\n  defaults$: (userId: UserId) => Observable<Options>;\n\n  /** Identifies the policy enforced by the generator. */\n  policy: PolicyType;\n\n  /** Operator function that converts a policy collection observable to a single\n   *   policy evaluator observable.\n   * @param policy The policy being evaluated.\n   * @returns the policy evaluator. If `policy` is is `null` or `undefined`,\n   * then the evaluator defaults to the application's limits.\n   * @throws when the policy's type does not match the generator's policy type.\n   */\n  toEvaluator: () => (\n    source: Observable<AdminPolicy[]>,\n  ) => Observable<PolicyEvaluator<Policy, Options>>;\n\n  /** Generates credentials from the given options.\n   * @param options The options used to generate the credentials.\n   * @returns a promise that resolves to the generated credentials.\n   */\n  generate: (options: Options) => Promise<string>;\n}\n","import { Observable, map, pipe } from \"rxjs\";\n\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { SingleUserState, StateProvider, UserKeyDefinition } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { BufferedKeyDefinition } from \"../../state/buffered-key-definition\";\nimport { BufferedState } from \"../../state/buffered-state\";\nimport { PaddedDataPacker } from \"../../state/padded-data-packer\";\nimport { SecretClassifier } from \"../../state/secret-classifier\";\nimport { SecretKeyDefinition } from \"../../state/secret-key-definition\";\nimport { SecretState } from \"../../state/secret-state\";\nimport { UserKeyEncryptor } from \"../../state/user-key-encryptor\";\nimport { GeneratorStrategy } from \"../abstractions\";\nimport { DefaultPolicyEvaluator } from \"../default-policy-evaluator\";\nimport { NoPolicy } from \"../no-policy\";\n\nimport { ApiOptions } from \"./options/forwarder-options\";\n\nconst OPTIONS_FRAME_SIZE = 512;\n\n/** An email forwarding service configurable through an API. */\nexport abstract class ForwarderGeneratorStrategy<\n  Options extends ApiOptions,\n> extends GeneratorStrategy<Options, NoPolicy> {\n  /** Initializes the generator strategy\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private readonly encryptService: EncryptService,\n    private readonly keyService: CryptoService,\n    private stateProvider: StateProvider,\n  ) {\n    super();\n    // Uses password generator since there aren't policies\n    // specific to usernames.\n    this.policy = PolicyType.PasswordGenerator;\n  }\n\n  private durableStates = new Map<UserId, SingleUserState<Options>>();\n\n  /** {@link GeneratorStrategy.durableState} */\n  durableState = (userId: UserId) => {\n    let state = this.durableStates.get(userId);\n\n    if (!state) {\n      state = this.createState(userId);\n\n      this.durableStates.set(userId, state);\n    }\n\n    return state;\n  };\n\n  private createState(userId: UserId): SingleUserState<Options> {\n    // construct the encryptor\n    const packer = new PaddedDataPacker(OPTIONS_FRAME_SIZE);\n    const encryptor = new UserKeyEncryptor(this.encryptService, this.keyService, packer);\n\n    // always exclude request properties\n    const classifier = SecretClassifier.allSecret<Options>().exclude(\"website\");\n\n    // Derive the secret key definition\n    const key = SecretKeyDefinition.value(this.key.stateDefinition, this.key.key, classifier, {\n      deserializer: (d) => this.key.deserializer(d),\n      cleanupDelayMs: this.key.cleanupDelayMs,\n      clearOn: this.key.clearOn,\n    });\n\n    // the type parameter is explicit because type inference fails for `Omit<Options, \"website\">`\n    const secretState = SecretState.from<\n      Options,\n      void,\n      Options,\n      Record<keyof Options, never>,\n      Omit<Options, \"website\">\n    >(userId, key, this.stateProvider, encryptor);\n\n    // rollover should occur once the user key is available for decryption\n    const canDecrypt$ = this.keyService\n      .getInMemoryUserKeyFor$(userId)\n      .pipe(map((key) => key !== null));\n    const rolloverState = new BufferedState(\n      this.stateProvider,\n      this.rolloverKey,\n      secretState,\n      canDecrypt$,\n    );\n\n    return rolloverState;\n  }\n\n  /** Gets the default options. */\n  abstract defaults$: (userId: UserId) => Observable<Options>;\n\n  /** Determine where forwarder configuration is stored  */\n  protected abstract readonly key: UserKeyDefinition<Options>;\n\n  /** Determine where forwarder rollover configuration is stored  */\n  protected abstract readonly rolloverKey: BufferedKeyDefinition<Options, Options>;\n\n  /** {@link GeneratorStrategy.toEvaluator} */\n  toEvaluator = () => {\n    return pipe(map((_) => new DefaultPolicyEvaluator<Options>()));\n  };\n}\n","import { ForwarderMetadata } from \"./forwarder-options\";\n\n/** Metadata about an email forwarding service.\n *  @remarks This is used to populate the forwarder selection list\n *  and to identify forwarding services in error messages.\n */\nexport const Forwarders = Object.freeze({\n  /** For https://addy.io/ */\n  AddyIo: Object.freeze({\n    id: \"anonaddy\",\n    name: \"Addy.io\",\n    validForSelfHosted: true,\n  } as ForwarderMetadata),\n\n  /** For https://duckduckgo.com/email/ */\n  DuckDuckGo: Object.freeze({\n    id: \"duckduckgo\",\n    name: \"DuckDuckGo\",\n    validForSelfHosted: false,\n  } as ForwarderMetadata),\n\n  /** For https://www.fastmail.com. */\n  Fastmail: Object.freeze({\n    id: \"fastmail\",\n    name: \"Fastmail\",\n    validForSelfHosted: true,\n  } as ForwarderMetadata),\n\n  /** For https://relay.firefox.com/ */\n  FirefoxRelay: Object.freeze({\n    id: \"firefoxrelay\",\n    name: \"Firefox Relay\",\n    validForSelfHosted: false,\n  } as ForwarderMetadata),\n\n  /** For https://forwardemail.net/ */\n  ForwardEmail: Object.freeze({\n    id: \"forwardemail\",\n    name: \"Forward Email\",\n    validForSelfHosted: true,\n  } as ForwarderMetadata),\n\n  /** For https://simplelogin.io/ */\n  SimpleLogin: Object.freeze({\n    id: \"simplelogin\",\n    name: \"SimpleLogin\",\n    validForSelfHosted: true,\n  } as ForwarderMetadata),\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { ADDY_IO_FORWARDER, ADDY_IO_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { EmailDomainOptions, SelfHostedApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultAddyIoOptions: SelfHostedApiOptions & EmailDomainOptions = Object.freeze({\n  website: null,\n  baseUrl: \"https://app.addy.io\",\n  token: \"\",\n  domain: \"\",\n});\n\n/** Generates a forwarding address for addy.io (formerly anon addy) */\nexport class AddyIoForwarder extends ForwarderGeneratorStrategy<\n  SelfHostedApiOptions & EmailDomainOptions\n> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return ADDY_IO_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return ADDY_IO_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultAddyIoOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: SelfHostedApiOptions & EmailDomainOptions) => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.AddyIo.name);\n      throw error;\n    }\n    if (!options.domain || options.domain === \"\") {\n      const error = this.i18nService.t(\"forwarderNoDomain\", Forwarders.AddyIo.name);\n      throw error;\n    }\n    if (!options.baseUrl || options.baseUrl === \"\") {\n      const error = this.i18nService.t(\"forwarderNoUrl\", Forwarders.AddyIo.name);\n      throw error;\n    }\n\n    let descriptionId = \"forwarderGeneratedByWithWebsite\";\n    if (!options.website || options.website === \"\") {\n      descriptionId = \"forwarderGeneratedBy\";\n    }\n    const description = this.i18nService.t(descriptionId, options.website ?? \"\");\n\n    const url = options.baseUrl + \"/api/v1/aliases\";\n    const request = new Request(url, {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.token,\n        \"Content-Type\": \"application/json\",\n        \"X-Requested-With\": \"XMLHttpRequest\",\n      }),\n      body: JSON.stringify({\n        domain: options.domain,\n        description,\n      }),\n    });\n\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.data?.email;\n    } else if (response.status === 401) {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.AddyIo.name);\n      throw error;\n    } else if (response?.statusText) {\n      const error = this.i18nService.t(\n        \"forwarderError\",\n        Forwarders.AddyIo.name,\n        response.statusText,\n      );\n      throw error;\n    } else {\n      const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.AddyIo.name);\n      throw error;\n    }\n  };\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  baseUrl: \"https://app.addy.io\",\n  domain: \"\",\n  token: \"\",\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { DUCK_DUCK_GO_FORWARDER, DUCK_DUCK_GO_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { ApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultDuckDuckGoOptions: ApiOptions = Object.freeze({\n  website: null,\n  token: \"\",\n});\n\n/** Generates a forwarding address for DuckDuckGo */\nexport class DuckDuckGoForwarder extends ForwarderGeneratorStrategy<ApiOptions> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return DUCK_DUCK_GO_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return DUCK_DUCK_GO_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultDuckDuckGoOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: ApiOptions): Promise<string> => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.DuckDuckGo.name);\n      throw error;\n    }\n\n    const url = \"https://quack.duckduckgo.com/api/email/addresses\";\n    const request = new Request(url, {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.token,\n        \"Content-Type\": \"application/json\",\n      }),\n    });\n\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      if (json.address) {\n        return `${json.address}@duck.com`;\n      } else {\n        const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.DuckDuckGo.name);\n        throw error;\n      }\n    } else if (response.status === 401) {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.DuckDuckGo.name);\n      throw error;\n    } else {\n      const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.DuckDuckGo.name);\n      throw error;\n    }\n  };\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  token: \"\",\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { FASTMAIL_FORWARDER, FASTMAIL_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { EmailPrefixOptions, ApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultFastmailOptions: ApiOptions & EmailPrefixOptions = Object.freeze({\n  website: \"\",\n  domain: \"\",\n  prefix: \"\",\n  token: \"\",\n});\n\n/** Generates a forwarding address for Fastmail */\nexport class FastmailForwarder extends ForwarderGeneratorStrategy<ApiOptions & EmailPrefixOptions> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return FASTMAIL_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultFastmailOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return FASTMAIL_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: ApiOptions & EmailPrefixOptions) => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.Fastmail.name);\n      throw error;\n    }\n\n    const accountId = await this.getAccountId(options);\n    if (!accountId || accountId === \"\") {\n      const error = this.i18nService.t(\"forwarderNoAccountId\", Forwarders.Fastmail.name);\n      throw error;\n    }\n\n    const body = JSON.stringify({\n      using: [\"https://www.fastmail.com/dev/maskedemail\", \"urn:ietf:params:jmap:core\"],\n      methodCalls: [\n        [\n          \"MaskedEmail/set\",\n          {\n            accountId: accountId,\n            create: {\n              \"new-masked-email\": {\n                state: \"enabled\",\n                description: \"\",\n                forDomain: options.website,\n                emailPrefix: options.prefix,\n              },\n            },\n          },\n          \"0\",\n        ],\n      ],\n    });\n\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.token,\n        \"Content-Type\": \"application/json\",\n      }),\n      body,\n    };\n\n    const url = \"https://api.fastmail.com/jmap/api/\";\n    const request = new Request(url, requestInit);\n\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (\n        json.methodResponses != null &&\n        json.methodResponses.length > 0 &&\n        json.methodResponses[0].length > 0\n      ) {\n        if (json.methodResponses[0][0] === \"MaskedEmail/set\") {\n          if (json.methodResponses[0][1]?.created?.[\"new-masked-email\"] != null) {\n            return json.methodResponses[0][1]?.created?.[\"new-masked-email\"]?.email;\n          }\n          if (json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"] != null) {\n            const errorDescription =\n              json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"]?.description;\n            const error = this.i18nService.t(\n              \"forwarderError\",\n              Forwarders.Fastmail.name,\n              errorDescription,\n            );\n            throw error;\n          }\n        } else if (json.methodResponses[0][0] === \"error\") {\n          const errorDescription = json.methodResponses[0][1]?.description;\n          const error = this.i18nService.t(\n            \"forwarderError\",\n            Forwarders.Fastmail.name,\n            errorDescription,\n          );\n          throw error;\n        }\n      }\n    } else if (response.status === 401 || response.status === 403) {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.Fastmail.name);\n      throw error;\n    }\n\n    const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.Fastmail.name);\n    throw error;\n  };\n\n  private async getAccountId(options: ApiOptions): Promise<string> {\n    const requestInit: RequestInit = {\n      cache: \"no-store\",\n      method: \"GET\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.token,\n      }),\n    };\n    const url = \"https://api.fastmail.com/.well-known/jmap\";\n    const request = new Request(url, requestInit);\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (json.primaryAccounts != null) {\n        return json.primaryAccounts[\"https://www.fastmail.com/dev/maskedemail\"];\n      }\n    }\n    return null;\n  }\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  domain: \"\",\n  prefix: \"\",\n  token: \"\",\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { FIREFOX_RELAY_FORWARDER, FIREFOX_RELAY_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { ApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultFirefoxRelayOptions: ApiOptions = Object.freeze({\n  website: null,\n  token: \"\",\n});\n\n/** Generates a forwarding address for Firefox Relay */\nexport class FirefoxRelayForwarder extends ForwarderGeneratorStrategy<ApiOptions> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return FIREFOX_RELAY_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return FIREFOX_RELAY_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultFirefoxRelayOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: ApiOptions) => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.FirefoxRelay.name);\n      throw error;\n    }\n\n    const url = \"https://relay.firefox.com/api/v1/relayaddresses/\";\n\n    let descriptionId = \"forwarderGeneratedByWithWebsite\";\n    if (!options.website || options.website === \"\") {\n      descriptionId = \"forwarderGeneratedBy\";\n    }\n    const description = this.i18nService.t(descriptionId, options.website ?? \"\");\n\n    const request = new Request(url, {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Token \" + options.token,\n        \"Content-Type\": \"application/json\",\n      }),\n      body: JSON.stringify({\n        enabled: true,\n        generated_for: options.website,\n        description,\n      }),\n    });\n\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 401) {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.FirefoxRelay.name);\n      throw error;\n    } else if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json.full_address;\n    } else {\n      const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.FirefoxRelay.name);\n      throw error;\n    }\n  };\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  token: \"\",\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { FORWARD_EMAIL_FORWARDER, FORWARD_EMAIL_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { EmailDomainOptions, ApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultForwardEmailOptions: ApiOptions & EmailDomainOptions = Object.freeze({\n  website: null,\n  token: \"\",\n  domain: \"\",\n});\n\n/** Generates a forwarding address for Forward Email */\nexport class ForwardEmailForwarder extends ForwarderGeneratorStrategy<\n  ApiOptions & EmailDomainOptions\n> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return FORWARD_EMAIL_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultForwardEmailOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return FORWARD_EMAIL_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: ApiOptions & EmailDomainOptions) => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.ForwardEmail.name);\n      throw error;\n    }\n    if (!options.domain || options.domain === \"\") {\n      const error = this.i18nService.t(\"forwarderNoDomain\", Forwarders.ForwardEmail.name);\n      throw error;\n    }\n\n    const url = `https://api.forwardemail.net/v1/domains/${options.domain}/aliases`;\n\n    let descriptionId = \"forwarderGeneratedByWithWebsite\";\n    if (!options.website || options.website === \"\") {\n      descriptionId = \"forwarderGeneratedBy\";\n    }\n    const description = this.i18nService.t(descriptionId, options.website ?? \"\");\n\n    const request = new Request(url, {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Basic \" + Utils.fromUtf8ToB64(options.token + \":\"),\n        \"Content-Type\": \"application/json\",\n      }),\n      body: JSON.stringify({\n        labels: options.website,\n        description,\n      }),\n    });\n\n    const response = await this.apiService.nativeFetch(request);\n    const json = await response.json();\n\n    if (response.status === 401) {\n      const messageKey =\n        \"message\" in json ? \"forwaderInvalidTokenWithMessage\" : \"forwaderInvalidToken\";\n      const error = this.i18nService.t(messageKey, Forwarders.ForwardEmail.name, json.message);\n      throw error;\n    } else if (response.status === 200 || response.status === 201) {\n      const { name, domain } = await response.json();\n      const domainPart = domain?.name || options.domain;\n      return `${name}@${domainPart}`;\n    } else if (json?.message) {\n      const error = this.i18nService.t(\n        \"forwarderError\",\n        Forwarders.ForwardEmail.name,\n        json.message,\n      );\n      throw error;\n    } else if (json?.error) {\n      const error = this.i18nService.t(\"forwarderError\", Forwarders.ForwardEmail.name, json.error);\n      throw error;\n    } else {\n      const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.ForwardEmail.name);\n      throw error;\n    }\n  };\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  token: \"\",\n  domain: \"\",\n});\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { ApiService } from \"../../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../../../platform/state\";\nimport { UserId } from \"../../../../types/guid\";\nimport { SIMPLE_LOGIN_FORWARDER, SIMPLE_LOGIN_BUFFER } from \"../../key-definitions\";\nimport { ForwarderGeneratorStrategy } from \"../forwarder-generator-strategy\";\nimport { Forwarders } from \"../options/constants\";\nimport { SelfHostedApiOptions } from \"../options/forwarder-options\";\n\nexport const DefaultSimpleLoginOptions: SelfHostedApiOptions = Object.freeze({\n  website: null,\n  baseUrl: \"https://app.simplelogin.io\",\n  token: \"\",\n});\n\n/** Generates a forwarding address for Simple Login */\nexport class SimpleLoginForwarder extends ForwarderGeneratorStrategy<SelfHostedApiOptions> {\n  /** Instantiates the forwarder\n   *  @param apiService used for ajax requests to the forwarding service\n   *  @param i18nService used to look up error strings\n   *  @param encryptService protects sensitive forwarder options\n   *  @param keyService looks up the user key when protecting data.\n   *  @param stateProvider creates the durable state for options storage\n   */\n  constructor(\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    encryptService: EncryptService,\n    keyService: CryptoService,\n    stateProvider: StateProvider,\n  ) {\n    super(encryptService, keyService, stateProvider);\n  }\n\n  /** {@link ForwarderGeneratorStrategy.key} */\n  get key() {\n    return SIMPLE_LOGIN_FORWARDER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.rolloverKey} */\n  get rolloverKey() {\n    return SIMPLE_LOGIN_BUFFER;\n  }\n\n  /** {@link ForwarderGeneratorStrategy.defaults$} */\n  defaults$ = (userId: UserId) => {\n    return new BehaviorSubject({ ...DefaultSimpleLoginOptions });\n  };\n\n  /** {@link ForwarderGeneratorStrategy.generate} */\n  generate = async (options: SelfHostedApiOptions) => {\n    if (!options.token || options.token === \"\") {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.SimpleLogin.name);\n      throw error;\n    }\n    if (!options.baseUrl || options.baseUrl === \"\") {\n      const error = this.i18nService.t(\"forwarderNoUrl\", Forwarders.SimpleLogin.name);\n      throw error;\n    }\n\n    let url = options.baseUrl + \"/api/alias/random/new\";\n    let noteId = \"forwarderGeneratedBy\";\n    if (options.website && options.website !== \"\") {\n      url += \"?hostname=\" + options.website;\n      noteId = \"forwarderGeneratedByWithWebsite\";\n    }\n    const note = this.i18nService.t(noteId, options.website ?? \"\");\n\n    const request = new Request(url, {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authentication: options.token,\n        \"Content-Type\": \"application/json\",\n      }),\n      body: JSON.stringify({ note }),\n    });\n\n    const response = await this.apiService.nativeFetch(request);\n    if (response.status === 401) {\n      const error = this.i18nService.t(\"forwaderInvalidToken\", Forwarders.SimpleLogin.name);\n      throw error;\n    }\n\n    const json = await response.json();\n    if (response.status === 200 || response.status === 201) {\n      return json.alias;\n    } else if (json?.error) {\n      const error = this.i18nService.t(\"forwarderError\", Forwarders.SimpleLogin.name, json.error);\n      throw error;\n    } else {\n      const error = this.i18nService.t(\"forwarderUnknownError\", Forwarders.SimpleLogin.name);\n      throw error;\n    }\n  };\n}\n\nexport const DefaultOptions = Object.freeze({\n  website: null,\n  baseUrl: \"https://app.simplelogin.io\",\n  token: \"\",\n});\n","import { zip, firstValueFrom, map, concatMap, combineLatest } from \"rxjs\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { StateProvider } from \"../../platform/state\";\n\nimport { GeneratorService, GeneratorNavigationService } from \"./abstractions\";\nimport { UsernameGenerationServiceAbstraction } from \"./abstractions/username-generation.service.abstraction\";\nimport { DefaultGeneratorService } from \"./default-generator.service\";\nimport { DefaultGeneratorNavigationService } from \"./navigation/default-generator-navigation.service\";\nimport { GeneratorNavigation } from \"./navigation/generator-navigation\";\nimport { NoPolicy } from \"./no-policy\";\nimport {\n  CatchallGeneratorStrategy,\n  SubaddressGeneratorStrategy,\n  EffUsernameGeneratorStrategy,\n} from \"./username\";\nimport { CatchallGenerationOptions } from \"./username/catchall-generator-options\";\nimport { EffUsernameGenerationOptions } from \"./username/eff-username-generator-options\";\nimport { AddyIoForwarder } from \"./username/forwarders/addy-io\";\nimport { DuckDuckGoForwarder } from \"./username/forwarders/duck-duck-go\";\nimport { FastmailForwarder } from \"./username/forwarders/fastmail\";\nimport { FirefoxRelayForwarder } from \"./username/forwarders/firefox-relay\";\nimport { ForwardEmailForwarder } from \"./username/forwarders/forward-email\";\nimport { SimpleLoginForwarder } from \"./username/forwarders/simple-login\";\nimport { Forwarders } from \"./username/options/constants\";\nimport {\n  ApiOptions,\n  EmailDomainOptions,\n  EmailPrefixOptions,\n  RequestOptions,\n  SelfHostedApiOptions,\n} from \"./username/options/forwarder-options\";\nimport { SubaddressGenerationOptions } from \"./username/subaddress-generator-options\";\nimport { UsernameGeneratorOptions } from \"./username/username-generation-options\";\nimport { UsernameGenerationService } from \"./username/username-generation.service\";\n\ntype MappedOptions = {\n  generator: GeneratorNavigation;\n  algorithms: {\n    catchall: CatchallGenerationOptions;\n    effUsername: EffUsernameGenerationOptions;\n    subaddress: SubaddressGenerationOptions;\n  };\n  forwarders: {\n    addyIo: SelfHostedApiOptions & EmailDomainOptions & RequestOptions;\n    duckDuckGo: ApiOptions & RequestOptions;\n    fastmail: ApiOptions & EmailPrefixOptions & RequestOptions;\n    firefoxRelay: ApiOptions & RequestOptions;\n    forwardEmail: ApiOptions & EmailDomainOptions & RequestOptions;\n    simpleLogin: SelfHostedApiOptions & RequestOptions;\n  };\n};\n\nexport function legacyUsernameGenerationServiceFactory(\n  apiService: ApiService,\n  i18nService: I18nService,\n  cryptoService: CryptoService,\n  encryptService: EncryptService,\n  policyService: PolicyService,\n  accountService: AccountService,\n  stateProvider: StateProvider,\n): UsernameGenerationServiceAbstraction {\n  // FIXME: Once the username generation service is replaced with this service\n  // in the clients, factor out the deprecated service in its entirety.\n  const deprecatedService = new UsernameGenerationService(cryptoService, null, null);\n\n  const effUsername = new DefaultGeneratorService(\n    new EffUsernameGeneratorStrategy(deprecatedService, stateProvider),\n    policyService,\n  );\n\n  const subaddress = new DefaultGeneratorService(\n    new SubaddressGeneratorStrategy(deprecatedService, stateProvider),\n    policyService,\n  );\n\n  const catchall = new DefaultGeneratorService(\n    new CatchallGeneratorStrategy(deprecatedService, stateProvider),\n    policyService,\n  );\n\n  const addyIo = new DefaultGeneratorService(\n    new AddyIoForwarder(apiService, i18nService, encryptService, cryptoService, stateProvider),\n    policyService,\n  );\n\n  const duckDuckGo = new DefaultGeneratorService(\n    new DuckDuckGoForwarder(apiService, i18nService, encryptService, cryptoService, stateProvider),\n    policyService,\n  );\n\n  const fastmail = new DefaultGeneratorService(\n    new FastmailForwarder(apiService, i18nService, encryptService, cryptoService, stateProvider),\n    policyService,\n  );\n\n  const firefoxRelay = new DefaultGeneratorService(\n    new FirefoxRelayForwarder(\n      apiService,\n      i18nService,\n      encryptService,\n      cryptoService,\n      stateProvider,\n    ),\n    policyService,\n  );\n\n  const forwardEmail = new DefaultGeneratorService(\n    new ForwardEmailForwarder(\n      apiService,\n      i18nService,\n      encryptService,\n      cryptoService,\n      stateProvider,\n    ),\n    policyService,\n  );\n\n  const simpleLogin = new DefaultGeneratorService(\n    new SimpleLoginForwarder(apiService, i18nService, encryptService, cryptoService, stateProvider),\n    policyService,\n  );\n\n  const navigation = new DefaultGeneratorNavigationService(stateProvider, policyService);\n\n  return new LegacyUsernameGenerationService(\n    accountService,\n    navigation,\n    catchall,\n    effUsername,\n    subaddress,\n    addyIo,\n    duckDuckGo,\n    fastmail,\n    firefoxRelay,\n    forwardEmail,\n    simpleLogin,\n  );\n}\n\n/** Adapts the generator 2.0 design to 1.0 angular services. */\nexport class LegacyUsernameGenerationService implements UsernameGenerationServiceAbstraction {\n  constructor(\n    private readonly accountService: AccountService,\n    private readonly navigation: GeneratorNavigationService,\n    private readonly catchall: GeneratorService<CatchallGenerationOptions, NoPolicy>,\n    private readonly effUsername: GeneratorService<EffUsernameGenerationOptions, NoPolicy>,\n    private readonly subaddress: GeneratorService<SubaddressGenerationOptions, NoPolicy>,\n    private readonly addyIo: GeneratorService<SelfHostedApiOptions & EmailDomainOptions, NoPolicy>,\n    private readonly duckDuckGo: GeneratorService<ApiOptions, NoPolicy>,\n    private readonly fastmail: GeneratorService<ApiOptions & EmailPrefixOptions, NoPolicy>,\n    private readonly firefoxRelay: GeneratorService<ApiOptions, NoPolicy>,\n    private readonly forwardEmail: GeneratorService<ApiOptions & EmailDomainOptions, NoPolicy>,\n    private readonly simpleLogin: GeneratorService<SelfHostedApiOptions, NoPolicy>,\n  ) {}\n\n  generateUsername(options: UsernameGeneratorOptions) {\n    if (options.type === \"catchall\") {\n      return this.generateCatchall(options);\n    } else if (options.type === \"subaddress\") {\n      return this.generateSubaddress(options);\n    } else if (options.type === \"forwarded\") {\n      return this.generateForwarded(options);\n    } else {\n      return this.generateWord(options);\n    }\n  }\n\n  generateWord(options: UsernameGeneratorOptions) {\n    return this.effUsername.generate(options);\n  }\n\n  generateSubaddress(options: UsernameGeneratorOptions) {\n    return this.subaddress.generate(options);\n  }\n\n  generateCatchall(options: UsernameGeneratorOptions) {\n    return this.catchall.generate(options);\n  }\n\n  generateForwarded(options: UsernameGeneratorOptions) {\n    if (!options.forwardedService) {\n      return null;\n    }\n\n    const stored = this.toStoredOptions(options);\n    switch (options.forwardedService) {\n      case Forwarders.AddyIo.id:\n        return this.addyIo.generate(stored.forwarders.addyIo);\n      case Forwarders.DuckDuckGo.id:\n        return this.duckDuckGo.generate(stored.forwarders.duckDuckGo);\n      case Forwarders.Fastmail.id:\n        return this.fastmail.generate(stored.forwarders.fastmail);\n      case Forwarders.FirefoxRelay.id:\n        return this.firefoxRelay.generate(stored.forwarders.firefoxRelay);\n      case Forwarders.ForwardEmail.id:\n        return this.forwardEmail.generate(stored.forwarders.forwardEmail);\n      case Forwarders.SimpleLogin.id:\n        return this.simpleLogin.generate(stored.forwarders.simpleLogin);\n    }\n  }\n\n  getOptions$() {\n    // look upon my works, ye mighty, and despair!\n    const options$ = this.accountService.activeAccount$.pipe(\n      concatMap((account) =>\n        combineLatest([\n          this.navigation.options$(account.id),\n          this.navigation.defaults$(account.id),\n          this.catchall.options$(account.id),\n          this.catchall.defaults$(account.id),\n          this.effUsername.options$(account.id),\n          this.effUsername.defaults$(account.id),\n          this.subaddress.options$(account.id),\n          this.subaddress.defaults$(account.id),\n          this.addyIo.options$(account.id),\n          this.addyIo.defaults$(account.id),\n          this.duckDuckGo.options$(account.id),\n          this.duckDuckGo.defaults$(account.id),\n          this.fastmail.options$(account.id),\n          this.fastmail.defaults$(account.id),\n          this.firefoxRelay.options$(account.id),\n          this.firefoxRelay.defaults$(account.id),\n          this.forwardEmail.options$(account.id),\n          this.forwardEmail.defaults$(account.id),\n          this.simpleLogin.options$(account.id),\n          this.simpleLogin.defaults$(account.id),\n        ]),\n      ),\n      map(\n        ([\n          generatorOptions,\n          generatorDefaults,\n          catchallOptions,\n          catchallDefaults,\n          effUsernameOptions,\n          effUsernameDefaults,\n          subaddressOptions,\n          subaddressDefaults,\n          addyIoOptions,\n          addyIoDefaults,\n          duckDuckGoOptions,\n          duckDuckGoDefaults,\n          fastmailOptions,\n          fastmailDefaults,\n          firefoxRelayOptions,\n          firefoxRelayDefaults,\n          forwardEmailOptions,\n          forwardEmailDefaults,\n          simpleLoginOptions,\n          simpleLoginDefaults,\n        ]) =>\n          this.toUsernameOptions({\n            generator: generatorOptions ?? generatorDefaults,\n            algorithms: {\n              catchall: catchallOptions ?? catchallDefaults,\n              effUsername: effUsernameOptions ?? effUsernameDefaults,\n              subaddress: subaddressOptions ?? subaddressDefaults,\n            },\n            forwarders: {\n              addyIo: addyIoOptions ?? addyIoDefaults,\n              duckDuckGo: duckDuckGoOptions ?? duckDuckGoDefaults,\n              fastmail: fastmailOptions ?? fastmailDefaults,\n              firefoxRelay: firefoxRelayOptions ?? firefoxRelayDefaults,\n              forwardEmail: forwardEmailOptions ?? forwardEmailDefaults,\n              simpleLogin: simpleLoginOptions ?? simpleLoginDefaults,\n            },\n          }),\n      ),\n    );\n\n    return options$;\n  }\n\n  getOptions() {\n    return firstValueFrom(this.getOptions$());\n  }\n\n  async saveOptions(options: UsernameGeneratorOptions) {\n    const stored = this.toStoredOptions(options);\n    const activeAccount = await firstValueFrom(this.accountService.activeAccount$);\n\n    // generator settings needs to preserve whether password or passphrase is selected,\n    // so `navigationOptions` is mutated.\n    const navigationOptions$ = zip(\n      this.navigation.options$(activeAccount.id),\n      this.navigation.defaults$(activeAccount.id),\n    ).pipe(map(([options, defaults]) => options ?? defaults));\n    let navigationOptions = await firstValueFrom(navigationOptions$);\n    navigationOptions = Object.assign(navigationOptions, stored.generator);\n    await this.navigation.saveOptions(activeAccount.id, navigationOptions);\n\n    // overwrite all other settings with latest values\n    await Promise.all([\n      this.catchall.saveOptions(activeAccount.id, stored.algorithms.catchall),\n      this.effUsername.saveOptions(activeAccount.id, stored.algorithms.effUsername),\n      this.subaddress.saveOptions(activeAccount.id, stored.algorithms.subaddress),\n      this.addyIo.saveOptions(activeAccount.id, stored.forwarders.addyIo),\n      this.duckDuckGo.saveOptions(activeAccount.id, stored.forwarders.duckDuckGo),\n      this.fastmail.saveOptions(activeAccount.id, stored.forwarders.fastmail),\n      this.firefoxRelay.saveOptions(activeAccount.id, stored.forwarders.firefoxRelay),\n      this.forwardEmail.saveOptions(activeAccount.id, stored.forwarders.forwardEmail),\n      this.simpleLogin.saveOptions(activeAccount.id, stored.forwarders.simpleLogin),\n    ]);\n  }\n\n  private toStoredOptions(options: UsernameGeneratorOptions) {\n    const forwarders = {\n      addyIo: {\n        baseUrl: options.forwardedAnonAddyBaseUrl,\n        token: options.forwardedAnonAddyApiToken,\n        domain: options.forwardedAnonAddyDomain,\n        website: options.website,\n      },\n      duckDuckGo: {\n        token: options.forwardedDuckDuckGoToken,\n        website: options.website,\n      },\n      fastmail: {\n        token: options.forwardedFastmailApiToken,\n        website: options.website,\n      },\n      firefoxRelay: {\n        token: options.forwardedFirefoxApiToken,\n        website: options.website,\n      },\n      forwardEmail: {\n        token: options.forwardedForwardEmailApiToken,\n        domain: options.forwardedForwardEmailDomain,\n        website: options.website,\n      },\n      simpleLogin: {\n        token: options.forwardedSimpleLoginApiKey,\n        baseUrl: options.forwardedSimpleLoginBaseUrl,\n        website: options.website,\n      },\n    };\n\n    const generator = {\n      username: options.type,\n      forwarder: options.forwardedService,\n    };\n\n    const algorithms = {\n      effUsername: {\n        wordCapitalize: options.wordCapitalize,\n        wordIncludeNumber: options.wordIncludeNumber,\n        website: options.website,\n      },\n      subaddress: {\n        subaddressType: options.subaddressType,\n        subaddressEmail: options.subaddressEmail,\n        website: options.website,\n      },\n      catchall: {\n        catchallType: options.catchallType,\n        catchallDomain: options.catchallDomain,\n        website: options.website,\n      },\n    };\n\n    return { generator, algorithms, forwarders } as MappedOptions;\n  }\n\n  private toUsernameOptions(options: MappedOptions) {\n    return {\n      type: options.generator.username,\n      wordCapitalize: options.algorithms.effUsername.wordCapitalize,\n      wordIncludeNumber: options.algorithms.effUsername.wordIncludeNumber,\n      subaddressType: options.algorithms.subaddress.subaddressType,\n      subaddressEmail: options.algorithms.subaddress.subaddressEmail,\n      catchallType: options.algorithms.catchall.catchallType,\n      catchallDomain: options.algorithms.catchall.catchallDomain,\n      forwardedService: options.generator.forwarder,\n      forwardedAnonAddyApiToken: options.forwarders.addyIo.token,\n      forwardedAnonAddyDomain: options.forwarders.addyIo.domain,\n      forwardedAnonAddyBaseUrl: options.forwarders.addyIo.baseUrl,\n      forwardedDuckDuckGoToken: options.forwarders.duckDuckGo.token,\n      forwardedFirefoxApiToken: options.forwarders.firefoxRelay.token,\n      forwardedFastmailApiToken: options.forwarders.fastmail.token,\n      forwardedForwardEmailApiToken: options.forwarders.forwardEmail.token,\n      forwardedForwardEmailDomain: options.forwarders.forwardEmail.domain,\n      forwardedSimpleLoginApiKey: options.forwarders.simpleLogin.token,\n      forwardedSimpleLoginBaseUrl: options.forwarders.simpleLogin.baseUrl,\n    } as UsernameGeneratorOptions;\n  }\n}\n","export enum SendType {\n  Text = 0,\n  File = 1,\n}\n","import * as zxcvbn from \"zxcvbn\";\n\nimport { PasswordStrengthServiceAbstraction } from \"./password-strength.service.abstraction\";\n\nexport class PasswordStrengthService implements PasswordStrengthServiceAbstraction {\n  /**\n   * Calculates a password strength score using zxcvbn.\n   * @param password The password to calculate the strength of.\n   * @param emailInput An unparsed email address to use as user input.\n   * @param userInputs An array of additional user inputs to use when calculating the strength.\n   */\n  getPasswordStrength(\n    password: string,\n    emailInput: string = null,\n    userInputs: string[] = null,\n  ): zxcvbn.ZXCVBNResult {\n    if (password == null || password.length === 0) {\n      return null;\n    }\n    const globalUserInputs = [\n      \"bitwarden\",\n      \"bit\",\n      \"warden\",\n      ...(userInputs ?? []),\n      ...this.emailToUserInputs(emailInput),\n    ];\n    // Use a hash set to get rid of any duplicate user inputs\n    const finalUserInputs = Array.from(new Set(globalUserInputs));\n    const result = zxcvbn(password, finalUserInputs);\n    return result;\n  }\n\n  /**\n   * Convert an email address into a list of user inputs for zxcvbn by\n   * taking the local part of the email address and splitting it into words.\n   * @param email\n   * @private\n   */\n  private emailToUserInputs(email: string): string[] {\n    if (email == null || email.length === 0) {\n      return [];\n    }\n    const atPosition = email.indexOf(\"@\");\n    if (atPosition < 0) {\n      return [];\n    }\n    return email\n      .substring(0, atPosition)\n      .trim()\n      .toLowerCase()\n      .split(/[^A-Za-z0-9]/);\n  }\n}\n","import { SendFileApi } from \"../api/send-file.api\";\n\nexport class SendFileData {\n  id: string;\n  fileName: string;\n  size: string;\n  sizeName: string;\n\n  constructor(data?: SendFileApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.id = data.id;\n    this.fileName = data.fileName;\n    this.size = data.size;\n    this.sizeName = data.sizeName;\n  }\n}\n","import { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendTextData {\n  text: string;\n  hidden: boolean;\n\n  constructor(data?: SendTextApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.text = data.text;\n    this.hidden = data.hidden;\n  }\n}\n","import { SendType } from \"../../enums/send-type\";\nimport { SendResponse } from \"../response/send.response\";\n\nimport { SendFileData } from \"./send-file.data\";\nimport { SendTextData } from \"./send-text.data\";\n\nexport class SendData {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: string;\n  notes: string;\n  file: SendFileData;\n  text: SendTextData;\n  key: string;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: string;\n  expirationDate: string;\n  deletionDate: string;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(response?: SendResponse) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.accessId = response.accessId;\n    this.type = response.type;\n    this.name = response.name;\n    this.notes = response.notes;\n    this.key = response.key;\n    this.maxAccessCount = response.maxAccessCount;\n    this.accessCount = response.accessCount;\n    this.revisionDate = response.revisionDate;\n    this.expirationDate = response.expirationDate;\n    this.deletionDate = response.deletionDate;\n    this.password = response.password;\n    this.disabled = response.disable;\n    this.hideEmail = response.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendTextData(response.text);\n        break;\n      case SendType.File:\n        this.file = new SendFileData(response.file);\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\nimport { Send } from \"../domain/send\";\n\nexport class SendRequest {\n  type: SendType;\n  fileLength?: number;\n  name: string;\n  notes: string;\n  key: string;\n  maxAccessCount?: number;\n  expirationDate: string;\n  deletionDate: string;\n  text: SendTextApi;\n  file: SendFileApi;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(send: Send, fileLength?: number) {\n    this.type = send.type;\n    this.fileLength = fileLength;\n    this.name = send.name ? send.name.encryptedString : null;\n    this.notes = send.notes ? send.notes.encryptedString : null;\n    this.maxAccessCount = send.maxAccessCount;\n    this.expirationDate = send.expirationDate != null ? send.expirationDate.toISOString() : null;\n    this.deletionDate = send.deletionDate != null ? send.deletionDate.toISOString() : null;\n    this.key = send.key != null ? send.key.encryptedString : null;\n    this.password = send.password;\n    this.disabled = send.disabled;\n    this.hideEmail = send.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendTextApi();\n        this.text.text = send.text.text != null ? send.text.text.encryptedString : null;\n        this.text.hidden = send.text.hidden;\n        break;\n      case SendType.File:\n        this.file = new SendFileApi();\n        this.file.fileName = send.file.fileName != null ? send.file.fileName.encryptedString : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendAccessResponse extends BaseResponse {\n  id: string;\n  type: SendType;\n  name: string;\n  file: SendFileApi;\n  text: SendTextApi;\n  expirationDate: Date;\n  creatorIdentifier: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n\n    const text = this.getResponseProperty(\"Text\");\n    if (text != null) {\n      this.text = new SendTextApi(text);\n    }\n\n    const file = this.getResponseProperty(\"File\");\n    if (file != null) {\n      this.file = new SendFileApi(file);\n    }\n\n    this.expirationDate = this.getResponseProperty(\"ExpirationDate\");\n    this.creatorIdentifier = this.getResponseProperty(\"CreatorIdentifier\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendFileDownloadDataResponse extends BaseResponse {\n  id: string = null;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { FileUploadType } from \"../../../../platform/enums\";\n\nimport { SendResponse } from \"./send.response\";\n\nexport class SendFileUploadDataResponse extends BaseResponse {\n  fileUploadType: FileUploadType;\n  sendResponse: SendResponse;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.fileUploadType = this.getResponseProperty(\"FileUploadType\");\n    const sendResponse = this.getResponseProperty(\"SendResponse\");\n    this.sendResponse = sendResponse == null ? null : new SendResponse(sendResponse);\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport {\n  FileUploadApiMethods,\n  FileUploadService,\n} from \"../../../platform/abstractions/file-upload/file-upload.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { SendType } from \"../enums/send-type\";\nimport { SendData } from \"../models/data/send.data\";\nimport { Send } from \"../models/domain/send\";\nimport { SendAccessRequest } from \"../models/request/send-access.request\";\nimport { SendRequest } from \"../models/request/send.request\";\nimport { SendAccessResponse } from \"../models/response/send-access.response\";\nimport { SendFileDownloadDataResponse } from \"../models/response/send-file-download-data.response\";\nimport { SendFileUploadDataResponse } from \"../models/response/send-file-upload-data.response\";\nimport { SendResponse } from \"../models/response/send.response\";\nimport { SendAccessView } from \"../models/view/send-access.view\";\n\nimport { SendApiService as SendApiServiceAbstraction } from \"./send-api.service.abstraction\";\nimport { InternalSendService } from \"./send.service.abstraction\";\n\nexport class SendApiService implements SendApiServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private fileUploadService: FileUploadService,\n    private sendService: InternalSendService,\n  ) {}\n\n  async getSend(id: string): Promise<SendResponse> {\n    const r = await this.apiService.send(\"GET\", \"/sends/\" + id, null, true, true);\n    return new SendResponse(r);\n  }\n\n  async postSendAccess(\n    id: string,\n    request: SendAccessRequest,\n    apiUrl?: string,\n  ): Promise<SendAccessResponse> {\n    const addSendIdHeader = (headers: Headers) => {\n      headers.set(\"Send-Id\", id);\n    };\n    const r = await this.apiService.send(\n      \"POST\",\n      \"/sends/access/\" + id,\n      request,\n      false,\n      true,\n      apiUrl,\n      addSendIdHeader,\n    );\n    return new SendAccessResponse(r);\n  }\n\n  async getSendFileDownloadData(\n    send: SendAccessView,\n    request: SendAccessRequest,\n    apiUrl?: string,\n  ): Promise<SendFileDownloadDataResponse> {\n    const addSendIdHeader = (headers: Headers) => {\n      headers.set(\"Send-Id\", send.id);\n    };\n    const r = await this.apiService.send(\n      \"POST\",\n      \"/sends/\" + send.id + \"/access/file/\" + send.file.id,\n      request,\n      false,\n      true,\n      apiUrl,\n      addSendIdHeader,\n    );\n    return new SendFileDownloadDataResponse(r);\n  }\n\n  async getSends(): Promise<ListResponse<SendResponse>> {\n    const r = await this.apiService.send(\"GET\", \"/sends\", null, true, true);\n    return new ListResponse(r, SendResponse);\n  }\n\n  async postSend(request: SendRequest): Promise<SendResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends\", request, true, true);\n    return new SendResponse(r);\n  }\n\n  async postFileTypeSend(request: SendRequest): Promise<SendFileUploadDataResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends/file/v2\", request, true, true);\n    return new SendFileUploadDataResponse(r);\n  }\n\n  async renewSendFileUploadUrl(\n    sendId: string,\n    fileId: string,\n  ): Promise<SendFileUploadDataResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/sends/\" + sendId + \"/file/\" + fileId,\n      null,\n      true,\n      true,\n    );\n    return new SendFileUploadDataResponse(r);\n  }\n\n  postSendFile(sendId: string, fileId: string, data: FormData): Promise<any> {\n    return this.apiService.send(\"POST\", \"/sends/\" + sendId + \"/file/\" + fileId, data, true, false);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postSendFileLegacy(data: FormData): Promise<SendResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends/file\", data, true, true);\n    return new SendResponse(r);\n  }\n\n  async putSend(id: string, request: SendRequest): Promise<SendResponse> {\n    const r = await this.apiService.send(\"PUT\", \"/sends/\" + id, request, true, true);\n    return new SendResponse(r);\n  }\n\n  async putSendRemovePassword(id: string): Promise<SendResponse> {\n    const r = await this.apiService.send(\n      \"PUT\",\n      \"/sends/\" + id + \"/remove-password\",\n      null,\n      true,\n      true,\n    );\n    return new SendResponse(r);\n  }\n\n  deleteSend(id: string): Promise<any> {\n    return this.apiService.send(\"DELETE\", \"/sends/\" + id, null, true, false);\n  }\n\n  async save(sendData: [Send, EncArrayBuffer]): Promise<any> {\n    const response = await this.upload(sendData);\n\n    const data = new SendData(response);\n    await this.sendService.upsert(data);\n  }\n\n  async delete(id: string): Promise<any> {\n    await this.deleteSend(id);\n    await this.sendService.delete(id);\n  }\n\n  async removePassword(id: string): Promise<any> {\n    const response = await this.putSendRemovePassword(id);\n    const data = new SendData(response);\n    await this.sendService.upsert(data);\n  }\n\n  // Send File Upload methods\n\n  private async upload(sendData: [Send, EncArrayBuffer]): Promise<SendResponse> {\n    const request = new SendRequest(sendData[0], sendData[1]?.buffer.byteLength);\n    let response: SendResponse;\n    if (sendData[0].id == null) {\n      if (sendData[0].type === SendType.Text) {\n        response = await this.postSend(request);\n      } else {\n        try {\n          const uploadDataResponse = await this.postFileTypeSend(request);\n          response = uploadDataResponse.sendResponse;\n          await this.fileUploadService.upload(\n            uploadDataResponse,\n            sendData[0].file.fileName,\n            sendData[1],\n            this.generateMethods(uploadDataResponse, response),\n          );\n        } catch (e) {\n          if (e instanceof ErrorResponse && (e as ErrorResponse).statusCode === 404) {\n            response = await this.legacyServerSendFileUpload(sendData, request);\n          } else if (e instanceof ErrorResponse) {\n            throw new Error((e as ErrorResponse).getSingleMessage());\n          } else {\n            throw e;\n          }\n        }\n      }\n      sendData[0].id = response.id;\n      sendData[0].accessId = response.accessId;\n    } else {\n      response = await this.putSend(sendData[0].id, request);\n    }\n    return response;\n  }\n\n  private generateMethods(\n    uploadData: SendFileUploadDataResponse,\n    response: SendResponse,\n  ): FileUploadApiMethods {\n    return {\n      postDirect: this.generatePostDirectCallback(response),\n      renewFileUploadUrl: this.generateRenewFileUploadUrlCallback(response.id, response.file.id),\n      rollback: this.generateRollbackCallback(response.id),\n    };\n  }\n\n  private generatePostDirectCallback(sendResponse: SendResponse) {\n    return (data: FormData) => {\n      return this.postSendFile(sendResponse.id, sendResponse.file.id, data);\n    };\n  }\n\n  private generateRenewFileUploadUrlCallback(sendId: string, fileId: string) {\n    return async () => {\n      const renewResponse = await this.renewSendFileUploadUrl(sendId, fileId);\n      return renewResponse?.url;\n    };\n  }\n\n  private generateRollbackCallback(sendId: string) {\n    return () => {\n      return this.deleteSend(sendId);\n    };\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async legacyServerSendFileUpload(\n    sendData: [Send, EncArrayBuffer],\n    request: SendRequest,\n  ): Promise<SendResponse> {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([sendData[1].buffer], { type: \"application/octet-stream\" });\n      fd.append(\"model\", JSON.stringify(request));\n      fd.append(\"data\", blob, sendData[0].file.fileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"model\", JSON.stringify(request));\n        fd.append(\n          \"data\",\n          Buffer.from(sendData[1].buffer) as any,\n          {\n            filepath: sendData[0].file.fileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n    return await this.postSendFileLegacy(fd);\n  }\n}\n","import { SEND_DISK, SEND_MEMORY, UserKeyDefinition } from \"../../../platform/state\";\nimport { SendData } from \"../models/data/send.data\";\nimport { SendView } from \"../models/view/send.view\";\n\n/** Encrypted send state stored on disk */\nexport const SEND_USER_ENCRYPTED = UserKeyDefinition.record<SendData>(\n  SEND_DISK,\n  \"sendUserEncrypted\",\n  {\n    deserializer: (obj: SendData) => obj,\n    clearOn: [\"logout\"],\n  },\n);\n\n/** Decrypted send state stored in memory */\nexport const SEND_USER_DECRYPTED = new UserKeyDefinition<SendView[]>(\n  SEND_MEMORY,\n  \"sendUserDecrypted\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"lock\"],\n  },\n);\n","import { Observable, firstValueFrom } from \"rxjs\";\n\nimport { ActiveUserState, StateProvider } from \"../../../platform/state\";\nimport { SendData } from \"../models/data/send.data\";\nimport { SendView } from \"../models/view/send.view\";\n\nimport { SEND_USER_DECRYPTED, SEND_USER_ENCRYPTED } from \"./key-definitions\";\nimport { SendStateProvider as SendStateProviderAbstraction } from \"./send-state.provider.abstraction\";\n\n/** State provider for sends */\nexport class SendStateProvider implements SendStateProviderAbstraction {\n  /** Observable for the encrypted sends for an active user */\n  encryptedState$: Observable<Record<string, SendData>>;\n  /** Observable with the decrypted sends for an active user */\n  decryptedState$: Observable<SendView[]>;\n\n  private activeUserEncryptedState: ActiveUserState<Record<string, SendData>>;\n  private activeUserDecryptedState: ActiveUserState<SendView[]>;\n\n  constructor(protected stateProvider: StateProvider) {\n    this.activeUserEncryptedState = this.stateProvider.getActive(SEND_USER_ENCRYPTED);\n    this.encryptedState$ = this.activeUserEncryptedState.state$;\n\n    this.activeUserDecryptedState = this.stateProvider.getActive(SEND_USER_DECRYPTED);\n    this.decryptedState$ = this.activeUserDecryptedState.state$;\n  }\n\n  /** Gets the encrypted sends from state for an active user */\n  async getEncryptedSends(): Promise<{ [id: string]: SendData }> {\n    return await firstValueFrom(this.encryptedState$);\n  }\n\n  /** Sets the encrypted send state for an active user */\n  async setEncryptedSends(value: { [id: string]: SendData }): Promise<void> {\n    await this.activeUserEncryptedState.update(() => value);\n  }\n\n  /** Gets the decrypted sends from state for the active user */\n  async getDecryptedSends(): Promise<SendView[]> {\n    return await firstValueFrom(this.decryptedState$);\n  }\n\n  /** Sets the decrypted send state for an active user */\n  async setDecryptedSends(value: SendView[]): Promise<void> {\n    await this.activeUserDecryptedState.update(() => value);\n  }\n}\n","import { View } from \"../../../../models/view/view\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendFile } from \"../domain/send-file\";\n\nexport class SendFileView implements View {\n  id: string = null;\n  size: string = null;\n  sizeName: string = null;\n  fileName: string = null;\n\n  constructor(f?: SendFile) {\n    if (!f) {\n      return;\n    }\n\n    this.id = f.id;\n    this.size = f.size;\n    this.sizeName = f.sizeName;\n  }\n\n  get fileSize(): number {\n    try {\n      if (this.size != null) {\n        return parseInt(this.size, null);\n      }\n    } catch {\n      // Invalid file size.\n    }\n    return 0;\n  }\n\n  static fromJSON(json: DeepJsonify<SendFileView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendFileView(), json);\n  }\n}\n","import { View } from \"../../../../models/view/view\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendText } from \"../domain/send-text\";\n\nexport class SendTextView implements View {\n  text: string = null;\n  hidden: boolean;\n\n  constructor(t?: SendText) {\n    if (!t) {\n      return;\n    }\n\n    this.hidden = t.hidden;\n  }\n\n  get maskedText(): string {\n    return this.text != null ? \"••••••••\" : null;\n  }\n\n  static fromJSON(json: DeepJsonify<SendTextView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendTextView(), json);\n  }\n}\n","import { View } from \"../../../../models/view/view\";\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendType } from \"../../enums/send-type\";\nimport { Send } from \"../domain/send\";\n\nimport { SendFileView } from \"./send-file.view\";\nimport { SendTextView } from \"./send-text.view\";\n\nexport class SendView implements View {\n  id: string = null;\n  accessId: string = null;\n  name: string = null;\n  notes: string = null;\n  key: Uint8Array;\n  cryptoKey: SymmetricCryptoKey;\n  type: SendType = null;\n  text = new SendTextView();\n  file = new SendFileView();\n  maxAccessCount?: number = null;\n  accessCount = 0;\n  revisionDate: Date = null;\n  deletionDate: Date = null;\n  expirationDate: Date = null;\n  password: string = null;\n  disabled = false;\n  hideEmail = false;\n\n  constructor(s?: Send) {\n    if (!s) {\n      return;\n    }\n\n    this.id = s.id;\n    this.accessId = s.accessId;\n    this.type = s.type;\n    this.maxAccessCount = s.maxAccessCount;\n    this.accessCount = s.accessCount;\n    this.revisionDate = s.revisionDate;\n    this.deletionDate = s.deletionDate;\n    this.expirationDate = s.expirationDate;\n    this.disabled = s.disabled;\n    this.password = s.password;\n    this.hideEmail = s.hideEmail;\n  }\n\n  get urlB64Key(): string {\n    return Utils.fromBufferToUrlB64(this.key);\n  }\n\n  get maxAccessCountReached(): boolean {\n    if (this.maxAccessCount == null) {\n      return false;\n    }\n    return this.accessCount >= this.maxAccessCount;\n  }\n\n  get expired(): boolean {\n    if (this.expirationDate == null) {\n      return false;\n    }\n    return this.expirationDate <= new Date();\n  }\n\n  get pendingDelete(): boolean {\n    return this.deletionDate <= new Date();\n  }\n\n  toJSON() {\n    return Utils.merge(\n      { ...this },\n      {\n        key: Utils.fromBufferToB64(this.key),\n      },\n    );\n  }\n\n  static fromJSON(json: DeepJsonify<SendView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendView(), json, {\n      key: Utils.fromB64ToArray(json.key),\n      cryptoKey: SymmetricCryptoKey.fromJSON(json.cryptoKey),\n      text: SendTextView.fromJSON(json.text),\n      file: SendFileView.fromJSON(json.file),\n      revisionDate: json.revisionDate == null ? null : new Date(json.revisionDate),\n      deletionDate: json.deletionDate == null ? null : new Date(json.deletionDate),\n      expirationDate: json.expirationDate == null ? null : new Date(json.expirationDate),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { SendFileData } from \"../data/send-file.data\";\nimport { SendFileView } from \"../view/send-file.view\";\n\nexport class SendFile extends Domain {\n  id: string;\n  size: string;\n  sizeName: string;\n  fileName: EncString;\n\n  constructor(obj?: SendFileData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.size = obj.size;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        sizeName: null,\n        fileName: null,\n      },\n      [\"id\", \"sizeName\"],\n    );\n  }\n\n  async decrypt(key: SymmetricCryptoKey): Promise<SendFileView> {\n    const view = await this.decryptObj(\n      new SendFileView(this),\n      {\n        fileName: null,\n      },\n      null,\n      key,\n    );\n    return view;\n  }\n\n  static fromJSON(obj: Jsonify<SendFile>) {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SendFile(), obj, {\n      fileName: EncString.fromJSON(obj.fileName),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { SendTextData } from \"../data/send-text.data\";\nimport { SendTextView } from \"../view/send-text.view\";\n\nexport class SendText extends Domain {\n  text: EncString;\n  hidden: boolean;\n\n  constructor(obj?: SendTextData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.hidden = obj.hidden;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        text: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(key: SymmetricCryptoKey): Promise<SendTextView> {\n    return this.decryptObj(\n      new SendTextView(this),\n      {\n        text: null,\n      },\n      null,\n      key,\n    );\n  }\n\n  static fromJSON(obj: Jsonify<SendText>) {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SendText(), obj, {\n      text: EncString.fromJSON(obj.text),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendData } from \"../data/send.data\";\nimport { SendView } from \"../view/send.view\";\n\nimport { SendFile } from \"./send-file\";\nimport { SendText } from \"./send-text\";\n\nexport class Send extends Domain {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: EncString;\n  notes: EncString;\n  file: SendFile;\n  text: SendText;\n  key: EncString;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: Date;\n  expirationDate: Date;\n  deletionDate: Date;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(obj?: SendData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        accessId: null,\n        name: null,\n        notes: null,\n        key: null,\n      },\n      [\"id\", \"accessId\"],\n    );\n\n    this.type = obj.type;\n    this.maxAccessCount = obj.maxAccessCount;\n    this.accessCount = obj.accessCount;\n    this.password = obj.password;\n    this.disabled = obj.disabled;\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n    this.deletionDate = obj.deletionDate != null ? new Date(obj.deletionDate) : null;\n    this.expirationDate = obj.expirationDate != null ? new Date(obj.expirationDate) : null;\n    this.hideEmail = obj.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendText(obj.text);\n        break;\n      case SendType.File:\n        this.file = new SendFile(obj.file);\n        break;\n      default:\n        break;\n    }\n  }\n\n  async decrypt(): Promise<SendView> {\n    const model = new SendView(this);\n\n    const cryptoService = Utils.getContainerService().getCryptoService();\n\n    try {\n      model.key = await cryptoService.decryptToBytes(this.key, null);\n      model.cryptoKey = await cryptoService.makeSendKey(model.key);\n    } catch (e) {\n      // TODO: error?\n    }\n\n    await this.decryptObj(\n      model,\n      {\n        name: null,\n        notes: null,\n      },\n      null,\n      model.cryptoKey,\n    );\n\n    switch (this.type) {\n      case SendType.File:\n        model.file = await this.file.decrypt(model.cryptoKey);\n        break;\n      case SendType.Text:\n        model.text = await this.text.decrypt(model.cryptoKey);\n        break;\n      default:\n        break;\n    }\n\n    return model;\n  }\n\n  static fromJSON(obj: Jsonify<Send>) {\n    if (obj == null) {\n      return null;\n    }\n\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const expirationDate = obj.expirationDate == null ? null : new Date(obj.expirationDate);\n    const deletionDate = obj.deletionDate == null ? null : new Date(obj.deletionDate);\n\n    return Object.assign(new Send(), obj, {\n      key: EncString.fromJSON(obj.key),\n      name: EncString.fromJSON(obj.name),\n      notes: EncString.fromJSON(obj.notes),\n      text: SendText.fromJSON(obj.text),\n      file: SendFile.fromJSON(obj.file),\n      revisionDate,\n      expirationDate,\n      deletionDate,\n    });\n  }\n}\n","import { Send } from \"../domain/send\";\n\nimport { SendRequest } from \"./send.request\";\n\nexport class SendWithIdRequest extends SendRequest {\n  id: string;\n\n  constructor(send: Send) {\n    super(send);\n    this.id = send.id;\n  }\n}\n","import { Observable, concatMap, distinctUntilChanged, firstValueFrom, map } from \"rxjs\";\n\nimport { PBKDF2KdfConfig } from \"../../../auth/models/domain/kdf-config\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { KeyGenerationService } from \"../../../platform/abstractions/key-generation.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { UserKey } from \"../../../types/key\";\nimport { SendType } from \"../enums/send-type\";\nimport { SendData } from \"../models/data/send.data\";\nimport { Send } from \"../models/domain/send\";\nimport { SendFile } from \"../models/domain/send-file\";\nimport { SendText } from \"../models/domain/send-text\";\nimport { SendWithIdRequest } from \"../models/request/send-with-id.request\";\nimport { SendView } from \"../models/view/send.view\";\nimport { SEND_KDF_ITERATIONS } from \"../send-kdf\";\n\nimport { SendStateProvider } from \"./send-state.provider.abstraction\";\nimport { InternalSendService as InternalSendServiceAbstraction } from \"./send.service.abstraction\";\n\nexport class SendService implements InternalSendServiceAbstraction {\n  readonly sendKeySalt = \"bitwarden-send\";\n  readonly sendKeyPurpose = \"send\";\n\n  sends$ = this.stateProvider.encryptedState$.pipe(\n    map((record) => Object.values(record || {}).map((data) => new Send(data))),\n  );\n  sendViews$ = this.stateProvider.encryptedState$.pipe(\n    concatMap((record) =>\n      this.decryptSends(Object.values(record || {}).map((data) => new Send(data))),\n    ),\n  );\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    private keyGenerationService: KeyGenerationService,\n    private stateProvider: SendStateProvider,\n    private encryptService: EncryptService,\n  ) {}\n\n  async encrypt(\n    model: SendView,\n    file: File | ArrayBuffer,\n    password: string,\n    key?: SymmetricCryptoKey,\n  ): Promise<[Send, EncArrayBuffer]> {\n    let fileData: EncArrayBuffer = null;\n    const send = new Send();\n    send.id = model.id;\n    send.type = model.type;\n    send.disabled = model.disabled;\n    send.hideEmail = model.hideEmail;\n    send.maxAccessCount = model.maxAccessCount;\n    if (model.key == null) {\n      const key = await this.keyGenerationService.createKeyWithPurpose(\n        128,\n        this.sendKeyPurpose,\n        this.sendKeySalt,\n      );\n      model.key = key.material;\n      model.cryptoKey = key.derivedKey;\n    }\n    if (password != null) {\n      const passwordKey = await this.keyGenerationService.deriveKeyFromPassword(\n        password,\n        model.key,\n        new PBKDF2KdfConfig(SEND_KDF_ITERATIONS),\n      );\n      send.password = passwordKey.keyB64;\n    }\n    if (key == null) {\n      key = await this.cryptoService.getUserKey();\n    }\n    send.key = await this.encryptService.encrypt(model.key, key);\n    send.name = await this.encryptService.encrypt(model.name, model.cryptoKey);\n    send.notes = await this.encryptService.encrypt(model.notes, model.cryptoKey);\n    if (send.type === SendType.Text) {\n      send.text = new SendText();\n      send.text.text = await this.encryptService.encrypt(model.text.text, model.cryptoKey);\n      send.text.hidden = model.text.hidden;\n    } else if (send.type === SendType.File) {\n      send.file = new SendFile();\n      if (file != null) {\n        if (file instanceof ArrayBuffer) {\n          const [name, data] = await this.encryptFileData(\n            model.file.fileName,\n            file,\n            model.cryptoKey,\n          );\n          send.file.fileName = name;\n          fileData = data;\n        } else {\n          fileData = await this.parseFile(send, file, model.cryptoKey);\n        }\n      }\n    }\n\n    return [send, fileData];\n  }\n\n  get$(id: string): Observable<Send | undefined> {\n    return this.sends$.pipe(\n      distinctUntilChanged((oldSends, newSends) => {\n        const oldSend = oldSends.find((oldSend) => oldSend.id === id);\n        const newSend = newSends.find((newSend) => newSend.id === id);\n        if (!oldSend || !newSend) {\n          // If either oldSend or newSend is not found, consider them different\n          return false;\n        }\n\n        // Compare each property of the old and new Send objects\n        const allPropertiesSame = Object.keys(newSend).every((key) => {\n          if (\n            (oldSend[key as keyof Send] != null && newSend[key as keyof Send] === null) ||\n            (oldSend[key as keyof Send] === null && newSend[key as keyof Send] != null)\n          ) {\n            // If a key from either old or new send is not found, and the key from the other send has a value, consider them different\n            return false;\n          }\n\n          switch (key) {\n            case \"name\":\n            case \"notes\":\n            case \"key\":\n              if (oldSend[key] === null && newSend[key] === null) {\n                return true;\n              }\n\n              return oldSend[key].encryptedString === newSend[key].encryptedString;\n            case \"text\":\n              if (oldSend[key].text == null && newSend[key].text == null) {\n                return true;\n              }\n              if (\n                (oldSend[key].text != null && newSend[key].text == null) ||\n                (oldSend[key].text == null && newSend[key].text != null)\n              ) {\n                return false;\n              }\n              return oldSend[key].text.encryptedString === newSend[key].text.encryptedString;\n            case \"file\":\n              //Files are never updated so never will be changed.\n              return true;\n            case \"revisionDate\":\n            case \"expirationDate\":\n            case \"deletionDate\":\n              if (oldSend[key] === null && newSend[key] === null) {\n                return true;\n              }\n              return oldSend[key].getTime() === newSend[key].getTime();\n            default:\n              // For other properties, compare directly\n              return oldSend[key as keyof Send] === newSend[key as keyof Send];\n          }\n        });\n\n        return allPropertiesSame;\n      }),\n      map((sends) => sends.find((o) => o.id === id)),\n    );\n  }\n\n  async getFromState(id: string): Promise<Send> {\n    const sends = await this.stateProvider.getEncryptedSends();\n    // eslint-disable-next-line\n    if (sends == null || !sends.hasOwnProperty(id)) {\n      return null;\n    }\n\n    return new Send(sends[id]);\n  }\n\n  async getAll(): Promise<Send[]> {\n    const sends = await this.stateProvider.getEncryptedSends();\n    const response: Send[] = [];\n    for (const id in sends) {\n      // eslint-disable-next-line\n      if (sends.hasOwnProperty(id)) {\n        response.push(new Send(sends[id]));\n      }\n    }\n    return response;\n  }\n\n  async getAllDecryptedFromState(): Promise<SendView[]> {\n    let decSends = await this.stateProvider.getDecryptedSends();\n    if (decSends != null) {\n      return decSends;\n    }\n\n    decSends = [];\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      throw new Error(\"No user key found.\");\n    }\n\n    const promises: Promise<any>[] = [];\n    const sends = await this.getAll();\n    sends.forEach((send) => {\n      promises.push(send.decrypt().then((f) => decSends.push(f)));\n    });\n\n    await Promise.all(promises);\n    decSends.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n\n    await this.stateProvider.setDecryptedSends(decSends);\n    return decSends;\n  }\n\n  async upsert(send: SendData | SendData[]): Promise<any> {\n    let sends = await this.stateProvider.getEncryptedSends();\n    if (sends == null) {\n      sends = {};\n    }\n    if (send instanceof SendData) {\n      const s = send as SendData;\n      sends[s.id] = s;\n    } else {\n      (send as SendData[]).forEach((s) => {\n        sends[s.id] = s;\n      });\n    }\n\n    await this.replace(sends);\n  }\n\n  async clear(userId?: string): Promise<any> {\n    await this.stateProvider.setDecryptedSends(null);\n    await this.stateProvider.setEncryptedSends(null);\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    const sends = await this.stateProvider.getEncryptedSends();\n    if (sends == null) {\n      return;\n    }\n\n    if (typeof id === \"string\") {\n      if (sends[id] == null) {\n        return;\n      }\n      delete sends[id];\n    } else {\n      (id as string[]).forEach((i) => {\n        delete sends[i];\n      });\n    }\n\n    await this.replace(sends);\n  }\n\n  async replace(sends: { [id: string]: SendData }): Promise<any> {\n    await this.stateProvider.setEncryptedSends(sends);\n  }\n\n  async getRotatedKeys(newUserKey: UserKey): Promise<SendWithIdRequest[]> {\n    if (newUserKey == null) {\n      throw new Error(\"New user key is required for rotation.\");\n    }\n\n    const originalUserKey = await this.cryptoService.getUserKey();\n\n    const req = await firstValueFrom(\n      this.sends$.pipe(\n        concatMap(async (sends) => this.toRotatedKeyRequestMap(sends, originalUserKey, newUserKey)),\n      ),\n    );\n    // separate return for easier debugging\n    return req;\n  }\n\n  private async toRotatedKeyRequestMap(\n    sends: Send[],\n    originalUserKey: UserKey,\n    rotateUserKey: UserKey,\n  ) {\n    const requests = await Promise.all(\n      sends.map(async (send) => {\n        const sendKey = await this.encryptService.decryptToBytes(send.key, originalUserKey);\n        send.key = await this.encryptService.encrypt(sendKey, rotateUserKey);\n        return new SendWithIdRequest(send);\n      }),\n    );\n    return requests;\n  }\n\n  private parseFile(send: Send, file: File, key: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n      reader.onload = async (evt) => {\n        try {\n          const [name, data] = await this.encryptFileData(\n            file.name,\n            evt.target.result as ArrayBuffer,\n            key,\n          );\n          send.file.fileName = name;\n          resolve(data);\n        } catch (e) {\n          reject(e);\n        }\n      };\n      reader.onerror = () => {\n        reject(\"Error reading file.\");\n      };\n    });\n  }\n\n  private async encryptFileData(\n    fileName: string,\n    data: ArrayBuffer,\n    key: SymmetricCryptoKey,\n  ): Promise<[EncString, EncArrayBuffer]> {\n    if (key == null) {\n      key = await this.cryptoService.getUserKey();\n    }\n    const encFileName = await this.encryptService.encrypt(fileName, key);\n    const encFileData = await this.encryptService.encryptToBytes(new Uint8Array(data), key);\n    return [encFileName, encFileData];\n  }\n\n  private async decryptSends(sends: Send[]) {\n    const decryptSendPromises = sends.map((s) => s.decrypt());\n    const decryptedSends = await Promise.all(decryptSendPromises);\n\n    decryptedSends.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n    return decryptedSends;\n  }\n}\n","export const SEND_KDF_ITERATIONS = 100000;\n","import { CipherView } from \"../view/cipher.view\";\n\nconst CacheTTL = 3000;\n\nexport class SortedCiphersCache {\n  private readonly sortedCiphersByUrl: Map<string, Ciphers> = new Map<string, Ciphers>();\n  private readonly timeouts: Map<string, any> = new Map<string, any>();\n\n  constructor(private readonly comparator: (a: CipherView, b: CipherView) => number) {}\n\n  isCached(url: string) {\n    return this.sortedCiphersByUrl.has(url);\n  }\n\n  addCiphers(url: string, ciphers: CipherView[]) {\n    ciphers.sort(this.comparator);\n    this.sortedCiphersByUrl.set(url, new Ciphers(ciphers));\n    this.resetTimer(url);\n  }\n\n  getLastUsed(url: string) {\n    this.resetTimer(url);\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getLastUsed() : null;\n  }\n\n  getLastLaunched(url: string) {\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getLastLaunched() : null;\n  }\n\n  getNext(url: string) {\n    this.resetTimer(url);\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getNext() : null;\n  }\n\n  updateLastUsedIndex(url: string) {\n    if (this.isCached(url)) {\n      this.sortedCiphersByUrl.get(url).updateLastUsedIndex();\n    }\n  }\n\n  clear() {\n    this.sortedCiphersByUrl.clear();\n    this.timeouts.clear();\n  }\n\n  private resetTimer(url: string) {\n    clearTimeout(this.timeouts.get(url));\n    this.timeouts.set(\n      url,\n      setTimeout(() => {\n        this.sortedCiphersByUrl.delete(url);\n        this.timeouts.delete(url);\n      }, CacheTTL),\n    );\n  }\n}\n\nclass Ciphers {\n  lastUsedIndex = -1;\n\n  constructor(private readonly ciphers: CipherView[]) {}\n\n  getLastUsed() {\n    this.lastUsedIndex = Math.max(this.lastUsedIndex, 0);\n    return this.ciphers[this.lastUsedIndex];\n  }\n\n  getLastLaunched() {\n    const usedCiphers = this.ciphers.filter((cipher) => cipher.localData?.lastLaunched);\n    const sortedCiphers = usedCiphers.sort(\n      (x, y) => y.localData.lastLaunched.valueOf() - x.localData.lastLaunched.valueOf(),\n    );\n    return sortedCiphers[0];\n  }\n\n  getNextIndex() {\n    return (this.lastUsedIndex + 1) % this.ciphers.length;\n  }\n\n  getNext() {\n    return this.ciphers[this.getNextIndex()];\n  }\n\n  updateLastUsedIndex() {\n    this.lastUsedIndex = this.getNextIndex();\n  }\n}\n","export class CipherBulkDeleteRequest {\n  ids: string[];\n  organizationId: string;\n\n  constructor(ids: string[], organizationId?: string) {\n    this.ids = ids == null ? [] : ids;\n    this.organizationId = organizationId;\n  }\n}\n","export class CipherBulkMoveRequest {\n  ids: string[];\n  folderId: string;\n\n  constructor(ids: string[], folderId: string) {\n    this.ids = ids == null ? [] : ids;\n    this.folderId = folderId;\n  }\n}\n","export class CipherBulkRestoreRequest {\n  ids: string[];\n  organizationId: string;\n\n  constructor(ids: string[], organizationId?: string) {\n    this.ids = ids == null ? [] : ids;\n    this.organizationId = organizationId;\n  }\n}\n","export class AttachmentRequest {\n  fileName: string;\n  key: string;\n  fileSize: number;\n  adminRequest: boolean;\n}\n","import { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CardApi } from \"../api/card.api\";\nimport { Fido2CredentialApi } from \"../api/fido2-credential.api\";\nimport { FieldApi } from \"../api/field.api\";\nimport { IdentityApi } from \"../api/identity.api\";\nimport { LoginUriApi } from \"../api/login-uri.api\";\nimport { LoginApi } from \"../api/login.api\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\nimport { Cipher } from \"../domain/cipher\";\n\nimport { AttachmentRequest } from \"./attachment.request\";\nimport { PasswordHistoryRequest } from \"./password-history.request\";\n\nexport class CipherRequest {\n  type: CipherType;\n  folderId: string;\n  organizationId: string;\n  name: string;\n  notes: string;\n  favorite: boolean;\n  login: LoginApi;\n  secureNote: SecureNoteApi;\n  card: CardApi;\n  identity: IdentityApi;\n  fields: FieldApi[];\n  passwordHistory: PasswordHistoryRequest[];\n  // Deprecated, remove at some point and rename attachments2 to attachments\n  attachments: { [id: string]: string };\n  attachments2: { [id: string]: AttachmentRequest };\n  lastKnownRevisionDate: Date;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(cipher: Cipher) {\n    this.type = cipher.type;\n    this.folderId = cipher.folderId;\n    this.organizationId = cipher.organizationId;\n    this.name = cipher.name ? cipher.name.encryptedString : null;\n    this.notes = cipher.notes ? cipher.notes.encryptedString : null;\n    this.favorite = cipher.favorite;\n    this.lastKnownRevisionDate = cipher.revisionDate;\n    this.reprompt = cipher.reprompt;\n    this.key = cipher.key?.encryptedString;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new LoginApi();\n        this.login.uris =\n          cipher.login.uris?.map((u) => {\n            const uri = new LoginUriApi();\n            uri.uri = u.uri != null ? u.uri.encryptedString : null;\n            uri.match = u.match != null ? u.match : null;\n            uri.uriChecksum = u.uriChecksum != null ? u.uriChecksum.encryptedString : null;\n            return uri;\n          }) ?? [];\n        this.login.username = cipher.login.username ? cipher.login.username.encryptedString : null;\n        this.login.password = cipher.login.password ? cipher.login.password.encryptedString : null;\n        this.login.passwordRevisionDate =\n          cipher.login.passwordRevisionDate != null\n            ? cipher.login.passwordRevisionDate.toISOString()\n            : null;\n        this.login.totp = cipher.login.totp ? cipher.login.totp.encryptedString : null;\n        this.login.autofillOnPageLoad = cipher.login.autofillOnPageLoad;\n\n        if (cipher.login.fido2Credentials != null) {\n          this.login.fido2Credentials = cipher.login.fido2Credentials.map((key) => {\n            const keyApi = new Fido2CredentialApi();\n            keyApi.credentialId =\n              key.credentialId != null ? key.credentialId.encryptedString : null;\n            keyApi.keyType =\n              key.keyType != null ? (key.keyType.encryptedString as \"public-key\") : null;\n            keyApi.keyAlgorithm =\n              key.keyAlgorithm != null ? (key.keyAlgorithm.encryptedString as \"ECDSA\") : null;\n            keyApi.keyCurve =\n              key.keyCurve != null ? (key.keyCurve.encryptedString as \"P-256\") : null;\n            keyApi.keyValue = key.keyValue != null ? key.keyValue.encryptedString : null;\n            keyApi.rpId = key.rpId != null ? key.rpId.encryptedString : null;\n            keyApi.rpName = key.rpName != null ? key.rpName.encryptedString : null;\n            keyApi.counter = key.counter != null ? key.counter.encryptedString : null;\n            keyApi.userHandle = key.userHandle != null ? key.userHandle.encryptedString : null;\n            keyApi.userName = key.userName != null ? key.userName.encryptedString : null;\n            keyApi.userDisplayName =\n              key.userDisplayName != null ? key.userDisplayName.encryptedString : null;\n            keyApi.discoverable =\n              key.discoverable != null ? key.discoverable.encryptedString : null;\n            keyApi.creationDate = key.creationDate != null ? key.creationDate.toISOString() : null;\n            return keyApi;\n          });\n        }\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteApi();\n        this.secureNote.type = cipher.secureNote.type;\n        break;\n      case CipherType.Card:\n        this.card = new CardApi();\n        this.card.cardholderName =\n          cipher.card.cardholderName != null ? cipher.card.cardholderName.encryptedString : null;\n        this.card.brand = cipher.card.brand != null ? cipher.card.brand.encryptedString : null;\n        this.card.number = cipher.card.number != null ? cipher.card.number.encryptedString : null;\n        this.card.expMonth =\n          cipher.card.expMonth != null ? cipher.card.expMonth.encryptedString : null;\n        this.card.expYear =\n          cipher.card.expYear != null ? cipher.card.expYear.encryptedString : null;\n        this.card.code = cipher.card.code != null ? cipher.card.code.encryptedString : null;\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityApi();\n        this.identity.title =\n          cipher.identity.title != null ? cipher.identity.title.encryptedString : null;\n        this.identity.firstName =\n          cipher.identity.firstName != null ? cipher.identity.firstName.encryptedString : null;\n        this.identity.middleName =\n          cipher.identity.middleName != null ? cipher.identity.middleName.encryptedString : null;\n        this.identity.lastName =\n          cipher.identity.lastName != null ? cipher.identity.lastName.encryptedString : null;\n        this.identity.address1 =\n          cipher.identity.address1 != null ? cipher.identity.address1.encryptedString : null;\n        this.identity.address2 =\n          cipher.identity.address2 != null ? cipher.identity.address2.encryptedString : null;\n        this.identity.address3 =\n          cipher.identity.address3 != null ? cipher.identity.address3.encryptedString : null;\n        this.identity.city =\n          cipher.identity.city != null ? cipher.identity.city.encryptedString : null;\n        this.identity.state =\n          cipher.identity.state != null ? cipher.identity.state.encryptedString : null;\n        this.identity.postalCode =\n          cipher.identity.postalCode != null ? cipher.identity.postalCode.encryptedString : null;\n        this.identity.country =\n          cipher.identity.country != null ? cipher.identity.country.encryptedString : null;\n        this.identity.company =\n          cipher.identity.company != null ? cipher.identity.company.encryptedString : null;\n        this.identity.email =\n          cipher.identity.email != null ? cipher.identity.email.encryptedString : null;\n        this.identity.phone =\n          cipher.identity.phone != null ? cipher.identity.phone.encryptedString : null;\n        this.identity.ssn =\n          cipher.identity.ssn != null ? cipher.identity.ssn.encryptedString : null;\n        this.identity.username =\n          cipher.identity.username != null ? cipher.identity.username.encryptedString : null;\n        this.identity.passportNumber =\n          cipher.identity.passportNumber != null\n            ? cipher.identity.passportNumber.encryptedString\n            : null;\n        this.identity.licenseNumber =\n          cipher.identity.licenseNumber != null\n            ? cipher.identity.licenseNumber.encryptedString\n            : null;\n        break;\n      default:\n        break;\n    }\n\n    if (cipher.fields != null) {\n      this.fields = cipher.fields.map((f) => {\n        const field = new FieldApi();\n        field.type = f.type;\n        field.name = f.name ? f.name.encryptedString : null;\n        field.value = f.value ? f.value.encryptedString : null;\n        field.linkedId = f.linkedId;\n        return field;\n      });\n    }\n\n    if (cipher.passwordHistory != null) {\n      this.passwordHistory = [];\n      cipher.passwordHistory.forEach((ph) => {\n        this.passwordHistory.push({\n          lastUsedDate: ph.lastUsedDate,\n          password: ph.password ? ph.password.encryptedString : null,\n        });\n      });\n    }\n\n    if (cipher.attachments != null) {\n      this.attachments = {};\n      this.attachments2 = {};\n      cipher.attachments.forEach((attachment) => {\n        const fileName = attachment.fileName ? attachment.fileName.encryptedString : null;\n        this.attachments[attachment.id] = fileName;\n        const attachmentRequest = new AttachmentRequest();\n        attachmentRequest.fileName = fileName;\n        if (attachment.key != null) {\n          attachmentRequest.key = attachment.key.encryptedString;\n        }\n        this.attachments2[attachment.id] = attachmentRequest;\n      });\n    }\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherWithIdRequest extends CipherRequest {\n  id: string;\n\n  constructor(cipher: Cipher) {\n    super(cipher);\n    this.id = cipher.id;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherWithIdRequest } from \"./cipher-with-id.request\";\n\nexport class CipherBulkShareRequest {\n  ciphers: CipherWithIdRequest[];\n  collectionIds: string[];\n\n  constructor(ciphers: Cipher[], collectionIds: string[]) {\n    if (ciphers != null) {\n      this.ciphers = [];\n      ciphers.forEach((c) => {\n        this.ciphers.push(new CipherWithIdRequest(c));\n      });\n    }\n    this.collectionIds = collectionIds;\n  }\n}\n","import { CipherId, CollectionId, OrganizationId } from \"../../../types/guid\";\n\nexport class CipherBulkUpdateCollectionsRequest {\n  organizationId: OrganizationId;\n  cipherIds: CipherId[];\n  collectionIds: CollectionId[];\n  removeCollections: boolean;\n  constructor(\n    organizationId: OrganizationId,\n    cipherIds: CipherId[],\n    collectionIds: CollectionId[],\n    removeCollections: boolean = false,\n  ) {\n    this.organizationId = organizationId;\n    this.cipherIds = cipherIds;\n    this.collectionIds = collectionIds;\n    this.removeCollections = removeCollections;\n  }\n}\n","export class CipherCollectionsRequest {\n  collectionIds: string[];\n\n  constructor(collectionIds: string[]) {\n    this.collectionIds = collectionIds == null ? [] : collectionIds;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherCreateRequest {\n  cipher: CipherRequest;\n  collectionIds: string[];\n\n  constructor(cipher: Cipher) {\n    this.cipher = new CipherRequest(cipher);\n    this.collectionIds = cipher.collectionIds;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nexport class CipherPartialRequest {\n  folderId: string;\n  favorite: boolean;\n\n  constructor(cipher: Cipher) {\n    this.folderId = cipher.folderId;\n    this.favorite = cipher.favorite;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherShareRequest {\n  cipher: CipherRequest;\n  collectionIds: string[];\n\n  constructor(cipher: Cipher) {\n    this.cipher = new CipherRequest(cipher);\n    this.collectionIds = cipher.collectionIds;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport {\n  CIPHERS_DISK,\n  CIPHERS_DISK_LOCAL,\n  CIPHERS_MEMORY,\n  UserKeyDefinition,\n} from \"../../../platform/state\";\nimport { CipherId } from \"../../../types/guid\";\nimport { CipherData } from \"../../models/data/cipher.data\";\nimport { LocalData } from \"../../models/data/local.data\";\nimport { CipherView } from \"../../models/view/cipher.view\";\nimport { AddEditCipherInfo } from \"../../types/add-edit-cipher-info\";\n\nexport const ENCRYPTED_CIPHERS = UserKeyDefinition.record<CipherData>(CIPHERS_DISK, \"ciphers\", {\n  deserializer: (obj: Jsonify<CipherData>) => CipherData.fromJSON(obj),\n  clearOn: [\"logout\"],\n});\n\nexport const DECRYPTED_CIPHERS = UserKeyDefinition.record<CipherView>(\n  CIPHERS_MEMORY,\n  \"decryptedCiphers\",\n  {\n    deserializer: (cipher: Jsonify<CipherView>) => CipherView.fromJSON(cipher),\n    clearOn: [\"logout\", \"lock\"],\n  },\n);\n\nexport const LOCAL_DATA_KEY = new UserKeyDefinition<Record<CipherId, LocalData>>(\n  CIPHERS_DISK_LOCAL,\n  \"localData\",\n  {\n    deserializer: (localData) => localData,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const ADD_EDIT_CIPHER_INFO_KEY = new UserKeyDefinition<AddEditCipherInfo>(\n  CIPHERS_MEMORY,\n  \"addEditCipherInfo\",\n  {\n    deserializer: (addEditCipherInfo: AddEditCipherInfo) => {\n      if (addEditCipherInfo == null) {\n        return null;\n      }\n\n      const cipher =\n        addEditCipherInfo?.cipher.toJSON != null\n          ? addEditCipherInfo.cipher\n          : CipherView.fromJSON(addEditCipherInfo?.cipher as Jsonify<CipherView>);\n\n      return { cipher, collectionIds: addEditCipherInfo.collectionIds };\n    },\n    clearOn: [\"logout\", \"lock\"],\n  },\n);\n","import { firstValueFrom, map, Observable, share, skipWhile, switchMap } from \"rxjs\";\nimport { SemVer } from \"semver\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { SearchService } from \"../../abstractions/search.service\";\nimport { AutofillSettingsServiceAbstraction } from \"../../autofill/services/autofill-settings.service\";\nimport { DomainSettingsService } from \"../../autofill/services/domain-settings.service\";\nimport { UriMatchStrategySetting } from \"../../models/domain/domain-service\";\nimport { ErrorResponse } from \"../../models/response/error.response\";\nimport { ListResponse } from \"../../models/response/list.response\";\nimport { View } from \"../../models/view/view\";\nimport { ConfigService } from \"../../platform/abstractions/config/config.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { flagEnabled } from \"../../platform/misc/flags\";\nimport { sequentialize } from \"../../platform/misc/sequentialize\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport Domain from \"../../platform/models/domain/domain-base\";\nimport { EncArrayBuffer } from \"../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport {\n  ActiveUserState,\n  CIPHERS_MEMORY,\n  DeriveDefinition,\n  DerivedState,\n  StateProvider,\n} from \"../../platform/state\";\nimport { CipherId, CollectionId, OrganizationId, UserId } from \"../../types/guid\";\nimport { OrgKey, UserKey } from \"../../types/key\";\nimport { CipherService as CipherServiceAbstraction } from \"../abstractions/cipher.service\";\nimport { CipherFileUploadService } from \"../abstractions/file-upload/cipher-file-upload.service\";\nimport { FieldType } from \"../enums\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherData } from \"../models/data/cipher.data\";\nimport { LocalData } from \"../models/data/local.data\";\nimport { Attachment } from \"../models/domain/attachment\";\nimport { Card } from \"../models/domain/card\";\nimport { Cipher } from \"../models/domain/cipher\";\nimport { Fido2Credential } from \"../models/domain/fido2-credential\";\nimport { Field } from \"../models/domain/field\";\nimport { Identity } from \"../models/domain/identity\";\nimport { Login } from \"../models/domain/login\";\nimport { LoginUri } from \"../models/domain/login-uri\";\nimport { Password } from \"../models/domain/password\";\nimport { SecureNote } from \"../models/domain/secure-note\";\nimport { SortedCiphersCache } from \"../models/domain/sorted-ciphers-cache\";\nimport { CipherBulkDeleteRequest } from \"../models/request/cipher-bulk-delete.request\";\nimport { CipherBulkMoveRequest } from \"../models/request/cipher-bulk-move.request\";\nimport { CipherBulkRestoreRequest } from \"../models/request/cipher-bulk-restore.request\";\nimport { CipherBulkShareRequest } from \"../models/request/cipher-bulk-share.request\";\nimport { CipherBulkUpdateCollectionsRequest } from \"../models/request/cipher-bulk-update-collections.request\";\nimport { CipherCollectionsRequest } from \"../models/request/cipher-collections.request\";\nimport { CipherCreateRequest } from \"../models/request/cipher-create.request\";\nimport { CipherPartialRequest } from \"../models/request/cipher-partial.request\";\nimport { CipherShareRequest } from \"../models/request/cipher-share.request\";\nimport { CipherRequest } from \"../models/request/cipher.request\";\nimport { CipherResponse } from \"../models/response/cipher.response\";\nimport { AttachmentView } from \"../models/view/attachment.view\";\nimport { CipherView } from \"../models/view/cipher.view\";\nimport { FieldView } from \"../models/view/field.view\";\nimport { PasswordHistoryView } from \"../models/view/password-history.view\";\nimport { AddEditCipherInfo } from \"../types/add-edit-cipher-info\";\n\nimport {\n  ADD_EDIT_CIPHER_INFO_KEY,\n  DECRYPTED_CIPHERS,\n  ENCRYPTED_CIPHERS,\n  LOCAL_DATA_KEY,\n} from \"./key-state/ciphers.state\";\n\nconst CIPHER_KEY_ENC_MIN_SERVER_VER = new SemVer(\"2024.2.0\");\n\nexport class CipherService implements CipherServiceAbstraction {\n  private sortedCiphersCache: SortedCiphersCache = new SortedCiphersCache(\n    this.sortCiphersByLastUsed,\n  );\n  private ciphersExpectingUpdate: DerivedState<boolean>;\n\n  localData$: Observable<Record<CipherId, LocalData>>;\n  ciphers$: Observable<Record<CipherId, CipherData>>;\n  cipherViews$: Observable<Record<CipherId, CipherView>>;\n  viewFor$(id: CipherId) {\n    return this.cipherViews$.pipe(map((views) => views[id]));\n  }\n  addEditCipherInfo$: Observable<AddEditCipherInfo>;\n\n  private localDataState: ActiveUserState<Record<CipherId, LocalData>>;\n  private encryptedCiphersState: ActiveUserState<Record<CipherId, CipherData>>;\n  private decryptedCiphersState: ActiveUserState<Record<CipherId, CipherView>>;\n  private addEditCipherInfoState: ActiveUserState<AddEditCipherInfo>;\n\n  constructor(\n    private cryptoService: CryptoService,\n    private domainSettingsService: DomainSettingsService,\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    private searchService: SearchService,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private encryptService: EncryptService,\n    private cipherFileUploadService: CipherFileUploadService,\n    private configService: ConfigService,\n    private stateProvider: StateProvider,\n  ) {\n    this.localDataState = this.stateProvider.getActive(LOCAL_DATA_KEY);\n    this.encryptedCiphersState = this.stateProvider.getActive(ENCRYPTED_CIPHERS);\n    this.decryptedCiphersState = this.stateProvider.getActive(DECRYPTED_CIPHERS);\n    this.addEditCipherInfoState = this.stateProvider.getActive(ADD_EDIT_CIPHER_INFO_KEY);\n    this.ciphersExpectingUpdate = this.stateProvider.getDerived(\n      this.encryptedCiphersState.state$,\n      new DeriveDefinition(CIPHERS_MEMORY, \"ciphersExpectingUpdate\", {\n        derive: (_: Record<CipherId, CipherData>) => false,\n        deserializer: (value) => value,\n      }),\n      {},\n    );\n\n    this.localData$ = this.localDataState.state$.pipe(map((data) => data ?? {}));\n    // First wait for ciphersExpectingUpdate to be false before emitting ciphers\n    this.ciphers$ = this.ciphersExpectingUpdate.state$.pipe(\n      skipWhile((expectingUpdate) => expectingUpdate),\n      switchMap(() => this.encryptedCiphersState.state$),\n      map((ciphers) => ciphers ?? {}),\n    );\n    this.cipherViews$ = this.decryptedCiphersState.state$.pipe(\n      map((views) => views ?? {}),\n\n      share({\n        resetOnRefCountZero: true,\n      }),\n    );\n    this.addEditCipherInfo$ = this.addEditCipherInfoState.state$;\n  }\n\n  async setDecryptedCipherCache(value: CipherView[], userId: UserId) {\n    // Sometimes we might prematurely decrypt the vault and that will result in no ciphers\n    // if we cache it then we may accidentally return it when it's not right, we'd rather try decryption again.\n    // We still want to set null though, that is the indicator that the cache isn't valid and we should do decryption.\n    if (value == null || value.length !== 0) {\n      await this.setDecryptedCiphers(value, userId);\n    }\n    if (this.searchService != null) {\n      if (value == null) {\n        await this.searchService.clearIndex();\n      } else {\n        await this.searchService.indexCiphers(value);\n      }\n    }\n  }\n\n  private async setDecryptedCiphers(value: CipherView[], userId: UserId) {\n    const cipherViews: { [id: string]: CipherView } = {};\n    value?.forEach((c) => {\n      cipherViews[c.id] = c;\n    });\n    await this.stateProvider.setUserState(DECRYPTED_CIPHERS, cipherViews, userId);\n  }\n\n  async clearCache(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    await this.clearDecryptedCiphersState(userId);\n  }\n\n  async encrypt(\n    model: CipherView,\n    keyForEncryption?: SymmetricCryptoKey,\n    keyForCipherKeyDecryption?: SymmetricCryptoKey,\n    originalCipher: Cipher = null,\n  ): Promise<Cipher> {\n    if (model.id != null) {\n      if (originalCipher == null) {\n        originalCipher = await this.get(model.id);\n      }\n      if (originalCipher != null) {\n        await this.updateModelfromExistingCipher(model, originalCipher);\n      }\n      this.adjustPasswordHistoryLength(model);\n    }\n\n    const cipher = new Cipher();\n    cipher.id = model.id;\n    cipher.folderId = model.folderId;\n    cipher.favorite = model.favorite;\n    cipher.organizationId = model.organizationId;\n    cipher.type = model.type;\n    cipher.collectionIds = model.collectionIds;\n    cipher.revisionDate = model.revisionDate;\n    cipher.reprompt = model.reprompt;\n    cipher.edit = model.edit;\n\n    if (await this.getCipherKeyEncryptionEnabled()) {\n      cipher.key = originalCipher?.key ?? null;\n      const userOrOrgKey = await this.getKeyForCipherKeyDecryption(cipher);\n      // The keyForEncryption is only used for encrypting the cipher key, not the cipher itself, since cipher key encryption is enabled.\n      // If the caller has provided a key for cipher key encryption, use it. Otherwise, use the user or org key.\n      keyForEncryption ||= userOrOrgKey;\n      // If the caller has provided a key for cipher key decryption, use it. Otherwise, use the user or org key.\n      keyForCipherKeyDecryption ||= userOrOrgKey;\n      return this.encryptCipherWithCipherKey(\n        model,\n        cipher,\n        keyForEncryption,\n        keyForCipherKeyDecryption,\n      );\n    } else {\n      if (keyForEncryption == null && cipher.organizationId != null) {\n        keyForEncryption = await this.cryptoService.getOrgKey(cipher.organizationId);\n        if (keyForEncryption == null) {\n          throw new Error(\"Cannot encrypt cipher for organization. No key.\");\n        }\n      }\n      // We want to ensure that the cipher key is null if cipher key encryption is disabled\n      // so that decryption uses the proper key.\n      cipher.key = null;\n      return this.encryptCipher(model, cipher, keyForEncryption);\n    }\n  }\n\n  async encryptAttachments(\n    attachmentsModel: AttachmentView[],\n    key: SymmetricCryptoKey,\n  ): Promise<Attachment[]> {\n    if (attachmentsModel == null || attachmentsModel.length === 0) {\n      return null;\n    }\n\n    const promises: Promise<any>[] = [];\n    const encAttachments: Attachment[] = [];\n    attachmentsModel.forEach(async (model) => {\n      const attachment = new Attachment();\n      attachment.id = model.id;\n      attachment.size = model.size;\n      attachment.sizeName = model.sizeName;\n      attachment.url = model.url;\n      const promise = this.encryptObjProperty(\n        model,\n        attachment,\n        {\n          fileName: null,\n        },\n        key,\n      ).then(async () => {\n        if (model.key != null) {\n          attachment.key = await this.cryptoService.encrypt(model.key.key, key);\n        }\n        encAttachments.push(attachment);\n      });\n      promises.push(promise);\n    });\n\n    await Promise.all(promises);\n    return encAttachments;\n  }\n\n  async encryptFields(fieldsModel: FieldView[], key: SymmetricCryptoKey): Promise<Field[]> {\n    if (!fieldsModel || !fieldsModel.length) {\n      return null;\n    }\n\n    const self = this;\n    const encFields: Field[] = [];\n    await fieldsModel.reduce(async (promise, field) => {\n      await promise;\n      const encField = await self.encryptField(field, key);\n      encFields.push(encField);\n    }, Promise.resolve());\n\n    return encFields;\n  }\n\n  async encryptField(fieldModel: FieldView, key: SymmetricCryptoKey): Promise<Field> {\n    const field = new Field();\n    field.type = fieldModel.type;\n    field.linkedId = fieldModel.linkedId;\n    // normalize boolean type field values\n    if (fieldModel.type === FieldType.Boolean && fieldModel.value !== \"true\") {\n      fieldModel.value = \"false\";\n    }\n\n    await this.encryptObjProperty(\n      fieldModel,\n      field,\n      {\n        name: null,\n        value: null,\n      },\n      key,\n    );\n\n    return field;\n  }\n\n  async encryptPasswordHistories(\n    phModels: PasswordHistoryView[],\n    key: SymmetricCryptoKey,\n  ): Promise<Password[]> {\n    if (!phModels || !phModels.length) {\n      return null;\n    }\n\n    const self = this;\n    const encPhs: Password[] = [];\n    await phModels.reduce(async (promise, ph) => {\n      await promise;\n      const encPh = await self.encryptPasswordHistory(ph, key);\n      encPhs.push(encPh);\n    }, Promise.resolve());\n\n    return encPhs;\n  }\n\n  async encryptPasswordHistory(\n    phModel: PasswordHistoryView,\n    key: SymmetricCryptoKey,\n  ): Promise<Password> {\n    const ph = new Password();\n    ph.lastUsedDate = phModel.lastUsedDate;\n\n    await this.encryptObjProperty(\n      phModel,\n      ph,\n      {\n        password: null,\n      },\n      key,\n    );\n\n    return ph;\n  }\n\n  async get(id: string): Promise<Cipher> {\n    const ciphers = await firstValueFrom(this.ciphers$);\n    // eslint-disable-next-line\n    if (ciphers == null || !ciphers.hasOwnProperty(id)) {\n      return null;\n    }\n\n    const localData = await firstValueFrom(this.localData$);\n    const cipherId = id as CipherId;\n\n    return new Cipher(ciphers[cipherId], localData ? localData[cipherId] : null);\n  }\n\n  async getAll(): Promise<Cipher[]> {\n    const localData = await firstValueFrom(this.localData$);\n    const ciphers = await firstValueFrom(this.ciphers$);\n    const response: Cipher[] = [];\n    for (const id in ciphers) {\n      // eslint-disable-next-line\n      if (ciphers.hasOwnProperty(id)) {\n        const cipherId = id as CipherId;\n        response.push(new Cipher(ciphers[cipherId], localData ? localData[cipherId] : null));\n      }\n    }\n    return response;\n  }\n\n  @sequentialize(() => \"getAllDecrypted\")\n  async getAllDecrypted(): Promise<CipherView[]> {\n    let decCiphers = await this.getDecryptedCiphers();\n    if (decCiphers != null && decCiphers.length !== 0) {\n      await this.reindexCiphers();\n      return await this.getDecryptedCiphers();\n    }\n\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (activeUserId == null) {\n      return [];\n    }\n\n    decCiphers = await this.decryptCiphers(await this.getAll(), activeUserId);\n\n    await this.setDecryptedCipherCache(decCiphers, activeUserId);\n    return decCiphers;\n  }\n\n  private async getDecryptedCiphers() {\n    return Object.values(await firstValueFrom(this.cipherViews$));\n  }\n\n  private async decryptCiphers(ciphers: Cipher[], userId: UserId) {\n    const keys = await firstValueFrom(this.cryptoService.cipherDecryptionKeys$(userId, true));\n\n    if (keys == null || (keys.userKey == null && Object.keys(keys.orgKeys).length === 0)) {\n      // return early if there are no keys to decrypt with\n      return;\n    }\n\n    // Group ciphers by orgId or under 'null' for the user's ciphers\n    const grouped = ciphers.reduce(\n      (agg, c) => {\n        agg[c.organizationId] ??= [];\n        agg[c.organizationId].push(c);\n        return agg;\n      },\n      {} as Record<string, Cipher[]>,\n    );\n\n    const decCiphers = (\n      await Promise.all(\n        Object.entries(grouped).map(([orgId, groupedCiphers]) =>\n          this.encryptService.decryptItems(\n            groupedCiphers,\n            keys.orgKeys[orgId as OrganizationId] ?? keys.userKey,\n          ),\n        ),\n      )\n    )\n      .flat()\n      .sort(this.getLocaleSortingFunction());\n\n    return decCiphers;\n  }\n\n  private async reindexCiphers() {\n    const userId = await this.stateService.getUserId();\n    const reindexRequired =\n      this.searchService != null &&\n      ((await firstValueFrom(this.searchService.indexedEntityId$)) ?? userId) !== userId;\n    if (reindexRequired) {\n      await this.searchService.indexCiphers(await this.getDecryptedCiphers(), userId);\n    }\n  }\n\n  async getAllDecryptedForGrouping(groupingId: string, folder = true): Promise<CipherView[]> {\n    const ciphers = await this.getAllDecrypted();\n\n    return ciphers.filter((cipher) => {\n      if (cipher.isDeleted) {\n        return false;\n      }\n      if (folder && cipher.folderId === groupingId) {\n        return true;\n      } else if (\n        !folder &&\n        cipher.collectionIds != null &&\n        cipher.collectionIds.indexOf(groupingId) > -1\n      ) {\n        return true;\n      }\n\n      return false;\n    });\n  }\n\n  async getAllDecryptedForUrl(\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch: UriMatchStrategySetting = null,\n  ): Promise<CipherView[]> {\n    const ciphers = await this.getAllDecrypted();\n    return await this.filterCiphersForUrl(ciphers, url, includeOtherTypes, defaultMatch);\n  }\n\n  async filterCiphersForUrl(\n    ciphers: CipherView[],\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch: UriMatchStrategySetting = null,\n  ): Promise<CipherView[]> {\n    if (url == null && includeOtherTypes == null) {\n      return [];\n    }\n\n    const equivalentDomains = await firstValueFrom(\n      this.domainSettingsService.getUrlEquivalentDomains(url),\n    );\n    defaultMatch ??= await firstValueFrom(this.domainSettingsService.defaultUriMatchStrategy$);\n\n    return ciphers.filter((cipher) => {\n      const cipherIsLogin = cipher.type === CipherType.Login && cipher.login !== null;\n\n      if (cipher.deletedDate !== null) {\n        return false;\n      }\n\n      if (\n        Array.isArray(includeOtherTypes) &&\n        includeOtherTypes.includes(cipher.type) &&\n        !cipherIsLogin\n      ) {\n        return true;\n      }\n\n      if (cipherIsLogin) {\n        return cipher.login.matchesUri(url, equivalentDomains, defaultMatch);\n      }\n\n      return false;\n    });\n  }\n\n  async getAllFromApiForOrganization(organizationId: string): Promise<CipherView[]> {\n    const response = await this.apiService.getCiphersOrganization(organizationId);\n    return await this.decryptOrganizationCiphersResponse(response, organizationId);\n  }\n\n  async getManyFromApiForOrganization(organizationId: string): Promise<CipherView[]> {\n    const response = await this.apiService.send(\n      \"GET\",\n      \"/ciphers/organization-details/assigned?organizationId=\" + organizationId,\n      null,\n      true,\n      true,\n    );\n    return this.decryptOrganizationCiphersResponse(response, organizationId);\n  }\n\n  private async decryptOrganizationCiphersResponse(\n    response: ListResponse<CipherResponse>,\n    organizationId: string,\n  ): Promise<CipherView[]> {\n    if (response?.data == null || response.data.length < 1) {\n      return [];\n    }\n\n    const ciphers = response.data.map((cr) => new Cipher(new CipherData(cr)));\n    const key = await this.cryptoService.getOrgKey(organizationId);\n    const decCiphers = await this.encryptService.decryptItems(ciphers, key);\n\n    decCiphers.sort(this.getLocaleSortingFunction());\n    return decCiphers;\n  }\n\n  async getLastUsedForUrl(url: string, autofillOnPageLoad = false): Promise<CipherView> {\n    return this.getCipherForUrl(url, true, false, autofillOnPageLoad);\n  }\n\n  async getLastLaunchedForUrl(url: string, autofillOnPageLoad = false): Promise<CipherView> {\n    return this.getCipherForUrl(url, false, true, autofillOnPageLoad);\n  }\n\n  async getNextCipherForUrl(url: string): Promise<CipherView> {\n    return this.getCipherForUrl(url, false, false, false);\n  }\n\n  updateLastUsedIndexForUrl(url: string) {\n    this.sortedCiphersCache.updateLastUsedIndex(url);\n  }\n\n  async updateLastUsedDate(id: string): Promise<void> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    let ciphersLocalData = await firstValueFrom(this.localData$);\n\n    if (!ciphersLocalData) {\n      ciphersLocalData = {};\n    }\n\n    const cipherId = id as CipherId;\n    if (ciphersLocalData[cipherId]) {\n      ciphersLocalData[cipherId].lastUsedDate = new Date().getTime();\n    } else {\n      ciphersLocalData[cipherId] = {\n        lastUsedDate: new Date().getTime(),\n      };\n    }\n\n    await this.localDataState.update(() => ciphersLocalData);\n\n    const decryptedCipherCache = await this.getDecryptedCiphers();\n    if (!decryptedCipherCache) {\n      return;\n    }\n\n    for (let i = 0; i < decryptedCipherCache.length; i++) {\n      const cached = decryptedCipherCache[i];\n      if (cached.id === id) {\n        cached.localData = ciphersLocalData[id as CipherId];\n        break;\n      }\n    }\n    await this.setDecryptedCiphers(decryptedCipherCache, userId);\n  }\n\n  async updateLastLaunchedDate(id: string): Promise<void> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    let ciphersLocalData = await firstValueFrom(this.localData$);\n\n    if (!ciphersLocalData) {\n      ciphersLocalData = {};\n    }\n\n    const cipherId = id as CipherId;\n    if (ciphersLocalData[cipherId]) {\n      ciphersLocalData[cipherId].lastLaunched = new Date().getTime();\n    } else {\n      ciphersLocalData[cipherId] = {\n        lastUsedDate: new Date().getTime(),\n      };\n    }\n\n    await this.localDataState.update(() => ciphersLocalData);\n\n    const decryptedCipherCache = await this.getDecryptedCiphers();\n    if (!decryptedCipherCache) {\n      return;\n    }\n\n    for (let i = 0; i < decryptedCipherCache.length; i++) {\n      const cached = decryptedCipherCache[i];\n      if (cached.id === id) {\n        cached.localData = ciphersLocalData[id as CipherId];\n        break;\n      }\n    }\n    await this.setDecryptedCiphers(decryptedCipherCache, userId);\n  }\n\n  async saveNeverDomain(domain: string): Promise<void> {\n    if (domain == null) {\n      return;\n    }\n\n    let domains = await firstValueFrom(this.domainSettingsService.neverDomains$);\n    if (!domains) {\n      domains = {};\n    }\n    domains[domain] = null;\n    await this.domainSettingsService.setNeverDomains(domains);\n  }\n\n  async createWithServer(cipher: Cipher, orgAdmin?: boolean): Promise<Cipher> {\n    let response: CipherResponse;\n    if (orgAdmin && cipher.organizationId != null) {\n      const request = new CipherCreateRequest(cipher);\n      response = await this.apiService.postCipherAdmin(request);\n    } else if (cipher.collectionIds != null) {\n      const request = new CipherCreateRequest(cipher);\n      response = await this.apiService.postCipherCreate(request);\n    } else {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.postCipher(request);\n    }\n    cipher.id = response.id;\n\n    const data = new CipherData(response, cipher.collectionIds);\n    const updated = await this.upsert(data);\n    // No local data for new ciphers\n    return new Cipher(updated[cipher.id as CipherId]);\n  }\n\n  async updateWithServer(\n    cipher: Cipher,\n    orgAdmin?: boolean,\n    isNotClone?: boolean,\n  ): Promise<Cipher> {\n    let response: CipherResponse;\n    if (orgAdmin && isNotClone) {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.putCipherAdmin(cipher.id, request);\n    } else if (cipher.edit) {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.putCipher(cipher.id, request);\n    } else {\n      const request = new CipherPartialRequest(cipher);\n      response = await this.apiService.putPartialCipher(cipher.id, request);\n    }\n\n    const data = new CipherData(response, cipher.collectionIds);\n    const updated = await this.upsert(data);\n    // updating with server does not change local data\n    return new Cipher(updated[cipher.id as CipherId], cipher.localData);\n  }\n\n  async shareWithServer(\n    cipher: CipherView,\n    organizationId: string,\n    collectionIds: string[],\n  ): Promise<any> {\n    const attachmentPromises: Promise<any>[] = [];\n    if (cipher.attachments != null) {\n      cipher.attachments.forEach((attachment) => {\n        if (attachment.key == null) {\n          attachmentPromises.push(\n            this.shareAttachmentWithServer(attachment, cipher.id, organizationId),\n          );\n        }\n      });\n    }\n    await Promise.all(attachmentPromises);\n\n    cipher.organizationId = organizationId;\n    cipher.collectionIds = collectionIds;\n    const encCipher = await this.encryptSharedCipher(cipher);\n    const request = new CipherShareRequest(encCipher);\n    const response = await this.apiService.putShareCipher(cipher.id, request);\n    const data = new CipherData(response, collectionIds);\n    await this.upsert(data);\n  }\n\n  async shareManyWithServer(\n    ciphers: CipherView[],\n    organizationId: string,\n    collectionIds: string[],\n  ): Promise<any> {\n    const promises: Promise<any>[] = [];\n    const encCiphers: Cipher[] = [];\n    for (const cipher of ciphers) {\n      cipher.organizationId = organizationId;\n      cipher.collectionIds = collectionIds;\n      promises.push(\n        this.encryptSharedCipher(cipher).then((c) => {\n          encCiphers.push(c);\n        }),\n      );\n    }\n    await Promise.all(promises);\n    const request = new CipherBulkShareRequest(encCiphers, collectionIds);\n    try {\n      await this.apiService.putShareCiphers(request);\n    } catch (e) {\n      for (const cipher of ciphers) {\n        cipher.organizationId = null;\n        cipher.collectionIds = null;\n      }\n      throw e;\n    }\n    await this.upsert(encCiphers.map((c) => c.toCipherData()));\n  }\n\n  saveAttachmentWithServer(cipher: Cipher, unencryptedFile: any, admin = false): Promise<Cipher> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(unencryptedFile);\n      reader.onload = async (evt: any) => {\n        try {\n          const cData = await this.saveAttachmentRawWithServer(\n            cipher,\n            unencryptedFile.name,\n            evt.target.result,\n            admin,\n          );\n          resolve(cData);\n        } catch (e) {\n          reject(e);\n        }\n      };\n      reader.onerror = () => {\n        reject(\"Error reading file.\");\n      };\n    });\n  }\n\n  async saveAttachmentRawWithServer(\n    cipher: Cipher,\n    filename: string,\n    data: Uint8Array,\n    admin = false,\n  ): Promise<Cipher> {\n    const encKey = await this.getKeyForCipherKeyDecryption(cipher);\n    const cipherKeyEncryptionEnabled = await this.getCipherKeyEncryptionEnabled();\n\n    const cipherEncKey =\n      cipherKeyEncryptionEnabled && cipher.key != null\n        ? (new SymmetricCryptoKey(\n            await this.encryptService.decryptToBytes(cipher.key, encKey),\n          ) as UserKey)\n        : encKey;\n\n    //if cipher key encryption is disabled but the item has an individual key,\n    //then we rollback to using the user key as the main key of encryption of the item\n    //in order to keep item and it's attachments with the same encryption level\n    if (cipher.key != null && !cipherKeyEncryptionEnabled) {\n      const model = await cipher.decrypt(await this.getKeyForCipherKeyDecryption(cipher));\n      cipher = await this.encrypt(model);\n      await this.updateWithServer(cipher);\n    }\n\n    const encFileName = await this.encryptService.encrypt(filename, cipherEncKey);\n\n    const dataEncKey = await this.cryptoService.makeDataEncKey(cipherEncKey);\n    const encData = await this.encryptService.encryptToBytes(new Uint8Array(data), dataEncKey[0]);\n\n    const response = await this.cipherFileUploadService.upload(\n      cipher,\n      encFileName,\n      encData,\n      admin,\n      dataEncKey,\n    );\n\n    const cData = new CipherData(response, cipher.collectionIds);\n    if (!admin) {\n      await this.upsert(cData);\n    }\n    return new Cipher(cData);\n  }\n\n  async saveCollectionsWithServer(cipher: Cipher): Promise<Cipher> {\n    const request = new CipherCollectionsRequest(cipher.collectionIds);\n    const response = await this.apiService.putCipherCollections(cipher.id, request);\n    // The response will now check for an unavailable value. This value determines whether\n    // the user still has Can Manage access to the item after updating.\n    if (response.unavailable) {\n      await this.delete(cipher.id);\n      return;\n    }\n    const data = new CipherData(response.cipher);\n    const updated = await this.upsert(data);\n    return new Cipher(updated[cipher.id as CipherId], cipher.localData);\n  }\n\n  /**\n   * Bulk update collections for many ciphers with the server\n   * @param orgId\n   * @param cipherIds\n   * @param collectionIds\n   * @param removeCollections - If true, the collectionIds will be removed from the ciphers, otherwise they will be added\n   */\n  async bulkUpdateCollectionsWithServer(\n    orgId: OrganizationId,\n    cipherIds: CipherId[],\n    collectionIds: CollectionId[],\n    removeCollections: boolean = false,\n  ): Promise<void> {\n    const request = new CipherBulkUpdateCollectionsRequest(\n      orgId,\n      cipherIds,\n      collectionIds,\n      removeCollections,\n    );\n\n    await this.apiService.send(\"POST\", \"/ciphers/bulk-collections\", request, true, false);\n\n    // Update the local state\n    const ciphers = await firstValueFrom(this.ciphers$);\n\n    for (const id of cipherIds) {\n      const cipher = ciphers[id];\n      if (cipher) {\n        if (removeCollections) {\n          cipher.collectionIds = cipher.collectionIds?.filter(\n            (cid) => !collectionIds.includes(cid as CollectionId),\n          );\n        } else {\n          // Append to the collectionIds if it's not already there\n          cipher.collectionIds = [...new Set([...(cipher.collectionIds ?? []), ...collectionIds])];\n        }\n      }\n    }\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => ciphers);\n  }\n\n  async upsert(cipher: CipherData | CipherData[]): Promise<Record<CipherId, CipherData>> {\n    const ciphers = cipher instanceof CipherData ? [cipher] : cipher;\n    return await this.updateEncryptedCipherState((current) => {\n      ciphers.forEach((c) => (current[c.id as CipherId] = c));\n      return current;\n    });\n  }\n\n  async replace(ciphers: { [id: string]: CipherData }): Promise<any> {\n    await this.updateEncryptedCipherState(() => ciphers);\n  }\n\n  /**\n   * Updates ciphers for the currently active user. Inactive users can only clear all ciphers, for now.\n   * @param update update callback for encrypted cipher data\n   * @returns\n   */\n  private async updateEncryptedCipherState(\n    update: (current: Record<CipherId, CipherData>) => Record<CipherId, CipherData>,\n  ): Promise<Record<CipherId, CipherData>> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    // Store that we should wait for an update to return any ciphers\n    await this.ciphersExpectingUpdate.forceValue(true);\n    await this.clearDecryptedCiphersState(userId);\n    const [, updatedCiphers] = await this.encryptedCiphersState.update((current) => {\n      const result = update(current ?? {});\n      return result;\n    });\n    return updatedCiphers;\n  }\n\n  async clear(userId?: UserId): Promise<any> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    await this.clearEncryptedCiphersState(userId);\n    await this.clearCache(userId);\n  }\n\n  async moveManyWithServer(ids: string[], folderId: string): Promise<any> {\n    await this.apiService.putMoveCiphers(new CipherBulkMoveRequest(ids, folderId));\n\n    let ciphers = await firstValueFrom(this.ciphers$);\n    if (ciphers == null) {\n      ciphers = {};\n    }\n\n    ids.forEach((id) => {\n      // eslint-disable-next-line\n      if (ciphers.hasOwnProperty(id)) {\n        ciphers[id as CipherId].folderId = folderId;\n      }\n    });\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => ciphers);\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    const ciphers = await firstValueFrom(this.ciphers$);\n    if (ciphers == null) {\n      return;\n    }\n\n    if (typeof id === \"string\") {\n      const cipherId = id as CipherId;\n      if (ciphers[cipherId] == null) {\n        return;\n      }\n      delete ciphers[cipherId];\n    } else {\n      (id as CipherId[]).forEach((i) => {\n        delete ciphers[i];\n      });\n    }\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => ciphers);\n  }\n\n  async deleteWithServer(id: string, asAdmin = false): Promise<any> {\n    if (asAdmin) {\n      await this.apiService.deleteCipherAdmin(id);\n    } else {\n      await this.apiService.deleteCipher(id);\n    }\n\n    await this.delete(id);\n  }\n\n  async deleteManyWithServer(ids: string[], asAdmin = false): Promise<any> {\n    const request = new CipherBulkDeleteRequest(ids);\n    if (asAdmin) {\n      await this.apiService.deleteManyCiphersAdmin(request);\n    } else {\n      await this.apiService.deleteManyCiphers(request);\n    }\n    await this.delete(ids);\n  }\n\n  async deleteAttachment(id: string, attachmentId: string): Promise<void> {\n    let ciphers = await firstValueFrom(this.ciphers$);\n    const cipherId = id as CipherId;\n    // eslint-disable-next-line\n    if (ciphers == null || !ciphers.hasOwnProperty(id) || ciphers[cipherId].attachments == null) {\n      return;\n    }\n\n    for (let i = 0; i < ciphers[cipherId].attachments.length; i++) {\n      if (ciphers[cipherId].attachments[i].id === attachmentId) {\n        ciphers[cipherId].attachments.splice(i, 1);\n      }\n    }\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => {\n      if (ciphers == null) {\n        ciphers = {};\n      }\n      return ciphers;\n    });\n  }\n\n  async deleteAttachmentWithServer(id: string, attachmentId: string): Promise<void> {\n    try {\n      await this.apiService.deleteCipherAttachment(id, attachmentId);\n    } catch (e) {\n      return Promise.reject((e as ErrorResponse).getSingleMessage());\n    }\n    await this.deleteAttachment(id, attachmentId);\n  }\n\n  sortCiphersByLastUsed(a: CipherView, b: CipherView): number {\n    const aLastUsed =\n      a.localData && a.localData.lastUsedDate ? (a.localData.lastUsedDate as number) : null;\n    const bLastUsed =\n      b.localData && b.localData.lastUsedDate ? (b.localData.lastUsedDate as number) : null;\n\n    const bothNotNull = aLastUsed != null && bLastUsed != null;\n    if (bothNotNull && aLastUsed < bLastUsed) {\n      return 1;\n    }\n    if (aLastUsed != null && bLastUsed == null) {\n      return -1;\n    }\n\n    if (bothNotNull && aLastUsed > bLastUsed) {\n      return -1;\n    }\n    if (bLastUsed != null && aLastUsed == null) {\n      return 1;\n    }\n\n    return 0;\n  }\n\n  sortCiphersByLastUsedThenName(a: CipherView, b: CipherView): number {\n    const result = this.sortCiphersByLastUsed(a, b);\n    if (result !== 0) {\n      return result;\n    }\n\n    return this.getLocaleSortingFunction()(a, b);\n  }\n\n  getLocaleSortingFunction(): (a: CipherView, b: CipherView) => number {\n    return (a, b) => {\n      let aName = a.name;\n      let bName = b.name;\n\n      if (aName == null && bName != null) {\n        return -1;\n      }\n      if (aName != null && bName == null) {\n        return 1;\n      }\n      if (aName == null && bName == null) {\n        return 0;\n      }\n\n      const result = this.i18nService.collator\n        ? this.i18nService.collator.compare(aName, bName)\n        : aName.localeCompare(bName);\n\n      if (result !== 0 || a.type !== CipherType.Login || b.type !== CipherType.Login) {\n        return result;\n      }\n\n      if (a.login.username != null) {\n        aName += a.login.username;\n      }\n\n      if (b.login.username != null) {\n        bName += b.login.username;\n      }\n\n      return this.i18nService.collator\n        ? this.i18nService.collator.compare(aName, bName)\n        : aName.localeCompare(bName);\n    };\n  }\n\n  async softDelete(id: string | string[]): Promise<any> {\n    let ciphers = await firstValueFrom(this.ciphers$);\n    if (ciphers == null) {\n      return;\n    }\n\n    const setDeletedDate = (cipherId: CipherId) => {\n      if (ciphers[cipherId] == null) {\n        return;\n      }\n      ciphers[cipherId].deletedDate = new Date().toISOString();\n    };\n\n    if (typeof id === \"string\") {\n      setDeletedDate(id as CipherId);\n    } else {\n      (id as string[]).forEach(setDeletedDate);\n    }\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => {\n      if (ciphers == null) {\n        ciphers = {};\n      }\n      return ciphers;\n    });\n  }\n\n  async softDeleteWithServer(id: string, asAdmin = false): Promise<any> {\n    if (asAdmin) {\n      await this.apiService.putDeleteCipherAdmin(id);\n    } else {\n      await this.apiService.putDeleteCipher(id);\n    }\n\n    await this.softDelete(id);\n  }\n\n  async softDeleteManyWithServer(ids: string[], asAdmin = false): Promise<any> {\n    const request = new CipherBulkDeleteRequest(ids);\n    if (asAdmin) {\n      await this.apiService.putDeleteManyCiphersAdmin(request);\n    } else {\n      await this.apiService.putDeleteManyCiphers(request);\n    }\n\n    await this.softDelete(ids);\n  }\n\n  async restore(\n    cipher: { id: string; revisionDate: string } | { id: string; revisionDate: string }[],\n  ) {\n    let ciphers = await firstValueFrom(this.ciphers$);\n    if (ciphers == null) {\n      return;\n    }\n\n    const clearDeletedDate = (c: { id: string; revisionDate: string }) => {\n      const cipherId = c.id as CipherId;\n      if (ciphers[cipherId] == null) {\n        return;\n      }\n      ciphers[cipherId].deletedDate = null;\n      ciphers[cipherId].revisionDate = c.revisionDate;\n    };\n\n    if (cipher.constructor.name === Array.name) {\n      (cipher as { id: string; revisionDate: string }[]).forEach(clearDeletedDate);\n    } else {\n      clearDeletedDate(cipher as { id: string; revisionDate: string });\n    }\n\n    await this.clearCache();\n    await this.encryptedCiphersState.update(() => {\n      if (ciphers == null) {\n        ciphers = {};\n      }\n      return ciphers;\n    });\n  }\n\n  async restoreWithServer(id: string, asAdmin = false): Promise<any> {\n    let response;\n    if (asAdmin) {\n      response = await this.apiService.putRestoreCipherAdmin(id);\n    } else {\n      response = await this.apiService.putRestoreCipher(id);\n    }\n\n    await this.restore({ id: id, revisionDate: response.revisionDate });\n  }\n\n  /**\n   * No longer using an asAdmin Param. Org Vault bulkRestore will assess if an item is unassigned or editable\n   * The Org Vault will pass those ids an array as well as the orgId when calling bulkRestore\n   */\n  async restoreManyWithServer(ids: string[], orgId: string = null): Promise<void> {\n    let response;\n\n    if (orgId) {\n      const request = new CipherBulkRestoreRequest(ids, orgId);\n      response = await this.apiService.putRestoreManyCiphersAdmin(request);\n    } else {\n      const request = new CipherBulkRestoreRequest(ids);\n      response = await this.apiService.putRestoreManyCiphers(request);\n    }\n\n    const restores: { id: string; revisionDate: string }[] = [];\n    for (const cipher of response.data) {\n      restores.push({ id: cipher.id, revisionDate: cipher.revisionDate });\n    }\n    await this.restore(restores);\n  }\n\n  async getKeyForCipherKeyDecryption(cipher: Cipher): Promise<UserKey | OrgKey> {\n    return (\n      (await this.cryptoService.getOrgKey(cipher.organizationId)) ||\n      ((await this.cryptoService.getUserKeyWithLegacySupport()) as UserKey)\n    );\n  }\n\n  async setAddEditCipherInfo(value: AddEditCipherInfo) {\n    await this.addEditCipherInfoState.update(() => value, {\n      shouldUpdate: (current) => !(current == null && value == null),\n    });\n  }\n\n  // Helpers\n\n  // In the case of a cipher that is being shared with an organization, we want to decrypt the\n  // cipher key with the user's key and then re-encrypt it with the organization's key.\n  private async encryptSharedCipher(model: CipherView): Promise<Cipher> {\n    const keyForCipherKeyDecryption = await this.cryptoService.getUserKeyWithLegacySupport();\n    return await this.encrypt(model, null, keyForCipherKeyDecryption);\n  }\n\n  private async updateModelfromExistingCipher(\n    model: CipherView,\n    originalCipher: Cipher,\n  ): Promise<void> {\n    const existingCipher = await originalCipher.decrypt(\n      await this.getKeyForCipherKeyDecryption(originalCipher),\n    );\n    model.passwordHistory = existingCipher.passwordHistory || [];\n    if (model.type === CipherType.Login && existingCipher.type === CipherType.Login) {\n      if (\n        existingCipher.login.password != null &&\n        existingCipher.login.password !== \"\" &&\n        existingCipher.login.password !== model.login.password\n      ) {\n        const ph = new PasswordHistoryView();\n        ph.password = existingCipher.login.password;\n        ph.lastUsedDate = model.login.passwordRevisionDate = new Date();\n        model.passwordHistory.splice(0, 0, ph);\n      } else {\n        model.login.passwordRevisionDate = existingCipher.login.passwordRevisionDate;\n      }\n    }\n    if (existingCipher.hasFields) {\n      const existingHiddenFields = existingCipher.fields.filter(\n        (f) =>\n          f.type === FieldType.Hidden &&\n          f.name != null &&\n          f.name !== \"\" &&\n          f.value != null &&\n          f.value !== \"\",\n      );\n      const hiddenFields =\n        model.fields == null\n          ? []\n          : model.fields.filter(\n              (f) => f.type === FieldType.Hidden && f.name != null && f.name !== \"\",\n            );\n      existingHiddenFields.forEach((ef) => {\n        const matchedField = hiddenFields.find((f) => f.name === ef.name);\n        if (matchedField == null || matchedField.value !== ef.value) {\n          const ph = new PasswordHistoryView();\n          ph.password = ef.name + \": \" + ef.value;\n          ph.lastUsedDate = new Date();\n          model.passwordHistory.splice(0, 0, ph);\n        }\n      });\n    }\n  }\n\n  private adjustPasswordHistoryLength(model: CipherView) {\n    if (model.passwordHistory != null && model.passwordHistory.length === 0) {\n      model.passwordHistory = null;\n    } else if (model.passwordHistory != null && model.passwordHistory.length > 5) {\n      // only save last 5 history\n      model.passwordHistory = model.passwordHistory.slice(0, 5);\n    }\n  }\n\n  private async shareAttachmentWithServer(\n    attachmentView: AttachmentView,\n    cipherId: string,\n    organizationId: string,\n  ): Promise<any> {\n    const attachmentResponse = await this.apiService.nativeFetch(\n      new Request(attachmentView.url, { cache: \"no-store\" }),\n    );\n    if (attachmentResponse.status !== 200) {\n      throw Error(\"Failed to download attachment: \" + attachmentResponse.status.toString());\n    }\n\n    const encBuf = await EncArrayBuffer.fromResponse(attachmentResponse);\n    const decBuf = await this.cryptoService.decryptFromBytes(encBuf, null);\n\n    let encKey: UserKey | OrgKey;\n    encKey = await this.cryptoService.getOrgKey(organizationId);\n    encKey ||= (await this.cryptoService.getUserKeyWithLegacySupport()) as UserKey;\n\n    const dataEncKey = await this.cryptoService.makeDataEncKey(encKey);\n\n    const encFileName = await this.encryptService.encrypt(attachmentView.fileName, encKey);\n    const encData = await this.encryptService.encryptToBytes(new Uint8Array(decBuf), dataEncKey[0]);\n\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"key\", dataEncKey[1].encryptedString);\n      fd.append(\"data\", blob, encFileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"key\", dataEncKey[1].encryptedString);\n        fd.append(\n          \"data\",\n          Buffer.from(encData.buffer) as any,\n          {\n            filepath: encFileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    try {\n      await this.apiService.postShareCipherAttachment(\n        cipherId,\n        attachmentView.id,\n        fd,\n        organizationId,\n      );\n    } catch (e) {\n      throw new Error((e as ErrorResponse).getSingleMessage());\n    }\n  }\n\n  private async encryptObjProperty<V extends View, D extends Domain>(\n    model: V,\n    obj: D,\n    map: any,\n    key: SymmetricCryptoKey,\n  ): Promise<void> {\n    const promises = [];\n    const self = this;\n\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      (function (theProp, theObj) {\n        const p = Promise.resolve()\n          .then(() => {\n            const modelProp = (model as any)[map[theProp] || theProp];\n            if (modelProp && modelProp !== \"\") {\n              return self.cryptoService.encrypt(modelProp, key);\n            }\n            return null;\n          })\n          .then((val: EncString) => {\n            (theObj as any)[theProp] = val;\n          });\n        promises.push(p);\n      })(prop, obj);\n    }\n\n    await Promise.all(promises);\n  }\n\n  private async encryptCipherData(cipher: Cipher, model: CipherView, key: SymmetricCryptoKey) {\n    switch (cipher.type) {\n      case CipherType.Login:\n        cipher.login = new Login();\n        cipher.login.passwordRevisionDate = model.login.passwordRevisionDate;\n        cipher.login.autofillOnPageLoad = model.login.autofillOnPageLoad;\n        await this.encryptObjProperty(\n          model.login,\n          cipher.login,\n          {\n            username: null,\n            password: null,\n            totp: null,\n          },\n          key,\n        );\n\n        if (model.login.uris != null) {\n          cipher.login.uris = [];\n          model.login.uris = model.login.uris.filter((u) => u.uri != null);\n          for (let i = 0; i < model.login.uris.length; i++) {\n            const loginUri = new LoginUri();\n            loginUri.match = model.login.uris[i].match;\n            await this.encryptObjProperty(\n              model.login.uris[i],\n              loginUri,\n              {\n                uri: null,\n              },\n              key,\n            );\n            const uriHash = await this.encryptService.hash(model.login.uris[i].uri, \"sha256\");\n            loginUri.uriChecksum = await this.cryptoService.encrypt(uriHash, key);\n            cipher.login.uris.push(loginUri);\n          }\n        }\n\n        if (model.login.fido2Credentials != null) {\n          cipher.login.fido2Credentials = await Promise.all(\n            model.login.fido2Credentials.map(async (viewKey) => {\n              const domainKey = new Fido2Credential();\n              await this.encryptObjProperty(\n                viewKey,\n                domainKey,\n                {\n                  credentialId: null,\n                  keyType: null,\n                  keyAlgorithm: null,\n                  keyCurve: null,\n                  keyValue: null,\n                  rpId: null,\n                  rpName: null,\n                  userHandle: null,\n                  userName: null,\n                  userDisplayName: null,\n                  origin: null,\n                },\n                key,\n              );\n              domainKey.counter = await this.cryptoService.encrypt(String(viewKey.counter), key);\n              domainKey.discoverable = await this.cryptoService.encrypt(\n                String(viewKey.discoverable),\n                key,\n              );\n              domainKey.creationDate = viewKey.creationDate;\n              return domainKey;\n            }),\n          );\n        }\n        return;\n      case CipherType.SecureNote:\n        cipher.secureNote = new SecureNote();\n        cipher.secureNote.type = model.secureNote.type;\n        return;\n      case CipherType.Card:\n        cipher.card = new Card();\n        await this.encryptObjProperty(\n          model.card,\n          cipher.card,\n          {\n            cardholderName: null,\n            brand: null,\n            number: null,\n            expMonth: null,\n            expYear: null,\n            code: null,\n          },\n          key,\n        );\n        return;\n      case CipherType.Identity:\n        cipher.identity = new Identity();\n        await this.encryptObjProperty(\n          model.identity,\n          cipher.identity,\n          {\n            title: null,\n            firstName: null,\n            middleName: null,\n            lastName: null,\n            address1: null,\n            address2: null,\n            address3: null,\n            city: null,\n            state: null,\n            postalCode: null,\n            country: null,\n            company: null,\n            email: null,\n            phone: null,\n            ssn: null,\n            username: null,\n            passportNumber: null,\n            licenseNumber: null,\n          },\n          key,\n        );\n        return;\n      default:\n        throw new Error(\"Unknown cipher type.\");\n    }\n  }\n\n  private async getAutofillOnPageLoadDefault() {\n    return await firstValueFrom(this.autofillSettingsService.autofillOnPageLoadDefault$);\n  }\n\n  private async getCipherForUrl(\n    url: string,\n    lastUsed: boolean,\n    lastLaunched: boolean,\n    autofillOnPageLoad: boolean,\n  ): Promise<CipherView> {\n    const cacheKey = autofillOnPageLoad ? \"autofillOnPageLoad-\" + url : url;\n\n    if (!this.sortedCiphersCache.isCached(cacheKey)) {\n      let ciphers = await this.getAllDecryptedForUrl(url);\n      if (!ciphers) {\n        return null;\n      }\n\n      if (autofillOnPageLoad) {\n        const autofillOnPageLoadDefault = await this.getAutofillOnPageLoadDefault();\n\n        ciphers = ciphers.filter(\n          (cipher) =>\n            cipher.login.autofillOnPageLoad ||\n            (cipher.login.autofillOnPageLoad == null && autofillOnPageLoadDefault !== false),\n        );\n        if (ciphers.length === 0) {\n          return null;\n        }\n      }\n\n      this.sortedCiphersCache.addCiphers(cacheKey, ciphers);\n    }\n\n    if (lastLaunched) {\n      return this.sortedCiphersCache.getLastLaunched(cacheKey);\n    } else if (lastUsed) {\n      return this.sortedCiphersCache.getLastUsed(cacheKey);\n    } else {\n      return this.sortedCiphersCache.getNext(cacheKey);\n    }\n  }\n\n  private async clearEncryptedCiphersState(userId: UserId) {\n    await this.stateProvider.setUserState(ENCRYPTED_CIPHERS, {}, userId);\n  }\n\n  private async clearDecryptedCiphersState(userId: UserId) {\n    await this.setDecryptedCiphers(null, userId);\n    this.clearSortedCiphers();\n  }\n\n  private clearSortedCiphers() {\n    this.sortedCiphersCache.clear();\n  }\n\n  private async encryptCipher(\n    model: CipherView,\n    cipher: Cipher,\n    key: SymmetricCryptoKey,\n  ): Promise<Cipher> {\n    await Promise.all([\n      this.encryptObjProperty(\n        model,\n        cipher,\n        {\n          name: null,\n          notes: null,\n        },\n        key,\n      ),\n      this.encryptCipherData(cipher, model, key),\n      this.encryptFields(model.fields, key).then((fields) => {\n        cipher.fields = fields;\n      }),\n      this.encryptPasswordHistories(model.passwordHistory, key).then((ph) => {\n        cipher.passwordHistory = ph;\n      }),\n      this.encryptAttachments(model.attachments, key).then((attachments) => {\n        cipher.attachments = attachments;\n      }),\n    ]);\n    return cipher;\n  }\n\n  private async encryptCipherWithCipherKey(\n    model: CipherView,\n    cipher: Cipher,\n    keyForCipherKeyEncryption: SymmetricCryptoKey,\n    keyForCipherKeyDecryption: SymmetricCryptoKey,\n  ): Promise<Cipher> {\n    // First, we get the key for cipher key encryption, in its decrypted form\n    let decryptedCipherKey: SymmetricCryptoKey;\n    if (cipher.key == null) {\n      decryptedCipherKey = await this.cryptoService.makeCipherKey();\n    } else {\n      decryptedCipherKey = new SymmetricCryptoKey(\n        await this.encryptService.decryptToBytes(cipher.key, keyForCipherKeyDecryption),\n      );\n    }\n\n    // Then, we have to encrypt the cipher key with the proper key.\n    cipher.key = await this.encryptService.encrypt(\n      decryptedCipherKey.key,\n      keyForCipherKeyEncryption,\n    );\n\n    // Finally, we can encrypt the cipher with the decrypted cipher key.\n    return this.encryptCipher(model, cipher, decryptedCipherKey);\n  }\n\n  private async getCipherKeyEncryptionEnabled(): Promise<boolean> {\n    return (\n      flagEnabled(\"enableCipherKeyEncryption\") &&\n      (await firstValueFrom(\n        this.configService.checkServerMeetsVersionRequirement$(CIPHER_KEY_ENC_MIN_SERVER_VER),\n      ))\n    );\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CollectionId, OrganizationId } from \"../../../types/guid\";\nimport { CollectionDetailsResponse } from \"../response/collection.response\";\n\nexport class CollectionData {\n  id: CollectionId;\n  organizationId: OrganizationId;\n  name: string;\n  externalId: string;\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n\n  constructor(response: CollectionDetailsResponse) {\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.name = response.name;\n    this.externalId = response.externalId;\n    this.readOnly = response.readOnly;\n    this.manage = response.manage;\n    this.hidePasswords = response.hidePasswords;\n  }\n\n  static fromJSON(obj: Jsonify<CollectionData>) {\n    return Object.assign(new CollectionData(new CollectionDetailsResponse({})), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Organization } from \"../../../admin-console/models/domain/organization\";\nimport { View } from \"../../../models/view/view\";\nimport { Collection } from \"../domain/collection\";\nimport { ITreeNodeObject } from \"../domain/tree-node\";\nimport { CollectionAccessDetailsResponse } from \"../response/collection.response\";\n\nexport const NestingDelimiter = \"/\";\n\nexport class CollectionView implements View, ITreeNodeObject {\n  id: string = null;\n  organizationId: string = null;\n  name: string = null;\n  externalId: string = null;\n  // readOnly applies to the items within a collection\n  readOnly: boolean = null;\n  hidePasswords: boolean = null;\n  manage: boolean = null;\n  assigned: boolean = null;\n\n  constructor(c?: Collection | CollectionAccessDetailsResponse) {\n    if (!c) {\n      return;\n    }\n\n    this.id = c.id;\n    this.organizationId = c.organizationId;\n    this.externalId = c.externalId;\n    if (c instanceof Collection) {\n      this.readOnly = c.readOnly;\n      this.hidePasswords = c.hidePasswords;\n      this.manage = c.manage;\n      this.assigned = true;\n    }\n    if (c instanceof CollectionAccessDetailsResponse) {\n      this.assigned = c.assigned;\n    }\n  }\n\n  canEditItems(\n    org: Organization,\n    v1FlexibleCollections: boolean,\n    restrictProviderAccess: boolean,\n  ): boolean {\n    if (org != null && org.id !== this.organizationId) {\n      throw new Error(\n        \"Id of the organization provided does not match the org id of the collection.\",\n      );\n    }\n\n    if (org?.flexibleCollections) {\n      return (\n        org?.canEditAllCiphers(v1FlexibleCollections, restrictProviderAccess) ||\n        this.manage ||\n        (this.assigned && !this.readOnly)\n      );\n    }\n\n    return org?.canEditAnyCollection(false) || (org?.canEditAssignedCollections && this.assigned);\n  }\n\n  /**\n   * Returns true if the user can edit a collection (including user and group access) from the individual vault.\n   * After FCv1, does not include admin permissions - see {@link CollectionAdminView.canEdit}.\n   */\n  canEdit(org: Organization, flexibleCollectionsV1Enabled: boolean): boolean {\n    if (org != null && org.id !== this.organizationId) {\n      throw new Error(\n        \"Id of the organization provided does not match the org id of the collection.\",\n      );\n    }\n\n    if (flexibleCollectionsV1Enabled) {\n      // Only use individual permissions, not admin permissions\n      return this.manage;\n    }\n\n    return org?.canEditAnyCollection(flexibleCollectionsV1Enabled) || this.manage;\n  }\n\n  /**\n   * Returns true if the user can delete a collection from the individual vault.\n   * After FCv1, does not include admin permissions - see {@link CollectionAdminView.canDelete}.\n   */\n  canDelete(org: Organization, flexibleCollectionsV1Enabled: boolean): boolean {\n    if (org != null && org.id !== this.organizationId) {\n      throw new Error(\n        \"Id of the organization provided does not match the org id of the collection.\",\n      );\n    }\n\n    const canDeleteManagedCollections = !org?.limitCollectionCreationDeletion || org.isAdmin;\n\n    if (flexibleCollectionsV1Enabled) {\n      // Only use individual permissions, not admin permissions\n      return canDeleteManagedCollections && this.manage;\n    }\n\n    return (\n      org?.canDeleteAnyCollection(flexibleCollectionsV1Enabled) ||\n      (canDeleteManagedCollections && this.manage)\n    );\n  }\n\n  /**\n   * Returns true if the user can view collection info and access in a read-only state from the individual vault\n   */\n  canViewCollectionInfo(\n    org: Organization | undefined,\n    flexibleCollectionsV1Enabled: boolean,\n  ): boolean {\n    return false;\n  }\n\n  static fromJSON(obj: Jsonify<CollectionView>) {\n    return Object.assign(new CollectionView(new Collection()), obj);\n  }\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { OrgKey } from \"../../../types/key\";\nimport { CollectionData } from \"../data/collection.data\";\nimport { CollectionView } from \"../view/collection.view\";\n\nexport class Collection extends Domain {\n  id: string;\n  organizationId: string;\n  name: EncString;\n  externalId: string;\n  readOnly: boolean;\n  hidePasswords: boolean;\n  manage: boolean;\n\n  constructor(obj?: CollectionData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        organizationId: null,\n        name: null,\n        externalId: null,\n        readOnly: null,\n        hidePasswords: null,\n        manage: null,\n      },\n      [\"id\", \"organizationId\", \"externalId\", \"readOnly\", \"hidePasswords\", \"manage\"],\n    );\n  }\n\n  decrypt(orgKey: OrgKey): Promise<CollectionView> {\n    return this.decryptObj(\n      new CollectionView(this),\n      {\n        name: null,\n      },\n      this.organizationId,\n      orgKey,\n    );\n  }\n}\n","export class TreeNode<T extends ITreeNodeObject> {\n  node: T;\n  parent: TreeNode<T>;\n  children: TreeNode<T>[] = [];\n\n  constructor(node: T, parent: TreeNode<T>, name?: string, id?: string) {\n    this.parent = parent;\n    this.node = node;\n    if (name) {\n      this.node.name = name;\n    }\n    if (id) {\n      this.node.id = id;\n    }\n  }\n}\n\nexport interface ITreeNodeObject {\n  id: string;\n  name: string;\n}\n","import { ITreeNodeObject, TreeNode } from \"./models/domain/tree-node\";\n\nexport class ServiceUtils {\n  /**\n   * Recursively adds a node to nodeTree\n   * @param {TreeNode<ITreeNodeObject>[]} nodeTree - An array of TreeNodes that the node will be added to\n   * @param {number} partIndex - Index of the `parts` array that is being processed\n   * @param {string[]} parts - Array of strings that represent the path to the `obj` node\n   * @param {ITreeNodeObject} obj - The node to be added to the tree\n   * @param {ITreeNodeObject} parent - The parent node of the `obj` node\n   * @param {string} delimiter - The delimiter used to split the path string, will be used to combine the path for missing nodes\n   */\n  static nestedTraverse(\n    nodeTree: TreeNode<ITreeNodeObject>[],\n    partIndex: number,\n    parts: string[],\n    obj: ITreeNodeObject,\n    parent: TreeNode<ITreeNodeObject> | undefined,\n    delimiter: string,\n  ) {\n    if (parts.length <= partIndex) {\n      return;\n    }\n\n    const end: boolean = partIndex === parts.length - 1;\n    const partName: string = parts[partIndex];\n\n    for (let i = 0; i < nodeTree.length; i++) {\n      if (nodeTree[i].node.name !== partName) {\n        continue;\n      }\n      if (end && nodeTree[i].node.id !== obj.id) {\n        // Another node exists with the same name as the node being added\n        nodeTree.push(new TreeNode(obj, parent, partName));\n        return;\n      }\n      // Move down the tree to the next level\n      ServiceUtils.nestedTraverse(\n        nodeTree[i].children,\n        partIndex + 1,\n        parts,\n        obj,\n        nodeTree[i],\n        delimiter,\n      );\n      return;\n    }\n\n    // If there's no node here with the same name...\n    if (nodeTree.filter((n) => n.node.name === partName).length === 0) {\n      // And we're at the end of the path given, add the node\n      if (end) {\n        nodeTree.push(new TreeNode(obj, parent, partName));\n        return;\n      }\n      // And we're not at the end of the path, combine the current name with the next name\n      // 1, *1.2, 1.2.1 becomes\n      // 1, *1.2/1.2.1\n      const newPartName = partName + delimiter + parts[partIndex + 1];\n      ServiceUtils.nestedTraverse(\n        nodeTree,\n        0,\n        [newPartName, ...parts.slice(partIndex + 2)],\n        obj,\n        parent,\n        delimiter,\n      );\n    }\n  }\n\n  /**\n   * Searches a tree for a node with a matching `id`\n   * @param {TreeNode<T>} nodeTree - A single TreeNode branch that will be searched\n   * @param {string} id - The id of the node to be found\n   * @returns {TreeNode<T>} The node with a matching `id`\n   */\n  static getTreeNodeObject<T extends ITreeNodeObject>(\n    nodeTree: TreeNode<T>,\n    id: string,\n  ): TreeNode<T> {\n    if (nodeTree.node.id === id) {\n      return nodeTree;\n    }\n    for (let i = 0; i < nodeTree.children.length; i++) {\n      if (nodeTree.children[i].children != null) {\n        const node = ServiceUtils.getTreeNodeObject(nodeTree.children[i], id);\n        if (node !== null) {\n          return node;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Searches an array of tree nodes for a node with a matching `id`\n   * @param {TreeNode<T>} nodeTree - An array of TreeNode branches that will be searched\n   * @param {string} id - The id of the node to be found\n   * @returns {TreeNode<T>} The node with a matching `id`\n   */\n  static getTreeNodeObjectFromList<T extends ITreeNodeObject>(\n    nodeTree: TreeNode<T>[],\n    id: string,\n  ): TreeNode<T> {\n    for (let i = 0; i < nodeTree.length; i++) {\n      if (nodeTree[i].node.id === id) {\n        return nodeTree[i];\n      } else if (nodeTree[i].children != null) {\n        const node = ServiceUtils.getTreeNodeObjectFromList(nodeTree[i].children, id);\n        if (node !== null) {\n          return node;\n        }\n      }\n    }\n    return null;\n  }\n}\n","import { firstValueFrom, map, Observable } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport {\n  ActiveUserState,\n  StateProvider,\n  COLLECTION_DATA,\n  DeriveDefinition,\n  DerivedState,\n  UserKeyDefinition,\n} from \"../../platform/state\";\nimport { CollectionId, OrganizationId, UserId } from \"../../types/guid\";\nimport { CollectionService as CollectionServiceAbstraction } from \"../../vault/abstractions/collection.service\";\nimport { CollectionData } from \"../models/data/collection.data\";\nimport { Collection } from \"../models/domain/collection\";\nimport { TreeNode } from \"../models/domain/tree-node\";\nimport { CollectionView } from \"../models/view/collection.view\";\nimport { ServiceUtils } from \"../service-utils\";\n\nconst ENCRYPTED_COLLECTION_DATA_KEY = UserKeyDefinition.record<CollectionData, CollectionId>(\n  COLLECTION_DATA,\n  \"collections\",\n  {\n    deserializer: (jsonData: Jsonify<CollectionData>) => CollectionData.fromJSON(jsonData),\n    clearOn: [\"logout\"],\n  },\n);\n\nconst DECRYPTED_COLLECTION_DATA_KEY = DeriveDefinition.from<\n  Record<CollectionId, CollectionData>,\n  CollectionView[],\n  { collectionService: CollectionService }\n>(ENCRYPTED_COLLECTION_DATA_KEY, {\n  deserializer: (obj) => obj.map((collection) => CollectionView.fromJSON(collection)),\n  derive: async (collections: Record<CollectionId, CollectionData>, { collectionService }) => {\n    const data: Collection[] = [];\n    for (const id in collections ?? {}) {\n      const collectionId = id as CollectionId;\n      data.push(new Collection(collections[collectionId]));\n    }\n    return await collectionService.decryptMany(data);\n  },\n});\n\nconst NestingDelimiter = \"/\";\n\nexport class CollectionService implements CollectionServiceAbstraction {\n  private encryptedCollectionDataState: ActiveUserState<Record<CollectionId, CollectionData>>;\n  encryptedCollections$: Observable<Collection[]>;\n  private decryptedCollectionDataState: DerivedState<CollectionView[]>;\n  decryptedCollections$: Observable<CollectionView[]>;\n\n  decryptedCollectionViews$(ids: CollectionId[]): Observable<CollectionView[]> {\n    return this.decryptedCollections$.pipe(\n      map((collections) => collections.filter((c) => ids.includes(c.id as CollectionId))),\n    );\n  }\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    protected stateProvider: StateProvider,\n  ) {\n    this.encryptedCollectionDataState = this.stateProvider.getActive(ENCRYPTED_COLLECTION_DATA_KEY);\n    this.encryptedCollections$ = this.encryptedCollectionDataState.state$.pipe(\n      map((collections) => {\n        const response: Collection[] = [];\n        for (const id in collections ?? {}) {\n          response.push(new Collection(collections[id as CollectionId]));\n        }\n        return response;\n      }),\n    );\n\n    this.decryptedCollectionDataState = this.stateProvider.getDerived(\n      this.encryptedCollectionDataState.state$,\n      DECRYPTED_COLLECTION_DATA_KEY,\n      { collectionService: this },\n    );\n\n    this.decryptedCollections$ = this.decryptedCollectionDataState.state$;\n  }\n\n  async clearActiveUserCache(): Promise<void> {\n    await this.decryptedCollectionDataState.forceValue(null);\n  }\n\n  async encrypt(model: CollectionView): Promise<Collection> {\n    if (model.organizationId == null) {\n      throw new Error(\"Collection has no organization id.\");\n    }\n    const key = await this.cryptoService.getOrgKey(model.organizationId);\n    if (key == null) {\n      throw new Error(\"No key for this collection's organization.\");\n    }\n    const collection = new Collection();\n    collection.id = model.id;\n    collection.organizationId = model.organizationId;\n    collection.readOnly = model.readOnly;\n    collection.name = await this.cryptoService.encrypt(model.name, key);\n    return collection;\n  }\n\n  async decryptMany(collections: Collection[]): Promise<CollectionView[]> {\n    if (collections == null) {\n      return [];\n    }\n    const decCollections: CollectionView[] = [];\n\n    const organizationKeys = await firstValueFrom(this.cryptoService.activeUserOrgKeys$);\n\n    const promises: Promise<any>[] = [];\n    collections.forEach((collection) => {\n      promises.push(\n        collection\n          .decrypt(organizationKeys[collection.organizationId as OrganizationId])\n          .then((c) => decCollections.push(c)),\n      );\n    });\n    await Promise.all(promises);\n    return decCollections.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n  }\n\n  async get(id: string): Promise<Collection> {\n    return (\n      (await firstValueFrom(\n        this.encryptedCollections$.pipe(map((cs) => cs.find((c) => c.id === id))),\n      )) ?? null\n    );\n  }\n\n  async getAll(): Promise<Collection[]> {\n    return await firstValueFrom(this.encryptedCollections$);\n  }\n\n  async getAllDecrypted(): Promise<CollectionView[]> {\n    return await firstValueFrom(this.decryptedCollections$);\n  }\n\n  async getAllNested(collections: CollectionView[] = null): Promise<TreeNode<CollectionView>[]> {\n    if (collections == null) {\n      collections = await this.getAllDecrypted();\n    }\n    const nodes: TreeNode<CollectionView>[] = [];\n    collections.forEach((c) => {\n      const collectionCopy = new CollectionView();\n      collectionCopy.id = c.id;\n      collectionCopy.organizationId = c.organizationId;\n      const parts = c.name != null ? c.name.replace(/^\\/+|\\/+$/g, \"\").split(NestingDelimiter) : [];\n      ServiceUtils.nestedTraverse(nodes, 0, parts, collectionCopy, null, NestingDelimiter);\n    });\n    return nodes;\n  }\n\n  /**\n   * @deprecated August 30 2022: Moved to new Vault Filter Service\n   * Remove when Desktop and Browser are updated\n   */\n  async getNested(id: string): Promise<TreeNode<CollectionView>> {\n    const collections = await this.getAllNested();\n    return ServiceUtils.getTreeNodeObjectFromList(collections, id) as TreeNode<CollectionView>;\n  }\n\n  async upsert(toUpdate: CollectionData | CollectionData[]): Promise<void> {\n    if (toUpdate == null) {\n      return;\n    }\n    await this.encryptedCollectionDataState.update((collections) => {\n      if (collections == null) {\n        collections = {};\n      }\n      if (Array.isArray(toUpdate)) {\n        toUpdate.forEach((c) => {\n          collections[c.id] = c;\n        });\n      } else {\n        collections[toUpdate.id] = toUpdate;\n      }\n      return collections;\n    });\n  }\n\n  async replace(collections: Record<CollectionId, CollectionData>): Promise<void> {\n    await this.encryptedCollectionDataState.update(() => collections);\n  }\n\n  async clear(userId?: UserId): Promise<any> {\n    if (userId == null) {\n      await this.encryptedCollectionDataState.update(() => null);\n      await this.decryptedCollectionDataState.forceValue(null);\n    } else {\n      await this.stateProvider.getUser(userId, ENCRYPTED_COLLECTION_DATA_KEY).update(() => null);\n    }\n  }\n\n  async delete(id: CollectionId | CollectionId[]): Promise<any> {\n    await this.encryptedCollectionDataState.update((collections) => {\n      if (collections == null) {\n        collections = {};\n      }\n      if (typeof id === \"string\") {\n        delete collections[id];\n      } else {\n        (id as CollectionId[]).forEach((i) => {\n          delete collections[i];\n        });\n      }\n      return collections;\n    });\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport {\n  FileUploadApiMethods,\n  FileUploadService,\n} from \"../../../platform/abstractions/file-upload/file-upload.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { CipherFileUploadService as CipherFileUploadServiceAbstraction } from \"../../abstractions/file-upload/cipher-file-upload.service\";\nimport { Cipher } from \"../../models/domain/cipher\";\nimport { AttachmentRequest } from \"../../models/request/attachment.request\";\nimport { AttachmentUploadDataResponse } from \"../../models/response/attachment-upload-data.response\";\nimport { CipherResponse } from \"../../models/response/cipher.response\";\n\nexport class CipherFileUploadService implements CipherFileUploadServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private fileUploadService: FileUploadService,\n  ) {}\n\n  async upload(\n    cipher: Cipher,\n    encFileName: EncString,\n    encData: EncArrayBuffer,\n    admin: boolean,\n    dataEncKey: [SymmetricCryptoKey, EncString],\n  ): Promise<CipherResponse> {\n    const request: AttachmentRequest = {\n      key: dataEncKey[1].encryptedString,\n      fileName: encFileName.encryptedString,\n      fileSize: encData.buffer.byteLength,\n      adminRequest: admin,\n    };\n\n    let response: CipherResponse;\n    try {\n      const uploadDataResponse = await this.apiService.postCipherAttachment(cipher.id, request);\n      response = admin ? uploadDataResponse.cipherMiniResponse : uploadDataResponse.cipherResponse;\n      await this.fileUploadService.upload(\n        uploadDataResponse,\n        encFileName,\n        encData,\n        this.generateMethods(uploadDataResponse, response, request.adminRequest),\n      );\n    } catch (e) {\n      if (\n        (e instanceof ErrorResponse && (e as ErrorResponse).statusCode === 404) ||\n        (e as ErrorResponse).statusCode === 405\n      ) {\n        response = await this.legacyServerAttachmentFileUpload(\n          request.adminRequest,\n          cipher.id,\n          encFileName,\n          encData,\n          dataEncKey[1],\n        );\n      } else if (e instanceof ErrorResponse) {\n        throw new Error((e as ErrorResponse).getSingleMessage());\n      } else {\n        throw e;\n      }\n    }\n    return response;\n  }\n\n  private generateMethods(\n    uploadData: AttachmentUploadDataResponse,\n    response: CipherResponse,\n    isAdmin: boolean,\n  ): FileUploadApiMethods {\n    return {\n      postDirect: this.generatePostDirectCallback(uploadData, isAdmin),\n      renewFileUploadUrl: this.generateRenewFileUploadUrlCallback(uploadData, response, isAdmin),\n      rollback: this.generateRollbackCallback(response, uploadData, isAdmin),\n    };\n  }\n\n  private generatePostDirectCallback(uploadData: AttachmentUploadDataResponse, isAdmin: boolean) {\n    return (data: FormData) => {\n      const response = isAdmin ? uploadData.cipherMiniResponse : uploadData.cipherResponse;\n      return this.apiService.postAttachmentFile(response.id, uploadData.attachmentId, data);\n    };\n  }\n\n  private generateRenewFileUploadUrlCallback(\n    uploadData: AttachmentUploadDataResponse,\n    response: CipherResponse,\n    isAdmin: boolean,\n  ) {\n    return async () => {\n      const renewResponse = await this.apiService.renewAttachmentUploadUrl(\n        response.id,\n        uploadData.attachmentId,\n      );\n      return renewResponse?.url;\n    };\n  }\n\n  private generateRollbackCallback(\n    response: CipherResponse,\n    uploadData: AttachmentUploadDataResponse,\n    isAdmin: boolean,\n  ) {\n    return () => {\n      if (isAdmin) {\n        return this.apiService.deleteCipherAttachmentAdmin(response.id, uploadData.attachmentId);\n      } else {\n        return this.apiService.deleteCipherAttachment(response.id, uploadData.attachmentId);\n      }\n    };\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async legacyServerAttachmentFileUpload(\n    admin: boolean,\n    cipherId: string,\n    encFileName: EncString,\n    encData: EncArrayBuffer,\n    key: EncString,\n  ) {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"key\", key.encryptedString);\n      fd.append(\"data\", blob, encFileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"key\", key.encryptedString);\n        fd.append(\n          \"data\",\n          Buffer.from(encData.buffer) as any,\n          {\n            filepath: encFileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    let response: CipherResponse;\n    try {\n      if (admin) {\n        response = await this.apiService.postCipherAttachmentAdminLegacy(cipherId, fd);\n      } else {\n        response = await this.apiService.postCipherAttachmentLegacy(cipherId, fd);\n      }\n    } catch (e) {\n      throw new Error((e as ErrorResponse).getSingleMessage());\n    }\n\n    return response;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { FolderResponse } from \"../response/folder.response\";\n\nexport class FolderData {\n  id: string;\n  name: string;\n  revisionDate: string;\n\n  constructor(response: Partial<FolderResponse>) {\n    this.name = response?.name;\n    this.id = response?.id;\n    this.revisionDate = response?.revisionDate;\n  }\n\n  static fromJSON(obj: Jsonify<FolderData>) {\n    return Object.assign(new FolderData({}), obj);\n  }\n}\n","import { Folder } from \"../domain/folder\";\n\nexport class FolderRequest {\n  name: string;\n\n  constructor(folder: Folder) {\n    this.name = folder.name ? folder.name.encryptedString : null;\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { FolderApiServiceAbstraction } from \"../../../vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { Folder } from \"../../../vault/models/domain/folder\";\nimport { FolderRequest } from \"../../../vault/models/request/folder.request\";\nimport { FolderResponse } from \"../../../vault/models/response/folder.response\";\n\nexport class FolderApiService implements FolderApiServiceAbstraction {\n  constructor(\n    private folderService: InternalFolderService,\n    private apiService: ApiService,\n  ) {}\n\n  async save(folder: Folder): Promise<any> {\n    const request = new FolderRequest(folder);\n\n    let response: FolderResponse;\n    if (folder.id == null) {\n      response = await this.postFolder(request);\n      folder.id = response.id;\n    } else {\n      response = await this.putFolder(folder.id, request);\n    }\n\n    const data = new FolderData(response);\n    await this.folderService.upsert(data);\n  }\n\n  async delete(id: string): Promise<any> {\n    await this.deleteFolder(id);\n    await this.folderService.delete(id);\n  }\n\n  async get(id: string): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"GET\", \"/folders/\" + id, null, true, true);\n    return new FolderResponse(r);\n  }\n\n  private async postFolder(request: FolderRequest): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"POST\", \"/folders\", request, true, true);\n    return new FolderResponse(r);\n  }\n\n  async putFolder(id: string, request: FolderRequest): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"PUT\", \"/folders/\" + id, request, true, true);\n    return new FolderResponse(r);\n  }\n\n  private deleteFolder(id: string): Promise<any> {\n    return this.apiService.send(\"DELETE\", \"/folders/\" + id, null, true, false);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { Folder } from \"../domain/folder\";\nimport { ITreeNodeObject } from \"../domain/tree-node\";\n\nexport class FolderView implements View, ITreeNodeObject {\n  id: string = null;\n  name: string = null;\n  revisionDate: Date = null;\n\n  constructor(f?: Folder) {\n    if (!f) {\n      return;\n    }\n\n    this.id = f.id;\n    this.revisionDate = f.revisionDate;\n  }\n\n  static fromJSON(obj: Jsonify<FolderView>) {\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    return Object.assign(new FolderView(), obj, { revisionDate });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { FolderData } from \"../data/folder.data\";\nimport { FolderView } from \"../view/folder.view\";\n\nexport class Folder extends Domain {\n  id: string;\n  name: EncString;\n  revisionDate: Date;\n\n  constructor(obj?: FolderData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        name: null,\n      },\n      [\"id\"],\n    );\n\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n  }\n\n  decrypt(): Promise<FolderView> {\n    return this.decryptObj(\n      new FolderView(this),\n      {\n        name: null,\n      },\n      null,\n    );\n  }\n\n  static fromJSON(obj: Jsonify<Folder>) {\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    return Object.assign(new Folder(), obj, { name: EncString.fromJSON(obj.name), revisionDate });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { DeriveDefinition, FOLDER_DISK, UserKeyDefinition } from \"../../../platform/state\";\nimport { FolderService } from \"../../abstractions/folder/folder.service.abstraction\";\nimport { FolderData } from \"../../models/data/folder.data\";\nimport { Folder } from \"../../models/domain/folder\";\nimport { FolderView } from \"../../models/view/folder.view\";\n\nexport const FOLDER_ENCRYPTED_FOLDERS = UserKeyDefinition.record<FolderData>(\n  FOLDER_DISK,\n  \"folders\",\n  {\n    deserializer: (obj: Jsonify<FolderData>) => FolderData.fromJSON(obj),\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const FOLDER_DECRYPTED_FOLDERS = DeriveDefinition.from<\n  Record<string, FolderData>,\n  FolderView[],\n  { folderService: FolderService; cryptoService: CryptoService }\n>(FOLDER_ENCRYPTED_FOLDERS, {\n  deserializer: (obj) => obj.map((f) => FolderView.fromJSON(f)),\n  derive: async (from, { folderService, cryptoService }) => {\n    const folders = Object.values(from || {}).map((f) => new Folder(f));\n\n    if (await cryptoService.hasUserKey()) {\n      return await folderService.decryptFolders(folders);\n    } else {\n      return [];\n    }\n  },\n});\n","import { Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { ActiveUserState, DerivedState, StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { CipherService } from \"../../../vault/abstractions/cipher.service\";\nimport { InternalFolderService as InternalFolderServiceAbstraction } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { Folder } from \"../../../vault/models/domain/folder\";\nimport { FolderView } from \"../../../vault/models/view/folder.view\";\nimport { Cipher } from \"../../models/domain/cipher\";\nimport { FOLDER_DECRYPTED_FOLDERS, FOLDER_ENCRYPTED_FOLDERS } from \"../key-state/folder.state\";\n\nexport class FolderService implements InternalFolderServiceAbstraction {\n  folders$: Observable<Folder[]>;\n  folderViews$: Observable<FolderView[]>;\n\n  private encryptedFoldersState: ActiveUserState<Record<string, FolderData>>;\n  private decryptedFoldersState: DerivedState<FolderView[]>;\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    private cipherService: CipherService,\n    private stateProvider: StateProvider,\n  ) {\n    this.encryptedFoldersState = this.stateProvider.getActive(FOLDER_ENCRYPTED_FOLDERS);\n    this.decryptedFoldersState = this.stateProvider.getDerived(\n      this.encryptedFoldersState.state$,\n      FOLDER_DECRYPTED_FOLDERS,\n      { folderService: this, cryptoService: this.cryptoService },\n    );\n\n    this.folders$ = this.encryptedFoldersState.state$.pipe(\n      map((folderData) => Object.values(folderData).map((f) => new Folder(f))),\n    );\n\n    this.folderViews$ = this.decryptedFoldersState.state$;\n  }\n\n  async clearCache(): Promise<void> {\n    await this.decryptedFoldersState.forceValue([]);\n  }\n\n  // TODO: This should be moved to EncryptService or something\n  async encrypt(model: FolderView, key?: SymmetricCryptoKey): Promise<Folder> {\n    const folder = new Folder();\n    folder.id = model.id;\n    folder.name = await this.cryptoService.encrypt(model.name, key);\n    return folder;\n  }\n\n  async get(id: string): Promise<Folder> {\n    const folders = await firstValueFrom(this.folders$);\n\n    return folders.find((folder) => folder.id === id);\n  }\n\n  async getAllFromState(): Promise<Folder[]> {\n    return await firstValueFrom(this.folders$);\n  }\n\n  /**\n   * @deprecated For the CLI only\n   * @param id id of the folder\n   */\n  async getFromState(id: string): Promise<Folder> {\n    const folder = await this.get(id);\n    if (!folder) {\n      return null;\n    }\n\n    return folder;\n  }\n\n  /**\n   * @deprecated Only use in CLI!\n   */\n  async getAllDecryptedFromState(): Promise<FolderView[]> {\n    return await firstValueFrom(this.folderViews$);\n  }\n\n  async upsert(folderData: FolderData | FolderData[]): Promise<void> {\n    await this.encryptedFoldersState.update((folders) => {\n      if (folders == null) {\n        folders = {};\n      }\n\n      if (folderData instanceof FolderData) {\n        const f = folderData as FolderData;\n        folders[f.id] = f;\n      } else {\n        (folderData as FolderData[]).forEach((f) => {\n          folders[f.id] = f;\n        });\n      }\n\n      return folders;\n    });\n  }\n\n  async replace(folders: { [id: string]: FolderData }): Promise<void> {\n    if (!folders) {\n      return;\n    }\n\n    await this.encryptedFoldersState.update(() => {\n      const newFolders: Record<string, FolderData> = { ...folders };\n      return newFolders;\n    });\n  }\n\n  async clear(userId?: UserId): Promise<void> {\n    if (userId == null) {\n      await this.encryptedFoldersState.update(() => ({}));\n      await this.decryptedFoldersState.forceValue([]);\n    } else {\n      await this.stateProvider.getUser(userId, FOLDER_ENCRYPTED_FOLDERS).update(() => ({}));\n    }\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    await this.encryptedFoldersState.update((folders) => {\n      if (folders == null) {\n        return;\n      }\n\n      if (typeof id === \"string\") {\n        if (folders[id] == null) {\n          return;\n        }\n        delete folders[id];\n      } else {\n        (id as string[]).forEach((i) => {\n          delete folders[i];\n        });\n      }\n      return folders;\n    });\n\n    // Items in a deleted folder are re-assigned to \"No Folder\"\n    const ciphers = await this.cipherService.getAll();\n    if (ciphers != null) {\n      const updates: Cipher[] = [];\n      for (const cId in ciphers) {\n        if (ciphers[cId].folderId === id) {\n          ciphers[cId].folderId = null;\n          updates.push(ciphers[cId]);\n        }\n      }\n      if (updates.length > 0) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.cipherService.upsert(updates.map((c) => c.toCipherData()));\n      }\n    }\n  }\n\n  async decryptFolders(folders: Folder[]) {\n    const decryptFolderPromises = folders.map((f) => f.decrypt());\n    const decryptedFolders = await Promise.all(decryptFolderPromises);\n\n    decryptedFolders.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n\n    const noneFolder = new FolderView();\n    noneFolder.name = this.i18nService.t(\"noneFolder\");\n    decryptedFolders.push(noneFolder);\n    return decryptedFolders;\n  }\n}\n","import { Subject } from \"rxjs\";\n\nimport { SyncNotifierService as SyncNotifierServiceAbstraction } from \"../../abstractions/sync/sync-notifier.service.abstraction\";\nimport { SyncEventArgs } from \"../../types/sync-event-args\";\n\n/**\n * This class should most likely have 0 dependencies because it will hopefully\n * be rolled into SyncService once upon a time.\n */\nexport class SyncNotifierService implements SyncNotifierServiceAbstraction {\n  private _sync = new Subject<SyncEventArgs>();\n\n  sync$ = this._sync.asObservable();\n\n  next(event: SyncEventArgs): void {\n    this._sync.next(event);\n  }\n}\n","import { ProviderStatusType, ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { ProfileProviderResponse } from \"../response/profile-provider.response\";\n\nexport class ProviderData {\n  id: string;\n  name: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  userId: string;\n  useEvents: boolean;\n  providerStatus: ProviderStatusType;\n\n  constructor(response: ProfileProviderResponse) {\n    this.id = response.id;\n    this.name = response.name;\n    this.status = response.status;\n    this.type = response.type;\n    this.enabled = response.enabled;\n    this.userId = response.userId;\n    this.useEvents = response.useEvents;\n    this.providerStatus = response.providerStatus;\n  }\n}\n","import { firstValueFrom, map, of, switchMap } from \"rxjs\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport {\n  SyncCipherNotification,\n  SyncFolderNotification,\n  SyncSendNotification,\n} from \"../../models/response/notification.response\";\nimport { SendData } from \"../../tools/send/models/data/send.data\";\nimport { SendApiService } from \"../../tools/send/services/send-api.service.abstraction\";\nimport { InternalSendService } from \"../../tools/send/services/send.service.abstraction\";\nimport { CipherService } from \"../../vault/abstractions/cipher.service\";\nimport { CollectionService } from \"../../vault/abstractions/collection.service\";\nimport { FolderApiServiceAbstraction } from \"../../vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"../../vault/abstractions/folder/folder.service.abstraction\";\nimport { SyncService } from \"../../vault/abstractions/sync/sync.service.abstraction\";\nimport { CipherData } from \"../../vault/models/data/cipher.data\";\nimport { FolderData } from \"../../vault/models/data/folder.data\";\nimport { LogService } from \"../abstractions/log.service\";\nimport { StateService } from \"../abstractions/state.service\";\nimport { MessageSender } from \"../messaging\";\n\n/**\n * Core SyncService Logic EXCEPT for fullSync so that implementations can differ.\n */\nexport abstract class CoreSyncService implements SyncService {\n  syncInProgress = false;\n\n  constructor(\n    protected readonly stateService: StateService,\n    protected readonly folderService: InternalFolderService,\n    protected readonly folderApiService: FolderApiServiceAbstraction,\n    protected readonly messageSender: MessageSender,\n    protected readonly logService: LogService,\n    protected readonly cipherService: CipherService,\n    protected readonly collectionService: CollectionService,\n    protected readonly apiService: ApiService,\n    protected readonly accountService: AccountService,\n    protected readonly authService: AuthService,\n    protected readonly sendService: InternalSendService,\n    protected readonly sendApiService: SendApiService,\n  ) {}\n\n  abstract fullSync(forceSync: boolean, allowThrowOnError?: boolean): Promise<boolean>;\n\n  async getLastSync(): Promise<Date> {\n    if ((await this.stateService.getUserId()) == null) {\n      return null;\n    }\n\n    const lastSync = await this.stateService.getLastSync();\n    if (lastSync) {\n      return new Date(lastSync);\n    }\n\n    return null;\n  }\n\n  async setLastSync(date: Date, userId?: string): Promise<any> {\n    await this.stateService.setLastSync(date.toJSON(), { userId: userId });\n  }\n\n  async syncUpsertFolder(notification: SyncFolderNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      try {\n        const localFolder = await this.folderService.get(notification.id);\n        if (\n          (!isEdit && localFolder == null) ||\n          (isEdit && localFolder != null && localFolder.revisionDate < notification.revisionDate)\n        ) {\n          const remoteFolder = await this.folderApiService.get(notification.id);\n          if (remoteFolder != null) {\n            await this.folderService.upsert(new FolderData(remoteFolder));\n            this.messageSender.send(\"syncedUpsertedFolder\", { folderId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteFolder(notification: SyncFolderNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.folderService.delete(notification.id);\n      this.messageSender.send(\"syncedDeletedFolder\", { folderId: notification.id });\n      this.syncCompleted(true);\n      return true;\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncUpsertCipher(notification: SyncCipherNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      try {\n        let shouldUpdate = true;\n        const localCipher = await this.cipherService.get(notification.id);\n        if (localCipher != null && localCipher.revisionDate >= notification.revisionDate) {\n          shouldUpdate = false;\n        }\n\n        let checkCollections = false;\n        if (shouldUpdate) {\n          if (isEdit) {\n            shouldUpdate = localCipher != null;\n            checkCollections = true;\n          } else {\n            if (notification.collectionIds == null || notification.organizationId == null) {\n              shouldUpdate = localCipher == null;\n            } else {\n              shouldUpdate = false;\n              checkCollections = true;\n            }\n          }\n        }\n\n        if (\n          !shouldUpdate &&\n          checkCollections &&\n          notification.organizationId != null &&\n          notification.collectionIds != null &&\n          notification.collectionIds.length > 0\n        ) {\n          const collections = await this.collectionService.getAll();\n          if (collections != null) {\n            for (let i = 0; i < collections.length; i++) {\n              if (notification.collectionIds.indexOf(collections[i].id) > -1) {\n                shouldUpdate = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (shouldUpdate) {\n          const remoteCipher = await this.apiService.getFullCipherDetails(notification.id);\n          if (remoteCipher != null) {\n            await this.cipherService.upsert(new CipherData(remoteCipher));\n            this.messageSender.send(\"syncedUpsertedCipher\", { cipherId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        if (e != null && e.statusCode === 404 && isEdit) {\n          await this.cipherService.delete(notification.id);\n          this.messageSender.send(\"syncedDeletedCipher\", { cipherId: notification.id });\n          return this.syncCompleted(true);\n        }\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteCipher(notification: SyncCipherNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.cipherService.delete(notification.id);\n      this.messageSender.send(\"syncedDeletedCipher\", { cipherId: notification.id });\n      return this.syncCompleted(true);\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncUpsertSend(notification: SyncSendNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    const [activeUserId, status] = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(\n        switchMap((a) => {\n          if (a == null) {\n            of([null, AuthenticationStatus.LoggedOut]);\n          }\n          return this.authService.authStatusFor$(a.id).pipe(map((s) => [a.id, s]));\n        }),\n      ),\n    );\n    // Process only notifications for currently active user when user is not logged out\n    // TODO: once send service allows data manipulation of non-active users, this should process any received notification\n    if (activeUserId === notification.userId && status !== AuthenticationStatus.LoggedOut) {\n      try {\n        const localSend = await firstValueFrom(this.sendService.get$(notification.id));\n        if (\n          (!isEdit && localSend == null) ||\n          (isEdit && localSend != null && localSend.revisionDate < notification.revisionDate)\n        ) {\n          const remoteSend = await this.sendApiService.getSend(notification.id);\n          if (remoteSend != null) {\n            await this.sendService.upsert(new SendData(remoteSend));\n            this.messageSender.send(\"syncedUpsertedSend\", { sendId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteSend(notification: SyncSendNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.sendService.delete(notification.id);\n      this.messageSender.send(\"syncedDeletedSend\", { sendId: notification.id });\n      this.syncCompleted(true);\n      return true;\n    }\n    return this.syncCompleted(false);\n  }\n\n  // Helpers\n\n  protected syncStarted() {\n    this.syncInProgress = true;\n    this.messageSender.send(\"syncStarted\");\n  }\n\n  protected syncCompleted(successfully: boolean): boolean {\n    this.syncInProgress = false;\n    this.messageSender.send(\"syncCompleted\", { successfully: successfully });\n    return successfully;\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { LogoutReason, UserDecryptionOptionsServiceAbstraction } from \"@bitwarden/auth/common\";\n\nimport { ApiService } from \"../../../abstractions/api.service\";\nimport { InternalOrganizationServiceAbstraction } from \"../../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { InternalPolicyService } from \"../../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { ProviderService } from \"../../../admin-console/abstractions/provider.service\";\nimport { OrganizationUserType } from \"../../../admin-console/enums\";\nimport { OrganizationData } from \"../../../admin-console/models/data/organization.data\";\nimport { PolicyData } from \"../../../admin-console/models/data/policy.data\";\nimport { ProviderData } from \"../../../admin-console/models/data/provider.data\";\nimport { PolicyResponse } from \"../../../admin-console/models/response/policy.response\";\nimport { AccountService } from \"../../../auth/abstractions/account.service\";\nimport { AuthService } from \"../../../auth/abstractions/auth.service\";\nimport { AvatarService } from \"../../../auth/abstractions/avatar.service\";\nimport { KeyConnectorService } from \"../../../auth/abstractions/key-connector.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../../../auth/abstractions/master-password.service.abstraction\";\nimport { TokenService } from \"../../../auth/abstractions/token.service\";\nimport { ForceSetPasswordReason } from \"../../../auth/models/domain/force-set-password-reason\";\nimport { DomainSettingsService } from \"../../../autofill/services/domain-settings.service\";\nimport { BillingAccountProfileStateService } from \"../../../billing/abstractions/account/billing-account-profile-state.service\";\nimport { DomainsResponse } from \"../../../models/response/domains.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { LogService } from \"../../../platform/abstractions/log.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { MessageSender } from \"../../../platform/messaging\";\nimport { sequentialize } from \"../../../platform/misc/sequentialize\";\nimport { CoreSyncService } from \"../../../platform/sync/core-sync.service\";\nimport { SendData } from \"../../../tools/send/models/data/send.data\";\nimport { SendResponse } from \"../../../tools/send/models/response/send.response\";\nimport { SendApiService } from \"../../../tools/send/services/send-api.service.abstraction\";\nimport { InternalSendService } from \"../../../tools/send/services/send.service.abstraction\";\nimport { UserId } from \"../../../types/guid\";\nimport { CipherService } from \"../../../vault/abstractions/cipher.service\";\nimport { FolderApiServiceAbstraction } from \"../../../vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherData } from \"../../../vault/models/data/cipher.data\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { CipherResponse } from \"../../../vault/models/response/cipher.response\";\nimport { FolderResponse } from \"../../../vault/models/response/folder.response\";\nimport { CollectionService } from \"../../abstractions/collection.service\";\nimport { CollectionData } from \"../../models/data/collection.data\";\nimport { CollectionDetailsResponse } from \"../../models/response/collection.response\";\n\nexport class SyncService extends CoreSyncService {\n  constructor(\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    accountService: AccountService,\n    apiService: ApiService,\n    private domainSettingsService: DomainSettingsService,\n    folderService: InternalFolderService,\n    cipherService: CipherService,\n    private cryptoService: CryptoService,\n    collectionService: CollectionService,\n    messageSender: MessageSender,\n    private policyService: InternalPolicyService,\n    sendService: InternalSendService,\n    logService: LogService,\n    private keyConnectorService: KeyConnectorService,\n    stateService: StateService,\n    private providerService: ProviderService,\n    folderApiService: FolderApiServiceAbstraction,\n    private organizationService: InternalOrganizationServiceAbstraction,\n    sendApiService: SendApiService,\n    private userDecryptionOptionsService: UserDecryptionOptionsServiceAbstraction,\n    private avatarService: AvatarService,\n    private logoutCallback: (logoutReason: LogoutReason, userId?: UserId) => Promise<void>,\n    private billingAccountProfileStateService: BillingAccountProfileStateService,\n    private tokenService: TokenService,\n    authService: AuthService,\n  ) {\n    super(\n      stateService,\n      folderService,\n      folderApiService,\n      messageSender,\n      logService,\n      cipherService,\n      collectionService,\n      apiService,\n      accountService,\n      authService,\n      sendService,\n      sendApiService,\n    );\n  }\n\n  @sequentialize(() => \"fullSync\")\n  override async fullSync(forceSync: boolean, allowThrowOnError = false): Promise<boolean> {\n    this.syncStarted();\n    const isAuthenticated = await this.stateService.getIsAuthenticated();\n    if (!isAuthenticated) {\n      return this.syncCompleted(false);\n    }\n\n    const now = new Date();\n    let needsSync = false;\n    try {\n      needsSync = await this.needsSyncing(forceSync);\n    } catch (e) {\n      if (allowThrowOnError) {\n        this.syncCompleted(false);\n        throw e;\n      }\n    }\n\n    if (!needsSync) {\n      await this.setLastSync(now);\n      return this.syncCompleted(false);\n    }\n\n    try {\n      await this.apiService.refreshIdentityToken();\n      const response = await this.apiService.getSync();\n\n      await this.syncProfile(response.profile);\n      await this.syncFolders(response.folders);\n      await this.syncCollections(response.collections);\n      await this.syncCiphers(response.ciphers);\n      await this.syncSends(response.sends);\n      await this.syncSettings(response.domains);\n      await this.syncPolicies(response.policies);\n\n      await this.setLastSync(now);\n      return this.syncCompleted(true);\n    } catch (e) {\n      if (allowThrowOnError) {\n        this.syncCompleted(false);\n        throw e;\n      } else {\n        return this.syncCompleted(false);\n      }\n    }\n  }\n\n  private async needsSyncing(forceSync: boolean) {\n    if (forceSync) {\n      return true;\n    }\n\n    const lastSync = await this.getLastSync();\n    if (lastSync == null || lastSync.getTime() === 0) {\n      return true;\n    }\n\n    const response = await this.apiService.getAccountRevisionDate();\n    if (response < 0 && this.logoutCallback) {\n      // Account was deleted, log out now\n      await this.logoutCallback(\"accountDeleted\");\n    }\n\n    if (new Date(response) <= lastSync) {\n      return false;\n    }\n    return true;\n  }\n\n  private async syncProfile(response: ProfileResponse) {\n    const stamp = await this.tokenService.getSecurityStamp(response.id);\n    if (stamp != null && stamp !== response.securityStamp) {\n      if (this.logoutCallback != null) {\n        await this.logoutCallback(\"invalidSecurityStamp\");\n      }\n\n      throw new Error(\"Stamp has changed\");\n    }\n\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n    await this.cryptoService.setPrivateKey(response.privateKey, response.id);\n    await this.cryptoService.setProviderKeys(response.providers, response.id);\n    await this.cryptoService.setOrgKeys(\n      response.organizations,\n      response.providerOrganizations,\n      response.id,\n    );\n    await this.avatarService.setSyncAvatarColor(response.id, response.avatarColor);\n    await this.tokenService.setSecurityStamp(response.securityStamp, response.id);\n    await this.accountService.setAccountEmailVerified(response.id, response.emailVerified);\n\n    await this.billingAccountProfileStateService.setHasPremium(\n      response.premiumPersonally,\n      response.premiumFromOrganization,\n    );\n    await this.keyConnectorService.setUsesKeyConnector(response.usesKeyConnector);\n\n    await this.setForceSetPasswordReasonIfNeeded(response);\n\n    const providers: { [id: string]: ProviderData } = {};\n    response.providers.forEach((p) => {\n      providers[p.id] = new ProviderData(p);\n    });\n\n    await this.providerService.save(providers);\n\n    await this.syncProfileOrganizations(response);\n\n    if (await this.keyConnectorService.userNeedsMigration()) {\n      await this.keyConnectorService.setConvertAccountRequired(true);\n      this.messageSender.send(\"convertAccountToKeyConnector\");\n    } else {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.keyConnectorService.removeConvertAccountRequired();\n    }\n  }\n\n  private async setForceSetPasswordReasonIfNeeded(profileResponse: ProfileResponse) {\n    // The `forcePasswordReset` flag indicates an admin has reset the user's password and must be updated\n    if (profileResponse.forcePasswordReset) {\n      await this.masterPasswordService.setForceSetPasswordReason(\n        ForceSetPasswordReason.AdminForcePasswordReset,\n        profileResponse.id,\n      );\n    }\n\n    const userDecryptionOptions = await firstValueFrom(\n      this.userDecryptionOptionsService.userDecryptionOptionsById$(profileResponse.id),\n    );\n\n    if (userDecryptionOptions === null || userDecryptionOptions === undefined) {\n      this.logService.error(\"Sync: Account decryption options are null or undefined.\");\n    }\n\n    // Even though TDE users should only be in a single org (per single org policy), check\n    // through all orgs for the manageResetPassword permission. If they have it in any org,\n    // they should be forced to set a password.\n    let hasManageResetPasswordPermission = false;\n    for (const org of profileResponse.organizations) {\n      const isAdmin = org.type === OrganizationUserType.Admin;\n      const isOwner = org.type === OrganizationUserType.Owner;\n\n      // Note: apparently permissions only come down populated for custom roles.\n      if (isAdmin || isOwner || (org.permissions && org.permissions.manageResetPassword)) {\n        hasManageResetPasswordPermission = true;\n        break;\n      }\n    }\n\n    if (\n      userDecryptionOptions.trustedDeviceOption !== undefined &&\n      !userDecryptionOptions.hasMasterPassword &&\n      hasManageResetPasswordPermission\n    ) {\n      // TDE user w/out MP went from having no password reset permission to having it.\n      // Must set the force password reset reason so the auth guard will redirect to the set password page.\n      const userId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n      await this.masterPasswordService.setForceSetPasswordReason(\n        ForceSetPasswordReason.TdeUserWithoutPasswordHasPasswordResetPermission,\n        userId,\n      );\n    }\n  }\n\n  private async syncProfileOrganizations(response: ProfileResponse) {\n    const organizations: { [id: string]: OrganizationData } = {};\n    response.organizations.forEach((o) => {\n      organizations[o.id] = new OrganizationData(o, {\n        isMember: true,\n        isProviderUser: false,\n      });\n    });\n\n    response.providerOrganizations.forEach((o) => {\n      if (organizations[o.id] == null) {\n        organizations[o.id] = new OrganizationData(o, {\n          isMember: false,\n          isProviderUser: true,\n        });\n      } else {\n        organizations[o.id].isProviderUser = true;\n      }\n    });\n\n    await this.organizationService.replace(organizations);\n  }\n\n  private async syncFolders(response: FolderResponse[]) {\n    const folders: { [id: string]: FolderData } = {};\n    response.forEach((f) => {\n      folders[f.id] = new FolderData(f);\n    });\n    return await this.folderService.replace(folders);\n  }\n\n  private async syncCollections(response: CollectionDetailsResponse[]) {\n    const collections: { [id: string]: CollectionData } = {};\n    response.forEach((c) => {\n      collections[c.id] = new CollectionData(c);\n    });\n    return await this.collectionService.replace(collections);\n  }\n\n  private async syncCiphers(response: CipherResponse[]) {\n    const ciphers: { [id: string]: CipherData } = {};\n    response.forEach((c) => {\n      ciphers[c.id] = new CipherData(c);\n    });\n    return await this.cipherService.replace(ciphers);\n  }\n\n  private async syncSends(response: SendResponse[]) {\n    const sends: { [id: string]: SendData } = {};\n    response.forEach((s) => {\n      sends[s.id] = new SendData(s);\n    });\n    return await this.sendService.replace(sends);\n  }\n\n  private async syncSettings(response: DomainsResponse) {\n    let eqDomains: string[][] = [];\n    if (response != null && response.equivalentDomains != null) {\n      eqDomains = eqDomains.concat(response.equivalentDomains);\n    }\n\n    if (response != null && response.globalEquivalentDomains != null) {\n      response.globalEquivalentDomains.forEach((global) => {\n        if (global.domains.length > 0) {\n          eqDomains.push(global.domains);\n        }\n      });\n    }\n\n    return this.domainSettingsService.setEquivalentDomains(eqDomains);\n  }\n\n  private async syncPolicies(response: PolicyResponse[]) {\n    const policies: { [id: string]: PolicyData } = {};\n    if (response != null) {\n      response.forEach((p) => {\n        policies[p.id] = new PolicyData(p);\n      });\n    }\n    return await this.policyService.replace(policies);\n  }\n}\n","import { CryptoFunctionService } from \"../../platform/abstractions/crypto-function.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { TotpService as TotpServiceAbstraction } from \"../abstractions/totp.service\";\n\nconst B32Chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\nconst SteamChars = \"23456789BCDFGHJKMNPQRTVWXY\";\n\nexport class TotpService implements TotpServiceAbstraction {\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private logService: LogService,\n  ) {}\n\n  async getCode(key: string): Promise<string> {\n    if (key == null) {\n      return null;\n    }\n    let period = 30;\n    let alg: \"sha1\" | \"sha256\" | \"sha512\" = \"sha1\";\n    let digits = 6;\n    let keyB32 = key;\n    const isOtpAuth = key.toLowerCase().indexOf(\"otpauth://\") === 0;\n    const isSteamAuth = !isOtpAuth && key.toLowerCase().indexOf(\"steam://\") === 0;\n    if (isOtpAuth) {\n      const params = Utils.getQueryParams(key);\n      if (params.has(\"digits\") && params.get(\"digits\") != null) {\n        try {\n          const digitParams = parseInt(params.get(\"digits\").trim(), null);\n          if (digitParams > 10) {\n            digits = 10;\n          } else if (digitParams > 0) {\n            digits = digitParams;\n          }\n        } catch {\n          this.logService.error(\"Invalid digits param.\");\n        }\n      }\n      if (params.has(\"period\") && params.get(\"period\") != null) {\n        try {\n          const periodParam = parseInt(params.get(\"period\").trim(), null);\n          if (periodParam > 0) {\n            period = periodParam;\n          }\n        } catch {\n          this.logService.error(\"Invalid period param.\");\n        }\n      }\n      if (params.has(\"secret\") && params.get(\"secret\") != null) {\n        keyB32 = params.get(\"secret\");\n      }\n      if (params.has(\"algorithm\") && params.get(\"algorithm\") != null) {\n        const algParam = params.get(\"algorithm\").toLowerCase();\n        if (algParam === \"sha1\" || algParam === \"sha256\" || algParam === \"sha512\") {\n          alg = algParam;\n        }\n      }\n    } else if (isSteamAuth) {\n      keyB32 = key.substr(\"steam://\".length);\n      digits = 5;\n    }\n\n    const epoch = Math.round(new Date().getTime() / 1000.0);\n    const timeHex = this.leftPad(this.decToHex(Math.floor(epoch / period)), 16, \"0\");\n    const timeBytes = Utils.fromHexToArray(timeHex);\n    const keyBytes = this.b32ToBytes(keyB32);\n\n    if (!keyBytes.length || !timeBytes.length) {\n      return null;\n    }\n\n    const hash = await this.sign(keyBytes, timeBytes, alg);\n    if (hash.length === 0) {\n      return null;\n    }\n\n    const offset = hash[hash.length - 1] & 0xf;\n    const binary =\n      ((hash[offset] & 0x7f) << 24) |\n      ((hash[offset + 1] & 0xff) << 16) |\n      ((hash[offset + 2] & 0xff) << 8) |\n      (hash[offset + 3] & 0xff);\n\n    let otp = \"\";\n    if (isSteamAuth) {\n      let fullCode = binary & 0x7fffffff;\n      for (let i = 0; i < digits; i++) {\n        otp += SteamChars[fullCode % SteamChars.length];\n        fullCode = Math.trunc(fullCode / SteamChars.length);\n      }\n    } else {\n      otp = (binary % Math.pow(10, digits)).toString();\n      otp = this.leftPad(otp, digits, \"0\");\n    }\n\n    return otp;\n  }\n\n  getTimeInterval(key: string): number {\n    let period = 30;\n    if (key != null && key.toLowerCase().indexOf(\"otpauth://\") === 0) {\n      const params = Utils.getQueryParams(key);\n      if (params.has(\"period\") && params.get(\"period\") != null) {\n        try {\n          period = parseInt(params.get(\"period\").trim(), null);\n        } catch {\n          this.logService.error(\"Invalid period param.\");\n        }\n      }\n    }\n    return period;\n  }\n\n  // Helpers\n\n  private leftPad(s: string, l: number, p: string): string {\n    if (l + 1 >= s.length) {\n      s = Array(l + 1 - s.length).join(p) + s;\n    }\n    return s;\n  }\n\n  private decToHex(d: number): string {\n    return (d < 15.5 ? \"0\" : \"\") + Math.round(d).toString(16);\n  }\n\n  private b32ToHex(s: string): string {\n    s = s.toUpperCase();\n    let cleanedInput = \"\";\n\n    for (let i = 0; i < s.length; i++) {\n      if (B32Chars.indexOf(s[i]) < 0) {\n        continue;\n      }\n\n      cleanedInput += s[i];\n    }\n    s = cleanedInput;\n\n    let bits = \"\";\n    let hex = \"\";\n    for (let i = 0; i < s.length; i++) {\n      const byteIndex = B32Chars.indexOf(s.charAt(i));\n      if (byteIndex < 0) {\n        continue;\n      }\n      bits += this.leftPad(byteIndex.toString(2), 5, \"0\");\n    }\n    for (let i = 0; i + 4 <= bits.length; i += 4) {\n      const chunk = bits.substr(i, 4);\n      hex = hex + parseInt(chunk, 2).toString(16);\n    }\n    return hex;\n  }\n\n  private b32ToBytes(s: string): Uint8Array {\n    return Utils.fromHexToArray(this.b32ToHex(s));\n  }\n\n  private async sign(\n    keyBytes: Uint8Array,\n    timeBytes: Uint8Array,\n    alg: \"sha1\" | \"sha256\" | \"sha512\",\n  ) {\n    const signature = await this.cryptoFunctionService.hmac(timeBytes, keyBytes, alg);\n    return new Uint8Array(signature);\n  }\n}\n","import { VAULT_SETTINGS_DISK, KeyDefinition, UserKeyDefinition } from \"../../../platform/state\";\n\nexport const USER_ENABLE_PASSKEYS = new KeyDefinition<boolean>(\n  VAULT_SETTINGS_DISK,\n  \"enablePasskeys\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\nexport const SHOW_CARDS_CURRENT_TAB = new UserKeyDefinition<boolean>(\n  VAULT_SETTINGS_DISK,\n  \"showCardsCurrentTab\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [], // do not clear user settings\n  },\n);\n\nexport const SHOW_IDENTITIES_CURRENT_TAB = new UserKeyDefinition<boolean>(\n  VAULT_SETTINGS_DISK,\n  \"showIdentitiesCurrentTab\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [], // do not clear user settings\n  },\n);\n","import { Observable, map } from \"rxjs\";\n\nimport { ActiveUserState, GlobalState, StateProvider } from \"../../../platform/state\";\nimport { VaultSettingsService as VaultSettingsServiceAbstraction } from \"../../abstractions/vault-settings/vault-settings.service\";\nimport {\n  SHOW_CARDS_CURRENT_TAB,\n  SHOW_IDENTITIES_CURRENT_TAB,\n  USER_ENABLE_PASSKEYS,\n} from \"../key-state/vault-settings.state\";\n\n/**\n * {@link VaultSettingsServiceAbstraction}\n */\nexport class VaultSettingsService implements VaultSettingsServiceAbstraction {\n  private enablePasskeysState: GlobalState<boolean> =\n    this.stateProvider.getGlobal(USER_ENABLE_PASSKEYS);\n  /**\n   * {@link VaultSettingsServiceAbstraction.enablePasskeys$}\n   */\n  readonly enablePasskeys$: Observable<boolean> = this.enablePasskeysState.state$.pipe(\n    map((x) => x ?? true),\n  );\n\n  private showCardsCurrentTabState: ActiveUserState<boolean> =\n    this.stateProvider.getActive(SHOW_CARDS_CURRENT_TAB);\n  /**\n   * {@link VaultSettingsServiceAbstraction.showCardsCurrentTab$}\n   */\n  readonly showCardsCurrentTab$: Observable<boolean> = this.showCardsCurrentTabState.state$.pipe(\n    map((x) => x ?? true),\n  );\n\n  private showIdentitiesCurrentTabState: ActiveUserState<boolean> = this.stateProvider.getActive(\n    SHOW_IDENTITIES_CURRENT_TAB,\n  );\n  /**\n   * {@link VaultSettingsServiceAbstraction.showIdentitiesCurrentTab$}\n   */\n  readonly showIdentitiesCurrentTab$: Observable<boolean> =\n    this.showIdentitiesCurrentTabState.state$.pipe(map((x) => x ?? true));\n\n  constructor(private stateProvider: StateProvider) {}\n\n  /**\n   * {@link VaultSettingsServiceAbstraction.setShowCardsCurrentTab}\n   */\n  async setShowCardsCurrentTab(value: boolean): Promise<void> {\n    await this.showCardsCurrentTabState.update(() => value);\n  }\n\n  /**\n   * {@link VaultSettingsServiceAbstraction.setDontShowIdentitiesCurrentTab}\n   */\n  async setShowIdentitiesCurrentTab(value: boolean): Promise<void> {\n    await this.showIdentitiesCurrentTabState.update(() => value);\n  }\n\n  /**\n   * {@link VaultSettingsServiceAbstraction.setEnablePasskeys}\n   */\n  async setEnablePasskeys(value: boolean): Promise<void> {\n    await this.enablePasskeysState.update(() => value);\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { ImportCiphersRequest } from \"@bitwarden/common/models/request/import-ciphers.request\";\nimport { ImportOrganizationCiphersRequest } from \"@bitwarden/common/models/request/import-organization-ciphers.request\";\n\nimport { ImportApiServiceAbstraction } from \"./import-api.service.abstraction\";\n\nexport class ImportApiService implements ImportApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  async postImportCiphers(request: ImportCiphersRequest): Promise<any> {\n    return await this.apiService.send(\"POST\", \"/ciphers/import\", request, true, false);\n  }\n\n  async postImportOrganizationCiphers(\n    organizationId: string,\n    request: ImportOrganizationCiphersRequest,\n  ): Promise<any> {\n    return await this.apiService.send(\n      \"POST\",\n      \"/ciphers/import-organization?organizationId=\" + organizationId,\n      request,\n      true,\n      false,\n    );\n  }\n}\n","import { CipherRequest } from \"../../vault/models/request/cipher.request\";\nimport { FolderWithIdRequest } from \"../../vault/models/request/folder-with-id.request\";\n\nimport { KvpRequest } from \"./kvp.request\";\n\nexport class ImportCiphersRequest {\n  ciphers: CipherRequest[] = [];\n  folders: FolderWithIdRequest[] = [];\n  folderRelationships: KvpRequest<number, number>[] = [];\n}\n","import { CipherRequest } from \"../../vault/models/request/cipher.request\";\nimport { CollectionWithIdRequest } from \"../../vault/models/request/collection-with-id.request\";\n\nimport { KvpRequest } from \"./kvp.request\";\n\nexport class ImportOrganizationCiphersRequest {\n  ciphers: CipherRequest[] = [];\n  collections: CollectionWithIdRequest[] = [];\n  collectionRelationships: KvpRequest<number, number>[] = [];\n}\n","export class KvpRequest<TK, TV> {\n  key: TK;\n  value: TV;\n\n  constructor(key: TK, value: TV) {\n    this.key = key;\n    this.value = value;\n  }\n}\n","import { SelectionReadOnlyRequest } from \"../../../admin-console/models/request/selection-read-only.request\";\nimport { Collection } from \"../domain/collection\";\n\nexport class CollectionRequest {\n  name: string;\n  externalId: string;\n  groups: SelectionReadOnlyRequest[] = [];\n  users: SelectionReadOnlyRequest[] = [];\n\n  constructor(collection?: Collection) {\n    if (collection == null) {\n      return;\n    }\n    this.name = collection.name ? collection.name.encryptedString : null;\n    this.externalId = collection.externalId;\n  }\n}\n","import { Collection } from \"../domain/collection\";\n\nimport { CollectionRequest } from \"./collection.request\";\n\nexport class CollectionWithIdRequest extends CollectionRequest {\n  id: string;\n\n  constructor(collection?: Collection) {\n    if (collection == null) {\n      return;\n    }\n    super(collection);\n    this.id = collection.id;\n  }\n}\n","import { Folder } from \"../domain/folder\";\n\nimport { FolderRequest } from \"./folder.request\";\n\nexport class FolderWithIdRequest extends FolderRequest {\n  id: string;\n\n  constructor(folder: Folder) {\n    super(folder);\n    this.id = folder.id;\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nexport class ImportResult {\n  success = false;\n  errorMessage: string;\n  ciphers: CipherView[] = [];\n  folders: FolderView[] = [];\n  folderRelationships: [number, number][] = [];\n  collections: CollectionView[] = [];\n  collectionRelationships: [number, number][] = [];\n}\n","import * as papa from \"papaparse\";\n\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nexport abstract class BaseImporter {\n  organizationId: string = null;\n\n  protected logService: LogService = new ConsoleLogService(false);\n\n  protected newLineRegex = /(?:\\r\\n|\\r|\\n)/;\n\n  protected passwordFieldNames = [\n    \"password\",\n    \"pass word\",\n    \"passphrase\",\n    \"pass phrase\",\n    \"pass\",\n    \"code\",\n    \"code word\",\n    \"codeword\",\n    \"secret\",\n    \"secret word\",\n    \"personpwd\",\n    \"key\",\n    \"keyword\",\n    \"key word\",\n    \"keyphrase\",\n    \"key phrase\",\n    \"form_pw\",\n    \"wppassword\",\n    \"pin\",\n    \"pwd\",\n    \"pw\",\n    \"pword\",\n    \"passwd\",\n    \"p\",\n    \"serial\",\n    \"serial#\",\n    \"license key\",\n    \"reg #\",\n\n    // Non-English names\n    \"passwort\",\n  ];\n\n  protected usernameFieldNames = [\n    \"user\",\n    \"name\",\n    \"user name\",\n    \"username\",\n    \"login name\",\n    \"email\",\n    \"e-mail\",\n    \"id\",\n    \"userid\",\n    \"user id\",\n    \"login\",\n    \"form_loginname\",\n    \"wpname\",\n    \"mail\",\n    \"loginid\",\n    \"login id\",\n    \"log\",\n    \"personlogin\",\n    \"first name\",\n    \"last name\",\n    \"card#\",\n    \"account #\",\n    \"member\",\n    \"member #\",\n\n    // Non-English names\n    \"nom\",\n    \"benutzername\",\n  ];\n\n  protected notesFieldNames = [\n    \"note\",\n    \"notes\",\n    \"comment\",\n    \"comments\",\n    \"memo\",\n    \"description\",\n    \"free form\",\n    \"freeform\",\n    \"free text\",\n    \"freetext\",\n    \"free\",\n\n    // Non-English names\n    \"kommentar\",\n  ];\n\n  protected uriFieldNames: string[] = [\n    \"url\",\n    \"hyper link\",\n    \"hyperlink\",\n    \"link\",\n    \"host\",\n    \"hostname\",\n    \"host name\",\n    \"server\",\n    \"address\",\n    \"hyper ref\",\n    \"href\",\n    \"web\",\n    \"website\",\n    \"web site\",\n    \"site\",\n    \"web-site\",\n    \"uri\",\n\n    // Non-English names\n    \"ort\",\n    \"adresse\",\n  ];\n\n  protected parseCsvOptions = {\n    encoding: \"UTF-8\",\n    skipEmptyLines: false,\n  };\n\n  protected get organization() {\n    return this.organizationId != null;\n  }\n\n  protected parseXml(data: string): Document {\n    // Ensure there are no external entity elements in the XML to prevent against XXE attacks.\n    if (!this.validateNoExternalEntities(data)) {\n      return null;\n    }\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(data, \"application/xml\");\n    return doc != null && doc.querySelector(\"parsererror\") == null ? doc : null;\n  }\n\n  protected parseCsv(data: string, header: boolean, options: any = {}): any[] {\n    const parseOptions: papa.ParseConfig<string> = Object.assign(\n      { header: header },\n      this.parseCsvOptions,\n      options,\n    );\n    data = this.splitNewLine(data).join(\"\\n\").trim();\n    const result = papa.parse(data, parseOptions);\n    if (result.errors != null && result.errors.length > 0) {\n      result.errors.forEach((e) => {\n        if (e.row != null) {\n          this.logService.warning(\"Error parsing row \" + e.row + \": \" + e.message);\n        }\n      });\n    }\n    return result.data && result.data.length > 0 ? result.data : null;\n  }\n\n  protected parseSingleRowCsv(rowData: string) {\n    if (this.isNullOrWhitespace(rowData)) {\n      return null;\n    }\n    const parsedRow = this.parseCsv(rowData, false);\n    if (parsedRow != null && parsedRow.length > 0 && parsedRow[0].length > 0) {\n      return parsedRow[0];\n    }\n    return null;\n  }\n\n  protected makeUriArray(uri: string | string[]): LoginUriView[] {\n    if (uri == null) {\n      return null;\n    }\n\n    if (typeof uri === \"string\") {\n      const loginUri = new LoginUriView();\n      loginUri.uri = this.fixUri(uri);\n      if (this.isNullOrWhitespace(loginUri.uri)) {\n        return null;\n      }\n      loginUri.match = null;\n      return [loginUri];\n    }\n\n    if (uri.length > 0) {\n      const returnArr: LoginUriView[] = [];\n      uri.forEach((u) => {\n        const loginUri = new LoginUriView();\n        loginUri.uri = this.fixUri(u);\n        if (this.isNullOrWhitespace(loginUri.uri)) {\n          return;\n        }\n        loginUri.match = null;\n        returnArr.push(loginUri);\n      });\n      return returnArr.length === 0 ? null : returnArr;\n    }\n\n    return null;\n  }\n\n  protected fixUri(uri: string) {\n    if (uri == null) {\n      return null;\n    }\n    uri = uri.trim();\n    if (uri.indexOf(\"://\") === -1 && uri.indexOf(\".\") >= 0) {\n      uri = \"http://\" + uri;\n    }\n    if (uri.length > 1000) {\n      return uri.substring(0, 1000);\n    }\n    return uri;\n  }\n\n  protected nameFromUrl(url: string) {\n    const hostname = Utils.getHostname(url);\n    if (this.isNullOrWhitespace(hostname)) {\n      return null;\n    }\n    return hostname.startsWith(\"www.\") ? hostname.replace(\"www.\", \"\") : hostname;\n  }\n\n  protected isNullOrWhitespace(str: string): boolean {\n    return Utils.isNullOrWhitespace(str);\n  }\n\n  protected getValueOrDefault(str: string, defaultValue: string = null): string {\n    if (this.isNullOrWhitespace(str)) {\n      return defaultValue;\n    }\n    return str;\n  }\n\n  protected splitNewLine(str: string): string[] {\n    return str.split(this.newLineRegex);\n  }\n\n  protected setCardExpiration(cipher: CipherView, expiration: string): boolean {\n    if (this.isNullOrWhitespace(expiration)) {\n      return false;\n    }\n\n    expiration = expiration.replace(/\\s/g, \"\");\n\n    const monthRegex = \"0?(?<month>[1-9]|1[0-2])\";\n    const yearRegex = \"(?<year>(?:[1-2][0-9])?[0-9]{2})\";\n    const expiryRegex = new RegExp(`^${monthRegex}/${yearRegex}$`);\n\n    const expiryMatch = expiration.match(expiryRegex);\n\n    if (!expiryMatch) {\n      return false;\n    }\n\n    cipher.card.expMonth = expiryMatch.groups.month;\n    const year: string = expiryMatch.groups.year;\n    cipher.card.expYear = year.length === 2 ? \"20\" + year : year;\n    return true;\n  }\n\n  protected moveFoldersToCollections(result: ImportResult) {\n    result.folderRelationships.forEach((r) => result.collectionRelationships.push(r));\n    result.collections = result.folders.map((f) => {\n      const collection = new CollectionView();\n      collection.name = f.name;\n      collection.id = f.id;\n      return collection;\n    });\n    result.folderRelationships = [];\n    result.folders = [];\n  }\n\n  protected querySelectorDirectChild(parentEl: Element, query: string) {\n    const els = this.querySelectorAllDirectChild(parentEl, query);\n    return els.length === 0 ? null : els[0];\n  }\n\n  protected querySelectorAllDirectChild(parentEl: Element, query: string) {\n    return Array.from(parentEl.querySelectorAll(query)).filter((el) => el.parentNode === parentEl);\n  }\n\n  protected initLoginCipher() {\n    const cipher = new CipherView();\n    cipher.favorite = false;\n    cipher.notes = \"\";\n    cipher.fields = [];\n    cipher.login = new LoginView();\n    cipher.type = CipherType.Login;\n    return cipher;\n  }\n\n  protected cleanupCipher(cipher: CipherView) {\n    if (cipher == null) {\n      return;\n    }\n    if (cipher.type !== CipherType.Login) {\n      cipher.login = null;\n    }\n    if (this.isNullOrWhitespace(cipher.name)) {\n      cipher.name = \"--\";\n    }\n    if (this.isNullOrWhitespace(cipher.notes)) {\n      cipher.notes = null;\n    } else {\n      cipher.notes = cipher.notes.trim();\n    }\n    if (cipher.fields != null && cipher.fields.length === 0) {\n      cipher.fields = null;\n    }\n    if (cipher.passwordHistory != null && cipher.passwordHistory.length === 0) {\n      cipher.passwordHistory = null;\n    }\n  }\n\n  protected processKvp(\n    cipher: CipherView,\n    key: string,\n    value: string,\n    type: FieldType = FieldType.Text,\n  ) {\n    if (this.isNullOrWhitespace(value)) {\n      return;\n    }\n    if (this.isNullOrWhitespace(key)) {\n      key = \"\";\n    }\n    if (value.length > 200 || value.trim().search(this.newLineRegex) > -1) {\n      if (cipher.notes == null) {\n        cipher.notes = \"\";\n      }\n      cipher.notes += key + \": \" + this.splitNewLine(value).join(\"\\n\") + \"\\n\";\n    } else {\n      if (cipher.fields == null) {\n        cipher.fields = [];\n      }\n      const field = new FieldView();\n      field.type = type;\n      field.name = key;\n      field.value = value;\n      cipher.fields.push(field);\n    }\n  }\n\n  protected processFolder(\n    result: ImportResult,\n    folderName: string,\n    addRelationship: boolean = true,\n  ) {\n    if (this.isNullOrWhitespace(folderName)) {\n      return;\n    }\n\n    let folderIndex = result.folders.length;\n    // Replace backslashes with forward slashes, ensuring we create sub-folders\n    folderName = folderName.replace(\"\\\\\", \"/\");\n    let addFolder = true;\n\n    for (let i = 0; i < result.folders.length; i++) {\n      if (result.folders[i].name === folderName) {\n        addFolder = false;\n        folderIndex = i;\n        break;\n      }\n    }\n\n    if (addFolder) {\n      const f = new FolderView();\n      f.name = folderName;\n      result.folders.push(f);\n    }\n\n    //Some folders can have sub-folders but no ciphers directly, we should not add to the folderRelationships array\n    if (addRelationship) {\n      result.folderRelationships.push([result.ciphers.length, folderIndex]);\n    }\n  }\n\n  protected convertToNoteIfNeeded(cipher: CipherView) {\n    if (\n      cipher.type === CipherType.Login &&\n      this.isNullOrWhitespace(cipher.login.username) &&\n      this.isNullOrWhitespace(cipher.login.password) &&\n      (cipher.login.uris == null || cipher.login.uris.length === 0)\n    ) {\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n    }\n  }\n\n  protected processFullName(cipher: CipherView, fullName: string) {\n    if (this.isNullOrWhitespace(fullName)) {\n      return;\n    }\n\n    const nameParts = fullName.split(\" \");\n    if (nameParts.length > 0) {\n      cipher.identity.firstName = this.getValueOrDefault(nameParts[0]);\n    }\n    if (nameParts.length === 2) {\n      cipher.identity.lastName = this.getValueOrDefault(nameParts[1]);\n    } else if (nameParts.length >= 3) {\n      cipher.identity.middleName = this.getValueOrDefault(nameParts[1]);\n      cipher.identity.lastName = nameParts.slice(2, nameParts.length).join(\" \");\n    }\n  }\n\n  private validateNoExternalEntities(data: string): boolean {\n    const regex = new RegExp(\"<!ENTITY\", \"i\");\n    const hasExternalEntities = regex.test(data);\n    return !hasExternalEntities;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class AscendoCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 2) {\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 1]);\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      if (value.length > 2 && value.length % 2 === 0) {\n        for (let i = 0; i < value.length - 2; i += 2) {\n          const val: string = value[i + 2];\n          const field: string = value[i + 1];\n          if (this.isNullOrWhitespace(val) || this.isNullOrWhitespace(field)) {\n            continue;\n          }\n\n          const fieldLower = field.toLowerCase();\n          if (cipher.login.password == null && this.passwordFieldNames.indexOf(fieldLower) > -1) {\n            cipher.login.password = this.getValueOrDefault(val);\n          } else if (\n            cipher.login.username == null &&\n            this.usernameFieldNames.indexOf(fieldLower) > -1\n          ) {\n            cipher.login.username = this.getValueOrDefault(val);\n          } else if (\n            (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n            this.uriFieldNames.indexOf(fieldLower) > -1\n          ) {\n            cipher.login.uris = this.makeUriArray(val);\n          } else {\n            this.processKvp(cipher, field, val);\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class AvastCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.login.uris = this.makeUriArray(value.web);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.username = this.getValueOrDefault(value.login);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class AvastJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results.logins != null) {\n      results.logins.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.name = this.getValueOrDefault(value.custName);\n        cipher.notes = this.getValueOrDefault(value.note);\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.password = this.getValueOrDefault(value.pwd);\n        cipher.login.username = this.getValueOrDefault(value.loginName);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (results.notes != null) {\n      results.notes.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote.type = SecureNoteType.Generic;\n        cipher.name = this.getValueOrDefault(value.label);\n        cipher.notes = this.getValueOrDefault(value.text);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (results.cards != null) {\n      results.cards.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.Card;\n        cipher.name = this.getValueOrDefault(value.custName);\n        cipher.notes = this.getValueOrDefault(value.note);\n        cipher.card.cardholderName = this.getValueOrDefault(value.holderName);\n        cipher.card.number = this.getValueOrDefault(value.cardNumber);\n        cipher.card.code = this.getValueOrDefault(value.cvv);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        if (value.expirationDate != null) {\n          if (value.expirationDate.month != null) {\n            cipher.card.expMonth = value.expirationDate.month + \"\";\n          }\n          if (value.expirationDate.year != null) {\n            cipher.card.expYear = value.expirationDate.year + \"\";\n          }\n        }\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class AviraCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(\n        value.name,\n        this.getValueOrDefault(this.nameFromUrl(value.website), \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(value.website);\n      cipher.login.password = this.getValueOrDefault(value.password);\n\n      if (\n        this.isNullOrWhitespace(value.username) &&\n        !this.isNullOrWhitespace(value.secondary_username)\n      ) {\n        cipher.login.username = value.secondary_username;\n      } else {\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.notes = this.getValueOrDefault(value.secondary_username);\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class BlackBerryCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.grouping === \"list\") {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.favorite = value.fav === \"1\";\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.notes = this.getValueOrDefault(value.extra);\n      if (value.grouping !== \"note\") {\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.username = this.getValueOrDefault(value.username);\n      }\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ChromeCsvImporter extends BaseImporter implements Importer {\n  private androidPatternRegex = new RegExp(\"^android:\\\\/\\\\/.*(?<=@)(.*)(?=\\\\/)\");\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      let name = value.name;\n      if (!name && this.androidPatternRegex.test(value.url)) {\n        name = value.url.match(this.androidPatternRegex)[1];\n      }\n      cipher.name = this.getValueOrDefault(name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class BitwardenCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.organization && !this.isNullOrWhitespace(value.collections)) {\n        const collections = (value.collections as string).split(\",\");\n        collections.forEach((col) => {\n          let addCollection = true;\n          let collectionIndex = result.collections.length;\n\n          for (let i = 0; i < result.collections.length; i++) {\n            if (result.collections[i].name === col) {\n              addCollection = false;\n              collectionIndex = i;\n              break;\n            }\n          }\n\n          if (addCollection) {\n            const collection = new CollectionView();\n            collection.name = col;\n            result.collections.push(collection);\n          }\n\n          result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n        });\n      } else if (!this.organization) {\n        this.processFolder(result, value.folder);\n      }\n\n      const cipher = new CipherView();\n      cipher.favorite =\n        !this.organization && this.getValueOrDefault(value.favorite, \"0\") !== \"0\" ? true : false;\n      cipher.type = CipherType.Login;\n      cipher.notes = this.getValueOrDefault(value.notes);\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      try {\n        cipher.reprompt = parseInt(\n          this.getValueOrDefault(value.reprompt, CipherRepromptType.None.toString()),\n          10,\n        );\n      } catch (e) {\n        // eslint-disable-next-line\n        console.error(\"Unable to parse reprompt value\", e);\n        cipher.reprompt = CipherRepromptType.None;\n      }\n\n      if (!this.isNullOrWhitespace(value.fields)) {\n        const fields = this.splitNewLine(value.fields);\n        for (let i = 0; i < fields.length; i++) {\n          if (this.isNullOrWhitespace(fields[i])) {\n            continue;\n          }\n\n          const delimPosition = fields[i].lastIndexOf(\": \");\n          if (delimPosition === -1) {\n            continue;\n          }\n\n          if (cipher.fields == null) {\n            cipher.fields = [];\n          }\n\n          const field = new FieldView();\n          field.name = fields[i].substr(0, delimPosition);\n          field.value = null;\n          field.type = FieldType.Text;\n          if (fields[i].length > delimPosition + 2) {\n            field.value = fields[i].substr(delimPosition + 2);\n          }\n          cipher.fields.push(field);\n        }\n      }\n\n      const valueType = value.type != null ? value.type.toLowerCase() : null;\n      switch (valueType) {\n        case \"note\":\n          cipher.type = CipherType.SecureNote;\n          cipher.secureNote = new SecureNoteView();\n          cipher.secureNote.type = SecureNoteType.Generic;\n          break;\n        default: {\n          cipher.type = CipherType.Login;\n          cipher.login = new LoginView();\n          cipher.login.totp = this.getValueOrDefault(value.login_totp || value.totp);\n          cipher.login.username = this.getValueOrDefault(value.login_username || value.username);\n          cipher.login.password = this.getValueOrDefault(value.login_password || value.password);\n          const uris = this.parseSingleRowCsv(value.login_uri || value.uri);\n          cipher.login.uris = this.makeUriArray(uris);\n          break;\n        }\n      }\n\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\n\nexport function safeGetString(value: string | EncString) {\n  if (value == null) {\n    return null;\n  }\n\n  if (typeof value == \"string\") {\n    return value;\n  }\n  return value?.encryptedString;\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Card as CardDomain } from \"../../vault/models/domain/card\";\nimport { CardView } from \"../../vault/models/view/card.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class CardExport {\n  static template(): CardExport {\n    const req = new CardExport();\n    req.cardholderName = \"John Doe\";\n    req.brand = \"visa\";\n    req.number = \"4242424242424242\";\n    req.expMonth = \"04\";\n    req.expYear = \"2023\";\n    req.code = \"123\";\n    return req;\n  }\n\n  static toView(req: CardExport, view = new CardView()) {\n    view.cardholderName = req.cardholderName;\n    view.brand = req.brand;\n    view.number = req.number;\n    view.expMonth = req.expMonth;\n    view.expYear = req.expYear;\n    view.code = req.code;\n    return view;\n  }\n\n  static toDomain(req: CardExport, domain = new CardDomain()) {\n    domain.cardholderName = req.cardholderName != null ? new EncString(req.cardholderName) : null;\n    domain.brand = req.brand != null ? new EncString(req.brand) : null;\n    domain.number = req.number != null ? new EncString(req.number) : null;\n    domain.expMonth = req.expMonth != null ? new EncString(req.expMonth) : null;\n    domain.expYear = req.expYear != null ? new EncString(req.expYear) : null;\n    domain.code = req.code != null ? new EncString(req.code) : null;\n    return domain;\n  }\n\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(o?: CardView | CardDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.cardholderName = safeGetString(o.cardholderName);\n    this.brand = safeGetString(o.brand);\n    this.number = safeGetString(o.number);\n    this.expMonth = safeGetString(o.expMonth);\n    this.expYear = safeGetString(o.expYear);\n    this.code = safeGetString(o.code);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { FieldType, LinkedIdType } from \"../../vault/enums\";\nimport { Field as FieldDomain } from \"../../vault/models/domain/field\";\nimport { FieldView } from \"../../vault/models/view/field.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class FieldExport {\n  static template(): FieldExport {\n    const req = new FieldExport();\n    req.name = \"Field name\";\n    req.value = \"Some value\";\n    req.type = FieldType.Text;\n    return req;\n  }\n\n  static toView(req: FieldExport, view = new FieldView()) {\n    view.type = req.type;\n    view.value = req.value;\n    view.name = req.name;\n    view.linkedId = req.linkedId;\n    return view;\n  }\n\n  static toDomain(req: FieldExport, domain = new FieldDomain()) {\n    domain.type = req.type;\n    domain.value = req.value != null ? new EncString(req.value) : null;\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.linkedId = req.linkedId;\n    return domain;\n  }\n\n  name: string;\n  value: string;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(o?: FieldView | FieldDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.name = safeGetString(o.name);\n    this.value = safeGetString(o.value);\n    this.type = o.type;\n    this.linkedId = o.linkedId;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Identity as IdentityDomain } from \"../../vault/models/domain/identity\";\nimport { IdentityView } from \"../../vault/models/view/identity.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class IdentityExport {\n  static template(): IdentityExport {\n    const req = new IdentityExport();\n    req.title = \"Mr\";\n    req.firstName = \"John\";\n    req.middleName = \"William\";\n    req.lastName = \"Doe\";\n    req.address1 = \"123 Any St\";\n    req.address2 = \"Apt #123\";\n    req.address3 = null;\n    req.city = \"New York\";\n    req.state = \"NY\";\n    req.postalCode = \"10001\";\n    req.country = \"US\";\n    req.company = \"Acme Inc.\";\n    req.email = \"john@company.com\";\n    req.phone = \"5555551234\";\n    req.ssn = \"000-123-4567\";\n    req.username = \"jdoe\";\n    req.passportNumber = \"US-123456789\";\n    req.licenseNumber = \"D123-12-123-12333\";\n    return req;\n  }\n\n  static toView(req: IdentityExport, view = new IdentityView()) {\n    view.title = req.title;\n    view.firstName = req.firstName;\n    view.middleName = req.middleName;\n    view.lastName = req.lastName;\n    view.address1 = req.address1;\n    view.address2 = req.address2;\n    view.address3 = req.address3;\n    view.city = req.city;\n    view.state = req.state;\n    view.postalCode = req.postalCode;\n    view.country = req.country;\n    view.company = req.company;\n    view.email = req.email;\n    view.phone = req.phone;\n    view.ssn = req.ssn;\n    view.username = req.username;\n    view.passportNumber = req.passportNumber;\n    view.licenseNumber = req.licenseNumber;\n    return view;\n  }\n\n  static toDomain(req: IdentityExport, domain = new IdentityDomain()) {\n    domain.title = req.title != null ? new EncString(req.title) : null;\n    domain.firstName = req.firstName != null ? new EncString(req.firstName) : null;\n    domain.middleName = req.middleName != null ? new EncString(req.middleName) : null;\n    domain.lastName = req.lastName != null ? new EncString(req.lastName) : null;\n    domain.address1 = req.address1 != null ? new EncString(req.address1) : null;\n    domain.address2 = req.address2 != null ? new EncString(req.address2) : null;\n    domain.address3 = req.address3 != null ? new EncString(req.address3) : null;\n    domain.city = req.city != null ? new EncString(req.city) : null;\n    domain.state = req.state != null ? new EncString(req.state) : null;\n    domain.postalCode = req.postalCode != null ? new EncString(req.postalCode) : null;\n    domain.country = req.country != null ? new EncString(req.country) : null;\n    domain.company = req.company != null ? new EncString(req.company) : null;\n    domain.email = req.email != null ? new EncString(req.email) : null;\n    domain.phone = req.phone != null ? new EncString(req.phone) : null;\n    domain.ssn = req.ssn != null ? new EncString(req.ssn) : null;\n    domain.username = req.username != null ? new EncString(req.username) : null;\n    domain.passportNumber = req.passportNumber != null ? new EncString(req.passportNumber) : null;\n    domain.licenseNumber = req.licenseNumber != null ? new EncString(req.licenseNumber) : null;\n    return domain;\n  }\n\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(o?: IdentityView | IdentityDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.title = safeGetString(o.title);\n    this.firstName = safeGetString(o.firstName);\n    this.middleName = safeGetString(o.middleName);\n    this.lastName = safeGetString(o.lastName);\n    this.address1 = safeGetString(o.address1);\n    this.address2 = safeGetString(o.address2);\n    this.address3 = safeGetString(o.address3);\n    this.city = safeGetString(o.city);\n    this.state = safeGetString(o.state);\n    this.postalCode = safeGetString(o.postalCode);\n    this.country = safeGetString(o.country);\n    this.company = safeGetString(o.company);\n    this.email = safeGetString(o.email);\n    this.phone = safeGetString(o.phone);\n    this.ssn = safeGetString(o.ssn);\n    this.username = safeGetString(o.username);\n    this.passportNumber = safeGetString(o.passportNumber);\n    this.licenseNumber = safeGetString(o.licenseNumber);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Fido2Credential } from \"../../vault/models/domain/fido2-credential\";\nimport { Fido2CredentialView } from \"../../vault/models/view/fido2-credential.view\";\n\nimport { safeGetString } from \"./utils\";\n\n/**\n * Represents format of Fido2 Credentials in JSON exports.\n */\nexport class Fido2CredentialExport {\n  /**\n   * Generates a template for Fido2CredentialExport\n   * @returns Instance of Fido2CredentialExport with predefined values.\n   */\n  static template(): Fido2CredentialExport {\n    const req = new Fido2CredentialExport();\n    req.credentialId = \"keyId\";\n    req.keyType = \"keyType\";\n    req.keyAlgorithm = \"keyAlgorithm\";\n    req.keyCurve = \"keyCurve\";\n    req.keyValue = \"keyValue\";\n    req.rpId = \"rpId\";\n    req.userHandle = \"userHandle\";\n    req.userName = \"userName\";\n    req.counter = \"counter\";\n    req.rpName = \"rpName\";\n    req.userDisplayName = \"userDisplayName\";\n    req.discoverable = \"false\";\n    req.creationDate = null;\n    return req;\n  }\n\n  /**\n   * Converts a Fido2CredentialExport object to its view representation.\n   * @param req - The Fido2CredentialExport object to be converted.\n   * @param view - (Optional) The Fido2CredentialView object to popualte with Fido2CredentialExport data\n   * @returns Fido2CredentialView - The populated view, or a new instance if none was provided.\n   */\n  static toView(req: Fido2CredentialExport, view = new Fido2CredentialView()) {\n    view.credentialId = req.credentialId;\n    view.keyType = req.keyType as \"public-key\";\n    view.keyAlgorithm = req.keyAlgorithm as \"ECDSA\";\n    view.keyCurve = req.keyCurve as \"P-256\";\n    view.keyValue = req.keyValue;\n    view.rpId = req.rpId;\n    view.userHandle = req.userHandle;\n    view.userName = req.userName;\n    view.counter = parseInt(req.counter);\n    view.rpName = req.rpName;\n    view.userDisplayName = req.userDisplayName;\n    view.discoverable = req.discoverable === \"true\";\n    view.creationDate = new Date(req.creationDate);\n    return view;\n  }\n\n  /**\n   * Converts a Fido2CredentialExport object to its domain representation.\n   * @param req - The Fido2CredentialExport object to be converted.\n   * @param domain - (Optional) The Fido2Credential object to popualte with Fido2CredentialExport data\n   * @returns Fido2Credential - The populated domain, or a new instance if none was provided.\n   */\n  static toDomain(req: Fido2CredentialExport, domain = new Fido2Credential()) {\n    domain.credentialId = req.credentialId != null ? new EncString(req.credentialId) : null;\n    domain.keyType = req.keyType != null ? new EncString(req.keyType) : null;\n    domain.keyAlgorithm = req.keyAlgorithm != null ? new EncString(req.keyAlgorithm) : null;\n    domain.keyCurve = req.keyCurve != null ? new EncString(req.keyCurve) : null;\n    domain.keyValue = req.keyValue != null ? new EncString(req.keyValue) : null;\n    domain.rpId = req.rpId != null ? new EncString(req.rpId) : null;\n    domain.userHandle = req.userHandle != null ? new EncString(req.userHandle) : null;\n    domain.userName = req.userName != null ? new EncString(req.userName) : null;\n    domain.counter = req.counter != null ? new EncString(req.counter) : null;\n    domain.rpName = req.rpName != null ? new EncString(req.rpName) : null;\n    domain.userDisplayName =\n      req.userDisplayName != null ? new EncString(req.userDisplayName) : null;\n    domain.discoverable = req.discoverable != null ? new EncString(req.discoverable) : null;\n    domain.creationDate = req.creationDate;\n    return domain;\n  }\n\n  credentialId: string;\n  keyType: string;\n  keyAlgorithm: string;\n  keyCurve: string;\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: Date;\n\n  /**\n   * Constructs a new Fid2CredentialExport instance.\n   *\n   * @param o - The credential storing the data being exported. When not provided, an empty export is created instead.\n   */\n  constructor(o?: Fido2CredentialView | Fido2Credential) {\n    if (o == null) {\n      return;\n    }\n\n    this.credentialId = safeGetString(o.credentialId);\n    this.keyType = safeGetString(o.keyType);\n    this.keyAlgorithm = safeGetString(o.keyAlgorithm);\n    this.keyCurve = safeGetString(o.keyCurve);\n    this.keyValue = safeGetString(o.keyValue);\n    this.rpId = safeGetString(o.rpId);\n    this.userHandle = safeGetString(o.userHandle);\n    this.userName = safeGetString(o.userName);\n    this.counter = safeGetString(String(o.counter));\n    this.rpName = safeGetString(o.rpName);\n    this.userDisplayName = safeGetString(o.userDisplayName);\n    this.discoverable = safeGetString(String(o.discoverable));\n    this.creationDate = o.creationDate;\n  }\n}\n","import { UriMatchStrategySetting } from \"../../models/domain/domain-service\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { LoginUri as LoginUriDomain } from \"../../vault/models/domain/login-uri\";\nimport { LoginUriView } from \"../../vault/models/view/login-uri.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class LoginUriExport {\n  static template(): LoginUriExport {\n    const req = new LoginUriExport();\n    req.uri = \"https://google.com\";\n    req.match = null;\n    return req;\n  }\n\n  static toView(req: LoginUriExport, view = new LoginUriView()) {\n    view.uri = req.uri;\n    view.match = req.match;\n    return view;\n  }\n\n  static toDomain(req: LoginUriExport, domain = new LoginUriDomain()) {\n    domain.uri = req.uri != null ? new EncString(req.uri) : null;\n    domain.uriChecksum = req.uriChecksum != null ? new EncString(req.uriChecksum) : null;\n    domain.match = req.match;\n    return domain;\n  }\n\n  uri: string;\n  uriChecksum: string | undefined;\n  match: UriMatchStrategySetting = null;\n\n  constructor(o?: LoginUriView | LoginUriDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.uri = safeGetString(o.uri);\n    if (\"uriChecksum\" in o) {\n      this.uriChecksum = o.uriChecksum?.encryptedString;\n    }\n    this.match = o.match;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Login as LoginDomain } from \"../../vault/models/domain/login\";\nimport { LoginView } from \"../../vault/models/view/login.view\";\n\nimport { Fido2CredentialExport } from \"./fido2-credential.export\";\nimport { LoginUriExport } from \"./login-uri.export\";\nimport { safeGetString } from \"./utils\";\n\nexport class LoginExport {\n  static template(): LoginExport {\n    const req = new LoginExport();\n    req.uris = [];\n    req.username = \"jdoe\";\n    req.password = \"myp@ssword123\";\n    req.totp = \"JBSWY3DPEHPK3PXP\";\n    req.fido2Credentials = [Fido2CredentialExport.template()];\n    return req;\n  }\n\n  static toView(req: LoginExport, view = new LoginView()) {\n    if (req.uris != null) {\n      view.uris = req.uris.map((u) => LoginUriExport.toView(u));\n    }\n    view.username = req.username;\n    view.password = req.password;\n    view.totp = req.totp;\n    if (req.fido2Credentials != null) {\n      view.fido2Credentials = req.fido2Credentials.map((key) => Fido2CredentialExport.toView(key));\n    }\n    return view;\n  }\n\n  static toDomain(req: LoginExport, domain = new LoginDomain()) {\n    if (req.uris != null) {\n      domain.uris = req.uris.map((u) => LoginUriExport.toDomain(u));\n    }\n    domain.username = req.username != null ? new EncString(req.username) : null;\n    domain.password = req.password != null ? new EncString(req.password) : null;\n    domain.totp = req.totp != null ? new EncString(req.totp) : null;\n    // Fido2credentials are currently not supported for exports.\n\n    return domain;\n  }\n\n  uris: LoginUriExport[];\n  username: string;\n  password: string;\n  totp: string;\n  fido2Credentials: Fido2CredentialExport[] = [];\n\n  constructor(o?: LoginView | LoginDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o.uris != null) {\n      this.uris = o.uris.map((u) => new LoginUriExport(u));\n    }\n\n    if (o.fido2Credentials != null) {\n      this.fido2Credentials = o.fido2Credentials.map((key) => new Fido2CredentialExport(key));\n    }\n\n    this.username = safeGetString(o.username);\n    this.password = safeGetString(o.password);\n    this.totp = safeGetString(o.totp);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Password } from \"../../vault/models/domain/password\";\nimport { PasswordHistoryView } from \"../../vault/models/view/password-history.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class PasswordHistoryExport {\n  static template(): PasswordHistoryExport {\n    const req = new PasswordHistoryExport();\n    req.password = null;\n    req.lastUsedDate = null;\n    return req;\n  }\n\n  static toView(req: PasswordHistoryExport, view = new PasswordHistoryView()) {\n    view.password = req.password;\n    view.lastUsedDate = req.lastUsedDate;\n    return view;\n  }\n\n  static toDomain(req: PasswordHistoryExport, domain = new Password()) {\n    domain.password = req.password != null ? new EncString(req.password) : null;\n    domain.lastUsedDate = req.lastUsedDate;\n    return domain;\n  }\n\n  password: string;\n  lastUsedDate: Date = null;\n\n  constructor(o?: PasswordHistoryView | Password) {\n    if (o == null) {\n      return;\n    }\n\n    this.password = safeGetString(o.password);\n    this.lastUsedDate = o.lastUsedDate;\n  }\n}\n","import { SecureNoteType } from \"../../vault/enums\";\nimport { SecureNote as SecureNoteDomain } from \"../../vault/models/domain/secure-note\";\nimport { SecureNoteView } from \"../../vault/models/view/secure-note.view\";\n\nexport class SecureNoteExport {\n  static template(): SecureNoteExport {\n    const req = new SecureNoteExport();\n    req.type = SecureNoteType.Generic;\n    return req;\n  }\n\n  static toView(req: SecureNoteExport, view = new SecureNoteView()) {\n    view.type = req.type;\n    return view;\n  }\n\n  static toDomain(req: SecureNoteExport, view = new SecureNoteDomain()) {\n    view.type = req.type;\n    return view;\n  }\n\n  type: SecureNoteType;\n\n  constructor(o?: SecureNoteView | SecureNoteDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.type = o.type;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { CipherRepromptType } from \"../../vault/enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../vault/enums/cipher-type\";\nimport { Cipher as CipherDomain } from \"../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\n\nimport { CardExport } from \"./card.export\";\nimport { FieldExport } from \"./field.export\";\nimport { IdentityExport } from \"./identity.export\";\nimport { LoginExport } from \"./login.export\";\nimport { PasswordHistoryExport } from \"./password-history.export\";\nimport { SecureNoteExport } from \"./secure-note.export\";\nimport { safeGetString } from \"./utils\";\n\nexport class CipherExport {\n  static template(): CipherExport {\n    const req = new CipherExport();\n    req.organizationId = null;\n    req.collectionIds = null;\n    req.folderId = null;\n    req.type = CipherType.Login;\n    req.name = \"Item name\";\n    req.notes = \"Some notes about this item.\";\n    req.favorite = false;\n    req.fields = [];\n    req.login = null;\n    req.secureNote = null;\n    req.card = null;\n    req.identity = null;\n    req.reprompt = CipherRepromptType.None;\n    req.passwordHistory = [];\n    req.creationDate = null;\n    req.revisionDate = null;\n    req.deletedDate = null;\n    return req;\n  }\n\n  static toView(req: CipherExport, view = new CipherView()) {\n    view.type = req.type;\n    view.folderId = req.folderId;\n    if (view.organizationId == null) {\n      view.organizationId = req.organizationId;\n    }\n    if (view.collectionIds || req.collectionIds) {\n      const set = new Set((view.collectionIds ?? []).concat(req.collectionIds ?? []));\n      view.collectionIds = Array.from(set.values());\n    }\n    view.name = req.name;\n    view.notes = req.notes;\n    view.favorite = req.favorite;\n    view.reprompt = req.reprompt ?? CipherRepromptType.None;\n\n    if (req.fields != null) {\n      view.fields = req.fields.map((f) => FieldExport.toView(f));\n    }\n\n    switch (req.type) {\n      case CipherType.Login:\n        view.login = LoginExport.toView(req.login);\n        break;\n      case CipherType.SecureNote:\n        view.secureNote = SecureNoteExport.toView(req.secureNote);\n        break;\n      case CipherType.Card:\n        view.card = CardExport.toView(req.card);\n        break;\n      case CipherType.Identity:\n        view.identity = IdentityExport.toView(req.identity);\n        break;\n    }\n\n    if (req.passwordHistory != null) {\n      view.passwordHistory = req.passwordHistory.map((ph) => PasswordHistoryExport.toView(ph));\n    }\n\n    view.creationDate = req.creationDate;\n    view.revisionDate = req.revisionDate;\n    view.deletedDate = req.deletedDate;\n    return view;\n  }\n\n  static toDomain(req: CipherExport, domain = new CipherDomain()) {\n    domain.type = req.type;\n    domain.folderId = req.folderId;\n    if (domain.organizationId == null) {\n      domain.organizationId = req.organizationId;\n    }\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.notes = req.notes != null ? new EncString(req.notes) : null;\n    domain.favorite = req.favorite;\n    domain.reprompt = req.reprompt ?? CipherRepromptType.None;\n    domain.key = req.key != null ? new EncString(req.key) : null;\n\n    if (req.fields != null) {\n      domain.fields = req.fields.map((f) => FieldExport.toDomain(f));\n    }\n\n    switch (req.type) {\n      case CipherType.Login:\n        domain.login = LoginExport.toDomain(req.login);\n        break;\n      case CipherType.SecureNote:\n        domain.secureNote = SecureNoteExport.toDomain(req.secureNote);\n        break;\n      case CipherType.Card:\n        domain.card = CardExport.toDomain(req.card);\n        break;\n      case CipherType.Identity:\n        domain.identity = IdentityExport.toDomain(req.identity);\n        break;\n    }\n\n    if (req.passwordHistory != null) {\n      domain.passwordHistory = req.passwordHistory.map((ph) => PasswordHistoryExport.toDomain(ph));\n    }\n\n    domain.creationDate = req.creationDate;\n    domain.revisionDate = req.revisionDate;\n    domain.deletedDate = req.deletedDate;\n    return domain;\n  }\n\n  type: CipherType;\n  folderId: string;\n  organizationId: string;\n  collectionIds: string[];\n  name: string;\n  notes: string;\n  favorite: boolean;\n  fields: FieldExport[];\n  login: LoginExport;\n  secureNote: SecureNoteExport;\n  card: CardExport;\n  identity: IdentityExport;\n  reprompt: CipherRepromptType;\n  passwordHistory: PasswordHistoryExport[] = null;\n  revisionDate: Date = null;\n  creationDate: Date = null;\n  deletedDate: Date = null;\n  key: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CipherView | CipherDomain) {\n    this.organizationId = o.organizationId;\n    this.folderId = o.folderId;\n    this.type = o.type;\n    this.reprompt = o.reprompt;\n\n    this.name = safeGetString(o.name);\n    this.notes = safeGetString(o.notes);\n    if (\"key\" in o) {\n      this.key = o.key?.encryptedString;\n    }\n\n    this.favorite = o.favorite;\n\n    if (o.fields != null) {\n      this.fields = o.fields.map((f) => new FieldExport(f));\n    }\n\n    switch (o.type) {\n      case CipherType.Login:\n        this.login = new LoginExport(o.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteExport(o.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new CardExport(o.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityExport(o.identity);\n        break;\n    }\n\n    if (o.passwordHistory != null) {\n      this.passwordHistory = o.passwordHistory.map((ph) => new PasswordHistoryExport(ph));\n    }\n\n    this.creationDate = o.creationDate;\n    this.revisionDate = o.revisionDate;\n    this.deletedDate = o.deletedDate;\n  }\n}\n","import { Cipher as CipherDomain } from \"../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\n\nimport { CipherExport } from \"./cipher.export\";\n\nexport class CipherWithIdExport extends CipherExport {\n  id: string;\n  collectionIds: string[];\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CipherView | CipherDomain) {\n    this.id = o.id;\n    super.build(o);\n    this.collectionIds = o.collectionIds;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Collection as CollectionDomain } from \"../../vault/models/domain/collection\";\nimport { CollectionView } from \"../../vault/models/view/collection.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class CollectionExport {\n  static template(): CollectionExport {\n    const req = new CollectionExport();\n    req.organizationId = \"00000000-0000-0000-0000-000000000000\";\n    req.name = \"Collection name\";\n    req.externalId = null;\n    return req;\n  }\n\n  static toView(req: CollectionExport, view = new CollectionView()) {\n    view.name = req.name;\n    view.externalId = req.externalId;\n    if (view.organizationId == null) {\n      view.organizationId = req.organizationId;\n    }\n    return view;\n  }\n\n  static toDomain(req: CollectionExport, domain = new CollectionDomain()) {\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.externalId = req.externalId;\n    if (domain.organizationId == null) {\n      domain.organizationId = req.organizationId;\n    }\n    return domain;\n  }\n\n  organizationId: string;\n  name: string;\n  externalId: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CollectionView | CollectionDomain) {\n    this.organizationId = o.organizationId;\n    this.name = safeGetString(o.name);\n    this.externalId = o.externalId;\n  }\n}\n","import { Collection as CollectionDomain } from \"../../vault/models/domain/collection\";\nimport { CollectionView } from \"../../vault/models/view/collection.view\";\n\nimport { CollectionExport } from \"./collection.export\";\n\nexport class CollectionWithIdExport extends CollectionExport {\n  id: string;\n\n  static toView(req: CollectionWithIdExport, view = new CollectionView()) {\n    view.id = req.id;\n    return super.toView(req, view);\n  }\n\n  static toDomain(req: CollectionWithIdExport, domain = new CollectionDomain()) {\n    domain.id = req.id;\n    return super.toDomain(req, domain);\n  }\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CollectionView | CollectionDomain) {\n    this.id = o.id;\n    super.build(o);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Folder as FolderDomain } from \"../../vault/models/domain/folder\";\nimport { FolderView } from \"../../vault/models/view/folder.view\";\n\nimport { safeGetString } from \"./utils\";\n\nexport class FolderExport {\n  static template(): FolderExport {\n    const req = new FolderExport();\n    req.name = \"Folder name\";\n    return req;\n  }\n\n  static toView(req: FolderExport, view = new FolderView()) {\n    view.name = req.name;\n    return view;\n  }\n\n  static toDomain(req: FolderExport, domain = new FolderDomain()) {\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    return domain;\n  }\n\n  name: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: FolderView | FolderDomain) {\n    this.name = safeGetString(o.name);\n  }\n}\n","import { Folder as FolderDomain } from \"../../vault/models/domain/folder\";\nimport { FolderView } from \"../../vault/models/view/folder.view\";\n\nimport { FolderExport } from \"./folder.export\";\n\nexport class FolderWithIdExport extends FolderExport {\n  id: string;\n\n  static toView(req: FolderWithIdExport, view = new FolderView()) {\n    view.id = req.id;\n    return super.toView(req, view);\n  }\n\n  static toDomain(req: FolderWithIdExport, domain = new FolderDomain()) {\n    domain.id = req.id;\n    return super.toDomain(req, domain);\n  }\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: FolderView | FolderDomain) {\n    this.id = o.id;\n    super.build(o);\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport {\n  CipherWithIdExport,\n  CollectionWithIdExport,\n  FolderWithIdExport,\n} from \"@bitwarden/common/models/export\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { OrganizationId } from \"@bitwarden/common/types/guid\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport {\n  BitwardenEncryptedIndividualJsonExport,\n  BitwardenEncryptedOrgJsonExport,\n  BitwardenJsonExport,\n  BitwardenUnEncryptedIndividualJsonExport,\n  BitwardenUnEncryptedOrgJsonExport,\n} from \"@bitwarden/vault-export-core\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class BitwardenJsonImporter extends BaseImporter implements Importer {\n  private result: ImportResult;\n\n  protected constructor(\n    protected cryptoService: CryptoService,\n    protected i18nService: I18nService,\n    protected cipherService: CipherService,\n    protected pinService: PinServiceAbstraction,\n  ) {\n    super();\n  }\n\n  async parse(data: string): Promise<ImportResult> {\n    this.result = new ImportResult();\n    const results: BitwardenJsonExport = JSON.parse(data);\n    if (results == null || results.items == null) {\n      this.result.success = false;\n      return this.result;\n    }\n\n    if (results.encrypted) {\n      await this.parseEncrypted(results as any);\n    } else {\n      await this.parseDecrypted(results as any);\n    }\n\n    return this.result;\n  }\n\n  private async parseEncrypted(\n    results: BitwardenEncryptedIndividualJsonExport | BitwardenEncryptedOrgJsonExport,\n  ) {\n    if (results.encKeyValidation_DO_NOT_EDIT != null) {\n      const orgKey = await this.cryptoService.getOrgKey(this.organizationId);\n      const encKeyValidation = new EncString(results.encKeyValidation_DO_NOT_EDIT);\n      const encKeyValidationDecrypt = await this.cryptoService.decryptToUtf8(\n        encKeyValidation,\n        orgKey,\n      );\n      if (encKeyValidationDecrypt === null) {\n        this.result.success = false;\n        this.result.errorMessage = this.i18nService.t(\"importEncKeyError\");\n        return;\n      }\n    }\n\n    const groupingsMap = this.organization\n      ? await this.parseCollections(results as BitwardenEncryptedOrgJsonExport)\n      : await this.parseFolders(results as BitwardenEncryptedIndividualJsonExport);\n\n    for (const c of results.items) {\n      const cipher = CipherWithIdExport.toDomain(c);\n      // reset ids incase they were set for some reason\n      cipher.id = null;\n      cipher.organizationId = this.organizationId;\n      cipher.collectionIds = null;\n\n      // make sure password history is limited\n      if (cipher.passwordHistory != null && cipher.passwordHistory.length > 5) {\n        cipher.passwordHistory = cipher.passwordHistory.slice(0, 5);\n      }\n\n      if (!this.organization && c.folderId != null && groupingsMap.has(c.folderId)) {\n        this.result.folderRelationships.push([\n          this.result.ciphers.length,\n          groupingsMap.get(c.folderId),\n        ]);\n      } else if (this.organization && c.collectionIds != null) {\n        c.collectionIds.forEach((cId) => {\n          if (groupingsMap.has(cId)) {\n            this.result.collectionRelationships.push([\n              this.result.ciphers.length,\n              groupingsMap.get(cId),\n            ]);\n          }\n        });\n      }\n\n      const view = await cipher.decrypt(\n        await this.cipherService.getKeyForCipherKeyDecryption(cipher),\n      );\n      this.cleanupCipher(view);\n      this.result.ciphers.push(view);\n    }\n\n    this.result.success = true;\n  }\n\n  private async parseDecrypted(\n    results: BitwardenUnEncryptedIndividualJsonExport | BitwardenUnEncryptedOrgJsonExport,\n  ) {\n    const groupingsMap = this.organization\n      ? await this.parseCollections(results as BitwardenUnEncryptedOrgJsonExport)\n      : await this.parseFolders(results as BitwardenUnEncryptedIndividualJsonExport);\n\n    results.items.forEach((c) => {\n      const cipher = CipherWithIdExport.toView(c);\n      // reset ids incase they were set for some reason\n      cipher.id = null;\n      cipher.organizationId = null;\n      cipher.collectionIds = null;\n\n      // make sure password history is limited\n      if (cipher.passwordHistory != null && cipher.passwordHistory.length > 5) {\n        cipher.passwordHistory = cipher.passwordHistory.slice(0, 5);\n      }\n\n      if (!this.organization && c.folderId != null && groupingsMap.has(c.folderId)) {\n        this.result.folderRelationships.push([\n          this.result.ciphers.length,\n          groupingsMap.get(c.folderId),\n        ]);\n      } else if (this.organization && c.collectionIds != null) {\n        c.collectionIds.forEach((cId) => {\n          if (groupingsMap.has(cId)) {\n            this.result.collectionRelationships.push([\n              this.result.ciphers.length,\n              groupingsMap.get(cId),\n            ]);\n          }\n        });\n      }\n\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n\n    this.result.success = true;\n  }\n\n  private async parseFolders(\n    data: BitwardenUnEncryptedIndividualJsonExport | BitwardenEncryptedIndividualJsonExport,\n  ): Promise<Map<string, number>> | null {\n    if (data.folders == null) {\n      return null;\n    }\n\n    const groupingsMap = new Map<string, number>();\n\n    for (const f of data.folders) {\n      let folderView: FolderView;\n      if (data.encrypted) {\n        const folder = FolderWithIdExport.toDomain(f);\n        if (folder != null) {\n          folderView = await folder.decrypt();\n        }\n      } else {\n        folderView = FolderWithIdExport.toView(f);\n      }\n\n      if (folderView != null) {\n        groupingsMap.set(f.id, this.result.folders.length);\n        this.result.folders.push(folderView);\n      }\n    }\n    return groupingsMap;\n  }\n\n  private async parseCollections(\n    data: BitwardenUnEncryptedOrgJsonExport | BitwardenEncryptedOrgJsonExport,\n  ): Promise<Map<string, number>> | null {\n    if (data.collections == null) {\n      return null;\n    }\n\n    const groupingsMap = new Map<string, number>();\n\n    for (const c of data.collections) {\n      let collectionView: CollectionView;\n      if (data.encrypted) {\n        const collection = CollectionWithIdExport.toDomain(c);\n        collection.organizationId = this.organizationId;\n        collectionView = await firstValueFrom(this.cryptoService.activeUserOrgKeys$).then(\n          (orgKeys) => collection.decrypt(orgKeys[c.organizationId as OrganizationId]),\n        );\n      } else {\n        collectionView = CollectionWithIdExport.toView(c);\n        collectionView.organizationId = null;\n      }\n\n      if (collectionView != null) {\n        groupingsMap.set(c.id, this.result.collections.length);\n        this.result.collections.push(collectionView);\n      }\n    }\n    return groupingsMap;\n  }\n}\n","import { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport {\n  Argon2KdfConfig,\n  KdfConfig,\n  PBKDF2KdfConfig,\n} from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { BitwardenPasswordProtectedFileFormat } from \"@bitwarden/vault-export-core\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { Importer } from \"../importer\";\n\nimport { BitwardenJsonImporter } from \"./bitwarden-json-importer\";\n\nexport class BitwardenPasswordProtectedImporter extends BitwardenJsonImporter implements Importer {\n  private key: SymmetricCryptoKey;\n\n  constructor(\n    cryptoService: CryptoService,\n    i18nService: I18nService,\n    cipherService: CipherService,\n    pinService: PinServiceAbstraction,\n    private promptForPassword_callback: () => Promise<string>,\n  ) {\n    super(cryptoService, i18nService, cipherService, pinService);\n  }\n\n  async parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const parsedData: BitwardenPasswordProtectedFileFormat = JSON.parse(data);\n\n    if (!parsedData) {\n      result.success = false;\n      return result;\n    }\n\n    // File is unencrypted\n    if (!parsedData?.encrypted) {\n      return await super.parse(data);\n    }\n\n    // File is account-encrypted\n    if (!parsedData?.passwordProtected) {\n      return await super.parse(data);\n    }\n\n    if (this.cannotParseFile(parsedData)) {\n      result.success = false;\n      return result;\n    }\n\n    // File is password-protected\n    const password = await this.promptForPassword_callback();\n    if (!(await this.checkPassword(parsedData, password))) {\n      result.success = false;\n      result.errorMessage = this.i18nService.t(\"invalidFilePassword\");\n      return result;\n    }\n\n    const encData = new EncString(parsedData.data);\n    const clearTextData = await this.cryptoService.decryptToUtf8(encData, this.key);\n    return await super.parse(clearTextData);\n  }\n\n  private async checkPassword(\n    jdoc: BitwardenPasswordProtectedFileFormat,\n    password: string,\n  ): Promise<boolean> {\n    if (this.isNullOrWhitespace(password)) {\n      return false;\n    }\n\n    const kdfConfig: KdfConfig =\n      jdoc.kdfType === KdfType.PBKDF2_SHA256\n        ? new PBKDF2KdfConfig(jdoc.kdfIterations)\n        : new Argon2KdfConfig(jdoc.kdfIterations, jdoc.kdfMemory, jdoc.kdfParallelism);\n\n    this.key = await this.pinService.makePinKey(password, jdoc.salt, kdfConfig);\n\n    const encKeyValidation = new EncString(jdoc.encKeyValidation_DO_NOT_EDIT);\n\n    const encKeyValidationDecrypt = await this.cryptoService.decryptToUtf8(\n      encKeyValidation,\n      this.key,\n    );\n    if (encKeyValidationDecrypt === null) {\n      return false;\n    }\n    return true;\n  }\n\n  private cannotParseFile(jdoc: BitwardenPasswordProtectedFileFormat): boolean {\n    return (\n      !jdoc ||\n      !jdoc.encrypted ||\n      !jdoc.passwordProtected ||\n      !jdoc.salt ||\n      !jdoc.kdfIterations ||\n      typeof jdoc.kdfIterations !== \"number\" ||\n      jdoc.kdfType == null ||\n      KdfType[jdoc.kdfType] == null ||\n      !jdoc.encKeyValidation_DO_NOT_EDIT ||\n      !jdoc.data\n    );\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class BlurCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.label === \"null\") {\n        value.label = null;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(\n        value.label,\n        this.getValueOrDefault(this.nameFromUrl(value.domain), \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(value.domain);\n      cipher.login.password = this.getValueOrDefault(value.password);\n\n      if (this.isNullOrWhitespace(value.email) && !this.isNullOrWhitespace(value.username)) {\n        cipher.login.username = value.username;\n      } else {\n        cipher.login.username = this.getValueOrDefault(value.email);\n        cipher.notes = this.getValueOrDefault(value.username);\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst OfficialProps = [\"!group_id\", \"!group_name\", \"title\", \"username\", \"password\", \"URL\", \"id\"];\n\nexport class ButtercupCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValueOrDefault(value[\"!group_name\"]));\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n\n      let processingCustomFields = false;\n      for (const prop in value) {\n        // eslint-disable-next-line\n        if (value.hasOwnProperty(prop)) {\n          if (!processingCustomFields && OfficialProps.indexOf(prop) === -1) {\n            processingCustomFields = true;\n          }\n          if (processingCustomFields) {\n            this.processKvp(cipher, prop, value[prop]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ClipperzHtmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const textarea = doc.querySelector(\"textarea\");\n    if (textarea == null || this.isNullOrWhitespace(textarea.textContent)) {\n      result.errorMessage = \"Missing textarea.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const entries = JSON.parse(textarea.textContent);\n    entries.forEach((entry: any) => {\n      const cipher = this.initLoginCipher();\n      if (!this.isNullOrWhitespace(entry.label)) {\n        cipher.name = entry.label.split(\" \")[0];\n      }\n      if (entry.data != null && !this.isNullOrWhitespace(entry.data.notes)) {\n        cipher.notes = entry.data.notes.split(\"\\\\n\").join(\"\\n\");\n      }\n\n      if (entry.currentVersion != null && entry.currentVersion.fields != null) {\n        for (const property in entry.currentVersion.fields) {\n          // eslint-disable-next-line\n          if (!entry.currentVersion.fields.hasOwnProperty(property)) {\n            continue;\n          }\n\n          const field = entry.currentVersion.fields[property];\n          const actionType = field.actionType != null ? field.actionType.toLowerCase() : null;\n          switch (actionType) {\n            case \"password\":\n              cipher.login.password = this.getValueOrDefault(field.value);\n              break;\n            case \"email\":\n            case \"username\":\n            case \"user\":\n            case \"name\":\n              cipher.login.username = this.getValueOrDefault(field.value);\n              break;\n            case \"url\":\n              cipher.login.uris = this.makeUriArray(field.value);\n              break;\n            default: {\n              const labelLower = field.label != null ? field.label.toLowerCase() : null;\n              if (\n                cipher.login.password == null &&\n                this.passwordFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.password = this.getValueOrDefault(field.value);\n              } else if (\n                cipher.login.username == null &&\n                this.usernameFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.username = this.getValueOrDefault(field.value);\n              } else if (\n                (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n                this.uriFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.uris = this.makeUriArray(field.value);\n              } else {\n                this.processKvp(cipher, field.label, field.value);\n              }\n              break;\n            }\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class CodebookCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValueOrDefault(value.Category));\n\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.Favorite) === \"True\";\n      cipher.name = this.getValueOrDefault(value.Entry, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Note);\n      cipher.login.username = this.getValueOrDefault(value.Username, value.Email);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.totp = this.getValueOrDefault(value.TOTP);\n      cipher.login.uris = this.makeUriArray(value.Website);\n\n      if (!this.isNullOrWhitespace(value.Username)) {\n        this.processKvp(cipher, \"Email\", value.Email);\n      }\n      this.processKvp(cipher, \"Phone\", value.Phone);\n      this.processKvp(cipher, \"PIN\", value.PIN);\n      this.processKvp(cipher, \"Account\", value.Account);\n      this.processKvp(cipher, \"Date\", value.Date);\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  CredentialsRecord,\n  IdRecord,\n  PaymentsRecord,\n  PersonalInformationRecord,\n  SecureNoteRecord,\n} from \"./types/dashlane-csv-types\";\n\nconst _mappedCredentialsColumns = new Set([\n  \"title\",\n  \"note\",\n  \"username\",\n  \"password\",\n  \"url\",\n  \"otpSecret\",\n  \"category\",\n]);\n\nconst _mappedPersonalInfoAsIdentityColumns = new Set([\n  \"type\",\n  \"title\",\n  \"first_name\",\n  \"middle_name\",\n  \"last_name\",\n  \"login\",\n  \"email\",\n  \"phone_number\",\n  \"address\",\n  \"country\",\n  \"state\",\n  \"city\",\n  \"zip\",\n  // Skip item_name as we already have set a combined name\n  \"item_name\",\n]);\n\nconst _mappedSecureNoteColumns = new Set([\"title\", \"note\"]);\n\nexport class DashlaneCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results[0].type != null && results[0].title != null) {\n      const personalRecords = results as PersonalInformationRecord[];\n\n      // If personalRecords has only one \"name\" then create an Identity-Cipher\n      if (personalRecords.filter((x) => x.type === \"name\").length === 1) {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n        results.forEach((row) => {\n          this.parsePersonalInformationRecordAsIdentity(cipher, row);\n        });\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n        result.success = true;\n        return Promise.resolve(result);\n      }\n    }\n\n    results.forEach((row) => {\n      const cipher = this.initLoginCipher();\n\n      const rowKeys = Object.keys(row);\n      if (rowKeys[0] === \"username\") {\n        this.processFolder(result, row.category);\n        this.parseCredentialsRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"type\" && rowKeys[1] === \"account_name\") {\n        this.parsePaymentRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"type\" && rowKeys[1] === \"number\") {\n        this.parseIdRecord(cipher, row);\n      }\n\n      if ((rowKeys[0] === \"type\") != null && rowKeys[1] === \"title\") {\n        this.parsePersonalInformationRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"title\" && rowKeys[1] === \"note\") {\n        this.parseSecureNoteRecords(cipher, row);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  parseCredentialsRecord(cipher: CipherView, row: CredentialsRecord) {\n    cipher.type = CipherType.Login;\n    cipher.login = new LoginView();\n\n    cipher.name = row.title;\n    cipher.notes = row.note;\n    cipher.login.username = row.username;\n    cipher.login.password = row.password;\n    cipher.login.totp = row.otpSecret;\n    cipher.login.uris = this.makeUriArray(row.url);\n\n    this.importUnmappedFields(cipher, row, _mappedCredentialsColumns);\n  }\n\n  parsePaymentRecord(cipher: CipherView, row: PaymentsRecord) {\n    cipher.type = CipherType.Card;\n    cipher.card = new CardView();\n\n    cipher.name = row.account_name;\n    let mappedValues: string[] = [];\n    switch (row.type) {\n      case \"credit_card\":\n        cipher.card.cardholderName = row.account_name;\n        cipher.card.number = row.cc_number;\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = row.code;\n        this.setCardExpiration(cipher, `${row.expiration_month}/${row.expiration_year}`);\n\n        // If you add more mapped fields please extend this\n        mappedValues = [\n          \"account_name\",\n          \"account_holder\",\n          \"cc_number\",\n          \"code\",\n          \"expiration_month\",\n          \"expiration_year\",\n        ];\n        break;\n      case \"bank\":\n        cipher.card.cardholderName = row.account_holder;\n        cipher.card.number = row.account_number;\n\n        // If you add more mapped fields please extend this\n        mappedValues = [\"account_name\", \"account_holder\", \"account_number\"];\n        break;\n      default:\n        break;\n    }\n\n    this.importUnmappedFields(cipher, row, new Set(mappedValues));\n  }\n\n  parseIdRecord(cipher: CipherView, row: IdRecord) {\n    cipher.type = CipherType.Identity;\n    cipher.identity = new IdentityView();\n\n    const mappedValues: string[] = [\"name\", \"number\"];\n    switch (row.type) {\n      case \"card\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.licenseNumber = row.number;\n        break;\n      case \"passport\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.passportNumber = row.number;\n        break;\n      case \"license\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.licenseNumber = row.number;\n        cipher.identity.state = row.state;\n\n        mappedValues.push(\"state\");\n        break;\n      case \"social_security\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.ssn = row.number;\n        break;\n      case \"tax_number\":\n        cipher.name = row.type;\n        cipher.identity.licenseNumber = row.number;\n        break;\n\n      default:\n        break;\n    }\n\n    // If you add more mapped fields please extend this\n    this.importUnmappedFields(cipher, row, new Set(mappedValues));\n  }\n\n  parsePersonalInformationRecord(cipher: CipherView, row: PersonalInformationRecord) {\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote.type = SecureNoteType.Generic;\n    if (row.type === \"name\") {\n      cipher.name = `${row.title} ${row.first_name} ${row.middle_name} ${row.last_name}`\n        .replace(\"  \", \" \")\n        .trim();\n    } else {\n      cipher.name = row.item_name;\n    }\n\n    const dataRow = row as any;\n    Object.keys(row).forEach((key) => {\n      this.processKvp(cipher, key, dataRow[key]);\n    });\n  }\n\n  parsePersonalInformationRecordAsIdentity(cipher: CipherView, row: PersonalInformationRecord) {\n    switch (row.type) {\n      case \"name\":\n        this.processFullName(cipher, `${row.first_name} ${row.middle_name} ${row.last_name}`);\n        cipher.identity.title = row.title;\n        cipher.name = cipher.identity.fullName;\n\n        cipher.identity.username = row.login;\n        break;\n      case \"email\":\n        cipher.identity.email = row.email;\n        break;\n      case \"number\":\n        cipher.identity.phone = row.phone_number;\n        break;\n      case \"address\":\n        cipher.identity.address1 = row.address;\n        cipher.identity.city = row.city;\n        cipher.identity.postalCode = row.zip;\n        cipher.identity.state = row.state;\n        cipher.identity.country = row.country;\n        break;\n      default:\n        break;\n    }\n\n    this.importUnmappedFields(cipher, row, _mappedPersonalInfoAsIdentityColumns);\n  }\n\n  parseSecureNoteRecords(cipher: CipherView, row: SecureNoteRecord) {\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = row.title;\n    cipher.notes = row.note;\n\n    this.importUnmappedFields(cipher, row, _mappedSecureNoteColumns);\n  }\n\n  importUnmappedFields(cipher: CipherView, row: any, mappedValues: Set<string>) {\n    const unmappedFields = Object.keys(row).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = row as any;\n      this.processKvp(cipher, key, item[key]);\n    });\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nconst HandledResults = new Set([\n  \"ADDRESS\",\n  \"AUTHENTIFIANT\",\n  \"BANKSTATEMENT\",\n  \"IDCARD\",\n  \"IDENTITY\",\n  \"PAYMENTMEANS_CREDITCARD\",\n  \"PAYMENTMEAN_PAYPAL\",\n  \"EMAIL\",\n]);\n\nexport class DashlaneJsonImporter extends BaseImporter implements Importer {\n  private result: ImportResult;\n\n  parse(data: string): Promise<ImportResult> {\n    this.result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.length === 0) {\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    if (results.ADDRESS != null) {\n      this.processAddress(results.ADDRESS);\n    }\n    if (results.AUTHENTIFIANT != null) {\n      this.processAuth(results.AUTHENTIFIANT);\n    }\n    if (results.BANKSTATEMENT != null) {\n      this.processNote(results.BANKSTATEMENT, \"BankAccountName\");\n    }\n    if (results.IDCARD != null) {\n      this.processNote(results.IDCARD, \"Fullname\");\n    }\n    if (results.PAYMENTMEANS_CREDITCARD != null) {\n      this.processCard(results.PAYMENTMEANS_CREDITCARD);\n    }\n    if (results.IDENTITY != null) {\n      this.processIdentity(results.IDENTITY);\n    }\n\n    for (const key in results) {\n      // eslint-disable-next-line\n      if (results.hasOwnProperty(key) && !HandledResults.has(key)) {\n        this.processNote(results[key], null, \"Generic Note\");\n      }\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processAuth(results: any[]) {\n    results.forEach((credential: any) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(credential.title);\n\n      cipher.login.username = this.getValueOrDefault(\n        credential.login,\n        this.getValueOrDefault(credential.secondaryLogin),\n      );\n      if (this.isNullOrWhitespace(cipher.login.username)) {\n        cipher.login.username = this.getValueOrDefault(credential.email);\n      } else if (!this.isNullOrWhitespace(credential.email)) {\n        cipher.notes = \"Email: \" + credential.email + \"\\n\";\n      }\n\n      cipher.login.password = this.getValueOrDefault(credential.password);\n      cipher.login.uris = this.makeUriArray(credential.domain);\n      cipher.notes += this.getValueOrDefault(credential.note, \"\");\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processIdentity(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.identity = new IdentityView();\n      cipher.type = CipherType.Identity;\n      cipher.name = this.getValueOrDefault(obj.fullName, \"\");\n      const nameParts = cipher.name.split(\" \");\n      if (nameParts.length > 0) {\n        cipher.identity.firstName = this.getValueOrDefault(nameParts[0]);\n      }\n      if (nameParts.length === 2) {\n        cipher.identity.lastName = this.getValueOrDefault(nameParts[1]);\n      } else if (nameParts.length === 3) {\n        cipher.identity.middleName = this.getValueOrDefault(nameParts[1]);\n        cipher.identity.lastName = this.getValueOrDefault(nameParts[2]);\n      }\n      cipher.identity.username = this.getValueOrDefault(obj.pseudo);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processAddress(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.identity = new IdentityView();\n      cipher.type = CipherType.Identity;\n      cipher.name = this.getValueOrDefault(obj.addressName);\n      cipher.identity.address1 = this.getValueOrDefault(obj.addressFull);\n      cipher.identity.city = this.getValueOrDefault(obj.city);\n      cipher.identity.state = this.getValueOrDefault(obj.state);\n      cipher.identity.postalCode = this.getValueOrDefault(obj.zipcode);\n      cipher.identity.country = this.getValueOrDefault(obj.country);\n      if (cipher.identity.country != null) {\n        cipher.identity.country = cipher.identity.country.toUpperCase();\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processCard(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.card = new CardView();\n      cipher.type = CipherType.Card;\n      cipher.name = this.getValueOrDefault(obj.bank);\n      cipher.card.number = this.getValueOrDefault(obj.cardNumber);\n      cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      cipher.card.cardholderName = this.getValueOrDefault(obj.owner);\n      if (!this.isNullOrWhitespace(cipher.card.brand)) {\n        if (this.isNullOrWhitespace(cipher.name)) {\n          cipher.name = cipher.card.brand;\n        } else {\n          cipher.name += \" - \" + cipher.card.brand;\n        }\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processNote(results: any[], nameProperty: string, name: string = null) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.secureNote = new SecureNoteView();\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote.type = SecureNoteType.Generic;\n      if (name != null) {\n        cipher.name = name;\n      } else {\n        cipher.name = this.getValueOrDefault(obj[nameProperty]);\n      }\n      for (const key in obj) {\n        // eslint-disable-next-line\n        if (obj.hasOwnProperty(key) && key !== nameProperty) {\n          this.processKvp(cipher, key, obj[key].toString());\n        }\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class EncryptrCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Label, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      const text = this.getValueOrDefault(value.Text);\n      if (!this.isNullOrWhitespace(text)) {\n        if (this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes = text;\n        } else {\n          cipher.notes += \"\\n\\n\" + text;\n        }\n      }\n\n      const type = value[\"Entry Type\"];\n      if (type === \"Password\") {\n        cipher.login.username = this.getValueOrDefault(value.Username);\n        cipher.login.password = this.getValueOrDefault(value.Password);\n        cipher.login.uris = this.makeUriArray(value[\"Site URL\"]);\n      } else if (type === \"Credit Card\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value[\"Name on card\"]);\n        cipher.card.number = this.getValueOrDefault(value[\"Card Number\"]);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = this.getValueOrDefault(value.CVV);\n        const expiry = this.getValueOrDefault(value.Expiry);\n        if (!this.isNullOrWhitespace(expiry)) {\n          const expParts = expiry.split(\"/\");\n          if (expParts.length > 1) {\n            cipher.card.expMonth = parseInt(expParts[0], null).toString();\n            cipher.card.expYear = (2000 + parseInt(expParts[1], null)).toString();\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class EnpassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let firstRow = true;\n    results.forEach((value) => {\n      if (value.length < 2 || (firstRow && (value[0] === \"Title\" || value[0] === \"title\"))) {\n        firstRow = false;\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 1]);\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      if (\n        value.length === 2 ||\n        (!this.containsField(value, \"username\") &&\n          !this.containsField(value, \"password\") &&\n          !this.containsField(value, \"email\") &&\n          !this.containsField(value, \"url\"))\n      ) {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n      }\n\n      if (\n        this.containsField(value, \"cardholder\") &&\n        this.containsField(value, \"number\") &&\n        this.containsField(value, \"expiry date\")\n      ) {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n      }\n\n      if (value.length > 2 && value.length % 2 === 0) {\n        for (let i = 0; i < value.length - 2; i += 2) {\n          const fieldValue: string = value[i + 2];\n          if (this.isNullOrWhitespace(fieldValue)) {\n            continue;\n          }\n\n          const fieldName: string = value[i + 1];\n          const fieldNameLower = fieldName.toLowerCase();\n\n          if (cipher.type === CipherType.Login) {\n            if (\n              fieldNameLower === \"url\" &&\n              (cipher.login.uris == null || cipher.login.uris.length === 0)\n            ) {\n              cipher.login.uris = this.makeUriArray(fieldValue);\n              continue;\n            } else if (\n              (fieldNameLower === \"username\" || fieldNameLower === \"email\") &&\n              this.isNullOrWhitespace(cipher.login.username)\n            ) {\n              cipher.login.username = fieldValue;\n              continue;\n            } else if (\n              fieldNameLower === \"password\" &&\n              this.isNullOrWhitespace(cipher.login.password)\n            ) {\n              cipher.login.password = fieldValue;\n              continue;\n            } else if (fieldNameLower === \"totp\" && this.isNullOrWhitespace(cipher.login.totp)) {\n              cipher.login.totp = fieldValue;\n              continue;\n            }\n          } else if (cipher.type === CipherType.Card) {\n            if (\n              fieldNameLower === \"cardholder\" &&\n              this.isNullOrWhitespace(cipher.card.cardholderName)\n            ) {\n              cipher.card.cardholderName = fieldValue;\n              continue;\n            } else if (fieldNameLower === \"number\" && this.isNullOrWhitespace(cipher.card.number)) {\n              cipher.card.number = fieldValue;\n              cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n              continue;\n            } else if (fieldNameLower === \"cvc\" && this.isNullOrWhitespace(cipher.card.code)) {\n              cipher.card.code = fieldValue;\n              continue;\n            } else if (\n              fieldNameLower === \"expiry date\" &&\n              this.isNullOrWhitespace(cipher.card.expMonth) &&\n              this.isNullOrWhitespace(cipher.card.expYear)\n            ) {\n              if (this.setCardExpiration(cipher, fieldValue)) {\n                continue;\n              }\n            } else if (fieldNameLower === \"type\") {\n              // Skip since brand was determined from number above\n              continue;\n            }\n          }\n\n          this.processKvp(cipher, fieldName, fieldValue);\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private containsField(fields: any[], name: string) {\n    if (fields == null || name == null) {\n      return false;\n    }\n    return (\n      fields.filter((f) => !this.isNullOrWhitespace(f) && f.toLowerCase() === name.toLowerCase())\n        .length > 0\n    );\n  }\n}\n","import { FieldType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { EnpassJsonFile, EnpassFolder, EnpassField } from \"./types/enpass-json-type\";\n\ntype EnpassFolderTreeItem = EnpassFolder & { children: EnpassFolderTreeItem[] };\nconst androidUrlRegex = new RegExp(\"androidapp://.*==@\", \"g\");\n\nexport class EnpassJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: EnpassJsonFile = JSON.parse(data);\n    if (results == null || results.items == null || results.items.length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, string>();\n    const foldersIndexMap = new Map<string, number>();\n    const folderTree = this.buildFolderTree(results.folders);\n    this.flattenFolderTree(null, folderTree, foldersMap);\n    foldersMap.forEach((val, key) => {\n      foldersIndexMap.set(key, result.folders.length);\n      const f = new FolderView();\n      f.name = val;\n      result.folders.push(f);\n    });\n\n    results.items.forEach((item) => {\n      if (item.folders != null && item.folders.length > 0 && foldersIndexMap.has(item.folders[0])) {\n        result.folderRelationships.push([\n          result.ciphers.length,\n          foldersIndexMap.get(item.folders[0]),\n        ]);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(item.title);\n      cipher.favorite = item.favorite > 0;\n\n      if (item.template_type != null && item.fields != null && item.fields.length > 0) {\n        if (\n          item.template_type.indexOf(\"login.\") === 0 ||\n          item.template_type.indexOf(\"password.\") === 0\n        ) {\n          this.processLogin(cipher, item.fields);\n        } else if (item.template_type.indexOf(\"creditcard.\") === 0) {\n          this.processCard(cipher, item.fields);\n        } else if (\n          item.template_type.indexOf(\"identity.\") < 0 &&\n          item.fields.some((f) => f.type === \"password\" && !this.isNullOrWhitespace(f.value))\n        ) {\n          this.processLogin(cipher, item.fields);\n        } else {\n          this.processNote(cipher, item.fields);\n        }\n      }\n\n      cipher.notes += \"\\n\" + this.getValueOrDefault(item.note, \"\");\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private processLogin(cipher: CipherView, fields: EnpassField[]) {\n    const urls: string[] = [];\n    fields.forEach((field) => {\n      if (this.isNullOrWhitespace(field.value) || field.type === \"section\") {\n        return;\n      }\n\n      if (\n        (field.type === \"username\" || field.type === \"email\") &&\n        this.isNullOrWhitespace(cipher.login.username)\n      ) {\n        cipher.login.username = field.value;\n      } else if (field.type === \"password\" && this.isNullOrWhitespace(cipher.login.password)) {\n        cipher.login.password = field.value;\n      } else if (field.type === \"totp\" && this.isNullOrWhitespace(cipher.login.totp)) {\n        cipher.login.totp = field.value;\n      } else if (field.type === \"url\") {\n        urls.push(field.value);\n      } else if (field.type === \".Android#\") {\n        let cleanedValue = field.value.startsWith(\"androidapp://\")\n          ? field.value\n          : \"androidapp://\" + field.value;\n        cleanedValue = cleanedValue.replace(\"android://\", \"\");\n        cleanedValue = cleanedValue.replace(androidUrlRegex, \"androidapp://\");\n        urls.push(cleanedValue);\n      } else {\n        this.processKvp(\n          cipher,\n          field.label,\n          field.value,\n          field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n        );\n      }\n    });\n    cipher.login.uris = this.makeUriArray(urls);\n  }\n\n  private processCard(cipher: CipherView, fields: EnpassField[]) {\n    cipher.card = new CardView();\n    cipher.type = CipherType.Card;\n    fields.forEach((field) => {\n      if (\n        this.isNullOrWhitespace(field.value) ||\n        field.type === \"section\" ||\n        field.type === \"ccType\"\n      ) {\n        return;\n      }\n\n      if (field.type === \"ccName\" && this.isNullOrWhitespace(cipher.card.cardholderName)) {\n        cipher.card.cardholderName = field.value;\n      } else if (field.type === \"ccNumber\" && this.isNullOrWhitespace(cipher.card.number)) {\n        cipher.card.number = field.value;\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      } else if (field.type === \"ccCvc\" && this.isNullOrWhitespace(cipher.card.code)) {\n        cipher.card.code = field.value;\n      } else if (field.type === \"ccExpiry\" && this.isNullOrWhitespace(cipher.card.expYear)) {\n        if (!this.setCardExpiration(cipher, field.value)) {\n          this.processKvp(\n            cipher,\n            field.label,\n            field.value,\n            field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n          );\n        }\n      } else {\n        this.processKvp(\n          cipher,\n          field.label,\n          field.value,\n          field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n        );\n      }\n    });\n  }\n\n  private processNote(cipher: CipherView, fields: EnpassField[]) {\n    fields.forEach((field) => {\n      if (this.isNullOrWhitespace(field.value) || field.type === \"section\") {\n        return;\n      }\n      this.processKvp(\n        cipher,\n        field.label,\n        field.value,\n        field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n      );\n    });\n  }\n\n  private buildFolderTree(folders: EnpassFolder[]): EnpassFolderTreeItem[] {\n    if (folders == null) {\n      return [];\n    }\n    const folderTree: EnpassFolderTreeItem[] = [];\n    const map = new Map<string, EnpassFolderTreeItem>([]);\n    folders.forEach((obj: EnpassFolderTreeItem) => {\n      map.set(obj.uuid, obj);\n      obj.children = [];\n    });\n    folders.forEach((obj: EnpassFolderTreeItem) => {\n      if (obj.parent_uuid != null && obj.parent_uuid !== \"\" && map.has(obj.parent_uuid)) {\n        map.get(obj.parent_uuid).children.push(obj);\n      } else {\n        folderTree.push(obj);\n      }\n    });\n    return folderTree;\n  }\n\n  private flattenFolderTree(\n    titlePrefix: string,\n    tree: EnpassFolderTreeItem[],\n    map: Map<string, string>,\n  ) {\n    if (tree == null) {\n      return;\n    }\n    tree.forEach((f) => {\n      if (f.title != null && f.title.trim() !== \"\") {\n        let title = f.title.trim();\n        if (titlePrefix != null && titlePrefix.trim() !== \"\") {\n          title = titlePrefix + \"/\" + title;\n        }\n        map.set(f.uuid, title);\n        if (f.children != null && f.children.length !== 0) {\n          this.flattenFolderTree(title, f.children, map);\n        }\n      }\n    });\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class FirefoxCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results\n      .filter((value) => {\n        return value.url !== \"chrome://FirefoxAccounts\";\n      })\n      .forEach((value) => {\n        const cipher = this.initLoginCipher();\n        const url = this.getValueOrDefault(value.url, this.getValueOrDefault(value.hostname));\n        cipher.name = this.getValueOrDefault(this.nameFromUrl(url), \"--\");\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.uris = this.makeUriArray(url);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","export interface FskFile {\n  data: Data;\n}\n\nexport interface Data {\n  [key: string]: FskEntry;\n}\n\nexport enum FskEntryTypesEnum {\n  Login = 1,\n  CreditCard = 2,\n}\n\nexport interface FskEntry {\n  color: string;\n  creditCvv: string;\n  creditExpiry: string;\n  creditNumber: string;\n  favorite: number; // UNIX timestamp\n  notes: string;\n  password: string;\n  passwordList: PasswordList[];\n  passwordModifiedDate: number; // UNIX timestamp\n  rev: string | number;\n  service: string;\n  style: string;\n  type: FskEntryTypesEnum;\n  url: string;\n  username: string;\n  createdDate: number; // UNIX timestamp\n  modifiedDate: number; // UNIX timestamp\n}\n\nexport interface PasswordList {\n  changedate: string;\n  password: string;\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { FskEntry, FskEntryTypesEnum, FskFile } from \"./fsecure-fsk-types\";\n\nexport class FSecureFskImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: FskFile = JSON.parse(data);\n    if (results == null || results.data == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    for (const key in results.data) {\n      // eslint-disable-next-line\n      if (!results.data.hasOwnProperty(key)) {\n        continue;\n      }\n\n      const value = results.data[key];\n      const cipher = this.parseEntry(value);\n      result.ciphers.push(cipher);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseEntry(entry: FskEntry): CipherView {\n    const cipher = this.initLoginCipher();\n    cipher.name = this.getValueOrDefault(entry.service);\n    cipher.notes = this.getValueOrDefault(entry.notes);\n    cipher.favorite = entry.favorite > 0;\n\n    switch (entry.type) {\n      case FskEntryTypesEnum.Login:\n        this.handleLoginEntry(entry, cipher);\n        break;\n      case FskEntryTypesEnum.CreditCard:\n        this.handleCreditCardEntry(entry, cipher);\n        break;\n      default:\n        return;\n        break;\n    }\n\n    this.convertToNoteIfNeeded(cipher);\n    this.cleanupCipher(cipher);\n    return cipher;\n  }\n\n  private handleLoginEntry(entry: FskEntry, cipher: CipherView) {\n    cipher.login.username = this.getValueOrDefault(entry.username);\n    cipher.login.password = this.getValueOrDefault(entry.password);\n    cipher.login.uris = this.makeUriArray(entry.url);\n  }\n\n  private handleCreditCardEntry(entry: FskEntry, cipher: CipherView) {\n    cipher.type = CipherType.Card;\n    cipher.card = new CardView();\n    cipher.card.cardholderName = this.getValueOrDefault(entry.username);\n    cipher.card.number = this.getValueOrDefault(entry.creditNumber);\n    cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n    cipher.card.code = this.getValueOrDefault(entry.creditCvv);\n    if (!this.isNullOrWhitespace(entry.creditExpiry)) {\n      if (!this.setCardExpiration(cipher, entry.creditExpiry)) {\n        this.processKvp(cipher, \"Expiration\", entry.creditExpiry);\n      }\n    }\n    if (!this.isNullOrWhitespace(entry.password)) {\n      this.processKvp(cipher, \"PIN\", entry.password);\n    }\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class GnomeJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || Object.keys(results).length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    for (const keyRing in results) {\n      if (\n        !results.hasOwnProperty(keyRing) || // eslint-disable-line\n        this.isNullOrWhitespace(keyRing) ||\n        results[keyRing].length === 0\n      ) {\n        continue;\n      }\n\n      results[keyRing].forEach((value: any) => {\n        if (\n          this.isNullOrWhitespace(value.display_name) ||\n          value.display_name.indexOf(\"http\") !== 0\n        ) {\n          return;\n        }\n\n        this.processFolder(result, keyRing);\n        const cipher = this.initLoginCipher();\n        cipher.name = value.display_name.replace(\"http://\", \"\").replace(\"https://\", \"\");\n        if (cipher.name.length > 30) {\n          cipher.name = cipher.name.substring(0, 30);\n        }\n        cipher.login.password = this.getValueOrDefault(value.secret);\n        cipher.login.uris = this.makeUriArray(value.display_name);\n\n        if (value.attributes != null) {\n          cipher.login.username =\n            value.attributes != null\n              ? this.getValueOrDefault(value.attributes.username_value)\n              : null;\n          for (const attr in value.attributes) {\n            if (\n              !value.attributes.hasOwnProperty(attr) || // eslint-disable-line\n              attr === \"username_value\" ||\n              attr === \"xdg:schema\"\n            ) {\n              continue;\n            }\n            this.processKvp(cipher, attr, value.attributes[attr]);\n          }\n        }\n\n        this.convertToNoteIfNeeded(cipher);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst NotesHeader = \"Notes\\n\\n\";\nconst ApplicationsHeader = \"Applications\\n\\n\";\nconst WebsitesHeader = \"Websites\\n\\n\";\nconst Delimiter = \"\\n---\\n\";\n\nexport class KasperskyTxtImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n\n    let notesData: string;\n    let applicationsData: string;\n    let websitesData: string;\n    let workingData = this.splitNewLine(data).join(\"\\n\");\n\n    if (workingData.indexOf(NotesHeader) !== -1) {\n      const parts = workingData.split(NotesHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        notesData = parts[1];\n      }\n    }\n    if (workingData.indexOf(ApplicationsHeader) !== -1) {\n      const parts = workingData.split(ApplicationsHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        applicationsData = parts[1];\n      }\n    }\n    if (workingData.indexOf(WebsitesHeader) === 0) {\n      const parts = workingData.split(WebsitesHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        websitesData = parts[1];\n      }\n    }\n\n    const notes = this.parseDataCategory(notesData);\n    const applications = this.parseDataCategory(applicationsData);\n    const websites = this.parseDataCategory(websitesData);\n\n    notes.forEach((n) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(n.get(\"Name\"));\n      cipher.notes = this.getValueOrDefault(n.get(\"Text\"));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    websites.concat(applications).forEach((w) => {\n      const cipher = this.initLoginCipher();\n      const nameKey = w.has(\"Website name\") ? \"Website name\" : \"Application\";\n      cipher.name = this.getValueOrDefault(w.get(nameKey), \"\");\n      if (!this.isNullOrWhitespace(w.get(\"Login name\"))) {\n        if (!this.isNullOrWhitespace(cipher.name)) {\n          cipher.name += \": \";\n        }\n        cipher.name += w.get(\"Login name\");\n      }\n      cipher.notes = this.getValueOrDefault(w.get(\"Comment\"));\n      if (w.has(\"Website URL\")) {\n        cipher.login.uris = this.makeUriArray(w.get(\"Website URL\"));\n      }\n      cipher.login.username = this.getValueOrDefault(w.get(\"Login\"));\n      cipher.login.password = this.getValueOrDefault(w.get(\"Password\"));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseDataCategory(data: string): Map<string, string>[] {\n    if (this.isNullOrWhitespace(data) || data.indexOf(Delimiter) === -1) {\n      return [];\n    }\n    const items: Map<string, string>[] = [];\n    data.split(Delimiter).forEach((p) => {\n      if (p.indexOf(\"\\n\") === -1) {\n        return;\n      }\n      const item = new Map<string, string>();\n      let itemComment: string;\n      let itemCommentKey: string;\n      p.split(\"\\n\").forEach((l) => {\n        if (itemComment != null) {\n          itemComment += \"\\n\" + l;\n          return;\n        }\n        const colonIndex = l.indexOf(\":\");\n        let key: string;\n        let val: string;\n        if (colonIndex === -1) {\n          return;\n        } else {\n          key = l.substring(0, colonIndex);\n          if (l.length > colonIndex + 1) {\n            val = l.substring(colonIndex + 2);\n          }\n        }\n        if (key != null) {\n          item.set(key, val);\n        }\n        if (key === \"Comment\" || key === \"Text\") {\n          itemComment = val;\n          itemCommentKey = key;\n        }\n      });\n      if (itemComment != null && itemCommentKey != null) {\n        item.set(itemCommentKey, itemComment);\n      }\n      if (item.size === 0) {\n        return;\n      }\n      items.push(item);\n    });\n    return items;\n  }\n}\n","import { FieldType } from \"@bitwarden/common/vault/enums\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class KeePass2XmlImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    //Note: The doc.querySelector(\"KeePassFile > Root > Group\") no longers works on node and we have to breakdown the query by nodes\n    const KeePassFileNode = doc.querySelector(\"KeePassFile\");\n\n    if (KeePassFileNode == null) {\n      this.result.errorMessage = \"Missing `KeePassFile` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    const RootNode = KeePassFileNode.querySelector(\"Root\");\n    if (RootNode == null) {\n      this.result.errorMessage = \"Missing `KeePassFile > Root` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    const rootGroup = RootNode.querySelector(\"Group\");\n    if (rootGroup == null) {\n      this.result.errorMessage = \"Missing `KeePassFile > Root > Group` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    this.traverse(rootGroup, true, \"\");\n\n    if (this.organization) {\n      this.moveFoldersToCollections(this.result);\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  traverse(node: Element, isRootNode: boolean, groupPrefixName: string) {\n    const folderIndex = this.result.folders.length;\n    let groupName = groupPrefixName;\n\n    if (!isRootNode) {\n      if (groupName !== \"\") {\n        groupName += \"/\";\n      }\n      const nameEl = this.querySelectorDirectChild(node, \"Name\");\n      groupName += nameEl == null ? \"-\" : nameEl.textContent;\n      const folder = new FolderView();\n      folder.name = groupName;\n      this.result.folders.push(folder);\n    }\n\n    this.querySelectorAllDirectChild(node, \"Entry\").forEach((entry) => {\n      const cipherIndex = this.result.ciphers.length;\n\n      const cipher = this.initLoginCipher();\n      this.querySelectorAllDirectChild(entry, \"String\").forEach((entryString) => {\n        const valueEl = this.querySelectorDirectChild(entryString, \"Value\");\n        const value = valueEl != null ? valueEl.textContent : null;\n        if (this.isNullOrWhitespace(value)) {\n          return;\n        }\n        const keyEl = this.querySelectorDirectChild(entryString, \"Key\");\n        const key = keyEl != null ? keyEl.textContent : null;\n\n        if (key === \"URL\") {\n          cipher.login.uris = this.makeUriArray(value);\n        } else if (key === \"UserName\") {\n          cipher.login.username = value;\n        } else if (key === \"Password\") {\n          cipher.login.password = value;\n        } else if (key === \"otp\") {\n          cipher.login.totp = value.replace(\"key=\", \"\");\n        } else if (key === \"Title\") {\n          cipher.name = value;\n        } else if (key === \"Notes\") {\n          cipher.notes += value + \"\\n\";\n        } else {\n          let type = FieldType.Text;\n          const attrs = valueEl.attributes as any;\n          if (\n            attrs.length > 0 &&\n            attrs.ProtectInMemory != null &&\n            attrs.ProtectInMemory.value === \"True\"\n          ) {\n            type = FieldType.Hidden;\n          }\n          this.processKvp(cipher, key, value, type);\n        }\n      });\n\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n\n      if (!isRootNode) {\n        this.result.folderRelationships.push([cipherIndex, folderIndex]);\n      }\n    });\n\n    this.querySelectorAllDirectChild(node, \"Group\").forEach((group) => {\n      this.traverse(group, false, groupName);\n    });\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class KeePassXCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.isNullOrWhitespace(value.Title)) {\n        return;\n      }\n\n      value.Group =\n        !this.isNullOrWhitespace(value.Group) && value.Group.startsWith(\"Root/\")\n          ? value.Group.replace(\"Root/\", \"\")\n          : value.Group;\n      const groupName = !this.isNullOrWhitespace(value.Group) ? value.Group : null;\n      this.processFolder(result, groupName);\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.name = this.getValueOrDefault(value.Title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class KeeperCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 6) {\n        return;\n      }\n\n      this.processFolder(result, value[0]);\n      const cipher = this.initLoginCipher();\n\n      const notes = this.getValueOrDefault(value[5]);\n      if (notes) {\n        cipher.notes = `${notes}\\n`;\n      }\n\n      cipher.name = this.getValueOrDefault(value[1], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[2]);\n      cipher.login.password = this.getValueOrDefault(value[3]);\n      cipher.login.uris = this.makeUriArray(value[4]);\n\n      if (value.length > 7) {\n        // we have some custom fields.\n        for (let i = 7; i < value.length; i = i + 2) {\n          if (value[i] == \"TFC:Keeper\") {\n            cipher.login.totp = value[i + 1];\n          } else {\n            this.processKvp(cipher, value[i], value[i + 1]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class LastPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipherIndex = result.ciphers.length;\n      let folderIndex = result.folders.length;\n      let grouping = value.grouping;\n      if (grouping != null) {\n        // eslint-disable-next-line\n        grouping = grouping.replace(/\\\\/g, \"/\").replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, \"\");\n      }\n      const hasFolder = this.getValueOrDefault(grouping, \"(none)\") !== \"(none)\";\n      let addFolder = hasFolder;\n\n      if (hasFolder) {\n        for (let i = 0; i < result.folders.length; i++) {\n          if (result.folders[i].name === grouping) {\n            addFolder = false;\n            folderIndex = i;\n            break;\n          }\n        }\n      }\n\n      const cipher = this.buildBaseCipher(value);\n      if (cipher.type === CipherType.Login) {\n        cipher.notes = this.getValueOrDefault(value.extra);\n        cipher.login = new LoginView();\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.totp = this.getValueOrDefault(value.totp);\n      } else if (cipher.type === CipherType.SecureNote) {\n        this.parseSecureNote(value, cipher);\n      } else if (cipher.type === CipherType.Card) {\n        cipher.card = this.parseCard(value);\n        cipher.notes = this.getValueOrDefault(value.notes);\n      } else if (cipher.type === CipherType.Identity) {\n        cipher.identity = this.parseIdentity(value);\n        cipher.notes = this.getValueOrDefault(value.notes);\n        if (!this.isNullOrWhitespace(value.ccnum)) {\n          // there is a card on this identity too\n          const cardCipher = this.buildBaseCipher(value);\n          cardCipher.identity = null;\n          cardCipher.type = CipherType.Card;\n          cardCipher.card = this.parseCard(value);\n          result.ciphers.push(cardCipher);\n        }\n      }\n\n      result.ciphers.push(cipher);\n\n      if (addFolder) {\n        const f = new FolderView();\n        f.name = grouping;\n        result.folders.push(f);\n      }\n      if (hasFolder) {\n        result.folderRelationships.push([cipherIndex, folderIndex]);\n      }\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private buildBaseCipher(value: any) {\n    const cipher = new CipherView();\n    // eslint-disable-next-line\n    if (value.hasOwnProperty(\"profilename\") && value.hasOwnProperty(\"profilelanguage\")) {\n      // form fill\n      cipher.favorite = false;\n      cipher.name = this.getValueOrDefault(value.profilename, \"--\");\n      cipher.type = CipherType.Card;\n\n      if (\n        !this.isNullOrWhitespace(value.title) ||\n        !this.isNullOrWhitespace(value.firstname) ||\n        !this.isNullOrWhitespace(value.lastname) ||\n        !this.isNullOrWhitespace(value.address1) ||\n        !this.isNullOrWhitespace(value.phone) ||\n        !this.isNullOrWhitespace(value.username) ||\n        !this.isNullOrWhitespace(value.email)\n      ) {\n        cipher.type = CipherType.Identity;\n      }\n    } else {\n      // site or secure note\n      cipher.favorite = !this.organization && this.getValueOrDefault(value.fav, \"0\") === \"1\";\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.type = value.url === \"http://sn\" ? CipherType.SecureNote : CipherType.Login;\n    }\n    return cipher;\n  }\n\n  private parseCard(value: any): CardView {\n    const card = new CardView();\n    card.cardholderName = this.getValueOrDefault(value.ccname);\n    card.number = this.getValueOrDefault(value.ccnum);\n    card.code = this.getValueOrDefault(value.cccsc);\n    card.brand = CardView.getCardBrandByPatterns(card.number);\n\n    if (!this.isNullOrWhitespace(value.ccexp) && value.ccexp.indexOf(\"-\") > -1) {\n      const ccexpParts = (value.ccexp as string).split(\"-\");\n      if (ccexpParts.length > 1) {\n        card.expYear = ccexpParts[0];\n        card.expMonth = ccexpParts[1];\n        if (card.expMonth.length === 2 && card.expMonth[0] === \"0\") {\n          card.expMonth = card.expMonth[1];\n        }\n      }\n    }\n\n    return card;\n  }\n\n  private parseIdentity(value: any): IdentityView {\n    const identity = new IdentityView();\n    identity.title = this.getValueOrDefault(value.title);\n    identity.firstName = this.getValueOrDefault(value.firstname);\n    identity.middleName = this.getValueOrDefault(value.middlename);\n    identity.lastName = this.getValueOrDefault(value.lastname);\n    identity.username = this.getValueOrDefault(value.username);\n    identity.company = this.getValueOrDefault(value.company);\n    identity.ssn = this.getValueOrDefault(value.ssn);\n    identity.address1 = this.getValueOrDefault(value.address1);\n    identity.address2 = this.getValueOrDefault(value.address2);\n    identity.address3 = this.getValueOrDefault(value.address3);\n    identity.city = this.getValueOrDefault(value.city);\n    identity.state = this.getValueOrDefault(value.state);\n    identity.postalCode = this.getValueOrDefault(value.zip);\n    identity.country = this.getValueOrDefault(value.country);\n    identity.email = this.getValueOrDefault(value.email);\n    identity.phone = this.getValueOrDefault(value.phone);\n\n    if (!this.isNullOrWhitespace(identity.title)) {\n      identity.title = identity.title.charAt(0).toUpperCase() + identity.title.slice(1);\n    }\n\n    return identity;\n  }\n\n  private parseSecureNote(value: any, cipher: CipherView) {\n    const extraParts = this.splitNewLine(value.extra);\n    let processedNote = false;\n\n    if (extraParts.length) {\n      const typeParts = extraParts[0].split(\":\");\n      if (\n        typeParts.length > 1 &&\n        typeParts[0] === \"NoteType\" &&\n        (typeParts[1] === \"Credit Card\" || typeParts[1] === \"Address\")\n      ) {\n        if (typeParts[1] === \"Credit Card\") {\n          const mappedData = this.parseSecureNoteMapping<CardView>(cipher, extraParts, {\n            Number: \"number\",\n            \"Name on Card\": \"cardholderName\",\n            \"Security Code\": \"code\",\n            // LP provides date in a format like 'June,2020'\n            // Store in expMonth, then parse and modify\n            \"Expiration Date\": \"expMonth\",\n          });\n\n          if (this.isNullOrWhitespace(mappedData.expMonth) || mappedData.expMonth === \",\") {\n            // No expiration data\n            mappedData.expMonth = undefined;\n          } else {\n            const [monthString, year] = mappedData.expMonth.split(\",\");\n            // Parse month name into number\n            if (!this.isNullOrWhitespace(monthString)) {\n              const month = new Date(Date.parse(monthString.trim() + \" 1, 2012\")).getMonth() + 1;\n              if (isNaN(month)) {\n                mappedData.expMonth = undefined;\n              } else {\n                mappedData.expMonth = month.toString();\n              }\n            } else {\n              mappedData.expMonth = undefined;\n            }\n            if (!this.isNullOrWhitespace(year)) {\n              mappedData.expYear = year;\n            }\n          }\n\n          cipher.type = CipherType.Card;\n          cipher.card = mappedData;\n        } else if (typeParts[1] === \"Address\") {\n          const mappedData = this.parseSecureNoteMapping<IdentityView>(cipher, extraParts, {\n            Title: \"title\",\n            \"First Name\": \"firstName\",\n            \"Last Name\": \"lastName\",\n            \"Middle Name\": \"middleName\",\n            Company: \"company\",\n            \"Address 1\": \"address1\",\n            \"Address 2\": \"address2\",\n            \"Address 3\": \"address3\",\n            \"City / Town\": \"city\",\n            State: \"state\",\n            \"Zip / Postal Code\": \"postalCode\",\n            Country: \"country\",\n            \"Email Address\": \"email\",\n            Username: \"username\",\n          });\n          cipher.type = CipherType.Identity;\n          cipher.identity = mappedData;\n        }\n        processedNote = true;\n      }\n    }\n\n    if (!processedNote) {\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n      cipher.notes = this.getValueOrDefault(value.extra);\n    }\n  }\n\n  private parseSecureNoteMapping<T>(cipher: CipherView, extraParts: string[], map: any): T {\n    const dataObj: any = {};\n\n    let processingNotes = false;\n    extraParts.forEach((extraPart) => {\n      let key: string = null;\n      let val: string = null;\n      if (!processingNotes) {\n        if (this.isNullOrWhitespace(extraPart)) {\n          return;\n        }\n        const colonIndex = extraPart.indexOf(\":\");\n        if (colonIndex === -1) {\n          key = extraPart;\n        } else {\n          key = extraPart.substring(0, colonIndex);\n          if (extraPart.length > colonIndex) {\n            val = extraPart.substring(colonIndex + 1);\n          }\n        }\n        if (this.isNullOrWhitespace(key) || this.isNullOrWhitespace(val) || key === \"NoteType\") {\n          return;\n        }\n      }\n\n      if (processingNotes) {\n        cipher.notes += \"\\n\" + extraPart;\n      } else if (key === \"Notes\") {\n        if (!this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes += \"\\n\" + val;\n        } else {\n          cipher.notes = val;\n        }\n        processingNotes = true;\n        // eslint-disable-next-line\n      } else if (map.hasOwnProperty(key)) {\n        dataObj[map[key]] = val;\n      } else {\n        this.processKvp(cipher, key, val);\n      }\n    });\n\n    return dataObj;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class LogMeOnceCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 4) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[2]);\n      cipher.login.password = this.getValueOrDefault(value[3]);\n      cipher.login.uris = this.makeUriArray(value[1]);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class MeldiumCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.DisplayName, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.login.username = this.getValueOrDefault(value.UserName);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.Url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class MSecureCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 3) {\n        return;\n      }\n\n      const folderName =\n        this.getValueOrDefault(value[0], \"Unassigned\") !== \"Unassigned\" ? value[0] : null;\n      this.processFolder(result, folderName);\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[2], \"--\");\n\n      if (value[1] === \"Web Logins\" || value[1] === \"Login\") {\n        cipher.login.uris = this.makeUriArray(value[4]);\n        cipher.login.username = this.getValueOrDefault(value[5]);\n        cipher.login.password = this.getValueOrDefault(value[6]);\n        cipher.notes = !this.isNullOrWhitespace(value[3]) ? value[3].split(\"\\\\n\").join(\"\\n\") : null;\n      } else if (value.length > 3) {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n        for (let i = 3; i < value.length; i++) {\n          if (!this.isNullOrWhitespace(value[i])) {\n            cipher.notes += value[i] + \"\\n\";\n          }\n        }\n      }\n\n      if (!this.isNullOrWhitespace(value[1]) && cipher.type !== CipherType.Login) {\n        cipher.name = value[1] + \": \" + cipher.name;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst mappedBaseColumns = [\"nickname\", \"additionalInfo\"];\nconst _mappedUserAccountColumns = new Set(\n  mappedBaseColumns.concat([\"url\", \"username\", \"password\", \"twofaSecret\"]),\n);\nconst _mappedCreditCardColumns = new Set(\n  mappedBaseColumns.concat([\"cardNumber\", \"cardName\", \"exp_month\", \"exp_year\", \"cvv\"]),\n);\n\nconst _mappedIdentityColumns = new Set(\n  mappedBaseColumns.concat([\n    \"title\",\n    \"firstName\",\n    \"middleName\",\n    \"lastName\",\n    \"email\",\n    \"firstAddressLine\",\n    \"secondAddressLine\",\n    \"city\",\n    \"country\",\n    \"zipCode\",\n  ]),\n);\n\nconst _mappedIdCardColumns = new Set(mappedBaseColumns.concat([\"idName\", \"idNumber\", \"idCountry\"]));\n\nconst _mappedTwoFaColumns = new Set(mappedBaseColumns.concat([\"authToken\"]));\n\nconst _mappedUserNoteColumns = new Set(mappedBaseColumns.concat([\"content\"]));\n\nexport class MykiCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.nickname, \"--\");\n      cipher.notes = this.getValueOrDefault(value.additionalInfo);\n\n      if (value.url !== undefined) {\n        // Accounts\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.totp = this.getValueOrDefault(value.twofaSecret);\n\n        this.importUnmappedFields(cipher, value, _mappedUserAccountColumns);\n      } else if (value.authToken !== undefined) {\n        // TwoFA\n        cipher.login.totp = this.getValueOrDefault(value.authToken);\n\n        this.importUnmappedFields(cipher, value, _mappedTwoFaColumns);\n      } else if (value.cardNumber !== undefined) {\n        // Cards\n        cipher.card = new CardView();\n        cipher.type = CipherType.Card;\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardName);\n        cipher.card.number = this.getValueOrDefault(value.cardNumber);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.expMonth = this.getValueOrDefault(value.exp_month);\n        cipher.card.expYear = this.getValueOrDefault(value.exp_year);\n        cipher.card.code = this.getValueOrDefault(value.cvv);\n\n        this.importUnmappedFields(cipher, value, _mappedCreditCardColumns);\n      } else if (value.firstName !== undefined) {\n        // Identities\n        cipher.identity = new IdentityView();\n        cipher.type = CipherType.Identity;\n        cipher.identity.title = this.getValueOrDefault(value.title);\n        cipher.identity.firstName = this.getValueOrDefault(value.firstName);\n        cipher.identity.middleName = this.getValueOrDefault(value.middleName);\n        cipher.identity.lastName = this.getValueOrDefault(value.lastName);\n        cipher.identity.phone = this.getValueOrDefault(value.number);\n        cipher.identity.email = this.getValueOrDefault(value.email);\n        cipher.identity.address1 = this.getValueOrDefault(value.firstAddressLine);\n        cipher.identity.address2 = this.getValueOrDefault(value.secondAddressLine);\n        cipher.identity.city = this.getValueOrDefault(value.city);\n        cipher.identity.country = this.getValueOrDefault(value.country);\n        cipher.identity.postalCode = this.getValueOrDefault(value.zipCode);\n\n        this.importUnmappedFields(cipher, value, _mappedIdentityColumns);\n      } else if (value.idType !== undefined) {\n        // IdCards\n\n        cipher.identity = new IdentityView();\n        cipher.type = CipherType.Identity;\n        this.processFullName(cipher, value.idName);\n        cipher.identity.country = this.getValueOrDefault(value.idCountry);\n\n        switch (value.idType) {\n          // case \"Driver's License\":\n          // case \"ID Card\":\n          // case \"Outdoor License\":\n          // case \"Software License\":\n          // case \"Tax Number\":\n          // case \"Bank Account\":\n          // case \"Insurance Card\":\n          // case \"Health Card\":\n          // case \"Membership\":\n          // case \"Database\":\n          // case \"Reward Program\":\n          // case \"Tour Visa\":\n          case \"Passport\":\n            cipher.identity.passportNumber = value.idNumber;\n            break;\n          case \"Social Security\":\n            cipher.identity.ssn = value.idNumber;\n            break;\n          default:\n            cipher.identity.licenseNumber = value.idNumber;\n            break;\n        }\n\n        this.importUnmappedFields(cipher, value, _mappedIdCardColumns);\n      } else if (value.content !== undefined) {\n        // Notes\n        cipher.secureNote = new SecureNoteView();\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote.type = SecureNoteType.Generic;\n        cipher.notes = this.getValueOrDefault(value.content);\n\n        this.importUnmappedFields(cipher, value, _mappedUserNoteColumns);\n      } else {\n        return;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  importUnmappedFields(cipher: CipherView, row: any, mappedValues: Set<string>) {\n    const unmappedFields = Object.keys(row).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = row as any;\n      this.processKvp(cipher, key, item[key]);\n    });\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\ntype nodePassCsvParsed = {\n  name: string;\n  url: string;\n  username: string;\n  password: string;\n  note: string;\n  cardholdername: string;\n  cardnumber: string;\n  cvc: string;\n  expirydate: string;\n  zipcode: string;\n  folder: string;\n  full_name: string;\n  phone_number: string;\n  email: string;\n  address1: string;\n  address2: string;\n  city: string;\n  country: string;\n  state: string;\n};\n\nexport class NordPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: nodePassCsvParsed[] = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((record) => {\n      const recordType = this.evaluateType(record);\n      if (recordType === undefined) {\n        return;\n      }\n\n      if (!this.organization) {\n        this.processFolder(result, record.folder);\n      }\n\n      const cipher = new CipherView();\n      cipher.name = this.getValueOrDefault(record.name, \"--\");\n      cipher.notes = this.getValueOrDefault(record.note);\n\n      switch (recordType) {\n        case CipherType.Login:\n          cipher.type = CipherType.Login;\n          cipher.login = new LoginView();\n          cipher.login.username = this.getValueOrDefault(record.username);\n          cipher.login.password = this.getValueOrDefault(record.password);\n          cipher.login.uris = this.makeUriArray(record.url);\n          break;\n        case CipherType.Card:\n          cipher.type = CipherType.Card;\n          cipher.card.cardholderName = this.getValueOrDefault(record.cardholdername);\n          cipher.card.number = this.getValueOrDefault(record.cardnumber);\n          cipher.card.code = this.getValueOrDefault(record.cvc);\n          cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n          this.setCardExpiration(cipher, record.expirydate);\n          break;\n\n        case CipherType.Identity:\n          cipher.type = CipherType.Identity;\n\n          this.processFullName(cipher, this.getValueOrDefault(record.full_name));\n          cipher.identity.address1 = this.getValueOrDefault(record.address1);\n          cipher.identity.address2 = this.getValueOrDefault(record.address2);\n          cipher.identity.city = this.getValueOrDefault(record.city);\n          cipher.identity.state = this.getValueOrDefault(record.state);\n          cipher.identity.postalCode = this.getValueOrDefault(record.zipcode);\n          cipher.identity.country = this.getValueOrDefault(record.country);\n          if (cipher.identity.country != null) {\n            cipher.identity.country = cipher.identity.country.toUpperCase();\n          }\n          cipher.identity.email = this.getValueOrDefault(record.email);\n          cipher.identity.phone = this.getValueOrDefault(record.phone_number);\n          break;\n        case CipherType.SecureNote:\n          cipher.type = CipherType.SecureNote;\n          cipher.secureNote.type = SecureNoteType.Generic;\n          break;\n        default:\n          break;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private evaluateType(record: nodePassCsvParsed): CipherType {\n    if (!this.isNullOrWhitespace(record.username)) {\n      return CipherType.Login;\n    }\n\n    if (!this.isNullOrWhitespace(record.cardnumber)) {\n      return CipherType.Card;\n    }\n\n    if (!this.isNullOrWhitespace(record.full_name)) {\n      return CipherType.Identity;\n    }\n\n    if (!this.isNullOrWhitespace(record.note)) {\n      return CipherType.SecureNote;\n    }\n\n    return undefined;\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { PasswordHistoryView } from \"@bitwarden/common/vault/models/view/password-history.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class OnePassword1PifImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    data.split(this.newLineRegex).forEach((line) => {\n      if (this.isNullOrWhitespace(line) || line[0] !== \"{\") {\n        return;\n      }\n      const item = JSON.parse(line);\n      if (item.trashed === true) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n\n      if (this.isNullOrWhitespace(item.hmac)) {\n        this.processStandardItem(item, cipher);\n      } else {\n        this.processWinOpVaultItem(item, cipher);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processWinOpVaultItem(item: any, cipher: CipherView) {\n    if (item.overview != null) {\n      cipher.name = this.getValueOrDefault(item.overview.title);\n      if (item.overview.URLs != null) {\n        const urls: string[] = [];\n        item.overview.URLs.forEach((url: any) => {\n          if (!this.isNullOrWhitespace(url.u)) {\n            urls.push(url.u);\n          }\n        });\n        cipher.login.uris = this.makeUriArray(urls);\n      }\n    }\n\n    if (item.details != null) {\n      if (item.details.passwordHistory != null) {\n        this.parsePasswordHistory(item.details.passwordHistory, cipher);\n      }\n      if (\n        !this.isNullOrWhitespace(item.details.ccnum) ||\n        !this.isNullOrWhitespace(item.details.cvv)\n      ) {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n      } else if (\n        !this.isNullOrWhitespace(item.details.firstname) ||\n        !this.isNullOrWhitespace(item.details.address1)\n      ) {\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n      }\n      if (cipher.type === CipherType.Login && !this.isNullOrWhitespace(item.details.password)) {\n        cipher.login.password = item.details.password;\n      }\n      if (!this.isNullOrWhitespace(item.details.notesPlain)) {\n        cipher.notes = item.details.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n      }\n      if (item.details.fields != null) {\n        this.parseFields(item.details.fields, cipher, \"designation\", \"value\", \"name\");\n      }\n      if (item.details.sections != null) {\n        item.details.sections.forEach((section: any) => {\n          if (section.fields != null) {\n            this.parseFields(section.fields, cipher, \"n\", \"v\", \"t\");\n          }\n        });\n      }\n    }\n  }\n\n  private processStandardItem(item: any, cipher: CipherView) {\n    cipher.favorite = item.openContents && item.openContents.faveIndex ? true : false;\n    cipher.name = this.getValueOrDefault(item.title);\n\n    if (item.typeName === \"securenotes.SecureNote\") {\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n    } else if (item.typeName === \"wallet.financial.CreditCard\") {\n      cipher.type = CipherType.Card;\n      cipher.card = new CardView();\n    } else if (item.typeName === \"identities.Identity\") {\n      cipher.type = CipherType.Identity;\n      cipher.identity = new IdentityView();\n    } else {\n      cipher.login.uris = this.makeUriArray(item.location);\n    }\n\n    if (item.secureContents != null) {\n      if (item.secureContents.passwordHistory != null) {\n        this.parsePasswordHistory(item.secureContents.passwordHistory, cipher);\n      }\n      if (!this.isNullOrWhitespace(item.secureContents.notesPlain)) {\n        cipher.notes = item.secureContents.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n      }\n      if (cipher.type === CipherType.Login) {\n        if (!this.isNullOrWhitespace(item.secureContents.password)) {\n          cipher.login.password = item.secureContents.password;\n        }\n        if (item.secureContents.URLs != null) {\n          const urls: string[] = [];\n          item.secureContents.URLs.forEach((u: any) => {\n            if (!this.isNullOrWhitespace(u.url)) {\n              urls.push(u.url);\n            }\n          });\n          if (urls.length > 0) {\n            cipher.login.uris = this.makeUriArray(urls);\n          }\n        }\n      }\n      if (item.secureContents.fields != null) {\n        this.parseFields(item.secureContents.fields, cipher, \"designation\", \"value\", \"name\");\n      }\n      if (item.secureContents.sections != null) {\n        item.secureContents.sections.forEach((section: any) => {\n          if (section.fields != null) {\n            this.parseFields(section.fields, cipher, \"n\", \"v\", \"t\");\n          }\n        });\n      }\n    }\n  }\n\n  private parsePasswordHistory(items: any[], cipher: CipherView) {\n    const maxSize = items.length > 5 ? 5 : items.length;\n    cipher.passwordHistory = items\n      .filter((h: any) => !this.isNullOrWhitespace(h.value) && h.time != null)\n      .sort((a, b) => b.time - a.time)\n      .slice(0, maxSize)\n      .map((h: any) => {\n        const ph = new PasswordHistoryView();\n        ph.password = h.value;\n        ph.lastUsedDate = new Date((\"\" + h.time).length >= 13 ? h.time : h.time * 1000);\n        return ph;\n      });\n  }\n\n  private parseFields(\n    fields: any[],\n    cipher: CipherView,\n    designationKey: string,\n    valueKey: string,\n    nameKey: string,\n  ) {\n    fields.forEach((field: any) => {\n      if (field[valueKey] == null || field[valueKey].toString().trim() === \"\") {\n        return;\n      }\n\n      // TODO: when date FieldType exists, store this as a date field type instead of formatted Text if k is 'date'\n      const fieldValue =\n        field.k === \"date\"\n          ? new Date(field[valueKey] * 1000).toUTCString()\n          : field[valueKey].toString();\n      const fieldDesignation =\n        field[designationKey] != null ? field[designationKey].toString() : null;\n\n      if (cipher.type === CipherType.Login) {\n        if (this.isNullOrWhitespace(cipher.login.username) && fieldDesignation === \"username\") {\n          cipher.login.username = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.login.password) &&\n          fieldDesignation === \"password\"\n        ) {\n          cipher.login.password = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.login.totp) &&\n          fieldDesignation != null &&\n          fieldDesignation.startsWith(\"TOTP_\")\n        ) {\n          cipher.login.totp = fieldValue;\n          return;\n        }\n      } else if (cipher.type === CipherType.Card) {\n        if (this.isNullOrWhitespace(cipher.card.number) && fieldDesignation === \"ccnum\") {\n          cipher.card.number = fieldValue;\n          cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n          return;\n        } else if (this.isNullOrWhitespace(cipher.card.code) && fieldDesignation === \"cvv\") {\n          cipher.card.code = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.card.cardholderName) &&\n          fieldDesignation === \"cardholder\"\n        ) {\n          cipher.card.cardholderName = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.card.expiration) &&\n          fieldDesignation === \"expiry\" &&\n          fieldValue.length === 6\n        ) {\n          cipher.card.expMonth = (fieldValue as string).substr(4, 2);\n          if (cipher.card.expMonth[0] === \"0\") {\n            cipher.card.expMonth = cipher.card.expMonth.substr(1, 1);\n          }\n          cipher.card.expYear = (fieldValue as string).substr(0, 4);\n          return;\n        } else if (fieldDesignation === \"type\") {\n          // Skip since brand was determined from number above\n          return;\n        }\n      } else if (cipher.type === CipherType.Identity) {\n        const identity = cipher.identity;\n        if (this.isNullOrWhitespace(identity.firstName) && fieldDesignation === \"firstname\") {\n          identity.firstName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.lastName) && fieldDesignation === \"lastname\") {\n          identity.lastName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.middleName) && fieldDesignation === \"initial\") {\n          identity.middleName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.phone) && fieldDesignation === \"defphone\") {\n          identity.phone = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.company) && fieldDesignation === \"company\") {\n          identity.company = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.email) && fieldDesignation === \"email\") {\n          identity.email = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.username) && fieldDesignation === \"username\") {\n          identity.username = fieldValue;\n          return;\n        } else if (fieldDesignation === \"address\") {\n          // fieldValue is an object casted into a string, so access the plain value instead\n          const { street, city, country, zip } = field[valueKey];\n          identity.address1 = this.getValueOrDefault(street);\n          identity.city = this.getValueOrDefault(city);\n          if (!this.isNullOrWhitespace(country)) {\n            identity.country = country.toUpperCase();\n          }\n          identity.postalCode = this.getValueOrDefault(zip);\n          return;\n        }\n      }\n\n      const fieldName = this.isNullOrWhitespace(field[nameKey]) ? \"no_name\" : field[nameKey];\n      if (\n        fieldName === \"password\" &&\n        cipher.passwordHistory != null &&\n        cipher.passwordHistory.some((h) => h.password === fieldValue)\n      ) {\n        return;\n      }\n\n      const fieldType = field.k === \"concealed\" ? FieldType.Hidden : FieldType.Text;\n      this.processKvp(cipher, fieldName, fieldValue, fieldType);\n    });\n  }\n}\n","export interface ExportData {\n  accounts?: AccountsEntity[] | null;\n}\nexport interface AccountsEntity {\n  attrs: AccountAttributes;\n  vaults?: VaultsEntity[] | null;\n}\nexport interface AccountAttributes {\n  accountName: string;\n  name: string;\n  avatar: string;\n  email: string;\n  uuid: string;\n  domain: string;\n}\nexport interface VaultsEntity {\n  attrs: VaultAttributes;\n  items?: Item[] | null;\n}\nexport interface VaultAttributes {\n  uuid: string;\n  desc: string;\n  avatar: string;\n  name: string;\n  type: string;\n}\n\nexport enum CategoryEnum {\n  Login = \"001\",\n  CreditCard = \"002\",\n  SecureNote = \"003\",\n  Identity = \"004\",\n  Password = \"005\",\n  Document = \"006\",\n  SoftwareLicense = \"100\",\n  BankAccount = \"101\",\n  Database = \"102\",\n  DriversLicense = \"103\",\n  OutdoorLicense = \"104\",\n  Membership = \"105\",\n  Passport = \"106\",\n  RewardsProgram = \"107\",\n  SocialSecurityNumber = \"108\",\n  WirelessRouter = \"109\",\n  Server = \"110\",\n  EmailAccount = \"111\",\n  API_Credential = \"112\",\n  MedicalRecord = \"113\",\n}\n\nexport interface Item {\n  uuid: string;\n  favIndex: number;\n  createdAt: number;\n  updatedAt: number;\n  trashed?: boolean;\n  categoryUuid: string;\n  details: Details;\n  overview: Overview;\n}\nexport interface Details {\n  loginFields?: (LoginFieldsEntity | null)[] | null;\n  notesPlain?: string | null;\n  sections?: (SectionsEntity | null)[] | null;\n  passwordHistory?: (PasswordHistoryEntity | null)[] | null;\n  documentAttributes?: DocumentAttributes | null;\n  password?: string | null;\n}\n\nexport enum LoginFieldTypeEnum {\n  TextOrHtml = \"T\",\n  EmailAddress = \"E\",\n  URL = \"U\",\n  Number = \"N\",\n  Password = \"P\",\n  TextArea = \"A\",\n  PhoneNumber = \"TEL\",\n  CheckBox = \"C\",\n}\nexport interface LoginFieldsEntity {\n  value: string;\n  id: string;\n  name: string;\n  fieldType: LoginFieldTypeEnum | string;\n  designation?: string | null;\n}\nexport interface SectionsEntity {\n  title: string;\n  name?: string | null;\n  fields?: FieldsEntity[] | null;\n}\nexport interface FieldsEntity {\n  title: string;\n  id: string;\n  value: Value;\n  indexAtSource: number;\n  guarded: boolean;\n  multiline: boolean;\n  dontGenerate: boolean;\n  placeholder?: string;\n  inputTraits: InputTraits;\n  clipboardFilter?: string | null;\n}\nexport interface Value {\n  totp?: string | null;\n  date?: number | null;\n  string?: string | null;\n  concealed?: string | null;\n  email?: Email | null;\n  phone?: string | null;\n  menu?: string | null;\n  gender?: string | null;\n  monthYear?: number | null;\n  url?: string | null;\n  address?: Address | null;\n  creditCardType?: string | null;\n  creditCardNumber?: string | null;\n  reference?: string | null;\n}\n\nexport interface Email {\n  email_address: string;\n  provider: string;\n}\n\nexport interface Address {\n  street: string;\n  city: string;\n  country: string;\n  zip: string;\n  state: string;\n}\nexport interface InputTraits {\n  keyboard: string;\n  correction: string;\n  capitalization: string;\n}\nexport interface PasswordHistoryEntity {\n  value: string;\n  time: number;\n}\nexport interface DocumentAttributes {\n  fileName: string;\n  documentId: string;\n  decryptedSize: number;\n}\nexport interface Overview {\n  subtitle: string;\n  title: string;\n  url: string;\n  urls?: UrlsEntity[] | null;\n  ps?: number | null;\n  pbe?: number | null;\n  pgrng?: boolean | null;\n  tags?: string[] | null;\n}\nexport interface UrlsEntity {\n  label: string;\n  url: string;\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { PasswordHistoryView } from \"@bitwarden/common/vault/models/view/password-history.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  CategoryEnum,\n  Details,\n  ExportData,\n  FieldsEntity,\n  Item,\n  LoginFieldTypeEnum,\n  Overview,\n  PasswordHistoryEntity,\n  SectionsEntity,\n  UrlsEntity,\n  Value,\n  VaultsEntity,\n} from \"./types/onepassword-1pux-importer-types\";\n\nexport class OnePassword1PuxImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    const exportData: ExportData = JSON.parse(data);\n\n    const account = exportData.accounts[0];\n    // TODO Add handling of multiple vaults\n    // const personalVaults = account.vaults[0].filter((v) => v.attrs.type === VaultAttributeTypeEnum.Personal);\n    account.vaults.forEach((vault: VaultsEntity) => {\n      vault.items.forEach((item: Item) => {\n        if (item.trashed === true) {\n          return;\n        }\n\n        const cipher = this.initLoginCipher();\n\n        const category = item.categoryUuid as CategoryEnum;\n        switch (category) {\n          case CategoryEnum.Login:\n          case CategoryEnum.Database:\n          case CategoryEnum.Password:\n          case CategoryEnum.WirelessRouter:\n          case CategoryEnum.Server:\n          case CategoryEnum.API_Credential:\n            cipher.type = CipherType.Login;\n            cipher.login = new LoginView();\n            break;\n          case CategoryEnum.CreditCard:\n          case CategoryEnum.BankAccount:\n            cipher.type = CipherType.Card;\n            cipher.card = new CardView();\n            break;\n          case CategoryEnum.SecureNote:\n          case CategoryEnum.SoftwareLicense:\n          case CategoryEnum.EmailAccount:\n          case CategoryEnum.MedicalRecord:\n            // case CategoryEnum.Document:\n            cipher.type = CipherType.SecureNote;\n            cipher.secureNote = new SecureNoteView();\n            cipher.secureNote.type = SecureNoteType.Generic;\n            break;\n          case CategoryEnum.Identity:\n          case CategoryEnum.DriversLicense:\n          case CategoryEnum.OutdoorLicense:\n          case CategoryEnum.Membership:\n          case CategoryEnum.Passport:\n          case CategoryEnum.RewardsProgram:\n          case CategoryEnum.SocialSecurityNumber:\n            cipher.type = CipherType.Identity;\n            cipher.identity = new IdentityView();\n            break;\n          default:\n            break;\n        }\n\n        cipher.favorite = item.favIndex === 1 ? true : false;\n\n        this.processOverview(item.overview, cipher);\n\n        this.processLoginFields(item, cipher);\n\n        this.processDetails(category, item.details, cipher);\n\n        this.parsePasswordHistory(item.details.passwordHistory, cipher);\n\n        this.processSections(category, item.details.sections, cipher);\n\n        if (!this.isNullOrWhitespace(item.details.notesPlain)) {\n          cipher.notes = item.details.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n        }\n\n        this.convertToNoteIfNeeded(cipher);\n        this.cleanupCipher(cipher);\n        this.result.ciphers.push(cipher);\n      });\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(this.result);\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processOverview(overview: Overview, cipher: CipherView) {\n    if (overview == null) {\n      return;\n    }\n\n    cipher.name = this.getValueOrDefault(overview.title);\n\n    if (overview.urls != null) {\n      const urls: string[] = [];\n      overview.urls.forEach((url: UrlsEntity) => {\n        if (!this.isNullOrWhitespace(url.url)) {\n          urls.push(url.url);\n        }\n      });\n      cipher.login.uris = this.makeUriArray(urls);\n    }\n\n    if (overview.tags != null && overview.tags.length > 0) {\n      const folderName = this.capitalize(overview.tags[0]);\n      this.processFolder(this.result, folderName);\n    }\n  }\n\n  private capitalize(inputString: string): string {\n    return inputString.trim().replace(/\\w\\S*/g, (w) => w.replace(/^\\w/, (c) => c.toUpperCase()));\n  }\n\n  private processLoginFields(item: Item, cipher: CipherView) {\n    if (item.details == null) {\n      return;\n    }\n\n    if (item.details.loginFields == null || item.details.loginFields.length === 0) {\n      return;\n    }\n\n    item.details.loginFields.forEach((loginField) => {\n      if (loginField.designation === \"username\" && loginField.value !== \"\") {\n        cipher.type = CipherType.Login;\n        cipher.login.username = loginField.value;\n        return;\n      }\n\n      if (loginField.designation === \"password\" && loginField.value !== \"\") {\n        cipher.type = CipherType.Login;\n        cipher.login.password = loginField.value;\n        return;\n      }\n\n      let fieldValue = loginField.value;\n      let fieldType: FieldType = FieldType.Text;\n      switch (loginField.fieldType) {\n        case LoginFieldTypeEnum.Password:\n          fieldType = FieldType.Hidden;\n          break;\n        case LoginFieldTypeEnum.CheckBox:\n          fieldValue = loginField.value !== \"\" ? \"true\" : \"false\";\n          fieldType = FieldType.Boolean;\n          break;\n        default:\n          break;\n      }\n      this.processKvp(cipher, loginField.name, fieldValue, fieldType);\n    });\n  }\n\n  private processDetails(category: CategoryEnum, details: Details, cipher: CipherView) {\n    if (category !== CategoryEnum.Password) {\n      return;\n    }\n\n    if (details == null) {\n      return;\n    }\n    cipher.login.password = details.password;\n  }\n\n  private processSections(category: CategoryEnum, sections: SectionsEntity[], cipher: CipherView) {\n    if (sections == null || sections.length === 0) {\n      return;\n    }\n\n    sections.forEach((section: SectionsEntity) => {\n      if (section.fields == null) {\n        return;\n      }\n\n      this.parseSectionFields(category, section.fields, cipher, section.title);\n    });\n  }\n\n  private parseSectionFields(\n    category: CategoryEnum,\n    fields: FieldsEntity[],\n    cipher: CipherView,\n    sectionTitle: string,\n  ) {\n    fields.forEach((field: FieldsEntity) => {\n      const valueKey = Object.keys(field.value)[0];\n      const anyField = field as any;\n\n      if (\n        anyField.value == null ||\n        anyField.value[valueKey] == null ||\n        anyField.value[valueKey] === \"\"\n      ) {\n        return;\n      }\n\n      const fieldName = this.getFieldName(field.title, sectionTitle);\n      const fieldValue = this.extractValue(field.value, valueKey);\n\n      if (cipher.type === CipherType.Login) {\n        if (this.fillLogin(field, fieldValue, cipher)) {\n          return;\n        }\n\n        switch (category) {\n          case CategoryEnum.Login:\n          case CategoryEnum.Database:\n          case CategoryEnum.EmailAccount:\n          case CategoryEnum.WirelessRouter:\n            break;\n\n          case CategoryEnum.Server:\n            if (this.isNullOrWhitespace(cipher.login.uri) && field.id === \"url\") {\n              cipher.login.uris = this.makeUriArray(fieldValue);\n              return;\n            }\n            break;\n\n          case CategoryEnum.API_Credential:\n            if (this.fillApiCredentials(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          default:\n            break;\n        }\n      } else if (cipher.type === CipherType.Card) {\n        if (this.fillCreditCard(field, fieldValue, cipher)) {\n          return;\n        }\n\n        if (category === CategoryEnum.BankAccount) {\n          if (this.fillBankAccount(field, fieldValue, cipher)) {\n            return;\n          }\n        }\n      } else if (cipher.type === CipherType.Identity) {\n        if (this.fillIdentity(field, fieldValue, cipher, valueKey)) {\n          return;\n        }\n        if (valueKey === \"address\") {\n          // fieldValue is an object casted into a string, so access the plain value instead\n          const { street, city, country, zip, state } = field.value.address;\n          cipher.identity.address1 = this.getValueOrDefault(street);\n          cipher.identity.city = this.getValueOrDefault(city);\n          if (!this.isNullOrWhitespace(country)) {\n            cipher.identity.country = country.toUpperCase();\n          }\n          cipher.identity.postalCode = this.getValueOrDefault(zip);\n          cipher.identity.state = this.getValueOrDefault(state);\n          return;\n        }\n\n        switch (category) {\n          case CategoryEnum.Identity:\n            break;\n          case CategoryEnum.DriversLicense:\n            if (this.fillDriversLicense(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.OutdoorLicense:\n            if (this.fillOutdoorLicense(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.Membership:\n            if (this.fillMembership(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.Passport:\n            if (this.fillPassport(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.RewardsProgram:\n            if (this.fillRewardsProgram(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.SocialSecurityNumber:\n            if (this.fillSSN(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          default:\n            break;\n        }\n      }\n\n      if (valueKey === \"email\") {\n        // fieldValue is an object casted into a string, so access the plain value instead\n        const { email_address, provider } = field.value.email;\n        this.processKvp(cipher, fieldName, email_address, FieldType.Text);\n        this.processKvp(cipher, \"provider\", provider, FieldType.Text);\n        return;\n      }\n\n      // Do not include a password field if it's already in the history\n      if (\n        field.title === \"password\" &&\n        cipher.passwordHistory != null &&\n        cipher.passwordHistory.some((h) => h.password === fieldValue)\n      ) {\n        return;\n      }\n\n      // TODO ?? If one of the fields is marked as guarded, then activate Password-Reprompt for the entire item\n      if (field.guarded && cipher.reprompt === CipherRepromptType.None) {\n        cipher.reprompt = CipherRepromptType.Password;\n      }\n\n      const fieldType = valueKey === \"concealed\" ? FieldType.Hidden : FieldType.Text;\n      this.processKvp(cipher, fieldName, fieldValue, fieldType);\n    });\n  }\n\n  // Use the title if available. If not use the sectionTitle if available.\n  // Default to an empty string in all other cases.\n  private getFieldName(title: string, sectionTitle?: string): string {\n    if (!this.isNullOrWhitespace(title)) {\n      return title;\n    }\n\n    if (!this.isNullOrWhitespace(sectionTitle)) {\n      return sectionTitle;\n    }\n\n    return \"\";\n  }\n\n  private extractValue(value: Value, valueKey: string): string {\n    if (valueKey === \"date\") {\n      return new Date(value.date * 1000).toUTCString();\n    }\n\n    if (valueKey === \"monthYear\") {\n      return value.monthYear.toString();\n    }\n\n    return (value as any)[valueKey];\n  }\n\n  private fillLogin(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    const fieldName = this.getFieldName(field.title);\n\n    if (this.isNullOrWhitespace(cipher.login.username) && fieldName === \"username\") {\n      cipher.login.username = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.login.password) && fieldName === \"password\") {\n      cipher.login.password = fieldValue;\n      return true;\n    }\n\n    if (\n      this.isNullOrWhitespace(cipher.login.totp) &&\n      field.id != null &&\n      field.id.startsWith(\"TOTP_\")\n    ) {\n      cipher.login.totp = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillApiCredentials(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    const fieldName = this.getFieldName(field.title);\n\n    if (this.isNullOrWhitespace(cipher.login.password) && fieldName === \"credential\") {\n      cipher.login.password = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.login.uri) && fieldName === \"hostname\") {\n      cipher.login.uris = this.makeUriArray(fieldValue);\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillCreditCard(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.card.number) && field.id === \"ccnum\") {\n      cipher.card.number = fieldValue;\n      cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.code) && field.id === \"cvv\") {\n      cipher.card.code = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.cardholderName) && field.id === \"cardholder\") {\n      cipher.card.cardholderName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.expiration) && field.id === \"expiry\") {\n      const monthYear: string = fieldValue.toString().trim();\n      cipher.card.expMonth = monthYear.substring(4, 6);\n      if (cipher.card.expMonth[0] === \"0\") {\n        cipher.card.expMonth = cipher.card.expMonth.substring(1, 2);\n      }\n      cipher.card.expYear = monthYear.substring(0, 4);\n      return true;\n    }\n\n    if (field.id === \"type\") {\n      // Skip since brand was determined from number above\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillBankAccount(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.card.cardholderName) && field.id === \"owner\") {\n      cipher.card.cardholderName = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillIdentity(\n    field: FieldsEntity,\n    fieldValue: string,\n    cipher: CipherView,\n    valueKey: string,\n  ): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"firstname\") {\n      cipher.identity.firstName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.lastName) && field.id === \"lastname\") {\n      cipher.identity.lastName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.middleName) && field.id === \"initial\") {\n      cipher.identity.middleName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.phone) && field.id === \"defphone\") {\n      cipher.identity.phone = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"company\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.email)) {\n      if (valueKey === \"email\") {\n        const { email_address, provider } = field.value.email;\n        cipher.identity.email = this.getValueOrDefault(email_address);\n        this.processKvp(cipher, \"provider\", provider, FieldType.Text);\n        return true;\n      }\n\n      if (field.id === \"email\") {\n        cipher.identity.email = fieldValue;\n        return true;\n      }\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.username) && field.id === \"username\") {\n      cipher.identity.username = fieldValue;\n      return true;\n    }\n    return false;\n  }\n\n  private fillDriversLicense(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"fullname\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.address1) && field.id === \"address\") {\n      cipher.identity.address1 = fieldValue;\n      return true;\n    }\n\n    // TODO ISO code\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.state) && field.id === \"state\") {\n      cipher.identity.state = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.licenseNumber) && field.id === \"number\") {\n      cipher.identity.licenseNumber = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillOutdoorLicense(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    // TODO ISO code\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.state) && field.id === \"state\") {\n      cipher.identity.state = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillMembership(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"member_name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"org_name\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.phone) && field.id === \"phone\") {\n      cipher.identity.phone = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillPassport(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"fullname\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    // TODO Iso\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"issuing_country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.passportNumber) && field.id === \"number\") {\n      cipher.identity.passportNumber = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillRewardsProgram(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"member_name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"company_name\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillSSN(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.ssn) && field.id === \"number\") {\n      cipher.identity.ssn = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private parsePasswordHistory(historyItems: PasswordHistoryEntity[], cipher: CipherView) {\n    if (historyItems == null || historyItems.length === 0) {\n      return;\n    }\n\n    const maxSize = historyItems.length > 5 ? 5 : historyItems.length;\n    cipher.passwordHistory = historyItems\n      .filter((h: any) => !this.isNullOrWhitespace(h.value) && h.time != null)\n      .sort((a, b) => b.time - a.time)\n      .slice(0, maxSize)\n      .map((h: any) => {\n        const ph = new PasswordHistoryView();\n        ph.password = h.value;\n        ph.lastUsedDate = new Date((\"\" + h.time).length >= 13 ? h.time : h.time * 1000);\n        return ph;\n      });\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nexport class CipherImportContext {\n  lowerProperty: string;\n  constructor(\n    public importRecord: any,\n    public property: string,\n    public cipher: CipherView,\n  ) {\n    this.lowerProperty = property.toLowerCase();\n  }\n}\n","import { FieldType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { CipherImportContext } from \"./cipher-import-context\";\n\nexport const IgnoredProperties = [\n  \"ainfo\",\n  \"autosubmit\",\n  \"notesplain\",\n  \"ps\",\n  \"scope\",\n  \"tags\",\n  \"title\",\n  \"uuid\",\n  \"notes\",\n];\n\nexport abstract class OnePasswordCsvImporter extends BaseImporter implements Importer {\n  protected loginPropertyParsers = [\n    this.setLoginUsername,\n    this.setLoginPassword,\n    this.setLoginUris,\n  ];\n  protected creditCardPropertyParsers = [\n    this.setCreditCardNumber,\n    this.setCreditCardVerification,\n    this.setCreditCardCardholderName,\n    this.setCreditCardExpiry,\n  ];\n  protected identityPropertyParsers = [\n    this.setIdentityFirstName,\n    this.setIdentityInitial,\n    this.setIdentityLastName,\n    this.setIdentityUserName,\n    this.setIdentityEmail,\n    this.setIdentityPhone,\n    this.setIdentityCompany,\n  ];\n\n  abstract setCipherType(value: any, cipher: CipherView): void;\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true, {\n      quoteChar: '\"',\n      escapeChar: \"\\\\\",\n    });\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.isNullOrWhitespace(this.getProp(value, \"title\"))) {\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(this.getProp(value, \"title\"), \"--\");\n\n      this.setNotes(value, cipher);\n\n      this.setCipherType(value, cipher);\n\n      let altUsername: string = null;\n      for (const property in value) {\n        // eslint-disable-next-line\n        if (!value.hasOwnProperty(property) || this.isNullOrWhitespace(value[property])) {\n          continue;\n        }\n\n        const context = new CipherImportContext(value, property, cipher);\n        if (cipher.type === CipherType.Login && this.setKnownLoginValue(context)) {\n          continue;\n        } else if (cipher.type === CipherType.Card && this.setKnownCreditCardValue(context)) {\n          continue;\n        } else if (cipher.type === CipherType.Identity && this.setKnownIdentityValue(context)) {\n          continue;\n        }\n\n        altUsername = this.setUnknownValue(context, altUsername);\n      }\n\n      if (\n        cipher.type === CipherType.Login &&\n        !this.isNullOrWhitespace(altUsername) &&\n        this.isNullOrWhitespace(cipher.login.username) &&\n        altUsername.indexOf(\"://\") === -1\n      ) {\n        cipher.login.username = altUsername;\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  protected getProp(obj: any, name: string): any {\n    const lowerObj = Object.entries(obj).reduce((agg: any, entry: [string, any]) => {\n      agg[entry[0].toLowerCase()] = entry[1];\n      return agg;\n    }, {});\n    return lowerObj[name.toLowerCase()];\n  }\n\n  protected getPropByRegexp(obj: any, regexp: RegExp): any {\n    const matchingKeys = Object.keys(obj).reduce((agg: string[], key: string) => {\n      if (key.match(regexp)) {\n        agg.push(key);\n      }\n      return agg;\n    }, []);\n    if (matchingKeys.length === 0) {\n      return null;\n    } else {\n      return obj[matchingKeys[0]];\n    }\n  }\n\n  protected getPropIncluding(obj: any, name: string): any {\n    const includesMap = Object.keys(obj).reduce((agg: string[], entry: string) => {\n      if (entry.toLowerCase().includes(name.toLowerCase())) {\n        agg.push(entry);\n      }\n      return agg;\n    }, []);\n    if (includesMap.length === 0) {\n      return null;\n    } else {\n      return obj[includesMap[0]];\n    }\n  }\n\n  protected setNotes(importRecord: any, cipher: CipherView) {\n    cipher.notes =\n      this.getValueOrDefault(this.getProp(importRecord, \"notesPlain\"), \"\") +\n      \"\\n\" +\n      this.getValueOrDefault(this.getProp(importRecord, \"notes\"), \"\") +\n      \"\\n\";\n    cipher.notes.trim();\n  }\n\n  protected setKnownLoginValue(context: CipherImportContext): boolean {\n    return this.loginPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setKnownCreditCardValue(context: CipherImportContext): boolean {\n    return this.creditCardPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setKnownIdentityValue(context: CipherImportContext): boolean {\n    return this.identityPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setUnknownValue(context: CipherImportContext, altUsername: string): string {\n    if (\n      IgnoredProperties.indexOf(context.lowerProperty) === -1 &&\n      !context.lowerProperty.startsWith(\"section:\") &&\n      !context.lowerProperty.startsWith(\"section \")\n    ) {\n      if (altUsername == null && context.lowerProperty === \"email\") {\n        return context.importRecord[context.property];\n      } else if (\n        context.lowerProperty === \"created date\" ||\n        context.lowerProperty === \"modified date\"\n      ) {\n        const readableDate = new Date(\n          parseInt(context.importRecord[context.property], 10) * 1000,\n        ).toUTCString();\n        this.processKvp(context.cipher, \"1Password \" + context.property, readableDate);\n        return null;\n      }\n      if (\n        context.lowerProperty.includes(\"password\") ||\n        context.lowerProperty.includes(\"key\") ||\n        context.lowerProperty.includes(\"secret\")\n      ) {\n        this.processKvp(\n          context.cipher,\n          context.property,\n          context.importRecord[context.property],\n          FieldType.Hidden,\n        );\n      } else {\n        this.processKvp(context.cipher, context.property, context.importRecord[context.property]);\n      }\n    }\n    return null;\n  }\n\n  protected setIdentityFirstName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.firstName) &&\n      context.lowerProperty.includes(\"first name\")\n    ) {\n      context.cipher.identity.firstName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityInitial(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.middleName) &&\n      context.lowerProperty.includes(\"initial\")\n    ) {\n      context.cipher.identity.middleName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityLastName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.lastName) &&\n      context.lowerProperty.includes(\"last name\")\n    ) {\n      context.cipher.identity.lastName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityUserName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.username) &&\n      context.lowerProperty.includes(\"username\")\n    ) {\n      context.cipher.identity.username = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityCompany(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.company) &&\n      context.lowerProperty.includes(\"company\")\n    ) {\n      context.cipher.identity.company = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityPhone(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.phone) &&\n      context.lowerProperty.includes(\"default phone\")\n    ) {\n      context.cipher.identity.phone = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityEmail(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.email) &&\n      context.lowerProperty.includes(\"email\")\n    ) {\n      context.cipher.identity.email = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardNumber(context: CipherImportContext): boolean {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.number) &&\n      context.lowerProperty.includes(\"number\")\n    ) {\n      context.cipher.card.number = context.importRecord[context.property];\n      context.cipher.card.brand = CardView.getCardBrandByPatterns(context.cipher.card.number);\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardVerification(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.code) &&\n      context.lowerProperty.includes(\"verification number\")\n    ) {\n      context.cipher.card.code = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardCardholderName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.cardholderName) &&\n      context.lowerProperty.includes(\"cardholder name\")\n    ) {\n      context.cipher.card.cardholderName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardExpiry(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.expiration) &&\n      context.lowerProperty.includes(\"expiry date\") &&\n      context.importRecord[context.property].length === 7\n    ) {\n      context.cipher.card.expMonth = (context.importRecord[context.property] as string).substr(\n        0,\n        2,\n      );\n      if (context.cipher.card.expMonth[0] === \"0\") {\n        context.cipher.card.expMonth = context.cipher.card.expMonth.substr(1, 1);\n      }\n      context.cipher.card.expYear = (context.importRecord[context.property] as string).substr(3, 4);\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginPassword(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.login.password) &&\n      context.lowerProperty === \"password\"\n    ) {\n      context.cipher.login.password = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginUsername(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.login.username) &&\n      context.lowerProperty === \"username\"\n    ) {\n      context.cipher.login.username = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginUris(context: CipherImportContext) {\n    if (\n      (context.cipher.login.uris == null || context.cipher.login.uris.length === 0) &&\n      context.lowerProperty === \"urls\"\n    ) {\n      const urls = context.importRecord[context.property].split(this.newLineRegex);\n      context.cipher.login.uris = this.makeUriArray(urls);\n      return true;\n    } else if (context.lowerProperty === \"url\") {\n      if (context.cipher.login.uris == null) {\n        context.cipher.login.uris = [];\n      }\n      context.cipher.login.uris.concat(this.makeUriArray(context.importRecord[context.property]));\n      return true;\n    }\n    return false;\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\n\nimport { Importer } from \"../importer\";\n\nimport { IgnoredProperties, OnePasswordCsvImporter } from \"./onepassword-csv-importer\";\n\nexport class OnePasswordMacCsvImporter extends OnePasswordCsvImporter implements Importer {\n  setCipherType(value: any, cipher: CipherView) {\n    const onePassType = this.getValueOrDefault(this.getProp(value, \"type\"), \"Login\");\n    switch (onePassType) {\n      case \"Credit Card\":\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        IgnoredProperties.push(\"type\");\n        break;\n      case \"Identity\":\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n        IgnoredProperties.push(\"type\");\n        break;\n      case \"Login\":\n      case \"Secure Note\":\n        IgnoredProperties.push(\"type\");\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { Importer } from \"../importer\";\n\nimport { CipherImportContext } from \"./cipher-import-context\";\nimport { OnePasswordCsvImporter } from \"./onepassword-csv-importer\";\n\nexport class OnePasswordWinCsvImporter extends OnePasswordCsvImporter implements Importer {\n  constructor() {\n    super();\n    this.identityPropertyParsers.push(this.setIdentityAddress);\n  }\n\n  setCipherType(value: any, cipher: CipherView) {\n    cipher.type = CipherType.Login;\n    cipher.login = new LoginView();\n\n    if (\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /\\d+: number/i)) &&\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /\\d+: expiry date/i))\n    ) {\n      cipher.type = CipherType.Card;\n      cipher.card = new CardView();\n    }\n\n    if (\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: first name/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: initial/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: last name/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /internet \\d+: email/i))\n    ) {\n      cipher.type = CipherType.Identity;\n      cipher.identity = new IdentityView();\n    }\n  }\n\n  setIdentityAddress(context: CipherImportContext) {\n    if (context.lowerProperty.match(/address \\d+: address/i)) {\n      this.processKvp(context.cipher, \"address\", context.importRecord[context.property]);\n      return true;\n    }\n    return false;\n  }\n\n  setCreditCardExpiry(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.expiration) &&\n      context.lowerProperty.includes(\"expiry date\")\n    ) {\n      const expSplit = (context.importRecord[context.property] as string).split(\"/\");\n      context.cipher.card.expMonth = expSplit[0];\n      if (context.cipher.card.expMonth[0] === \"0\" && context.cipher.card.expMonth.length === 2) {\n        context.cipher.card.expMonth = context.cipher.card.expMonth.substr(1, 1);\n      }\n      context.cipher.card.expYear = expSplit[2].length > 4 ? expSplit[2].substr(0, 4) : expSplit[2];\n      return true;\n    }\n    return false;\n  }\n}\n","import { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PadlockCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let headers: string[] = null;\n    results.forEach((value) => {\n      if (headers == null) {\n        headers = value.map((v: string) => v);\n        return;\n      }\n\n      if (value.length < 2 || value.length !== headers.length) {\n        return;\n      }\n\n      if (!this.isNullOrWhitespace(value[1])) {\n        if (this.organization) {\n          const tags = (value[1] as string).split(\",\");\n          tags.forEach((tag) => {\n            tag = tag.trim();\n            let addCollection = true;\n            let collectionIndex = result.collections.length;\n\n            for (let i = 0; i < result.collections.length; i++) {\n              if (result.collections[i].name === tag) {\n                addCollection = false;\n                collectionIndex = i;\n                break;\n              }\n            }\n\n            if (addCollection) {\n              const collection = new CollectionView();\n              collection.name = tag;\n              result.collections.push(collection);\n            }\n\n            result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n          });\n        } else {\n          const tags = (value[1] as string).split(\",\");\n          const tag = tags.length > 0 ? tags[0].trim() : null;\n          this.processFolder(result, tag);\n        }\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      for (let i = 2; i < value.length; i++) {\n        const header = headers[i].trim().toLowerCase();\n        if (this.isNullOrWhitespace(value[i]) || this.isNullOrWhitespace(header)) {\n          continue;\n        }\n\n        if (this.usernameFieldNames.indexOf(header) > -1) {\n          cipher.login.username = value[i];\n        } else if (this.passwordFieldNames.indexOf(header) > -1) {\n          cipher.login.password = value[i];\n        } else if (this.uriFieldNames.indexOf(header) > -1) {\n          cipher.login.uris = this.makeUriArray(value[i]);\n        } else {\n          this.processKvp(cipher, headers[i], value[i]);\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PassKeepCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValue(\"category\", value));\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValue(\"description\", value);\n      cipher.name = this.getValueOrDefault(this.getValue(\"title\", value), \"--\");\n      cipher.login.username = this.getValue(\"username\", value);\n      cipher.login.password = this.getValue(\"password\", value);\n      cipher.login.uris = this.makeUriArray(this.getValue(\"site\", value));\n      this.processKvp(cipher, \"Password 2\", this.getValue(\"password2\", value));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private getValue(key: string, value: any) {\n    return this.getValueOrDefault(value[key], this.getValueOrDefault(value[\" \" + key]));\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { PasskyJsonExport } from \"./passky-json-types\";\n\nexport class PasskyJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const passkyExport: PasskyJsonExport = JSON.parse(data);\n    if (\n      passkyExport == null ||\n      passkyExport.passwords == null ||\n      passkyExport.passwords.length === 0\n    ) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (passkyExport.encrypted == true) {\n      result.success = false;\n      result.errorMessage = \"Unable to import an encrypted passky backup.\";\n      return Promise.resolve(result);\n    }\n\n    passkyExport.passwords.forEach((record) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = record.website;\n      cipher.login.username = record.username;\n      cipher.login.password = record.password;\n\n      cipher.login.uris = this.makeUriArray(record.website);\n      cipher.notes = record.message;\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PassmanJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((credential: any) => {\n      if (credential.tags != null && credential.tags.length > 0) {\n        const folderName = credential.tags[0].text;\n        this.processFolder(result, folderName);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = credential.label;\n\n      cipher.login.username = this.getValueOrDefault(credential.username);\n      if (this.isNullOrWhitespace(cipher.login.username)) {\n        cipher.login.username = this.getValueOrDefault(credential.email);\n      } else if (!this.isNullOrWhitespace(credential.email)) {\n        cipher.notes = \"Email: \" + credential.email + \"\\n\";\n      }\n\n      cipher.login.password = this.getValueOrDefault(credential.password);\n      cipher.login.uris = this.makeUriArray(credential.url);\n      cipher.notes += this.getValueOrDefault(credential.description, \"\");\n      if (credential.otp != null) {\n        cipher.login.totp = this.getValueOrDefault(credential.otp.secret);\n      }\n\n      if (credential.custom_fields != null) {\n        credential.custom_fields.forEach((customField: any) => {\n          switch (customField.field_type) {\n            case \"text\":\n            case \"password\":\n              this.processKvp(cipher, customField.label, customField.value);\n              break;\n          }\n        });\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasspackCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const tagsJson = !this.isNullOrWhitespace(value.Tags) ? JSON.parse(value.Tags) : null;\n      const tags: string[] =\n        tagsJson != null && tagsJson.tags != null && tagsJson.tags.length > 0\n          ? tagsJson.tags\n              .map((tagJson: string) => {\n                try {\n                  const t = JSON.parse(tagJson);\n                  return this.getValueOrDefault(t.tag);\n                } catch {\n                  // Ignore error\n                }\n                return null;\n              })\n              .filter((t: string) => !this.isNullOrWhitespace(t))\n          : null;\n\n      if (this.organization && tags != null && tags.length > 0) {\n        tags.forEach((tag) => {\n          let addCollection = true;\n          let collectionIndex = result.collections.length;\n\n          for (let i = 0; i < result.collections.length; i++) {\n            if (result.collections[i].name === tag) {\n              addCollection = false;\n              collectionIndex = i;\n              break;\n            }\n          }\n\n          if (addCollection) {\n            const collection = new CollectionView();\n            collection.name = tag;\n            result.collections.push(collection);\n          }\n\n          result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n        });\n      } else if (!this.organization && tags != null && tags.length > 0) {\n        this.processFolder(result, tags[0]);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Notes, \"\");\n      cipher.notes += \"\\n\\n\" + this.getValueOrDefault(value[\"Shared Notes\"], \"\") + \"\\n\";\n      cipher.name = this.getValueOrDefault(value[\"Entry Name\"], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[\"User ID\"]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n\n      if (value.__parsed_extra != null && value.__parsed_extra.length > 0) {\n        value.__parsed_extra.forEach((extra: string) => {\n          if (!this.isNullOrWhitespace(extra)) {\n            cipher.notes += \"\\n\" + extra;\n          }\n        });\n      }\n\n      const fieldsJson = !this.isNullOrWhitespace(value[\"Extra Fields\"])\n        ? JSON.parse(value[\"Extra Fields\"])\n        : null;\n      const fields =\n        fieldsJson != null && fieldsJson.extraFields != null && fieldsJson.extraFields.length > 0\n          ? fieldsJson.extraFields.map((fieldJson: string) => {\n              try {\n                return JSON.parse(fieldJson);\n              } catch {\n                // Ignore error\n              }\n              return null;\n            })\n          : null;\n      if (fields != null) {\n        fields.forEach((f: any) => {\n          if (f != null) {\n            this.processKvp(cipher, f.name, f.data);\n          }\n        });\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordAgentCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let newVersion = true;\n    results.forEach((value) => {\n      if (value.length !== 5 && value.length < 9) {\n        return;\n      }\n      const altFormat = value.length === 10 && value[0] === \"0\";\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[altFormat ? 1 : 0], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[altFormat ? 2 : 1]);\n      cipher.login.password = this.getValueOrDefault(value[altFormat ? 3 : 2]);\n      if (value.length === 5) {\n        newVersion = false;\n        cipher.notes = this.getValueOrDefault(value[4]);\n        cipher.login.uris = this.makeUriArray(value[3]);\n      } else {\n        const folder = this.getValueOrDefault(value[altFormat ? 9 : 8], \"(None)\");\n        let folderName = folder !== \"(None)\" ? folder.split(\"\\\\\").join(\"/\") : null;\n        if (folderName != null) {\n          folderName = folder.split(\" > \").join(\"/\");\n          folderName = folder.split(\">\").join(\"/\");\n        }\n        this.processFolder(result, folderName);\n        cipher.notes = this.getValueOrDefault(value[altFormat ? 5 : 3]);\n        cipher.login.uris = this.makeUriArray(value[4]);\n      }\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (newVersion && this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordBossJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.items == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, string>();\n    results.folders.forEach((value: any) => {\n      foldersMap.set(value.id, value.name);\n    });\n    const foldersIndexMap = new Map<string, number>();\n    foldersMap.forEach((val, key) => {\n      foldersIndexMap.set(key, result.folders.length);\n      const f = new FolderView();\n      f.name = val;\n      result.folders.push(f);\n    });\n\n    results.items.forEach((value: any) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.login.uris = this.makeUriArray(value.login_url);\n\n      if (value.folder != null && foldersIndexMap.has(value.folder)) {\n        result.folderRelationships.push([result.ciphers.length, foldersIndexMap.get(value.folder)]);\n      }\n\n      if (value.identifiers == null) {\n        return;\n      }\n\n      if (!this.isNullOrWhitespace(value.identifiers.notes)) {\n        cipher.notes = value.identifiers.notes.split(\"\\\\r\\\\n\").join(\"\\n\").split(\"\\\\n\").join(\"\\n\");\n      }\n\n      if (value.type === \"CreditCard\") {\n        cipher.card = new CardView();\n        cipher.type = CipherType.Card;\n      }\n\n      for (const property in value.identifiers) {\n        // eslint-disable-next-line\n        if (!value.identifiers.hasOwnProperty(property)) {\n          continue;\n        }\n        const valObj = value.identifiers[property];\n        const val = valObj != null ? valObj.toString() : null;\n        if (\n          this.isNullOrWhitespace(val) ||\n          property === \"notes\" ||\n          property === \"ignoreItemInSecurityScore\"\n        ) {\n          continue;\n        }\n\n        if (property === \"custom_fields\") {\n          valObj.forEach((cf: any) => {\n            this.processKvp(cipher, cf.name, cf.value);\n          });\n          continue;\n        }\n\n        if (cipher.type === CipherType.Card) {\n          if (property === \"cardNumber\") {\n            cipher.card.number = val;\n            cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n            continue;\n          } else if (property === \"nameOnCard\") {\n            cipher.card.cardholderName = val;\n            continue;\n          } else if (property === \"security_code\") {\n            cipher.card.code = val;\n            continue;\n          } else if (property === \"expires\") {\n            try {\n              const expDate = new Date(val);\n              cipher.card.expYear = expDate.getFullYear().toString();\n              cipher.card.expMonth = (expDate.getMonth() + 1).toString();\n            } catch {\n              // Ignore error\n            }\n            continue;\n          } else if (property === \"cardType\") {\n            continue;\n          }\n        } else {\n          if (\n            (property === \"username\" || property === \"email\") &&\n            this.isNullOrWhitespace(cipher.login.username)\n          ) {\n            cipher.login.username = val;\n            continue;\n          } else if (property === \"password\") {\n            cipher.login.password = val;\n            continue;\n          } else if (property === \"totp\") {\n            cipher.login.totp = val;\n            continue;\n          } else if (\n            (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n            this.uriFieldNames.indexOf(property) > -1\n          ) {\n            cipher.login.uris = this.makeUriArray(val);\n            continue;\n          }\n        }\n\n        this.processKvp(cipher, property, val);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordDragonXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const records = doc.querySelectorAll(\"PasswordManager > record\");\n    Array.from(records).forEach((record) => {\n      const category = this.querySelectorDirectChild(record, \"Category\");\n      const categoryText =\n        category != null &&\n        !this.isNullOrWhitespace(category.textContent) &&\n        category.textContent !== \"Unfiled\"\n          ? category.textContent\n          : null;\n      this.processFolder(result, categoryText);\n\n      const accountName = this.querySelectorDirectChild(record, \"Account-Name\");\n      const userId = this.querySelectorDirectChild(record, \"User-Id\");\n      const password = this.querySelectorDirectChild(record, \"Password\");\n      const url = this.querySelectorDirectChild(record, \"URL\");\n      const notes = this.querySelectorDirectChild(record, \"Notes\");\n      const cipher = this.initLoginCipher();\n      cipher.name =\n        accountName != null ? this.getValueOrDefault(accountName.textContent, \"--\") : \"--\";\n      cipher.notes = notes != null ? this.getValueOrDefault(notes.textContent) : \"\";\n      cipher.login.username = userId != null ? this.getValueOrDefault(userId.textContent) : null;\n      cipher.login.password =\n        password != null ? this.getValueOrDefault(password.textContent) : null;\n      cipher.login.uris = url != null ? this.makeUriArray(url.textContent) : null;\n\n      const attributes: string[] = [];\n      for (let i = 1; i <= 10; i++) {\n        attributes.push(\"Attribute-\" + i);\n      }\n\n      this.querySelectorAllDirectChild(record, attributes.join(\",\")).forEach((attr) => {\n        if (this.isNullOrWhitespace(attr.textContent) || attr.textContent === \"null\") {\n          return;\n        }\n        this.processKvp(cipher, attr.tagName, attr.textContent);\n      });\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\n/** This is the importer for the xml format from pwsafe.org  */\nexport class PasswordSafeXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const passwordSafe = doc.querySelector(\"passwordsafe\");\n    if (passwordSafe == null) {\n      result.errorMessage = \"Missing `passwordsafe` node.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const notesDelimiter = passwordSafe.getAttribute(\"delimiter\");\n    const entries = doc.querySelectorAll(\"passwordsafe > entry\");\n    Array.from(entries).forEach((entry) => {\n      const group = this.querySelectorDirectChild(entry, \"group\");\n      const groupText =\n        group != null && !this.isNullOrWhitespace(group.textContent)\n          ? group.textContent.split(\".\").join(\"/\")\n          : null;\n      this.processFolder(result, groupText);\n\n      const title = this.querySelectorDirectChild(entry, \"title\");\n      const username = this.querySelectorDirectChild(entry, \"username\");\n      const email = this.querySelectorDirectChild(entry, \"email\");\n      const password = this.querySelectorDirectChild(entry, \"password\");\n      const url = this.querySelectorDirectChild(entry, \"url\");\n      const notes = this.querySelectorDirectChild(entry, \"notes\");\n      const cipher = this.initLoginCipher();\n      cipher.name = title != null ? this.getValueOrDefault(title.textContent, \"--\") : \"--\";\n      cipher.notes =\n        notes != null\n          ? this.getValueOrDefault(notes.textContent, \"\").split(notesDelimiter).join(\"\\n\")\n          : null;\n      cipher.login.username =\n        username != null ? this.getValueOrDefault(username.textContent) : null;\n      cipher.login.password =\n        password != null ? this.getValueOrDefault(password.textContent) : null;\n      cipher.login.uris = url != null ? this.makeUriArray(url.textContent) : null;\n\n      if (this.isNullOrWhitespace(cipher.login.username) && email != null) {\n        cipher.login.username = this.getValueOrDefault(email.textContent);\n      } else if (email != null && !this.isNullOrWhitespace(email.textContent)) {\n        cipher.notes = this.isNullOrWhitespace(cipher.notes)\n          ? \"Email: \" + email.textContent\n          : cipher.notes + \"\\n\" + \"Email: \" + email.textContent;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordWalletTxtImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 1) {\n        return;\n      }\n      if (value.length > 5) {\n        this.processFolder(result, value[5]);\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      if (value.length > 4) {\n        cipher.notes = this.getValueOrDefault(value[4], \"\").split(\"¬\").join(\"\\n\");\n      }\n      if (value.length > 2) {\n        cipher.login.username = this.getValueOrDefault(value[2]);\n      }\n      if (value.length > 3) {\n        cipher.login.password = this.getValueOrDefault(value[3]);\n      }\n      if (value.length > 1) {\n        cipher.login.uris = this.makeUriArray(value[1]);\n      }\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","export type ProtonPassJsonFile = {\n  version: string;\n  userId: string;\n  encrypted: boolean;\n  vaults: Record<string, ProtonPassVault>;\n};\n\nexport type ProtonPassVault = {\n  name: string;\n  description: string;\n  display: {\n    color: number;\n    icon: number;\n  };\n  items: ProtonPassItem[];\n};\n\nexport type ProtonPassItem = {\n  itemId: string;\n  shareId: string;\n  data: ProtonPassItemData;\n  state: ProtonPassItemState;\n  aliasEmail: string | null;\n  contentFormatVersion: number;\n  createTime: number;\n  modifyTime: number;\n};\n\nexport enum ProtonPassItemState {\n  ACTIVE = 1,\n  TRASHED = 2,\n}\n\nexport type ProtonPassItemData = {\n  metadata: ProtonPassItemMetadata;\n  extraFields: ProtonPassItemExtraField[];\n  type: \"login\" | \"alias\" | \"creditCard\" | \"note\";\n  content: ProtonPassLoginItemContent | ProtonPassCreditCardItemContent;\n};\n\nexport type ProtonPassItemMetadata = {\n  name: string;\n  note: string;\n  itemUuid: string;\n};\n\nexport type ProtonPassItemExtraField = {\n  fieldName: string;\n  type: string;\n  data: ProtonPassItemExtraFieldData;\n};\n\nexport type ProtonPassItemExtraFieldData = {\n  content?: string;\n  totpUri?: string;\n};\n\nexport type ProtonPassLoginItemContent = {\n  username?: string;\n  password?: string;\n  urls?: string[];\n  totpUri?: string;\n};\n\nexport type ProtonPassCreditCardItemContent = {\n  cardholderName?: string;\n  cardType?: number;\n  number?: string;\n  verificationNumber?: string;\n  expirationDate?: string;\n  pin?: string;\n};\n","import { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  ProtonPassCreditCardItemContent,\n  ProtonPassItemState,\n  ProtonPassJsonFile,\n  ProtonPassLoginItemContent,\n} from \"./types/protonpass-json-type\";\n\nexport class ProtonPassJsonImporter extends BaseImporter implements Importer {\n  constructor(private i18nService: I18nService) {\n    super();\n  }\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: ProtonPassJsonFile = JSON.parse(data);\n    if (results == null || results.vaults == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results.encrypted) {\n      result.success = false;\n      result.errorMessage = this.i18nService.t(\"unsupportedEncryptedImport\");\n      return Promise.resolve(result);\n    }\n\n    for (const [, vault] of Object.entries(results.vaults)) {\n      for (const item of vault.items) {\n        if (item.state == ProtonPassItemState.TRASHED) {\n          continue;\n        }\n        this.processFolder(result, vault.name);\n\n        const cipher = this.initLoginCipher();\n        cipher.name = this.getValueOrDefault(item.data.metadata.name, \"--\");\n        cipher.notes = this.getValueOrDefault(item.data.metadata.note);\n\n        switch (item.data.type) {\n          case \"login\": {\n            const loginContent = item.data.content as ProtonPassLoginItemContent;\n            cipher.login.uris = this.makeUriArray(loginContent.urls);\n            cipher.login.username = this.getValueOrDefault(loginContent.username);\n            cipher.login.password = this.getValueOrDefault(loginContent.password);\n            cipher.login.totp = this.getValueOrDefault(loginContent.totpUri);\n            for (const extraField of item.data.extraFields) {\n              this.processKvp(\n                cipher,\n                extraField.fieldName,\n                extraField.type == \"totp\" ? extraField.data.totpUri : extraField.data.content,\n                extraField.type == \"text\" ? FieldType.Text : FieldType.Hidden,\n              );\n            }\n            break;\n          }\n          case \"note\":\n            cipher.type = CipherType.SecureNote;\n            cipher.secureNote = new SecureNoteView();\n            cipher.secureNote.type = SecureNoteType.Generic;\n            break;\n          case \"creditCard\": {\n            const creditCardContent = item.data.content as ProtonPassCreditCardItemContent;\n            cipher.type = CipherType.Card;\n            cipher.card = new CardView();\n            cipher.card.cardholderName = this.getValueOrDefault(creditCardContent.cardholderName);\n            cipher.card.number = this.getValueOrDefault(creditCardContent.number);\n            cipher.card.brand = CardView.getCardBrandByPatterns(creditCardContent.number);\n            cipher.card.code = this.getValueOrDefault(creditCardContent.verificationNumber);\n\n            if (!this.isNullOrWhitespace(creditCardContent.expirationDate)) {\n              cipher.card.expMonth = creditCardContent.expirationDate.substring(0, 2);\n              cipher.card.expMonth = cipher.card.expMonth.replace(/^0+/, \"\");\n              cipher.card.expYear = creditCardContent.expirationDate.substring(2, 6);\n            }\n\n            if (!this.isNullOrWhitespace(creditCardContent.pin)) {\n              this.processKvp(cipher, \"PIN\", creditCardContent.pin, FieldType.Hidden);\n            }\n\n            break;\n          }\n        }\n\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      }\n    }\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  AppPasswordEntry,\n  BookmarkEntry,\n  EnvironmentVariablesEntry,\n  FoldersEntity,\n  GPGEntry,\n  NotesEntry,\n  PsonoItemTypes,\n  PsonoJsonExport,\n  TOTPEntry,\n  WebsitePasswordEntry,\n} from \"./psono-json-types\";\n\nexport class PsonoJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const psonoExport: PsonoJsonExport = JSON.parse(data);\n    if (psonoExport == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    this.parseFolders(result, psonoExport.folders);\n    this.handleItemParsing(result, psonoExport.items);\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseFolders(result: ImportResult, folders: FoldersEntity[], parentName?: string) {\n    if (folders == null || folders.length === 0) {\n      return;\n    }\n\n    folders.forEach((folder) => {\n      const folderHasItems = folder.items != null && folder.items.length > 0;\n      const folderHasSubfolders = folder.folders != null && folder.folders.length > 0;\n\n      if (!folderHasItems && !folderHasSubfolders) {\n        return;\n      }\n\n      if (!Utils.isNullOrWhitespace(parentName)) {\n        folder.name = parentName + \"/\" + folder.name;\n      }\n\n      if (folderHasSubfolders) {\n        this.parseFolders(result, folder.folders, folder.name);\n      }\n\n      if (!folderHasItems) {\n        this.processFolder(result, folder.name, folderHasItems);\n      } else {\n        this.handleItemParsing(result, folder.items, folder.name);\n      }\n    });\n  }\n\n  private handleItemParsing(result: ImportResult, items?: PsonoItemTypes[], folderName?: string) {\n    if (items == null || items.length === 0) {\n      return;\n    }\n\n    items.forEach((record) => {\n      const cipher = this.parsePsonoItem(record);\n      this.processFolder(result, folderName, true);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n  }\n\n  private parsePsonoItem(item: PsonoItemTypes): CipherView {\n    const cipher = this.initLoginCipher();\n\n    switch (item.type) {\n      case \"website_password\":\n        this.parseWebsiteLogins(item, cipher);\n        break;\n      case \"application_password\":\n        this.parseApplicationPasswords(item, cipher);\n        break;\n      case \"environment_variables\":\n        this.parseEnvironmentVariables(item, cipher);\n        break;\n      case \"totp\":\n        this.parseTOTP(item, cipher);\n        break;\n      case \"bookmark\":\n        this.parseBookmarks(item, cipher);\n        break;\n      // Skipping this until we can save GPG into notes/custom fields\n      // case \"mail_gpg_own_key\":\n      //   this.parseGPG(item, cipher);\n      //   break;\n      case \"note\":\n        this.parseNotes(item, cipher);\n        break;\n      default:\n        break;\n    }\n\n    return cipher;\n  }\n\n  readonly WEBSITE_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"website_password_title\",\n    \"website_password_notes\",\n    \"website_password_username\",\n    \"website_password_password\",\n    \"website_password_url\",\n    \"autosubmit\",\n    \"website_password_auto_submit\",\n    \"urlfilter\",\n    \"website_password_url_filter\",\n  ]);\n  private parseWebsiteLogins(entry: WebsitePasswordEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"website_password\") {\n      return;\n    }\n\n    cipher.name = entry.website_password_title;\n    cipher.notes = entry.website_password_notes;\n\n    cipher.login.username = entry.website_password_username;\n    cipher.login.password = entry.website_password_password;\n\n    cipher.login.uris = this.makeUriArray(entry.website_password_url);\n\n    this.processKvp(\n      cipher,\n      \"website_password_auto_submit\",\n      entry.website_password_auto_submit?.toString(),\n      FieldType.Boolean,\n    );\n\n    this.processKvp(cipher, \"website_password_url_filter\", entry.website_password_url_filter);\n\n    this.importUnmappedFields(cipher, entry, this.WEBSITE_mappedValues);\n  }\n\n  readonly APP_PWD_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"application_password_title\",\n    \"application_password_notes\",\n    \"application_password_username\",\n    \"application_password_password\",\n  ]);\n  private parseApplicationPasswords(entry: AppPasswordEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"application_password\") {\n      return;\n    }\n\n    cipher.name = entry.application_password_title;\n    cipher.notes = entry.application_password_notes;\n\n    cipher.login.username = entry.application_password_username;\n    cipher.login.password = entry.application_password_password;\n\n    this.importUnmappedFields(cipher, entry, this.APP_PWD_mappedValues);\n  }\n\n  readonly BOOKMARK_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"bookmark_title\",\n    \"bookmark_notes\",\n    \"bookmark_url\",\n  ]);\n  private parseBookmarks(entry: BookmarkEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"bookmark\") {\n      return;\n    }\n\n    cipher.name = entry.bookmark_title;\n    cipher.notes = entry.bookmark_notes;\n\n    cipher.login.uris = this.makeUriArray(entry.bookmark_url);\n\n    this.importUnmappedFields(cipher, entry, this.BOOKMARK_mappedValues);\n  }\n\n  readonly NOTES_mappedValues = new Set([\"type\", \"name\", \"note_title\", \"note_notes\"]);\n  private parseNotes(entry: NotesEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"note\") {\n      return;\n    }\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.note_title;\n    cipher.notes = entry.note_notes;\n\n    this.importUnmappedFields(cipher, entry, this.NOTES_mappedValues);\n  }\n\n  readonly TOTP_mappedValues = new Set([\"type\", \"name\", \"totp_title\", \"totp_notes\", \"totp_code\"]);\n  private parseTOTP(entry: TOTPEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"totp\") {\n      return;\n    }\n\n    cipher.name = entry.totp_title;\n    cipher.notes = entry.totp_notes;\n\n    cipher.login.totp = entry.totp_code;\n\n    this.importUnmappedFields(cipher, entry, this.TOTP_mappedValues);\n  }\n\n  readonly ENV_VARIABLES_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"environment_variables_title\",\n    \"environment_variables_notes\",\n    \"environment_variables_variables\",\n  ]);\n  private parseEnvironmentVariables(entry: EnvironmentVariablesEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"environment_variables\") {\n      return;\n    }\n\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.environment_variables_title;\n    cipher.notes = entry.environment_variables_notes;\n\n    entry.environment_variables_variables.forEach((KvPair) => {\n      this.processKvp(cipher, KvPair.key, KvPair.value);\n    });\n\n    this.importUnmappedFields(cipher, entry, this.ENV_VARIABLES_mappedValues);\n  }\n\n  readonly GPG_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"mail_gpg_own_key_title\",\n    \"mail_gpg_own_key_public\",\n    \"mail_gpg_own_key_name\",\n    \"mail_gpg_own_key_email\",\n    \"mail_gpg_own_key_private\",\n  ]);\n  private parseGPG(entry: GPGEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"mail_gpg_own_key\") {\n      return;\n    }\n\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.mail_gpg_own_key_title;\n    cipher.notes = entry.mail_gpg_own_key_public;\n\n    this.processKvp(cipher, \"mail_gpg_own_key_name\", entry.mail_gpg_own_key_name);\n    this.processKvp(cipher, \"mail_gpg_own_key_email\", entry.mail_gpg_own_key_email);\n    this.processKvp(\n      cipher,\n      \"mail_gpg_own_key_private\",\n      entry.mail_gpg_own_key_private,\n      FieldType.Hidden,\n    );\n\n    this.importUnmappedFields(cipher, entry, this.GPG_mappedValues);\n  }\n\n  private importUnmappedFields(\n    cipher: CipherView,\n    entry: PsonoItemTypes,\n    mappedValues: Set<string>,\n  ) {\n    const unmappedFields = Object.keys(entry).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = entry as any;\n      this.processKvp(cipher, key, item[key].toString());\n    });\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class RememBearCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.trash === \"true\") {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.notes = this.getValueOrDefault(value.notes);\n      if (value.type === \"LoginItem\") {\n        cipher.login.uris = this.makeUriArray(value.website);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.username = this.getValueOrDefault(value.username);\n      } else if (value.type === \"CreditCardItem\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardholder);\n        cipher.card.number = this.getValueOrDefault(value.number);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = this.getValueOrDefault(value.verification);\n\n        try {\n          const expMonth = this.getValueOrDefault(value.expiryMonth);\n          if (expMonth != null) {\n            const expMonthNumber = parseInt(expMonth, null);\n            if (expMonthNumber != null && expMonthNumber >= 1 && expMonthNumber <= 12) {\n              cipher.card.expMonth = expMonthNumber.toString();\n            }\n          }\n        } catch {\n          // Ignore error\n        }\n        try {\n          const expYear = this.getValueOrDefault(value.expiryYear);\n          if (expYear != null) {\n            const expYearNumber = parseInt(expYear, null);\n            if (expYearNumber != null) {\n              cipher.card.expYear = expYearNumber.toString();\n            }\n          }\n        } catch {\n          // Ignore error\n        }\n\n        const pin = this.getValueOrDefault(value.pin);\n        if (pin != null) {\n          this.processKvp(cipher, \"PIN\", pin);\n        }\n        const zip = this.getValueOrDefault(value.zipCode);\n        if (zip != null) {\n          this.processKvp(cipher, \"Zip Code\", zip);\n        }\n      }\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class RoboFormCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let i = 1;\n    results.forEach((value) => {\n      const folder =\n        !this.isNullOrWhitespace(value.Folder) && value.Folder.startsWith(\"/\")\n          ? value.Folder.replace(\"/\", \"\")\n          : value.Folder;\n      const folderName = !this.isNullOrWhitespace(folder) ? folder : null;\n      this.processFolder(result, folderName);\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Note);\n      cipher.name = this.getValueOrDefault(value.Name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Login);\n      cipher.login.password = this.getValueOrDefault(value.Pwd);\n      cipher.login.uris = this.makeUriArray(value.Url);\n\n      if (!this.isNullOrWhitespace(value.Rf_fields)) {\n        let fields: string[] = [value.Rf_fields];\n        if (value.__parsed_extra != null && value.__parsed_extra.length > 0) {\n          fields = fields.concat(value.__parsed_extra);\n        }\n        fields.forEach((field: string) => {\n          const parts = field.split(\":\");\n          if (parts.length < 3) {\n            return;\n          }\n          const key = parts[0] === \"-no-name-\" ? null : parts[0];\n          const val = parts.length === 4 && parts[2] === \"rck\" ? parts[1] : parts[2];\n          this.processKvp(cipher, key, val);\n        });\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n\n      if (\n        i === results.length &&\n        cipher.name === \"--\" &&\n        this.isNullOrWhitespace(cipher.login.password)\n      ) {\n        return;\n      }\n\n      result.ciphers.push(cipher);\n      i++;\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SafariCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.Url ?? value.URL);\n      cipher.login.totp = this.getValueOrDefault(value.OTPAuth);\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SafeInCloudXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const db = doc.querySelector(\"database\");\n    if (db == null) {\n      result.errorMessage = \"Missing `database` node.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, number>();\n\n    Array.from(doc.querySelectorAll(\"database > label\")).forEach((labelEl) => {\n      const name = labelEl.getAttribute(\"name\");\n      const id = labelEl.getAttribute(\"id\");\n      if (!this.isNullOrWhitespace(name) && !this.isNullOrWhitespace(id)) {\n        foldersMap.set(id, result.folders.length);\n        const folder = new FolderView();\n        folder.name = name;\n        result.folders.push(folder);\n      }\n    });\n\n    Array.from(doc.querySelectorAll(\"database > card\")).forEach((cardEl) => {\n      if (cardEl.getAttribute(\"template\") === \"true\" || cardEl.getAttribute(\"deleted\") === \"true\") {\n        return;\n      }\n\n      const labelIdEl = this.querySelectorDirectChild(cardEl, \"label_id\");\n      if (labelIdEl != null) {\n        const labelId = labelIdEl.textContent;\n        if (!this.isNullOrWhitespace(labelId) && foldersMap.has(labelId)) {\n          result.folderRelationships.push([result.ciphers.length, foldersMap.get(labelId)]);\n        }\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(cardEl.getAttribute(\"title\"), \"--\");\n\n      if (cardEl.getAttribute(\"star\") === \"true\") {\n        cipher.favorite = true;\n      }\n\n      const cardType = cardEl.getAttribute(\"type\");\n      if (cardType === \"note\") {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n      } else {\n        Array.from(this.querySelectorAllDirectChild(cardEl, \"field\")).forEach((fieldEl) => {\n          const text = fieldEl.textContent;\n          if (this.isNullOrWhitespace(text)) {\n            return;\n          }\n          const name = fieldEl.getAttribute(\"name\");\n          const fieldType = this.getValueOrDefault(fieldEl.getAttribute(\"type\"), \"\").toLowerCase();\n          if (fieldType === \"login\") {\n            cipher.login.username = text;\n          } else if (fieldType === \"password\" || fieldType === \"secret\") {\n            // safeInCloud allows for more than one password. we just insert them here and find the one used as password later\n            this.processKvp(cipher, name, text, FieldType.Hidden);\n          } else if (fieldType === \"one_time_password\") {\n            cipher.login.totp = text;\n          } else if (fieldType === \"notes\") {\n            cipher.notes += text + \"\\n\";\n          } else if (fieldType === \"weblogin\" || fieldType === \"website\") {\n            cipher.login.uris.push(...this.makeUriArray(text));\n          } else {\n            this.processKvp(cipher, name, text);\n          }\n        });\n      }\n\n      Array.from(this.querySelectorAllDirectChild(cardEl, \"notes\")).forEach((notesEl) => {\n        cipher.notes += notesEl.textContent + \"\\n\";\n      });\n\n      this.setPassword(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  // Choose a password from all passwords. Take one that has password in its name, or the first one if there is no such entry\n  // if its name is password, we can safely remove it form the fields. otherwise, it would maybe be best to keep it as a hidden field\n  setPassword(cipher: CipherView) {\n    const candidates = cipher.fields.filter((field) => field.type === FieldType.Hidden);\n    if (!candidates.length) {\n      return;\n    }\n\n    let choice: FieldView;\n    for (const field of candidates) {\n      if (this.passwordFieldNames.includes(field.name.toLowerCase())) {\n        choice = field;\n        cipher.fields = cipher.fields.filter((f) => f !== choice);\n        break;\n      }\n    }\n\n    if (!choice) {\n      choice = candidates[0];\n    }\n\n    cipher.login.password = choice.value;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SaferPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(this.nameFromUrl(value.url), \"--\");\n      cipher.notes = this.getValueOrDefault(value.notes);\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SecureSafeCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    // The url field can be in different case formats.\n    const urlField = Object.keys(results[0]).find((k) => /url/i.test(k));\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Title);\n      cipher.notes = this.getValueOrDefault(value.Comment);\n      cipher.login.uris = this.makeUriArray(value[urlField]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SplashIdCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 3) {\n        return;\n      }\n\n      this.processFolder(result, this.getValueOrDefault(value[value.length - 1]));\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 2], \"\");\n      cipher.name = this.getValueOrDefault(value[1], \"--\");\n\n      if (value[0] === \"Web Logins\" || value[0] === \"Servers\" || value[0] === \"Email Accounts\") {\n        cipher.login.username = this.getValueOrDefault(value[2]);\n        cipher.login.password = this.getValueOrDefault(value[3]);\n        cipher.login.uris = this.makeUriArray(value[4]);\n        this.parseFieldsToNotes(cipher, 5, value);\n      } else {\n        this.parseFieldsToNotes(cipher, 2, value);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseFieldsToNotes(cipher: CipherView, startIndex: number, value: any) {\n    // last 3 rows do not get parsed\n    for (let i = startIndex; i < value.length - 3; i++) {\n      if (this.isNullOrWhitespace(value[i])) {\n        continue;\n      }\n      cipher.notes += value[i] + \"\\n\";\n    }\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class StickyPasswordXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const loginNodes = doc.querySelectorAll(\"root > Database > Logins > Login\");\n    Array.from(loginNodes).forEach((loginNode) => {\n      const accountId = loginNode.getAttribute(\"ID\");\n      if (this.isNullOrWhitespace(accountId)) {\n        return;\n      }\n\n      const usernameText = loginNode.getAttribute(\"Name\");\n      const passwordText = loginNode.getAttribute(\"Password\");\n      let titleText: string = null;\n      let linkText: string = null;\n      let notesText: string = null;\n      let groupId: string = null;\n      let groupText: string = null;\n\n      const accountLogin = doc.querySelector(\n        \"root > Database > Accounts > Account > \" +\n          'LoginLinks > Login[SourceLoginID=\"' +\n          accountId +\n          '\"]',\n      );\n      if (accountLogin != null) {\n        const account = accountLogin.parentElement.parentElement;\n        if (account != null) {\n          titleText = account.getAttribute(\"Name\");\n          linkText = account.getAttribute(\"Link\");\n          groupId = account.getAttribute(\"ParentID\");\n          notesText = account.getAttribute(\"Comments\");\n          if (!this.isNullOrWhitespace(notesText)) {\n            notesText = notesText.split(\"/n\").join(\"\\n\");\n          }\n        }\n      }\n\n      if (!this.isNullOrWhitespace(groupId)) {\n        groupText = this.buildGroupText(doc, groupId, \"\");\n        this.processFolder(result, groupText);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(titleText, \"--\");\n      cipher.notes = this.getValueOrDefault(notesText);\n      cipher.login.username = this.getValueOrDefault(usernameText);\n      cipher.login.password = this.getValueOrDefault(passwordText);\n      cipher.login.uris = this.makeUriArray(linkText);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  buildGroupText(doc: Document, groupId: string, groupText: string): string {\n    const group = doc.querySelector('root > Database > Groups > Group[ID=\"' + groupId + '\"]');\n    if (group == null) {\n      return groupText;\n    }\n    if (!this.isNullOrWhitespace(groupText)) {\n      groupText = \"/\" + groupText;\n    }\n    groupText = group.getAttribute(\"Name\") + groupText;\n    return this.buildGroupText(doc, group.getAttribute(\"ParentID\"), groupText);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst PropertiesToIgnore = [\n  \"kind\",\n  \"autologin\",\n  \"favorite\",\n  \"hexcolor\",\n  \"protectedwithpassword\",\n  \"subdomainonly\",\n  \"type\",\n  \"tk_export_version\",\n  \"note\",\n  \"title\",\n  \"document_content\",\n];\n\nexport class TrueKeyCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.favorite, \"\").toLowerCase() === \"true\";\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.notes = this.getValueOrDefault(value.memo, \"\");\n      cipher.login.username = this.getValueOrDefault(value.login);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n\n      if (value.kind !== \"login\") {\n        cipher.name = this.getValueOrDefault(value.title, \"--\");\n        cipher.notes = this.getValueOrDefault(value.note, \"\");\n      }\n\n      if (value.kind === \"cc\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardholder);\n        cipher.card.number = this.getValueOrDefault(value.number);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        if (!this.isNullOrWhitespace(value.expiryDate)) {\n          try {\n            const expDate = new Date(value.expiryDate);\n            cipher.card.expYear = expDate.getFullYear().toString();\n            cipher.card.expMonth = (expDate.getMonth() + 1).toString();\n          } catch {\n            // Ignore error\n          }\n        }\n      } else if (value.kind !== \"login\") {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n        if (!this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes = this.getValueOrDefault(value.document_content, \"\");\n        }\n        for (const property in value) {\n          if (\n            value.hasOwnProperty(property) && // eslint-disable-line\n            PropertiesToIgnore.indexOf(property.toLowerCase()) < 0 &&\n            !this.isNullOrWhitespace(value[property])\n          ) {\n            this.processKvp(cipher, property, value[property]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class UpmCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length !== 5) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      cipher.notes = this.getValueOrDefault(value[4]);\n      cipher.login.username = this.getValueOrDefault(value[1]);\n      cipher.login.password = this.getValueOrDefault(value[2]);\n      cipher.login.uris = this.makeUriArray(value[3]);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class YotiCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value[\"User name\"]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ZohoVaultCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (\n        this.isNullOrWhitespace(value[\"Password Name\"]) &&\n        this.isNullOrWhitespace(value[\"Secret Name\"])\n      ) {\n        return;\n      }\n      this.processFolder(result, this.getValueOrDefault(value.ChamberName));\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.Favorite, \"0\") === \"1\";\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.name = this.getValueOrDefault(\n        value[\"Password Name\"],\n        this.getValueOrDefault(value[\"Secret Name\"], \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(\n        this.getValueOrDefault(value[\"Password URL\"], this.getValueOrDefault(value[\"Secret URL\"])),\n      );\n      this.parseData(cipher, value.SecretData);\n      this.parseData(cipher, value.CustomData);\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseData(cipher: CipherView, data: string) {\n    if (this.isNullOrWhitespace(data)) {\n      return;\n    }\n    const dataLines = this.splitNewLine(data);\n    dataLines.forEach((line) => {\n      const delimPosition = line.indexOf(\":\");\n      if (delimPosition < 0) {\n        return;\n      }\n      const field = line.substring(0, delimPosition);\n      const value = line.length > delimPosition ? line.substring(delimPosition + 1) : null;\n      if (\n        this.isNullOrWhitespace(field) ||\n        this.isNullOrWhitespace(value) ||\n        field === \"SecretType\"\n      ) {\n        return;\n      }\n      const fieldLower = field.toLowerCase();\n      if (cipher.login.username == null && this.usernameFieldNames.indexOf(fieldLower) > -1) {\n        cipher.login.username = value;\n      } else if (\n        cipher.login.password == null &&\n        this.passwordFieldNames.indexOf(fieldLower) > -1\n      ) {\n        cipher.login.password = value;\n      } else {\n        this.processKvp(cipher, field, value);\n      }\n    });\n  }\n}\n","export interface ImportOption {\n  id: string;\n  name: string;\n}\n\nexport const featuredImportOptions = [\n  { id: \"bitwardenjson\", name: \"Bitwarden (json)\" },\n  { id: \"bitwardencsv\", name: \"Bitwarden (csv)\" },\n  { id: \"chromecsv\", name: \"Chrome (csv)\" },\n  { id: \"dashlanecsv\", name: \"Dashlane (csv)\" },\n  { id: \"firefoxcsv\", name: \"Firefox (csv)\" },\n  { id: \"keepass2xml\", name: \"KeePass 2 (xml)\" },\n  { id: \"lastpasscsv\", name: \"LastPass\" },\n  { id: \"safaricsv\", name: \"Safari and macOS (csv)\" },\n  { id: \"1password1pux\", name: \"1Password (1pux/json)\" },\n] as const;\n\nexport const regularImportOptions = [\n  { id: \"keepassxcsv\", name: \"KeePassX (csv)\" },\n  { id: \"1password1pif\", name: \"1Password (1pif)\" },\n  { id: \"1passwordwincsv\", name: \"1Password 6 and 7 Windows (csv)\" },\n  { id: \"1passwordmaccsv\", name: \"1Password 6 and 7 Mac (csv)\" },\n  { id: \"dashlanejson\", name: \"Dashlane (json)\" },\n  { id: \"roboformcsv\", name: \"RoboForm (csv)\" },\n  { id: \"keepercsv\", name: \"Keeper (csv)\" },\n  // Temporarily remove this option for the Feb release\n  // { id: \"keeperjson\", name: \"Keeper (json)\" },\n  { id: \"enpasscsv\", name: \"Enpass (csv)\" },\n  { id: \"enpassjson\", name: \"Enpass (json)\" },\n  { id: \"protonpass\", name: \"ProtonPass (zip/json)\" },\n  { id: \"safeincloudxml\", name: \"SafeInCloud (xml)\" },\n  { id: \"pwsafexml\", name: \"Password Safe - pwsafe.org (xml)\" },\n  { id: \"stickypasswordxml\", name: \"Sticky Password (xml)\" },\n  { id: \"msecurecsv\", name: \"mSecure (csv)\" },\n  { id: \"truekeycsv\", name: \"True Key (csv)\" },\n  { id: \"passwordbossjson\", name: \"Password Boss (json)\" },\n  { id: \"zohovaultcsv\", name: \"Zoho Vault (csv)\" },\n  { id: \"splashidcsv\", name: \"SplashID (csv)\" },\n  { id: \"passworddragonxml\", name: \"Password Dragon (xml)\" },\n  { id: \"padlockcsv\", name: \"Padlock (csv)\" },\n  { id: \"passboltcsv\", name: \"Passbolt (csv)\" },\n  { id: \"clipperzhtml\", name: \"Clipperz (html)\" },\n  { id: \"aviracsv\", name: \"Avira (csv)\" },\n  { id: \"saferpasscsv\", name: \"SaferPass (csv)\" },\n  { id: \"upmcsv\", name: \"Universal Password Manager (csv)\" },\n  { id: \"ascendocsv\", name: \"Ascendo DataVault (csv)\" },\n  { id: \"meldiumcsv\", name: \"Meldium (csv)\" },\n  { id: \"passkeepcsv\", name: \"PassKeep (csv)\" },\n  { id: \"operacsv\", name: \"Opera (csv)\" },\n  { id: \"vivaldicsv\", name: \"Vivaldi (csv)\" },\n  { id: \"gnomejson\", name: \"GNOME Passwords and Keys/Seahorse (json)\" },\n  { id: \"blurcsv\", name: \"Blur (csv)\" },\n  { id: \"passwordagentcsv\", name: \"Password Agent (csv)\" },\n  { id: \"passpackcsv\", name: \"Passpack (csv)\" },\n  { id: \"passmanjson\", name: \"Passman (json)\" },\n  { id: \"avastcsv\", name: \"Avast Passwords (csv)\" },\n  { id: \"avastjson\", name: \"Avast Passwords (json)\" },\n  { id: \"fsecurefsk\", name: \"F-Secure KEY (fsk)\" },\n  { id: \"kasperskytxt\", name: \"Kaspersky Password Manager (txt)\" },\n  { id: \"remembearcsv\", name: \"RememBear (csv)\" },\n  { id: \"passwordwallettxt\", name: \"PasswordWallet (txt)\" },\n  { id: \"mykicsv\", name: \"Myki (csv)\" },\n  { id: \"securesafecsv\", name: \"SecureSafe (csv)\" },\n  { id: \"logmeoncecsv\", name: \"LogMeOnce (csv)\" },\n  { id: \"blackberrycsv\", name: \"BlackBerry Password Keeper (csv)\" },\n  { id: \"buttercupcsv\", name: \"Buttercup (csv)\" },\n  { id: \"codebookcsv\", name: \"Codebook (csv)\" },\n  { id: \"encryptrcsv\", name: \"Encryptr (csv)\" },\n  { id: \"yoticsv\", name: \"Yoti (csv)\" },\n  { id: \"nordpasscsv\", name: \"Nordpass (csv)\" },\n  { id: \"psonojson\", name: \"Psono (json)\" },\n  { id: \"passkyjson\", name: \"Passky (json)\" },\n] as const;\n\nexport type ImportType =\n  | (typeof featuredImportOptions)[number][\"id\"]\n  | (typeof regularImportOptions)[number][\"id\"];\n","import { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { ImportCiphersRequest } from \"@bitwarden/common/models/request/import-ciphers.request\";\nimport { ImportOrganizationCiphersRequest } from \"@bitwarden/common/models/request/import-organization-ciphers.request\";\nimport { KvpRequest } from \"@bitwarden/common/models/request/kvp.request\";\nimport { ErrorResponse } from \"@bitwarden/common/models/response/error.response\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRequest } from \"@bitwarden/common/vault/models/request/cipher.request\";\nimport { CollectionWithIdRequest } from \"@bitwarden/common/vault/models/request/collection-with-id.request\";\nimport { FolderWithIdRequest } from \"@bitwarden/common/vault/models/request/folder-with-id.request\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport {\n  AscendoCsvImporter,\n  AvastCsvImporter,\n  AvastJsonImporter,\n  AviraCsvImporter,\n  BitwardenCsvImporter,\n  BitwardenPasswordProtectedImporter,\n  BlackBerryCsvImporter,\n  BlurCsvImporter,\n  ButtercupCsvImporter,\n  ChromeCsvImporter,\n  ClipperzHtmlImporter,\n  CodebookCsvImporter,\n  DashlaneCsvImporter,\n  DashlaneJsonImporter,\n  EncryptrCsvImporter,\n  EnpassCsvImporter,\n  EnpassJsonImporter,\n  FirefoxCsvImporter,\n  FSecureFskImporter,\n  GnomeJsonImporter,\n  KasperskyTxtImporter,\n  KeePass2XmlImporter,\n  KeePassXCsvImporter,\n  KeeperCsvImporter,\n  // KeeperJsonImporter,\n  LastPassCsvImporter,\n  LogMeOnceCsvImporter,\n  MSecureCsvImporter,\n  MeldiumCsvImporter,\n  MykiCsvImporter,\n  NordPassCsvImporter,\n  OnePassword1PifImporter,\n  OnePassword1PuxImporter,\n  OnePasswordMacCsvImporter,\n  OnePasswordWinCsvImporter,\n  PadlockCsvImporter,\n  PassKeepCsvImporter,\n  PasskyJsonImporter,\n  PassmanJsonImporter,\n  PasspackCsvImporter,\n  PasswordAgentCsvImporter,\n  PasswordBossJsonImporter,\n  PasswordDragonXmlImporter,\n  PasswordSafeXmlImporter,\n  PasswordWalletTxtImporter,\n  ProtonPassJsonImporter,\n  PsonoJsonImporter,\n  RememBearCsvImporter,\n  RoboFormCsvImporter,\n  SafariCsvImporter,\n  SafeInCloudXmlImporter,\n  SaferPassCsvImporter,\n  SecureSafeCsvImporter,\n  SplashIdCsvImporter,\n  StickyPasswordXmlImporter,\n  TrueKeyCsvImporter,\n  UpmCsvImporter,\n  YotiCsvImporter,\n  ZohoVaultCsvImporter,\n} from \"../importers\";\nimport { Importer } from \"../importers/importer\";\nimport {\n  featuredImportOptions,\n  ImportOption,\n  ImportType,\n  regularImportOptions,\n} from \"../models/import-options\";\nimport { ImportResult } from \"../models/import-result\";\nimport { ImportApiServiceAbstraction } from \"../services/import-api.service.abstraction\";\nimport { ImportServiceAbstraction } from \"../services/import.service.abstraction\";\n\nexport class ImportService implements ImportServiceAbstraction {\n  featuredImportOptions = featuredImportOptions as readonly ImportOption[];\n\n  regularImportOptions = regularImportOptions as readonly ImportOption[];\n\n  constructor(\n    private cipherService: CipherService,\n    private folderService: FolderService,\n    private importApiService: ImportApiServiceAbstraction,\n    private i18nService: I18nService,\n    private collectionService: CollectionService,\n    private cryptoService: CryptoService,\n    private pinService: PinServiceAbstraction,\n  ) {}\n\n  getImportOptions(): ImportOption[] {\n    return this.featuredImportOptions.concat(this.regularImportOptions);\n  }\n\n  async import(\n    importer: Importer,\n    fileContents: string,\n    organizationId: string = null,\n    selectedImportTarget: FolderView | CollectionView = null,\n    canAccessImportExport: boolean,\n  ): Promise<ImportResult> {\n    let importResult: ImportResult;\n    try {\n      importResult = await importer.parse(fileContents);\n    } catch (error) {\n      if (error instanceof SyntaxError) {\n        throw new Error(this.i18nService.t(\"importFormatError\"));\n      }\n      throw error;\n    }\n\n    if (!importResult.success) {\n      if (!Utils.isNullOrWhitespace(importResult.errorMessage)) {\n        throw new Error(importResult.errorMessage);\n      }\n      throw new Error(this.i18nService.t(\"importFormatError\"));\n    }\n\n    if (importResult.folders.length === 0 && importResult.ciphers.length === 0) {\n      throw new Error(this.i18nService.t(\"importNothingError\"));\n    }\n\n    if (importResult.ciphers.length > 0) {\n      const halfway = Math.floor(importResult.ciphers.length / 2);\n      const last = importResult.ciphers.length - 1;\n\n      if (\n        this.badData(importResult.ciphers[0]) &&\n        this.badData(importResult.ciphers[halfway]) &&\n        this.badData(importResult.ciphers[last])\n      ) {\n        throw new Error(this.i18nService.t(\"importFormatError\"));\n      }\n    }\n\n    if (organizationId && !selectedImportTarget && !canAccessImportExport) {\n      const hasUnassignedCollections =\n        importResult.collectionRelationships.length < importResult.ciphers.length;\n      if (hasUnassignedCollections) {\n        throw new Error(this.i18nService.t(\"importUnassignedItemsError\"));\n      }\n    }\n\n    try {\n      await this.setImportTarget(importResult, organizationId, selectedImportTarget);\n      if (organizationId != null) {\n        await this.handleOrganizationalImport(importResult, organizationId);\n      } else {\n        await this.handleIndividualImport(importResult);\n      }\n    } catch (error) {\n      const errorResponse = new ErrorResponse(error, 400);\n      throw this.handleServerError(errorResponse, importResult);\n    }\n    return importResult;\n  }\n\n  getImporter(\n    format: ImportType | \"bitwardenpasswordprotected\",\n    promptForPassword_callback: () => Promise<string>,\n    organizationId: string = null,\n  ): Importer {\n    if (promptForPassword_callback == null) {\n      return null;\n    }\n\n    const importer = this.getImporterInstance(format, promptForPassword_callback);\n    if (importer == null) {\n      return null;\n    }\n    importer.organizationId = organizationId;\n    return importer;\n  }\n\n  private getImporterInstance(\n    format: ImportType | \"bitwardenpasswordprotected\",\n    promptForPassword_callback: () => Promise<string>,\n  ) {\n    if (format == null) {\n      return null;\n    }\n\n    switch (format) {\n      case \"bitwardencsv\":\n        return new BitwardenCsvImporter();\n      case \"bitwardenjson\":\n      case \"bitwardenpasswordprotected\":\n        return new BitwardenPasswordProtectedImporter(\n          this.cryptoService,\n          this.i18nService,\n          this.cipherService,\n          this.pinService,\n          promptForPassword_callback,\n        );\n      case \"lastpasscsv\":\n      case \"passboltcsv\":\n        return new LastPassCsvImporter();\n      case \"keepassxcsv\":\n        return new KeePassXCsvImporter();\n      case \"aviracsv\":\n        return new AviraCsvImporter();\n      case \"blurcsv\":\n        return new BlurCsvImporter();\n      case \"safeincloudxml\":\n        return new SafeInCloudXmlImporter();\n      case \"padlockcsv\":\n        return new PadlockCsvImporter();\n      case \"keepass2xml\":\n        return new KeePass2XmlImporter();\n      case \"chromecsv\":\n      case \"operacsv\":\n      case \"vivaldicsv\":\n        return new ChromeCsvImporter();\n      case \"firefoxcsv\":\n        return new FirefoxCsvImporter();\n      case \"upmcsv\":\n        return new UpmCsvImporter();\n      case \"saferpasscsv\":\n        return new SaferPassCsvImporter();\n      case \"safaricsv\":\n        return new SafariCsvImporter();\n      case \"meldiumcsv\":\n        return new MeldiumCsvImporter();\n      case \"1password1pif\":\n        return new OnePassword1PifImporter();\n      case \"1password1pux\":\n        return new OnePassword1PuxImporter();\n      case \"1passwordwincsv\":\n        return new OnePasswordWinCsvImporter();\n      case \"1passwordmaccsv\":\n        return new OnePasswordMacCsvImporter();\n      case \"keepercsv\":\n        return new KeeperCsvImporter();\n      // case \"keeperjson\":\n      //   return new KeeperJsonImporter();\n      case \"passworddragonxml\":\n        return new PasswordDragonXmlImporter();\n      case \"enpasscsv\":\n        return new EnpassCsvImporter();\n      case \"enpassjson\":\n        return new EnpassJsonImporter();\n      case \"pwsafexml\":\n        return new PasswordSafeXmlImporter();\n      case \"dashlanecsv\":\n        return new DashlaneCsvImporter();\n      case \"dashlanejson\":\n        return new DashlaneJsonImporter();\n      case \"msecurecsv\":\n        return new MSecureCsvImporter();\n      case \"stickypasswordxml\":\n        return new StickyPasswordXmlImporter();\n      case \"truekeycsv\":\n        return new TrueKeyCsvImporter();\n      case \"clipperzhtml\":\n        return new ClipperzHtmlImporter();\n      case \"roboformcsv\":\n        return new RoboFormCsvImporter();\n      case \"ascendocsv\":\n        return new AscendoCsvImporter();\n      case \"passwordbossjson\":\n        return new PasswordBossJsonImporter();\n      case \"zohovaultcsv\":\n        return new ZohoVaultCsvImporter();\n      case \"splashidcsv\":\n        return new SplashIdCsvImporter();\n      case \"passkeepcsv\":\n        return new PassKeepCsvImporter();\n      case \"gnomejson\":\n        return new GnomeJsonImporter();\n      case \"passwordagentcsv\":\n        return new PasswordAgentCsvImporter();\n      case \"passpackcsv\":\n        return new PasspackCsvImporter();\n      case \"passmanjson\":\n        return new PassmanJsonImporter();\n      case \"avastcsv\":\n        return new AvastCsvImporter();\n      case \"avastjson\":\n        return new AvastJsonImporter();\n      case \"fsecurefsk\":\n        return new FSecureFskImporter();\n      case \"kasperskytxt\":\n        return new KasperskyTxtImporter();\n      case \"remembearcsv\":\n        return new RememBearCsvImporter();\n      case \"passwordwallettxt\":\n        return new PasswordWalletTxtImporter();\n      case \"mykicsv\":\n        return new MykiCsvImporter();\n      case \"securesafecsv\":\n        return new SecureSafeCsvImporter();\n      case \"logmeoncecsv\":\n        return new LogMeOnceCsvImporter();\n      case \"blackberrycsv\":\n        return new BlackBerryCsvImporter();\n      case \"buttercupcsv\":\n        return new ButtercupCsvImporter();\n      case \"codebookcsv\":\n        return new CodebookCsvImporter();\n      case \"encryptrcsv\":\n        return new EncryptrCsvImporter();\n      case \"yoticsv\":\n        return new YotiCsvImporter();\n      case \"nordpasscsv\":\n        return new NordPassCsvImporter();\n      case \"psonojson\":\n        return new PsonoJsonImporter();\n      case \"passkyjson\":\n        return new PasskyJsonImporter();\n      case \"protonpass\":\n        return new ProtonPassJsonImporter(this.i18nService);\n      default:\n        return null;\n    }\n  }\n\n  private async handleIndividualImport(importResult: ImportResult) {\n    const request = new ImportCiphersRequest();\n    for (let i = 0; i < importResult.ciphers.length; i++) {\n      const c = await this.cipherService.encrypt(importResult.ciphers[i]);\n      request.ciphers.push(new CipherRequest(c));\n    }\n    if (importResult.folders != null) {\n      for (let i = 0; i < importResult.folders.length; i++) {\n        const f = await this.folderService.encrypt(importResult.folders[i]);\n        request.folders.push(new FolderWithIdRequest(f));\n      }\n    }\n    if (importResult.folderRelationships != null) {\n      importResult.folderRelationships.forEach((r) =>\n        request.folderRelationships.push(new KvpRequest(r[0], r[1])),\n      );\n    }\n    return await this.importApiService.postImportCiphers(request);\n  }\n\n  private async handleOrganizationalImport(importResult: ImportResult, organizationId: string) {\n    const request = new ImportOrganizationCiphersRequest();\n    for (let i = 0; i < importResult.ciphers.length; i++) {\n      importResult.ciphers[i].organizationId = organizationId;\n      const c = await this.cipherService.encrypt(importResult.ciphers[i]);\n      request.ciphers.push(new CipherRequest(c));\n    }\n    if (importResult.collections != null) {\n      for (let i = 0; i < importResult.collections.length; i++) {\n        importResult.collections[i].organizationId = organizationId;\n        const c = await this.collectionService.encrypt(importResult.collections[i]);\n        request.collections.push(new CollectionWithIdRequest(c));\n      }\n    }\n    if (importResult.collectionRelationships != null) {\n      importResult.collectionRelationships.forEach((r) =>\n        request.collectionRelationships.push(new KvpRequest(r[0], r[1])),\n      );\n    }\n    return await this.importApiService.postImportOrganizationCiphers(organizationId, request);\n  }\n\n  private badData(c: CipherView) {\n    return (\n      (c.name == null || c.name === \"--\") &&\n      c.type === CipherType.Login &&\n      c.login != null &&\n      Utils.isNullOrWhitespace(c.login.password)\n    );\n  }\n\n  private handleServerError(errorResponse: ErrorResponse, importResult: ImportResult): Error {\n    if (errorResponse.validationErrors == null) {\n      return new Error(errorResponse.message);\n    }\n\n    let errorMessage = \"\";\n\n    Object.entries(errorResponse.validationErrors).forEach(([key, value], index) => {\n      let item;\n      let itemType;\n      const i = Number(key.match(/[0-9]+/)[0]);\n\n      switch (key.match(/^\\w+/)[0]) {\n        case \"Ciphers\":\n          item = importResult.ciphers[i];\n          itemType = CipherType[item.type];\n          break;\n        case \"Folders\":\n          item = importResult.folders[i];\n          itemType = \"Folder\";\n          break;\n        case \"Collections\":\n          item = importResult.collections[i];\n          itemType = \"Collection\";\n          break;\n        default:\n          return;\n      }\n\n      if (index > 0) {\n        errorMessage += \"\\n\\n\";\n      }\n\n      if (itemType !== \"Folder\" && itemType !== \"Collection\") {\n        errorMessage += \"[\" + (i + 1) + \"] \";\n      }\n\n      errorMessage += \"[\" + itemType + '] \"' + item.name + '\": ' + value;\n    });\n\n    return new Error(errorMessage);\n  }\n\n  private async setImportTarget(\n    importResult: ImportResult,\n    organizationId: string,\n    importTarget: FolderView | CollectionView,\n  ) {\n    if (!importTarget) {\n      return;\n    }\n\n    if (organizationId) {\n      if (!(importTarget instanceof CollectionView)) {\n        throw new Error(this.i18nService.t(\"errorAssigningTargetCollection\"));\n      }\n\n      const noCollectionRelationShips: [number, number][] = [];\n      importResult.ciphers.forEach((c, index) => {\n        if (\n          !Array.isArray(importResult.collectionRelationships) ||\n          !importResult.collectionRelationships.some(([cipherPos]) => cipherPos === index)\n        ) {\n          noCollectionRelationShips.push([index, 0]);\n        }\n      });\n\n      const collections: CollectionView[] = [...importResult.collections];\n      importResult.collections = [importTarget as CollectionView];\n      collections.map((x) => {\n        const f = new CollectionView();\n        f.name = `${importTarget.name}/${x.name}`;\n        importResult.collections.push(f);\n      });\n\n      const relationships: [number, number][] = [...importResult.collectionRelationships];\n      importResult.collectionRelationships = [...noCollectionRelationShips];\n      relationships.map((x) => {\n        importResult.collectionRelationships.push([x[0], x[1] + 1]);\n      });\n\n      return;\n    }\n\n    if (!(importTarget instanceof FolderView)) {\n      throw new Error(this.i18nService.t(\"errorAssigningTargetFolder\"));\n    }\n\n    const noFolderRelationShips: [number, number][] = [];\n    importResult.ciphers.forEach((c, index) => {\n      if (Utils.isNullOrEmpty(c.folderId)) {\n        c.folderId = importTarget.id;\n        noFolderRelationShips.push([index, 0]);\n      }\n    });\n\n    const folders: FolderView[] = [...importResult.folders];\n    importResult.folders = [importTarget as FolderView];\n    folders.map((x) => {\n      const newFolderName = `${importTarget.name}/${x.name}`;\n      const f = new FolderView();\n      f.name = newFolderName;\n      importResult.folders.push(f);\n    });\n\n    const relationships: [number, number][] = [...importResult.folderRelationships];\n    importResult.folderRelationships = [...noFolderRelationShips];\n    relationships.map((x) => {\n      importResult.folderRelationships.push([x[0], x[1] + 1]);\n    });\n  }\n}\n","export class ExportHelper {\n  static getFileName(prefix: string = null, extension = \"csv\"): string {\n    const now = new Date();\n    const dateString =\n      now.getFullYear() +\n      \"\" +\n      this.padNumber(now.getMonth() + 1, 2) +\n      \"\" +\n      this.padNumber(now.getDate(), 2) +\n      this.padNumber(now.getHours(), 2) +\n      \"\" +\n      this.padNumber(now.getMinutes(), 2) +\n      this.padNumber(now.getSeconds(), 2);\n\n    return \"bitwarden\" + (prefix ? \"_\" + prefix : \"\") + \"_export_\" + dateString + \".\" + extension;\n  }\n\n  private static padNumber(num: number, width: number, padCharacter = \"0\"): string {\n    const numString = num.toString();\n    return numString.length >= width\n      ? numString\n      : new Array(width - numString.length + 1).join(padCharacter) + numString;\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { ExportHelper } from \"./export-helper\";\nimport { IndividualVaultExportServiceAbstraction } from \"./individual-vault-export.service.abstraction\";\nimport { OrganizationVaultExportServiceAbstraction } from \"./org-vault-export.service.abstraction\";\nimport { ExportFormat, VaultExportServiceAbstraction } from \"./vault-export.service.abstraction\";\n\nexport class VaultExportService implements VaultExportServiceAbstraction {\n  constructor(\n    private individualVaultExportService: IndividualVaultExportServiceAbstraction,\n    private organizationVaultExportService: OrganizationVaultExportServiceAbstraction,\n  ) {}\n\n  async getExport(format: ExportFormat = \"csv\", password: string): Promise<string> {\n    if (!Utils.isNullOrWhitespace(password)) {\n      if (format == \"csv\") {\n        throw new Error(\"CSV does not support password protected export\");\n      }\n\n      return this.individualVaultExportService.getPasswordProtectedExport(password);\n    }\n    return this.individualVaultExportService.getExport(format);\n  }\n\n  async getOrganizationExport(\n    organizationId: string,\n    format: ExportFormat,\n    password: string,\n    onlyManagedCollections = false,\n  ): Promise<string> {\n    if (!Utils.isNullOrWhitespace(password)) {\n      if (format == \"csv\") {\n        throw new Error(\"CSV does not support password protected export\");\n      }\n\n      return this.organizationVaultExportService.getPasswordProtectedExport(\n        organizationId,\n        password,\n        onlyManagedCollections,\n      );\n    }\n\n    return this.organizationVaultExportService.getOrganizationExport(\n      organizationId,\n      format,\n      onlyManagedCollections,\n    );\n  }\n\n  getFileName(prefix: string = null, extension = \"csv\"): string {\n    return ExportHelper.getFileName(prefix, extension);\n  }\n}\n","import { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { BitwardenCsvExportType, BitwardenPasswordProtectedFileFormat } from \"../types\";\nexport class BaseVaultExportService {\n  constructor(\n    protected pinService: PinServiceAbstraction,\n    protected cryptoService: CryptoService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private kdfConfigService: KdfConfigService,\n  ) {}\n\n  protected async buildPasswordExport(clearText: string, password: string): Promise<string> {\n    const kdfConfig: KdfConfig = await this.kdfConfigService.getKdfConfig();\n\n    const salt = Utils.fromBufferToB64(await this.cryptoFunctionService.randomBytes(16));\n    const key = await this.pinService.makePinKey(password, salt, kdfConfig);\n\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid(), key);\n    const encText = await this.cryptoService.encrypt(clearText, key);\n\n    const jsonDoc: BitwardenPasswordProtectedFileFormat = {\n      encrypted: true,\n      passwordProtected: true,\n      salt: salt,\n      kdfType: kdfConfig.kdfType,\n      kdfIterations: kdfConfig.iterations,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      data: encText.encryptedString,\n    };\n\n    if (kdfConfig.kdfType === KdfType.Argon2id) {\n      jsonDoc.kdfMemory = kdfConfig.memory;\n      jsonDoc.kdfParallelism = kdfConfig.parallelism;\n    }\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  protected buildCommonCipher(\n    cipher: BitwardenCsvExportType,\n    c: CipherView,\n  ): BitwardenCsvExportType {\n    cipher.type = null;\n    cipher.name = c.name;\n    cipher.notes = c.notes;\n    cipher.fields = null;\n    cipher.reprompt = c.reprompt;\n    // Login props\n    cipher.login_uri = null;\n    cipher.login_username = null;\n    cipher.login_password = null;\n    cipher.login_totp = null;\n\n    if (c.fields) {\n      c.fields.forEach((f) => {\n        if (!cipher.fields) {\n          cipher.fields = \"\";\n        } else {\n          cipher.fields += \"\\n\";\n        }\n\n        cipher.fields += (f.name || \"\") + \": \" + f.value;\n      });\n    }\n\n    switch (c.type) {\n      case CipherType.Login:\n        cipher.type = \"login\";\n        cipher.login_username = c.login.username;\n        cipher.login_password = c.login.password;\n        cipher.login_totp = c.login.totp;\n\n        if (c.login.uris) {\n          cipher.login_uri = [];\n          c.login.uris.forEach((u) => {\n            cipher.login_uri.push(u.uri);\n          });\n        }\n        break;\n      case CipherType.SecureNote:\n        cipher.type = \"note\";\n        break;\n      default:\n        return;\n    }\n\n    return cipher;\n  }\n}\n","import * as papa from \"papaparse\";\nimport { firstValueFrom } from \"rxjs\";\n\nimport { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { CipherWithIdExport, CollectionWithIdExport } from \"@bitwarden/common/models/export\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { OrganizationId } from \"@bitwarden/common/types/guid\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherData } from \"@bitwarden/common/vault/models/data/cipher.data\";\nimport { CollectionData } from \"@bitwarden/common/vault/models/data/collection.data\";\nimport { Cipher } from \"@bitwarden/common/vault/models/domain/cipher\";\nimport { Collection } from \"@bitwarden/common/vault/models/domain/collection\";\nimport { CollectionDetailsResponse } from \"@bitwarden/common/vault/models/response/collection.response\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport {\n  BitwardenCsvOrgExportType,\n  BitwardenEncryptedOrgJsonExport,\n  BitwardenUnEncryptedOrgJsonExport,\n} from \"../types\";\n\nimport { BaseVaultExportService } from \"./base-vault-export.service\";\nimport { OrganizationVaultExportServiceAbstraction } from \"./org-vault-export.service.abstraction\";\nimport { ExportFormat } from \"./vault-export.service.abstraction\";\n\nexport class OrganizationVaultExportService\n  extends BaseVaultExportService\n  implements OrganizationVaultExportServiceAbstraction\n{\n  constructor(\n    private cipherService: CipherService,\n    private apiService: ApiService,\n    pinService: PinServiceAbstraction,\n    cryptoService: CryptoService,\n    cryptoFunctionService: CryptoFunctionService,\n    private collectionService: CollectionService,\n    kdfConfigService: KdfConfigService,\n  ) {\n    super(pinService, cryptoService, cryptoFunctionService, kdfConfigService);\n  }\n\n  async getPasswordProtectedExport(\n    organizationId: string,\n    password: string,\n    onlyManagedCollections: boolean,\n  ): Promise<string> {\n    const clearText = await this.getOrganizationExport(\n      organizationId,\n      \"json\",\n      onlyManagedCollections,\n    );\n\n    return this.buildPasswordExport(clearText, password);\n  }\n\n  async getOrganizationExport(\n    organizationId: string,\n    format: ExportFormat = \"csv\",\n    onlyManagedCollections: boolean,\n  ): Promise<string> {\n    if (Utils.isNullOrWhitespace(organizationId)) {\n      throw new Error(\"OrganizationId must be set\");\n    }\n\n    if (format === \"encrypted_json\") {\n      return onlyManagedCollections\n        ? this.getEncryptedManagedExport(organizationId)\n        : this.getOrganizationEncryptedExport(organizationId);\n    }\n\n    return onlyManagedCollections\n      ? this.getDecryptedManagedExport(organizationId, format)\n      : this.getOrganizationDecryptedExport(organizationId, format);\n  }\n\n  private async getOrganizationDecryptedExport(\n    organizationId: string,\n    format: \"json\" | \"csv\",\n  ): Promise<string> {\n    const decCollections: CollectionView[] = [];\n    const decCiphers: CipherView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.apiService.getOrganizationExport(organizationId).then((exportData) => {\n        const exportPromises: any = [];\n        if (exportData != null) {\n          if (exportData.collections != null && exportData.collections.length > 0) {\n            exportData.collections.forEach((c) => {\n              const collection = new Collection(new CollectionData(c as CollectionDetailsResponse));\n              exportPromises.push(\n                firstValueFrom(this.cryptoService.activeUserOrgKeys$)\n                  .then((keys) => collection.decrypt(keys[organizationId as OrganizationId]))\n                  .then((decCol) => {\n                    decCollections.push(decCol);\n                  }),\n              );\n            });\n          }\n          if (exportData.ciphers != null && exportData.ciphers.length > 0) {\n            exportData.ciphers\n              .filter((c) => c.deletedDate === null)\n              .forEach(async (c) => {\n                const cipher = new Cipher(new CipherData(c));\n                exportPromises.push(\n                  this.cipherService\n                    .getKeyForCipherKeyDecryption(cipher)\n                    .then((key) => cipher.decrypt(key))\n                    .then((decCipher) => {\n                      decCiphers.push(decCipher);\n                    }),\n                );\n              });\n          }\n        }\n        return Promise.all(exportPromises);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decCollections, decCiphers);\n    }\n    return this.buildJsonExport(decCollections, decCiphers);\n  }\n\n  private async getOrganizationEncryptedExport(organizationId: string): Promise<string> {\n    const collections: Collection[] = [];\n    const ciphers: Cipher[] = [];\n    const promises = [];\n\n    promises.push(\n      this.apiService.getCollections(organizationId).then((c) => {\n        if (c != null && c.data != null && c.data.length > 0) {\n          c.data.forEach((r) => {\n            const collection = new Collection(new CollectionData(r as CollectionDetailsResponse));\n            collections.push(collection);\n          });\n        }\n      }),\n    );\n\n    promises.push(\n      this.apiService.getCiphersOrganization(organizationId).then((c) => {\n        if (c != null && c.data != null && c.data.length > 0) {\n          c.data\n            .filter((item) => item.deletedDate === null)\n            .forEach((item) => {\n              const cipher = new Cipher(new CipherData(item));\n              ciphers.push(cipher);\n            });\n        }\n      }),\n    );\n\n    await Promise.all(promises);\n\n    return this.BuildEncryptedExport(organizationId, collections, ciphers);\n  }\n\n  private async getDecryptedManagedExport(\n    organizationId: string,\n    format: \"json\" | \"csv\",\n  ): Promise<string> {\n    let decCiphers: CipherView[] = [];\n    let allDecCiphers: CipherView[] = [];\n    let decCollections: CollectionView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.collectionService.getAllDecrypted().then(async (collections) => {\n        decCollections = collections.filter((c) => c.organizationId == organizationId && c.manage);\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAllDecrypted().then((ciphers) => {\n        allDecCiphers = ciphers;\n      }),\n    );\n    await Promise.all(promises);\n\n    decCiphers = allDecCiphers.filter(\n      (f) =>\n        f.deletedDate == null &&\n        f.organizationId == organizationId &&\n        decCollections.some((dC) => f.collectionIds.some((cId) => dC.id === cId)),\n    );\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decCollections, decCiphers);\n    }\n    return this.buildJsonExport(decCollections, decCiphers);\n  }\n\n  private async getEncryptedManagedExport(organizationId: string): Promise<string> {\n    let encCiphers: Cipher[] = [];\n    let allCiphers: Cipher[] = [];\n    let encCollections: Collection[] = [];\n    const promises = [];\n\n    promises.push(\n      this.collectionService.getAll().then((collections) => {\n        encCollections = collections.filter((c) => c.organizationId == organizationId && c.manage);\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAll().then((ciphers) => {\n        allCiphers = ciphers;\n      }),\n    );\n\n    await Promise.all(promises);\n\n    encCiphers = allCiphers.filter(\n      (f) =>\n        f.deletedDate == null &&\n        f.organizationId == organizationId &&\n        encCollections.some((eC) => f.collectionIds.some((cId) => eC.id === cId)),\n    );\n\n    return this.BuildEncryptedExport(organizationId, encCollections, encCiphers);\n  }\n\n  private async BuildEncryptedExport(\n    organizationId: string,\n    collections: Collection[],\n    ciphers: Cipher[],\n  ): Promise<string> {\n    const orgKey = await this.cryptoService.getOrgKey(organizationId);\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid(), orgKey);\n\n    const jsonDoc: BitwardenEncryptedOrgJsonExport = {\n      encrypted: true,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      collections: [],\n      items: [],\n    };\n\n    collections.forEach((c) => {\n      const collection = new CollectionWithIdExport();\n      collection.build(c);\n      jsonDoc.collections.push(collection);\n    });\n\n    ciphers.forEach((c) => {\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      jsonDoc.items.push(cipher);\n    });\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  private buildCsvExport(decCollections: CollectionView[], decCiphers: CipherView[]): string {\n    const collectionsMap = new Map<string, CollectionView>();\n    decCollections.forEach((c) => {\n      collectionsMap.set(c.id, c);\n    });\n\n    const exportCiphers: BitwardenCsvOrgExportType[] = [];\n    decCiphers.forEach((c) => {\n      // only export logins and secure notes\n      if (c.type !== CipherType.Login && c.type !== CipherType.SecureNote) {\n        return;\n      }\n\n      const cipher = {} as BitwardenCsvOrgExportType;\n      cipher.collections = [];\n      if (c.collectionIds != null) {\n        cipher.collections = c.collectionIds\n          .filter((id) => collectionsMap.has(id))\n          .map((id) => collectionsMap.get(id).name);\n      }\n      this.buildCommonCipher(cipher, c);\n      exportCiphers.push(cipher);\n    });\n\n    return papa.unparse(exportCiphers);\n  }\n\n  private buildJsonExport(decCollections: CollectionView[], decCiphers: CipherView[]): string {\n    const jsonDoc: BitwardenUnEncryptedOrgJsonExport = {\n      encrypted: false,\n      collections: [],\n      items: [],\n    };\n\n    decCollections.forEach((c) => {\n      const collection = new CollectionWithIdExport();\n      collection.build(c);\n      jsonDoc.collections.push(collection);\n    });\n\n    decCiphers.forEach((c) => {\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      jsonDoc.items.push(cipher);\n    });\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n}\n","import * as papa from \"papaparse\";\n\nimport { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { CipherWithIdExport, FolderWithIdExport } from \"@bitwarden/common/models/export\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { Cipher } from \"@bitwarden/common/vault/models/domain/cipher\";\nimport { Folder } from \"@bitwarden/common/vault/models/domain/folder\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport {\n  BitwardenCsvIndividualExportType,\n  BitwardenEncryptedIndividualJsonExport,\n  BitwardenUnEncryptedIndividualJsonExport,\n} from \"../types\";\n\nimport { BaseVaultExportService } from \"./base-vault-export.service\";\nimport { IndividualVaultExportServiceAbstraction } from \"./individual-vault-export.service.abstraction\";\nimport { ExportFormat } from \"./vault-export.service.abstraction\";\n\nexport class IndividualVaultExportService\n  extends BaseVaultExportService\n  implements IndividualVaultExportServiceAbstraction\n{\n  constructor(\n    private folderService: FolderService,\n    private cipherService: CipherService,\n    pinService: PinServiceAbstraction,\n    cryptoService: CryptoService,\n    cryptoFunctionService: CryptoFunctionService,\n    kdfConfigService: KdfConfigService,\n  ) {\n    super(pinService, cryptoService, cryptoFunctionService, kdfConfigService);\n  }\n\n  async getExport(format: ExportFormat = \"csv\"): Promise<string> {\n    if (format === \"encrypted_json\") {\n      return this.getEncryptedExport();\n    }\n    return this.getDecryptedExport(format);\n  }\n\n  async getPasswordProtectedExport(password: string): Promise<string> {\n    const clearText = await this.getExport(\"json\");\n    return this.buildPasswordExport(clearText, password);\n  }\n\n  private async getDecryptedExport(format: \"json\" | \"csv\"): Promise<string> {\n    let decFolders: FolderView[] = [];\n    let decCiphers: CipherView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.folderService.getAllDecryptedFromState().then((folders) => {\n        decFolders = folders;\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAllDecrypted().then((ciphers) => {\n        decCiphers = ciphers.filter((f) => f.deletedDate == null);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decFolders, decCiphers);\n    }\n\n    return this.buildJsonExport(decFolders, decCiphers);\n  }\n\n  private async getEncryptedExport(): Promise<string> {\n    let folders: Folder[] = [];\n    let ciphers: Cipher[] = [];\n    const promises = [];\n\n    promises.push(\n      this.folderService.getAllFromState().then((f) => {\n        folders = f;\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAll().then((c) => {\n        ciphers = c.filter((f) => f.deletedDate == null);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid());\n\n    const jsonDoc: BitwardenEncryptedIndividualJsonExport = {\n      encrypted: true,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      folders: [],\n      items: [],\n    };\n\n    folders.forEach((f) => {\n      if (f.id == null) {\n        return;\n      }\n      const folder = new FolderWithIdExport();\n      folder.build(f);\n      jsonDoc.folders.push(folder);\n    });\n\n    ciphers.forEach((c) => {\n      if (c.organizationId != null) {\n        return;\n      }\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      cipher.collectionIds = null;\n      jsonDoc.items.push(cipher);\n    });\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  private buildCsvExport(decFolders: FolderView[], decCiphers: CipherView[]): string {\n    const foldersMap = new Map<string, FolderView>();\n    decFolders.forEach((f) => {\n      if (f.id != null) {\n        foldersMap.set(f.id, f);\n      }\n    });\n\n    const exportCiphers: BitwardenCsvIndividualExportType[] = [];\n    decCiphers.forEach((c) => {\n      // only export logins and secure notes\n      if (c.type !== CipherType.Login && c.type !== CipherType.SecureNote) {\n        return;\n      }\n      if (c.organizationId != null) {\n        return;\n      }\n\n      const cipher = {} as BitwardenCsvIndividualExportType;\n      cipher.folder =\n        c.folderId != null && foldersMap.has(c.folderId) ? foldersMap.get(c.folderId).name : null;\n      cipher.favorite = c.favorite ? 1 : null;\n      this.buildCommonCipher(cipher, c);\n      exportCiphers.push(cipher);\n    });\n\n    return papa.unparse(exportCiphers);\n  }\n\n  private buildJsonExport(decFolders: FolderView[], decCiphers: CipherView[]): string {\n    const jsonDoc: BitwardenUnEncryptedIndividualJsonExport = {\n      encrypted: false,\n      folders: [],\n      items: [],\n    };\n\n    decFolders.forEach((f) => {\n      if (f.id == null) {\n        return;\n      }\n      const folder = new FolderWithIdExport();\n      folder.build(f);\n      jsonDoc.folders.push(folder);\n    });\n\n    decCiphers.forEach((c) => {\n      if (c.organizationId != null) {\n        return;\n      }\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      cipher.collectionIds = null;\n      jsonDoc.items.push(cipher);\n    });\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n}\n","import { BrowserApi } from \"../platform/browser/browser-api\";\n\nexport class SafariApp {\n  static sendMessageToApp(command: string, data: any = null, resolveNow = false): Promise<any> {\n    if (!BrowserApi.isSafariApi) {\n      return Promise.resolve(null);\n    }\n    return new Promise((resolve) => {\n      const now = new Date();\n      const messageId =\n        now.getTime().toString() + \"_\" + Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\n      (browser as any).runtime.sendNativeMessage(\n        \"com.bitwarden.desktop\",\n        {\n          id: messageId,\n          command: command,\n          data: data,\n          responseData: null,\n        },\n        (response: any) => {\n          resolve(response);\n        },\n      );\n    });\n  }\n}\n","import { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\n\nclass BrowserClipboardService {\n  private static consoleLogService: ConsoleLogService = new ConsoleLogService(false);\n\n  /**\n   * Copies the given text to the user's clipboard.\n   *\n   * @param globalContext - The global window context.\n   * @param text - The text to copy.\n   */\n  static async copy(globalContext: Window, text: string) {\n    if (!BrowserClipboardService.isClipboardApiSupported(globalContext, \"writeText\")) {\n      this.useLegacyCopyMethod(globalContext, text);\n      return;\n    }\n\n    try {\n      await globalContext.navigator.clipboard.writeText(text);\n    } catch (error) {\n      BrowserClipboardService.consoleLogService.debug(\n        `Error copying to clipboard using the clipboard API, attempting legacy method: ${error}`,\n      );\n\n      this.useLegacyCopyMethod(globalContext, text);\n    }\n  }\n\n  /**\n   * Reads the user's clipboard and returns the text.\n   *\n   * @param globalContext - The global window context.\n   */\n  static async read(globalContext: Window): Promise<string> {\n    if (!BrowserClipboardService.isClipboardApiSupported(globalContext, \"readText\")) {\n      return this.useLegacyReadMethod(globalContext);\n    }\n\n    try {\n      return await globalContext.navigator.clipboard.readText();\n    } catch (error) {\n      BrowserClipboardService.consoleLogService.debug(\n        `Error reading from clipboard using the clipboard API, attempting legacy method: ${error}`,\n      );\n\n      return this.useLegacyReadMethod(globalContext);\n    }\n  }\n\n  /**\n   * Copies the given text to the user's clipboard using the legacy `execCommand` method. This\n   * method is used as a fallback when the clipboard API is not supported or fails.\n   *\n   * @param globalContext - The global window context.\n   * @param text - The text to copy.\n   */\n  private static useLegacyCopyMethod(globalContext: Window, text: string) {\n    if (!BrowserClipboardService.isLegacyClipboardMethodSupported(globalContext, \"copy\")) {\n      BrowserClipboardService.consoleLogService.warning(\"Legacy copy method not supported\");\n      return;\n    }\n\n    const textareaElement = globalContext.document.createElement(\"textarea\");\n    textareaElement.textContent = !text ? \" \" : text;\n    textareaElement.style.position = \"fixed\";\n    globalContext.document.body.appendChild(textareaElement);\n    textareaElement.select();\n\n    try {\n      globalContext.document.execCommand(\"copy\");\n    } catch (error) {\n      BrowserClipboardService.consoleLogService.warning(`Error writing to clipboard: ${error}`);\n    } finally {\n      globalContext.document.body.removeChild(textareaElement);\n    }\n  }\n\n  /**\n   * Reads the user's clipboard using the legacy `execCommand` method. This method is used as a\n   * fallback when the clipboard API is not supported or fails.\n   *\n   * @param globalContext - The global window context.\n   */\n  private static useLegacyReadMethod(globalContext: Window): string {\n    if (!BrowserClipboardService.isLegacyClipboardMethodSupported(globalContext, \"paste\")) {\n      BrowserClipboardService.consoleLogService.warning(\"Legacy paste method not supported\");\n      return \"\";\n    }\n\n    const textareaElement = globalContext.document.createElement(\"textarea\");\n    textareaElement.style.position = \"fixed\";\n    globalContext.document.body.appendChild(textareaElement);\n    textareaElement.focus();\n\n    try {\n      return globalContext.document.execCommand(\"paste\") ? textareaElement.value : \"\";\n    } catch (error) {\n      BrowserClipboardService.consoleLogService.warning(`Error reading from clipboard: ${error}`);\n    } finally {\n      globalContext.document.body.removeChild(textareaElement);\n    }\n\n    return \"\";\n  }\n\n  /**\n   * Checks if the clipboard API is supported in the current environment.\n   *\n   * @param globalContext - The global window context.\n   * @param method - The clipboard API method to check for support.\n   */\n  private static isClipboardApiSupported(globalContext: Window, method: \"writeText\" | \"readText\") {\n    return \"clipboard\" in globalContext.navigator && method in globalContext.navigator.clipboard;\n  }\n\n  /**\n   * Checks if the legacy clipboard method is supported in the current environment.\n   *\n   * @param globalContext - The global window context.\n   * @param method - The legacy clipboard method to check for support.\n   */\n  private static isLegacyClipboardMethodSupported(globalContext: Window, method: \"copy\" | \"paste\") {\n    return (\n      \"queryCommandSupported\" in globalContext.document &&\n      globalContext.document.queryCommandSupported(method)\n    );\n  }\n}\n\nexport default BrowserClipboardService;\n","import { ClientType, DeviceType } from \"@bitwarden/common/enums\";\nimport {\n  ClipboardOptions,\n  PlatformUtilsService,\n} from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\n\nimport { SafariApp } from \"../../../browser/safariApp\";\nimport { BrowserApi } from \"../../browser/browser-api\";\nimport { OffscreenDocumentService } from \"../../offscreen-document/abstractions/offscreen-document\";\nimport BrowserClipboardService from \"../browser-clipboard.service\";\n\nexport abstract class BrowserPlatformUtilsService implements PlatformUtilsService {\n  private static deviceCache: DeviceType = null;\n\n  constructor(\n    private clipboardWriteCallback: (clipboardValue: string, clearMs: number) => void,\n    private biometricCallback: () => Promise<boolean>,\n    private globalContext: Window | ServiceWorkerGlobalScope,\n    private offscreenDocumentService: OffscreenDocumentService,\n  ) {}\n\n  static getDevice(globalContext: Window | ServiceWorkerGlobalScope): DeviceType {\n    if (this.deviceCache) {\n      return this.deviceCache;\n    }\n\n    if (BrowserPlatformUtilsService.isFirefox()) {\n      this.deviceCache = DeviceType.FirefoxExtension;\n    } else if (BrowserPlatformUtilsService.isOpera(globalContext)) {\n      this.deviceCache = DeviceType.OperaExtension;\n    } else if (BrowserPlatformUtilsService.isEdge()) {\n      this.deviceCache = DeviceType.EdgeExtension;\n    } else if (BrowserPlatformUtilsService.isVivaldi()) {\n      this.deviceCache = DeviceType.VivaldiExtension;\n    } else if (BrowserPlatformUtilsService.isChrome(globalContext)) {\n      this.deviceCache = DeviceType.ChromeExtension;\n    } else if (BrowserPlatformUtilsService.isSafari(globalContext)) {\n      this.deviceCache = DeviceType.SafariExtension;\n    }\n\n    return this.deviceCache;\n  }\n\n  getDevice(): DeviceType {\n    return BrowserPlatformUtilsService.getDevice(this.globalContext);\n  }\n\n  getDeviceString(): string {\n    const device = DeviceType[this.getDevice()].toLowerCase();\n    return device.replace(\"extension\", \"\");\n  }\n\n  getClientType(): ClientType {\n    return ClientType.Browser;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  static isFirefox(): boolean {\n    return (\n      navigator.userAgent.indexOf(\" Firefox/\") !== -1 ||\n      navigator.userAgent.indexOf(\" Gecko/\") !== -1\n    );\n  }\n\n  isFirefox(): boolean {\n    return this.getDevice() === DeviceType.FirefoxExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isChrome(globalContext: Window | ServiceWorkerGlobalScope): boolean {\n    return globalContext.chrome && navigator.userAgent.indexOf(\" Chrome/\") !== -1;\n  }\n\n  isChrome(): boolean {\n    return this.getDevice() === DeviceType.ChromeExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isEdge(): boolean {\n    return navigator.userAgent.indexOf(\" Edg/\") !== -1;\n  }\n\n  isEdge(): boolean {\n    return this.getDevice() === DeviceType.EdgeExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isOpera(globalContext: Window | ServiceWorkerGlobalScope): boolean {\n    return (\n      !!globalContext.opr?.addons ||\n      !!globalContext.opera ||\n      navigator.userAgent.indexOf(\" OPR/\") >= 0\n    );\n  }\n\n  isOpera(): boolean {\n    return this.getDevice() === DeviceType.OperaExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isVivaldi(): boolean {\n    return navigator.userAgent.indexOf(\" Vivaldi/\") !== -1;\n  }\n\n  isVivaldi(): boolean {\n    return this.getDevice() === DeviceType.VivaldiExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  static isSafari(globalContext: Window | ServiceWorkerGlobalScope): boolean {\n    // Opera masquerades as Safari, so make sure we're not there first\n    return (\n      !BrowserPlatformUtilsService.isOpera(globalContext) &&\n      navigator.userAgent.indexOf(\" Safari/\") !== -1\n    );\n  }\n\n  private static safariVersion(): string {\n    return navigator.userAgent.match(\"Version/([0-9.]*)\")?.[1];\n  }\n\n  /**\n   * Safari previous to version 16.1 had a bug which caused artifacts on hover in large extension popups.\n   * https://bugs.webkit.org/show_bug.cgi?id=218704\n   */\n  static shouldApplySafariHeightFix(globalContext: Window | ServiceWorkerGlobalScope): boolean {\n    if (BrowserPlatformUtilsService.getDevice(globalContext) !== DeviceType.SafariExtension) {\n      return false;\n    }\n\n    const version = BrowserPlatformUtilsService.safariVersion();\n    const parts = version?.split(\".\")?.map((v) => Number(v));\n    return parts?.[0] < 16 || (parts?.[0] === 16 && parts?.[1] === 0);\n  }\n\n  isSafari(): boolean {\n    return this.getDevice() === DeviceType.SafariExtension;\n  }\n\n  isIE(): boolean {\n    return false;\n  }\n\n  isMacAppStore(): boolean {\n    return false;\n  }\n\n  /**\n   * Identifies if the vault popup is currently open. This is done by sending a\n   * message to the popup and waiting for a response. If a response is received,\n   * the view is open.\n   */\n  async isViewOpen(): Promise<boolean> {\n    if (this.isSafari()) {\n      // Query views on safari since chrome.runtime.sendMessage does not timeout and will hang.\n      return BrowserApi.isPopupOpen();\n    }\n    return Boolean(await BrowserApi.sendMessageWithResponse(\"checkVaultPopupHeartbeat\"));\n  }\n\n  lockTimeout(): number {\n    return null;\n  }\n\n  launchUri(uri: string, options?: any): void {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.createNewTab(uri, options && options.extensionPage === true);\n  }\n\n  getApplicationVersion(): Promise<string> {\n    const manifest = chrome.runtime.getManifest();\n    return Promise.resolve(manifest.version_name ?? manifest.version);\n  }\n\n  getApplicationVersionNumber(): Promise<string> {\n    const manifest = chrome.runtime.getManifest();\n    return Promise.resolve(manifest.version.split(RegExp(\"[+|-]\"))[0].trim());\n  }\n\n  supportsWebAuthn(win: Window): boolean {\n    return typeof PublicKeyCredential !== \"undefined\";\n  }\n\n  supportsDuo(): boolean {\n    return true;\n  }\n\n  abstract showToast(\n    type: \"error\" | \"success\" | \"warning\" | \"info\",\n    title: string,\n    text: string | string[],\n    options?: any,\n  ): void;\n\n  isDev(): boolean {\n    return process.env.ENV === \"development\";\n  }\n\n  isSelfHost(): boolean {\n    return false;\n  }\n\n  /**\n   * Copies the passed text to the clipboard. For Safari, this will use\n   * the native messaging API to send the text to the Bitwarden app. If\n   * the extension is using manifest v3, the offscreen document API will\n   * be used to copy the text to the clipboard. Otherwise, the browser's\n   * clipboard API will be used.\n   *\n   * @param text - The text to copy to the clipboard.\n   * @param options - Options for the clipboard operation.\n   */\n  copyToClipboard(text: string, options?: ClipboardOptions): void {\n    const windowContext = options?.window || (this.globalContext as Window);\n    const clearing = Boolean(options?.clearing);\n    const clearMs: number = options?.clearMs || null;\n    const handleClipboardWriteCallback = () => {\n      if (!clearing && this.clipboardWriteCallback != null) {\n        this.clipboardWriteCallback(text, clearMs);\n      }\n    };\n\n    if (this.isSafari()) {\n      void SafariApp.sendMessageToApp(\"copyToClipboard\", text).then(handleClipboardWriteCallback);\n\n      return;\n    }\n\n    if (this.isChrome() && text === \"\") {\n      text = \"\\u0000\";\n    }\n\n    if (BrowserApi.isManifestVersion(3) && this.offscreenDocumentService.offscreenApiSupported()) {\n      void this.triggerOffscreenCopyToClipboard(text).then(handleClipboardWriteCallback);\n\n      return;\n    }\n\n    void BrowserClipboardService.copy(windowContext, text).then(handleClipboardWriteCallback);\n  }\n\n  /**\n   * Reads the text from the clipboard. For Safari, this will use the\n   * native messaging API to request the text from the Bitwarden app. If\n   * the extension is using manifest v3, the offscreen document API will\n   * be used to read the text from the clipboard. Otherwise, the browser's\n   * clipboard API will be used.\n   *\n   * @param options - Options for the clipboard operation.\n   */\n  async readFromClipboard(options?: ClipboardOptions): Promise<string> {\n    const windowContext = options?.window || (this.globalContext as Window);\n\n    if (this.isSafari()) {\n      return await SafariApp.sendMessageToApp(\"readFromClipboard\");\n    }\n\n    if (BrowserApi.isManifestVersion(3) && this.offscreenDocumentService.offscreenApiSupported()) {\n      return await this.triggerOffscreenReadFromClipboard();\n    }\n\n    return await BrowserClipboardService.read(windowContext);\n  }\n\n  async supportsBiometric() {\n    const platformInfo = await BrowserApi.getPlatformInfo();\n    if (platformInfo.os === \"mac\" || platformInfo.os === \"win\") {\n      return true;\n    }\n    return false;\n  }\n\n  authenticateBiometric() {\n    return this.biometricCallback();\n  }\n\n  supportsSecureStorage(): boolean {\n    return false;\n  }\n\n  async getAutofillKeyboardShortcut(): Promise<string> {\n    let autofillCommand: string;\n    // You can not change the command in Safari or obtain it programmatically\n    if (this.isSafari()) {\n      autofillCommand = \"Cmd+Shift+L\";\n    } else if (this.isFirefox()) {\n      autofillCommand = (await browser.commands.getAll()).find(\n        (c) => c.name === \"autofill_login\",\n      ).shortcut;\n      // Firefox is returning Ctrl instead of Cmd for the modifier key on macOS if\n      // the command is the default one set on installation.\n      if (\n        (await browser.runtime.getPlatformInfo()).os === \"mac\" &&\n        autofillCommand === \"Ctrl+Shift+L\"\n      ) {\n        autofillCommand = \"Cmd+Shift+L\";\n      }\n    } else {\n      await new Promise((resolve) =>\n        chrome.commands.getAll((c) =>\n          resolve((autofillCommand = c.find((c) => c.name === \"autofill_login\").shortcut)),\n        ),\n      );\n    }\n    return autofillCommand;\n  }\n\n  /**\n   * Triggers the offscreen document API to copy the text to the clipboard.\n   */\n  private async triggerOffscreenCopyToClipboard(text: string) {\n    await this.offscreenDocumentService.withDocument(\n      [chrome.offscreen.Reason.CLIPBOARD],\n      \"Write text to the clipboard.\",\n      async () => {\n        await BrowserApi.sendMessageWithResponse(\"offscreenCopyToClipboard\", { text });\n      },\n    );\n  }\n\n  /**\n   * Triggers the offscreen document API to read the text from the clipboard.\n   */\n  private async triggerOffscreenReadFromClipboard() {\n    const response = await this.offscreenDocumentService.withDocument(\n      [chrome.offscreen.Reason.CLIPBOARD],\n      \"Read text from the clipboard.\",\n      async () => {\n        return await BrowserApi.sendMessageWithResponse(\"offscreenReadFromClipboard\");\n      },\n    );\n    if (typeof response === \"string\") {\n      return response;\n    }\n\n    return \"\";\n  }\n}\n","/**\n * MIT License\n *\n * Copyright (c) Federico Brigante <me@fregante.com> (https://fregante.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n *\n * @see https://github.com/fregante/content-scripts-register-polyfill\n * @version 4.0.2\n */\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\n\nimport { BrowserApi } from \"./browser-api\";\n\nlet registerContentScripts: (\n  contentScriptOptions: browser.contentScripts.RegisteredContentScriptOptions,\n  callback?: (registeredContentScript: browser.contentScripts.RegisteredContentScript) => void,\n) => Promise<browser.contentScripts.RegisteredContentScript>;\nexport async function registerContentScriptsPolyfill(\n  contentScriptOptions: browser.contentScripts.RegisteredContentScriptOptions,\n  callback?: (registeredContentScript: browser.contentScripts.RegisteredContentScript) => void,\n) {\n  if (!registerContentScripts) {\n    registerContentScripts = buildRegisterContentScriptsPolyfill();\n  }\n\n  return registerContentScripts(contentScriptOptions, callback);\n}\n\nfunction buildRegisterContentScriptsPolyfill() {\n  const logService = new ConsoleLogService(false);\n  const chromeProxy = globalThis.chrome && NestedProxy<typeof globalThis.chrome>(globalThis.chrome);\n  const patternValidationRegex =\n    /^(https?|wss?|file|ftp|\\*):\\/\\/(\\*|\\*\\.[^*/]+|[^*/]+)\\/.*$|^file:\\/\\/\\/.*$|^resource:\\/\\/(\\*|\\*\\.[^*/]+|[^*/]+)\\/.*$|^about:/;\n  const isFirefox = globalThis.navigator?.userAgent.includes(\"Firefox/\");\n  const gotScripting = Boolean(globalThis.chrome?.scripting);\n  const gotNavigation = typeof chrome === \"object\" && \"webNavigation\" in chrome;\n\n  function NestedProxy<T extends object>(target: T): T {\n    return new Proxy(target, {\n      get(target, prop) {\n        if (!target[prop as keyof T]) {\n          return;\n        }\n\n        if (typeof target[prop as keyof T] !== \"function\") {\n          return NestedProxy(target[prop as keyof T]);\n        }\n\n        return (...arguments_: any[]) =>\n          new Promise((resolve, reject) => {\n            target[prop as keyof T](...arguments_, (result: any) => {\n              if (chrome.runtime.lastError) {\n                reject(new Error(chrome.runtime.lastError.message));\n              } else {\n                resolve(result);\n              }\n            });\n          });\n      },\n    });\n  }\n\n  function assertValidPattern(matchPattern: string) {\n    if (!isValidPattern(matchPattern)) {\n      throw new Error(\n        `${matchPattern} is an invalid pattern, it must match ${String(patternValidationRegex)}`,\n      );\n    }\n  }\n\n  function isValidPattern(matchPattern: string) {\n    return matchPattern === \"<all_urls>\" || patternValidationRegex.test(matchPattern);\n  }\n\n  function getRawPatternRegex(matchPattern: string) {\n    assertValidPattern(matchPattern);\n    let [, protocol, host = \"\", pathname] = matchPattern.split(/(^[^:]+:[/][/])([^/]+)?/);\n    protocol = protocol\n      .replace(\"*\", isFirefox ? \"(https?|wss?)\" : \"https?\")\n      .replaceAll(/[/]/g, \"[/]\");\n\n    if (host === \"*\") {\n      host = \"[^/]+\";\n    } else if (host) {\n      host = host\n        .replace(/^[*][.]/, \"([^/]+.)*\")\n        .replaceAll(/[.]/g, \"[.]\")\n        .replace(/[*]$/, \"[^.]+\");\n    }\n\n    pathname = pathname\n      .replaceAll(/[/]/g, \"[/]\")\n      .replaceAll(/[.]/g, \"[.]\")\n      .replaceAll(/[*]/g, \".*\");\n\n    return \"^\" + protocol + host + \"(\" + pathname + \")?$\";\n  }\n\n  function patternToRegex(...matchPatterns: string[]) {\n    if (matchPatterns.length === 0) {\n      return /$./;\n    }\n\n    if (matchPatterns.includes(\"<all_urls>\")) {\n      // <all_urls> regex\n      return /^(https?|file|ftp):[/]+/;\n    }\n\n    if (matchPatterns.includes(\"*://*/*\")) {\n      // all stars regex\n      return isFirefox ? /^(https?|wss?):[/][/][^/]+([/].*)?$/ : /^https?:[/][/][^/]+([/].*)?$/;\n    }\n\n    return new RegExp(matchPatterns.map((x) => getRawPatternRegex(x)).join(\"|\"));\n  }\n\n  function castAllFramesTarget(target: number | { tabId: number; frameId: number }) {\n    if (typeof target === \"object\") {\n      return { ...target, allFrames: false };\n    }\n\n    return {\n      tabId: target,\n      frameId: undefined,\n      allFrames: true,\n    };\n  }\n\n  function castArray(possibleArray: any | any[]) {\n    if (Array.isArray(possibleArray)) {\n      return possibleArray;\n    }\n\n    return [possibleArray];\n  }\n\n  function arrayOrUndefined(value?: number) {\n    return value === undefined ? undefined : [value];\n  }\n\n  async function insertCSS(\n    {\n      tabId,\n      frameId,\n      files,\n      allFrames,\n      matchAboutBlank,\n      runAt,\n    }: {\n      tabId: number;\n      frameId?: number;\n      files: browser.extensionTypes.ExtensionFileOrCode[];\n      allFrames: boolean;\n      matchAboutBlank: boolean;\n      runAt: browser.extensionTypes.RunAt;\n    },\n    { ignoreTargetErrors }: { ignoreTargetErrors?: boolean } = {},\n  ) {\n    const everyInsertion = Promise.all(\n      files.map(async (content) => {\n        if (typeof content === \"string\") {\n          content = { file: content };\n        }\n\n        if (gotScripting) {\n          return chrome.scripting.insertCSS({\n            target: {\n              tabId,\n              frameIds: arrayOrUndefined(frameId),\n              allFrames: frameId === undefined ? allFrames : undefined,\n            },\n            files: \"file\" in content ? [content.file] : undefined,\n            css: \"code\" in content ? content.code : undefined,\n          });\n        }\n\n        return chromeProxy.tabs.insertCSS(tabId, {\n          ...content,\n          matchAboutBlank,\n          allFrames,\n          frameId,\n          runAt: runAt ?? \"document_start\",\n        });\n      }),\n    );\n\n    if (ignoreTargetErrors) {\n      await catchTargetInjectionErrors(everyInsertion);\n    } else {\n      await everyInsertion;\n    }\n  }\n  function assertNoCode(files: browser.extensionTypes.ExtensionFileOrCode[]) {\n    if (files.some((content) => \"code\" in content)) {\n      throw new Error(\"chrome.scripting does not support injecting strings of `code`\");\n    }\n  }\n\n  async function executeScript(\n    {\n      tabId,\n      frameId,\n      files,\n      allFrames,\n      matchAboutBlank,\n      runAt,\n    }: {\n      tabId: number;\n      frameId?: number;\n      files: browser.extensionTypes.ExtensionFileOrCode[];\n      allFrames: boolean;\n      matchAboutBlank: boolean;\n      runAt: browser.extensionTypes.RunAt;\n    },\n    { ignoreTargetErrors }: { ignoreTargetErrors?: boolean } = {},\n  ) {\n    const normalizedFiles = files.map((file) => (typeof file === \"string\" ? { file } : file));\n\n    if (gotScripting) {\n      assertNoCode(normalizedFiles);\n      const injection = chrome.scripting.executeScript({\n        target: {\n          tabId,\n          frameIds: arrayOrUndefined(frameId),\n          allFrames: frameId === undefined ? allFrames : undefined,\n        },\n        files: normalizedFiles.map(({ file }: { file: string }) => file),\n      });\n\n      if (ignoreTargetErrors) {\n        await catchTargetInjectionErrors(injection);\n      } else {\n        await injection;\n      }\n\n      return;\n    }\n\n    const executions = [];\n    for (const content of normalizedFiles) {\n      if (\"code\" in content) {\n        await executions.at(-1);\n      }\n\n      executions.push(\n        chromeProxy.tabs.executeScript(tabId, {\n          ...content,\n          matchAboutBlank,\n          allFrames,\n          frameId,\n          runAt,\n        }),\n      );\n    }\n\n    if (ignoreTargetErrors) {\n      await catchTargetInjectionErrors(Promise.all(executions));\n    } else {\n      await Promise.all(executions);\n    }\n  }\n\n  async function injectContentScript(\n    where: { tabId: number; frameId: number },\n    scripts: {\n      css: browser.extensionTypes.ExtensionFileOrCode[];\n      js: browser.extensionTypes.ExtensionFileOrCode[];\n      matchAboutBlank: boolean;\n      runAt: browser.extensionTypes.RunAt;\n    },\n    options = {},\n  ) {\n    const targets = castArray(where);\n    await Promise.all(\n      targets.map(async (target) =>\n        injectContentScriptInSpecificTarget(castAllFramesTarget(target), scripts, options),\n      ),\n    );\n  }\n\n  async function injectContentScriptInSpecificTarget(\n    { frameId, tabId, allFrames }: { frameId?: number; tabId: number; allFrames: boolean },\n    scripts: {\n      css: browser.extensionTypes.ExtensionFileOrCode[];\n      js: browser.extensionTypes.ExtensionFileOrCode[];\n      matchAboutBlank: boolean;\n      runAt: browser.extensionTypes.RunAt;\n    },\n    options = {},\n  ) {\n    const injections = castArray(scripts).flatMap((script) => [\n      insertCSS(\n        {\n          tabId,\n          frameId,\n          allFrames,\n          files: script.css ?? [],\n          matchAboutBlank: script.matchAboutBlank ?? script.match_about_blank,\n          runAt: script.runAt ?? script.run_at,\n        },\n        options,\n      ),\n      executeScript(\n        {\n          tabId,\n          frameId,\n          allFrames,\n          files: script.js ?? [],\n          matchAboutBlank: script.matchAboutBlank ?? script.match_about_blank,\n          runAt: script.runAt ?? script.run_at,\n        },\n        options,\n      ),\n    ]);\n    await Promise.all(injections);\n  }\n\n  async function catchTargetInjectionErrors(promise: Promise<any>) {\n    try {\n      await promise;\n    } catch (error) {\n      const targetErrors =\n        /^No frame with id \\d+ in tab \\d+.$|^No tab with id: \\d+.$|^The tab was closed.$|^The frame was removed.$/;\n      if (!targetErrors.test(error?.message)) {\n        throw error;\n      }\n    }\n  }\n\n  async function isOriginPermitted(url: string) {\n    return chromeProxy.permissions.contains({\n      origins: [new URL(url).origin + \"/*\"],\n    });\n  }\n\n  return async (\n    contentScriptOptions: browser.contentScripts.RegisteredContentScriptOptions,\n    callback: CallableFunction,\n  ) => {\n    const {\n      js = [],\n      css = [],\n      matchAboutBlank,\n      matches = [],\n      excludeMatches,\n      runAt,\n    } = contentScriptOptions;\n    let { allFrames } = contentScriptOptions;\n\n    if (gotNavigation) {\n      allFrames = false;\n    } else if (allFrames) {\n      logService.warning(\n        \"`allFrames: true` requires the `webNavigation` permission to work correctly: https://github.com/fregante/content-scripts-register-polyfill#permissions\",\n      );\n    }\n\n    if (matches.length === 0) {\n      throw new Error(\n        \"Type error for parameter contentScriptOptions (Error processing matches: Array requires at least 1 items; you have 0) for contentScripts.register.\",\n      );\n    }\n\n    await Promise.all(\n      matches.map(async (pattern: string) => {\n        if (!(await chromeProxy.permissions.contains({ origins: [pattern] }))) {\n          throw new Error(`Permission denied to register a content script for ${pattern}`);\n        }\n      }),\n    );\n\n    const matchesRegex = patternToRegex(...matches);\n    const excludeMatchesRegex = patternToRegex(\n      ...(excludeMatches !== null && excludeMatches !== void 0 ? excludeMatches : []),\n    );\n    const inject = async (url: string, tabId: number, frameId = 0) => {\n      if (\n        !matchesRegex.test(url) ||\n        excludeMatchesRegex.test(url) ||\n        !(await isOriginPermitted(url))\n      ) {\n        return;\n      }\n\n      await injectContentScript(\n        { tabId, frameId },\n        { css, js, matchAboutBlank, runAt },\n        { ignoreTargetErrors: true },\n      );\n    };\n    const tabListener = async (\n      tabId: number,\n      { status }: chrome.tabs.TabChangeInfo,\n      { url }: chrome.tabs.Tab,\n    ) => {\n      if (status === \"loading\" && url) {\n        void inject(url, tabId);\n      }\n    };\n    const navListener = async ({\n      tabId,\n      frameId,\n      url,\n    }: chrome.webNavigation.WebNavigationTransitionCallbackDetails) => {\n      void inject(url, tabId, frameId);\n    };\n\n    if (gotNavigation) {\n      BrowserApi.addListener(chrome.webNavigation.onCommitted, navListener);\n    } else {\n      BrowserApi.addListener(chrome.tabs.onUpdated, tabListener);\n    }\n\n    const registeredContentScript = {\n      async unregister() {\n        if (gotNavigation) {\n          chrome.webNavigation.onCommitted.removeListener(navListener);\n        } else {\n          chrome.tabs.onUpdated.removeListener(tabListener);\n        }\n      },\n    };\n\n    if (typeof callback === \"function\") {\n      callback(registeredContentScript);\n    }\n\n    return registeredContentScript;\n  };\n}\n","import { Observable } from \"rxjs\";\n\nimport { DeviceType } from \"@bitwarden/common/enums\";\n\nimport { TabMessage } from \"../../types/tab-messages\";\nimport { BrowserPlatformUtilsService } from \"../services/platform-utils/browser-platform-utils.service\";\n\nimport { registerContentScriptsPolyfill } from \"./browser-api.register-content-scripts-polyfill\";\n\nexport class BrowserApi {\n  static isWebExtensionsApi: boolean = typeof browser !== \"undefined\";\n  static isSafariApi: boolean =\n    navigator.userAgent.indexOf(\" Safari/\") !== -1 &&\n    navigator.userAgent.indexOf(\" Chrome/\") === -1 &&\n    navigator.userAgent.indexOf(\" Chromium/\") === -1;\n  static isChromeApi: boolean = !BrowserApi.isSafariApi && typeof chrome !== \"undefined\";\n  static isFirefoxOnAndroid: boolean =\n    navigator.userAgent.indexOf(\"Firefox/\") !== -1 && navigator.userAgent.indexOf(\"Android\") !== -1;\n\n  static get manifestVersion() {\n    return chrome.runtime.getManifest().manifest_version;\n  }\n\n  /**\n   * Determines if the extension manifest version is the given version.\n   *\n   * @param expectedVersion - The expected manifest version to check against.\n   */\n  static isManifestVersion(expectedVersion: 2 | 3) {\n    return BrowserApi.manifestVersion === expectedVersion;\n  }\n\n  /**\n   * Gets the current window or the window with the given id.\n   *\n   * @param windowId - The id of the window to get. If not provided, the current window is returned.\n   */\n  static async getWindow(windowId?: number): Promise<chrome.windows.Window> {\n    if (!windowId) {\n      return BrowserApi.getCurrentWindow();\n    }\n\n    return await BrowserApi.getWindowById(windowId);\n  }\n\n  /**\n   * Gets the currently active browser window.\n   */\n  static async getCurrentWindow(): Promise<chrome.windows.Window> {\n    return new Promise((resolve) => chrome.windows.getCurrent({ populate: true }, resolve));\n  }\n\n  /**\n   * Gets the window with the given id.\n   *\n   * @param windowId - The id of the window to get.\n   */\n  static async getWindowById(windowId: number): Promise<chrome.windows.Window> {\n    return new Promise((resolve) => chrome.windows.get(windowId, { populate: true }, resolve));\n  }\n\n  static async createWindow(options: chrome.windows.CreateData): Promise<chrome.windows.Window> {\n    return new Promise((resolve) =>\n      chrome.windows.create(options, (window) => {\n        resolve(window);\n      }),\n    );\n  }\n\n  /**\n   * Removes the window with the given id.\n   *\n   * @param windowId - The id of the window to remove.\n   */\n  static async removeWindow(windowId: number): Promise<void> {\n    return new Promise((resolve) => chrome.windows.remove(windowId, () => resolve()));\n  }\n\n  /**\n   * Updates the properties of the window with the given id.\n   *\n   * @param windowId - The id of the window to update.\n   * @param options - The window properties to update.\n   */\n  static async updateWindowProperties(\n    windowId: number,\n    options: chrome.windows.UpdateInfo,\n  ): Promise<void> {\n    return new Promise((resolve) =>\n      chrome.windows.update(windowId, options, () => {\n        resolve();\n      }),\n    );\n  }\n\n  /**\n   * Focuses the window with the given id.\n   *\n   * @param windowId - The id of the window to focus.\n   */\n  static async focusWindow(windowId: number) {\n    await BrowserApi.updateWindowProperties(windowId, { focused: true });\n  }\n\n  static async getTabFromCurrentWindowId(): Promise<chrome.tabs.Tab> | null {\n    return await BrowserApi.tabsQueryFirst({\n      active: true,\n      windowId: chrome.windows.WINDOW_ID_CURRENT,\n    });\n  }\n\n  /**\n   * Gets the tab with the given id.\n   *\n   * @param tabId - The id of the tab to get.\n   */\n  static async getTab(tabId: number): Promise<chrome.tabs.Tab> | null {\n    if (!tabId) {\n      return null;\n    }\n\n    if (BrowserApi.isManifestVersion(3)) {\n      return await chrome.tabs.get(tabId);\n    }\n\n    return new Promise((resolve) =>\n      chrome.tabs.get(tabId, (tab) => {\n        resolve(tab);\n      }),\n    );\n  }\n\n  static async getTabFromCurrentWindow(): Promise<chrome.tabs.Tab> | null {\n    return await BrowserApi.tabsQueryFirst({\n      active: true,\n      currentWindow: true,\n    });\n  }\n\n  static async getActiveTabs(): Promise<chrome.tabs.Tab[]> {\n    return await BrowserApi.tabsQuery({\n      active: true,\n    });\n  }\n\n  static async tabsQuery(options: chrome.tabs.QueryInfo): Promise<chrome.tabs.Tab[]> {\n    return new Promise((resolve) => {\n      chrome.tabs.query(options, (tabs) => {\n        resolve(tabs);\n      });\n    });\n  }\n\n  static async tabsQueryFirst(options: chrome.tabs.QueryInfo): Promise<chrome.tabs.Tab> | null {\n    const tabs = await BrowserApi.tabsQuery(options);\n    if (tabs.length > 0) {\n      return tabs[0];\n    }\n\n    return null;\n  }\n\n  static tabSendMessageData(\n    tab: chrome.tabs.Tab,\n    command: string,\n    data: any = null,\n  ): Promise<void> {\n    const obj: any = {\n      command: command,\n    };\n\n    if (data != null) {\n      obj.data = data;\n    }\n\n    return BrowserApi.tabSendMessage(tab, obj);\n  }\n\n  static async tabSendMessage<T>(\n    tab: chrome.tabs.Tab,\n    obj: T,\n    options: chrome.tabs.MessageSendOptions = null,\n  ): Promise<void> {\n    if (!tab || !tab.id) {\n      return;\n    }\n\n    return new Promise<void>((resolve) => {\n      chrome.tabs.sendMessage(tab.id, obj, options, () => {\n        if (chrome.runtime.lastError) {\n          // Some error happened\n        }\n        resolve();\n      });\n    });\n  }\n\n  static sendTabsMessage<T>(\n    tabId: number,\n    message: TabMessage,\n    options?: chrome.tabs.MessageSendOptions,\n    responseCallback?: (response: T) => void,\n  ) {\n    chrome.tabs.sendMessage<TabMessage, T>(tabId, message, options, responseCallback);\n  }\n\n  static async onWindowCreated(callback: (win: chrome.windows.Window) => any) {\n    // FIXME: Make sure that is does not cause a memory leak in Safari or use BrowserApi.AddListener\n    // and test that it doesn't break.\n    // eslint-disable-next-line no-restricted-syntax\n    return chrome.windows.onCreated.addListener(callback);\n  }\n\n  /**\n   * Gets the background page for the extension. This method is\n   * not valid within manifest v3 background service workers. As\n   * a result, it will return null when called from that context.\n   */\n  static getBackgroundPage(): any {\n    if (typeof chrome.extension.getBackgroundPage === \"undefined\") {\n      return null;\n    }\n\n    return chrome.extension.getBackgroundPage();\n  }\n\n  /**\n   * Accepts a window object and determines if it is\n   * associated with the background page of the extension.\n   *\n   * @param window - The window to check.\n   */\n  static isBackgroundPage(window: Window & typeof globalThis): boolean {\n    return typeof window !== \"undefined\" && window === BrowserApi.getBackgroundPage();\n  }\n\n  /**\n   * Gets the extension views that match the given properties. This method is not\n   * available within background service worker. As a result, it will return an\n   * empty array when called from that context.\n   *\n   * @param fetchProperties - The properties used to filter extension views.\n   */\n  static getExtensionViews(fetchProperties?: chrome.extension.FetchProperties): Window[] {\n    if (typeof chrome.extension.getViews === \"undefined\") {\n      return [];\n    }\n\n    return chrome.extension.getViews(fetchProperties);\n  }\n\n  /**\n   * Queries all extension views that are of type `popup`\n   * and returns whether any are currently open.\n   */\n  static async isPopupOpen(): Promise<boolean> {\n    return Promise.resolve(BrowserApi.getExtensionViews({ type: \"popup\" }).length > 0);\n  }\n\n  static createNewTab(url: string, active = true): Promise<chrome.tabs.Tab> {\n    return new Promise((resolve) =>\n      chrome.tabs.create({ url: url, active: active }, (tab) => resolve(tab)),\n    );\n  }\n\n  // Keep track of all the events registered in a Safari popup so we can remove\n  // them when the popup gets unloaded, otherwise we cause a memory leak\n  private static trackedChromeEventListeners: [\n    event: chrome.events.Event<(...args: unknown[]) => unknown>,\n    callback: (...args: unknown[]) => unknown,\n  ][] = [];\n\n  static messageListener(\n    name: string,\n    callback: (\n      message: any,\n      sender: chrome.runtime.MessageSender,\n      sendResponse: any,\n    ) => boolean | void,\n  ) {\n    BrowserApi.addListener(chrome.runtime.onMessage, callback);\n  }\n\n  static messageListener$() {\n    return new Observable<unknown>((subscriber) => {\n      const handler = (message: unknown) => {\n        subscriber.next(message);\n      };\n\n      BrowserApi.addListener(chrome.runtime.onMessage, handler);\n\n      return () => BrowserApi.removeListener(chrome.runtime.onMessage, handler);\n    });\n  }\n\n  static storageChangeListener(\n    callback: Parameters<typeof chrome.storage.onChanged.addListener>[0],\n  ) {\n    BrowserApi.addListener(chrome.storage.onChanged, callback);\n  }\n\n  /**\n   * Adds a callback to the given chrome event in a cross-browser platform manner.\n   *\n   * **Important:** All event listeners in the browser extension popup context must\n   * use this instead of the native APIs to handle unsubscribing from Safari properly.\n   *\n   * @param event - The event in which to add the listener to.\n   * @param callback - The callback you want registered onto the event.\n   */\n  static addListener<T extends (...args: readonly unknown[]) => unknown>(\n    event: chrome.events.Event<T>,\n    callback: T,\n  ) {\n    event.addListener(callback);\n\n    if (BrowserApi.isSafariApi && !BrowserApi.isBackgroundPage(self)) {\n      BrowserApi.trackedChromeEventListeners.push([event, callback]);\n      BrowserApi.setupUnloadListeners();\n    }\n  }\n\n  /**\n   * Removes a callback from the given chrome event in a cross-browser platform manner.\n   * @param event - The event in which to remove the listener from.\n   * @param callback - The callback you want removed from the event.\n   */\n  static removeListener<T extends (...args: readonly unknown[]) => unknown>(\n    event: chrome.events.Event<T>,\n    callback: T,\n  ) {\n    event.removeListener(callback);\n\n    if (BrowserApi.isSafariApi && !BrowserApi.isBackgroundPage(self)) {\n      const index = BrowserApi.trackedChromeEventListeners.findIndex(([_event, eventListener]) => {\n        return eventListener == callback;\n      });\n      if (index !== -1) {\n        BrowserApi.trackedChromeEventListeners.splice(index, 1);\n      }\n    }\n  }\n\n  // Setup the event to destroy all the listeners when the popup gets unloaded in Safari, otherwise we get a memory leak\n  private static setupUnloadListeners() {\n    // The MDN recommend using 'visibilitychange' but that event is fired any time the popup window is obscured as well\n    // 'pagehide' works just like 'unload' but is compatible with the back/forward cache, so we prefer using that one\n    self.addEventListener(\"pagehide\", () => {\n      for (const [event, callback] of BrowserApi.trackedChromeEventListeners) {\n        event.removeListener(callback);\n      }\n    });\n  }\n\n  static sendMessage(subscriber: string, arg: any = {}) {\n    const message = Object.assign({}, { command: subscriber }, arg);\n    return chrome.runtime.sendMessage(message);\n  }\n\n  static sendMessageWithResponse<TResponse>(subscriber: string, arg: any = {}) {\n    const message = Object.assign({}, { command: subscriber }, arg);\n    return new Promise<TResponse>((resolve) => chrome.runtime.sendMessage(message, resolve));\n  }\n\n  static async focusTab(tabId: number) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    chrome.tabs.update(tabId, { active: true, highlighted: true });\n  }\n\n  static closePopup(win: Window) {\n    if (BrowserApi.isWebExtensionsApi && BrowserApi.isFirefoxOnAndroid) {\n      // Reactivating the active tab dismisses the popup tab. The promise final\n      // condition is only called if the popup wasn't already dismissed (future proofing).\n      // ref: https://bugzilla.mozilla.org/show_bug.cgi?id=1433604\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      browser.tabs.update({ active: true }).finally(win.close);\n    } else {\n      win.close();\n    }\n  }\n\n  static gaFilter() {\n    return process.env.ENV !== \"production\";\n  }\n\n  static getUILanguage() {\n    return chrome.i18n.getUILanguage();\n  }\n\n  /**\n   * Handles reloading the extension, either by calling the window location\n   * to reload or by calling the extension's runtime to reload.\n   *\n   * @param globalContext - The global context to use for the reload.\n   */\n  static reloadExtension(globalContext: (Window & typeof globalThis) | null) {\n    // The passed globalContext might be a ServiceWorkerGlobalScope, as a result\n    // we need to check if the location object exists before calling reload on it.\n    if (typeof globalContext?.location?.reload === \"function\") {\n      return (globalContext as any).location.reload(true);\n    }\n\n    return chrome.runtime.reload();\n  }\n\n  /**\n   * Reloads all open extension views, except the background page. Will also\n   * skip reloading the current window location if exemptCurrentHref is true.\n   *\n   * @param exemptCurrentHref - Whether to exempt the current window location from the reload.\n   */\n  static reloadOpenWindows(exemptCurrentHref = false) {\n    const views = BrowserApi.getExtensionViews();\n    if (!views.length) {\n      return;\n    }\n\n    const currentHref = self.location.href;\n    views\n      .filter((w) => w.location.href != null && !w.location.href.includes(\"background.html\"))\n      .filter((w) => !exemptCurrentHref || w.location.href !== currentHref)\n      .forEach((w) => w.location.reload());\n  }\n\n  static connectNative(application: string): browser.runtime.Port | chrome.runtime.Port {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.runtime.connectNative(application);\n    } else if (BrowserApi.isChromeApi) {\n      return chrome.runtime.connectNative(application);\n    }\n  }\n\n  static requestPermission(permission: any) {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.permissions.request(permission);\n    }\n    return new Promise((resolve) => {\n      chrome.permissions.request(permission, resolve);\n    });\n  }\n\n  /**\n   * Checks if the user has provided the given permissions to the extension.\n   *\n   * @param permissions - The permissions to check.\n   */\n  static async permissionsGranted(permissions: string[]): Promise<boolean> {\n    return new Promise((resolve) =>\n      chrome.permissions.contains({ permissions }, (result) => resolve(result)),\n    );\n  }\n\n  static getPlatformInfo(): Promise<browser.runtime.PlatformInfo | chrome.runtime.PlatformInfo> {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.runtime.getPlatformInfo();\n    }\n    return new Promise((resolve) => {\n      chrome.runtime.getPlatformInfo(resolve);\n    });\n  }\n\n  /**\n   * Returns the supported BrowserAction API based on the manifest version.\n   */\n  static getBrowserAction() {\n    return BrowserApi.isManifestVersion(3) ? chrome.action : chrome.browserAction;\n  }\n\n  static getSidebarAction(\n    win: Window & typeof globalThis,\n  ): OperaSidebarAction | FirefoxSidebarAction | null {\n    const deviceType = BrowserPlatformUtilsService.getDevice(win);\n    if (deviceType !== DeviceType.FirefoxExtension && deviceType !== DeviceType.OperaExtension) {\n      return null;\n    }\n    return win.opr?.sidebarAction || browser.sidebarAction;\n  }\n\n  static captureVisibleTab(): Promise<string> {\n    return new Promise((resolve) => {\n      chrome.tabs.captureVisibleTab(null, { format: \"png\" }, resolve);\n    });\n  }\n\n  /**\n   * Extension API helper method used to execute a script in a tab.\n   *\n   * @see https://developer.chrome.com/docs/extensions/reference/tabs/#method-executeScript\n   * @param tabId - The id of the tab to execute the script in.\n   * @param details {@link \"InjectDetails\" https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes/InjectDetails}\n   * @param scriptingApiDetails {@link \"ExecutionWorld\" https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/ExecutionWorld}\n   */\n  static executeScriptInTab(\n    tabId: number,\n    details: chrome.tabs.InjectDetails,\n    scriptingApiDetails?: {\n      world: chrome.scripting.ExecutionWorld;\n    },\n  ): Promise<unknown> {\n    if (BrowserApi.isManifestVersion(3)) {\n      return chrome.scripting.executeScript({\n        target: {\n          tabId: tabId,\n          allFrames: details.allFrames,\n          frameIds: details.frameId ? [details.frameId] : null,\n        },\n        files: details.file ? [details.file] : null,\n        injectImmediately: details.runAt === \"document_start\",\n        world: scriptingApiDetails?.world || \"ISOLATED\",\n      });\n    }\n\n    return new Promise((resolve) => {\n      chrome.tabs.executeScript(tabId, details, (result) => {\n        resolve(result);\n      });\n    });\n  }\n\n  /**\n   * Identifies if the browser autofill settings are overridden by the extension.\n   */\n  static async browserAutofillSettingsOverridden(): Promise<boolean> {\n    const checkOverrideStatus = (details: chrome.types.ChromeSettingGetResultDetails) =>\n      details.levelOfControl === \"controlled_by_this_extension\" && !details.value;\n\n    const autofillAddressOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.autofillAddressEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    const autofillCreditCardOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.autofillCreditCardEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    const passwordSavingOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.passwordSavingEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    return autofillAddressOverridden && autofillCreditCardOverridden && passwordSavingOverridden;\n  }\n\n  /**\n   * Updates the browser autofill settings to the given value.\n   *\n   * @param value - Determines whether to enable or disable the autofill settings.\n   */\n  static updateDefaultBrowserAutofillSettings(value: boolean) {\n    chrome.privacy.services.autofillAddressEnabled.set({ value });\n    chrome.privacy.services.autofillCreditCardEnabled.set({ value });\n    chrome.privacy.services.passwordSavingEnabled.set({ value });\n  }\n\n  /**\n   * Handles registration of static content scripts within manifest v2.\n   *\n   * @param contentScriptOptions - Details of the registered content scripts\n   */\n  static async registerContentScriptsMv2(\n    contentScriptOptions: browser.contentScripts.RegisteredContentScriptOptions,\n  ): Promise<browser.contentScripts.RegisteredContentScript> {\n    if (typeof browser !== \"undefined\" && !!browser.contentScripts?.register) {\n      return await browser.contentScripts.register(contentScriptOptions);\n    }\n\n    return await registerContentScriptsPolyfill(contentScriptOptions);\n  }\n\n  /**\n   * Handles registration of static content scripts within manifest v3.\n   *\n   * @param scripts - Details of the registered content scripts\n   */\n  static async registerContentScriptsMv3(\n    scripts: chrome.scripting.RegisteredContentScript[],\n  ): Promise<void> {\n    await chrome.scripting.registerContentScripts(scripts);\n  }\n\n  /**\n   * Handles unregistering of static content scripts within manifest v3.\n   *\n   * @param filter - Optional filter to unregister content scripts. Passing an empty object will unregister all content scripts.\n   */\n  static async unregisterContentScriptsMv3(\n    filter?: chrome.scripting.ContentScriptFilter,\n  ): Promise<void> {\n    await chrome.scripting.unregisterContentScripts(filter);\n  }\n}\n","import { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { ContextMenuClickedHandler } from \"../browser/context-menu-clicked-handler\";\n\nimport { LockedVaultPendingNotificationsData } from \"./abstractions/notification.background\";\n\nexport default class ContextMenusBackground {\n  private contextMenus: typeof chrome.contextMenus;\n\n  constructor(private contextMenuClickedHandler: ContextMenuClickedHandler) {\n    this.contextMenus = chrome.contextMenus;\n  }\n\n  init() {\n    if (!this.contextMenus) {\n      return;\n    }\n\n    this.contextMenus.onClicked.addListener((info, tab) =>\n      this.contextMenuClickedHandler.run(info, tab),\n    );\n\n    BrowserApi.messageListener(\n      \"contextmenus.background\",\n      (\n        msg: { command: string; data: LockedVaultPendingNotificationsData },\n        sender: chrome.runtime.MessageSender,\n      ) => {\n        if (msg.command === \"unlockCompleted\" && msg.data.target === \"contextmenus.background\") {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.contextMenuClickedHandler\n            .cipherAction(\n              msg.data.commandToRetry.message.contextMenuOnClickData,\n              msg.data.commandToRetry.sender.tab,\n            )\n            .then(() => {\n              // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n              BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n            });\n        }\n      },\n    );\n  }\n}\n","import { BrowserApi } from \"../browser/browser-api\";\n\nimport { ScrollOptions } from \"./abstractions/browser-popup-utils.abstractions\";\n\nclass BrowserPopupUtils {\n  /**\n   * Identifies if the popup is within the sidebar.\n   *\n   * @param win - The passed window object.\n   */\n  static inSidebar(win: Window): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"uilocation\", \"sidebar\");\n  }\n\n  /**\n   * Identifies if the popup is within the popout.\n   *\n   * @param win - The passed window object.\n   */\n  static inPopout(win: Window): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"uilocation\", \"popout\");\n  }\n\n  /**\n   * Identifies if the popup is within the single action popout.\n   *\n   * @param win - The passed window object.\n   * @param popoutKey - The single action popout key used to identify the popout.\n   */\n  static inSingleActionPopout(win: Window, popoutKey: string): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"singleActionPopout\", popoutKey);\n  }\n\n  /**\n   * Identifies if the popup is within the popup.\n   *\n   * @param win - The passed window object.\n   */\n  static inPopup(win: Window): boolean {\n    return (\n      win.location.href.indexOf(\"uilocation=\") === -1 ||\n      win.location.href.indexOf(\"uilocation=popup\") > -1\n    );\n  }\n\n  /**\n   * Gets the scroll position of the popup.\n   *\n   * @param win - The passed window object.\n   * @param scrollingContainer - Element tag name of the scrolling container.\n   */\n  static getContentScrollY(win: Window, scrollingContainer = \"main\"): number {\n    const content = win.document.getElementsByTagName(scrollingContainer)[0];\n    return content.scrollTop;\n  }\n\n  /**\n   * Sets the scroll position of the popup.\n   *\n   * @param win - The passed window object.\n   * @param scrollYAmount - The amount to scroll the popup.\n   * @param options - Allows for setting the delay in ms to wait before scrolling the popup and the scrolling container tag name.\n   */\n  static async setContentScrollY(\n    win: Window,\n    scrollYAmount: number | undefined,\n    options: ScrollOptions = {\n      delay: 0,\n      containerSelector: \"main\",\n    },\n  ) {\n    const { delay, containerSelector } = options;\n    return new Promise<void>((resolve) =>\n      win.setTimeout(() => {\n        const container = win.document.querySelector(containerSelector);\n        if (!isNaN(scrollYAmount) && container) {\n          container.scrollTop = scrollYAmount;\n        }\n\n        resolve();\n      }, delay),\n    );\n  }\n\n  /**\n   * Identifies if the background page needs to be initialized.\n   */\n  static backgroundInitializationRequired() {\n    return !BrowserApi.getBackgroundPage();\n  }\n\n  /**\n   * Opens a popout window of any extension page. If the popout window is already open, it will be focused.\n   *\n   * @param extensionUrlPath - A relative path to the extension page. Example: \"popup/index.html#/tabs/vault\"\n   * @param options - Options for the popout window that overrides the default options.\n   */\n  static async openPopout(\n    extensionUrlPath: string,\n    options: {\n      senderWindowId?: number;\n      singleActionKey?: string;\n      forceCloseExistingWindows?: boolean;\n      windowOptions?: Partial<chrome.windows.CreateData>;\n    } = {},\n  ) {\n    const { senderWindowId, singleActionKey, forceCloseExistingWindows, windowOptions } = options;\n    const defaultPopoutWindowOptions: chrome.windows.CreateData = {\n      type: \"popup\",\n      focused: true,\n      width: 380,\n      height: 630,\n    };\n    const offsetRight = 15;\n    const offsetTop = 90;\n    const popupWidth = defaultPopoutWindowOptions.width;\n    const senderWindow = await BrowserApi.getWindow(senderWindowId);\n    const popoutWindowOptions = {\n      left: senderWindow.left + senderWindow.width - popupWidth - offsetRight,\n      top: senderWindow.top + offsetTop,\n      ...defaultPopoutWindowOptions,\n      ...windowOptions,\n      url: BrowserPopupUtils.buildPopoutUrl(extensionUrlPath, singleActionKey),\n    };\n\n    if (\n      (await BrowserPopupUtils.isSingleActionPopoutOpen(\n        singleActionKey,\n        popoutWindowOptions,\n        forceCloseExistingWindows,\n      )) &&\n      !forceCloseExistingWindows\n    ) {\n      return;\n    }\n\n    return await BrowserApi.createWindow(popoutWindowOptions);\n  }\n\n  /**\n   * Closes the single action popout window.\n   *\n   * @param popoutKey - The single action popout key used to identify the popout.\n   * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n   */\n  static async closeSingleActionPopout(popoutKey: string, delayClose = 0): Promise<void> {\n    const extensionUrl = chrome.runtime.getURL(\"popup/index.html\");\n    const tabs = await BrowserApi.tabsQuery({ url: `${extensionUrl}*` });\n    for (const tab of tabs) {\n      if (!tab.url.includes(`singleActionPopout=${popoutKey}`)) {\n        continue;\n      }\n\n      setTimeout(() => BrowserApi.removeWindow(tab.windowId), delayClose);\n    }\n  }\n\n  /**\n   * Opens a popout window for the current page.\n   * If the current page is set for the current tab, then the\n   * popout window will be set for the vault items listing tab.\n   *\n   * @param win - The passed window object.\n   * @param href - The href to open in the popout window.\n   */\n  static async openCurrentPagePopout(win: Window, href: string = null) {\n    const popoutUrl = href || win.location.href;\n    const parsedUrl = new URL(popoutUrl);\n    let hashRoute = parsedUrl.hash;\n    if (hashRoute.startsWith(\"#/tabs/current\")) {\n      hashRoute = \"#/tabs/vault\";\n    }\n\n    await BrowserPopupUtils.openPopout(`${parsedUrl.pathname}${hashRoute}`);\n\n    if (BrowserPopupUtils.inPopup(win)) {\n      BrowserApi.closePopup(win);\n    }\n  }\n\n  /**\n   * Identifies if a single action window is open based on the passed popoutKey.\n   * Will focus the existing window, and close any other windows that might exist\n   * with the same popout key.\n   *\n   * @param popoutKey - The single action popout key used to identify the popout.\n   * @param windowInfo - The window info to use to update the existing window.\n   * @param forceCloseExistingWindows - Identifies if the existing windows should be closed.\n   */\n  private static async isSingleActionPopoutOpen(\n    popoutKey: string | undefined,\n    windowInfo: chrome.windows.CreateData,\n    forceCloseExistingWindows = false,\n  ) {\n    if (!popoutKey) {\n      return false;\n    }\n\n    const extensionUrl = chrome.runtime.getURL(\"popup/index.html\");\n    const popoutTabs = (await BrowserApi.tabsQuery({ url: `${extensionUrl}*` })).filter((tab) =>\n      tab.url.includes(`singleActionPopout=${popoutKey}`),\n    );\n    if (popoutTabs.length === 0) {\n      return false;\n    }\n\n    if (!forceCloseExistingWindows) {\n      // Update first, remove it from list\n      const tab = popoutTabs.shift();\n      await BrowserApi.updateWindowProperties(tab.windowId, {\n        focused: true,\n        width: windowInfo.width,\n        height: windowInfo.height,\n        top: windowInfo.top,\n        left: windowInfo.left,\n      });\n    }\n\n    popoutTabs.forEach((tab) => BrowserApi.removeWindow(tab.windowId));\n\n    return true;\n  }\n\n  /**\n   * Identifies if the url contains the specified search param and value.\n   *\n   * @param win - The passed window object.\n   * @param searchParam - The search param to identify.\n   * @param searchValue - The search value to identify.\n   */\n  private static urlContainsSearchParams(\n    win: Window,\n    searchParam: string,\n    searchValue: string,\n  ): boolean {\n    return win.location.href.indexOf(`${searchParam}=${searchValue}`) > -1;\n  }\n\n  /**\n   * Builds the popout url path. Ensures that the uilocation param is set to\n   * `popout` and that the singleActionPopout param is set to the passed singleActionKey.\n   *\n   * @param extensionUrlPath - A relative path to the extension page. Example: \"popup/index.html#/tabs/vault\"\n   * @param singleActionKey - The single action popout key used to identify the popout.\n   */\n  private static buildPopoutUrl(extensionUrlPath: string, singleActionKey: string) {\n    const parsedUrl = new URL(chrome.runtime.getURL(extensionUrlPath));\n    parsedUrl.searchParams.set(\"uilocation\", \"popout\");\n\n    if (singleActionKey) {\n      parsedUrl.searchParams.set(\"singleActionPopout\", singleActionKey);\n    }\n\n    return parsedUrl.toString();\n  }\n}\n\nexport default BrowserPopupUtils;\n","import { BrowserApi } from \"../../../platform/browser/browser-api\";\nimport BrowserPopupUtils from \"../../../platform/popup/browser-popup-utils\";\n\nconst AuthPopoutType = {\n  unlockExtension: \"auth_unlockExtension\",\n  ssoAuthResult: \"auth_ssoAuthResult\",\n  twoFactorAuth: \"auth_twoFactorAuth\",\n} as const;\nconst extensionUnlockUrls = new Set([\n  chrome.runtime.getURL(\"popup/index.html#/lock\"),\n  chrome.runtime.getURL(\"popup/index.html#/home\"),\n]);\n\n/**\n * Opens a window that facilitates unlocking / logging into the extension.\n *\n * @param senderTab - Used to determine the windowId of the sender.\n * @param skipNotification - Used to determine whether to show the unlock notification.\n */\nasync function openUnlockPopout(senderTab: chrome.tabs.Tab, skipNotification = false) {\n  const existingPopoutWindowTabs = await BrowserApi.tabsQuery({ windowType: \"popup\" });\n  existingPopoutWindowTabs.forEach((tab) => {\n    if (extensionUnlockUrls.has(tab.url)) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.removeWindow(tab.windowId);\n    }\n  });\n\n  await BrowserPopupUtils.openPopout(\"popup/index.html\", {\n    singleActionKey: AuthPopoutType.unlockExtension,\n    senderWindowId: senderTab.windowId,\n  });\n  await BrowserApi.tabSendMessageData(senderTab, \"bgUnlockPopoutOpened\", { skipNotification });\n}\n\n/**\n * Closes the unlock popout window.\n */\nasync function closeUnlockPopout() {\n  await BrowserPopupUtils.closeSingleActionPopout(AuthPopoutType.unlockExtension);\n}\n\n/**\n * Opens a window that facilitates presenting the results for SSO authentication.\n *\n * @param resultData - The result data from the SSO authentication.\n */\nasync function openSsoAuthResultPopout(resultData: { code: string; state: string }) {\n  const { code, state } = resultData;\n  const authResultUrl = `popup/index.html#/sso?code=${encodeURIComponent(\n    code,\n  )}&state=${encodeURIComponent(state)}`;\n\n  await BrowserPopupUtils.openPopout(authResultUrl, {\n    singleActionKey: AuthPopoutType.ssoAuthResult,\n  });\n}\n\n/**\n * Opens a window that facilitates two-factor authentication.\n *\n * @param twoFactorAuthData - The data from the two-factor authentication.\n */\nasync function openTwoFactorAuthPopout(twoFactorAuthData: { data: string; remember: string }) {\n  const { data, remember } = twoFactorAuthData;\n  const params =\n    `webAuthnResponse=${encodeURIComponent(data)};` + `remember=${encodeURIComponent(remember)}`;\n  const twoFactorUrl = `popup/index.html#/2fa;${params}`;\n\n  await BrowserPopupUtils.openPopout(twoFactorUrl, {\n    singleActionKey: AuthPopoutType.twoFactorAuth,\n  });\n}\n\n/**\n * Closes the two-factor authentication popout window.\n */\nasync function closeTwoFactorAuthPopout() {\n  await BrowserPopupUtils.closeSingleActionPopout(AuthPopoutType.twoFactorAuth);\n}\n\nexport {\n  AuthPopoutType,\n  openUnlockPopout,\n  closeUnlockPopout,\n  openSsoAuthResultPopout,\n  openTwoFactorAuthPopout,\n  closeTwoFactorAuthPopout,\n};\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\n\nimport { BrowserApi } from \"../../../platform/browser/browser-api\";\nimport BrowserPopupUtils from \"../../../platform/popup/browser-popup-utils\";\n\nconst VaultPopoutType = {\n  viewVaultItem: \"vault_viewVaultItem\",\n  addEditVaultItem: \"vault_AddEditVaultItem\",\n  fido2Popout: \"vault_Fido2Popout\",\n} as const;\n\n/**\n * Opens a popout window that facilitates viewing a vault item.\n *\n * @param senderTab - The tab that sent the request.\n * @param cipherOptions - The cipher id and action to perform.\n */\nasync function openViewVaultItemPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: {\n    cipherId: string;\n    action: string;\n    forceCloseExistingWindows?: boolean;\n  },\n) {\n  const { cipherId, action, forceCloseExistingWindows } = cipherOptions;\n  let promptWindowPath = \"popup/index.html#/view-cipher\";\n  let queryParamToken = \"?\";\n  const formatQueryString = (key: string, value: string) => {\n    const queryString = `${queryParamToken}${key}=${value}`;\n    queryParamToken = \"&\";\n    return queryString;\n  };\n\n  if (cipherId) {\n    promptWindowPath += formatQueryString(\"cipherId\", cipherId);\n  }\n  if (senderTab.id) {\n    promptWindowPath += formatQueryString(\"senderTabId\", String(senderTab.id));\n  }\n  if (action) {\n    promptWindowPath += formatQueryString(\"action\", action);\n  }\n\n  await BrowserPopupUtils.openPopout(promptWindowPath, {\n    singleActionKey: `${VaultPopoutType.viewVaultItem}_${cipherId}`,\n    senderWindowId: senderTab.windowId,\n    forceCloseExistingWindows,\n  });\n}\n\n/**\n * Closes the view vault item popout window.\n *\n * @param singleActionKey - The single action popout key used to identify the popout.\n * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n */\nasync function closeViewVaultItemPopout(singleActionKey: string, delayClose = 0) {\n  await BrowserPopupUtils.closeSingleActionPopout(singleActionKey, delayClose);\n}\n\n/**\n * Opens a popout window that facilitates re-prompting for\n * the password of a vault item.\n *\n * @param senderTab - The tab that sent the request.\n * @param cipherOptions - The cipher id and action to perform.\n */\nasync function openVaultItemPasswordRepromptPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: {\n    cipherId: string;\n    action: string;\n  },\n) {\n  await openViewVaultItemPopout(senderTab, {\n    forceCloseExistingWindows: true,\n    ...cipherOptions,\n  });\n  await BrowserApi.tabSendMessageData(senderTab, \"bgVaultItemRepromptPopoutOpened\");\n}\n\n/**\n * Opens a popout window that facilitates adding or editing a vault item.\n *\n * @param senderTab - The window id of the sender.\n * @param cipherOptions - Options passed as query params to the popout.\n */\nasync function openAddEditVaultItemPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: { cipherId?: string; cipherType?: CipherType } = {},\n) {\n  const { cipherId, cipherType } = cipherOptions;\n  const { url, windowId } = senderTab;\n  let singleActionKey = VaultPopoutType.addEditVaultItem;\n  let addEditCipherUrl = \"popup/index.html#/edit-cipher\";\n  let queryParamToken = \"?\";\n  const formatQueryString = (key: string, value: string) => {\n    const queryString = `${queryParamToken}${key}=${value}`;\n    queryParamToken = \"&\";\n    return queryString;\n  };\n\n  if (cipherId && !cipherType) {\n    singleActionKey += `_${cipherId}`;\n    addEditCipherUrl += formatQueryString(\"cipherId\", cipherId);\n  }\n  if (cipherType && !cipherId) {\n    singleActionKey += `_${cipherType}`;\n    addEditCipherUrl += formatQueryString(\"type\", String(cipherType));\n  }\n  if (senderTab.url) {\n    addEditCipherUrl += formatQueryString(\"uri\", url);\n  }\n\n  await BrowserPopupUtils.openPopout(addEditCipherUrl, {\n    singleActionKey,\n    senderWindowId: windowId,\n  });\n}\n\n/**\n * Closes the add/edit vault item popout window.\n *\n * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n */\nasync function closeAddEditVaultItemPopout(delayClose = 0) {\n  await BrowserPopupUtils.closeSingleActionPopout(VaultPopoutType.addEditVaultItem, delayClose);\n}\n\n/**\n * Opens a popout window that facilitates FIDO2\n * authentication and passkey management.\n *\n * @param senderTab - The tab that sent the request.\n * @param options - Options passed as query params to the popout.\n */\nasync function openFido2Popout(\n  senderTab: chrome.tabs.Tab,\n  options: {\n    sessionId: string;\n    fallbackSupported: boolean;\n  },\n): Promise<chrome.windows.Window[\"id\"]> {\n  const { sessionId, fallbackSupported } = options;\n  const promptWindowPath =\n    \"popup/index.html#/fido2\" +\n    `?sessionId=${sessionId}` +\n    `&fallbackSupported=${fallbackSupported}` +\n    `&senderTabId=${senderTab.id}` +\n    `&senderUrl=${encodeURIComponent(senderTab.url)}`;\n\n  const popoutWindow = await BrowserPopupUtils.openPopout(promptWindowPath, {\n    singleActionKey: `${VaultPopoutType.fido2Popout}_${sessionId}`,\n    senderWindowId: senderTab.windowId,\n    forceCloseExistingWindows: true,\n    windowOptions: { height: 570 },\n  });\n\n  return popoutWindow.id;\n}\n\n/**\n * Closes the FIDO2 popout window associated with the passed session ID.\n *\n * @param sessionId - The session ID of the popout to close.\n */\nasync function closeFido2Popout(sessionId: string): Promise<void> {\n  await BrowserPopupUtils.closeSingleActionPopout(`${VaultPopoutType.fido2Popout}_${sessionId}`);\n}\n\nexport {\n  VaultPopoutType,\n  openViewVaultItemPopout,\n  closeViewVaultItemPopout,\n  openVaultItemPasswordRepromptPopout,\n  openAddEditVaultItemPopout,\n  closeAddEditVaultItemPopout,\n  openFido2Popout,\n  closeFido2Popout,\n};\n","const NotificationQueueMessageType = {\n  AddLogin: \"add\",\n  ChangePassword: \"change\",\n  UnlockVault: \"unlock\",\n  RequestFilelessImport: \"fileless-import\",\n} as const;\n\ntype NotificationQueueMessageTypes =\n  (typeof NotificationQueueMessageType)[keyof typeof NotificationQueueMessageType];\n\nexport { NotificationQueueMessageType, NotificationQueueMessageTypes };\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { NOTIFICATION_BAR_LIFESPAN_MS } from \"@bitwarden/common/autofill/constants\";\nimport { DomainSettingsService } from \"@bitwarden/common/autofill/services/domain-settings.service\";\nimport { UserNotificationSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/user-notification-settings.service\";\nimport { NeverDomains } from \"@bitwarden/common/models/domain/domain-service\";\nimport { ConfigService } from \"@bitwarden/common/platform/abstractions/config/config.service\";\nimport { ServerConfig } from \"@bitwarden/common/platform/abstractions/config/server-config\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { ThemeStateService } from \"@bitwarden/common/platform/theming/theme-state.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\nimport { openAddEditVaultItemPopout } from \"../../vault/popup/utils/vault-popout-window\";\nimport { NotificationQueueMessageType } from \"../enums/notification-queue-message-type.enum\";\nimport { AutofillService } from \"../services/abstractions/autofill.service\";\n\nimport {\n  AddChangePasswordQueueMessage,\n  AddLoginQueueMessage,\n  AddRequestFilelessImportQueueMessage,\n  AddUnlockVaultQueueMessage,\n  ChangePasswordMessageData,\n  AddLoginMessageData,\n  NotificationQueueMessageItem,\n  LockedVaultPendingNotificationsData,\n  NotificationBackgroundExtensionMessage,\n  NotificationBackgroundExtensionMessageHandlers,\n} from \"./abstractions/notification.background\";\nimport { OverlayBackgroundExtensionMessage } from \"./abstractions/overlay.background\";\n\nexport default class NotificationBackground {\n  private openUnlockPopout = openUnlockPopout;\n  private openAddEditVaultItemPopout = openAddEditVaultItemPopout;\n  private notificationQueue: NotificationQueueMessageItem[] = [];\n  private readonly extensionMessageHandlers: NotificationBackgroundExtensionMessageHandlers = {\n    unlockCompleted: ({ message, sender }) => this.handleUnlockCompleted(message, sender),\n    bgGetFolderData: () => this.getFolderData(),\n    bgCloseNotificationBar: ({ sender }) => this.handleCloseNotificationBarMessage(sender),\n    bgAdjustNotificationBar: ({ message, sender }) =>\n      this.handleAdjustNotificationBarMessage(message, sender),\n    bgAddLogin: ({ message, sender }) => this.addLogin(message, sender),\n    bgChangedPassword: ({ message, sender }) => this.changedPassword(message, sender),\n    bgRemoveTabFromNotificationQueue: ({ sender }) =>\n      this.removeTabFromNotificationQueue(sender.tab),\n    bgSaveCipher: ({ message, sender }) => this.handleSaveCipherMessage(message, sender),\n    bgNeverSave: ({ sender }) => this.saveNever(sender.tab),\n    collectPageDetailsResponse: ({ message }) =>\n      this.handleCollectPageDetailsResponseMessage(message),\n    bgUnlockPopoutOpened: ({ message, sender }) => this.unlockVault(message, sender.tab),\n    checkNotificationQueue: ({ sender }) => this.checkNotificationQueue(sender.tab),\n    bgReopenUnlockPopout: ({ sender }) => this.openUnlockPopout(sender.tab),\n    bgGetEnableChangedPasswordPrompt: () => this.getEnableChangedPasswordPrompt(),\n    bgGetEnableAddedLoginPrompt: () => this.getEnableAddedLoginPrompt(),\n    bgGetExcludedDomains: () => this.getExcludedDomains(),\n    bgGetActiveUserServerConfig: () => this.getActiveUserServerConfig(),\n    getWebVaultUrlForNotification: () => this.getWebVaultUrl(),\n  };\n\n  constructor(\n    private autofillService: AutofillService,\n    private cipherService: CipherService,\n    private authService: AuthService,\n    private policyService: PolicyService,\n    private folderService: FolderService,\n    private stateService: BrowserStateService,\n    private userNotificationSettingsService: UserNotificationSettingsServiceAbstraction,\n    private domainSettingsService: DomainSettingsService,\n    private environmentService: EnvironmentService,\n    private logService: LogService,\n    private themeStateService: ThemeStateService,\n    private configService: ConfigService,\n  ) {}\n\n  async init() {\n    if (chrome.runtime == null) {\n      return;\n    }\n\n    this.setupExtensionMessageListener();\n\n    this.cleanupNotificationQueue();\n  }\n\n  /**\n   * Gets the enableChangedPasswordPrompt setting from the user notification settings service.\n   */\n  async getEnableChangedPasswordPrompt(): Promise<boolean> {\n    return await firstValueFrom(this.userNotificationSettingsService.enableChangedPasswordPrompt$);\n  }\n\n  /**\n   * Gets the enableAddedLoginPrompt setting from the user notification settings service.\n   */\n  async getEnableAddedLoginPrompt(): Promise<boolean> {\n    return await firstValueFrom(this.userNotificationSettingsService.enableAddedLoginPrompt$);\n  }\n\n  /**\n   * Gets the neverDomains setting from the domain settings service.\n   */\n  async getExcludedDomains(): Promise<NeverDomains> {\n    return await firstValueFrom(this.domainSettingsService.neverDomains$);\n  }\n\n  /**\n   * Gets the active user server config from the config service.\n   */\n  async getActiveUserServerConfig(): Promise<ServerConfig> {\n    return await firstValueFrom(this.configService.serverConfig$);\n  }\n\n  /**\n   * Checks the notification queue for any messages that need to be sent to the\n   * specified tab. If no tab is specified, the current tab will be used.\n   *\n   * @param tab - The tab to check the notification queue for\n   */\n  async checkNotificationQueue(tab: chrome.tabs.Tab = null): Promise<void> {\n    if (this.notificationQueue.length === 0) {\n      return;\n    }\n\n    if (tab != null) {\n      await this.doNotificationQueueCheck(tab);\n      return;\n    }\n\n    const currentTab = await BrowserApi.getTabFromCurrentWindow();\n    if (currentTab != null) {\n      await this.doNotificationQueueCheck(currentTab);\n    }\n  }\n\n  private cleanupNotificationQueue() {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      if (this.notificationQueue[i].expires < new Date()) {\n        BrowserApi.tabSendMessageData(this.notificationQueue[i].tab, \"closeNotificationBar\").catch(\n          (error) => this.logService.error(error),\n        );\n        this.notificationQueue.splice(i, 1);\n      }\n    }\n    setTimeout(() => this.cleanupNotificationQueue(), 30000); // check every 30 seconds\n  }\n\n  private async doNotificationQueueCheck(tab: chrome.tabs.Tab): Promise<void> {\n    const tabDomain = Utils.getDomain(tab?.url);\n    if (!tabDomain) {\n      return;\n    }\n\n    const queueMessage = this.notificationQueue.find(\n      (message) => message.tab.id === tab.id && message.domain === tabDomain,\n    );\n    if (queueMessage) {\n      await this.sendNotificationQueueMessage(tab, queueMessage);\n    }\n  }\n\n  private async sendNotificationQueueMessage(\n    tab: chrome.tabs.Tab,\n    notificationQueueMessage: NotificationQueueMessageItem,\n  ) {\n    const notificationType = notificationQueueMessage.type;\n\n    const typeData: Record<string, any> = {\n      isVaultLocked: notificationQueueMessage.wasVaultLocked,\n      theme: await firstValueFrom(this.themeStateService.selectedTheme$),\n    };\n\n    switch (notificationType) {\n      case NotificationQueueMessageType.AddLogin:\n        typeData.removeIndividualVault = await this.removeIndividualVault();\n        break;\n      case NotificationQueueMessageType.RequestFilelessImport:\n        typeData.importType = (\n          notificationQueueMessage as AddRequestFilelessImportQueueMessage\n        ).importType;\n        break;\n    }\n\n    await BrowserApi.tabSendMessageData(tab, \"openNotificationBar\", {\n      type: notificationType,\n      typeData,\n    });\n  }\n\n  /**\n   * Removes any login messages from the notification queue that\n   * are associated with the specified tab.\n   *\n   * @param tab - The tab to remove messages for\n   */\n  private removeTabFromNotificationQueue(tab: chrome.tabs.Tab) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      if (this.notificationQueue[i].tab.id === tab.id) {\n        this.notificationQueue.splice(i, 1);\n      }\n    }\n  }\n\n  /**\n   * Adds a login message to the notification queue, prompting the user to save\n   * the login if it does not already exist in the vault. If the cipher exists\n   * but the password has changed, the user will be prompted to update the password.\n   *\n   * @param message - The message to add to the queue\n   * @param sender - The contextual sender of the message\n   */\n  private async addLogin(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const authStatus = await this.authService.getAuthStatus();\n    if (authStatus === AuthenticationStatus.LoggedOut) {\n      return;\n    }\n\n    const loginInfo = message.login;\n    const normalizedUsername = loginInfo.username ? loginInfo.username.toLowerCase() : \"\";\n    const loginDomain = Utils.getDomain(loginInfo.url);\n    if (loginDomain == null) {\n      return;\n    }\n\n    const addLoginIsEnabled = await this.getEnableAddedLoginPrompt();\n\n    if (authStatus === AuthenticationStatus.Locked) {\n      if (addLoginIsEnabled) {\n        await this.pushAddLoginToQueue(loginDomain, loginInfo, sender.tab, true);\n      }\n\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(loginInfo.url);\n    const usernameMatches = ciphers.filter(\n      (c) => c.login.username != null && c.login.username.toLowerCase() === normalizedUsername,\n    );\n    if (addLoginIsEnabled && usernameMatches.length === 0) {\n      await this.pushAddLoginToQueue(loginDomain, loginInfo, sender.tab);\n      return;\n    }\n\n    const changePasswordIsEnabled = await this.getEnableChangedPasswordPrompt();\n\n    if (\n      changePasswordIsEnabled &&\n      usernameMatches.length === 1 &&\n      usernameMatches[0].login.password !== loginInfo.password\n    ) {\n      await this.pushChangePasswordToQueue(\n        usernameMatches[0].id,\n        loginDomain,\n        loginInfo.password,\n        sender.tab,\n      );\n    }\n  }\n\n  private async pushAddLoginToQueue(\n    loginDomain: string,\n    loginInfo: AddLoginMessageData,\n    tab: chrome.tabs.Tab,\n    isVaultLocked = false,\n  ) {\n    // remove any old messages for this tab\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddLoginQueueMessage = {\n      type: NotificationQueueMessageType.AddLogin,\n      username: loginInfo.username,\n      password: loginInfo.password,\n      domain: loginDomain,\n      uri: loginInfo.url,\n      tab: tab,\n      expires: new Date(new Date().getTime() + NOTIFICATION_BAR_LIFESPAN_MS),\n      wasVaultLocked: isVaultLocked,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n  }\n\n  /**\n   * Adds a change password message to the notification queue, prompting the user\n   * to update the password for a login that has changed.\n   *\n   * @param message - The message to add to the queue\n   * @param sender - The contextual sender of the message\n   */\n  private async changedPassword(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const changeData = message.data as ChangePasswordMessageData;\n    const loginDomain = Utils.getDomain(changeData.url);\n    if (loginDomain == null) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      await this.pushChangePasswordToQueue(\n        null,\n        loginDomain,\n        changeData.newPassword,\n        sender.tab,\n        true,\n      );\n      return;\n    }\n\n    let id: string = null;\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(changeData.url);\n    if (changeData.currentPassword != null) {\n      const passwordMatches = ciphers.filter(\n        (c) => c.login.password === changeData.currentPassword,\n      );\n      if (passwordMatches.length === 1) {\n        id = passwordMatches[0].id;\n      }\n    } else if (ciphers.length === 1) {\n      id = ciphers[0].id;\n    }\n    if (id != null) {\n      await this.pushChangePasswordToQueue(id, loginDomain, changeData.newPassword, sender.tab);\n    }\n  }\n\n  /**\n   * Sends the page details to the notification bar. Will query all\n   * forms with a password field and pass them to the notification bar.\n   *\n   * @param message - The extension message\n   */\n  private async handleCollectPageDetailsResponseMessage(\n    message: NotificationBackgroundExtensionMessage,\n  ) {\n    if (message.sender !== \"notificationBar\") {\n      return;\n    }\n\n    const forms = this.autofillService.getFormsWithPasswordFields(message.details);\n    await BrowserApi.tabSendMessageData(message.tab, \"notificationBarPageDetails\", {\n      details: message.details,\n      forms: forms,\n    });\n  }\n\n  /**\n   * Sets up a notification to unlock the vault when the user\n   * attempts to autofill a cipher while the vault is locked.\n   *\n   * @param message - Extension message, determines if the notification should be skipped\n   * @param tab - The tab that the message was sent from\n   */\n  private async unlockVault(message: NotificationBackgroundExtensionMessage, tab: chrome.tabs.Tab) {\n    if (message.data?.skipNotification) {\n      return;\n    }\n\n    const currentAuthStatus = await this.authService.getAuthStatus();\n    if (currentAuthStatus !== AuthenticationStatus.Locked || this.notificationQueue.length) {\n      return;\n    }\n\n    const loginDomain = Utils.getDomain(tab.url);\n    if (loginDomain) {\n      await this.pushUnlockVaultToQueue(loginDomain, tab);\n    }\n  }\n\n  /**\n   * Sets up a notification to request a fileless import when the user\n   * attempts to trigger an import from a third party website.\n   *\n   * @param tab - The tab that we are sending the notification to\n   * @param importType - The type of import that is being requested\n   */\n  async requestFilelessImport(tab: chrome.tabs.Tab, importType: string) {\n    const currentAuthStatus = await this.authService.getAuthStatus();\n    if (currentAuthStatus !== AuthenticationStatus.Unlocked || this.notificationQueue.length) {\n      return;\n    }\n\n    const loginDomain = Utils.getDomain(tab.url);\n    if (loginDomain) {\n      await this.pushRequestFilelessImportToQueue(loginDomain, tab, importType);\n    }\n  }\n\n  private async pushChangePasswordToQueue(\n    cipherId: string,\n    loginDomain: string,\n    newPassword: string,\n    tab: chrome.tabs.Tab,\n    isVaultLocked = false,\n  ) {\n    // remove any old messages for this tab\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddChangePasswordQueueMessage = {\n      type: NotificationQueueMessageType.ChangePassword,\n      cipherId: cipherId,\n      newPassword: newPassword,\n      domain: loginDomain,\n      tab: tab,\n      expires: new Date(new Date().getTime() + NOTIFICATION_BAR_LIFESPAN_MS),\n      wasVaultLocked: isVaultLocked,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n  }\n\n  private async pushUnlockVaultToQueue(loginDomain: string, tab: chrome.tabs.Tab) {\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddUnlockVaultQueueMessage = {\n      type: NotificationQueueMessageType.UnlockVault,\n      domain: loginDomain,\n      tab: tab,\n      expires: new Date(new Date().getTime() + 0.5 * 60000), // 30 seconds\n      wasVaultLocked: true,\n    };\n    await this.sendNotificationQueueMessage(tab, message);\n  }\n\n  /**\n   * Pushes a request to start a fileless import to the notification queue.\n   * This will display a notification bar to the user, prompting them to\n   * start the import.\n   *\n   * @param loginDomain - The domain of the tab that we are sending the notification to\n   * @param tab - The tab that we are sending the notification to\n   * @param importType - The type of import that is being requested\n   */\n  private async pushRequestFilelessImportToQueue(\n    loginDomain: string,\n    tab: chrome.tabs.Tab,\n    importType?: string,\n  ) {\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddRequestFilelessImportQueueMessage = {\n      type: NotificationQueueMessageType.RequestFilelessImport,\n      domain: loginDomain,\n      tab,\n      expires: new Date(new Date().getTime() + 0.5 * 60000), // 30 seconds\n      wasVaultLocked: false,\n      importType,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n    this.removeTabFromNotificationQueue(tab);\n  }\n\n  /**\n   * Saves a cipher based on the message sent from the notification bar. If the vault\n   * is locked, the message will be added to the notification queue and the unlock\n   * popout will be opened.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleSaveCipherMessage(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      await BrowserApi.tabSendMessageData(sender.tab, \"addToLockedVaultPendingNotifications\", {\n        commandToRetry: {\n          message: {\n            command: message.command,\n            edit: message.edit,\n            folder: message.folder,\n          },\n          sender: sender,\n        },\n        target: \"notification.background\",\n      } as LockedVaultPendingNotificationsData);\n      await this.openUnlockPopout(sender.tab);\n      return;\n    }\n\n    await this.saveOrUpdateCredentials(sender.tab, message.edit, message.folder);\n  }\n\n  /**\n   * Saves or updates credentials based on the message within the\n   * notification queue that is associated with the specified tab.\n   *\n   * @param tab - The tab to save or update credentials for\n   * @param edit - Identifies if the credentials should be edited or simply added\n   * @param folderId - The folder to add the cipher to\n   */\n  private async saveOrUpdateCredentials(tab: chrome.tabs.Tab, edit: boolean, folderId?: string) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      const queueMessage = this.notificationQueue[i];\n      if (\n        queueMessage.tab.id !== tab.id ||\n        (queueMessage.type !== NotificationQueueMessageType.AddLogin &&\n          queueMessage.type !== NotificationQueueMessageType.ChangePassword)\n      ) {\n        continue;\n      }\n\n      const tabDomain = Utils.getDomain(tab.url);\n      if (tabDomain != null && tabDomain !== queueMessage.domain) {\n        continue;\n      }\n\n      this.notificationQueue.splice(i, 1);\n\n      if (queueMessage.type === NotificationQueueMessageType.ChangePassword) {\n        const cipherView = await this.getDecryptedCipherById(queueMessage.cipherId);\n        await this.updatePassword(cipherView, queueMessage.newPassword, edit, tab);\n        return;\n      }\n\n      // If the vault was locked, check if a cipher needs updating instead of creating a new one\n      if (queueMessage.wasVaultLocked) {\n        const allCiphers = await this.cipherService.getAllDecryptedForUrl(queueMessage.uri);\n        const existingCipher = allCiphers.find(\n          (c) =>\n            c.login.username != null && c.login.username.toLowerCase() === queueMessage.username,\n        );\n\n        if (existingCipher != null) {\n          await this.updatePassword(existingCipher, queueMessage.password, edit, tab);\n          return;\n        }\n      }\n\n      folderId = (await this.folderExists(folderId)) ? folderId : null;\n      const newCipher = this.convertAddLoginQueueMessageToCipherView(queueMessage, folderId);\n\n      if (edit) {\n        await this.editItem(newCipher, tab);\n        await BrowserApi.tabSendMessage(tab, { command: \"closeNotificationBar\" });\n        return;\n      }\n\n      const cipher = await this.cipherService.encrypt(newCipher);\n      try {\n        await this.cipherService.createWithServer(cipher);\n        await BrowserApi.tabSendMessage(tab, { command: \"saveCipherAttemptCompleted\" });\n        await BrowserApi.tabSendMessage(tab, { command: \"addedCipher\" });\n      } catch (error) {\n        await BrowserApi.tabSendMessageData(tab, \"saveCipherAttemptCompleted\", {\n          error: String(error.message),\n        });\n      }\n    }\n  }\n\n  /**\n   * Handles updating an existing cipher's password. If the cipher\n   * is being edited, a popup will be opened to allow the user to\n   * edit the cipher.\n   *\n   * @param cipherView - The cipher to update\n   * @param newPassword - The new password to update the cipher with\n   * @param edit - Identifies if the cipher should be edited or simply updated\n   * @param tab - The tab that the message was sent from\n   */\n  private async updatePassword(\n    cipherView: CipherView,\n    newPassword: string,\n    edit: boolean,\n    tab: chrome.tabs.Tab,\n  ) {\n    cipherView.login.password = newPassword;\n\n    if (edit) {\n      await this.editItem(cipherView, tab);\n      await BrowserApi.tabSendMessage(tab, { command: \"closeNotificationBar\" });\n      await BrowserApi.tabSendMessage(tab, { command: \"editedCipher\" });\n      return;\n    }\n\n    const cipher = await this.cipherService.encrypt(cipherView);\n    try {\n      // We've only updated the password, no need to broadcast editedCipher message\n      await this.cipherService.updateWithServer(cipher);\n      await BrowserApi.tabSendMessage(tab, { command: \"saveCipherAttemptCompleted\" });\n    } catch (error) {\n      await BrowserApi.tabSendMessageData(tab, \"saveCipherAttemptCompleted\", {\n        error: String(error.message),\n      });\n    }\n  }\n\n  /**\n   * Sets the add/edit cipher info in the cipher service\n   * and opens the add/edit vault item popout.\n   *\n   * @param cipherView - The cipher to edit\n   * @param senderTab - The tab that the message was sent from\n   */\n  private async editItem(cipherView: CipherView, senderTab: chrome.tabs.Tab) {\n    await this.cipherService.setAddEditCipherInfo({\n      cipher: cipherView,\n      collectionIds: cipherView.collectionIds,\n    });\n\n    await this.openAddEditVaultItemPopout(senderTab, { cipherId: cipherView.id });\n  }\n\n  private async folderExists(folderId: string) {\n    if (Utils.isNullOrWhitespace(folderId) || folderId === \"null\") {\n      return false;\n    }\n\n    const folders = await firstValueFrom(this.folderService.folderViews$);\n    return folders.some((x) => x.id === folderId);\n  }\n\n  private async getDecryptedCipherById(cipherId: string) {\n    const cipher = await this.cipherService.get(cipherId);\n    if (cipher != null && cipher.type === CipherType.Login) {\n      return await cipher.decrypt(await this.cipherService.getKeyForCipherKeyDecryption(cipher));\n    }\n    return null;\n  }\n\n  /**\n   * Saves the current tab's domain to the never save list.\n   *\n   * @param tab - The tab that sent the neverSave message\n   */\n  private async saveNever(tab: chrome.tabs.Tab) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      const queueMessage = this.notificationQueue[i];\n      if (\n        queueMessage.tab.id !== tab.id ||\n        queueMessage.type !== NotificationQueueMessageType.AddLogin\n      ) {\n        continue;\n      }\n\n      const tabDomain = Utils.getDomain(tab.url);\n      if (tabDomain != null && tabDomain !== queueMessage.domain) {\n        continue;\n      }\n\n      this.notificationQueue.splice(i, 1);\n      await BrowserApi.tabSendMessageData(tab, \"closeNotificationBar\");\n\n      const hostname = Utils.getHostname(tab.url);\n      await this.cipherService.saveNeverDomain(hostname);\n    }\n  }\n\n  /**\n   * Returns the first value found from the folder service's folderViews$ observable.\n   */\n  private async getFolderData() {\n    return await firstValueFrom(this.folderService.folderViews$);\n  }\n\n  private async getWebVaultUrl(): Promise<string> {\n    const env = await firstValueFrom(this.environmentService.environment$);\n    return env.getWebVaultUrl();\n  }\n\n  private async removeIndividualVault(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  /**\n   * Handles the unlockCompleted extension message. Will close the notification bar\n   * after an attempted autofill action, and retry the autofill action if the message\n   * contains a follow-up command.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleUnlockCompleted(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ): Promise<void> {\n    const messageData = message.data as LockedVaultPendingNotificationsData;\n    const retryCommand = messageData.commandToRetry.message.command;\n    if (retryCommand === \"autofill_login\") {\n      await BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n    }\n\n    if (messageData.target !== \"notification.background\") {\n      return;\n    }\n\n    const retryHandler: CallableFunction | undefined = this.extensionMessageHandlers[retryCommand];\n    if (retryHandler) {\n      retryHandler({\n        message: messageData.commandToRetry.message,\n        sender: messageData.commandToRetry.sender,\n      });\n    }\n  }\n\n  /**\n   * Sends a message back to the sender tab which\n   * triggers closure of the notification bar.\n   *\n   * @param sender - The contextual sender of the message\n   */\n  private async handleCloseNotificationBarMessage(sender: chrome.runtime.MessageSender) {\n    await BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n  }\n\n  /**\n   * Sends a message back to the sender tab which triggers\n   * an CSS adjustment of the notification bar.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleAdjustNotificationBarMessage(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    await BrowserApi.tabSendMessageData(sender.tab, \"adjustNotificationBar\", message.data);\n  }\n\n  /**\n   * Accepts a login queue message and converts it into a\n   * login uri view, login view, and cipher view.\n   *\n   * @param message - The message to convert to a cipher view\n   * @param folderId - The folder to add the cipher to\n   */\n  private convertAddLoginQueueMessageToCipherView(\n    message: AddLoginQueueMessage,\n    folderId?: string,\n  ): CipherView {\n    const uriView = new LoginUriView();\n    uriView.uri = message.uri;\n\n    const loginView = new LoginView();\n    loginView.uris = [uriView];\n    loginView.username = message.username;\n    loginView.password = message.password;\n\n    const cipherView = new CipherView();\n    cipherView.name = (Utils.getHostname(message.uri) || message.domain).replace(/^www\\./, \"\");\n    cipherView.folderId = folderId;\n    cipherView.type = CipherType.Login;\n    cipherView.login = loginView;\n\n    return cipherView;\n  }\n\n  private setupExtensionMessageListener() {\n    BrowserApi.messageListener(\"notification.background\", this.handleExtensionMessage);\n  }\n\n  private handleExtensionMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n    sendResponse: (response?: any) => void,\n  ) => {\n    const handler: CallableFunction | undefined = this.extensionMessageHandlers[message?.command];\n    if (!handler) {\n      return;\n    }\n\n    const messageResponse = handler({ message, sender });\n    if (!messageResponse) {\n      return;\n    }\n\n    Promise.resolve(messageResponse)\n      .then((response) => sendResponse(response))\n      .catch((error) => this.logService.error(error));\n    return true;\n  };\n}\n","import { Utils } from \"../../platform/misc/utils\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherView } from \"../models/view/cipher.view\";\n\nexport function buildCipherIcon(iconsServerUrl: string, cipher: CipherView, showFavicon: boolean) {\n  let icon;\n  let image;\n  let fallbackImage = \"\";\n  const cardIcons: Record<string, string> = {\n    Visa: \"card-visa\",\n    Mastercard: \"card-mastercard\",\n    Amex: \"card-amex\",\n    Discover: \"card-discover\",\n    \"Diners Club\": \"card-diners-club\",\n    JCB: \"card-jcb\",\n    Maestro: \"card-maestro\",\n    UnionPay: \"card-union-pay\",\n    RuPay: \"card-ru-pay\",\n  };\n\n  switch (cipher.type) {\n    case CipherType.Login:\n      icon = \"bwi-globe\";\n\n      if (cipher.login.uri) {\n        let hostnameUri = cipher.login.uri;\n        let isWebsite = false;\n\n        if (hostnameUri.indexOf(\"androidapp://\") === 0) {\n          icon = \"bwi-android\";\n          image = null;\n        } else if (hostnameUri.indexOf(\"iosapp://\") === 0) {\n          icon = \"bwi-apple\";\n          image = null;\n        } else if (\n          showFavicon &&\n          hostnameUri.indexOf(\"://\") === -1 &&\n          hostnameUri.indexOf(\".\") > -1\n        ) {\n          hostnameUri = `http://${hostnameUri}`;\n          isWebsite = true;\n        } else if (showFavicon) {\n          isWebsite = hostnameUri.indexOf(\"http\") === 0 && hostnameUri.indexOf(\".\") > -1;\n        }\n\n        if (showFavicon && isWebsite) {\n          try {\n            image = `${iconsServerUrl}/${Utils.getHostname(hostnameUri)}/icon.png`;\n            fallbackImage = \"images/bwi-globe.png\";\n          } catch (e) {\n            // Ignore error since the fallback icon will be shown if image is null.\n          }\n        }\n      } else {\n        image = null;\n      }\n      break;\n    case CipherType.SecureNote:\n      icon = \"bwi-sticky-note\";\n      break;\n    case CipherType.Card:\n      icon = \"bwi-credit-card\";\n      if (showFavicon && cipher.card.brand in cardIcons) {\n        icon = `credit-card-icon ${cardIcons[cipher.card.brand]}`;\n      }\n      break;\n    case CipherType.Identity:\n      icon = \"bwi-id-card\";\n      break;\n    default:\n      break;\n  }\n\n  return {\n    imageEnabled: showFavicon,\n    image,\n    fallbackImage,\n    icon,\n  };\n}\n","const AutofillOverlayElement = {\n  Button: \"autofill-overlay-button\",\n  List: \"autofill-overlay-list\",\n} as const;\n\nconst AutofillOverlayPort = {\n  Button: \"autofill-overlay-button-port\",\n  List: \"autofill-overlay-list-port\",\n} as const;\n\nconst RedirectFocusDirection = {\n  Current: \"current\",\n  Previous: \"previous\",\n  Next: \"next\",\n} as const;\n\nexport { AutofillOverlayElement, AutofillOverlayPort, RedirectFocusDirection };\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { SHOW_AUTOFILL_BUTTON } from \"@bitwarden/common/autofill/constants\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { DomainSettingsService } from \"@bitwarden/common/autofill/services/domain-settings.service\";\nimport { InlineMenuVisibilitySetting } from \"@bitwarden/common/autofill/types\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { ThemeStateService } from \"@bitwarden/common/platform/theming/theme-state.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { buildCipherIcon } from \"@bitwarden/common/vault/icon/build-cipher-icon\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport {\n  openViewVaultItemPopout,\n  openAddEditVaultItemPopout,\n} from \"../../vault/popup/utils/vault-popout-window\";\nimport { AutofillService, PageDetail } from \"../services/abstractions/autofill.service\";\nimport { AutofillOverlayElement, AutofillOverlayPort } from \"../utils/autofill-overlay.enum\";\n\nimport { LockedVaultPendingNotificationsData } from \"./abstractions/notification.background\";\nimport {\n  FocusedFieldData,\n  OverlayBackgroundExtensionMessageHandlers,\n  OverlayButtonPortMessageHandlers,\n  OverlayCipherData,\n  OverlayListPortMessageHandlers,\n  OverlayBackground as OverlayBackgroundInterface,\n  OverlayBackgroundExtensionMessage,\n  OverlayAddNewItemMessage,\n  OverlayPortMessage,\n  WebsiteIconData,\n} from \"./abstractions/overlay.background\";\n\nclass OverlayBackground implements OverlayBackgroundInterface {\n  private readonly openUnlockPopout = openUnlockPopout;\n  private readonly openViewVaultItemPopout = openViewVaultItemPopout;\n  private readonly openAddEditVaultItemPopout = openAddEditVaultItemPopout;\n  private overlayLoginCiphers: Map<string, CipherView> = new Map();\n  private pageDetailsForTab: Record<\n    chrome.runtime.MessageSender[\"tab\"][\"id\"],\n    Map<chrome.runtime.MessageSender[\"frameId\"], PageDetail>\n  > = {};\n  private userAuthStatus: AuthenticationStatus = AuthenticationStatus.LoggedOut;\n  private overlayButtonPort: chrome.runtime.Port;\n  private overlayListPort: chrome.runtime.Port;\n  private expiredPorts: chrome.runtime.Port[] = [];\n  private focusedFieldData: FocusedFieldData;\n  private overlayPageTranslations: Record<string, string>;\n  private iconsServerUrl: string;\n  private readonly extensionMessageHandlers: OverlayBackgroundExtensionMessageHandlers = {\n    openAutofillOverlay: () => this.openOverlay(false),\n    autofillOverlayElementClosed: ({ message, sender }) =>\n      this.overlayElementClosed(message, sender),\n    autofillOverlayAddNewVaultItem: ({ message, sender }) => this.addNewVaultItem(message, sender),\n    getAutofillOverlayVisibility: () => this.getOverlayVisibility(),\n    checkAutofillOverlayFocused: () => this.checkOverlayFocused(),\n    focusAutofillOverlayList: () => this.focusOverlayList(),\n    updateAutofillOverlayPosition: ({ message, sender }) =>\n      this.updateOverlayPosition(message, sender),\n    updateAutofillOverlayHidden: ({ message }) => this.updateOverlayHidden(message),\n    updateFocusedFieldData: ({ message, sender }) => this.setFocusedFieldData(message, sender),\n    collectPageDetailsResponse: ({ message, sender }) => this.storePageDetails(message, sender),\n    unlockCompleted: ({ message }) => this.unlockCompleted(message),\n    addEditCipherSubmitted: () => this.updateOverlayCiphers(),\n    deletedCipher: () => this.updateOverlayCiphers(),\n  };\n  private readonly overlayButtonPortMessageHandlers: OverlayButtonPortMessageHandlers = {\n    overlayButtonClicked: ({ port }) => this.handleOverlayButtonClicked(port),\n    closeAutofillOverlay: ({ port }) => this.closeOverlay(port),\n    forceCloseAutofillOverlay: ({ port }) => this.closeOverlay(port, true),\n    overlayPageBlurred: () => this.checkOverlayListFocused(),\n    redirectOverlayFocusOut: ({ message, port }) => this.redirectOverlayFocusOut(message, port),\n  };\n  private readonly overlayListPortMessageHandlers: OverlayListPortMessageHandlers = {\n    checkAutofillOverlayButtonFocused: () => this.checkOverlayButtonFocused(),\n    forceCloseAutofillOverlay: ({ port }) => this.closeOverlay(port, true),\n    overlayPageBlurred: () => this.checkOverlayButtonFocused(),\n    unlockVault: ({ port }) => this.unlockVault(port),\n    fillSelectedListItem: ({ message, port }) => this.fillSelectedOverlayListItem(message, port),\n    addNewVaultItem: ({ port }) => this.getNewVaultItemDetails(port),\n    viewSelectedCipher: ({ message, port }) => this.viewSelectedCipher(message, port),\n    redirectOverlayFocusOut: ({ message, port }) => this.redirectOverlayFocusOut(message, port),\n  };\n\n  constructor(\n    private cipherService: CipherService,\n    private autofillService: AutofillService,\n    private authService: AuthService,\n    private environmentService: EnvironmentService,\n    private domainSettingsService: DomainSettingsService,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private i18nService: I18nService,\n    private platformUtilsService: PlatformUtilsService,\n    private themeStateService: ThemeStateService,\n  ) {}\n\n  /**\n   * Removes cached page details for a tab\n   * based on the passed tabId.\n   *\n   * @param tabId - Used to reference the page details of a specific tab\n   */\n  removePageDetails(tabId: number) {\n    if (!this.pageDetailsForTab[tabId]) {\n      return;\n    }\n\n    this.pageDetailsForTab[tabId].clear();\n    delete this.pageDetailsForTab[tabId];\n  }\n\n  /**\n   * Sets up the extension message listeners and gets the settings for the\n   * overlay's visibility and the user's authentication status.\n   */\n  async init() {\n    this.setupExtensionMessageListeners();\n    const env = await firstValueFrom(this.environmentService.environment$);\n    this.iconsServerUrl = env.getIconsUrl();\n    await this.getOverlayVisibility();\n    await this.getAuthStatus();\n  }\n\n  /**\n   * Updates the overlay list's ciphers and sends the updated list to the overlay list iframe.\n   * Queries all ciphers for the given url, and sorts them by last used. Will not update the\n   * list of ciphers if the extension is not unlocked.\n   */\n  async updateOverlayCiphers() {\n    const authStatus = await firstValueFrom(this.authService.activeAccountStatus$);\n    if (authStatus !== AuthenticationStatus.Unlocked) {\n      return;\n    }\n\n    const currentTab = await BrowserApi.getTabFromCurrentWindowId();\n    if (!currentTab?.url) {\n      return;\n    }\n\n    this.overlayLoginCiphers = new Map();\n    const ciphersViews = (await this.cipherService.getAllDecryptedForUrl(currentTab.url)).sort(\n      (a, b) => this.cipherService.sortCiphersByLastUsedThenName(a, b),\n    );\n    for (let cipherIndex = 0; cipherIndex < ciphersViews.length; cipherIndex++) {\n      this.overlayLoginCiphers.set(`overlay-cipher-${cipherIndex}`, ciphersViews[cipherIndex]);\n    }\n\n    const ciphers = await this.getOverlayCipherData();\n    this.overlayListPort?.postMessage({ command: \"updateOverlayListCiphers\", ciphers });\n    await BrowserApi.tabSendMessageData(currentTab, \"updateIsOverlayCiphersPopulated\", {\n      isOverlayCiphersPopulated: Boolean(ciphers.length),\n    });\n  }\n\n  /**\n   * Strips out unnecessary data from the ciphers and returns an array of\n   * objects that contain the cipher data needed for the overlay list.\n   */\n  private async getOverlayCipherData(): Promise<OverlayCipherData[]> {\n    const showFavicons = await firstValueFrom(this.domainSettingsService.showFavicons$);\n    const overlayCiphersArray = Array.from(this.overlayLoginCiphers);\n    const overlayCipherData: OverlayCipherData[] = [];\n    let loginCipherIcon: WebsiteIconData;\n\n    for (let cipherIndex = 0; cipherIndex < overlayCiphersArray.length; cipherIndex++) {\n      const [overlayCipherId, cipher] = overlayCiphersArray[cipherIndex];\n      if (!loginCipherIcon && cipher.type === CipherType.Login) {\n        loginCipherIcon = buildCipherIcon(this.iconsServerUrl, cipher, showFavicons);\n      }\n\n      overlayCipherData.push({\n        id: overlayCipherId,\n        name: cipher.name,\n        type: cipher.type,\n        reprompt: cipher.reprompt,\n        favorite: cipher.favorite,\n        icon:\n          cipher.type === CipherType.Login\n            ? loginCipherIcon\n            : buildCipherIcon(this.iconsServerUrl, cipher, showFavicons),\n        login: cipher.type === CipherType.Login ? { username: cipher.login.username } : null,\n        card: cipher.type === CipherType.Card ? cipher.card.subTitle : null,\n      });\n    }\n\n    return overlayCipherData;\n  }\n\n  /**\n   * Handles aggregation of page details for a tab. Stores the page details\n   * in association with the tabId of the tab that sent the message.\n   *\n   * @param message - Message received from the `collectPageDetailsResponse` command\n   * @param sender - The sender of the message\n   */\n  private storePageDetails(\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const pageDetails = {\n      frameId: sender.frameId,\n      tab: sender.tab,\n      details: message.details,\n    };\n\n    const pageDetailsMap = this.pageDetailsForTab[sender.tab.id];\n    if (!pageDetailsMap) {\n      this.pageDetailsForTab[sender.tab.id] = new Map([[sender.frameId, pageDetails]]);\n      return;\n    }\n\n    pageDetailsMap.set(sender.frameId, pageDetails);\n  }\n\n  /**\n   * Triggers autofill for the selected cipher in the overlay list. Also places\n   * the selected cipher at the top of the list of ciphers.\n   *\n   * @param overlayCipherId - Cipher ID corresponding to the overlayLoginCiphers map. Does not correspond to the actual cipher's ID.\n   * @param sender - The sender of the port message\n   */\n  private async fillSelectedOverlayListItem(\n    { overlayCipherId }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    const pageDetails = this.pageDetailsForTab[sender.tab.id];\n    if (!overlayCipherId || !pageDetails?.size) {\n      return;\n    }\n\n    const cipher = this.overlayLoginCiphers.get(overlayCipherId);\n\n    if (await this.autofillService.isPasswordRepromptRequired(cipher, sender.tab)) {\n      return;\n    }\n    const totpCode = await this.autofillService.doAutoFill({\n      tab: sender.tab,\n      cipher: cipher,\n      pageDetails: Array.from(pageDetails.values()),\n      fillNewPassword: true,\n      allowTotpAutofill: true,\n    });\n\n    if (totpCode) {\n      this.platformUtilsService.copyToClipboard(totpCode);\n    }\n\n    this.overlayLoginCiphers = new Map([[overlayCipherId, cipher], ...this.overlayLoginCiphers]);\n  }\n\n  /**\n   * Checks if the overlay is focused. Will check the overlay list\n   * if it is open, otherwise it will check the overlay button.\n   */\n  private checkOverlayFocused() {\n    if (this.overlayListPort) {\n      this.checkOverlayListFocused();\n\n      return;\n    }\n\n    this.checkOverlayButtonFocused();\n  }\n\n  /**\n   * Posts a message to the overlay button iframe to check if it is focused.\n   */\n  private checkOverlayButtonFocused() {\n    this.overlayButtonPort?.postMessage({ command: \"checkAutofillOverlayButtonFocused\" });\n  }\n\n  /**\n   * Posts a message to the overlay list iframe to check if it is focused.\n   */\n  private checkOverlayListFocused() {\n    this.overlayListPort?.postMessage({ command: \"checkAutofillOverlayListFocused\" });\n  }\n\n  /**\n   * Sends a message to the sender tab to close the autofill overlay.\n   *\n   * @param sender - The sender of the port message\n   * @param forceCloseOverlay - Identifies whether the overlay should be force closed\n   */\n  private closeOverlay({ sender }: chrome.runtime.Port, forceCloseOverlay = false) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessageData(sender.tab, \"closeAutofillOverlay\", { forceCloseOverlay });\n  }\n\n  /**\n   * Handles cleanup when an overlay element is closed. Disconnects\n   * the list and button ports and sets them to null.\n   *\n   * @param overlayElement - The overlay element that was closed, either the list or button\n   * @param sender - The sender of the port message\n   */\n  private overlayElementClosed(\n    { overlayElement }: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (sender.tab.id !== this.focusedFieldData?.tabId) {\n      this.expiredPorts.forEach((port) => port.disconnect());\n      this.expiredPorts = [];\n      return;\n    }\n\n    if (overlayElement === AutofillOverlayElement.Button) {\n      this.overlayButtonPort?.disconnect();\n      this.overlayButtonPort = null;\n\n      return;\n    }\n\n    this.overlayListPort?.disconnect();\n    this.overlayListPort = null;\n  }\n\n  /**\n   * Updates the position of either the overlay list or button. The position\n   * is based on the focused field's position and dimensions.\n   *\n   * @param overlayElement - The overlay element to update, either the list or button\n   * @param sender - The sender of the port message\n   */\n  private updateOverlayPosition(\n    { overlayElement }: { overlayElement?: string },\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (!overlayElement || sender.tab.id !== this.focusedFieldData?.tabId) {\n      return;\n    }\n\n    if (overlayElement === AutofillOverlayElement.Button) {\n      this.overlayButtonPort?.postMessage({\n        command: \"updateIframePosition\",\n        styles: this.getOverlayButtonPosition(),\n      });\n\n      return;\n    }\n\n    this.overlayListPort?.postMessage({\n      command: \"updateIframePosition\",\n      styles: this.getOverlayListPosition(),\n    });\n  }\n\n  /**\n   * Gets the position of the focused field and calculates the position\n   * of the overlay button based on the focused field's position and dimensions.\n   */\n  private getOverlayButtonPosition() {\n    if (!this.focusedFieldData) {\n      return;\n    }\n\n    const { top, left, width, height } = this.focusedFieldData.focusedFieldRects;\n    const { paddingRight, paddingLeft } = this.focusedFieldData.focusedFieldStyles;\n    let elementOffset = height * 0.37;\n    if (height >= 35) {\n      elementOffset = height >= 50 ? height * 0.47 : height * 0.42;\n    }\n\n    const elementHeight = height - elementOffset;\n    const elementTopPosition = top + elementOffset / 2;\n    let elementLeftPosition = left + width - height + elementOffset / 2;\n\n    const fieldPaddingRight = parseInt(paddingRight, 10);\n    const fieldPaddingLeft = parseInt(paddingLeft, 10);\n    if (fieldPaddingRight > fieldPaddingLeft) {\n      elementLeftPosition = left + width - height - (fieldPaddingRight - elementOffset + 2);\n    }\n\n    return {\n      top: `${Math.round(elementTopPosition)}px`,\n      left: `${Math.round(elementLeftPosition)}px`,\n      height: `${Math.round(elementHeight)}px`,\n      width: `${Math.round(elementHeight)}px`,\n    };\n  }\n\n  /**\n   * Gets the position of the focused field and calculates the position\n   * of the overlay list based on the focused field's position and dimensions.\n   */\n  private getOverlayListPosition() {\n    if (!this.focusedFieldData) {\n      return;\n    }\n\n    const { top, left, width, height } = this.focusedFieldData.focusedFieldRects;\n    return {\n      width: `${Math.round(width)}px`,\n      top: `${Math.round(top + height)}px`,\n      left: `${Math.round(left)}px`,\n    };\n  }\n\n  /**\n   * Sets the focused field data to the data passed in the extension message.\n   *\n   * @param focusedFieldData - Contains the rects and styles of the focused field.\n   * @param sender - The sender of the extension message\n   */\n  private setFocusedFieldData(\n    { focusedFieldData }: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    this.focusedFieldData = { ...focusedFieldData, tabId: sender.tab.id };\n  }\n\n  /**\n   * Updates the overlay's visibility based on the display property passed in the extension message.\n   *\n   * @param display - The display property of the overlay, either \"block\" or \"none\"\n   */\n  private updateOverlayHidden({ display }: OverlayBackgroundExtensionMessage) {\n    if (!display) {\n      return;\n    }\n\n    const portMessage = { command: \"updateOverlayHidden\", styles: { display } };\n\n    this.overlayButtonPort?.postMessage(portMessage);\n    this.overlayListPort?.postMessage(portMessage);\n  }\n\n  /**\n   * Sends a message to the currently active tab to open the autofill overlay.\n   *\n   * @param isFocusingFieldElement - Identifies whether the field element should be focused when the overlay is opened\n   * @param isOpeningFullOverlay - Identifies whether the full overlay should be forced open regardless of other states\n   */\n  private async openOverlay(isFocusingFieldElement = false, isOpeningFullOverlay = false) {\n    const currentTab = await BrowserApi.getTabFromCurrentWindowId();\n\n    await BrowserApi.tabSendMessageData(currentTab, \"openAutofillOverlay\", {\n      isFocusingFieldElement,\n      isOpeningFullOverlay,\n      authStatus: await this.getAuthStatus(),\n    });\n  }\n\n  /**\n   * Gets the overlay's visibility setting from the settings service.\n   */\n  private async getOverlayVisibility(): Promise<InlineMenuVisibilitySetting> {\n    return await firstValueFrom(this.autofillSettingsService.inlineMenuVisibility$);\n  }\n\n  /**\n   * Gets the user's authentication status from the auth service. If the user's\n   * authentication status has changed, the overlay button's authentication status\n   * will be updated and the overlay list's ciphers will be updated.\n   */\n  private async getAuthStatus() {\n    const formerAuthStatus = this.userAuthStatus;\n    this.userAuthStatus = await this.authService.getAuthStatus();\n\n    if (\n      this.userAuthStatus !== formerAuthStatus &&\n      this.userAuthStatus === AuthenticationStatus.Unlocked\n    ) {\n      this.updateOverlayButtonAuthStatus();\n      await this.updateOverlayCiphers();\n    }\n\n    return this.userAuthStatus;\n  }\n\n  /**\n   * Sends a message to the overlay button to update its authentication status.\n   */\n  private updateOverlayButtonAuthStatus() {\n    this.overlayButtonPort?.postMessage({\n      command: \"updateOverlayButtonAuthStatus\",\n      authStatus: this.userAuthStatus,\n    });\n  }\n\n  /**\n   * Handles the overlay button being clicked. If the user is not authenticated,\n   * the vault will be unlocked. If the user is authenticated, the overlay will\n   * be opened.\n   *\n   * @param port - The port of the overlay button\n   */\n  private handleOverlayButtonClicked(port: chrome.runtime.Port) {\n    if (this.userAuthStatus !== AuthenticationStatus.Unlocked) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.unlockVault(port);\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.openOverlay(false, true);\n  }\n\n  /**\n   * Facilitates opening the unlock popout window.\n   *\n   * @param port - The port of the overlay list\n   */\n  private async unlockVault(port: chrome.runtime.Port) {\n    const { sender } = port;\n\n    this.closeOverlay(port);\n    const retryMessage: LockedVaultPendingNotificationsData = {\n      commandToRetry: { message: { command: \"openAutofillOverlay\" }, sender },\n      target: \"overlay.background\",\n    };\n    await BrowserApi.tabSendMessageData(\n      sender.tab,\n      \"addToLockedVaultPendingNotifications\",\n      retryMessage,\n    );\n    await this.openUnlockPopout(sender.tab, true);\n  }\n\n  /**\n   * Triggers the opening of a vault item popout window associated\n   * with the passed cipher ID.\n   * @param overlayCipherId - Cipher ID corresponding to the overlayLoginCiphers map. Does not correspond to the actual cipher's ID.\n   * @param sender - The sender of the port message\n   */\n  private async viewSelectedCipher(\n    { overlayCipherId }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    const cipher = this.overlayLoginCiphers.get(overlayCipherId);\n    if (!cipher) {\n      return;\n    }\n\n    await this.openViewVaultItemPopout(sender.tab, {\n      cipherId: cipher.id,\n      action: SHOW_AUTOFILL_BUTTON,\n    });\n  }\n\n  /**\n   * Facilitates redirecting focus to the overlay list.\n   */\n  private focusOverlayList() {\n    this.overlayListPort?.postMessage({ command: \"focusOverlayList\" });\n  }\n\n  /**\n   * Updates the authentication status for the user and opens the overlay if\n   * a followup command is present in the message.\n   *\n   * @param message - Extension message received from the `unlockCompleted` command\n   */\n  private async unlockCompleted(message: OverlayBackgroundExtensionMessage) {\n    await this.getAuthStatus();\n\n    if (message.data?.commandToRetry?.message?.command === \"openAutofillOverlay\") {\n      await this.openOverlay(true);\n    }\n  }\n\n  /**\n   * Gets the translations for the overlay page.\n   */\n  private getTranslations() {\n    if (!this.overlayPageTranslations) {\n      this.overlayPageTranslations = {\n        locale: BrowserApi.getUILanguage(),\n        opensInANewWindow: this.i18nService.translate(\"opensInANewWindow\"),\n        buttonPageTitle: this.i18nService.translate(\"bitwardenOverlayButton\"),\n        toggleBitwardenVaultOverlay: this.i18nService.translate(\"toggleBitwardenVaultOverlay\"),\n        listPageTitle: this.i18nService.translate(\"bitwardenVault\"),\n        unlockYourAccount: this.i18nService.translate(\"unlockYourAccountToViewMatchingLogins\"),\n        unlockAccount: this.i18nService.translate(\"unlockAccount\"),\n        fillCredentialsFor: this.i18nService.translate(\"fillCredentialsFor\"),\n        partialUsername: this.i18nService.translate(\"partialUsername\"),\n        view: this.i18nService.translate(\"view\"),\n        noItemsToShow: this.i18nService.translate(\"noItemsToShow\"),\n        newItem: this.i18nService.translate(\"newItem\"),\n        addNewVaultItem: this.i18nService.translate(\"addNewVaultItem\"),\n      };\n    }\n\n    return this.overlayPageTranslations;\n  }\n\n  /**\n   * Facilitates redirecting focus out of one of the\n   *  overlay elements to elements on the page.\n   *\n   * @param direction - The direction to redirect focus to (either \"next\", \"previous\" or \"current)\n   * @param sender - The sender of the port message\n   */\n  private redirectOverlayFocusOut(\n    { direction }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    if (!direction) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessageData(sender.tab, \"redirectOverlayFocusOut\", { direction });\n  }\n\n  /**\n   * Triggers adding a new vault item from the overlay. Gathers data\n   * input by the user before calling to open the add/edit window.\n   *\n   * @param sender - The sender of the port message\n   */\n  private getNewVaultItemDetails({ sender }: chrome.runtime.Port) {\n    void BrowserApi.tabSendMessage(sender.tab, { command: \"addNewVaultItemFromOverlay\" });\n  }\n\n  /**\n   * Handles adding a new vault item from the overlay. Gathers data login\n   * data captured in the extension message.\n   *\n   * @param login - The login data captured from the extension message\n   * @param sender - The sender of the extension message\n   */\n  private async addNewVaultItem(\n    { login }: OverlayAddNewItemMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (!login) {\n      return;\n    }\n\n    const uriView = new LoginUriView();\n    uriView.uri = login.uri;\n\n    const loginView = new LoginView();\n    loginView.uris = [uriView];\n    loginView.username = login.username || \"\";\n    loginView.password = login.password || \"\";\n\n    const cipherView = new CipherView();\n    cipherView.name = (Utils.getHostname(login.uri) || login.hostname).replace(/^www\\./, \"\");\n    cipherView.folderId = null;\n    cipherView.type = CipherType.Login;\n    cipherView.login = loginView;\n\n    await this.cipherService.setAddEditCipherInfo({\n      cipher: cipherView,\n      collectionIds: cipherView.collectionIds,\n    });\n\n    await this.openAddEditVaultItemPopout(sender.tab, { cipherId: cipherView.id });\n    await BrowserApi.sendMessage(\"inlineAutofillMenuRefreshAddEditCipher\");\n  }\n\n  /**\n   * Sets up the extension message listeners for the overlay.\n   */\n  private setupExtensionMessageListeners() {\n    BrowserApi.messageListener(\"overlay.background\", this.handleExtensionMessage);\n    BrowserApi.addListener(chrome.runtime.onConnect, this.handlePortOnConnect);\n  }\n\n  /**\n   * Handles extension messages sent to the extension background.\n   *\n   * @param message - The message received from the extension\n   * @param sender - The sender of the message\n   * @param sendResponse - The response to send back to the sender\n   */\n  private handleExtensionMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n    sendResponse: (response?: any) => void,\n  ) => {\n    const handler: CallableFunction | undefined = this.extensionMessageHandlers[message?.command];\n    if (!handler) {\n      return;\n    }\n\n    const messageResponse = handler({ message, sender });\n    if (!messageResponse) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.resolve(messageResponse).then((response) => sendResponse(response));\n    return true;\n  };\n\n  /**\n   * Handles the connection of a port to the extension background.\n   *\n   * @param port - The port that connected to the extension background\n   */\n  private handlePortOnConnect = async (port: chrome.runtime.Port) => {\n    const isOverlayListPort = port.name === AutofillOverlayPort.List;\n    const isOverlayButtonPort = port.name === AutofillOverlayPort.Button;\n    if (!isOverlayListPort && !isOverlayButtonPort) {\n      return;\n    }\n\n    this.storeOverlayPort(port);\n    port.onMessage.addListener(this.handleOverlayElementPortMessage);\n    port.postMessage({\n      command: `initAutofillOverlay${isOverlayListPort ? \"List\" : \"Button\"}`,\n      authStatus: await this.getAuthStatus(),\n      styleSheetUrl: chrome.runtime.getURL(`overlay/${isOverlayListPort ? \"list\" : \"button\"}.css`),\n      theme: await firstValueFrom(this.themeStateService.selectedTheme$),\n      translations: this.getTranslations(),\n      ciphers: isOverlayListPort ? await this.getOverlayCipherData() : null,\n    });\n    this.updateOverlayPosition(\n      {\n        overlayElement: isOverlayListPort\n          ? AutofillOverlayElement.List\n          : AutofillOverlayElement.Button,\n      },\n      port.sender,\n    );\n  };\n\n  /**\n   * Stores the connected overlay port and sets up any existing ports to be disconnected.\n   *\n   * @param port - The port to store\n|   */\n  private storeOverlayPort(port: chrome.runtime.Port) {\n    if (port.name === AutofillOverlayPort.List) {\n      this.storeExpiredOverlayPort(this.overlayListPort);\n      this.overlayListPort = port;\n      return;\n    }\n\n    if (port.name === AutofillOverlayPort.Button) {\n      this.storeExpiredOverlayPort(this.overlayButtonPort);\n      this.overlayButtonPort = port;\n    }\n  }\n\n  /**\n   * When registering a new connection, we want to ensure that the port is disconnected.\n   * This method places an existing port in the expiredPorts array to be disconnected\n   * at a later time.\n   *\n   * @param port - The port to store in the expiredPorts array\n   */\n  private storeExpiredOverlayPort(port: chrome.runtime.Port | null) {\n    if (port) {\n      this.expiredPorts.push(port);\n    }\n  }\n\n  /**\n   * Handles messages sent to the overlay list or button ports.\n   *\n   * @param message - The message received from the port\n   * @param port - The port that sent the message\n   */\n  private handleOverlayElementPortMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    port: chrome.runtime.Port,\n  ) => {\n    const command = message?.command;\n    let handler: CallableFunction | undefined;\n\n    if (port.name === AutofillOverlayPort.Button) {\n      handler = this.overlayButtonPortMessageHandlers[command];\n    }\n\n    if (port.name === AutofillOverlayPort.List) {\n      handler = this.overlayListPortMessageHandlers[command];\n    }\n\n    if (!handler) {\n      return;\n    }\n\n    handler({ message, port });\n  };\n}\n\nexport default OverlayBackground;\n","import MainBackground from \"../../background/main.background\";\n\nimport NotificationBackground from \"./notification.background\";\nimport OverlayBackground from \"./overlay.background\";\n\nexport default class TabsBackground {\n  constructor(\n    private main: MainBackground,\n    private notificationBackground: NotificationBackground,\n    private overlayBackground: OverlayBackground,\n  ) {}\n\n  private focusedWindowId: number;\n\n  /**\n   * Initializes the window and tab listeners.\n   */\n  async init() {\n    if (!chrome.tabs || !chrome.windows) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.updateCurrentTabData();\n    this.setupTabEventListeners();\n  }\n\n  /**\n   * Sets up the tab and window event listeners.\n   */\n  private setupTabEventListeners() {\n    chrome.windows.onFocusChanged.addListener(this.handleWindowOnFocusChanged);\n    chrome.tabs.onActivated.addListener(this.handleTabOnActivated);\n    chrome.tabs.onReplaced.addListener(this.handleTabOnReplaced);\n    chrome.tabs.onUpdated.addListener(this.handleTabOnUpdated);\n    chrome.tabs.onRemoved.addListener(this.handleTabOnRemoved);\n  }\n\n  /**\n   * Handles the window onFocusChanged event.\n   *\n   * @param windowId - The ID of the window that was focused.\n   */\n  private handleWindowOnFocusChanged = async (windowId: number) => {\n    if (windowId == null || windowId < 0) {\n      return;\n    }\n\n    this.focusedWindowId = windowId;\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"windowChanged\");\n  };\n\n  /**\n   * Handles the tab onActivated event.\n   */\n  private handleTabOnActivated = async () => {\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onReplaced event.\n   */\n  private handleTabOnReplaced = async () => {\n    if (this.main.onReplacedRan) {\n      return;\n    }\n    this.main.onReplacedRan = true;\n\n    await this.notificationBackground.checkNotificationQueue();\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onUpdated event.\n   *\n   * @param tabId - The ID of the tab that was updated.\n   * @param changeInfo - The change information.\n   * @param tab - The updated tab.\n   */\n  private handleTabOnUpdated = async (\n    tabId: number,\n    changeInfo: chrome.tabs.TabChangeInfo,\n    tab: chrome.tabs.Tab,\n  ) => {\n    const removePageDetailsStatus = new Set([\"loading\", \"unloaded\"]);\n    if (removePageDetailsStatus.has(changeInfo.status)) {\n      this.overlayBackground.removePageDetails(tabId);\n    }\n\n    if (this.focusedWindowId > 0 && tab.windowId !== this.focusedWindowId) {\n      return;\n    }\n\n    if (!tab.active) {\n      return;\n    }\n\n    await this.overlayBackground.updateOverlayCiphers();\n\n    if (this.main.onUpdatedRan) {\n      return;\n    }\n    this.main.onUpdatedRan = true;\n\n    await this.notificationBackground.checkNotificationQueue(tab);\n    await this.main.refreshBadge();\n    await this.main.refreshMenu();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onRemoved event.\n   *\n   * @param tabId - The ID of the tab that was removed.\n   */\n  private handleTabOnRemoved = async (tabId: number) => {\n    this.overlayBackground.removePageDetails(tabId);\n  };\n\n  /**\n   * Updates the current tab data, refreshing the badge and context menu\n   * for the current tab. Also updates the overlay ciphers.\n   */\n  private updateCurrentTabData = async () => {\n    await Promise.all([\n      this.main.refreshBadge(),\n      this.main.refreshMenu(),\n      this.overlayBackground.updateOverlayCiphers(),\n    ]);\n  };\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { UriMatchStrategy } from \"@bitwarden/common/models/domain/domain-service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\n\nexport default class WebRequestBackground {\n  private pendingAuthRequests: Set<string> = new Set<string>([]);\n  private isFirefox: boolean;\n\n  constructor(\n    platformUtilsService: PlatformUtilsService,\n    private cipherService: CipherService,\n    private authService: AuthService,\n    private readonly webRequest: typeof chrome.webRequest,\n  ) {\n    this.isFirefox = platformUtilsService.isFirefox();\n  }\n\n  startListening() {\n    this.webRequest.onAuthRequired.addListener(\n      async (details, callback) => {\n        if (!details.url || this.pendingAuthRequests.has(details.requestId)) {\n          if (callback) {\n            callback(null);\n          }\n          return;\n        }\n        this.pendingAuthRequests.add(details.requestId);\n        if (this.isFirefox) {\n          // eslint-disable-next-line\n          return new Promise(async (resolve, reject) => {\n            await this.resolveAuthCredentials(details.url, resolve, reject);\n          });\n        } else {\n          await this.resolveAuthCredentials(details.url, callback, callback);\n        }\n      },\n      { urls: [\"http://*/*\", \"https://*/*\"] },\n      [this.isFirefox ? \"blocking\" : \"asyncBlocking\"],\n    );\n\n    this.webRequest.onCompleted.addListener((details) => this.completeAuthRequest(details), {\n      urls: [\"http://*/*\"],\n    });\n    this.webRequest.onErrorOccurred.addListener(\n      (details: any) => this.completeAuthRequest(details),\n      {\n        urls: [\"http://*/*\"],\n      },\n    );\n  }\n\n  // eslint-disable-next-line\n  private async resolveAuthCredentials(domain: string, success: Function, error: Function) {\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      error();\n      return;\n    }\n\n    try {\n      const ciphers = await this.cipherService.getAllDecryptedForUrl(\n        domain,\n        null,\n        UriMatchStrategy.Host,\n      );\n      if (ciphers == null || ciphers.length !== 1) {\n        error();\n        return;\n      }\n\n      success({\n        authCredentials: {\n          username: ciphers[0].login.username,\n          password: ciphers[0].login.password,\n        },\n      });\n    } catch {\n      error();\n    }\n  }\n\n  private completeAuthRequest(details: chrome.webRequest.WebResponseCacheDetails) {\n    this.pendingAuthRequests.delete(details.requestId);\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport {\n  AUTOFILL_CARD_ID,\n  AUTOFILL_ID,\n  AUTOFILL_IDENTITY_ID,\n  COPY_IDENTIFIER_ID,\n  COPY_PASSWORD_ID,\n  COPY_USERNAME_ID,\n  COPY_VERIFICATION_CODE_ID,\n  CREATE_CARD_ID,\n  CREATE_IDENTITY_ID,\n  CREATE_LOGIN_ID,\n  GENERATE_PASSWORD_ID,\n  NOOP_COMMAND_SUFFIX,\n  ROOT_ID,\n  SEPARATOR_ID,\n} from \"@bitwarden/common/autofill/constants\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { BillingAccountProfileStateService } from \"@bitwarden/common/billing/abstractions/account/billing-account-profile-state.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\n\nimport { InitContextMenuItems } from \"./abstractions/main-context-menu-handler\";\n\nexport class MainContextMenuHandler {\n  initRunning = false;\n  private initContextMenuItems: InitContextMenuItems[] = [\n    {\n      id: ROOT_ID,\n      title: \"Bitwarden\",\n    },\n    {\n      id: AUTOFILL_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillLogin\"),\n    },\n    {\n      id: COPY_USERNAME_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyUsername\"),\n    },\n    {\n      id: COPY_PASSWORD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyPassword\"),\n    },\n    {\n      id: COPY_VERIFICATION_CODE_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyVerificationCode\"),\n      checkPremiumAccess: true,\n    },\n    {\n      id: SEPARATOR_ID + 1,\n      type: \"separator\",\n      parentId: ROOT_ID,\n    },\n    {\n      id: AUTOFILL_IDENTITY_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillIdentity\"),\n    },\n    {\n      id: AUTOFILL_CARD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillCard\"),\n    },\n    {\n      id: SEPARATOR_ID + 2,\n      type: \"separator\",\n      parentId: ROOT_ID,\n    },\n    {\n      id: GENERATE_PASSWORD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"generatePasswordCopied\"),\n    },\n    {\n      id: COPY_IDENTIFIER_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyElementIdentifier\"),\n    },\n  ];\n  private noCardsContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_CARD_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_CARD_ID,\n      title: this.i18nService.t(\"noCards\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_CARD_ID}_${SEPARATOR_ID}`,\n      parentId: AUTOFILL_CARD_ID,\n      type: \"separator\",\n    },\n    {\n      id: `${AUTOFILL_CARD_ID}_${CREATE_CARD_ID}`,\n      parentId: AUTOFILL_CARD_ID,\n      title: this.i18nService.t(\"addCardMenu\"),\n      type: \"normal\",\n    },\n  ];\n  private noIdentitiesContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_IDENTITY_ID,\n      title: this.i18nService.t(\"noIdentities\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_${SEPARATOR_ID}`,\n      parentId: AUTOFILL_IDENTITY_ID,\n      type: \"separator\",\n    },\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_${CREATE_IDENTITY_ID}`,\n      parentId: AUTOFILL_IDENTITY_ID,\n      title: this.i18nService.t(\"addIdentityMenu\"),\n      type: \"normal\",\n    },\n  ];\n  private noLoginsContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_ID,\n      title: this.i18nService.t(\"noMatchingLogins\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_ID}_${SEPARATOR_ID}1`,\n      parentId: AUTOFILL_ID,\n      type: \"separator\",\n    },\n  ];\n\n  constructor(\n    private stateService: BrowserStateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private i18nService: I18nService,\n    private logService: LogService,\n    private billingAccountProfileStateService: BillingAccountProfileStateService,\n  ) {}\n\n  /**\n   *\n   * @returns a boolean showing whether or not items were created\n   */\n  async init(): Promise<boolean> {\n    const menuEnabled = await firstValueFrom(this.autofillSettingsService.enableContextMenu$);\n    if (!menuEnabled) {\n      await MainContextMenuHandler.removeAll();\n      return false;\n    }\n\n    if (this.initRunning) {\n      return true;\n    }\n    this.initRunning = true;\n\n    try {\n      for (const options of this.initContextMenuItems) {\n        if (\n          options.checkPremiumAccess &&\n          !(await firstValueFrom(this.billingAccountProfileStateService.hasPremiumFromAnySource$))\n        ) {\n          continue;\n        }\n\n        delete options.checkPremiumAccess;\n        await MainContextMenuHandler.create({ ...options, contexts: [\"all\"] });\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    } finally {\n      this.initRunning = false;\n    }\n    return true;\n  }\n\n  /**\n   * Creates a context menu item\n   *\n   * @param options - the options for the context menu item\n   */\n  private static create = async (options: chrome.contextMenus.CreateProperties) => {\n    if (!chrome.contextMenus) {\n      return;\n    }\n\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.create(options, () => {\n        if (chrome.runtime.lastError) {\n          return reject(chrome.runtime.lastError);\n        }\n        resolve();\n      });\n    });\n  };\n\n  static async removeAll() {\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.removeAll(() => {\n        if (chrome.runtime.lastError) {\n          reject(chrome.runtime.lastError);\n          return;\n        }\n\n        resolve();\n      });\n    });\n  }\n\n  static remove(menuItemId: string) {\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.remove(menuItemId, () => {\n        if (chrome.runtime.lastError) {\n          reject(chrome.runtime.lastError);\n          return;\n        }\n\n        resolve();\n      });\n    });\n  }\n\n  async loadOptions(title: string, optionId: string, cipher?: CipherView) {\n    try {\n      const sanitizedTitle = MainContextMenuHandler.sanitizeContextMenuTitle(title);\n\n      const createChildItem = async (parentId: string) => {\n        const menuItemId = `${parentId}_${optionId}`;\n\n        return await MainContextMenuHandler.create({\n          type: \"normal\",\n          id: menuItemId,\n          parentId,\n          title: sanitizedTitle,\n          contexts: [\"all\"],\n        });\n      };\n\n      if (\n        !cipher ||\n        (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(cipher.login?.password))\n      ) {\n        await createChildItem(AUTOFILL_ID);\n\n        if (cipher?.viewPassword ?? true) {\n          await createChildItem(COPY_PASSWORD_ID);\n        }\n      }\n\n      if (\n        !cipher ||\n        (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(cipher.login?.username))\n      ) {\n        await createChildItem(COPY_USERNAME_ID);\n      }\n\n      const canAccessPremium = await firstValueFrom(\n        this.billingAccountProfileStateService.hasPremiumFromAnySource$,\n      );\n      if (canAccessPremium && (!cipher || !Utils.isNullOrEmpty(cipher.login?.totp))) {\n        await createChildItem(COPY_VERIFICATION_CODE_ID);\n      }\n\n      if ((!cipher || cipher.type === CipherType.Card) && optionId !== CREATE_LOGIN_ID) {\n        await createChildItem(AUTOFILL_CARD_ID);\n      }\n\n      if ((!cipher || cipher.type === CipherType.Identity) && optionId !== CREATE_LOGIN_ID) {\n        await createChildItem(AUTOFILL_IDENTITY_ID);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  static sanitizeContextMenuTitle(title: string): string {\n    return title.replace(/&/g, \"&&\");\n  }\n\n  async noAccess() {\n    if (await this.init()) {\n      const authed = await this.stateService.getIsAuthenticated();\n      this.loadOptions(\n        this.i18nService.t(authed ? \"unlockVaultMenu\" : \"loginToVaultMenu\"),\n        NOOP_COMMAND_SUFFIX,\n      ).catch((error) => this.logService.warning(error.message));\n    }\n  }\n\n  async noCards() {\n    try {\n      for (const option of this.noCardsContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  async noIdentities() {\n    try {\n      for (const option of this.noIdentitiesContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  async noLogins() {\n    try {\n      for (const option of this.noLoginsContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n\n      await this.loadOptions(this.i18nService.t(\"addLoginMenu\"), CREATE_LOGIN_ID);\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { AutofillCipherTypeId } from \"../types\";\n\nimport { MainContextMenuHandler } from \"./main-context-menu-handler\";\n\nexport class CipherContextMenuHandler {\n  constructor(\n    private mainContextMenuHandler: MainContextMenuHandler,\n    private authService: AuthService,\n    private cipherService: CipherService,\n  ) {}\n\n  async update(url: string) {\n    if (this.mainContextMenuHandler.initRunning) {\n      return;\n    }\n\n    const authStatus = await this.authService.getAuthStatus();\n    await MainContextMenuHandler.removeAll();\n    if (authStatus !== AuthenticationStatus.Unlocked) {\n      // Should I pass in the auth status or even have two separate methods for this\n      // on MainContextMenuHandler\n      await this.mainContextMenuHandler.noAccess();\n      return;\n    }\n\n    const menuEnabled = await this.mainContextMenuHandler.init();\n    if (!menuEnabled) {\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(url, [\n      CipherType.Card,\n      CipherType.Identity,\n    ]);\n    ciphers.sort((a, b) => this.cipherService.sortCiphersByLastUsedThenName(a, b));\n\n    const groupedCiphers: Record<AutofillCipherTypeId, CipherView[]> = ciphers.reduce(\n      (ciphersByType, cipher) => {\n        if (!cipher?.type) {\n          return ciphersByType;\n        }\n\n        const existingCiphersOfType = ciphersByType[cipher.type as AutofillCipherTypeId] || [];\n\n        return {\n          ...ciphersByType,\n          [cipher.type]: [...existingCiphersOfType, cipher],\n        };\n      },\n      {\n        [CipherType.Login]: [],\n        [CipherType.Card]: [],\n        [CipherType.Identity]: [],\n      },\n    );\n\n    if (groupedCiphers[CipherType.Login].length === 0) {\n      await this.mainContextMenuHandler.noLogins();\n    }\n\n    if (groupedCiphers[CipherType.Identity].length === 0) {\n      await this.mainContextMenuHandler.noIdentities();\n    }\n\n    if (groupedCiphers[CipherType.Card].length === 0) {\n      await this.mainContextMenuHandler.noCards();\n    }\n\n    for (const cipher of ciphers) {\n      await this.updateForCipher(cipher);\n    }\n  }\n\n  private async updateForCipher(cipher: CipherView) {\n    if (\n      cipher == null ||\n      !new Set([CipherType.Login, CipherType.Card, CipherType.Identity]).has(cipher.type)\n    ) {\n      return;\n    }\n\n    let title = cipher.name;\n\n    if (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(title) && cipher.login?.username) {\n      title += ` (${cipher.login.username})`;\n    }\n\n    if (cipher.type === CipherType.Card && cipher.card?.subTitle) {\n      title += ` ${cipher.card.subTitle}`;\n    }\n\n    await this.mainContextMenuHandler.loadOptions(title, cipher.id, cipher);\n  }\n}\n","import { firstValueFrom, map } from \"rxjs\";\n\nimport { EventCollectionService } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport {\n  AUTOFILL_CARD_ID,\n  AUTOFILL_ID,\n  AUTOFILL_IDENTITY_ID,\n  COPY_IDENTIFIER_ID,\n  COPY_PASSWORD_ID,\n  COPY_USERNAME_ID,\n  COPY_VERIFICATION_CODE_ID,\n  CREATE_CARD_ID,\n  CREATE_IDENTITY_ID,\n  CREATE_LOGIN_ID,\n  GENERATE_PASSWORD_ID,\n  NOOP_COMMAND_SUFFIX,\n} from \"@bitwarden/common/autofill/constants\";\nimport { EventType } from \"@bitwarden/common/enums\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { TotpService } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport {\n  openAddEditVaultItemPopout,\n  openVaultItemPasswordRepromptPopout,\n} from \"../../vault/popup/utils/vault-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../background/abstractions/notification.background\";\nimport { AutofillCipherTypeId } from \"../types\";\n\nexport type CopyToClipboardOptions = { text: string; tab: chrome.tabs.Tab };\nexport type CopyToClipboardAction = (options: CopyToClipboardOptions) => void;\nexport type AutofillAction = (tab: chrome.tabs.Tab, cipher: CipherView) => Promise<void>;\n\nexport type GeneratePasswordToClipboardAction = (tab: chrome.tabs.Tab) => Promise<void>;\n\nexport class ContextMenuClickedHandler {\n  constructor(\n    private copyToClipboard: CopyToClipboardAction,\n    private generatePasswordToClipboard: GeneratePasswordToClipboardAction,\n    private autofillAction: AutofillAction,\n    private authService: AuthService,\n    private cipherService: CipherService,\n    private totpService: TotpService,\n    private eventCollectionService: EventCollectionService,\n    private userVerificationService: UserVerificationService,\n    private accountService: AccountService,\n  ) {}\n\n  async run(info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) {\n    if (!tab) {\n      return;\n    }\n\n    switch (info.menuItemId) {\n      case GENERATE_PASSWORD_ID:\n        await this.generatePasswordToClipboard(tab);\n        break;\n      case COPY_IDENTIFIER_ID:\n        this.copyToClipboard({ text: await this.getIdentifier(tab, info), tab: tab });\n        break;\n      default:\n        await this.cipherAction(info, tab);\n    }\n  }\n\n  async cipherAction(info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) {\n    if (!tab) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      const retryMessage: LockedVaultPendingNotificationsData = {\n        commandToRetry: {\n          message: { command: NOOP_COMMAND_SUFFIX, contextMenuOnClickData: info },\n          sender: { tab: tab },\n        },\n        target: \"contextmenus.background\",\n      };\n      await BrowserApi.tabSendMessageData(\n        tab,\n        \"addToLockedVaultPendingNotifications\",\n        retryMessage,\n      );\n\n      await openUnlockPopout(tab);\n      return;\n    }\n\n    // NOTE: We don't actually use the first part of this ID, we further switch based on the parentMenuItemId\n    // I would really love to not add it but that is a departure from how it currently works.\n    const menuItemId = (info.menuItemId as string).split(\"_\")[1]; // We create all the ids, we can guarantee they are strings\n    let cipher: CipherView | undefined;\n    const isCreateCipherAction = [CREATE_LOGIN_ID, CREATE_IDENTITY_ID, CREATE_CARD_ID].includes(\n      menuItemId as string,\n    );\n\n    if (isCreateCipherAction) {\n      // pass; defer to logic below\n    } else if (menuItemId === NOOP_COMMAND_SUFFIX) {\n      const additionalCiphersToGet =\n        info.parentMenuItemId === AUTOFILL_IDENTITY_ID\n          ? [CipherType.Identity]\n          : info.parentMenuItemId === AUTOFILL_CARD_ID\n            ? [CipherType.Card]\n            : [];\n\n      // This NOOP item has come through which is generally only for no access state but since we got here\n      // we are actually unlocked we will do our best to find a good match of an item to autofill this is useful\n      // in scenarios like unlock on autofill\n      const ciphers = await this.cipherService.getAllDecryptedForUrl(\n        tab.url,\n        additionalCiphersToGet,\n      );\n\n      cipher = ciphers[0];\n    } else {\n      const ciphers = await this.cipherService.getAllDecrypted();\n      cipher = ciphers.find(({ id }) => id === menuItemId);\n    }\n\n    if (!cipher && !isCreateCipherAction) {\n      return;\n    }\n\n    const activeUserId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((a) => a?.id)),\n    );\n    await this.accountService.setAccountActivity(activeUserId, new Date());\n    switch (info.parentMenuItemId) {\n      case AUTOFILL_ID:\n      case AUTOFILL_IDENTITY_ID:\n      case AUTOFILL_CARD_ID: {\n        const cipherType = this.getCipherCreationType(menuItemId);\n\n        if (cipherType) {\n          await openAddEditVaultItemPopout(tab, { cipherType });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            // The action here is passed on to the single-use reprompt window and doesn't change based on cipher type\n            action: AUTOFILL_ID,\n          });\n        } else {\n          await this.autofillAction(tab, cipher);\n        }\n\n        break;\n      }\n      case COPY_USERNAME_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        this.copyToClipboard({ text: cipher.login.username, tab: tab });\n        break;\n      case COPY_PASSWORD_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            action: COPY_PASSWORD_ID,\n          });\n        } else {\n          this.copyToClipboard({ text: cipher.login.password, tab: tab });\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.eventCollectionService.collect(EventType.Cipher_ClientCopiedPassword, cipher.id);\n        }\n\n        break;\n      case COPY_VERIFICATION_CODE_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            action: COPY_VERIFICATION_CODE_ID,\n          });\n        } else {\n          this.copyToClipboard({\n            text: await this.totpService.getCode(cipher.login.totp),\n            tab: tab,\n          });\n        }\n\n        break;\n    }\n  }\n\n  private async isPasswordRepromptRequired(cipher: CipherView): Promise<boolean> {\n    return (\n      cipher.reprompt === CipherRepromptType.Password &&\n      (await this.userVerificationService.hasMasterPasswordAndMasterKeyHash())\n    );\n  }\n\n  private getCipherCreationType(menuItemId?: string): AutofillCipherTypeId | null {\n    return menuItemId === CREATE_IDENTITY_ID\n      ? CipherType.Identity\n      : menuItemId === CREATE_CARD_ID\n        ? CipherType.Card\n        : menuItemId === CREATE_LOGIN_ID\n          ? CipherType.Login\n          : null;\n  }\n\n  private async getIdentifier(tab: chrome.tabs.Tab, info: chrome.contextMenus.OnClickData) {\n    return new Promise<string>((resolve, reject) => {\n      BrowserApi.sendTabsMessage(\n        tab.id,\n        { command: \"getClickedElement\" },\n        { frameId: info.frameId },\n        (identifier: string) => {\n          if (chrome.runtime.lastError) {\n            reject(chrome.runtime.lastError);\n            return;\n          }\n\n          resolve(identifier);\n        },\n      );\n    });\n  }\n}\n","const AutofillPort = {\n  InjectedScript: \"autofill-injected-script-port\",\n} as const;\n\nexport { AutofillPort };\n","// String values affect code flow in autofill.ts and must not be changed\nexport type FillScriptActions = \"click_on_opid\" | \"focus_by_opid\" | \"fill_by_opid\";\n\nexport type FillScript = [action: FillScriptActions, opid: string, value?: string];\n\nexport type AutofillScriptProperties = {\n  delay_between_operations?: number;\n};\n\nexport type AutofillInsertActions = {\n  fill_by_opid: ({ opid, value }: { opid: string; value: string }) => void;\n  click_on_opid: ({ opid }: { opid: string }) => void;\n  focus_by_opid: ({ opid }: { opid: string }) => void;\n};\n\nexport default class AutofillScript {\n  script: FillScript[] = [];\n  properties: AutofillScriptProperties = {};\n  metadata: any = {}; // Unused, not written or read\n  autosubmit: any = null; // Appears to be unused, read but not written\n  savedUrls: string[];\n  untrustedIframe: boolean;\n  itemType: string; // Appears to be unused, read but not written\n}\n","export class AutoFillConstants {\n  static readonly UsernameFieldNames: string[] = [\n    // English\n    \"username\",\n    \"user name\",\n    \"email\",\n    \"email address\",\n    \"e-mail\",\n    \"e-mail address\",\n    \"userid\",\n    \"user id\",\n    \"customer id\",\n    \"login id\",\n    \"login\",\n    // German\n    \"benutzername\",\n    \"benutzer name\",\n    \"email adresse\",\n    \"e-mail adresse\",\n    \"benutzerid\",\n    \"benutzer id\",\n  ];\n\n  static readonly TotpFieldNames: string[] = [\n    \"totp\",\n    \"2fa\",\n    \"mfa\",\n    \"totpcode\",\n    \"2facode\",\n    \"approvals_code\",\n    \"code\",\n    \"mfacode\",\n    \"otc\",\n    \"otc-code\",\n    \"otp-code\",\n    \"otpcode\",\n    \"pin\",\n    \"security_code\",\n    \"twofactor\",\n    \"twofa\",\n    \"twofactorcode\",\n    \"verificationCode\",\n  ];\n\n  static readonly SearchFieldNames: string[] = [\"search\", \"query\", \"find\", \"go\"];\n\n  static readonly FieldIgnoreList: string[] = [\"captcha\", \"findanything\", \"forgot\"];\n\n  static readonly PasswordFieldExcludeList: string[] = [\n    ...AutoFillConstants.FieldIgnoreList,\n    \"onetimepassword\",\n  ];\n\n  static readonly ExcludedAutofillLoginTypes: string[] = [\n    \"hidden\",\n    \"file\",\n    \"button\",\n    \"image\",\n    \"reset\",\n    \"search\",\n  ];\n\n  static readonly ExcludedAutofillTypes: string[] = [\n    \"radio\",\n    \"checkbox\",\n    ...AutoFillConstants.ExcludedAutofillLoginTypes,\n  ];\n\n  static readonly ExcludedOverlayTypes: string[] = [\n    \"textarea\",\n    ...AutoFillConstants.ExcludedAutofillTypes,\n  ];\n}\n\nexport class CreditCardAutoFillConstants {\n  static readonly CardAttributes: string[] = [\n    \"autoCompleteType\",\n    \"data-stripe\",\n    \"htmlName\",\n    \"htmlID\",\n    \"label-tag\",\n    \"placeholder\",\n    \"label-left\",\n    \"label-top\",\n    \"data-recurly\",\n  ];\n\n  static readonly CardAttributesExtended: string[] = [\n    ...CreditCardAutoFillConstants.CardAttributes,\n    \"label-right\",\n  ];\n\n  static readonly CardHolderFieldNames: string[] = [\n    \"cc-name\",\n    \"card-name\",\n    \"cardholder-name\",\n    \"cardholder\",\n    \"name\",\n    \"nom\",\n  ];\n\n  static readonly CardHolderFieldNameValues: string[] = [\n    \"cc-name\",\n    \"card-name\",\n    \"cardholder-name\",\n    \"cardholder\",\n    \"tbName\",\n  ];\n\n  static readonly CardNumberFieldNames: string[] = [\n    \"cc-number\",\n    \"cc-num\",\n    \"card-number\",\n    \"card-num\",\n    \"number\",\n    \"cc\",\n    \"cc-no\",\n    \"card-no\",\n    \"credit-card\",\n    \"numero-carte\",\n    \"carte\",\n    \"carte-credit\",\n    \"num-carte\",\n    \"cb-num\",\n    \"card-pan\",\n  ];\n\n  static readonly CardNumberFieldNameValues: string[] = [\n    \"cc-number\",\n    \"cc-num\",\n    \"card-number\",\n    \"card-num\",\n    \"cc-no\",\n    \"card-no\",\n    \"numero-carte\",\n    \"num-carte\",\n    \"cb-num\",\n  ];\n\n  static readonly CardExpiryFieldNames: string[] = [\n    \"cc-exp\",\n    \"card-exp\",\n    \"cc-expiration\",\n    \"card-expiration\",\n    \"cc-ex\",\n    \"card-ex\",\n    \"card-expire\",\n    \"card-expiry\",\n    \"validite\",\n    \"expiration\",\n    \"expiry\",\n    \"mm-yy\",\n    \"mm-yyyy\",\n    \"yy-mm\",\n    \"yyyy-mm\",\n    \"expiration-date\",\n    \"payment-card-expiration\",\n    \"payment-cc-date\",\n  ];\n\n  static readonly CardExpiryFieldNameValues: string[] = [\n    \"mm-yy\",\n    \"mm-yyyy\",\n    \"yy-mm\",\n    \"yyyy-mm\",\n    \"expiration-date\",\n    \"payment-card-expiration\",\n  ];\n\n  static readonly ExpiryMonthFieldNames: string[] = [\n    \"exp-month\",\n    \"cc-exp-month\",\n    \"cc-month\",\n    \"card-month\",\n    \"cc-mo\",\n    \"card-mo\",\n    \"exp-mo\",\n    \"card-exp-mo\",\n    \"cc-exp-mo\",\n    \"card-expiration-month\",\n    \"expiration-month\",\n    \"cc-mm\",\n    \"cc-m\",\n    \"card-mm\",\n    \"card-m\",\n    \"card-exp-mm\",\n    \"cc-exp-mm\",\n    \"exp-mm\",\n    \"exp-m\",\n    \"expire-month\",\n    \"expire-mo\",\n    \"expiry-month\",\n    \"expiry-mo\",\n    \"card-expire-month\",\n    \"card-expire-mo\",\n    \"card-expiry-month\",\n    \"card-expiry-mo\",\n    \"mois-validite\",\n    \"mois-expiration\",\n    \"m-validite\",\n    \"m-expiration\",\n    \"expiry-date-field-month\",\n    \"expiration-date-month\",\n    \"expiration-date-mm\",\n    \"exp-mon\",\n    \"validity-mo\",\n    \"exp-date-mo\",\n    \"cb-date-mois\",\n    \"date-m\",\n  ];\n\n  static readonly ExpiryYearFieldNames: string[] = [\n    \"exp-year\",\n    \"cc-exp-year\",\n    \"cc-year\",\n    \"card-year\",\n    \"cc-yr\",\n    \"card-yr\",\n    \"exp-yr\",\n    \"card-exp-yr\",\n    \"cc-exp-yr\",\n    \"card-expiration-year\",\n    \"expiration-year\",\n    \"cc-yy\",\n    \"cc-y\",\n    \"card-yy\",\n    \"card-y\",\n    \"card-exp-yy\",\n    \"cc-exp-yy\",\n    \"exp-yy\",\n    \"exp-y\",\n    \"cc-yyyy\",\n    \"card-yyyy\",\n    \"card-exp-yyyy\",\n    \"cc-exp-yyyy\",\n    \"expire-year\",\n    \"expire-yr\",\n    \"expiry-year\",\n    \"expiry-yr\",\n    \"card-expire-year\",\n    \"card-expire-yr\",\n    \"card-expiry-year\",\n    \"card-expiry-yr\",\n    \"an-validite\",\n    \"an-expiration\",\n    \"annee-validite\",\n    \"annee-expiration\",\n    \"expiry-date-field-year\",\n    \"expiration-date-year\",\n    \"cb-date-ann\",\n    \"expiration-date-yy\",\n    \"expiration-date-yyyy\",\n    \"validity-year\",\n    \"exp-date-year\",\n    \"date-y\",\n  ];\n\n  static readonly CVVFieldNames: string[] = [\n    \"cvv\",\n    \"cvc\",\n    \"cvv2\",\n    \"cc-csc\",\n    \"cc-cvv\",\n    \"card-csc\",\n    \"card-cvv\",\n    \"cvd\",\n    \"cid\",\n    \"cvc2\",\n    \"cnv\",\n    \"cvn2\",\n    \"cc-code\",\n    \"card-code\",\n    \"code-securite\",\n    \"security-code\",\n    \"crypto\",\n    \"card-verif\",\n    \"verification-code\",\n    \"csc\",\n    \"ccv\",\n  ];\n\n  static readonly CardBrandFieldNames: string[] = [\n    \"cc-type\",\n    \"card-type\",\n    \"card-brand\",\n    \"cc-brand\",\n    \"cb-type\",\n  ];\n\n  // Each index represents a language. These three arrays should all be the same length.\n  // 0: English, 1: Danish, 2: German/Dutch, 3: French/Spanish/Italian, 4: Russian, 5: Portuguese\n  static readonly MonthAbbr = [\"mm\", \"mm\", \"mm\", \"mm\", \"мм\", \"mm\"];\n  static readonly YearAbbrShort = [\"yy\", \"åå\", \"jj\", \"aa\", \"гг\", \"rr\"];\n  static readonly YearAbbrLong = [\"yyyy\", \"åååå\", \"jjjj\", \"aa\", \"гггг\", \"rrrr\"];\n}\n\nexport class IdentityAutoFillConstants {\n  static readonly IdentityAttributes: string[] = [\n    \"autoCompleteType\",\n    \"data-stripe\",\n    \"htmlName\",\n    \"htmlID\",\n    \"label-tag\",\n    \"placeholder\",\n    \"label-left\",\n    \"label-top\",\n    \"data-recurly\",\n  ];\n\n  static readonly FullNameFieldNames: string[] = [\"name\", \"full-name\", \"your-name\"];\n\n  static readonly FullNameFieldNameValues: string[] = [\"full-name\", \"your-name\"];\n\n  static readonly TitleFieldNames: string[] = [\n    \"honorific-prefix\",\n    \"prefix\",\n    \"title\",\n    // German\n    \"anrede\",\n  ];\n\n  static readonly FirstnameFieldNames: string[] = [\n    // English\n    \"f-name\",\n    \"first-name\",\n    \"given-name\",\n    \"first-n\",\n    // German\n    \"vorname\",\n  ];\n\n  static readonly MiddlenameFieldNames: string[] = [\n    \"m-name\",\n    \"middle-name\",\n    \"additional-name\",\n    \"middle-initial\",\n    \"middle-n\",\n    \"middle-i\",\n  ];\n\n  static readonly LastnameFieldNames: string[] = [\n    // English\n    \"l-name\",\n    \"last-name\",\n    \"s-name\",\n    \"surname\",\n    \"family-name\",\n    \"family-n\",\n    \"last-n\",\n    // German\n    \"nachname\",\n    \"familienname\",\n  ];\n\n  static readonly EmailFieldNames: string[] = [\"e-mail\", \"email-address\"];\n\n  static readonly AddressFieldNames: string[] = [\n    \"address\",\n    \"street-address\",\n    \"addr\",\n    \"street\",\n    \"mailing-addr\",\n    \"billing-addr\",\n    \"mail-addr\",\n    \"bill-addr\",\n    // German\n    \"strasse\",\n    \"adresse\",\n  ];\n\n  static readonly AddressFieldNameValues: string[] = [\n    \"mailing-addr\",\n    \"billing-addr\",\n    \"mail-addr\",\n    \"bill-addr\",\n  ];\n\n  static readonly Address1FieldNames: string[] = [\n    \"address-1\",\n    \"address-line-1\",\n    \"addr-1\",\n    \"street-1\",\n  ];\n\n  static readonly Address2FieldNames: string[] = [\n    \"address-2\",\n    \"address-line-2\",\n    \"addr-2\",\n    \"street-2\",\n  ];\n\n  static readonly Address3FieldNames: string[] = [\n    \"address-3\",\n    \"address-line-3\",\n    \"addr-3\",\n    \"street-3\",\n  ];\n\n  static readonly PostalCodeFieldNames: string[] = [\n    \"postal\",\n    \"zip\",\n    \"zip2\",\n    \"zip-code\",\n    \"postal-code\",\n    \"post-code\",\n    \"address-zip\",\n    \"address-postal\",\n    \"address-code\",\n    \"address-postal-code\",\n    \"address-zip-code\",\n    // German\n    \"plz\",\n    \"postleitzahl\",\n  ];\n\n  static readonly CityFieldNames: string[] = [\n    \"city\",\n    \"town\",\n    \"address-level-2\",\n    \"address-city\",\n    \"address-town\",\n    // German\n    \"ort\",\n    \"stadt\",\n    \"wohnort\",\n  ];\n\n  static readonly StateFieldNames: string[] = [\n    \"state\",\n    \"province\",\n    \"provence\",\n    \"address-level-1\",\n    \"address-state\",\n    \"address-province\",\n    // German\n    \"bundesland\",\n  ];\n\n  static readonly CountryFieldNames: string[] = [\n    \"country\",\n    \"country-code\",\n    \"country-name\",\n    \"address-country\",\n    \"address-country-name\",\n    \"address-country-code\",\n    // German\n    \"land\",\n  ];\n\n  static readonly PhoneFieldNames: string[] = [\n    \"phone\",\n    \"mobile\",\n    \"mobile-phone\",\n    \"tel\",\n    \"telephone\",\n    \"phone-number\",\n    // German\n    \"telefon\",\n    \"telefonnummer\",\n    \"mobil\",\n    \"handy\",\n  ];\n\n  static readonly UserNameFieldNames: string[] = [\"user-name\", \"user-id\", \"screen-name\"];\n\n  static readonly CompanyFieldNames: string[] = [\n    \"company\",\n    \"company-name\",\n    \"organization\",\n    \"organization-name\",\n    // German\n    \"firma\",\n  ];\n\n  static readonly IsoCountries: { [id: string]: string } = {\n    afghanistan: \"AF\",\n    \"aland islands\": \"AX\",\n    albania: \"AL\",\n    algeria: \"DZ\",\n    \"american samoa\": \"AS\",\n    andorra: \"AD\",\n    angola: \"AO\",\n    anguilla: \"AI\",\n    antarctica: \"AQ\",\n    \"antigua and barbuda\": \"AG\",\n    argentina: \"AR\",\n    armenia: \"AM\",\n    aruba: \"AW\",\n    australia: \"AU\",\n    austria: \"AT\",\n    azerbaijan: \"AZ\",\n    bahamas: \"BS\",\n    bahrain: \"BH\",\n    bangladesh: \"BD\",\n    barbados: \"BB\",\n    belarus: \"BY\",\n    belgium: \"BE\",\n    belize: \"BZ\",\n    benin: \"BJ\",\n    bermuda: \"BM\",\n    bhutan: \"BT\",\n    bolivia: \"BO\",\n    \"bosnia and herzegovina\": \"BA\",\n    botswana: \"BW\",\n    \"bouvet island\": \"BV\",\n    brazil: \"BR\",\n    \"british indian ocean territory\": \"IO\",\n    \"brunei darussalam\": \"BN\",\n    bulgaria: \"BG\",\n    \"burkina faso\": \"BF\",\n    burundi: \"BI\",\n    cambodia: \"KH\",\n    cameroon: \"CM\",\n    canada: \"CA\",\n    \"cape verde\": \"CV\",\n    \"cayman islands\": \"KY\",\n    \"central african republic\": \"CF\",\n    chad: \"TD\",\n    chile: \"CL\",\n    china: \"CN\",\n    \"christmas island\": \"CX\",\n    \"cocos (keeling) islands\": \"CC\",\n    colombia: \"CO\",\n    comoros: \"KM\",\n    congo: \"CG\",\n    \"congo, democratic republic\": \"CD\",\n    \"cook islands\": \"CK\",\n    \"costa rica\": \"CR\",\n    \"cote d'ivoire\": \"CI\",\n    croatia: \"HR\",\n    cuba: \"CU\",\n    cyprus: \"CY\",\n    \"czech republic\": \"CZ\",\n    denmark: \"DK\",\n    djibouti: \"DJ\",\n    dominica: \"DM\",\n    \"dominican republic\": \"DO\",\n    ecuador: \"EC\",\n    egypt: \"EG\",\n    \"el salvador\": \"SV\",\n    \"equatorial guinea\": \"GQ\",\n    eritrea: \"ER\",\n    estonia: \"EE\",\n    ethiopia: \"ET\",\n    \"falkland islands\": \"FK\",\n    \"faroe islands\": \"FO\",\n    fiji: \"FJ\",\n    finland: \"FI\",\n    france: \"FR\",\n    \"french guiana\": \"GF\",\n    \"french polynesia\": \"PF\",\n    \"french southern territories\": \"TF\",\n    gabon: \"GA\",\n    gambia: \"GM\",\n    georgia: \"GE\",\n    germany: \"DE\",\n    ghana: \"GH\",\n    gibraltar: \"GI\",\n    greece: \"GR\",\n    greenland: \"GL\",\n    grenada: \"GD\",\n    guadeloupe: \"GP\",\n    guam: \"GU\",\n    guatemala: \"GT\",\n    guernsey: \"GG\",\n    guinea: \"GN\",\n    \"guinea-bissau\": \"GW\",\n    guyana: \"GY\",\n    haiti: \"HT\",\n    \"heard island & mcdonald islands\": \"HM\",\n    \"holy see (vatican city state)\": \"VA\",\n    honduras: \"HN\",\n    \"hong kong\": \"HK\",\n    hungary: \"HU\",\n    iceland: \"IS\",\n    india: \"IN\",\n    indonesia: \"ID\",\n    \"iran, islamic republic of\": \"IR\",\n    iraq: \"IQ\",\n    ireland: \"IE\",\n    \"isle of man\": \"IM\",\n    israel: \"IL\",\n    italy: \"IT\",\n    jamaica: \"JM\",\n    japan: \"JP\",\n    jersey: \"JE\",\n    jordan: \"JO\",\n    kazakhstan: \"KZ\",\n    kenya: \"KE\",\n    kiribati: \"KI\",\n    \"republic of korea\": \"KR\",\n    \"south korea\": \"KR\",\n    \"democratic people's republic of korea\": \"KP\",\n    \"north korea\": \"KP\",\n    kuwait: \"KW\",\n    kyrgyzstan: \"KG\",\n    \"lao people's democratic republic\": \"LA\",\n    latvia: \"LV\",\n    lebanon: \"LB\",\n    lesotho: \"LS\",\n    liberia: \"LR\",\n    \"libyan arab jamahiriya\": \"LY\",\n    liechtenstein: \"LI\",\n    lithuania: \"LT\",\n    luxembourg: \"LU\",\n    macao: \"MO\",\n    macedonia: \"MK\",\n    madagascar: \"MG\",\n    malawi: \"MW\",\n    malaysia: \"MY\",\n    maldives: \"MV\",\n    mali: \"ML\",\n    malta: \"MT\",\n    \"marshall islands\": \"MH\",\n    martinique: \"MQ\",\n    mauritania: \"MR\",\n    mauritius: \"MU\",\n    mayotte: \"YT\",\n    mexico: \"MX\",\n    \"micronesia, federated states of\": \"FM\",\n    moldova: \"MD\",\n    monaco: \"MC\",\n    mongolia: \"MN\",\n    montenegro: \"ME\",\n    montserrat: \"MS\",\n    morocco: \"MA\",\n    mozambique: \"MZ\",\n    myanmar: \"MM\",\n    namibia: \"NA\",\n    nauru: \"NR\",\n    nepal: \"NP\",\n    netherlands: \"NL\",\n    \"netherlands antilles\": \"AN\",\n    \"new caledonia\": \"NC\",\n    \"new zealand\": \"NZ\",\n    nicaragua: \"NI\",\n    niger: \"NE\",\n    nigeria: \"NG\",\n    niue: \"NU\",\n    \"norfolk island\": \"NF\",\n    \"northern mariana islands\": \"MP\",\n    norway: \"NO\",\n    oman: \"OM\",\n    pakistan: \"PK\",\n    palau: \"PW\",\n    \"palestinian territory, occupied\": \"PS\",\n    panama: \"PA\",\n    \"papua new guinea\": \"PG\",\n    paraguay: \"PY\",\n    peru: \"PE\",\n    philippines: \"PH\",\n    pitcairn: \"PN\",\n    poland: \"PL\",\n    portugal: \"PT\",\n    \"puerto rico\": \"PR\",\n    qatar: \"QA\",\n    reunion: \"RE\",\n    romania: \"RO\",\n    \"russian federation\": \"RU\",\n    rwanda: \"RW\",\n    \"saint barthelemy\": \"BL\",\n    \"saint helena\": \"SH\",\n    \"saint kitts and nevis\": \"KN\",\n    \"saint lucia\": \"LC\",\n    \"saint martin\": \"MF\",\n    \"saint pierre and miquelon\": \"PM\",\n    \"saint vincent and grenadines\": \"VC\",\n    samoa: \"WS\",\n    \"san marino\": \"SM\",\n    \"sao tome and principe\": \"ST\",\n    \"saudi arabia\": \"SA\",\n    senegal: \"SN\",\n    serbia: \"RS\",\n    seychelles: \"SC\",\n    \"sierra leone\": \"SL\",\n    singapore: \"SG\",\n    slovakia: \"SK\",\n    slovenia: \"SI\",\n    \"solomon islands\": \"SB\",\n    somalia: \"SO\",\n    \"south africa\": \"ZA\",\n    \"south georgia and sandwich isl.\": \"GS\",\n    spain: \"ES\",\n    \"sri lanka\": \"LK\",\n    sudan: \"SD\",\n    suriname: \"SR\",\n    \"svalbard and jan mayen\": \"SJ\",\n    swaziland: \"SZ\",\n    sweden: \"SE\",\n    switzerland: \"CH\",\n    \"syrian arab republic\": \"SY\",\n    taiwan: \"TW\",\n    tajikistan: \"TJ\",\n    tanzania: \"TZ\",\n    thailand: \"TH\",\n    \"timor-leste\": \"TL\",\n    togo: \"TG\",\n    tokelau: \"TK\",\n    tonga: \"TO\",\n    \"trinidad and tobago\": \"TT\",\n    tunisia: \"TN\",\n    turkey: \"TR\",\n    turkmenistan: \"TM\",\n    \"turks and caicos islands\": \"TC\",\n    tuvalu: \"TV\",\n    uganda: \"UG\",\n    ukraine: \"UA\",\n    \"united arab emirates\": \"AE\",\n    \"united kingdom\": \"GB\",\n    \"united states\": \"US\",\n    \"united states outlying islands\": \"UM\",\n    uruguay: \"UY\",\n    uzbekistan: \"UZ\",\n    vanuatu: \"VU\",\n    venezuela: \"VE\",\n    vietnam: \"VN\",\n    \"virgin islands, british\": \"VG\",\n    \"virgin islands, u.s.\": \"VI\",\n    \"wallis and futuna\": \"WF\",\n    \"western sahara\": \"EH\",\n    yemen: \"YE\",\n    zambia: \"ZM\",\n    zimbabwe: \"ZW\",\n  };\n\n  static readonly IsoStates: { [id: string]: string } = {\n    alabama: \"AL\",\n    alaska: \"AK\",\n    \"american samoa\": \"AS\",\n    arizona: \"AZ\",\n    arkansas: \"AR\",\n    california: \"CA\",\n    colorado: \"CO\",\n    connecticut: \"CT\",\n    delaware: \"DE\",\n    \"district of columbia\": \"DC\",\n    \"federated states of micronesia\": \"FM\",\n    florida: \"FL\",\n    georgia: \"GA\",\n    guam: \"GU\",\n    hawaii: \"HI\",\n    idaho: \"ID\",\n    illinois: \"IL\",\n    indiana: \"IN\",\n    iowa: \"IA\",\n    kansas: \"KS\",\n    kentucky: \"KY\",\n    louisiana: \"LA\",\n    maine: \"ME\",\n    \"marshall islands\": \"MH\",\n    maryland: \"MD\",\n    massachusetts: \"MA\",\n    michigan: \"MI\",\n    minnesota: \"MN\",\n    mississippi: \"MS\",\n    missouri: \"MO\",\n    montana: \"MT\",\n    nebraska: \"NE\",\n    nevada: \"NV\",\n    \"new hampshire\": \"NH\",\n    \"new jersey\": \"NJ\",\n    \"new mexico\": \"NM\",\n    \"new york\": \"NY\",\n    \"north carolina\": \"NC\",\n    \"north dakota\": \"ND\",\n    \"northern mariana islands\": \"MP\",\n    ohio: \"OH\",\n    oklahoma: \"OK\",\n    oregon: \"OR\",\n    palau: \"PW\",\n    pennsylvania: \"PA\",\n    \"puerto rico\": \"PR\",\n    \"rhode island\": \"RI\",\n    \"south carolina\": \"SC\",\n    \"south dakota\": \"SD\",\n    tennessee: \"TN\",\n    texas: \"TX\",\n    utah: \"UT\",\n    vermont: \"VT\",\n    \"virgin islands\": \"VI\",\n    virginia: \"VA\",\n    washington: \"WA\",\n    \"west virginia\": \"WV\",\n    wisconsin: \"WI\",\n    wyoming: \"WY\",\n  };\n\n  static readonly IsoProvinces: { [id: string]: string } = {\n    alberta: \"AB\",\n    \"british columbia\": \"BC\",\n    manitoba: \"MB\",\n    \"new brunswick\": \"NB\",\n    \"newfoundland and labrador\": \"NL\",\n    \"nova scotia\": \"NS\",\n    ontario: \"ON\",\n    \"prince edward island\": \"PE\",\n    quebec: \"QC\",\n    saskatchewan: \"SK\",\n  };\n}\n","import { firstValueFrom, startWith } from \"rxjs\";\nimport { pairwise } from \"rxjs/operators\";\n\nimport { EventCollectionService } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { AutofillOverlayVisibility } from \"@bitwarden/common/autofill/constants\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { DomainSettingsService } from \"@bitwarden/common/autofill/services/domain-settings.service\";\nimport { InlineMenuVisibilitySetting } from \"@bitwarden/common/autofill/types\";\nimport { BillingAccountProfileStateService } from \"@bitwarden/common/billing/abstractions/account/billing-account-profile-state.service\";\nimport { EventType } from \"@bitwarden/common/enums\";\nimport {\n  UriMatchStrategySetting,\n  UriMatchStrategy,\n} from \"@bitwarden/common/models/domain/domain-service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { TotpService } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { FieldType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\n\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { ScriptInjectorService } from \"../../platform/services/abstractions/script-injector.service\";\nimport { openVaultItemPasswordRepromptPopout } from \"../../vault/popup/utils/vault-popout-window\";\nimport { AutofillPort } from \"../enums/autofill-port.enums\";\nimport AutofillField from \"../models/autofill-field\";\nimport AutofillPageDetails from \"../models/autofill-page-details\";\nimport AutofillScript from \"../models/autofill-script\";\n\nimport {\n  AutoFillOptions,\n  AutofillService as AutofillServiceInterface,\n  FormData,\n  GenerateFillScriptOptions,\n  PageDetail,\n} from \"./abstractions/autofill.service\";\nimport {\n  AutoFillConstants,\n  CreditCardAutoFillConstants,\n  IdentityAutoFillConstants,\n} from \"./autofill-constants\";\n\nexport default class AutofillService implements AutofillServiceInterface {\n  private openVaultItemPasswordRepromptPopout = openVaultItemPasswordRepromptPopout;\n  private openPasswordRepromptPopoutDebounce: number | NodeJS.Timeout;\n  private currentlyOpeningPasswordRepromptPopout = false;\n  private autofillScriptPortsSet = new Set<chrome.runtime.Port>();\n  static searchFieldNamesSet = new Set(AutoFillConstants.SearchFieldNames);\n\n  constructor(\n    private cipherService: CipherService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private totpService: TotpService,\n    private eventCollectionService: EventCollectionService,\n    private logService: LogService,\n    private domainSettingsService: DomainSettingsService,\n    private userVerificationService: UserVerificationService,\n    private billingAccountProfileStateService: BillingAccountProfileStateService,\n    private scriptInjectorService: ScriptInjectorService,\n    private accountService: AccountService,\n    private authService: AuthService,\n  ) {}\n\n  /**\n   * Triggers on installation of the extension Handles injecting\n   * content scripts into all tabs that are currently open, and\n   * sets up a listener to ensure content scripts can identify\n   * if the extension context has been disconnected.\n   */\n  async loadAutofillScriptsOnInstall() {\n    BrowserApi.addListener(chrome.runtime.onConnect, this.handleInjectedScriptPortConnection);\n    void this.injectAutofillScriptsInAllTabs();\n    this.autofillSettingsService.inlineMenuVisibility$\n      .pipe(startWith(undefined), pairwise())\n      .subscribe(([previousSetting, currentSetting]) =>\n        this.handleInlineMenuVisibilityChange(previousSetting, currentSetting),\n      );\n  }\n\n  /**\n   * Triggers a complete reload of all autofill scripts on tabs open within\n   * the user's browsing session. This is done by first disconnecting all\n   * existing autofill content script ports, which cleans up existing object\n   * instances, and then re-injecting the autofill scripts into all tabs.\n   */\n  async reloadAutofillScripts() {\n    this.autofillScriptPortsSet.forEach((port) => {\n      port.disconnect();\n      this.autofillScriptPortsSet.delete(port);\n    });\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.injectAutofillScriptsInAllTabs();\n  }\n\n  /**\n   * Injects the autofill scripts into the current tab and all frames\n   * found within the tab. Temporarily, will conditionally inject\n   * the refactor of the core autofill script if the feature flag\n   * is enabled.\n   * @param {chrome.tabs.Tab} tab\n   * @param {number} frameId\n   * @param {boolean} triggeringOnPageLoad\n   */\n  async injectAutofillScripts(\n    tab: chrome.tabs.Tab,\n    frameId = 0,\n    triggeringOnPageLoad = true,\n  ): Promise<void> {\n    // Autofill user settings loaded from state can await the active account state indefinitely\n    // if not guarded by an active account check (e.g. the user is logged in)\n    const activeAccount = await firstValueFrom(this.accountService.activeAccount$);\n    const authStatus = await firstValueFrom(this.authService.activeAccountStatus$);\n    const accountIsUnlocked = authStatus === AuthenticationStatus.Unlocked;\n    let overlayVisibility: InlineMenuVisibilitySetting = AutofillOverlayVisibility.Off;\n    let autoFillOnPageLoadIsEnabled = false;\n\n    if (activeAccount) {\n      overlayVisibility = await this.getOverlayVisibility();\n    }\n\n    const mainAutofillScript = overlayVisibility\n      ? \"bootstrap-autofill-overlay.js\"\n      : \"bootstrap-autofill.js\";\n\n    const injectedScripts = [mainAutofillScript];\n\n    if (activeAccount && accountIsUnlocked) {\n      autoFillOnPageLoadIsEnabled = await this.getAutofillOnPageLoad();\n    }\n\n    if (triggeringOnPageLoad && autoFillOnPageLoadIsEnabled) {\n      injectedScripts.push(\"autofiller.js\");\n    }\n\n    if (!triggeringOnPageLoad) {\n      await this.scriptInjectorService.inject({\n        tabId: tab.id,\n        injectDetails: { file: \"content/content-message-handler.js\", runAt: \"document_start\" },\n      });\n    }\n\n    injectedScripts.push(\"notificationBar.js\", \"contextMenuHandler.js\");\n\n    for (const injectedScript of injectedScripts) {\n      await this.scriptInjectorService.inject({\n        tabId: tab.id,\n        injectDetails: {\n          file: `content/${injectedScript}`,\n          runAt: \"document_start\",\n          frame: frameId,\n        },\n      });\n    }\n  }\n\n  /**\n   * Gets all forms with password fields and formats the data\n   * for both forms and password input elements.\n   * @param {AutofillPageDetails} pageDetails\n   * @returns {FormData[]}\n   */\n  getFormsWithPasswordFields(pageDetails: AutofillPageDetails): FormData[] {\n    const formData: FormData[] = [];\n\n    const passwordFields = AutofillService.loadPasswordFields(pageDetails, true, true, false, true);\n\n    // TODO: this logic prevents multi-step account creation forms (that just start with email)\n    // from being passed on to the notification bar content script - even if autofill-init.js found the form and email field.\n    // ex: https://signup.live.com/\n    if (passwordFields.length === 0) {\n      return formData;\n    }\n\n    // Back up check for cases where there are several password fields detected,\n    // but they are not all part of the form b/c of bad HTML\n\n    // gather password fields that don't have an enclosing form\n    const passwordFieldsWithoutForm = passwordFields.filter((pf) => pf.form === undefined);\n    const formKeys = Object.keys(pageDetails.forms);\n    const formCount = formKeys.length;\n\n    // if we have 3 password fields and only 1 form, and there are password fields that are not within a form\n    // but there is at least one password field within the form, then most likely this is a poorly built password change form\n    if (passwordFields.length === 3 && formCount == 1 && passwordFieldsWithoutForm.length > 0) {\n      // Only one form so get the singular form key\n      const soloFormKey = formKeys[0];\n\n      const atLeastOnePasswordFieldWithinSoloForm =\n        passwordFields.filter((pf) => pf.form !== null && pf.form === soloFormKey).length > 0;\n\n      if (atLeastOnePasswordFieldWithinSoloForm) {\n        // We have a form with at least one password field,\n        // so let's make an assumption that the password fields without a form are actually part of this form\n        passwordFieldsWithoutForm.forEach((pf) => {\n          pf.form = soloFormKey;\n        });\n      }\n    }\n\n    for (const formKey in pageDetails.forms) {\n      // eslint-disable-next-line\n      if (!pageDetails.forms.hasOwnProperty(formKey)) {\n        continue;\n      }\n\n      const formPasswordFields = passwordFields.filter((pf) => formKey === pf.form);\n      if (formPasswordFields.length > 0) {\n        let uf = this.findUsernameField(pageDetails, formPasswordFields[0], false, false, false);\n        if (uf == null) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          uf = this.findUsernameField(pageDetails, formPasswordFields[0], true, true, false);\n        }\n        formData.push({\n          form: pageDetails.forms[formKey],\n          password: formPasswordFields[0],\n          username: uf,\n          passwords: formPasswordFields,\n        });\n      }\n    }\n\n    return formData;\n  }\n\n  /**\n   * Gets the overlay's visibility setting from the autofill settings service.\n   */\n  async getOverlayVisibility(): Promise<InlineMenuVisibilitySetting> {\n    return await firstValueFrom(this.autofillSettingsService.inlineMenuVisibility$);\n  }\n\n  /**\n   * Gets the setting for automatically copying TOTP upon autofill from the autofill settings service.\n   */\n  async getShouldAutoCopyTotp(): Promise<boolean> {\n    return await firstValueFrom(this.autofillSettingsService.autoCopyTotp$);\n  }\n\n  /**\n   * Gets the autofill on page load setting from the autofill settings service.\n   */\n  async getAutofillOnPageLoad(): Promise<boolean> {\n    return await firstValueFrom(this.autofillSettingsService.autofillOnPageLoad$);\n  }\n\n  /**\n   * Gets the default URI match strategy setting from the domain settings service.\n   */\n  async getDefaultUriMatchStrategy(): Promise<UriMatchStrategySetting> {\n    return await firstValueFrom(this.domainSettingsService.defaultUriMatchStrategy$);\n  }\n\n  /**\n   * Autofill a given tab with a given login item\n   * @param {AutoFillOptions} options Instructions about the autofill operation, including tab and login item\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFill(options: AutoFillOptions): Promise<string | null> {\n    const tab = options.tab;\n    if (!tab || !options.cipher || !options.pageDetails || !options.pageDetails.length) {\n      throw new Error(\"Nothing to auto-fill.\");\n    }\n\n    let totp: string | null = null;\n\n    const canAccessPremium = await firstValueFrom(\n      this.billingAccountProfileStateService.hasPremiumFromAnySource$,\n    );\n    const defaultUriMatch = await this.getDefaultUriMatchStrategy();\n\n    if (!canAccessPremium) {\n      options.cipher.login.totp = null;\n    }\n\n    let didAutofill = false;\n    await Promise.all(\n      options.pageDetails.map(async (pd) => {\n        // make sure we're still on correct tab\n        if (pd.tab.id !== tab.id || pd.tab.url !== tab.url) {\n          return;\n        }\n\n        const fillScript = await this.generateFillScript(pd.details, {\n          skipUsernameOnlyFill: options.skipUsernameOnlyFill || false,\n          onlyEmptyFields: options.onlyEmptyFields || false,\n          onlyVisibleFields: options.onlyVisibleFields || false,\n          fillNewPassword: options.fillNewPassword || false,\n          allowTotpAutofill: options.allowTotpAutofill || false,\n          cipher: options.cipher,\n          tabUrl: tab.url,\n          defaultUriMatch: defaultUriMatch,\n        });\n\n        if (!fillScript || !fillScript.script || !fillScript.script.length) {\n          return;\n        }\n\n        if (\n          fillScript.untrustedIframe &&\n          options.allowUntrustedIframe != undefined &&\n          !options.allowUntrustedIframe\n        ) {\n          this.logService.info(\"Auto-fill on page load was blocked due to an untrusted iframe.\");\n          return;\n        }\n\n        // Add a small delay between operations\n        fillScript.properties.delay_between_operations = 20;\n\n        didAutofill = true;\n        if (!options.skipLastUsed) {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.cipherService.updateLastUsedDate(options.cipher.id);\n        }\n\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        BrowserApi.tabSendMessage(\n          tab,\n          {\n            command: \"fillForm\",\n            fillScript: fillScript,\n            url: tab.url,\n            pageDetailsUrl: pd.details.url,\n          },\n          { frameId: pd.frameId },\n        );\n\n        // Skip getting the TOTP code for clipboard in these cases\n        if (\n          options.cipher.type !== CipherType.Login ||\n          totp !== null ||\n          !options.cipher.login.totp ||\n          (!canAccessPremium && !options.cipher.organizationUseTotp)\n        ) {\n          return;\n        }\n\n        const shouldAutoCopyTotp = await this.getShouldAutoCopyTotp();\n\n        totp = shouldAutoCopyTotp\n          ? await this.totpService.getCode(options.cipher.login.totp)\n          : null;\n      }),\n    );\n\n    if (didAutofill) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.eventCollectionService.collect(EventType.Cipher_ClientAutofilled, options.cipher.id);\n      if (totp !== null) {\n        return totp;\n      } else {\n        return null;\n      }\n    } else {\n      throw new Error(\"Did not auto-fill.\");\n    }\n  }\n\n  /**\n   * Autofill the specified tab with the next login item from the cache\n   * @param {PageDetail[]} pageDetails The data scraped from the page\n   * @param {chrome.tabs.Tab} tab The tab to be autofilled\n   * @param {boolean} fromCommand Whether the autofill is triggered by a keyboard shortcut (`true`) or autofill on page load (`false`)\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFillOnTab(\n    pageDetails: PageDetail[],\n    tab: chrome.tabs.Tab,\n    fromCommand: boolean,\n  ): Promise<string | null> {\n    let cipher: CipherView;\n    if (fromCommand) {\n      cipher = await this.cipherService.getNextCipherForUrl(tab.url);\n    } else {\n      const lastLaunchedCipher = await this.cipherService.getLastLaunchedForUrl(tab.url, true);\n      if (\n        lastLaunchedCipher &&\n        Date.now().valueOf() - lastLaunchedCipher.localData?.lastLaunched?.valueOf() < 30000\n      ) {\n        cipher = lastLaunchedCipher;\n      } else {\n        cipher = await this.cipherService.getLastUsedForUrl(tab.url, true);\n      }\n    }\n\n    if (cipher == null || (cipher.reprompt === CipherRepromptType.Password && !fromCommand)) {\n      return null;\n    }\n\n    if (await this.isPasswordRepromptRequired(cipher, tab)) {\n      if (fromCommand) {\n        this.cipherService.updateLastUsedIndexForUrl(tab.url);\n      }\n\n      return null;\n    }\n\n    const totpCode = await this.doAutoFill({\n      tab: tab,\n      cipher: cipher,\n      pageDetails: pageDetails,\n      skipLastUsed: !fromCommand,\n      skipUsernameOnlyFill: !fromCommand,\n      onlyEmptyFields: !fromCommand,\n      onlyVisibleFields: !fromCommand,\n      fillNewPassword: fromCommand,\n      allowUntrustedIframe: fromCommand,\n      allowTotpAutofill: fromCommand,\n    });\n\n    // Update last used index as autofill has succeeded\n    if (fromCommand) {\n      this.cipherService.updateLastUsedIndexForUrl(tab.url);\n    }\n\n    return totpCode;\n  }\n\n  async isPasswordRepromptRequired(cipher: CipherView, tab: chrome.tabs.Tab): Promise<boolean> {\n    const userHasMasterPasswordAndKeyHash =\n      await this.userVerificationService.hasMasterPasswordAndMasterKeyHash();\n    if (cipher.reprompt === CipherRepromptType.Password && userHasMasterPasswordAndKeyHash) {\n      if (!this.isDebouncingPasswordRepromptPopout()) {\n        await this.openVaultItemPasswordRepromptPopout(tab, {\n          cipherId: cipher.id,\n          action: \"autofill\",\n        });\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Autofill the active tab with the next cipher from the cache\n   * @param {PageDetail[]} pageDetails The data scraped from the page\n   * @param {boolean} fromCommand Whether the autofill is triggered by a keyboard shortcut (`true`) or autofill on page load (`false`)\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFillActiveTab(\n    pageDetails: PageDetail[],\n    fromCommand: boolean,\n    cipherType?: CipherType,\n  ): Promise<string | null> {\n    if (!pageDetails[0]?.details?.fields?.length) {\n      return null;\n    }\n\n    const tab = await this.getActiveTab();\n\n    if (!tab || !tab.url) {\n      return null;\n    }\n\n    if (!cipherType || cipherType === CipherType.Login) {\n      return await this.doAutoFillOnTab(pageDetails, tab, fromCommand);\n    }\n\n    // Cipher is a non-login type\n    const cipher: CipherView = (\n      (await this.cipherService.getAllDecryptedForUrl(tab.url, [cipherType])) || []\n    ).find(({ type }) => type === cipherType);\n\n    if (!cipher || cipher.reprompt !== CipherRepromptType.None) {\n      return null;\n    }\n\n    return await this.doAutoFill({\n      tab: tab,\n      cipher: cipher,\n      pageDetails: pageDetails,\n      skipLastUsed: !fromCommand,\n      skipUsernameOnlyFill: !fromCommand,\n      onlyEmptyFields: !fromCommand,\n      onlyVisibleFields: !fromCommand,\n      fillNewPassword: false,\n      allowUntrustedIframe: fromCommand,\n      allowTotpAutofill: false,\n    });\n  }\n\n  /**\n   * Gets the active tab from the current window.\n   * Throws an error if no tab is found.\n   * @returns {Promise<chrome.tabs.Tab>}\n   * @private\n   */\n  private async getActiveTab(): Promise<chrome.tabs.Tab> {\n    const tab = await BrowserApi.getTabFromCurrentWindow();\n    if (!tab) {\n      throw new Error(\"No tab found.\");\n    }\n\n    return tab;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and cipher.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {GenerateFillScriptOptions} options\n   * @returns {Promise<AutofillScript | null>}\n   * @private\n   */\n  private async generateFillScript(\n    pageDetails: AutofillPageDetails,\n    options: GenerateFillScriptOptions,\n  ): Promise<AutofillScript | null> {\n    if (!pageDetails || !options.cipher) {\n      return null;\n    }\n\n    let fillScript = new AutofillScript();\n    const filledFields: { [id: string]: AutofillField } = {};\n    const fields = options.cipher.fields;\n\n    if (fields && fields.length) {\n      const fieldNames: string[] = [];\n\n      fields.forEach((f) => {\n        if (AutofillService.hasValue(f.name)) {\n          fieldNames.push(f.name.toLowerCase());\n        }\n      });\n\n      pageDetails.fields.forEach((field) => {\n        // eslint-disable-next-line\n        if (filledFields.hasOwnProperty(field.opid)) {\n          return;\n        }\n\n        if (!field.viewable && field.tagName !== \"span\") {\n          return;\n        }\n\n        // Check if the input is an untyped/mistyped search input\n        if (AutofillService.isSearchField(field)) {\n          return;\n        }\n\n        const matchingIndex = this.findMatchingFieldIndex(field, fieldNames);\n        if (matchingIndex > -1) {\n          const matchingField: FieldView = fields[matchingIndex];\n          let val: string;\n          if (matchingField.type === FieldType.Linked) {\n            // Assumption: Linked Field is not being used to autofill a boolean value\n            val = options.cipher.linkedFieldValue(matchingField.linkedId) as string;\n          } else {\n            val = matchingField.value;\n            if (val == null && matchingField.type === FieldType.Boolean) {\n              val = \"false\";\n            }\n          }\n\n          filledFields[field.opid] = field;\n          AutofillService.fillByOpid(fillScript, field, val);\n        }\n      });\n    }\n\n    switch (options.cipher.type) {\n      case CipherType.Login:\n        fillScript = await this.generateLoginFillScript(\n          fillScript,\n          pageDetails,\n          filledFields,\n          options,\n        );\n        break;\n      case CipherType.Card:\n        fillScript = this.generateCardFillScript(fillScript, pageDetails, filledFields, options);\n        break;\n      case CipherType.Identity:\n        fillScript = this.generateIdentityFillScript(\n          fillScript,\n          pageDetails,\n          filledFields,\n          options,\n        );\n        break;\n      default:\n        return null;\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and login cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {Promise<AutofillScript | null>}\n   * @private\n   */\n  private async generateLoginFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): Promise<AutofillScript | null> {\n    if (!options.cipher.login) {\n      return null;\n    }\n\n    const passwords: AutofillField[] = [];\n    const usernames: AutofillField[] = [];\n    const totps: AutofillField[] = [];\n    let pf: AutofillField = null;\n    let username: AutofillField = null;\n    let totp: AutofillField = null;\n    const login = options.cipher.login;\n    fillScript.savedUrls =\n      login?.uris?.filter((u) => u.match != UriMatchStrategy.Never).map((u) => u.uri) ?? [];\n\n    fillScript.untrustedIframe = await this.inUntrustedIframe(pageDetails.url, options);\n\n    let passwordFields = AutofillService.loadPasswordFields(\n      pageDetails,\n      false,\n      false,\n      options.onlyEmptyFields,\n      options.fillNewPassword,\n    );\n    if (!passwordFields.length && !options.onlyVisibleFields) {\n      // not able to find any viewable password fields. maybe there are some \"hidden\" ones?\n      passwordFields = AutofillService.loadPasswordFields(\n        pageDetails,\n        true,\n        true,\n        options.onlyEmptyFields,\n        options.fillNewPassword,\n      );\n    }\n\n    for (const formKey in pageDetails.forms) {\n      // eslint-disable-next-line\n      if (!pageDetails.forms.hasOwnProperty(formKey)) {\n        continue;\n      }\n\n      passwordFields.forEach((passField) => {\n        pf = passField;\n        passwords.push(pf);\n\n        if (login.username) {\n          username = this.findUsernameField(pageDetails, pf, false, false, false);\n\n          if (!username && !options.onlyVisibleFields) {\n            // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n            username = this.findUsernameField(pageDetails, pf, true, true, false);\n          }\n\n          if (username) {\n            usernames.push(username);\n          }\n        }\n\n        if (options.allowTotpAutofill && login.totp) {\n          totp = this.findTotpField(pageDetails, pf, false, false, false);\n\n          if (!totp && !options.onlyVisibleFields) {\n            // not able to find any viewable totp fields. maybe there are some \"hidden\" ones?\n            totp = this.findTotpField(pageDetails, pf, true, true, false);\n          }\n\n          if (totp) {\n            totps.push(totp);\n          }\n        }\n      });\n    }\n\n    if (passwordFields.length && !passwords.length) {\n      // The page does not have any forms with password fields. Use the first password field on the page and the\n      // input field just before it as the username.\n\n      pf = passwordFields[0];\n      passwords.push(pf);\n\n      if (login.username && pf.elementNumber > 0) {\n        username = this.findUsernameField(pageDetails, pf, false, false, true);\n\n        if (!username && !options.onlyVisibleFields) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          username = this.findUsernameField(pageDetails, pf, true, true, true);\n        }\n\n        if (username) {\n          usernames.push(username);\n        }\n      }\n\n      if (options.allowTotpAutofill && login.totp && pf.elementNumber > 0) {\n        totp = this.findTotpField(pageDetails, pf, false, false, true);\n\n        if (!totp && !options.onlyVisibleFields) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          totp = this.findTotpField(pageDetails, pf, true, true, true);\n        }\n\n        if (totp) {\n          totps.push(totp);\n        }\n      }\n    }\n\n    if (!passwordFields.length) {\n      // No password fields on this page. Let's try to just fuzzy fill the username.\n      pageDetails.fields.forEach((f) => {\n        if (\n          !options.skipUsernameOnlyFill &&\n          f.viewable &&\n          (f.type === \"text\" || f.type === \"email\" || f.type === \"tel\") &&\n          AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.UsernameFieldNames)\n        ) {\n          usernames.push(f);\n        }\n\n        if (\n          options.allowTotpAutofill &&\n          f.viewable &&\n          (f.type === \"text\" || f.type === \"number\") &&\n          (AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.TotpFieldNames) ||\n            f.autoCompleteType === \"one-time-code\")\n        ) {\n          totps.push(f);\n        }\n      });\n    }\n\n    usernames.forEach((u) => {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(u.opid)) {\n        return;\n      }\n\n      filledFields[u.opid] = u;\n      AutofillService.fillByOpid(fillScript, u, login.username);\n    });\n\n    passwords.forEach((p) => {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(p.opid)) {\n        return;\n      }\n\n      filledFields[p.opid] = p;\n      AutofillService.fillByOpid(fillScript, p, login.password);\n    });\n\n    if (options.allowTotpAutofill) {\n      await Promise.all(\n        totps.map(async (t) => {\n          if (Object.prototype.hasOwnProperty.call(filledFields, t.opid)) {\n            return;\n          }\n\n          filledFields[t.opid] = t;\n          const totpValue = await this.totpService.getCode(login.totp);\n          AutofillService.fillByOpid(fillScript, t, totpValue);\n        }),\n      );\n    }\n\n    fillScript = AutofillService.setFillScriptForFocus(filledFields, fillScript);\n    return fillScript;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and credit card cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {AutofillScript|null}\n   * @private\n   */\n  private generateCardFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): AutofillScript | null {\n    if (!options.cipher.card) {\n      return null;\n    }\n\n    const fillFields: { [id: string]: AutofillField } = {};\n\n    pageDetails.fields.forEach((f) => {\n      if (AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillTypes)) {\n        return;\n      }\n\n      for (let i = 0; i < CreditCardAutoFillConstants.CardAttributes.length; i++) {\n        const attr = CreditCardAutoFillConstants.CardAttributes[i];\n        // eslint-disable-next-line\n        if (!f.hasOwnProperty(attr) || !f[attr] || !f.viewable) {\n          continue;\n        }\n\n        // ref https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofill\n        // ref https://developers.google.com/web/fundamentals/design-and-ux/input/forms/\n        if (\n          !fillFields.cardholderName &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardHolderFieldNames,\n            CreditCardAutoFillConstants.CardHolderFieldNameValues,\n          )\n        ) {\n          fillFields.cardholderName = f;\n          break;\n        } else if (\n          !fillFields.number &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardNumberFieldNames,\n            CreditCardAutoFillConstants.CardNumberFieldNameValues,\n          )\n        ) {\n          fillFields.number = f;\n          break;\n        } else if (\n          !fillFields.exp &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardExpiryFieldNames,\n            CreditCardAutoFillConstants.CardExpiryFieldNameValues,\n          )\n        ) {\n          fillFields.exp = f;\n          break;\n        } else if (\n          !fillFields.expMonth &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.ExpiryMonthFieldNames)\n        ) {\n          fillFields.expMonth = f;\n          break;\n        } else if (\n          !fillFields.expYear &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.ExpiryYearFieldNames)\n        ) {\n          fillFields.expYear = f;\n          break;\n        } else if (\n          !fillFields.code &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.CVVFieldNames)\n        ) {\n          fillFields.code = f;\n          break;\n        } else if (\n          !fillFields.brand &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.CardBrandFieldNames)\n        ) {\n          fillFields.brand = f;\n          break;\n        }\n      }\n    });\n\n    const card = options.cipher.card;\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"cardholderName\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"number\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"code\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"brand\");\n\n    if (fillFields.expMonth && AutofillService.hasValue(card.expMonth)) {\n      let expMonth: string = card.expMonth;\n\n      if (fillFields.expMonth.selectInfo && fillFields.expMonth.selectInfo.options) {\n        let index: number = null;\n        const siOptions = fillFields.expMonth.selectInfo.options;\n        if (siOptions.length === 12) {\n          index = parseInt(card.expMonth, null) - 1;\n        } else if (siOptions.length === 13) {\n          if (\n            siOptions[0][0] != null &&\n            siOptions[0][0] !== \"\" &&\n            (siOptions[12][0] == null || siOptions[12][0] === \"\")\n          ) {\n            index = parseInt(card.expMonth, null) - 1;\n          } else {\n            index = parseInt(card.expMonth, null);\n          }\n        }\n\n        if (index != null) {\n          const option = siOptions[index];\n          if (option.length > 1) {\n            expMonth = option[1];\n          }\n        }\n      } else if (\n        (this.fieldAttrsContain(fillFields.expMonth, \"mm\") ||\n          fillFields.expMonth.maxLength === 2) &&\n        expMonth.length === 1\n      ) {\n        expMonth = \"0\" + expMonth;\n      }\n\n      filledFields[fillFields.expMonth.opid] = fillFields.expMonth;\n      AutofillService.fillByOpid(fillScript, fillFields.expMonth, expMonth);\n    }\n\n    if (fillFields.expYear && AutofillService.hasValue(card.expYear)) {\n      let expYear: string = card.expYear;\n      if (fillFields.expYear.selectInfo && fillFields.expYear.selectInfo.options) {\n        for (let i = 0; i < fillFields.expYear.selectInfo.options.length; i++) {\n          const o: [string, string] = fillFields.expYear.selectInfo.options[i];\n          if (o[0] === card.expYear || o[1] === card.expYear) {\n            expYear = o[1];\n            break;\n          }\n          if (\n            o[1].length === 2 &&\n            card.expYear.length === 4 &&\n            o[1] === card.expYear.substring(2)\n          ) {\n            expYear = o[1];\n            break;\n          }\n          const colonIndex = o[1].indexOf(\":\");\n          if (colonIndex > -1 && o[1].length > colonIndex + 1) {\n            const val = o[1].substring(colonIndex + 2);\n            if (val != null && val.trim() !== \"\" && val === card.expYear) {\n              expYear = o[1];\n              break;\n            }\n          }\n        }\n      } else if (\n        this.fieldAttrsContain(fillFields.expYear, \"yyyy\") ||\n        fillFields.expYear.maxLength === 4\n      ) {\n        if (expYear.length === 2) {\n          expYear = \"20\" + expYear;\n        }\n      } else if (\n        this.fieldAttrsContain(fillFields.expYear, \"yy\") ||\n        fillFields.expYear.maxLength === 2\n      ) {\n        if (expYear.length === 4) {\n          expYear = expYear.substr(2);\n        }\n      }\n\n      filledFields[fillFields.expYear.opid] = fillFields.expYear;\n      AutofillService.fillByOpid(fillScript, fillFields.expYear, expYear);\n    }\n\n    if (\n      fillFields.exp &&\n      AutofillService.hasValue(card.expMonth) &&\n      AutofillService.hasValue(card.expYear)\n    ) {\n      const fullMonth = (\"0\" + card.expMonth).slice(-2);\n\n      let fullYear: string = card.expYear;\n      let partYear: string = null;\n      if (fullYear.length === 2) {\n        partYear = fullYear;\n        fullYear = \"20\" + fullYear;\n      } else if (fullYear.length === 4) {\n        partYear = fullYear.substr(2, 2);\n      }\n\n      let exp: string = null;\n      for (let i = 0; i < CreditCardAutoFillConstants.MonthAbbr.length; i++) {\n        if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + \"/\" + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + \"/\" + partYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + \"/\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + \"/\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + \"-\" + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + \"-\" + partYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + \"-\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + \"-\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] + CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] + CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] + CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] + CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + partYear;\n        }\n\n        if (exp != null) {\n          break;\n        }\n      }\n\n      if (exp == null) {\n        exp = fullYear + \"-\" + fullMonth;\n      }\n\n      this.makeScriptActionWithValue(fillScript, exp, fillFields.exp, filledFields);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Determines whether an iframe is potentially dangerous (\"untrusted\") to autofill\n   * @param {string} pageUrl The url of the page/iframe, usually from AutofillPageDetails\n   * @param {GenerateFillScriptOptions} options The GenerateFillScript options\n   * @returns {boolean} `true` if the iframe is untrusted and a warning should be shown, `false` otherwise\n   * @private\n   */\n  private async inUntrustedIframe(\n    pageUrl: string,\n    options: GenerateFillScriptOptions,\n  ): Promise<boolean> {\n    // If the pageUrl (from the content script) matches the tabUrl (from the sender tab), we are not in an iframe\n    // This also avoids a false positive if no URI is saved and the user triggers auto-fill anyway\n    if (pageUrl === options.tabUrl) {\n      return false;\n    }\n\n    // Check the pageUrl against cipher URIs using the configured match detection.\n    // Remember: if we are in this function, the tabUrl already matches a saved URI for the login.\n    // We need to verify the pageUrl also matches.\n    const equivalentDomains = await firstValueFrom(\n      this.domainSettingsService.getUrlEquivalentDomains(pageUrl),\n    );\n    const matchesUri = options.cipher.login.matchesUri(\n      pageUrl,\n      equivalentDomains,\n      options.defaultUriMatch,\n    );\n    return !matchesUri;\n  }\n\n  /**\n   * Used when handling autofill on credit card fields. Determines whether\n   * the field has an attribute that matches the given value.\n   * @param {AutofillField} field\n   * @param {string} containsVal\n   * @returns {boolean}\n   * @private\n   */\n  private fieldAttrsContain(field: AutofillField, containsVal: string): boolean {\n    if (!field) {\n      return false;\n    }\n\n    let doesContain = false;\n    CreditCardAutoFillConstants.CardAttributesExtended.forEach((attr) => {\n      // eslint-disable-next-line\n      if (doesContain || !field.hasOwnProperty(attr) || !field[attr]) {\n        return;\n      }\n\n      let val = field[attr];\n      val = val.replace(/ /g, \"\").toLowerCase();\n      doesContain = val.indexOf(containsVal) > -1;\n    });\n\n    return doesContain;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and identify cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {AutofillScript}\n   * @private\n   */\n  private generateIdentityFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): AutofillScript {\n    if (!options.cipher.identity) {\n      return null;\n    }\n\n    const fillFields: { [id: string]: AutofillField } = {};\n\n    pageDetails.fields.forEach((f) => {\n      if (AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillTypes)) {\n        return;\n      }\n\n      for (let i = 0; i < IdentityAutoFillConstants.IdentityAttributes.length; i++) {\n        const attr = IdentityAutoFillConstants.IdentityAttributes[i];\n        // eslint-disable-next-line\n        if (!f.hasOwnProperty(attr) || !f[attr] || !f.viewable) {\n          continue;\n        }\n\n        // ref https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofill\n        // ref https://developers.google.com/web/fundamentals/design-and-ux/input/forms/\n        if (\n          !fillFields.name &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            IdentityAutoFillConstants.FullNameFieldNames,\n            IdentityAutoFillConstants.FullNameFieldNameValues,\n          )\n        ) {\n          fillFields.name = f;\n          break;\n        } else if (\n          !fillFields.firstName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.FirstnameFieldNames)\n        ) {\n          fillFields.firstName = f;\n          break;\n        } else if (\n          !fillFields.middleName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.MiddlenameFieldNames)\n        ) {\n          fillFields.middleName = f;\n          break;\n        } else if (\n          !fillFields.lastName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.LastnameFieldNames)\n        ) {\n          fillFields.lastName = f;\n          break;\n        } else if (\n          !fillFields.title &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.TitleFieldNames)\n        ) {\n          fillFields.title = f;\n          break;\n        } else if (\n          !fillFields.email &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.EmailFieldNames)\n        ) {\n          fillFields.email = f;\n          break;\n        } else if (\n          !fillFields.address &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            IdentityAutoFillConstants.AddressFieldNames,\n            IdentityAutoFillConstants.AddressFieldNameValues,\n          )\n        ) {\n          fillFields.address = f;\n          break;\n        } else if (\n          !fillFields.address1 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address1FieldNames)\n        ) {\n          fillFields.address1 = f;\n          break;\n        } else if (\n          !fillFields.address2 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address2FieldNames)\n        ) {\n          fillFields.address2 = f;\n          break;\n        } else if (\n          !fillFields.address3 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address3FieldNames)\n        ) {\n          fillFields.address3 = f;\n          break;\n        } else if (\n          !fillFields.postalCode &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.PostalCodeFieldNames)\n        ) {\n          fillFields.postalCode = f;\n          break;\n        } else if (\n          !fillFields.city &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CityFieldNames)\n        ) {\n          fillFields.city = f;\n          break;\n        } else if (\n          !fillFields.state &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.StateFieldNames)\n        ) {\n          fillFields.state = f;\n          break;\n        } else if (\n          !fillFields.country &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CountryFieldNames)\n        ) {\n          fillFields.country = f;\n          break;\n        } else if (\n          !fillFields.phone &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.PhoneFieldNames)\n        ) {\n          fillFields.phone = f;\n          break;\n        } else if (\n          !fillFields.username &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.UserNameFieldNames)\n        ) {\n          fillFields.username = f;\n          break;\n        } else if (\n          !fillFields.company &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CompanyFieldNames)\n        ) {\n          fillFields.company = f;\n          break;\n        }\n      }\n    });\n\n    const identity = options.cipher.identity;\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"title\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"firstName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"middleName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"lastName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address1\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address2\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address3\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"city\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"postalCode\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"company\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"email\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"phone\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"username\");\n\n    let filledState = false;\n    if (fillFields.state && identity.state && identity.state.length > 2) {\n      const stateLower = identity.state.toLowerCase();\n      const isoState =\n        IdentityAutoFillConstants.IsoStates[stateLower] ||\n        IdentityAutoFillConstants.IsoProvinces[stateLower];\n      if (isoState) {\n        filledState = true;\n        this.makeScriptActionWithValue(fillScript, isoState, fillFields.state, filledFields);\n      }\n    }\n\n    if (!filledState) {\n      this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"state\");\n    }\n\n    let filledCountry = false;\n    if (fillFields.country && identity.country && identity.country.length > 2) {\n      const countryLower = identity.country.toLowerCase();\n      const isoCountry = IdentityAutoFillConstants.IsoCountries[countryLower];\n      if (isoCountry) {\n        filledCountry = true;\n        this.makeScriptActionWithValue(fillScript, isoCountry, fillFields.country, filledFields);\n      }\n    }\n\n    if (!filledCountry) {\n      this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"country\");\n    }\n\n    if (fillFields.name && (identity.firstName || identity.lastName)) {\n      let fullName = \"\";\n      if (AutofillService.hasValue(identity.firstName)) {\n        fullName = identity.firstName;\n      }\n      if (AutofillService.hasValue(identity.middleName)) {\n        if (fullName !== \"\") {\n          fullName += \" \";\n        }\n        fullName += identity.middleName;\n      }\n      if (AutofillService.hasValue(identity.lastName)) {\n        if (fullName !== \"\") {\n          fullName += \" \";\n        }\n        fullName += identity.lastName;\n      }\n\n      this.makeScriptActionWithValue(fillScript, fullName, fillFields.name, filledFields);\n    }\n\n    if (fillFields.address && AutofillService.hasValue(identity.address1)) {\n      let address = \"\";\n      if (AutofillService.hasValue(identity.address1)) {\n        address = identity.address1;\n      }\n      if (AutofillService.hasValue(identity.address2)) {\n        if (address !== \"\") {\n          address += \", \";\n        }\n        address += identity.address2;\n      }\n      if (AutofillService.hasValue(identity.address3)) {\n        if (address !== \"\") {\n          address += \", \";\n        }\n        address += identity.address3;\n      }\n\n      this.makeScriptActionWithValue(fillScript, address, fillFields.address, filledFields);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Accepts an HTMLInputElement type value and a list of\n   * excluded types and returns true if the type is excluded.\n   * @param {string} type\n   * @param {string[]} excludedTypes\n   * @returns {boolean}\n   * @private\n   */\n  private static isExcludedType(type: string, excludedTypes: string[]) {\n    return excludedTypes.indexOf(type) > -1;\n  }\n\n  /**\n   * Identifies if a passed field contains text artifacts that identify it as a search field.\n   *\n   * @param field - The autofill field that we are validating as a search field\n   */\n  private static isSearchField(field: AutofillField) {\n    const matchFieldAttributeValues = [field.type, field.htmlName, field.htmlID, field.placeholder];\n    for (let attrIndex = 0; attrIndex < matchFieldAttributeValues.length; attrIndex++) {\n      if (!matchFieldAttributeValues[attrIndex]) {\n        continue;\n      }\n\n      // Separate camel case words and case them to lower case values\n      const camelCaseSeparatedFieldAttribute = matchFieldAttributeValues[attrIndex]\n        .replace(/([a-z])([A-Z])/g, \"$1 $2\")\n        .toLowerCase();\n      // Split the attribute by non-alphabetical characters to get the keywords\n      const attributeKeywords = camelCaseSeparatedFieldAttribute.split(/[^a-z]/gi);\n\n      for (let keywordIndex = 0; keywordIndex < attributeKeywords.length; keywordIndex++) {\n        if (AutofillService.searchFieldNamesSet.has(attributeKeywords[keywordIndex])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  static isExcludedFieldType(field: AutofillField, excludedTypes: string[]) {\n    if (AutofillService.forCustomFieldsOnly(field)) {\n      return true;\n    }\n\n    if (this.isExcludedType(field.type, excludedTypes)) {\n      return true;\n    }\n\n    // Check if the input is an untyped/mistyped search input\n    return this.isSearchField(field);\n  }\n\n  /**\n   * Accepts the value of a field, a list of possible options that define if\n   * a field can be matched to a vault cipher, and a secondary optional list\n   * of options that define if a field can be matched to a vault cipher. Returns\n   * true if the field value matches one of the options.\n   * @param {string} value\n   * @param {string[]} options\n   * @param {string[]} containsOptions\n   * @returns {boolean}\n   * @private\n   */\n  private static isFieldMatch(\n    value: string,\n    options: string[],\n    containsOptions?: string[],\n  ): boolean {\n    value = value\n      .trim()\n      .toLowerCase()\n      .replace(/[^a-zA-Z0-9]+/g, \"\");\n    for (let i = 0; i < options.length; i++) {\n      let option = options[i];\n      const checkValueContains = containsOptions == null || containsOptions.indexOf(option) > -1;\n      option = option.toLowerCase().replace(/-/g, \"\");\n      if (value === option || (checkValueContains && value.indexOf(option) > -1)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Helper method used to create a script action for a field. Conditionally\n   * accepts a fieldProp value that will be used in place of the dataProp value.\n   * @param {AutofillScript} fillScript\n   * @param cipherData\n   * @param {{[p: string]: AutofillField}} fillFields\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {string} dataProp\n   * @param {string} fieldProp\n   * @private\n   */\n  private makeScriptAction(\n    fillScript: AutofillScript,\n    cipherData: any,\n    fillFields: { [id: string]: AutofillField },\n    filledFields: { [id: string]: AutofillField },\n    dataProp: string,\n    fieldProp?: string,\n  ) {\n    fieldProp = fieldProp || dataProp;\n    this.makeScriptActionWithValue(\n      fillScript,\n      cipherData[dataProp],\n      fillFields[fieldProp],\n      filledFields,\n    );\n  }\n\n  /**\n   * Handles updating the list of filled fields and adding a script action\n   * to the fill script. If a select field is passed as part of the fill options,\n   * we iterate over the options to check if the passed value matches one of the\n   * options. If it does, we add a script action to select the option.\n   * @param {AutofillScript} fillScript\n   * @param dataValue\n   * @param {AutofillField} field\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @private\n   */\n  private makeScriptActionWithValue(\n    fillScript: AutofillScript,\n    dataValue: any,\n    field: AutofillField,\n    filledFields: { [id: string]: AutofillField },\n  ) {\n    let doFill = false;\n    if (AutofillService.hasValue(dataValue) && field) {\n      if (field.type === \"select-one\" && field.selectInfo && field.selectInfo.options) {\n        for (let i = 0; i < field.selectInfo.options.length; i++) {\n          const option = field.selectInfo.options[i];\n          for (let j = 0; j < option.length; j++) {\n            if (\n              AutofillService.hasValue(option[j]) &&\n              option[j].toLowerCase() === dataValue.toLowerCase()\n            ) {\n              doFill = true;\n              if (option.length > 1) {\n                dataValue = option[1];\n              }\n              break;\n            }\n          }\n\n          if (doFill) {\n            break;\n          }\n        }\n      } else {\n        doFill = true;\n      }\n    }\n\n    if (doFill) {\n      filledFields[field.opid] = field;\n      AutofillService.fillByOpid(fillScript, field, dataValue);\n    }\n  }\n\n  static valueIsLikePassword(value: string) {\n    if (value == null) {\n      return false;\n    }\n    // Removes all whitespace, _ and - characters\n    const cleanedValue = value.toLowerCase().replace(/[\\s_-]/g, \"\");\n\n    if (cleanedValue.indexOf(\"password\") < 0) {\n      return false;\n    }\n\n    return !AutoFillConstants.PasswordFieldExcludeList.some((i) => cleanedValue.indexOf(i) > -1);\n  }\n\n  static fieldHasDisqualifyingAttributeValue(field: AutofillField) {\n    const checkedAttributeValues = [field.htmlID, field.htmlName, field.placeholder];\n    let valueIsOnExclusionList = false;\n\n    for (let i = 0; i < checkedAttributeValues.length; i++) {\n      const checkedAttributeValue = checkedAttributeValues[i];\n      const cleanedValue = checkedAttributeValue?.toLowerCase().replace(/[\\s_-]/g, \"\");\n\n      valueIsOnExclusionList = Boolean(\n        cleanedValue && AutoFillConstants.FieldIgnoreList.some((i) => cleanedValue.indexOf(i) > -1),\n      );\n\n      if (valueIsOnExclusionList) {\n        break;\n      }\n    }\n\n    return valueIsOnExclusionList;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be password fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} mustBeEmpty\n   * @param {boolean} fillNewPassword\n   * @returns {AutofillField[]}\n   */\n  static loadPasswordFields(\n    pageDetails: AutofillPageDetails,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    mustBeEmpty: boolean,\n    fillNewPassword: boolean,\n  ) {\n    const arr: AutofillField[] = [];\n\n    pageDetails.fields.forEach((f) => {\n      const isPassword = f.type === \"password\";\n      if (\n        !isPassword &&\n        AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillLoginTypes)\n      ) {\n        return;\n      }\n\n      // If any attribute values match disqualifying values, the entire field should not be used\n      if (AutofillService.fieldHasDisqualifyingAttributeValue(f)) {\n        return;\n      }\n\n      const isLikePassword = () => {\n        if (f.type !== \"text\") {\n          return false;\n        }\n\n        const testedValues = [f.htmlID, f.htmlName, f.placeholder];\n        for (let i = 0; i < testedValues.length; i++) {\n          if (AutofillService.valueIsLikePassword(testedValues[i])) {\n            return true;\n          }\n        }\n\n        return false;\n      };\n\n      if (\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (isPassword || isLikePassword()) &&\n        (canBeHidden || f.viewable) &&\n        (!mustBeEmpty || f.value == null || f.value.trim() === \"\") &&\n        (fillNewPassword || f.autoCompleteType !== \"new-password\")\n      ) {\n        arr.push(f);\n      }\n    });\n\n    return arr;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be username fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {AutofillField} passwordField\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} withoutForm\n   * @returns {AutofillField}\n   * @private\n   */\n  private findUsernameField(\n    pageDetails: AutofillPageDetails,\n    passwordField: AutofillField,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    withoutForm: boolean,\n  ): AutofillField | null {\n    let usernameField: AutofillField = null;\n    for (let i = 0; i < pageDetails.fields.length; i++) {\n      const f = pageDetails.fields[i];\n      if (AutofillService.forCustomFieldsOnly(f)) {\n        continue;\n      }\n\n      if (f.elementNumber >= passwordField.elementNumber) {\n        break;\n      }\n\n      if (\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (withoutForm || f.form === passwordField.form) &&\n        (canBeHidden || f.viewable) &&\n        (f.type === \"text\" || f.type === \"email\" || f.type === \"tel\")\n      ) {\n        usernameField = f;\n\n        if (this.findMatchingFieldIndex(f, AutoFillConstants.UsernameFieldNames) > -1) {\n          // We found an exact match. No need to keep looking.\n          break;\n        }\n      }\n    }\n\n    return usernameField;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be TOTP fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {AutofillField} passwordField\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} withoutForm\n   * @returns {AutofillField}\n   * @private\n   */\n  private findTotpField(\n    pageDetails: AutofillPageDetails,\n    passwordField: AutofillField,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    withoutForm: boolean,\n  ): AutofillField | null {\n    let totpField: AutofillField = null;\n    for (let i = 0; i < pageDetails.fields.length; i++) {\n      const f = pageDetails.fields[i];\n      if (AutofillService.forCustomFieldsOnly(f)) {\n        continue;\n      }\n\n      const fieldIsDisqualified = AutofillService.fieldHasDisqualifyingAttributeValue(f);\n\n      if (\n        !fieldIsDisqualified &&\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (withoutForm || f.form === passwordField.form) &&\n        (canBeHidden || f.viewable) &&\n        (f.type === \"text\" || f.type === \"number\") &&\n        AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.TotpFieldNames)\n      ) {\n        totpField = f;\n\n        if (\n          this.findMatchingFieldIndex(f, AutoFillConstants.TotpFieldNames) > -1 ||\n          f.autoCompleteType === \"one-time-code\"\n        ) {\n          // We found an exact match. No need to keep looking.\n          break;\n        }\n      }\n    }\n\n    return totpField;\n  }\n\n  /**\n   * Accepts a field and returns the index of the first matching property\n   * present in a list of attribute names.\n   * @param {AutofillField} field\n   * @param {string[]} names\n   * @returns {number}\n   * @private\n   */\n  private findMatchingFieldIndex(field: AutofillField, names: string[]): number {\n    for (let i = 0; i < names.length; i++) {\n      if (names[i].indexOf(\"=\") > -1) {\n        if (this.fieldPropertyIsPrefixMatch(field, \"htmlID\", names[i], \"id\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"htmlName\", names[i], \"name\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-left\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-right\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-tag\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-aria\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"placeholder\", names[i], \"placeholder\")) {\n          return i;\n        }\n      }\n\n      if (this.fieldPropertyIsMatch(field, \"htmlID\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"htmlName\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-left\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-right\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-tag\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-aria\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"placeholder\", names[i])) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /**\n   * Accepts a field, property, name, and prefix and returns true if the field\n   * contains a value that matches the given prefixed property.\n   * @param field\n   * @param {string} property\n   * @param {string} name\n   * @param {string} prefix\n   * @param {string} separator\n   * @returns {boolean}\n   * @private\n   */\n  private fieldPropertyIsPrefixMatch(\n    field: any,\n    property: string,\n    name: string,\n    prefix: string,\n    separator = \"=\",\n  ): boolean {\n    if (name.indexOf(prefix + separator) === 0) {\n      const sepIndex = name.indexOf(separator);\n      const val = name.substring(sepIndex + 1);\n      return val != null && this.fieldPropertyIsMatch(field, property, val);\n    }\n    return false;\n  }\n\n  /**\n   * Identifies if a given property within a field matches the value\n   * of the passed \"name\" parameter. If the name starts with \"regex=\",\n   * the value is tested against a case-insensitive regular expression.\n   * If the name starts with \"csv=\", the value is treated as a\n   * comma-separated list of values to match.\n   * @param field\n   * @param {string} property\n   * @param {string} name\n   * @returns {boolean}\n   * @private\n   */\n  private fieldPropertyIsMatch(field: any, property: string, name: string): boolean {\n    let fieldVal = field[property] as string;\n    if (!AutofillService.hasValue(fieldVal)) {\n      return false;\n    }\n\n    fieldVal = fieldVal.trim().replace(/(?:\\r\\n|\\r|\\n)/g, \"\");\n    if (name.startsWith(\"regex=\")) {\n      try {\n        const regexParts = name.split(\"=\", 2);\n        if (regexParts.length === 2) {\n          const regex = new RegExp(regexParts[1], \"i\");\n          return regex.test(fieldVal);\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    } else if (name.startsWith(\"csv=\")) {\n      const csvParts = name.split(\"=\", 2);\n      if (csvParts.length === 2) {\n        const csvVals = csvParts[1].split(\",\");\n        for (let i = 0; i < csvVals.length; i++) {\n          const val = csvVals[i];\n          if (val != null && val.trim().toLowerCase() === fieldVal.toLowerCase()) {\n            return true;\n          }\n        }\n        return false;\n      }\n    }\n\n    return fieldVal.toLowerCase() === name;\n  }\n\n  /**\n   * Accepts a field and returns true if the field contains a\n   * value that matches any of the names in the provided list.\n   * @param {AutofillField} field\n   * @param {string[]} names\n   * @returns {boolean}\n   */\n  static fieldIsFuzzyMatch(field: AutofillField, names: string[]): boolean {\n    if (AutofillService.hasValue(field.htmlID) && this.fuzzyMatch(names, field.htmlID)) {\n      return true;\n    }\n    if (AutofillService.hasValue(field.htmlName) && this.fuzzyMatch(names, field.htmlName)) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-tag\"]) &&\n      this.fuzzyMatch(names, field[\"label-tag\"])\n    ) {\n      return true;\n    }\n    if (AutofillService.hasValue(field.placeholder) && this.fuzzyMatch(names, field.placeholder)) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-left\"]) &&\n      this.fuzzyMatch(names, field[\"label-left\"])\n    ) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-top\"]) &&\n      this.fuzzyMatch(names, field[\"label-top\"])\n    ) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-aria\"]) &&\n      this.fuzzyMatch(names, field[\"label-aria\"])\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Accepts a list of options and a value and returns\n   * true if the value matches any of the options.\n   * @param {string[]} options\n   * @param {string} value\n   * @returns {boolean}\n   * @private\n   */\n  private static fuzzyMatch(options: string[], value: string): boolean {\n    if (options == null || options.length === 0 || value == null || value === \"\") {\n      return false;\n    }\n\n    value = value\n      .replace(/(?:\\r\\n|\\r|\\n)/g, \"\")\n      .trim()\n      .toLowerCase();\n\n    for (let i = 0; i < options.length; i++) {\n      if (value.indexOf(options[i]) > -1) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Accepts a string and returns true if the\n   * string is not falsy and not empty.\n   * @param {string} str\n   * @returns {boolean}\n   */\n  static hasValue(str: string): boolean {\n    return Boolean(str && str !== \"\");\n  }\n\n  /**\n   * Sets the `focus_by_opid` autofill script\n   * action to the last field that was filled.\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {AutofillScript} fillScript\n   * @returns {AutofillScript}\n   */\n  static setFillScriptForFocus(\n    filledFields: { [id: string]: AutofillField },\n    fillScript: AutofillScript,\n  ): AutofillScript {\n    let lastField: AutofillField = null;\n    let lastPasswordField: AutofillField = null;\n\n    for (const opid in filledFields) {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(opid) && filledFields[opid].viewable) {\n        lastField = filledFields[opid];\n\n        if (filledFields[opid].type === \"password\") {\n          lastPasswordField = filledFields[opid];\n        }\n      }\n    }\n\n    // Prioritize password field over others.\n    if (lastPasswordField) {\n      fillScript.script.push([\"focus_by_opid\", lastPasswordField.opid]);\n    } else if (lastField) {\n      fillScript.script.push([\"focus_by_opid\", lastField.opid]);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Updates a fill script to place the `cilck_on_opid`, `focus_on_opid`, and `fill_by_opid`\n   * fill script actions associated with the provided field.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillField} field\n   * @param {string} value\n   */\n  static fillByOpid(fillScript: AutofillScript, field: AutofillField, value: string): void {\n    if (field.maxLength && value && value.length > field.maxLength) {\n      value = value.substr(0, value.length);\n    }\n    if (field.tagName !== \"span\") {\n      fillScript.script.push([\"click_on_opid\", field.opid]);\n      fillScript.script.push([\"focus_by_opid\", field.opid]);\n    }\n    fillScript.script.push([\"fill_by_opid\", field.opid, value]);\n  }\n\n  /**\n   * Identifies if the field is a custom field, a custom\n   * field is defined as a field that is a `span` element.\n   * @param {AutofillField} field\n   * @returns {boolean}\n   */\n  static forCustomFieldsOnly(field: AutofillField): boolean {\n    return field.tagName === \"span\";\n  }\n\n  /**\n   * Handles debouncing the opening of the master password reprompt popout.\n   */\n  private isDebouncingPasswordRepromptPopout() {\n    if (this.currentlyOpeningPasswordRepromptPopout) {\n      return true;\n    }\n\n    this.currentlyOpeningPasswordRepromptPopout = true;\n    clearTimeout(this.openPasswordRepromptPopoutDebounce);\n\n    this.openPasswordRepromptPopoutDebounce = setTimeout(() => {\n      this.currentlyOpeningPasswordRepromptPopout = false;\n    }, 100);\n\n    return false;\n  }\n\n  /**\n   * Handles incoming long-lived connections from injected autofill scripts.\n   * Stores the port in a set to facilitate disconnecting ports if the extension\n   * needs to re-inject the autofill scripts.\n   *\n   * @param port - The port that was connected\n   */\n  private handleInjectedScriptPortConnection = (port: chrome.runtime.Port) => {\n    if (port.name !== AutofillPort.InjectedScript) {\n      return;\n    }\n\n    this.autofillScriptPortsSet.add(port);\n    port.onDisconnect.addListener(this.handleInjectScriptPortOnDisconnect);\n  };\n\n  /**\n   * Handles disconnecting ports that relate to injected autofill scripts.\n\n   * @param port - The port that was disconnected\n   */\n  private handleInjectScriptPortOnDisconnect = (port: chrome.runtime.Port) => {\n    if (port.name !== AutofillPort.InjectedScript) {\n      return;\n    }\n\n    this.autofillScriptPortsSet.delete(port);\n  };\n\n  /**\n   * Queries all open tabs in the user's browsing session\n   * and injects the autofill scripts into the page.\n   */\n  private async injectAutofillScriptsInAllTabs() {\n    const tabs = await BrowserApi.tabsQuery({});\n    for (let index = 0; index < tabs.length; index++) {\n      const tab = tabs[index];\n      if (tab.url?.startsWith(\"http\")) {\n        void this.injectAutofillScripts(tab, 0, false);\n      }\n    }\n  }\n\n  /**\n   * Updates the autofill inline menu visibility setting in all active tabs\n   * when the InlineMenuVisibilitySetting observable is updated.\n   *\n   * @param previousSetting - The previous setting value\n   * @param currentSetting - The current setting value\n   */\n  private async handleInlineMenuVisibilityChange(\n    previousSetting: InlineMenuVisibilitySetting,\n    currentSetting: InlineMenuVisibilitySetting,\n  ) {\n    if (previousSetting === undefined || previousSetting === currentSetting) {\n      return;\n    }\n\n    const inlineMenuPreviouslyDisabled = previousSetting === AutofillOverlayVisibility.Off;\n    const inlineMenuCurrentlyDisabled = currentSetting === AutofillOverlayVisibility.Off;\n    if (!inlineMenuPreviouslyDisabled && !inlineMenuCurrentlyDisabled) {\n      const tabs = await BrowserApi.tabsQuery({});\n      tabs.forEach((tab) =>\n        BrowserApi.tabSendMessageData(tab, \"updateAutofillOverlayVisibility\", {\n          autofillOverlayVisibility: currentSetting,\n        }),\n      );\n      return;\n    }\n\n    await this.reloadAutofillScripts();\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nexport class BrowserComponentState {\n  scrollY: number;\n  searchText: string;\n\n  static fromJSON(json: Jsonify<BrowserComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserComponentState(), json);\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { DeepJsonify } from \"@bitwarden/common/types/deep-jsonify\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\n\nexport class BrowserGroupingsComponentState extends BrowserComponentState {\n  favoriteCiphers: CipherView[];\n  noFolderCiphers: CipherView[];\n  ciphers: CipherView[];\n  collectionCounts: Map<string, number>;\n  folderCounts: Map<string, number>;\n  typeCounts: Map<CipherType, number>;\n  folders: FolderView[];\n  collections: CollectionView[];\n  deletedCount: number;\n\n  toJSON() {\n    return Utils.merge(this, {\n      collectionCounts: Utils.mapToRecord(this.collectionCounts),\n      folderCounts: Utils.mapToRecord(this.folderCounts),\n      typeCounts: Utils.mapToRecord(this.typeCounts),\n    });\n  }\n\n  static fromJSON(json: DeepJsonify<BrowserGroupingsComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserGroupingsComponentState(), json, {\n      favoriteCiphers: json.favoriteCiphers?.map((c) => CipherView.fromJSON(c)),\n      noFolderCiphers: json.noFolderCiphers?.map((c) => CipherView.fromJSON(c)),\n      ciphers: json.ciphers?.map((c) => CipherView.fromJSON(c)),\n      collectionCounts: Utils.recordToMap(json.collectionCounts),\n      folderCounts: Utils.recordToMap(json.folderCounts),\n      typeCounts: Utils.recordToMap(json.typeCounts),\n      folders: json.folders?.map((f) => FolderView.fromJSON(f)),\n    });\n  }\n}\n","import { SendView } from \"@bitwarden/common/tools/send/models/view/send.view\";\nimport { DeepJsonify } from \"@bitwarden/common/types/deep-jsonify\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\n\nexport class BrowserSendComponentState extends BrowserComponentState {\n  sends: SendView[];\n\n  static fromJSON(json: DeepJsonify<BrowserSendComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserSendComponentState(), json, {\n      sends: json.sends?.map((s) => SendView.fromJSON(s)),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Account as BaseAccount } from \"@bitwarden/common/platform/models/domain/account\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\nimport { BrowserGroupingsComponentState } from \"./browserGroupingsComponentState\";\nimport { BrowserSendComponentState } from \"./browserSendComponentState\";\n\nexport class Account extends BaseAccount {\n  groupings?: BrowserGroupingsComponentState;\n  send?: BrowserSendComponentState;\n  ciphers?: BrowserComponentState;\n  sendType?: BrowserComponentState;\n\n  constructor(init: Partial<Account>) {\n    super(init);\n\n    this.groupings = init?.groupings ?? new BrowserGroupingsComponentState();\n    this.send = init?.send ?? new BrowserSendComponentState();\n    this.ciphers = init?.ciphers ?? new BrowserComponentState();\n    this.sendType = init?.sendType ?? new BrowserComponentState();\n  }\n\n  static fromJSON(json: Jsonify<Account>): Account {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Account({}), json, super.fromJSON(json), {\n      groupings: BrowserGroupingsComponentState.fromJSON(json.groupings),\n      send: BrowserSendComponentState.fromJSON(json.send),\n      ciphers: BrowserComponentState.fromJSON(json.ciphers),\n      sendType: BrowserComponentState.fromJSON(json.sendType),\n    });\n  }\n}\n","import {\n  flagEnabled as baseFlagEnabled,\n  devFlagEnabled as baseDevFlagEnabled,\n  devFlagValue as baseDevFlagValue,\n  SharedFlags,\n  SharedDevFlags,\n} from \"@bitwarden/common/platform/misc/flags\";\n\nimport { GroupPolicyEnvironment } from \"../admin-console/types/group-policy-environment\";\n\nimport { BrowserApi } from \"./browser/browser-api\";\n\n// required to avoid linting errors when there are no flags\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Flags = {\n  accountSwitching?: boolean;\n} & SharedFlags;\n\n// required to avoid linting errors when there are no flags\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type DevFlags = {\n  managedEnvironment?: GroupPolicyEnvironment;\n} & SharedDevFlags;\n\nexport function flagEnabled(flag: keyof Flags): boolean {\n  return baseFlagEnabled<Flags>(flag);\n}\n\nexport function devFlagEnabled(flag: keyof DevFlags) {\n  return baseDevFlagEnabled<DevFlags>(flag);\n}\n\nexport function devFlagValue(flag: keyof DevFlags) {\n  return baseDevFlagValue(flag);\n}\n\n/** Helper method to sync flag specifically for account switching, which as platform-based values.\n * If this pattern needs to be repeated, it's better handled by increasing complexity of webpack configurations\n * Not by expanding these flag getters.\n */\nexport function enableAccountSwitching(): boolean {\n  if (BrowserApi.isSafariApi) {\n    return false;\n  }\n  return flagEnabled(\"accountSwitching\");\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { BadgeSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/badge-settings.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\n\nimport MainBackground from \"../../background/main.background\";\nimport IconDetails from \"../../vault/background/models/icon-details\";\nimport { BrowserApi } from \"../browser/browser-api\";\nimport { BrowserPlatformUtilsService } from \"../services/platform-utils/browser-platform-utils.service\";\n\nexport type BadgeOptions = {\n  tab?: chrome.tabs.Tab;\n  windowId?: number;\n};\n\nexport class UpdateBadge {\n  private authService: AuthService;\n  private badgeSettingsService: BadgeSettingsServiceAbstraction;\n  private cipherService: CipherService;\n  private badgeAction: typeof chrome.action | typeof chrome.browserAction;\n  private sidebarAction: OperaSidebarAction | FirefoxSidebarAction;\n  private win: Window & typeof globalThis;\n\n  constructor(win: Window & typeof globalThis, services: MainBackground) {\n    this.badgeAction = BrowserApi.getBrowserAction();\n    this.sidebarAction = BrowserApi.getSidebarAction(self);\n    this.win = win;\n\n    this.badgeSettingsService = services.badgeSettingsService;\n    this.authService = services.authService;\n    this.cipherService = services.cipherService;\n  }\n\n  async run(opts?: { tabId?: number; windowId?: number }): Promise<void> {\n    const authStatus = await this.authService.getAuthStatus();\n\n    await this.setBadgeBackgroundColor();\n\n    switch (authStatus) {\n      case AuthenticationStatus.LoggedOut: {\n        await this.setLoggedOut();\n        break;\n      }\n      case AuthenticationStatus.Locked: {\n        await this.setLocked();\n        break;\n      }\n      case AuthenticationStatus.Unlocked: {\n        const tab = await this.getTab(opts?.tabId, opts?.windowId);\n        await this.setUnlocked({ tab, windowId: tab?.windowId });\n        break;\n      }\n    }\n  }\n\n  async setLoggedOut(): Promise<void> {\n    await this.setBadgeIcon(\"_gray\");\n    await this.clearBadgeText();\n  }\n\n  async setLocked() {\n    await this.setBadgeIcon(\"_locked\");\n    await this.clearBadgeText();\n  }\n\n  private async clearBadgeText() {\n    const tabs = await BrowserApi.getActiveTabs();\n    if (tabs != null) {\n      tabs.forEach(async (tab) => {\n        if (tab.id != null) {\n          await this.setBadgeText(\"\", tab.id);\n        }\n      });\n    }\n  }\n\n  async setUnlocked(opts: BadgeOptions) {\n    await this.setBadgeIcon(\"\");\n\n    const enableBadgeCounter = await firstValueFrom(this.badgeSettingsService.enableBadgeCounter$);\n    if (!enableBadgeCounter) {\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(opts?.tab?.url);\n    let countText = ciphers.length == 0 ? \"\" : ciphers.length.toString();\n    if (ciphers.length > 9) {\n      countText = \"9+\";\n    }\n    await this.setBadgeText(countText, opts?.tab?.id);\n  }\n\n  setBadgeBackgroundColor(color = \"#294e5f\") {\n    if (this.badgeAction?.setBadgeBackgroundColor) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setBadgeBackgroundColor({ color });\n    }\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      this.sidebarAction.setBadgeBackgroundColor({ color });\n    }\n  }\n\n  setBadgeText(text: string, tabId?: number) {\n    this.setActionText(text, tabId);\n    this.setSideBarText(text, tabId);\n  }\n\n  async setBadgeIcon(iconSuffix: string, windowId?: number) {\n    const options: IconDetails = {\n      path: {\n        19: \"/images/icon19\" + iconSuffix + \".png\",\n        38: \"/images/icon38\" + iconSuffix + \".png\",\n      },\n    };\n    if (windowId && BrowserPlatformUtilsService.isFirefox()) {\n      options.windowId = windowId;\n    }\n\n    await this.setActionIcon(options);\n    await this.setSidebarActionIcon(options);\n  }\n\n  private setActionText(text: string, tabId?: number) {\n    if (this.badgeAction?.setBadgeText) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setBadgeText({ text, tabId });\n    }\n  }\n\n  private setSideBarText(text: string, tabId?: number) {\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      this.sidebarAction.setBadgeText({ text, tabId });\n    } else if (this.sidebarAction) {\n      // Firefox\n      const title = `Bitwarden${Utils.isNullOrEmpty(text) ? \"\" : ` [${text}]`}`;\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.sidebarAction.setTitle({ title, tabId });\n    }\n  }\n\n  private async setActionIcon(options: IconDetails) {\n    if (!this.badgeAction?.setIcon) {\n      return;\n    }\n\n    if (this.useSyncApiCalls) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setIcon(options);\n    } else {\n      await new Promise<void>((resolve) => this.badgeAction.setIcon(options, () => resolve()));\n    }\n  }\n\n  private async setSidebarActionIcon(options: IconDetails) {\n    if (!this.sidebarAction?.setIcon) {\n      return;\n    }\n\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      await new Promise<void>((resolve) =>\n        (this.sidebarAction as OperaSidebarAction).setIcon(options, () => resolve()),\n      );\n    } else {\n      await this.sidebarAction.setIcon(options);\n    }\n  }\n\n  private async getTab(tabId?: number, windowId?: number) {\n    return (\n      (await BrowserApi.getTab(tabId)) ??\n      (windowId\n        ? await BrowserApi.tabsQueryFirst({ active: true, windowId })\n        : await BrowserApi.tabsQueryFirst({ active: true, currentWindow: true })) ??\n      (await BrowserApi.tabsQueryFirst({ active: true, lastFocusedWindow: true })) ??\n      (await BrowserApi.tabsQueryFirst({ active: true }))\n    );\n  }\n\n  private get useSyncApiCalls() {\n    return (\n      BrowserPlatformUtilsService.isFirefox() || BrowserPlatformUtilsService.isSafari(this.win)\n    );\n  }\n\n  private isOperaSidebar(\n    action: OperaSidebarAction | FirefoxSidebarAction,\n  ): action is OperaSidebarAction {\n    return action != null && (action as OperaSidebarAction).setBadgeText != null;\n  }\n}\n","import { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { CommandDefinition, MessageSender } from \"@bitwarden/common/platform/messaging\";\nimport { getCommand } from \"@bitwarden/common/platform/messaging/internal\";\n\ntype ErrorHandler = (logger: LogService, command: string) => void;\n\nconst HANDLED_ERRORS: Record<string, ErrorHandler> = {\n  \"Could not establish connection. Receiving end does not exist.\": (logger, command) =>\n    logger.debug(`Receiving end didn't exist for command '${command}'`),\n\n  \"The message port closed before a response was received.\": (logger, command) =>\n    logger.debug(`Port was closed for command '${command}'`),\n};\n\nexport class ChromeMessageSender implements MessageSender {\n  constructor(private readonly logService: LogService) {}\n\n  send<T extends Record<string, unknown>>(\n    commandDefinition: string | CommandDefinition<T>,\n    payload: Record<string, unknown> | T = {},\n  ): void {\n    const command = getCommand(commandDefinition);\n    chrome.runtime.sendMessage(Object.assign(payload, { command: command }), () => {\n      if (chrome.runtime.lastError) {\n        const errorHandler = HANDLED_ERRORS[chrome.runtime.lastError.message];\n        if (errorHandler != null) {\n          errorHandler(this.logService, command);\n          return;\n        }\n\n        this.logService.warning(\n          `Unhandled error while sending message with command '${command}': ${chrome.runtime.lastError.message}`,\n        );\n      }\n    });\n  }\n}\n","import { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\n\nimport { OffscreenDocumentService } from \"./abstractions/offscreen-document\";\n\nexport class DefaultOffscreenDocumentService implements OffscreenDocumentService {\n  private workerCount = 0;\n\n  constructor(private logService: LogService) {}\n\n  offscreenApiSupported(): boolean {\n    return typeof chrome.offscreen !== \"undefined\";\n  }\n\n  async withDocument<T>(\n    reasons: chrome.offscreen.Reason[],\n    justification: string,\n    callback: () => Promise<T> | T,\n  ): Promise<T> {\n    this.workerCount++;\n    try {\n      if (!(await this.documentExists())) {\n        await this.create(reasons, justification);\n      }\n\n      return await callback();\n    } finally {\n      this.workerCount--;\n      if (this.workerCount === 0) {\n        await this.close();\n      }\n    }\n  }\n\n  private async create(reasons: chrome.offscreen.Reason[], justification: string): Promise<void> {\n    try {\n      await chrome.offscreen.createDocument({\n        url: \"offscreen-document/index.html\",\n        reasons,\n        justification,\n      });\n    } catch (e) {\n      // gobble multiple offscreen document creation errors\n      // TODO: remove this when the offscreen document service is fixed PM-8014\n      if (e.message === \"Only a single offscreen document may be created.\") {\n        this.logService.info(\"Ignoring offscreen document creation error.\");\n        return;\n      }\n      throw e;\n    }\n  }\n\n  private async close(): Promise<void> {\n    await chrome.offscreen.closeDocument();\n  }\n\n  private async documentExists(): Promise<boolean> {\n    return await chrome.offscreen.hasDocument();\n  }\n}\n","import { EncryptService } from \"../../../platform/abstractions/encrypt.service\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { OrgKey, UserPrivateKey } from \"../../../types/key\";\nimport { EncryptedOrganizationKeyData } from \"../data/encrypted-organization-key.data\";\n\nexport abstract class BaseEncryptedOrganizationKey {\n  abstract get encryptedOrganizationKey(): EncString;\n\n  static fromData(data: EncryptedOrganizationKeyData) {\n    switch (data.type) {\n      case \"organization\":\n        return new EncryptedOrganizationKey(data.key);\n\n      case \"provider\":\n        return new ProviderEncryptedOrganizationKey(data.key, data.providerId);\n\n      default:\n        return null;\n    }\n  }\n\n  static isProviderEncrypted(\n    key: EncryptedOrganizationKey | ProviderEncryptedOrganizationKey,\n  ): key is ProviderEncryptedOrganizationKey {\n    return key.toData().type === \"provider\";\n  }\n}\n\nexport class EncryptedOrganizationKey implements BaseEncryptedOrganizationKey {\n  constructor(private key: string) {}\n\n  async decrypt(encryptService: EncryptService, privateKey: UserPrivateKey) {\n    const decValue = await encryptService.rsaDecrypt(this.encryptedOrganizationKey, privateKey);\n    return new SymmetricCryptoKey(decValue) as OrgKey;\n  }\n\n  get encryptedOrganizationKey() {\n    return new EncString(this.key);\n  }\n\n  toData(): EncryptedOrganizationKeyData {\n    return {\n      type: \"organization\",\n      key: this.key,\n    };\n  }\n}\n\nexport class ProviderEncryptedOrganizationKey implements BaseEncryptedOrganizationKey {\n  constructor(\n    private key: string,\n    private providerId: string,\n  ) {}\n\n  async decrypt(encryptService: EncryptService, providerKeys: Record<string, SymmetricCryptoKey>) {\n    const decValue = await encryptService.decryptToBytes(\n      new EncString(this.key),\n      providerKeys[this.providerId],\n    );\n    return new SymmetricCryptoKey(decValue) as OrgKey;\n  }\n\n  get encryptedOrganizationKey() {\n    return new EncString(this.key);\n  }\n\n  toData(): EncryptedOrganizationKeyData {\n    return {\n      type: \"provider\",\n      key: this.key,\n      providerId: this.providerId,\n    };\n  }\n}\n","import { EncryptedOrganizationKeyData } from \"../../../admin-console/models/data/encrypted-organization-key.data\";\nimport { OrganizationId } from \"../../../types/guid\";\nimport { CRYPTO_DISK, UserKeyDefinition } from \"../../state\";\n\nexport const USER_ENCRYPTED_ORGANIZATION_KEYS = UserKeyDefinition.record<\n  EncryptedOrganizationKeyData,\n  OrganizationId\n>(CRYPTO_DISK, \"organizationKeys\", {\n  deserializer: (obj) => obj,\n  clearOn: [\"logout\"],\n});\n","import { ProviderId } from \"../../../types/guid\";\nimport { EncryptedString } from \"../../models/domain/enc-string\";\nimport { CRYPTO_DISK, UserKeyDefinition } from \"../../state\";\n\nexport const USER_ENCRYPTED_PROVIDER_KEYS = UserKeyDefinition.record<EncryptedString, ProviderId>(\n  CRYPTO_DISK,\n  \"providerKeys\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"logout\"],\n  },\n);\n","import { UserKey } from \"../../../types/key\";\nimport { EncryptedString } from \"../../models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\nimport { CRYPTO_DISK, CRYPTO_MEMORY, UserKeyDefinition } from \"../../state\";\n\nexport const USER_EVER_HAD_USER_KEY = new UserKeyDefinition<boolean>(\n  CRYPTO_DISK,\n  \"everHadUserKey\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const USER_ENCRYPTED_PRIVATE_KEY = new UserKeyDefinition<EncryptedString>(\n  CRYPTO_DISK,\n  \"privateKey\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const USER_KEY = new UserKeyDefinition<UserKey>(CRYPTO_MEMORY, \"userKey\", {\n  deserializer: (obj) => SymmetricCryptoKey.fromJSON(obj) as UserKey,\n  clearOn: [\"logout\", \"lock\"],\n});\n","import * as bigInt from \"big-integer\";\nimport {\n  NEVER,\n  Observable,\n  combineLatest,\n  firstValueFrom,\n  forkJoin,\n  map,\n  of,\n  switchMap,\n} from \"rxjs\";\n\nimport { PinServiceAbstraction } from \"../../../../auth/src/common/abstractions\";\nimport { EncryptedOrganizationKeyData } from \"../../admin-console/models/data/encrypted-organization-key.data\";\nimport { BaseEncryptedOrganizationKey } from \"../../admin-console/models/domain/encrypted-organization-key\";\nimport { ProfileOrganizationResponse } from \"../../admin-console/models/response/profile-organization.response\";\nimport { ProfileProviderOrganizationResponse } from \"../../admin-console/models/response/profile-provider-organization.response\";\nimport { ProfileProviderResponse } from \"../../admin-console/models/response/profile-provider.response\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { KdfConfigService } from \"../../auth/abstractions/kdf-config.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../../auth/abstractions/master-password.service.abstraction\";\nimport { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { VAULT_TIMEOUT } from \"../../services/vault-timeout/vault-timeout-settings.state\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { OrganizationId, ProviderId, UserId } from \"../../types/guid\";\nimport {\n  OrgKey,\n  UserKey,\n  MasterKey,\n  ProviderKey,\n  CipherKey,\n  UserPrivateKey,\n  UserPublicKey,\n} from \"../../types/key\";\nimport { VaultTimeoutStringType } from \"../../types/vault-timeout.type\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport {\n  CipherDecryptionKeys,\n  CryptoService as CryptoServiceAbstraction,\n} from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"../abstractions/key-generation.service\";\nimport { LogService } from \"../abstractions/log.service\";\nimport { PlatformUtilsService } from \"../abstractions/platform-utils.service\";\nimport { StateService } from \"../abstractions/state.service\";\nimport { KeySuffixOptions, HashPurpose, EncryptionType } from \"../enums\";\nimport { convertValues } from \"../misc/convert-values\";\nimport { EFFLongWordList } from \"../misc/wordlist\";\nimport { EncArrayBuffer } from \"../models/domain/enc-array-buffer\";\nimport { EncString, EncryptedString } from \"../models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\nimport { ActiveUserState, StateProvider } from \"../state\";\n\nimport { USER_ENCRYPTED_ORGANIZATION_KEYS } from \"./key-state/org-keys.state\";\nimport { USER_ENCRYPTED_PROVIDER_KEYS } from \"./key-state/provider-keys.state\";\nimport {\n  USER_ENCRYPTED_PRIVATE_KEY,\n  USER_EVER_HAD_USER_KEY,\n  USER_KEY,\n} from \"./key-state/user-key.state\";\n\nexport class CryptoService implements CryptoServiceAbstraction {\n  private readonly activeUserEverHadUserKey: ActiveUserState<boolean>;\n\n  readonly everHadUserKey$: Observable<boolean>;\n\n  readonly activeUserOrgKeys$: Observable<Record<OrganizationId, OrgKey>>;\n\n  constructor(\n    protected pinService: PinServiceAbstraction,\n    protected masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    protected keyGenerationService: KeyGenerationService,\n    protected cryptoFunctionService: CryptoFunctionService,\n    protected encryptService: EncryptService,\n    protected platformUtilService: PlatformUtilsService,\n    protected logService: LogService,\n    protected stateService: StateService,\n    protected accountService: AccountService,\n    protected stateProvider: StateProvider,\n    protected kdfConfigService: KdfConfigService,\n  ) {\n    // User Key\n    this.activeUserEverHadUserKey = stateProvider.getActive(USER_EVER_HAD_USER_KEY);\n    this.everHadUserKey$ = this.activeUserEverHadUserKey.state$.pipe(map((x) => x ?? false));\n\n    this.activeUserOrgKeys$ = this.stateProvider.activeUserId$.pipe(\n      switchMap((userId) => (userId != null ? this.orgKeys$(userId) : NEVER)),\n    );\n  }\n\n  async setUserKey(key: UserKey, userId?: UserId): Promise<void> {\n    if (key == null) {\n      throw new Error(\"No key provided. Lock the user to clear the key\");\n    }\n    // Set userId to ensure we have one for the account status update\n    [userId, key] = await this.stateProvider.setUserState(USER_KEY, key, userId);\n    await this.stateProvider.setUserState(USER_EVER_HAD_USER_KEY, true, userId);\n\n    await this.storeAdditionalKeys(key, userId);\n  }\n\n  async refreshAdditionalKeys(): Promise<void> {\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (activeUserId == null) {\n      throw new Error(\"Can only refresh keys while there is an active user.\");\n    }\n\n    const key = await this.getUserKey(activeUserId);\n    await this.setUserKey(key, activeUserId);\n  }\n\n  getInMemoryUserKeyFor$(userId: UserId): Observable<UserKey> {\n    return this.stateProvider.getUserState$(USER_KEY, userId);\n  }\n\n  async getUserKey(userId?: UserId): Promise<UserKey> {\n    const userKey = await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId));\n    return userKey;\n  }\n\n  async isLegacyUser(masterKey?: MasterKey, userId?: UserId): Promise<boolean> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    masterKey ??= await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n\n    return await this.validateUserKey(masterKey as unknown as UserKey, userId);\n  }\n\n  // TODO: legacy support for user key is no longer needed since we require users to migrate on login\n  async getUserKeyWithLegacySupport(userId?: UserId): Promise<UserKey> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n\n    const userKey = await this.getUserKey(userId);\n    if (userKey) {\n      return userKey;\n    }\n\n    // Legacy support: encryption used to be done with the master key (derived from master password).\n    // Users who have not migrated will have a null user key and must use the master key instead.\n    const masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    return masterKey as unknown as UserKey;\n  }\n\n  async getUserKeyFromStorage(keySuffix: KeySuffixOptions, userId?: UserId): Promise<UserKey> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    const userKey = await this.getKeyFromStorage(keySuffix, userId);\n    if (userKey) {\n      if (!(await this.validateUserKey(userKey, userId))) {\n        this.logService.warning(\"Invalid key, throwing away stored keys\");\n        await this.clearAllStoredUserKeys(userId);\n      }\n      return userKey;\n    }\n  }\n\n  async hasUserKey(userId?: UserId): Promise<boolean> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    if (userId == null) {\n      return false;\n    }\n    return await this.hasUserKeyInMemory(userId);\n  }\n\n  async hasUserKeyInMemory(userId?: UserId): Promise<boolean> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    if (userId == null) {\n      return false;\n    }\n\n    return (await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId))) != null;\n  }\n\n  async hasUserKeyStored(keySuffix: KeySuffixOptions, userId?: UserId): Promise<boolean> {\n    return (await this.getKeyFromStorage(keySuffix, userId)) != null;\n  }\n\n  async makeUserKey(masterKey: MasterKey): Promise<[UserKey, EncString]> {\n    if (!masterKey) {\n      const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n      masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    }\n    if (masterKey == null) {\n      throw new Error(\"No Master Key found.\");\n    }\n\n    const newUserKey = await this.keyGenerationService.createKey(512);\n    return this.buildProtectedSymmetricKey(masterKey, newUserKey.key);\n  }\n\n  /**\n   * Clears the user key. Clears all stored versions of the user keys as well, such as the biometrics key\n   * @param userId The desired user\n   */\n  private async clearUserKey(userId: UserId): Promise<void> {\n    if (userId == null) {\n      // nothing to do\n      return;\n    }\n    // Set userId to ensure we have one for the account status update\n    await this.stateProvider.setUserState(USER_KEY, null, userId);\n    await this.clearAllStoredUserKeys(userId);\n  }\n\n  async clearStoredUserKey(keySuffix: KeySuffixOptions, userId?: UserId): Promise<void> {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.clearDeprecatedKeys(KeySuffixOptions.Auto, userId);\n    }\n    if (keySuffix === KeySuffixOptions.Pin) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.pinService.clearPinKeyEncryptedUserKeyEphemeral(userId);\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n    }\n  }\n\n  async setMasterKeyEncryptedUserKey(userKeyMasterKey: string, userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    await this.masterPasswordService.setMasterKeyEncryptedUserKey(\n      new EncString(userKeyMasterKey),\n      userId,\n    );\n  }\n\n  // TODO: Move to MasterPasswordService\n  async getOrDeriveMasterKey(password: string, userId?: UserId) {\n    const [resolvedUserId, email] = await firstValueFrom(\n      combineLatest([this.accountService.activeAccount$, this.accountService.accounts$]).pipe(\n        map(([activeAccount, accounts]) => {\n          userId ??= activeAccount?.id;\n          return [userId, accounts[userId]?.email];\n        }),\n      ),\n    );\n    let masterKey = await firstValueFrom(this.masterPasswordService.masterKey$(resolvedUserId));\n    return (masterKey ||= await this.makeMasterKey(\n      password,\n      email,\n      await this.kdfConfigService.getKdfConfig(),\n    ));\n  }\n\n  /**\n   * Derive a master key from a password and email.\n   *\n   * @remarks\n   * Does not validate the kdf config to ensure it satisfies the minimum requirements for the given kdf type.\n   * TODO: Move to MasterPasswordService\n   */\n  async makeMasterKey(password: string, email: string, KdfConfig: KdfConfig): Promise<MasterKey> {\n    return (await this.keyGenerationService.deriveKeyFromPassword(\n      password,\n      email,\n      KdfConfig,\n    )) as MasterKey;\n  }\n\n  async encryptUserKeyWithMasterKey(\n    masterKey: MasterKey,\n    userKey?: UserKey,\n  ): Promise<[UserKey, EncString]> {\n    userKey ||= await this.getUserKey();\n    return await this.buildProtectedSymmetricKey(masterKey, userKey.key);\n  }\n\n  // TODO: move to MasterPasswordService\n  async hashMasterKey(\n    password: string,\n    key: MasterKey,\n    hashPurpose?: HashPurpose,\n  ): Promise<string> {\n    if (!key) {\n      const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n      key = await firstValueFrom(this.masterPasswordService.masterKey$(userId));\n    }\n\n    if (password == null || key == null) {\n      throw new Error(\"Invalid parameters.\");\n    }\n\n    const iterations = hashPurpose === HashPurpose.LocalAuthorization ? 2 : 1;\n    const hash = await this.cryptoFunctionService.pbkdf2(key.key, password, \"sha256\", iterations);\n    return Utils.fromBufferToB64(hash);\n  }\n\n  // TODO: move to MasterPasswordService\n  async compareAndUpdateKeyHash(masterPassword: string, masterKey: MasterKey): Promise<boolean> {\n    const userId = await firstValueFrom(this.stateProvider.activeUserId$);\n    const storedPasswordHash = await firstValueFrom(\n      this.masterPasswordService.masterKeyHash$(userId),\n    );\n    if (masterPassword != null && storedPasswordHash != null) {\n      const localKeyHash = await this.hashMasterKey(\n        masterPassword,\n        masterKey,\n        HashPurpose.LocalAuthorization,\n      );\n      if (localKeyHash != null && storedPasswordHash === localKeyHash) {\n        return true;\n      }\n\n      // TODO: remove serverKeyHash check in 1-2 releases after everyone's keyHash has been updated\n      const serverKeyHash = await this.hashMasterKey(\n        masterPassword,\n        masterKey,\n        HashPurpose.ServerAuthorization,\n      );\n      if (serverKeyHash != null && storedPasswordHash === serverKeyHash) {\n        await this.masterPasswordService.setMasterKeyHash(localKeyHash, userId);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  async setOrgKeys(\n    orgs: ProfileOrganizationResponse[],\n    providerOrgs: ProfileProviderOrganizationResponse[],\n    userId: UserId,\n  ): Promise<void> {\n    await this.stateProvider.getUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS).update(() => {\n      const encOrgKeyData: { [orgId: string]: EncryptedOrganizationKeyData } = {};\n\n      orgs.forEach((org) => {\n        encOrgKeyData[org.id] = {\n          type: \"organization\",\n          key: org.key,\n        };\n      });\n\n      providerOrgs.forEach((org) => {\n        encOrgKeyData[org.id] = {\n          type: \"provider\",\n          providerId: org.providerId,\n          key: org.key,\n        };\n      });\n\n      return encOrgKeyData;\n    });\n  }\n\n  async getOrgKey(orgId: OrganizationId): Promise<OrgKey> {\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n    if (activeUserId == null) {\n      throw new Error(\"A user must be active to retrieve an org key\");\n    }\n    const orgKeys = await firstValueFrom(this.orgKeys$(activeUserId));\n    return orgKeys[orgId];\n  }\n\n  async makeDataEncKey<T extends OrgKey | UserKey>(\n    key: T,\n  ): Promise<[SymmetricCryptoKey, EncString]> {\n    if (key == null) {\n      throw new Error(\"No key provided\");\n    }\n\n    const newSymKey = await this.keyGenerationService.createKey(512);\n    return this.buildProtectedSymmetricKey(key, newSymKey.key);\n  }\n\n  private async clearOrgKeys(userId: UserId): Promise<void> {\n    if (userId == null) {\n      // nothing to do\n      return;\n    }\n    await this.stateProvider.setUserState(USER_ENCRYPTED_ORGANIZATION_KEYS, null, userId);\n  }\n\n  async setProviderKeys(providers: ProfileProviderResponse[], userId: UserId): Promise<void> {\n    await this.stateProvider.getUser(userId, USER_ENCRYPTED_PROVIDER_KEYS).update(() => {\n      const encProviderKeys: { [providerId: ProviderId]: EncryptedString } = {};\n\n      providers.forEach((provider) => {\n        encProviderKeys[provider.id as ProviderId] = provider.key as EncryptedString;\n      });\n\n      return encProviderKeys;\n    });\n  }\n\n  // TODO: Deprecate in favor of observable\n  async getProviderKey(providerId: ProviderId): Promise<ProviderKey> {\n    if (providerId == null) {\n      return null;\n    }\n\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n    const providerKeys = await firstValueFrom(this.providerKeys$(activeUserId));\n\n    return providerKeys[providerId] ?? null;\n  }\n\n  private async clearProviderKeys(userId: UserId): Promise<void> {\n    if (userId == null) {\n      // nothing to do\n      return;\n    }\n    await this.stateProvider.setUserState(USER_ENCRYPTED_PROVIDER_KEYS, null, userId);\n  }\n\n  // TODO: Make userId required\n  async makeOrgKey<T extends OrgKey | ProviderKey>(userId?: UserId): Promise<[EncString, T]> {\n    const shareKey = await this.keyGenerationService.createKey(512);\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n    const publicKey = await firstValueFrom(this.userPublicKey$(userId));\n    const encShareKey = await this.rsaEncrypt(shareKey.key, publicKey);\n    return [encShareKey, shareKey as T];\n  }\n\n  async setPrivateKey(encPrivateKey: EncryptedString, userId: UserId): Promise<void> {\n    if (encPrivateKey == null) {\n      return;\n    }\n\n    await this.stateProvider\n      .getUser(userId, USER_ENCRYPTED_PRIVATE_KEY)\n      .update(() => encPrivateKey);\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (activeUserId == null) {\n      throw new Error(\"User must be active while attempting to retrieve private key.\");\n    }\n\n    return await firstValueFrom(this.userPrivateKey$(activeUserId));\n  }\n\n  // TODO: Make public key required\n  async getFingerprint(fingerprintMaterial: string, publicKey?: Uint8Array): Promise<string[]> {\n    if (publicKey == null) {\n      const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n      publicKey = await firstValueFrom(this.userPublicKey$(activeUserId));\n    }\n\n    if (publicKey === null) {\n      throw new Error(\"No public key available.\");\n    }\n    const keyFingerprint = await this.cryptoFunctionService.hash(publicKey, \"sha256\");\n    const userFingerprint = await this.cryptoFunctionService.hkdfExpand(\n      keyFingerprint,\n      fingerprintMaterial,\n      32,\n      \"sha256\",\n    );\n    return this.hashPhrase(userFingerprint);\n  }\n\n  async makeKeyPair(key: SymmetricCryptoKey): Promise<[string, EncString]> {\n    if (key == null) {\n      throw new Error(\"'key' is a required parameter and must be non-null.\");\n    }\n\n    const keyPair = await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n    const publicB64 = Utils.fromBufferToB64(keyPair[0]);\n    const privateEnc = await this.encryptService.encrypt(keyPair[1], key);\n    return [publicB64, privateEnc];\n  }\n\n  /**\n   * Clears the user's key pair\n   * @param userId The desired user\n   */\n  private async clearKeyPair(userId: UserId): Promise<void[]> {\n    if (userId == null) {\n      // nothing to do\n      return;\n    }\n\n    await this.stateProvider.setUserState(USER_ENCRYPTED_PRIVATE_KEY, null, userId);\n  }\n\n  async clearPinKeys(userId?: UserId): Promise<void> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (userId == null) {\n      throw new Error(\"Cannot clear PIN keys, no user Id resolved.\");\n    }\n\n    await this.pinService.clearPinKeyEncryptedUserKeyPersistent(userId);\n    await this.pinService.clearPinKeyEncryptedUserKeyEphemeral(userId);\n    await this.pinService.clearUserKeyEncryptedPin(userId);\n    await this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n  }\n\n  async makeSendKey(keyMaterial: CsprngArray): Promise<SymmetricCryptoKey> {\n    return await this.keyGenerationService.deriveKeyFromMaterial(\n      keyMaterial,\n      \"bitwarden-send\",\n      \"send\",\n    );\n  }\n\n  async makeCipherKey(): Promise<CipherKey> {\n    return (await this.keyGenerationService.createKey(512)) as CipherKey;\n  }\n\n  async clearKeys(userId?: UserId): Promise<any> {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (userId == null) {\n      throw new Error(\"Cannot clear keys, no user Id resolved.\");\n    }\n\n    await this.masterPasswordService.clearMasterKeyHash(userId);\n    await this.clearUserKey(userId);\n    await this.clearOrgKeys(userId);\n    await this.clearProviderKeys(userId);\n    await this.clearKeyPair(userId);\n    await this.clearPinKeys(userId);\n    await this.stateProvider.setUserState(USER_EVER_HAD_USER_KEY, null, userId);\n  }\n\n  async rsaEncrypt(data: Uint8Array, publicKey: Uint8Array): Promise<EncString> {\n    if (publicKey == null) {\n      throw new Error(\"'publicKey' is a required parameter and must be non-null\");\n    }\n\n    const encBytes = await this.cryptoFunctionService.rsaEncrypt(data, publicKey, \"sha1\");\n    return new EncString(EncryptionType.Rsa2048_OaepSha1_B64, Utils.fromBufferToB64(encBytes));\n  }\n\n  async rsaDecrypt(encValue: string, privateKey: Uint8Array): Promise<Uint8Array> {\n    if (privateKey == null) {\n      throw new Error(\"'privateKey' is a required parameter and must be non-null\");\n    }\n\n    const headerPieces = encValue.split(\".\");\n    let encType: EncryptionType = null;\n    let encPieces: string[];\n\n    if (headerPieces.length === 1) {\n      encType = EncryptionType.Rsa2048_OaepSha256_B64;\n      encPieces = [headerPieces[0]];\n    } else if (headerPieces.length === 2) {\n      try {\n        encType = parseInt(headerPieces[0], null);\n        encPieces = headerPieces[1].split(\"|\");\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n\n    switch (encType) {\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64: // HmacSha256 types are deprecated\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        break;\n      default:\n        throw new Error(\"encType unavailable.\");\n    }\n\n    if (encPieces == null || encPieces.length <= 0) {\n      throw new Error(\"encPieces unavailable.\");\n    }\n\n    const data = Utils.fromB64ToArray(encPieces[0]);\n\n    let alg: \"sha1\" | \"sha256\" = \"sha1\";\n    switch (encType) {\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64:\n        alg = \"sha256\";\n        break;\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        break;\n      default:\n        throw new Error(\"encType unavailable.\");\n    }\n\n    return this.cryptoFunctionService.rsaDecrypt(data, privateKey, alg);\n  }\n\n  // EFForg/OpenWireless\n  // ref https://github.com/EFForg/OpenWireless/blob/master/app/js/diceware.js\n  async randomNumber(min: number, max: number): Promise<number> {\n    let rval = 0;\n    const range = max - min + 1;\n    const bitsNeeded = Math.ceil(Math.log2(range));\n    if (bitsNeeded > 53) {\n      throw new Error(\"We cannot generate numbers larger than 53 bits.\");\n    }\n\n    const bytesNeeded = Math.ceil(bitsNeeded / 8);\n    const mask = Math.pow(2, bitsNeeded) - 1;\n    // 7776 -> (2^13 = 8192) -1 == 8191 or 0x00001111 11111111\n\n    // Fill a byte array with N random numbers\n    const byteArray = new Uint8Array(await this.cryptoFunctionService.randomBytes(bytesNeeded));\n\n    let p = (bytesNeeded - 1) * 8;\n    for (let i = 0; i < bytesNeeded; i++) {\n      rval += byteArray[i] * Math.pow(2, p);\n      p -= 8;\n    }\n\n    // Use & to apply the mask and reduce the number of recursive lookups\n    rval = rval & mask;\n\n    if (rval >= range) {\n      // Integer out of acceptable range\n      return this.randomNumber(min, max);\n    }\n\n    // Return an integer that falls within the range\n    return min + rval;\n  }\n\n  // ---HELPERS---\n  protected async validateUserKey(key: UserKey, userId: UserId): Promise<boolean> {\n    if (!key) {\n      return false;\n    }\n\n    try {\n      const encPrivateKey = await firstValueFrom(\n        this.stateProvider.getUser(userId, USER_ENCRYPTED_PRIVATE_KEY).state$,\n      );\n\n      if (encPrivateKey == null) {\n        return false;\n      }\n\n      // Can decrypt private key\n      const privateKey = await this.decryptPrivateKey(encPrivateKey, key);\n\n      if (privateKey == null) {\n        // failed to decrypt\n        return false;\n      }\n\n      // Can successfully derive public key\n      const publicKey = await this.derivePublicKey(privateKey);\n\n      if (publicKey == null) {\n        // failed to decrypt\n        return false;\n      }\n    } catch (e) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Initialize all necessary crypto keys needed for a new account.\n   * Warning! This completely replaces any existing keys!\n   */\n  async initAccount(): Promise<{\n    userKey: UserKey;\n    publicKey: string;\n    privateKey: EncString;\n  }> {\n    const activeUserId = await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (activeUserId == null) {\n      throw new Error(\"Cannot initilize an account if one is not active.\");\n    }\n\n    // Verify user key doesn't exist\n    const existingUserKey = await this.getUserKey(activeUserId);\n\n    if (existingUserKey != null) {\n      this.logService.error(\"Tried to initialize account with existing user key.\");\n      throw new Error(\"Cannot initialize account, keys already exist.\");\n    }\n\n    const userKey = (await this.keyGenerationService.createKey(512)) as UserKey;\n    const [publicKey, privateKey] = await this.makeKeyPair(userKey);\n    await this.setUserKey(userKey, activeUserId);\n    await this.stateProvider\n      .getUser(activeUserId, USER_ENCRYPTED_PRIVATE_KEY)\n      .update(() => privateKey.encryptedString);\n\n    return {\n      userKey,\n      publicKey,\n      privateKey,\n    };\n  }\n\n  /**\n   * Generates any additional keys if needed. Additional keys are\n   * keys such as biometrics, auto, and pin keys.\n   * Useful to make sure other keys stay in sync when the user key\n   * has been rotated.\n   * @param key The user key\n   * @param userId The desired user\n   */\n  protected async storeAdditionalKeys(key: UserKey, userId?: UserId) {\n    userId ??= await firstValueFrom(this.stateProvider.activeUserId$);\n\n    if (userId == null) {\n      throw new Error(\"Cannot store additional keys, no user Id resolved.\");\n    }\n\n    const storeAuto = await this.shouldStoreKey(KeySuffixOptions.Auto, userId);\n    if (storeAuto) {\n      await this.stateService.setUserKeyAutoUnlock(key.keyB64, { userId: userId });\n    } else {\n      await this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n    }\n    await this.clearDeprecatedKeys(KeySuffixOptions.Auto, userId);\n\n    const storePin = await this.shouldStoreKey(KeySuffixOptions.Pin, userId);\n    if (storePin) {\n      // Decrypt userKeyEncryptedPin with user key\n      const pin = await this.encryptService.decryptToUtf8(\n        await this.pinService.getUserKeyEncryptedPin(userId),\n        key,\n      );\n\n      const pinKeyEncryptedUserKey = await this.pinService.createPinKeyEncryptedUserKey(\n        pin,\n        key,\n        userId,\n      );\n      const noPreExistingPersistentKey =\n        (await this.pinService.getPinKeyEncryptedUserKeyPersistent(userId)) == null;\n\n      await this.pinService.storePinKeyEncryptedUserKey(\n        pinKeyEncryptedUserKey,\n        noPreExistingPersistentKey,\n        userId,\n      );\n      // We can't always clear deprecated keys because the pin is only\n      // migrated once used to unlock\n      await this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n    } else {\n      await this.pinService.clearPinKeyEncryptedUserKeyPersistent(userId);\n      await this.pinService.clearPinKeyEncryptedUserKeyEphemeral(userId);\n    }\n  }\n\n  protected async shouldStoreKey(keySuffix: KeySuffixOptions, userId?: UserId) {\n    let shouldStoreKey = false;\n    switch (keySuffix) {\n      case KeySuffixOptions.Auto: {\n        // TODO: Sharing the UserKeyDefinition is temporary to get around a circ dep issue between\n        // the VaultTimeoutSettingsSvc and this service.\n        // This should be fixed as part of the PM-7082 - Auto Key Service work.\n        const vaultTimeout = await firstValueFrom(\n          this.stateProvider.getUserState$(VAULT_TIMEOUT, userId),\n        );\n\n        shouldStoreKey = vaultTimeout == VaultTimeoutStringType.Never;\n        break;\n      }\n      case KeySuffixOptions.Pin: {\n        const userKeyEncryptedPin = await this.pinService.getUserKeyEncryptedPin(userId);\n        shouldStoreKey = !!userKeyEncryptedPin;\n        break;\n      }\n    }\n    return shouldStoreKey;\n  }\n\n  protected async getKeyFromStorage(\n    keySuffix: KeySuffixOptions,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      const userKey = await this.stateService.getUserKeyAutoUnlock({ userId: userId });\n      if (userKey) {\n        return new SymmetricCryptoKey(Utils.fromB64ToArray(userKey)) as UserKey;\n      }\n    }\n    return null;\n  }\n\n  protected async clearAllStoredUserKeys(userId?: UserId): Promise<void> {\n    await this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n    await this.pinService.clearPinKeyEncryptedUserKeyEphemeral(userId);\n  }\n\n  private async hashPhrase(hash: Uint8Array, minimumEntropy = 64) {\n    const entropyPerWord = Math.log(EFFLongWordList.length) / Math.log(2);\n    let numWords = Math.ceil(minimumEntropy / entropyPerWord);\n\n    const hashArr = Array.from(new Uint8Array(hash));\n    const entropyAvailable = hashArr.length * 4;\n    if (numWords * entropyPerWord > entropyAvailable) {\n      throw new Error(\"Output entropy of hash function is too small\");\n    }\n\n    const phrase: string[] = [];\n    let hashNumber = bigInt.fromArray(hashArr, 256);\n    while (numWords--) {\n      const remainder = hashNumber.mod(EFFLongWordList.length);\n      hashNumber = hashNumber.divide(EFFLongWordList.length);\n      phrase.push(EFFLongWordList[remainder as any]);\n    }\n    return phrase;\n  }\n\n  private async buildProtectedSymmetricKey<T extends SymmetricCryptoKey>(\n    encryptionKey: SymmetricCryptoKey,\n    newSymKey: Uint8Array,\n  ): Promise<[T, EncString]> {\n    let protectedSymKey: EncString = null;\n    if (encryptionKey.key.byteLength === 32) {\n      const stretchedEncryptionKey = await this.keyGenerationService.stretchKey(encryptionKey);\n      protectedSymKey = await this.encryptService.encrypt(newSymKey, stretchedEncryptionKey);\n    } else if (encryptionKey.key.byteLength === 64) {\n      protectedSymKey = await this.encryptService.encrypt(newSymKey, encryptionKey);\n    } else {\n      throw new Error(\"Invalid key size.\");\n    }\n    return [new SymmetricCryptoKey(newSymKey) as T, protectedSymKey];\n  }\n\n  // --LEGACY METHODS--\n  // We previously used the master key for additional keys, but now we use the user key.\n  // These methods support migrating the old keys to the new ones.\n  // TODO: Remove after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3475)\n\n  async clearDeprecatedKeys(keySuffix: KeySuffixOptions, userId?: UserId) {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      await this.stateService.setCryptoMasterKeyAuto(null, { userId: userId });\n    } else if (keySuffix === KeySuffixOptions.Pin) {\n      await this.pinService.clearOldPinKeyEncryptedMasterKey(userId);\n    }\n  }\n\n  // --DEPRECATED METHODS--\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.encrypt\n   */\n  async encrypt(plainValue: string | Uint8Array, key?: SymmetricCryptoKey): Promise<EncString> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return await this.encryptService.encrypt(plainValue, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.encryptToBytes\n   */\n  async encryptToBytes(plainValue: Uint8Array, key?: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return this.encryptService.encryptToBytes(plainValue, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToBytes\n   */\n  async decryptToBytes(encString: EncString, key?: SymmetricCryptoKey): Promise<Uint8Array> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return this.encryptService.decryptToBytes(encString, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToUtf8\n   */\n  async decryptToUtf8(encString: EncString, key?: SymmetricCryptoKey): Promise<string> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return await this.encryptService.decryptToUtf8(encString, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToBytes\n   */\n  async decryptFromBytes(encBuffer: EncArrayBuffer, key: SymmetricCryptoKey): Promise<Uint8Array> {\n    if (encBuffer == null) {\n      throw new Error(\"No buffer provided for decryption.\");\n    }\n\n    key ||= await this.getUserKeyWithLegacySupport();\n\n    return this.encryptService.decryptToBytes(encBuffer, key);\n  }\n\n  userKey$(userId: UserId) {\n    return this.stateProvider.getUser(userId, USER_KEY).state$;\n  }\n\n  private userKeyWithLegacySupport$(userId: UserId) {\n    return this.userKey$(userId).pipe(\n      switchMap((userKey) => {\n        if (userKey != null) {\n          return of(userKey);\n        }\n\n        // Legacy path\n        return this.masterPasswordService.masterKey$(userId).pipe(\n          switchMap(async (masterKey) => {\n            if (!(await this.validateUserKey(masterKey as unknown as UserKey, userId))) {\n              // We don't have a UserKey or a valid MasterKey\n              return null;\n            }\n\n            // The master key is valid meaning, the org keys and such are encrypted with this key\n            return masterKey as unknown as UserKey;\n          }),\n        );\n      }),\n    );\n  }\n\n  userPublicKey$(userId: UserId) {\n    return this.userPrivateKey$(userId).pipe(\n      switchMap(async (pk) => await this.derivePublicKey(pk)),\n    );\n  }\n\n  private async derivePublicKey(privateKey: UserPrivateKey) {\n    return (await this.cryptoFunctionService.rsaExtractPublicKey(privateKey)) as UserPublicKey;\n  }\n\n  userPrivateKey$(userId: UserId): Observable<UserPrivateKey> {\n    return this.userPrivateKeyHelper$(userId, false).pipe(map((keys) => keys?.userPrivateKey));\n  }\n\n  private userPrivateKeyHelper$(userId: UserId, legacySupport: boolean) {\n    const userKey$ = legacySupport ? this.userKeyWithLegacySupport$(userId) : this.userKey$(userId);\n    return userKey$.pipe(\n      switchMap((userKey) => {\n        if (userKey == null) {\n          return of(null);\n        }\n\n        return this.stateProvider.getUser(userId, USER_ENCRYPTED_PRIVATE_KEY).state$.pipe(\n          switchMap(\n            async (encryptedPrivateKey) =>\n              await this.decryptPrivateKey(encryptedPrivateKey, userKey),\n          ),\n          // Combine outerscope info with user private key\n          map((userPrivateKey) => ({\n            userKey,\n            userPrivateKey,\n          })),\n        );\n      }),\n    );\n  }\n\n  private async decryptPrivateKey(encryptedPrivateKey: EncryptedString, key: SymmetricCryptoKey) {\n    if (encryptedPrivateKey == null) {\n      return null;\n    }\n\n    return (await this.encryptService.decryptToBytes(\n      new EncString(encryptedPrivateKey),\n      key,\n    )) as UserPrivateKey;\n  }\n\n  providerKeys$(userId: UserId) {\n    return this.userPrivateKey$(userId).pipe(\n      switchMap((userPrivateKey) => {\n        if (userPrivateKey == null) {\n          return of(null);\n        }\n\n        return this.providerKeysHelper$(userId, userPrivateKey);\n      }),\n    );\n  }\n\n  /**\n   * A helper for decrypting provider keys that requires a user id and that users decrypted private key\n   * this is helpful for when you may have already grabbed the user private key and don't want to redo\n   * that work to get the provider keys.\n   */\n  private providerKeysHelper$(\n    userId: UserId,\n    userPrivateKey: UserPrivateKey,\n  ): Observable<Record<ProviderId, ProviderKey>> {\n    return this.stateProvider.getUser(userId, USER_ENCRYPTED_PROVIDER_KEYS).state$.pipe(\n      // Convert each value in the record to it's own decryption observable\n      convertValues(async (_, value) => {\n        const decrypted = await this.encryptService.rsaDecrypt(\n          new EncString(value),\n          userPrivateKey,\n        );\n        return new SymmetricCryptoKey(decrypted) as ProviderKey;\n      }),\n      // switchMap since there are no side effects\n      switchMap((encryptedProviderKeys) => {\n        if (encryptedProviderKeys == null) {\n          return of(null);\n        }\n\n        // Can't give an empty record to forkJoin\n        if (Object.keys(encryptedProviderKeys).length === 0) {\n          return of({});\n        }\n\n        return forkJoin(encryptedProviderKeys);\n      }),\n    );\n  }\n\n  orgKeys$(userId: UserId) {\n    return this.cipherDecryptionKeys$(userId).pipe(map((keys) => keys?.orgKeys));\n  }\n\n  cipherDecryptionKeys$(\n    userId: UserId,\n    legacySupport: boolean = false,\n  ): Observable<CipherDecryptionKeys | null> {\n    return this.userPrivateKeyHelper$(userId, legacySupport).pipe(\n      switchMap((userKeys) => {\n        if (userKeys == null) {\n          return of(null);\n        }\n\n        const userPrivateKey = userKeys.userPrivateKey;\n\n        if (userPrivateKey == null) {\n          // We can't do any org based decryption\n          return of({ userKey: userKeys.userKey, orgKeys: null });\n        }\n\n        return combineLatest([\n          this.stateProvider.getUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS).state$,\n          this.providerKeysHelper$(userId, userPrivateKey),\n        ]).pipe(\n          switchMap(async ([encryptedOrgKeys, providerKeys]) => {\n            const result: Record<OrganizationId, OrgKey> = {};\n            for (const orgId of Object.keys(encryptedOrgKeys ?? {}) as OrganizationId[]) {\n              if (result[orgId] != null) {\n                continue;\n              }\n              const encrypted = BaseEncryptedOrganizationKey.fromData(encryptedOrgKeys[orgId]);\n\n              let decrypted: OrgKey;\n\n              if (BaseEncryptedOrganizationKey.isProviderEncrypted(encrypted)) {\n                decrypted = await encrypted.decrypt(this.encryptService, providerKeys);\n              } else {\n                decrypted = await encrypted.decrypt(this.encryptService, userPrivateKey);\n              }\n\n              result[orgId] = decrypted;\n            }\n\n            return result;\n          }),\n          // Combine them back together\n          map((orgKeys) => ({ userKey: userKeys.userKey, orgKeys: orgKeys })),\n        );\n      }),\n    );\n  }\n}\n","import { ObservableInput, OperatorFunction, map } from \"rxjs\";\n\n/**\n * Converts a record of keys and values into a record preserving the original key and converting each value into an {@link ObservableInput}.\n * @param project A function to project a given key and value pair into an {@link ObservableInput}\n */\nexport function convertValues<TKey extends PropertyKey, TInput, TOutput>(\n  project: (key: TKey, value: TInput) => ObservableInput<TOutput>,\n): OperatorFunction<Record<TKey, TInput>, Record<TKey, ObservableInput<TOutput>>> {\n  return map((inputRecord) => {\n    if (inputRecord == null) {\n      return null;\n    }\n\n    // Can't use TKey in here, have to use `PropertyKey`\n    const result: Record<PropertyKey, ObservableInput<TOutput>> = {};\n    for (const [key, value] of Object.entries(inputRecord) as [TKey, TInput][]) {\n      result[key] = project(key, value);\n    }\n\n    return result;\n  });\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"@bitwarden/common/auth/abstractions/master-password.service.abstraction\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { BiometricStateService } from \"@bitwarden/common/platform/biometrics/biometric-state.service\";\nimport { KeySuffixOptions } from \"@bitwarden/common/platform/enums\";\nimport { CryptoService } from \"@bitwarden/common/platform/services/crypto.service\";\nimport { USER_KEY } from \"@bitwarden/common/platform/services/key-state/user-key.state\";\nimport { StateProvider } from \"@bitwarden/common/platform/state\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { UserKey } from \"@bitwarden/common/types/key\";\n\nexport class BrowserCryptoService extends CryptoService {\n  constructor(\n    pinService: PinServiceAbstraction,\n    masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    keyGenerationService: KeyGenerationService,\n    cryptoFunctionService: CryptoFunctionService,\n    encryptService: EncryptService,\n    platformUtilService: PlatformUtilsService,\n    logService: LogService,\n    stateService: StateService,\n    accountService: AccountService,\n    stateProvider: StateProvider,\n    private biometricStateService: BiometricStateService,\n    kdfConfigService: KdfConfigService,\n  ) {\n    super(\n      pinService,\n      masterPasswordService,\n      keyGenerationService,\n      cryptoFunctionService,\n      encryptService,\n      platformUtilService,\n      logService,\n      stateService,\n      accountService,\n      stateProvider,\n      kdfConfigService,\n    );\n  }\n  override async hasUserKeyStored(keySuffix: KeySuffixOptions, userId?: UserId): Promise<boolean> {\n    if (keySuffix === KeySuffixOptions.Biometric) {\n      const biometricUnlockPromise =\n        userId == null\n          ? firstValueFrom(this.biometricStateService.biometricUnlockEnabled$)\n          : this.biometricStateService.getBiometricUnlockEnabled(userId);\n      return await biometricUnlockPromise;\n    }\n    return super.hasUserKeyStored(keySuffix, userId);\n  }\n\n  /**\n   * Browser doesn't store biometric keys, so we retrieve them from the desktop and return\n   * if we successfully saved it into memory as the User Key\n   * @returns the `UserKey` if the user passes a biometrics prompt, otherwise return `null`.\n   */\n  protected override async getKeyFromStorage(\n    keySuffix: KeySuffixOptions,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    if (keySuffix === KeySuffixOptions.Biometric) {\n      const biometricsResult = await this.platformUtilService.authenticateBiometric();\n\n      if (!biometricsResult) {\n        return null;\n      }\n\n      const userKey = await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId));\n      if (userKey) {\n        return userKey;\n      }\n    }\n\n    return await super.getKeyFromStorage(keySuffix, userId);\n  }\n}\n","import { distinctUntilChanged, firstValueFrom, map, Observable, switchMap } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { UserId } from \"../../types/guid\";\nimport {\n  EnvironmentService,\n  Environment,\n  Region,\n  RegionConfig,\n  Urls,\n  CloudRegion,\n} from \"../abstractions/environment.service\";\nimport { Utils } from \"../misc/utils\";\nimport {\n  ENVIRONMENT_DISK,\n  ENVIRONMENT_MEMORY,\n  GlobalState,\n  KeyDefinition,\n  StateProvider,\n  UserKeyDefinition,\n} from \"../state\";\n\nexport class EnvironmentUrls {\n  base: string = null;\n  api: string = null;\n  identity: string = null;\n  icons: string = null;\n  notifications: string = null;\n  events: string = null;\n  webVault: string = null;\n  keyConnector: string = null;\n}\n\nclass EnvironmentState {\n  region: Region;\n  urls: EnvironmentUrls;\n\n  static fromJSON(obj: Jsonify<EnvironmentState>): EnvironmentState {\n    return Object.assign(new EnvironmentState(), obj);\n  }\n}\n\nexport const GLOBAL_ENVIRONMENT_KEY = new KeyDefinition<EnvironmentState>(\n  ENVIRONMENT_DISK,\n  \"environment\",\n  {\n    deserializer: EnvironmentState.fromJSON,\n  },\n);\n\nexport const USER_ENVIRONMENT_KEY = new UserKeyDefinition<EnvironmentState>(\n  ENVIRONMENT_DISK,\n  \"environment\",\n  {\n    deserializer: EnvironmentState.fromJSON,\n    clearOn: [\"logout\"],\n  },\n);\n\nexport const GLOBAL_CLOUD_REGION_KEY = new KeyDefinition<CloudRegion>(\n  ENVIRONMENT_MEMORY,\n  \"cloudRegion\",\n  {\n    deserializer: (b) => b,\n  },\n);\n\nexport const USER_CLOUD_REGION_KEY = new UserKeyDefinition<CloudRegion>(\n  ENVIRONMENT_MEMORY,\n  \"cloudRegion\",\n  {\n    deserializer: (b) => b,\n    clearOn: [\"logout\"],\n  },\n);\n\n/**\n * The production regions available for selection.\n *\n * In the future we desire to load these urls from the config endpoint.\n */\nexport const PRODUCTION_REGIONS: RegionConfig[] = [\n  {\n    key: Region.US,\n    domain: \"bitwarden.com\",\n    urls: {\n      base: null,\n      api: \"https://api.bitwarden.com\",\n      identity: \"https://identity.bitwarden.com\",\n      icons: \"https://icons.bitwarden.net\",\n      webVault: \"https://vault.bitwarden.com\",\n      notifications: \"https://notifications.bitwarden.com\",\n      events: \"https://events.bitwarden.com\",\n      scim: \"https://scim.bitwarden.com\",\n    },\n  },\n  {\n    key: Region.EU,\n    domain: \"bitwarden.eu\",\n    urls: {\n      base: null,\n      api: \"https://api.bitwarden.eu\",\n      identity: \"https://identity.bitwarden.eu\",\n      icons: \"https://icons.bitwarden.eu\",\n      webVault: \"https://vault.bitwarden.eu\",\n      notifications: \"https://notifications.bitwarden.eu\",\n      events: \"https://events.bitwarden.eu\",\n      scim: \"https://scim.bitwarden.eu\",\n    },\n  },\n];\n\n/**\n * The default region when starting the app.\n */\nconst DEFAULT_REGION = Region.US;\n\n/**\n * The default region configuration.\n */\nconst DEFAULT_REGION_CONFIG = PRODUCTION_REGIONS.find((r) => r.key === DEFAULT_REGION);\n\nexport class DefaultEnvironmentService implements EnvironmentService {\n  private globalState: GlobalState<EnvironmentState | null>;\n  private globalCloudRegionState: GlobalState<CloudRegion | null>;\n\n  // We intentionally don't want the helper on account service, we want the null back if there is no active user\n  private activeAccountId$: Observable<UserId | null> = this.accountService.activeAccount$.pipe(\n    map((a) => a?.id),\n  );\n\n  environment$: Observable<Environment>;\n  cloudWebVaultUrl$: Observable<string>;\n\n  constructor(\n    private stateProvider: StateProvider,\n    private accountService: AccountService,\n  ) {\n    this.globalState = this.stateProvider.getGlobal(GLOBAL_ENVIRONMENT_KEY);\n    this.globalCloudRegionState = this.stateProvider.getGlobal(GLOBAL_CLOUD_REGION_KEY);\n\n    const account$ = this.activeAccountId$.pipe(\n      // Use == here to not trigger on undefined -> null transition\n      distinctUntilChanged((oldUserId: UserId, newUserId: UserId) => oldUserId == newUserId),\n    );\n\n    this.environment$ = account$.pipe(\n      switchMap((userId) => {\n        const t = userId\n          ? this.stateProvider.getUser(userId, USER_ENVIRONMENT_KEY).state$\n          : this.stateProvider.getGlobal(GLOBAL_ENVIRONMENT_KEY).state$;\n        return t;\n      }),\n      map((state) => {\n        return this.buildEnvironment(state?.region, state?.urls);\n      }),\n    );\n    this.cloudWebVaultUrl$ = account$.pipe(\n      switchMap((userId) => {\n        const t = userId\n          ? this.stateProvider.getUser(userId, USER_CLOUD_REGION_KEY).state$\n          : this.stateProvider.getGlobal(GLOBAL_CLOUD_REGION_KEY).state$;\n        return t;\n      }),\n      map((region) => {\n        if (region != null) {\n          const config = this.getRegionConfig(region);\n\n          if (config != null) {\n            return config.urls.webVault;\n          }\n        }\n        return DEFAULT_REGION_CONFIG.urls.webVault;\n      }),\n    );\n  }\n\n  availableRegions(): RegionConfig[] {\n    const additionalRegions = (process.env.ADDITIONAL_REGIONS as unknown as RegionConfig[]) ?? [];\n    return PRODUCTION_REGIONS.concat(additionalRegions);\n  }\n\n  /**\n   * Get the region configuration for the given region.\n   */\n  private getRegionConfig(region: Region): RegionConfig | undefined {\n    return this.availableRegions().find((r) => r.key === region);\n  }\n\n  async setEnvironment(region: Region, urls?: Urls): Promise<Urls> {\n    // Unknown regions are treated as self-hosted\n    if (this.getRegionConfig(region) == null) {\n      region = Region.SelfHosted;\n    }\n\n    // If self-hosted ensure urls are valid else fallback to default region\n    if (region == Region.SelfHosted && isEmpty(urls)) {\n      region = DEFAULT_REGION;\n    }\n\n    if (region != Region.SelfHosted) {\n      await this.globalState.update(() => ({\n        region: region,\n        urls: null,\n      }));\n\n      return null;\n    } else {\n      // Clean the urls\n      urls.base = formatUrl(urls.base);\n      urls.webVault = formatUrl(urls.webVault);\n      urls.api = formatUrl(urls.api);\n      urls.identity = formatUrl(urls.identity);\n      urls.icons = formatUrl(urls.icons);\n      urls.notifications = formatUrl(urls.notifications);\n      urls.events = formatUrl(urls.events);\n      urls.keyConnector = formatUrl(urls.keyConnector);\n      urls.scim = null;\n\n      await this.globalState.update(() => ({\n        region: region,\n        urls: {\n          base: urls.base,\n          api: urls.api,\n          identity: urls.identity,\n          webVault: urls.webVault,\n          icons: urls.icons,\n          notifications: urls.notifications,\n          events: urls.events,\n          keyConnector: urls.keyConnector,\n        },\n      }));\n\n      return urls;\n    }\n  }\n\n  /**\n   * Helper for building the environment from state. Performs some general sanitization to avoid invalid regions and urls.\n   */\n  protected buildEnvironment(region: Region, urls: Urls) {\n    // Unknown regions are treated as self-hosted\n    if (this.getRegionConfig(region) == null) {\n      region = Region.SelfHosted;\n    }\n\n    // If self-hosted ensure urls are valid else fallback to default region\n    if (region == Region.SelfHosted && isEmpty(urls)) {\n      region = DEFAULT_REGION;\n    }\n\n    // Load urls from region config\n    if (region != Region.SelfHosted) {\n      const regionConfig = this.getRegionConfig(region);\n      if (regionConfig != null) {\n        return new CloudEnvironment(regionConfig);\n      }\n    }\n\n    return new SelfHostedEnvironment(urls);\n  }\n\n  async setCloudRegion(userId: UserId, region: CloudRegion) {\n    if (userId == null) {\n      await this.globalCloudRegionState.update(() => region);\n    } else {\n      await this.stateProvider.getUser(userId, USER_CLOUD_REGION_KEY).update(() => region);\n    }\n  }\n\n  async getEnvironment(userId?: UserId) {\n    if (userId == null) {\n      return await firstValueFrom(this.environment$);\n    }\n\n    const state = await this.getEnvironmentState(userId);\n    return this.buildEnvironment(state.region, state.urls);\n  }\n\n  private async getEnvironmentState(userId: UserId | null) {\n    // Previous rules dictated that we only get from user scoped state if there is an active user.\n    const activeUserId = await firstValueFrom(this.activeAccountId$);\n    return activeUserId == null\n      ? await firstValueFrom(this.globalState.state$)\n      : await firstValueFrom(\n          this.stateProvider.getUser(userId ?? activeUserId, USER_ENVIRONMENT_KEY).state$,\n        );\n  }\n\n  async seedUserEnvironment(userId: UserId) {\n    const global = await firstValueFrom(this.globalState.state$);\n    await this.stateProvider.getUser(userId, USER_ENVIRONMENT_KEY).update(() => global);\n  }\n}\n\nfunction formatUrl(url: string): string {\n  if (url == null || url === \"\") {\n    return null;\n  }\n\n  url = url.replace(/\\/+$/g, \"\");\n  if (!url.startsWith(\"http://\") && !url.startsWith(\"https://\")) {\n    url = \"https://\" + url;\n  }\n\n  return url.trim();\n}\n\nfunction isEmpty(u?: Urls): boolean {\n  if (u == null) {\n    return true;\n  }\n\n  return (\n    u.base == null &&\n    u.webVault == null &&\n    u.api == null &&\n    u.identity == null &&\n    u.icons == null &&\n    u.notifications == null &&\n    u.events == null\n  );\n}\n\nabstract class UrlEnvironment implements Environment {\n  constructor(\n    protected region: Region,\n    protected urls: Urls,\n  ) {\n    // Scim is always null for self-hosted\n    if (region == Region.SelfHosted) {\n      this.urls.scim = null;\n    }\n  }\n\n  abstract getHostname(): string;\n\n  getRegion() {\n    return this.region;\n  }\n\n  getUrls() {\n    return {\n      base: this.urls.base,\n      webVault: this.urls.webVault,\n      api: this.urls.api,\n      identity: this.urls.identity,\n      icons: this.urls.icons,\n      notifications: this.urls.notifications,\n      events: this.urls.events,\n      keyConnector: this.urls.keyConnector,\n      scim: this.urls.scim,\n    };\n  }\n\n  hasBaseUrl() {\n    return this.urls.base != null;\n  }\n\n  getWebVaultUrl() {\n    return this.getUrl(\"webVault\", \"\");\n  }\n\n  getApiUrl() {\n    return this.getUrl(\"api\", \"/api\");\n  }\n\n  getEventsUrl() {\n    return this.getUrl(\"events\", \"/events\");\n  }\n\n  getIconsUrl() {\n    return this.getUrl(\"icons\", \"/icons\");\n  }\n\n  getIdentityUrl() {\n    return this.getUrl(\"identity\", \"/identity\");\n  }\n\n  getKeyConnectorUrl() {\n    return this.urls.keyConnector;\n  }\n\n  getNotificationsUrl() {\n    return this.getUrl(\"notifications\", \"/notifications\");\n  }\n\n  getScimUrl() {\n    if (this.urls.scim != null) {\n      return this.urls.scim + \"/v2\";\n    }\n\n    return this.getWebVaultUrl() === \"https://vault.bitwarden.com\"\n      ? \"https://scim.bitwarden.com/v2\"\n      : this.getWebVaultUrl() + \"/scim/v2\";\n  }\n\n  getSendUrl() {\n    return this.getWebVaultUrl() === \"https://vault.bitwarden.com\"\n      ? \"https://send.bitwarden.com/#\"\n      : this.getWebVaultUrl() + \"/#/send/\";\n  }\n\n  /**\n   * Presume that if the region is not self-hosted, it is cloud.\n   */\n  isCloud(): boolean {\n    return this.region !== Region.SelfHosted;\n  }\n\n  /**\n   * Helper for getting an URL.\n   *\n   * @param key Key of the URL to get from URLs\n   * @param baseSuffix Suffix to append to the base URL if the url is not set\n   * @returns\n   */\n  private getUrl(key: keyof Urls, baseSuffix: string) {\n    if (this.urls[key] != null) {\n      return this.urls[key];\n    }\n\n    if (this.urls.base) {\n      return this.urls.base + baseSuffix;\n    }\n\n    return DEFAULT_REGION_CONFIG.urls[key];\n  }\n}\n\n/**\n * Denote a cloud environment.\n */\nexport class CloudEnvironment extends UrlEnvironment {\n  constructor(private config: RegionConfig) {\n    super(config.key, config.urls);\n  }\n\n  /**\n   * Cloud always returns nice urls, i.e. bitwarden.com instead of vault.bitwarden.com.\n   */\n  getHostname() {\n    return this.config.domain;\n  }\n}\n\nexport class SelfHostedEnvironment extends UrlEnvironment {\n  constructor(urls: Urls) {\n    super(Region.SelfHosted, urls);\n  }\n\n  getHostname() {\n    return Utils.getHost(this.getWebVaultUrl());\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { Region } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { DefaultEnvironmentService } from \"@bitwarden/common/platform/services/default-environment.service\";\nimport { StateProvider } from \"@bitwarden/common/platform/state\";\n\nimport { GroupPolicyEnvironment } from \"../../admin-console/types/group-policy-environment\";\nimport { devFlagEnabled, devFlagValue } from \"../flags\";\n\nexport class BrowserEnvironmentService extends DefaultEnvironmentService {\n  constructor(\n    private logService: LogService,\n    stateProvider: StateProvider,\n    accountService: AccountService,\n  ) {\n    super(stateProvider, accountService);\n  }\n\n  async hasManagedEnvironment(): Promise<boolean> {\n    try {\n      return (await this.getManagedEnvironment()) != null;\n    } catch (e) {\n      this.logService.error(e);\n      return false;\n    }\n  }\n\n  async settingsHaveChanged() {\n    if (!(await this.hasManagedEnvironment())) {\n      return false;\n    }\n\n    const managedEnv = await this.getManagedEnvironment();\n    const env = await firstValueFrom(this.environment$);\n    const urls = env.getUrls();\n\n    return (\n      managedEnv.base != urls.base ||\n      managedEnv.webVault != urls.webVault ||\n      managedEnv.api != urls.api ||\n      managedEnv.identity != urls.identity ||\n      managedEnv.icons != urls.icons ||\n      managedEnv.notifications != urls.notifications ||\n      managedEnv.events != urls.events\n    );\n  }\n\n  getManagedEnvironment(): Promise<GroupPolicyEnvironment> {\n    return devFlagEnabled(\"managedEnvironment\")\n      ? new Promise((resolve) => resolve(devFlagValue(\"managedEnvironment\")))\n      : new Promise((resolve, reject) => {\n          if (chrome.storage.managed == null) {\n            return resolve(null);\n          }\n\n          chrome.storage.managed.get(\"environment\", (result) => {\n            if (chrome.runtime.lastError) {\n              return reject(chrome.runtime.lastError);\n            }\n\n            resolve(result.environment);\n          });\n        });\n  }\n\n  async setUrlsToManagedEnvironment() {\n    const env = await this.getManagedEnvironment();\n    await this.setEnvironment(Region.SelfHosted, {\n      base: env.base,\n      webVault: env.webVault,\n      api: env.api,\n      identity: env.identity,\n      icons: env.icons,\n      notifications: env.notifications,\n      events: env.events,\n    });\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { BrowserApi } from \"./browser-api\";\n\n/**\n * Converts a Chrome event to an Observable stream.\n *\n * @typeParam T - The type of the event arguments.\n * @param event - The Chrome event to convert.\n * @returns An Observable stream of the event arguments.\n *\n * @remarks\n * This function creates an Observable stream that listens to a Chrome event and emits its arguments\n * whenever the event is triggered. If the event throws an error, the Observable will emit an error\n * notification with the error message.\n *\n * @example\n * ```typescript\n * const onMessage = fromChromeEvent(chrome.runtime.onMessage);\n * onMessage.subscribe((message) => console.log('Received message:', message));\n * ```\n */\nexport function fromChromeEvent<T extends unknown[]>(\n  event: chrome.events.Event<(...args: T) => void>,\n): Observable<T> {\n  return new Observable<T>((subscriber) => {\n    const handler = (...args: T) => {\n      if (chrome.runtime.lastError) {\n        subscriber.error(chrome.runtime.lastError);\n        return;\n      }\n\n      subscriber.next(args);\n    };\n\n    BrowserApi.addListener(event, handler);\n    return () => BrowserApi.removeListener(event, handler);\n  });\n}\n","import { filter, mergeMap } from \"rxjs\";\n\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n  StorageUpdateType,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\n\nimport { fromChromeEvent } from \"../../browser/from-chrome-event\";\n\nexport const serializationIndicator = \"__json__\";\n\ntype serializedObject = { [serializationIndicator]: true; value: string };\n\nexport const objToStore = (obj: any) => {\n  if (obj == null) {\n    return null;\n  }\n\n  if (obj instanceof Set) {\n    obj = Array.from(obj);\n  }\n\n  return {\n    [serializationIndicator]: true,\n    value: JSON.stringify(obj),\n  };\n};\n\nexport default abstract class AbstractChromeStorageService\n  implements AbstractStorageService, ObservableStorageService\n{\n  updates$;\n\n  constructor(protected chromeStorageApi: chrome.storage.StorageArea) {\n    this.updates$ = fromChromeEvent(this.chromeStorageApi.onChanged).pipe(\n      filter(([changes]) => {\n        // Our storage services support changing only one key at a time. If more are changed, it's due to\n        // reseeding storage and we should ignore the changes.\n        return Object.keys(changes).length === 1;\n      }),\n      mergeMap(([changes]) => {\n        return Object.entries(changes).map(([key, change]) => {\n          // The `newValue` property isn't on the StorageChange object\n          // when the change was from a remove. Similarly a check of the `oldValue`\n          // could be used to tell if the operation was the first creation of this key\n          // but we currently do not differentiate that.\n          // Ref: https://developer.chrome.com/docs/extensions/reference/storage/#type-StorageChange\n          // Ref: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageChange\n          const updateType: StorageUpdateType = \"newValue\" in change ? \"save\" : \"remove\";\n\n          return {\n            key: key,\n            // For removes this property will not exist but then it will just be\n            // undefined which is fine.\n            updateType: updateType,\n          };\n        });\n      }),\n    );\n  }\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n\n  async get<T>(key: string): Promise<T> {\n    return new Promise((resolve) => {\n      this.chromeStorageApi.get(key, (obj: any) => {\n        if (obj != null && obj[key] != null) {\n          resolve(this.processGetObject(obj[key]));\n          return;\n        }\n        resolve(null);\n      });\n    });\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  async save(key: string, obj: any): Promise<void> {\n    obj = objToStore(obj);\n\n    if (obj == null) {\n      // Safari does not support set of null values\n      return this.remove(key);\n    }\n\n    const keyedObj = { [key]: obj };\n    return new Promise<void>((resolve) => {\n      this.chromeStorageApi.set(keyedObj, () => {\n        resolve();\n      });\n    });\n  }\n\n  async remove(key: string): Promise<void> {\n    return new Promise<void>((resolve) => {\n      this.chromeStorageApi.remove(key, () => {\n        resolve();\n      });\n    });\n  }\n\n  /** Backwards compatible resolution of retrieved object with new serialized storage */\n  protected processGetObject<T>(obj: T | serializedObject): T | null {\n    if (this.isSerialized(obj)) {\n      obj = JSON.parse(obj.value);\n    }\n    return obj as T;\n  }\n\n  /** Type guard for whether an object is tagged as serialized */\n  protected isSerialized<T>(value: T | serializedObject): value is serializedObject {\n    const asSerialized = value as serializedObject;\n    return (\n      asSerialized != null &&\n      asSerialized[serializationIndicator] &&\n      typeof asSerialized.value === \"string\"\n    );\n  }\n}\n","import AbstractChromeStorageService from \"./abstractions/abstract-chrome-storage-api.service\";\n\nexport default class BrowserLocalStorageService extends AbstractChromeStorageService {\n  constructor() {\n    super(chrome.storage.local);\n  }\n\n  /**\n   * Clears local storage\n   */\n  async clear() {\n    await chrome.storage.local.clear();\n  }\n\n  /**\n   * Retrieves all objects stored in local storage.\n   *\n   * @remarks This method processes values prior to resolving, do not use `chrome.storage.local` directly\n   * @returns Promise resolving to keyed object of all stored data\n   */\n  async getAll(): Promise<Record<string, unknown>> {\n    return new Promise((resolve) => {\n      this.chromeStorageApi.get(null, (allStorage) => {\n        const resolved = Object.entries(allStorage).reduce(\n          (agg, [key, value]) => {\n            agg[key] = this.processGetObject(value);\n            return agg;\n          },\n          {} as Record<string, unknown>,\n        );\n        resolve(resolved);\n      });\n    });\n  }\n}\n","import AbstractChromeStorageService from \"./abstractions/abstract-chrome-storage-api.service\";\n\nexport default class BrowserMemoryStorageService extends AbstractChromeStorageService {\n  constructor() {\n    super(chrome.storage.session);\n  }\n}\n","export type CommonScriptInjectionDetails = {\n  /**\n   * Script injected into the document.\n   * Overridden by `mv2Details` and `mv3Details`.\n   */\n  file?: string;\n  /**\n   * Identifies the frame targeted for script injection. Defaults to the top level frame (0).\n   * Can also be set to \"all_frames\" to inject into all frames in a tab.\n   */\n  frame?: \"all_frames\" | number;\n  /**\n   * When the script executes. Defaults to \"document_start\".\n   * @see https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts\n   */\n  runAt?: \"document_start\" | \"document_end\" | \"document_idle\";\n};\n\nexport type Mv2ScriptInjectionDetails = {\n  file: string;\n};\n\nexport type Mv3ScriptInjectionDetails = {\n  file: string;\n  /**\n   * The world in which the script should be executed. Defaults to \"ISOLATED\".\n   * @see https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/ExecutionWorld\n   */\n  world?: chrome.scripting.ExecutionWorld;\n};\n\n/**\n * Configuration for injecting a script into a tab. The `file` property should present as a\n * path that is relative to the root directory of the extension build, ie \"content/script.js\".\n */\nexport type ScriptInjectionConfig = {\n  tabId: number;\n  injectDetails: CommonScriptInjectionDetails;\n  mv2Details?: Mv2ScriptInjectionDetails;\n  mv3Details?: Mv3ScriptInjectionDetails;\n};\n\nexport abstract class ScriptInjectorService {\n  abstract inject(config: ScriptInjectionConfig): Promise<void>;\n}\n","import { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\n\nimport {\n  CommonScriptInjectionDetails,\n  ScriptInjectionConfig,\n  ScriptInjectorService,\n} from \"./abstractions/script-injector.service\";\n\nexport class BrowserScriptInjectorService extends ScriptInjectorService {\n  constructor(\n    private readonly platformUtilsService: PlatformUtilsService,\n    private readonly logService: LogService,\n  ) {\n    super();\n  }\n\n  /**\n   * Facilitates the injection of a script into a tab context. Will adjust\n   * behavior between manifest v2 and v3 based on the passed configuration.\n   *\n   * @param config - The configuration for the script injection.\n   */\n  async inject(config: ScriptInjectionConfig): Promise<void> {\n    const { tabId, injectDetails, mv3Details } = config;\n    const file = this.getScriptFile(config);\n    if (!file) {\n      throw new Error(\"No file specified for script injection\");\n    }\n\n    const injectionDetails = this.buildInjectionDetails(injectDetails, file);\n\n    if (BrowserApi.isManifestVersion(3)) {\n      try {\n        await BrowserApi.executeScriptInTab(tabId, injectionDetails, {\n          world: mv3Details?.world ?? \"ISOLATED\",\n        });\n      } catch (error) {\n        // Swallow errors for host permissions, since this is believed to be a Manifest V3 Chrome bug\n        // @TODO remove when the bugged behaviour is resolved\n        if (\n          error.message !==\n          \"Cannot access contents of the page. Extension manifest must request permission to access the respective host.\"\n        ) {\n          throw error;\n        }\n\n        if (this.platformUtilsService.isDev()) {\n          this.logService.warning(\n            `BrowserApi.executeScriptInTab exception for ${injectDetails.file} in tab ${tabId}: ${error.message}`,\n          );\n        }\n      }\n\n      return;\n    }\n\n    await BrowserApi.executeScriptInTab(tabId, injectionDetails);\n  }\n\n  /**\n   * Retrieves the script file to inject based on the configuration.\n   *\n   * @param config - The configuration for the script injection.\n   */\n  private getScriptFile(config: ScriptInjectionConfig): string {\n    const { injectDetails, mv2Details, mv3Details } = config;\n\n    if (BrowserApi.isManifestVersion(3)) {\n      return mv3Details?.file ?? injectDetails?.file;\n    }\n\n    return mv2Details?.file ?? injectDetails?.file;\n  }\n\n  /**\n   * Builds the injection details for the script injection.\n   *\n   * @param injectDetails - The details for the script injection.\n   * @param file - The file to inject.\n   */\n  private buildInjectionDetails(\n    injectDetails: CommonScriptInjectionDetails,\n    file: string,\n  ): chrome.tabs.InjectDetails {\n    const { frame, runAt } = injectDetails;\n    const injectionDetails: chrome.tabs.InjectDetails = { file };\n\n    if (runAt) {\n      injectionDetails.runAt = runAt;\n    }\n\n    if (!frame) {\n      return { ...injectionDetails, frameId: 0 };\n    }\n\n    if (frame !== \"all_frames\") {\n      return { ...injectionDetails, frameId: frame };\n    }\n\n    return { ...injectionDetails, allFrames: true };\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Account } from \"./account\";\nimport { GlobalState } from \"./global-state\";\n\nexport class State<\n  TGlobalState extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> {\n  accounts: { [userId: string]: TAccount } = {};\n  globals: TGlobalState;\n\n  constructor(globals: TGlobalState) {\n    this.globals = globals;\n  }\n\n  // TODO, make Jsonify<State,TGlobalState,TAccount> work. It currently doesn't because Globals doesn't implement Jsonify.\n  static fromJSON<TGlobalState extends GlobalState, TAccount extends Account>(\n    obj: any,\n    accountDeserializer: (json: Jsonify<TAccount>) => TAccount,\n  ): State<TGlobalState, TAccount> {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new State(null), obj, {\n      accounts: State.buildAccountMapFromJSON(obj?.accounts, accountDeserializer),\n    });\n  }\n\n  private static buildAccountMapFromJSON<TAccount extends Account>(\n    jsonAccounts: { [userId: string]: Jsonify<TAccount> },\n    accountDeserializer: (json: Jsonify<TAccount>) => TAccount,\n  ) {\n    if (!jsonAccounts) {\n      return {};\n    }\n    const accounts: { [userId: string]: TAccount } = {};\n    for (const userId in jsonAccounts) {\n      accounts[userId] = accountDeserializer(jsonAccounts[userId]);\n    }\n    return accounts;\n  }\n}\n","import { firstValueFrom, map } from \"rxjs\";\nimport { Jsonify, JsonValue } from \"type-fest\";\n\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { TokenService } from \"../../auth/abstractions/token.service\";\nimport { BiometricKey } from \"../../auth/types/biometric-key\";\nimport { GeneratorOptions } from \"../../tools/generator/generator-options\";\nimport { GeneratedPasswordHistory, PasswordGeneratorOptions } from \"../../tools/generator/password\";\nimport { UsernameGeneratorOptions } from \"../../tools/generator/username\";\nimport { UserId } from \"../../types/guid\";\nimport { EnvironmentService } from \"../abstractions/environment.service\";\nimport { LogService } from \"../abstractions/log.service\";\nimport {\n  InitOptions,\n  StateService as StateServiceAbstraction,\n} from \"../abstractions/state.service\";\nimport { AbstractStorageService } from \"../abstractions/storage.service\";\nimport { HtmlStorageLocation, StorageLocation } from \"../enums\";\nimport { StateFactory } from \"../factories/state-factory\";\nimport { Utils } from \"../misc/utils\";\nimport { Account, AccountData, AccountSettings } from \"../models/domain/account\";\nimport { GlobalState } from \"../models/domain/global-state\";\nimport { State } from \"../models/domain/state\";\nimport { StorageOptions } from \"../models/domain/storage-options\";\n\nimport { MigrationRunner } from \"./migration-runner\";\n\nconst keys = {\n  state: \"state\",\n  stateVersion: \"stateVersion\",\n  global: \"global\",\n  tempAccountSettings: \"tempAccountSettings\", // used to hold account specific settings (i.e clear clipboard) between initial migration and first account authentication\n};\n\nconst partialKeys = {\n  userAutoKey: \"_user_auto\",\n  userBiometricKey: \"_user_biometric\",\n\n  autoKey: \"_masterkey_auto\",\n  biometricKey: \"_masterkey_biometric\",\n  masterKey: \"_masterkey\",\n};\n\nconst DDG_SHARED_KEY = \"DuckDuckGoSharedKey\";\n\nexport class StateService<\n  TGlobalState extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> implements StateServiceAbstraction<TAccount>\n{\n  private hasBeenInited = false;\n  protected isRecoveredSession = false;\n\n  // default account serializer, must be overridden by child class\n  protected accountDeserializer = Account.fromJSON as (json: Jsonify<TAccount>) => TAccount;\n\n  constructor(\n    protected storageService: AbstractStorageService,\n    protected secureStorageService: AbstractStorageService,\n    protected memoryStorageService: AbstractStorageService,\n    protected logService: LogService,\n    protected stateFactory: StateFactory<TGlobalState, TAccount>,\n    protected accountService: AccountService,\n    protected environmentService: EnvironmentService,\n    protected tokenService: TokenService,\n    private migrationRunner: MigrationRunner,\n  ) {}\n\n  async init(initOptions: InitOptions = {}): Promise<void> {\n    // Deconstruct and apply defaults\n    const { runMigrations = true } = initOptions;\n    if (this.hasBeenInited) {\n      return;\n    }\n\n    if (runMigrations) {\n      await this.migrationRunner.run();\n    } else {\n      // It may have been requested to not run the migrations but we should defensively not\n      // continue this method until migrations have a chance to be completed elsewhere.\n      await this.migrationRunner.waitForCompletion();\n    }\n\n    await this.state().then(async (state) => {\n      if (state == null) {\n        await this.setState(new State<TGlobalState, TAccount>(this.createGlobals()));\n      } else {\n        this.isRecoveredSession = true;\n      }\n    });\n    await this.initAccountState();\n\n    this.hasBeenInited = true;\n  }\n\n  async initAccountState() {\n    if (this.isRecoveredSession) {\n      return;\n    }\n\n    // Get all likely authenticated accounts\n    const authenticatedAccounts = await firstValueFrom(\n      this.accountService.accounts$.pipe(map((accounts) => Object.keys(accounts))),\n    );\n\n    await this.updateState(async (state) => {\n      for (const i in authenticatedAccounts) {\n        state = await this.syncAccountFromDisk(authenticatedAccounts[i]);\n      }\n\n      return state;\n    });\n  }\n\n  async syncAccountFromDisk(userId: string): Promise<State<TGlobalState, TAccount>> {\n    if (userId == null) {\n      return;\n    }\n    const diskAccount = await this.getAccountFromDisk({ userId: userId });\n    const state = await this.updateState(async (state) => {\n      if (state.accounts == null) {\n        state.accounts = {};\n      }\n      state.accounts[userId] = this.createAccount();\n      state.accounts[userId].profile = diskAccount.profile;\n      return state;\n    });\n\n    return state;\n  }\n\n  async addAccount(account: TAccount) {\n    await this.environmentService.seedUserEnvironment(account.profile.userId as UserId);\n    await this.updateState(async (state) => {\n      state.accounts[account.profile.userId] = account;\n      return state;\n    });\n    await this.scaffoldNewAccountStorage(account);\n  }\n\n  async clean(options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultInMemoryOptions());\n    await this.deAuthenticateAccount(options.userId);\n\n    await this.removeAccountFromDisk(options?.userId);\n    await this.removeAccountFromMemory(options?.userId);\n  }\n\n  /**\n   * user key when using the \"never\" option of vault timeout\n   */\n  async getUserKeyAutoUnlock(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.userAutoKey}`,\n      options,\n    );\n  }\n\n  /**\n   * user key when using the \"never\" option of vault timeout\n   */\n  async setUserKeyAutoUnlock(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.userAutoKey, value, options);\n  }\n\n  /**\n   * User's encrypted symmetric key when using biometrics\n   */\n  async getUserKeyBiometric(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.userBiometricKey}`,\n      options,\n    );\n  }\n\n  async hasUserKeyBiometric(options?: StorageOptions): Promise<boolean> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return false;\n    }\n    return await this.secureStorageService.has(\n      `${options.userId}${partialKeys.userBiometricKey}`,\n      options,\n    );\n  }\n\n  async setUserKeyBiometric(value: BiometricKey, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.userBiometricKey, value, options);\n  }\n\n  /**\n   * @deprecated Use UserKeyAuto instead\n   */\n  async setCryptoMasterKeyAuto(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.autoKey, value, options);\n  }\n\n  /**\n   * @deprecated I don't see where this is even used\n   */\n  async getCryptoMasterKeyB64(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options?.userId}${partialKeys.masterKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated I don't see where this is even used\n   */\n  async setCryptoMasterKeyB64(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.masterKey, value, options);\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async getCryptoMasterKeyBiometric(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.biometricKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async hasCryptoMasterKeyBiometric(options?: StorageOptions): Promise<boolean> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return false;\n    }\n    return await this.secureStorageService.has(\n      `${options.userId}${partialKeys.biometricKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async setCryptoMasterKeyBiometric(value: BiometricKey, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.biometricKey, value, options);\n  }\n\n  @withPrototypeForArrayMembers(GeneratedPasswordHistory)\n  async getDecryptedPasswordGenerationHistory(\n    options?: StorageOptions,\n  ): Promise<GeneratedPasswordHistory[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.data?.passwordGenerationHistory?.decrypted;\n  }\n\n  async setDecryptedPasswordGenerationHistory(\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.passwordGenerationHistory.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getDuckDuckGoSharedKey(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(DDG_SHARED_KEY, options);\n  }\n\n  async setDuckDuckGoSharedKey(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return;\n    }\n    value == null\n      ? await this.secureStorageService.remove(DDG_SHARED_KEY, options)\n      : await this.secureStorageService.save(DDG_SHARED_KEY, value, options);\n  }\n\n  async getEnableBrowserIntegration(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableBrowserIntegration ?? false\n    );\n  }\n\n  async setEnableBrowserIntegration(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableBrowserIntegration = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableBrowserIntegrationFingerprint(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableBrowserIntegrationFingerprint ?? false\n    );\n  }\n\n  async setEnableBrowserIntegrationFingerprint(\n    value: boolean,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableBrowserIntegrationFingerprint = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async setEnableDuckDuckGoBrowserIntegration(\n    value: boolean,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableDuckDuckGoBrowserIntegration = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Use UserKey instead\n   */\n  async getEncryptedCryptoSymmetricKey(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.keys.cryptoSymmetricKey.encrypted;\n  }\n\n  @withPrototypeForArrayMembers(GeneratedPasswordHistory)\n  async getEncryptedPasswordGenerationHistory(\n    options?: StorageOptions,\n  ): Promise<GeneratedPasswordHistory[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.passwordGenerationHistory?.encrypted;\n  }\n\n  async setEncryptedPasswordGenerationHistory(\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.passwordGenerationHistory.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getIsAuthenticated(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.tokenService.getAccessToken(options?.userId as UserId)) != null &&\n      (await this.getUserId(options)) != null\n    );\n  }\n\n  async getLastSync(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()))\n    )?.profile?.lastSync;\n  }\n\n  async setLastSync(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.profile.lastSync = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  async getMinimizeOnCopyToClipboard(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.minimizeOnCopyToClipboard ?? false\n    );\n  }\n\n  async setMinimizeOnCopyToClipboard(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.minimizeOnCopyToClipboard = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getPasswordGenerationOptions(options?: StorageOptions): Promise<PasswordGeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.passwordGenerationOptions;\n  }\n\n  async setPasswordGenerationOptions(\n    value: PasswordGeneratorOptions,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.passwordGenerationOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getUsernameGenerationOptions(options?: StorageOptions): Promise<UsernameGeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.usernameGenerationOptions;\n  }\n\n  async setUsernameGenerationOptions(\n    value: UsernameGeneratorOptions,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.usernameGenerationOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getGeneratorOptions(options?: StorageOptions): Promise<GeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.generatorOptions;\n  }\n\n  async setGeneratorOptions(value: GeneratorOptions, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.generatorOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getUserId(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.userId;\n  }\n\n  protected async getGlobals(options: StorageOptions): Promise<TGlobalState> {\n    let globals: TGlobalState;\n    if (this.useMemory(options.storageLocation)) {\n      globals = await this.getGlobalsFromMemory();\n    }\n\n    if (this.useDisk && globals == null) {\n      globals = await this.getGlobalsFromDisk(options);\n    }\n\n    if (globals == null) {\n      globals = this.createGlobals();\n    }\n\n    return globals;\n  }\n\n  protected async saveGlobals(globals: TGlobalState, options: StorageOptions) {\n    return this.useMemory(options.storageLocation)\n      ? this.saveGlobalsToMemory(globals)\n      : await this.saveGlobalsToDisk(globals, options);\n  }\n\n  protected async getGlobalsFromMemory(): Promise<TGlobalState> {\n    return (await this.state()).globals;\n  }\n\n  protected async getGlobalsFromDisk(options: StorageOptions): Promise<TGlobalState> {\n    return await this.storageService.get<TGlobalState>(keys.global, options);\n  }\n\n  protected async saveGlobalsToMemory(globals: TGlobalState): Promise<void> {\n    await this.updateState(async (state) => {\n      state.globals = globals;\n      return state;\n    });\n  }\n\n  protected async saveGlobalsToDisk(globals: TGlobalState, options: StorageOptions): Promise<void> {\n    if (options.useSecureStorage) {\n      await this.secureStorageService.save(keys.global, globals, options);\n    } else {\n      await this.storageService.save(keys.global, globals, options);\n    }\n  }\n\n  protected async getAccount(options: StorageOptions): Promise<TAccount> {\n    try {\n      let account: TAccount;\n      if (this.useMemory(options.storageLocation)) {\n        account = await this.getAccountFromMemory(options);\n      }\n\n      if (this.useDisk(options.storageLocation) && account == null) {\n        account = await this.getAccountFromDisk(options);\n      }\n\n      return account;\n    } catch (e) {\n      this.logService.error(e);\n    }\n  }\n\n  protected async getAccountFromMemory(options: StorageOptions): Promise<TAccount> {\n    const userId =\n      options.userId ??\n      (await firstValueFrom(\n        this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n      ));\n\n    return await this.state().then(async (state) => {\n      if (state.accounts == null) {\n        return null;\n      }\n      return state.accounts[userId];\n    });\n  }\n\n  protected async getAccountFromDisk(options: StorageOptions): Promise<TAccount> {\n    const userId =\n      options.userId ??\n      (await firstValueFrom(\n        this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n      ));\n\n    if (userId == null) {\n      return null;\n    }\n\n    const account = options?.useSecureStorage\n      ? (await this.secureStorageService.get<TAccount>(options.userId, options)) ??\n        (await this.storageService.get<TAccount>(\n          options.userId,\n          this.reconcileOptions(options, { htmlStorageLocation: HtmlStorageLocation.Local }),\n        ))\n      : await this.storageService.get<TAccount>(options.userId, options);\n    return account;\n  }\n\n  protected useMemory(storageLocation: StorageLocation) {\n    return storageLocation === StorageLocation.Memory || storageLocation === StorageLocation.Both;\n  }\n\n  protected useDisk(storageLocation: StorageLocation) {\n    return storageLocation === StorageLocation.Disk || storageLocation === StorageLocation.Both;\n  }\n\n  protected async saveAccount(\n    account: TAccount,\n    options: StorageOptions = {\n      storageLocation: StorageLocation.Both,\n      useSecureStorage: false,\n    },\n  ) {\n    return this.useMemory(options.storageLocation)\n      ? await this.saveAccountToMemory(account)\n      : await this.saveAccountToDisk(account, options);\n  }\n\n  protected async saveAccountToDisk(account: TAccount, options: StorageOptions): Promise<void> {\n    const storageLocation = options.useSecureStorage\n      ? this.secureStorageService\n      : this.storageService;\n\n    await storageLocation.save(`${options.userId}`, account, options);\n  }\n\n  protected async saveAccountToMemory(account: TAccount): Promise<void> {\n    if ((await this.getAccountFromMemory({ userId: account.profile.userId })) !== null) {\n      await this.updateState((state) => {\n        return new Promise((resolve) => {\n          state.accounts[account.profile.userId] = account;\n          resolve(state);\n        });\n      });\n    }\n  }\n\n  protected async scaffoldNewAccountStorage(account: TAccount): Promise<void> {\n    // We don't want to manipulate the referenced in memory account\n    const deepClone = JSON.parse(JSON.stringify(account));\n    await this.scaffoldNewAccountLocalStorage(deepClone);\n    await this.scaffoldNewAccountSessionStorage(deepClone);\n    await this.scaffoldNewAccountMemoryStorage(deepClone);\n  }\n\n  // TODO: There is a tech debt item for splitting up these methods - only Web uses multiple storage locations in its storageService.\n  // For now these methods exist with some redundancy to facilitate this special web requirement.\n  protected async scaffoldNewAccountLocalStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskLocalOptions(),\n      ),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    } else if (await this.storageService.has(keys.tempAccountSettings)) {\n      account.settings = await this.storageService.get<AccountSettings>(keys.tempAccountSettings);\n      await this.storageService.remove(keys.tempAccountSettings);\n    }\n\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskLocalOptions(),\n      ),\n    );\n  }\n\n  protected async scaffoldNewAccountMemoryStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskMemoryOptions(),\n      ),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    }\n    await this.storageService.save(\n      account.profile.userId,\n      account,\n      await this.defaultOnDiskMemoryOptions(),\n    );\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskMemoryOptions(),\n      ),\n    );\n  }\n\n  protected async scaffoldNewAccountSessionStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: account.profile.userId }, await this.defaultOnDiskOptions()),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    }\n    await this.storageService.save(\n      account.profile.userId,\n      account,\n      await this.defaultOnDiskMemoryOptions(),\n    );\n    await this.saveAccount(\n      account,\n      this.reconcileOptions({ userId: account.profile.userId }, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  protected reconcileOptions(\n    requestedOptions: StorageOptions,\n    defaultOptions: StorageOptions,\n  ): StorageOptions {\n    if (requestedOptions == null) {\n      return defaultOptions;\n    }\n    requestedOptions.userId = requestedOptions?.userId ?? defaultOptions.userId;\n    requestedOptions.storageLocation =\n      requestedOptions?.storageLocation ?? defaultOptions.storageLocation;\n    requestedOptions.useSecureStorage =\n      requestedOptions?.useSecureStorage ?? defaultOptions.useSecureStorage;\n    requestedOptions.htmlStorageLocation =\n      requestedOptions?.htmlStorageLocation ?? defaultOptions.htmlStorageLocation;\n    requestedOptions.keySuffix = requestedOptions?.keySuffix ?? defaultOptions.keySuffix;\n    return requestedOptions;\n  }\n\n  protected async defaultInMemoryOptions(): Promise<StorageOptions> {\n    const userId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    return {\n      storageLocation: StorageLocation.Memory,\n      userId,\n    };\n  }\n\n  protected async defaultOnDiskOptions(): Promise<StorageOptions> {\n    const userId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Session,\n      userId,\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultOnDiskLocalOptions(): Promise<StorageOptions> {\n    const userId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Local,\n      userId,\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultOnDiskMemoryOptions(): Promise<StorageOptions> {\n    const userId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Memory,\n      userId,\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultSecureStorageOptions(): Promise<StorageOptions> {\n    const userId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    return {\n      storageLocation: StorageLocation.Disk,\n      useSecureStorage: true,\n      userId,\n    };\n  }\n\n  protected async getActiveUserIdFromStorage(): Promise<string> {\n    return await firstValueFrom(this.accountService.activeAccount$.pipe(map((a) => a?.id)));\n  }\n\n  protected async removeAccountFromLocalStorage(userId: string = null): Promise<void> {\n    userId ??= await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskLocalOptions()),\n    );\n    await this.saveAccount(\n      this.resetAccount(storedAccount),\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  protected async removeAccountFromSessionStorage(userId: string = null): Promise<void> {\n    userId ??= await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskOptions()),\n    );\n    await this.saveAccount(\n      this.resetAccount(storedAccount),\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  protected async removeAccountFromSecureStorage(userId: string = null): Promise<void> {\n    userId ??= await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    await this.setUserKeyAutoUnlock(null, { userId: userId });\n    await this.setUserKeyBiometric(null, { userId: userId });\n    await this.setCryptoMasterKeyAuto(null, { userId: userId });\n    await this.setCryptoMasterKeyBiometric(null, { userId: userId });\n    await this.setCryptoMasterKeyB64(null, { userId: userId });\n  }\n\n  protected async removeAccountFromMemory(userId: string = null): Promise<void> {\n    userId ??= await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n    );\n\n    await this.updateState(async (state) => {\n      delete state.accounts[userId];\n      return state;\n    });\n  }\n\n  // settings persist even on reset, and are not affected by this method\n  protected resetAccount(account: TAccount) {\n    const persistentAccountInformation = {\n      settings: account.settings,\n    };\n    return Object.assign(this.createAccount(), persistentAccountInformation);\n  }\n\n  async clearDecryptedData(userId: UserId): Promise<void> {\n    await this.updateState(async (state) => {\n      if (userId != null && state?.accounts[userId]?.data != null) {\n        state.accounts[userId].data = new AccountData();\n      }\n\n      return state;\n    });\n  }\n\n  protected createAccount(init: Partial<TAccount> = null): TAccount {\n    return this.stateFactory.createAccount(init);\n  }\n\n  protected createGlobals(init: Partial<TGlobalState> = null): TGlobalState {\n    return this.stateFactory.createGlobal(init);\n  }\n\n  protected async deAuthenticateAccount(userId: string): Promise<void> {\n    // We must have a manual call to clear tokens as we can't leverage state provider to clean\n    // up our data as we have secure storage in the mix.\n    await this.tokenService.clearTokens(userId as UserId);\n  }\n\n  protected async removeAccountFromDisk(userId: string) {\n    await this.removeAccountFromSessionStorage(userId);\n    await this.removeAccountFromLocalStorage(userId);\n    await this.removeAccountFromSecureStorage(userId);\n  }\n\n  protected async saveSecureStorageKey<T extends JsonValue>(\n    key: string,\n    value: T,\n    options?: StorageOptions,\n  ) {\n    return value == null\n      ? await this.secureStorageService.remove(`${options.userId}${key}`, options)\n      : await this.secureStorageService.save(`${options.userId}${key}`, value, options);\n  }\n\n  protected async state(): Promise<State<TGlobalState, TAccount>> {\n    let state = await this.memoryStorageService.get<State<TGlobalState, TAccount>>(keys.state);\n    if (this.memoryStorageService.valuesRequireDeserialization) {\n      state = State.fromJSON(state, this.accountDeserializer);\n    }\n    return state;\n  }\n\n  private async setState(\n    state: State<TGlobalState, TAccount>,\n  ): Promise<State<TGlobalState, TAccount>> {\n    await this.memoryStorageService.save(keys.state, state);\n    return state;\n  }\n\n  protected async updateState(\n    stateUpdater: (state: State<TGlobalState, TAccount>) => Promise<State<TGlobalState, TAccount>>,\n  ): Promise<State<TGlobalState, TAccount>> {\n    return await this.state().then(async (state) => {\n      const updatedState = await stateUpdater(state);\n      if (updatedState == null) {\n        throw new Error(\"Attempted to update state to null value\");\n      }\n\n      return await this.setState(updatedState);\n    });\n  }\n}\n\nfunction withPrototypeForArrayMembers<T>(\n  memberConstructor: new (...args: any[]) => T,\n  memberConverter: (input: any) => T = (i) => i,\n): (\n  target: any,\n  propertyKey: string | symbol,\n  descriptor: PropertyDescriptor,\n) => { value: (...args: any[]) => Promise<T[]> } {\n  return (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) => {\n    const originalMethod = descriptor.value;\n\n    return {\n      value: function (...args: any[]) {\n        const originalResult: Promise<any[]> = originalMethod.apply(this, args);\n\n        if (!Utils.isPromise(originalResult)) {\n          throw new Error(\n            `Error applying prototype to stored value -- result is not a promise for method ${String(\n              propertyKey,\n            )}`,\n          );\n        }\n\n        return originalResult.then((result) => {\n          if (result == null) {\n            return null;\n          } else if (!(result instanceof Array)) {\n            throw new Error(\n              `Attempted to retrieve non array type from state as an array for method ${String(\n                propertyKey,\n              )}`,\n            );\n          } else {\n            return result.map((r) => {\n              return r == null ||\n                r.constructor.name === memberConstructor.prototype.constructor.name\n                ? r\n                : memberConverter(\n                    Object.create(memberConstructor.prototype, Object.getOwnPropertyDescriptors(r)),\n                  );\n            });\n          }\n        });\n      },\n    };\n  };\n}\n","import { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { AbstractStorageService } from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { StorageOptions } from \"@bitwarden/common/platform/models/domain/storage-options\";\nimport { MigrationRunner } from \"@bitwarden/common/platform/services/migration-runner\";\nimport { StateService as BaseStateService } from \"@bitwarden/common/platform/services/state.service\";\n\nimport { Account } from \"../../models/account\";\n\nimport { BrowserStateService } from \"./abstractions/browser-state.service\";\n\nexport class DefaultBrowserStateService\n  extends BaseStateService<GlobalState, Account>\n  implements BrowserStateService\n{\n  protected accountDeserializer = Account.fromJSON;\n\n  constructor(\n    storageService: AbstractStorageService,\n    secureStorageService: AbstractStorageService,\n    memoryStorageService: AbstractStorageService,\n    logService: LogService,\n    stateFactory: StateFactory<GlobalState, Account>,\n    accountService: AccountService,\n    environmentService: EnvironmentService,\n    tokenService: TokenService,\n    migrationRunner: MigrationRunner,\n  ) {\n    super(\n      storageService,\n      secureStorageService,\n      memoryStorageService,\n      logService,\n      stateFactory,\n      accountService,\n      environmentService,\n      tokenService,\n      migrationRunner,\n    );\n  }\n\n  async addAccount(account: Account) {\n    // Apply browser overrides to default account values\n    account = new Account(account);\n    await super.addAccount(account);\n  }\n\n  // Overriding the base class to prevent deleting the cache on save. We register a storage listener\n  // to delete the cache in the constructor above.\n  protected override async saveAccountToDisk(\n    account: Account,\n    options: StorageOptions,\n  ): Promise<void> {\n    const storageLocation = options.useSecureStorage\n      ? this.secureStorageService\n      : this.storageService;\n\n    await storageLocation.save(`${options.userId}`, account, options);\n  }\n}\n","import { TranslationService as TranslationServiceAbstraction } from \"../abstractions/translation.service\";\n\nexport abstract class TranslationService implements TranslationServiceAbstraction {\n  // First locale is the default (English)\n  supportedTranslationLocales: string[] = [\"en\"];\n  defaultLocale = \"en\";\n  abstract translationLocale: string;\n  collator: Intl.Collator;\n  localeNames = new Map<string, string>([\n    [\"af\", \"Afrikaans\"],\n    [\"ar\", \"العربية الفصحى\"],\n    [\"az\", \"Azərbaycanca\"],\n    [\"be\", \"Беларуская\"],\n    [\"bg\", \"български\"],\n    [\"bn\", \"বাংলা\"],\n    [\"bs\", \"bosanski jezik\"],\n    [\"ca\", \"català\"],\n    [\"cs\", \"čeština\"],\n    [\"cy\", \"Cymraeg, y Gymraeg\"],\n    [\"da\", \"dansk\"],\n    [\"de\", \"Deutsch\"],\n    [\"el\", \"Ελληνικά\"],\n    [\"en\", \"English\"],\n    [\"en-GB\", \"English (British)\"],\n    [\"en-IN\", \"English (India)\"],\n    [\"eo\", \"Esperanto\"],\n    [\"es\", \"español\"],\n    [\"et\", \"eesti\"],\n    [\"eu\", \"euskara\"],\n    [\"fa\", \"فارسی\"],\n    [\"fi\", \"suomi\"],\n    [\"fil\", \"Wikang Filipino\"],\n    [\"fr\", \"français\"],\n    [\"gl\", \"galego\"],\n    [\"he\", \"עברית\"],\n    [\"hi\", \"हिन्दी\"],\n    [\"hr\", \"hrvatski\"],\n    [\"hu\", \"magyar\"],\n    [\"id\", \"Bahasa Indonesia\"],\n    [\"it\", \"italiano\"],\n    [\"ja\", \"日本語\"],\n    [\"ka\", \"ქართული\"],\n    [\"km\", \"ខ្មែរ, ខេមរភាសា, ភាសាខ្មែរ\"],\n    [\"kn\", \"ಕನ್ನಡ\"],\n    [\"ko\", \"한국어\"],\n    [\"lt\", \"lietuvių kalba\"],\n    [\"lv\", \"Latvietis\"],\n    [\"me\", \"црногорски\"],\n    [\"ml\", \"മലയാളം\"],\n    [\"mr\", \"मराठी\"],\n    [\"my\", \"ဗမာစကား\"],\n    [\"nb\", \"norsk (bokmål)\"],\n    [\"ne\", \"नेपाली\"],\n    [\"nl\", \"Nederlands\"],\n    [\"nn\", \"Norsk Nynorsk\"],\n    [\"or\", \"ଓଡ଼ିଆ\"],\n    [\"pl\", \"polski\"],\n    [\"pt-BR\", \"português do Brasil\"],\n    [\"pt-PT\", \"português\"],\n    [\"ro\", \"română\"],\n    [\"ru\", \"русский\"],\n    [\"si\", \"සිංහල\"],\n    [\"sk\", \"slovenčina\"],\n    [\"sl\", \"Slovenski jezik, Slovenščina\"],\n    [\"sr\", \"Српски\"],\n    [\"sv\", \"svenska\"],\n    [\"te\", \"తెలుగు\"],\n    [\"th\", \"ไทย\"],\n    [\"tr\", \"Türkçe\"],\n    [\"uk\", \"українська\"],\n    [\"vi\", \"Tiếng Việt\"],\n    [\"zh-CN\", \"中文（中国大陆）\"],\n    [\"zh-TW\", \"中文（台灣）\"],\n  ]);\n\n  protected inited: boolean;\n  protected defaultMessages: any = {};\n  protected localeMessages: any = {};\n\n  constructor(\n    protected systemLanguage: string,\n    protected localesDirectory: string,\n    protected getLocalesJson: (formattedLocale: string) => Promise<any>,\n  ) {\n    this.systemLanguage = systemLanguage.replace(\"_\", \"-\");\n  }\n\n  async init(locale?: string) {\n    if (this.inited) {\n      throw new Error(\"i18n already initialized.\");\n    }\n    if (this.supportedTranslationLocales == null || this.supportedTranslationLocales.length === 0) {\n      throw new Error(\"supportedTranslationLocales not set.\");\n    }\n\n    this.inited = true;\n    this.translationLocale = locale != null ? locale : this.systemLanguage;\n\n    try {\n      this.collator = new Intl.Collator(this.translationLocale, {\n        numeric: true,\n        sensitivity: \"base\",\n      });\n    } catch {\n      this.collator = null;\n    }\n\n    if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n      this.translationLocale = this.translationLocale.slice(0, 2);\n\n      if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n        this.translationLocale = this.defaultLocale;\n      }\n    }\n\n    if (this.localesDirectory != null) {\n      await this.loadMessages(this.translationLocale, this.localeMessages);\n      if (this.translationLocale !== this.defaultLocale) {\n        await this.loadMessages(this.defaultLocale, this.defaultMessages);\n      }\n    }\n  }\n\n  t(id: string, p1?: string, p2?: string, p3?: string): string {\n    return this.translate(id, p1, p2, p3);\n  }\n\n  translate(id: string, p1?: string | number, p2?: string | number, p3?: string | number): string {\n    let result: string;\n    // eslint-disable-next-line\n    if (this.localeMessages.hasOwnProperty(id) && this.localeMessages[id]) {\n      result = this.localeMessages[id];\n      // eslint-disable-next-line\n    } else if (this.defaultMessages.hasOwnProperty(id) && this.defaultMessages[id]) {\n      result = this.defaultMessages[id];\n    } else {\n      result = \"\";\n    }\n\n    if (result !== \"\") {\n      if (p1 != null) {\n        result = result.split(\"__$1__\").join(p1.toString());\n      }\n      if (p2 != null) {\n        result = result.split(\"__$2__\").join(p2.toString());\n      }\n      if (p3 != null) {\n        result = result.split(\"__$3__\").join(p3.toString());\n      }\n    }\n\n    return result;\n  }\n\n  protected async loadMessages(locale: string, messagesObj: any): Promise<any> {\n    const formattedLocale = locale.replace(\"-\", \"_\");\n    const locales = await this.getLocalesJson(formattedLocale);\n    for (const prop in locales) {\n      // eslint-disable-next-line\n      if (!locales.hasOwnProperty(prop)) {\n        continue;\n      }\n      messagesObj[prop] = locales[prop].message;\n\n      if (locales[prop].placeholders) {\n        for (const placeProp in locales[prop].placeholders) {\n          if (\n            !locales[prop].placeholders.hasOwnProperty(placeProp) || // eslint-disable-line\n            !locales[prop].placeholders[placeProp].content\n          ) {\n            continue;\n          }\n\n          const replaceToken = \"\\\\$\" + placeProp.toUpperCase() + \"\\\\$\";\n          let replaceContent = locales[prop].placeholders[placeProp].content;\n          if (replaceContent === \"$1\" || replaceContent === \"$2\" || replaceContent === \"$3\") {\n            replaceContent = \"__$\" + replaceContent + \"__\";\n          }\n          messagesObj[prop] = messagesObj[prop].replace(\n            new RegExp(replaceToken, \"g\"),\n            replaceContent,\n          );\n        }\n      }\n    }\n  }\n}\n","import { Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { I18nService as I18nServiceAbstraction } from \"../abstractions/i18n.service\";\nimport { GlobalState, GlobalStateProvider, KeyDefinition, TRANSLATION_DISK } from \"../state\";\n\nimport { TranslationService } from \"./translation.service\";\n\nconst LOCALE_KEY = new KeyDefinition<string>(TRANSLATION_DISK, \"locale\", {\n  deserializer: (value) => value,\n});\n\nexport class I18nService extends TranslationService implements I18nServiceAbstraction {\n  translationLocale: string;\n  protected translationLocaleState: GlobalState<string>;\n  userSetLocale$: Observable<string | undefined>;\n  locale$: Observable<string>;\n\n  constructor(\n    protected systemLanguage: string,\n    protected localesDirectory: string,\n    protected getLocalesJson: (formattedLocale: string) => Promise<any>,\n    globalStateProvider: GlobalStateProvider,\n  ) {\n    super(systemLanguage, localesDirectory, getLocalesJson);\n    this.translationLocaleState = globalStateProvider.get(LOCALE_KEY);\n    this.userSetLocale$ = this.translationLocaleState.state$;\n    this.locale$ = this.userSetLocale$.pipe(map((locale) => locale ?? this.translationLocale));\n  }\n\n  async setLocale(locale: string): Promise<void> {\n    await this.translationLocaleState.update(() => locale);\n  }\n\n  override async init() {\n    const storedLocale = await firstValueFrom(this.translationLocaleState.state$);\n    await super.init(storedLocale);\n  }\n}\n","import { I18nService as BaseI18nService } from \"@bitwarden/common/platform/services/i18n.service\";\nimport { GlobalStateProvider } from \"@bitwarden/common/platform/state\";\n\nexport default class I18nService extends BaseI18nService {\n  constructor(systemLanguage: string, globalStateProvider: GlobalStateProvider) {\n    super(\n      systemLanguage,\n      null,\n      async (formattedLocale: string) => {\n        // Deprecated\n        const file = await fetch(this.localesDirectory + formattedLocale + \"/messages.json\");\n        return await file.json();\n      },\n      globalStateProvider,\n    );\n\n    // Please leave 'en' where it is, as it's our fallback language in case no translation can be found\n    this.supportedTranslationLocales = [\n      \"en\",\n      \"ar\",\n      \"az\",\n      \"be\",\n      \"bg\",\n      \"bn\",\n      \"bs\",\n      \"ca\",\n      \"cs\",\n      \"cy\",\n      \"da\",\n      \"de\",\n      \"el\",\n      \"en-GB\",\n      \"en-IN\",\n      \"es\",\n      \"et\",\n      \"eu\",\n      \"fa\",\n      \"fi\",\n      \"fil\",\n      \"fr\",\n      \"gl\",\n      \"he\",\n      \"hi\",\n      \"hr\",\n      \"hu\",\n      \"id\",\n      \"it\",\n      \"ja\",\n      \"ka\",\n      \"km\",\n      \"kn\",\n      \"ko\",\n      \"lt\",\n      \"lv\",\n      \"ml\",\n      \"mr\",\n      \"my\",\n      \"nb\",\n      \"ne\",\n      \"nl\",\n      \"nn\",\n      \"or\",\n      \"pl\",\n      \"pt-BR\",\n      \"pt-PT\",\n      \"ro\",\n      \"ru\",\n      \"si\",\n      \"sk\",\n      \"sl\",\n      \"sr\",\n      \"sv\",\n      \"te\",\n      \"th\",\n      \"tr\",\n      \"uk\",\n      \"vi\",\n      \"zh-CN\",\n      \"zh-TW\",\n    ];\n  }\n\n  t(id: string, p1?: string, p2?: string, p3?: string): string {\n    return this.translate(id, p1, p2, p3);\n  }\n\n  translate(id: string, p1?: string, p2?: string, p3?: string): string {\n    if (this.localesDirectory == null) {\n      const placeholders: string[] = [];\n      if (p1 != null) {\n        placeholders.push(p1);\n      }\n      if (p2 != null) {\n        placeholders.push(p2);\n      }\n      if (p3 != null) {\n        placeholders.push(p3);\n      }\n\n      if (placeholders.length) {\n        return chrome.i18n.getMessage(id, placeholders);\n      } else {\n        return chrome.i18n.getMessage(id);\n      }\n    }\n\n    return super.translate(id, p1, p2, p3);\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { StorageOptions } from \"../models/domain/storage-options\";\n\nexport type StorageUpdateType = \"save\" | \"remove\";\nexport type StorageUpdate = {\n  key: string;\n  updateType: StorageUpdateType;\n};\n\nexport interface ObservableStorageService {\n  /**\n   * Provides an {@link Observable} that represents a stream of updates that\n   * have happened in this storage service or in the storage this service provides\n   * an interface to.\n   */\n  get updates$(): Observable<StorageUpdate>;\n}\n\nexport abstract class AbstractStorageService {\n  abstract get valuesRequireDeserialization(): boolean;\n  abstract get<T>(key: string, options?: StorageOptions): Promise<T>;\n  abstract has(key: string, options?: StorageOptions): Promise<boolean>;\n  abstract save<T>(key: string, obj: T, options?: StorageOptions): Promise<void>;\n  abstract remove(key: string, options?: StorageOptions): Promise<void>;\n}\n","export function portName(storageLocation: chrome.storage.StorageArea) {\n  switch (storageLocation) {\n    case chrome.storage.local:\n      return \"local\";\n    case chrome.storage.sync:\n      return \"sync\";\n    case chrome.storage.session:\n      return \"session\";\n    default:\n      throw new Error(\"Unknown storage location\");\n  }\n}\n","import { Subject } from \"rxjs\";\n\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n  StorageUpdate,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { Lazy } from \"@bitwarden/common/platform/misc/lazy\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { StorageOptions } from \"@bitwarden/common/platform/models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\nimport { MemoryStoragePortMessage } from \"../storage/port-messages\";\nimport { portName } from \"../storage/port-name\";\n\nexport class LocalBackedSessionStorageService\n  extends AbstractStorageService\n  implements ObservableStorageService\n{\n  private ports: Set<chrome.runtime.Port> = new Set([]);\n  private cache: Record<string, unknown> = {};\n  private updatesSubject = new Subject<StorageUpdate>();\n  readonly valuesRequireDeserialization = true;\n  updates$ = this.updatesSubject.asObservable();\n\n  constructor(\n    private readonly sessionKey: Lazy<Promise<SymmetricCryptoKey>>,\n    private readonly localStorage: AbstractStorageService,\n    private readonly encryptService: EncryptService,\n    private readonly platformUtilsService: PlatformUtilsService,\n    private readonly logService: LogService,\n  ) {\n    super();\n\n    BrowserApi.addListener(chrome.runtime.onConnect, (port) => {\n      if (port.name !== portName(chrome.storage.session)) {\n        return;\n      }\n\n      this.ports.add(port);\n\n      const listenerCallback = this.onMessageFromForeground.bind(this);\n      port.onDisconnect.addListener(() => {\n        this.ports.delete(port);\n        port.onMessage.removeListener(listenerCallback);\n      });\n      port.onMessage.addListener(listenerCallback);\n      // Initialize the new memory storage service with existing data\n      this.sendMessageTo(port, {\n        action: \"initialization\",\n        data: Array.from(Object.keys(this.cache)),\n      });\n      this.updates$.subscribe((update) => {\n        this.broadcastMessage({\n          action: \"subject_update\",\n          data: update,\n        });\n      });\n    });\n  }\n\n  async get<T>(key: string, options?: StorageOptions): Promise<T> {\n    if (this.cache[key] !== undefined) {\n      return this.cache[key] as T;\n    }\n\n    const value = await this.getLocalSessionValue(await this.sessionKey.get(), key);\n\n    this.cache[key] = value;\n    return value as T;\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  async save<T>(key: string, obj: T): Promise<void> {\n    // This is for observation purposes only. At some point, we don't want to write to local session storage if the value is the same.\n    if (this.platformUtilsService.isDev()) {\n      const existingValue = this.cache[key] as T;\n      try {\n        if (this.compareValues<T>(existingValue, obj)) {\n          this.logService.warning(\n            `Possible unnecessary write to local session storage. Key: ${key}`,\n          );\n          this.logService.warning(obj as any);\n        }\n      } catch (err) {\n        this.logService.warning(`Error while comparing values for key: ${key}`);\n        this.logService.warning(err);\n      }\n    }\n\n    if (obj == null) {\n      return await this.remove(key);\n    }\n\n    this.cache[key] = obj;\n    await this.updateLocalSessionValue(key, obj);\n    this.updatesSubject.next({ key, updateType: \"save\" });\n  }\n\n  async remove(key: string): Promise<void> {\n    this.cache[key] = null;\n    await this.updateLocalSessionValue(key, null);\n    this.updatesSubject.next({ key, updateType: \"remove\" });\n  }\n\n  private async getLocalSessionValue(encKey: SymmetricCryptoKey, key: string): Promise<unknown> {\n    const local = await this.localStorage.get<string>(this.sessionStorageKey(key));\n    if (local == null) {\n      return null;\n    }\n\n    const valueJson = await this.encryptService.decryptToUtf8(new EncString(local), encKey);\n    if (valueJson == null) {\n      // error with decryption, value is lost, delete state and start over\n      await this.localStorage.remove(this.sessionStorageKey(key));\n      return null;\n    }\n\n    return JSON.parse(valueJson);\n  }\n\n  private async updateLocalSessionValue(key: string, value: unknown): Promise<void> {\n    if (value == null) {\n      await this.localStorage.remove(this.sessionStorageKey(key));\n      return;\n    }\n\n    const valueJson = JSON.stringify(value);\n    const encValue = await this.encryptService.encrypt(valueJson, await this.sessionKey.get());\n    await this.localStorage.save(this.sessionStorageKey(key), encValue.encryptedString);\n  }\n\n  private async onMessageFromForeground(\n    message: MemoryStoragePortMessage,\n    port: chrome.runtime.Port,\n  ) {\n    if (message.originator === \"background\") {\n      return;\n    }\n\n    let result: unknown = null;\n\n    switch (message.action) {\n      case \"get\":\n      case \"has\": {\n        result = await this[message.action](message.key);\n        break;\n      }\n      case \"save\":\n        await this.save(message.key, JSON.parse((message.data as string) ?? null) as unknown);\n        break;\n      case \"remove\":\n        await this.remove(message.key);\n        break;\n    }\n\n    this.sendMessageTo(port, {\n      id: message.id,\n      key: message.key,\n      data: JSON.stringify(result),\n    });\n  }\n\n  protected broadcastMessage(data: Omit<MemoryStoragePortMessage, \"originator\">) {\n    this.ports.forEach((port) => {\n      this.sendMessageTo(port, data);\n    });\n  }\n\n  private sendMessageTo(\n    port: chrome.runtime.Port,\n    data: Omit<MemoryStoragePortMessage, \"originator\">,\n  ) {\n    port.postMessage({\n      ...data,\n      originator: \"background\",\n    });\n  }\n\n  private sessionStorageKey(key: string) {\n    return `session_${key}`;\n  }\n\n  private compareValues<T>(value1: T, value2: T): boolean {\n    try {\n      if (value1 == null && value2 == null) {\n        return true;\n      }\n\n      if (value1 && value2 == null) {\n        return false;\n      }\n\n      if (value1 == null && value2) {\n        return false;\n      }\n\n      if (typeof value1 !== \"object\" || typeof value2 !== \"object\") {\n        return value1 === value2;\n      }\n\n      return JSON.stringify(value1) === JSON.stringify(value2);\n    } catch (e) {\n      this.logService.error(\n        `error comparing values\\n${JSON.stringify(value1)}\\n${JSON.stringify(value2)}`,\n      );\n      return true;\n    }\n  }\n}\n","import { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\n\nimport { OffscreenDocumentService } from \"../../offscreen-document/abstractions/offscreen-document\";\n\nimport { BrowserPlatformUtilsService } from \"./browser-platform-utils.service\";\n\nexport class BackgroundPlatformUtilsService extends BrowserPlatformUtilsService {\n  constructor(\n    private messagingService: MessagingService,\n    clipboardWriteCallback: (clipboardValue: string, clearMs: number) => void,\n    biometricCallback: () => Promise<boolean>,\n    win: Window & typeof globalThis,\n    offscreenDocumentService: OffscreenDocumentService,\n  ) {\n    super(clipboardWriteCallback, biometricCallback, win, offscreenDocumentService);\n  }\n\n  override showToast(\n    type: \"error\" | \"success\" | \"warning\" | \"info\",\n    title: string,\n    text: string | string[],\n    options?: any,\n  ): void {\n    this.messagingService.send(\"showToast\", {\n      text: text,\n      title: title,\n      type: type,\n      options: options,\n    });\n  }\n}\n","import { Subject } from \"rxjs\";\n\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n  StorageUpdate,\n} from \"../../abstractions/storage.service\";\n\nexport class MemoryStorageService\n  extends AbstractStorageService\n  implements ObservableStorageService\n{\n  protected store: Record<string, string> = {};\n  private updatesSubject = new Subject<StorageUpdate>();\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n  get updates$() {\n    return this.updatesSubject.asObservable();\n  }\n\n  get<T>(key: string): Promise<T> {\n    const json = this.store[key];\n    if (json) {\n      const obj = JSON.parse(json as string);\n      return Promise.resolve(obj as T);\n    }\n    return Promise.resolve(null);\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  save<T>(key: string, obj: T): Promise<void> {\n    if (obj == null) {\n      return this.remove(key);\n    }\n    // TODO: Remove once foreground/background contexts are separated in browser\n    // Needed to ensure ownership of all memory by the context running the storage service\n    this.store[key] = JSON.stringify(obj);\n    this.updatesSubject.next({ key, updateType: \"save\" });\n    return Promise.resolve();\n  }\n\n  remove(key: string): Promise<void> {\n    delete this.store[key];\n    this.updatesSubject.next({ key, updateType: \"remove\" });\n    return Promise.resolve();\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Implementation for memory storage specifically for browser backgrounds\nimport { MemoryStorageService } from \"@bitwarden/common/platform/state/storage/memory-storage.service\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\n\nimport { MemoryStoragePortMessage } from \"./port-messages\";\nimport { portName } from \"./port-name\";\n\nexport class BackgroundMemoryStorageService extends MemoryStorageService {\n  private _ports: chrome.runtime.Port[] = [];\n\n  constructor() {\n    super();\n\n    BrowserApi.addListener(chrome.runtime.onConnect, (port) => {\n      if (port.name !== portName(chrome.storage.session)) {\n        return;\n      }\n\n      this._ports.push(port);\n\n      const listenerCallback = this.onMessageFromForeground.bind(this);\n      port.onDisconnect.addListener(() => {\n        this._ports.splice(this._ports.indexOf(port), 1);\n        port.onMessage.removeListener(listenerCallback);\n      });\n      port.onMessage.addListener(listenerCallback);\n      // Initialize the new memory storage service with existing data\n      this.sendMessageTo(port, {\n        action: \"initialization\",\n        data: Array.from(Object.keys(this.store)),\n      });\n    });\n    this.updates$.subscribe((update) => {\n      this.broadcastMessage({\n        action: \"subject_update\",\n        data: update,\n      });\n    });\n  }\n\n  private async onMessageFromForeground(\n    message: MemoryStoragePortMessage,\n    port: chrome.runtime.Port,\n  ) {\n    if (message.originator === \"background\") {\n      return;\n    }\n\n    let result: unknown = null;\n\n    switch (message.action) {\n      case \"get\":\n      case \"has\": {\n        result = await this[message.action](message.key);\n        break;\n      }\n      case \"save\":\n        await this.save(message.key, JSON.parse((message.data as string) ?? null) as unknown);\n        break;\n      case \"remove\":\n        await this.remove(message.key);\n        break;\n    }\n\n    this.sendMessageTo(port, {\n      id: message.id,\n      key: message.key,\n      data: JSON.stringify(result),\n    });\n  }\n\n  private broadcastMessage(data: Omit<MemoryStoragePortMessage, \"originator\">) {\n    this._ports.forEach((port) => {\n      this.sendMessageTo(port, data);\n    });\n  }\n\n  private sendMessageTo(\n    port: chrome.runtime.Port,\n    data: Omit<MemoryStoragePortMessage, \"originator\">,\n  ) {\n    port.postMessage({\n      ...data,\n      originator: \"background\",\n    });\n  }\n}\n","import { AbstractStorageService, ObservableStorageService } from \"../abstractions/storage.service\";\n// eslint-disable-next-line import/no-restricted-paths\nimport { ClientLocations, StorageLocation } from \"../state/state-definition\";\n\nexport type PossibleLocation = StorageLocation | ClientLocations[keyof ClientLocations];\n\n/**\n * A provider for getting client specific computed storage locations and services.\n */\nexport class StorageServiceProvider {\n  constructor(\n    protected readonly diskStorageService: AbstractStorageService & ObservableStorageService,\n    protected readonly memoryStorageService: AbstractStorageService & ObservableStorageService,\n  ) {}\n\n  /**\n   * Computes the location and corresponding service for a given client.\n   *\n   * **NOTE** The default implementation does not respect client overrides and if clients\n   * have special overrides they are responsible for implementing this service.\n   * @param defaultLocation The default location to use if no client specific override is preferred.\n   * @param overrides Client specific overrides\n   * @returns The computed storage location and corresponding storage service to use to get/store state.\n   * @throws If there is no configured storage service for the given inputs.\n   */\n  get(\n    defaultLocation: PossibleLocation,\n    overrides: Partial<ClientLocations>,\n  ): [location: PossibleLocation, service: AbstractStorageService & ObservableStorageService] {\n    switch (defaultLocation) {\n      case \"disk\":\n        return [defaultLocation, this.diskStorageService];\n      case \"memory\":\n        return [defaultLocation, this.memoryStorageService];\n      default:\n        throw new Error(`Unexpected location: ${defaultLocation}`);\n    }\n  }\n}\n","import {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport {\n  PossibleLocation,\n  StorageServiceProvider,\n} from \"@bitwarden/common/platform/services/storage-service.provider\";\n// eslint-disable-next-line import/no-restricted-paths\nimport { ClientLocations } from \"@bitwarden/common/platform/state/state-definition\";\n\nexport class BrowserStorageServiceProvider extends StorageServiceProvider {\n  constructor(\n    diskStorageService: AbstractStorageService & ObservableStorageService,\n    limitedMemoryStorageService: AbstractStorageService & ObservableStorageService,\n    private largeObjectMemoryStorageService: AbstractStorageService & ObservableStorageService,\n  ) {\n    super(diskStorageService, limitedMemoryStorageService);\n  }\n\n  override get(\n    defaultLocation: PossibleLocation,\n    overrides: Partial<ClientLocations>,\n  ): [location: PossibleLocation, service: AbstractStorageService & ObservableStorageService] {\n    const location = overrides[\"browser\"] ?? defaultLocation;\n    switch (location) {\n      case \"memory-large-object\":\n        return [\"memory-large-object\", this.largeObjectMemoryStorageService];\n      default:\n        // Pass in computed location to super because they could have\n        // override default \"disk\" with web \"memory\".\n        return super.get(location, overrides);\n    }\n  }\n}\n","import { Observable, Subject, filter, firstValueFrom, map } from \"rxjs\";\n\nimport {\n  AbstractStorageService,\n  StorageUpdate,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { fromChromeEvent } from \"../browser/from-chrome-event\";\n\nimport { MemoryStoragePortMessage } from \"./port-messages\";\nimport { portName } from \"./port-name\";\n\nexport class ForegroundMemoryStorageService extends AbstractStorageService {\n  private _port: chrome.runtime.Port;\n  private _backgroundResponses$: Observable<MemoryStoragePortMessage>;\n  private updatesSubject = new Subject<StorageUpdate>();\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n  updates$;\n\n  constructor(private partitionName?: string) {\n    super();\n\n    this.updates$ = this.updatesSubject.asObservable();\n\n    let name = portName(chrome.storage.session);\n    if (this.partitionName) {\n      name = `${name}_${this.partitionName}`;\n    }\n    this._port = chrome.runtime.connect({ name });\n    this._backgroundResponses$ = fromChromeEvent(this._port.onMessage).pipe(\n      map(([message]) => message),\n      filter((message) => message.originator === \"background\"),\n    );\n\n    this._backgroundResponses$\n      .pipe(\n        filter(\n          (message) => message.action === \"subject_update\" || message.action === \"initialization\",\n        ),\n      )\n      .subscribe((message) => {\n        switch (message.action) {\n          case \"initialization\":\n            this.handleInitialize(message.data as string[]); // Map entries as array\n            break;\n          case \"subject_update\":\n            this.handleSubjectUpdate(message.data as StorageUpdate);\n            break;\n          default:\n            throw new Error(`Unknown action: ${message.action}`);\n        }\n      });\n  }\n\n  async get<T>(key: string): Promise<T> {\n    return await this.delegateToBackground<T>(\"get\", key);\n  }\n  async has(key: string): Promise<boolean> {\n    return await this.delegateToBackground<boolean>(\"has\", key);\n  }\n  async save<T>(key: string, obj: T): Promise<void> {\n    await this.delegateToBackground<T>(\"save\", key, obj);\n  }\n  async remove(key: string): Promise<void> {\n    await this.delegateToBackground<void>(\"remove\", key);\n  }\n\n  private async delegateToBackground<T>(\n    action: MemoryStoragePortMessage[\"action\"],\n    key: string,\n    data?: T,\n  ): Promise<T> {\n    const id = Utils.newGuid();\n    // listen for response before request\n    const response = firstValueFrom(\n      this._backgroundResponses$.pipe(\n        filter((message) => message.id === id),\n        map((message) => JSON.parse((message.data as string) ?? null) as T),\n      ),\n    );\n\n    this.sendMessage({\n      id: id,\n      key: key,\n      action: action,\n      data: JSON.stringify(data),\n    });\n\n    const result = await response;\n    return result;\n  }\n\n  private sendMessage(data: Omit<MemoryStoragePortMessage, \"originator\">) {\n    this._port.postMessage({\n      ...data,\n      originator: \"foreground\",\n    });\n  }\n\n  private handleInitialize(data: string[]) {\n    // TODO: this isn't a save, but we don't have a better indicator for this\n    data.forEach((key) => {\n      this.updatesSubject.next({ key, updateType: \"save\" });\n    });\n  }\n\n  private handleSubjectUpdate(data: StorageUpdate) {\n    this.updatesSubject.next(data);\n  }\n}\n","import { Observable, concatMap, filter } from \"rxjs\";\n\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport {\n  CommandDefinition,\n  MessageListener,\n  MessageSender,\n  isExternalMessage,\n} from \"@bitwarden/common/platform/messaging\";\nimport { SyncService } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\n\nimport { DO_FULL_SYNC } from \"./foreground-sync.service\";\n\nexport type FullSyncFinishedMessage = {\n  successfully: boolean;\n  errorMessage: string;\n  requestId: string;\n};\n\nexport const FULL_SYNC_FINISHED = new CommandDefinition<FullSyncFinishedMessage>(\n  \"fullSyncFinished\",\n);\n\nexport class SyncServiceListener {\n  constructor(\n    private readonly syncService: SyncService,\n    private readonly messageListener: MessageListener,\n    private readonly messageSender: MessageSender,\n    private readonly logService: LogService,\n  ) {}\n\n  listener$(): Observable<void> {\n    return this.messageListener.messages$(DO_FULL_SYNC).pipe(\n      filter((message) => isExternalMessage(message)),\n      concatMap(async ({ forceSync, allowThrowOnError, requestId }) => {\n        await this.doFullSync(forceSync, allowThrowOnError, requestId);\n      }),\n    );\n  }\n\n  private async doFullSync(forceSync: boolean, allowThrowOnError: boolean, requestId: string) {\n    try {\n      const result = await this.syncService.fullSync(forceSync, allowThrowOnError);\n      this.messageSender.send(FULL_SYNC_FINISHED, {\n        successfully: result,\n        errorMessage: null,\n        requestId,\n      });\n    } catch (err) {\n      this.logService.warning(\"Error while doing full sync in SyncServiceListener\", err);\n      this.messageSender.send(FULL_SYNC_FINISHED, {\n        successfully: false,\n        errorMessage: err?.message ?? \"Unknown Sync Error\",\n        requestId,\n      });\n    }\n  }\n}\n","import { filter, firstValueFrom, of, timeout } from \"rxjs\";\n\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport {\n  CommandDefinition,\n  MessageListener,\n  MessageSender,\n} from \"@bitwarden/common/platform/messaging\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CoreSyncService } from \"@bitwarden/common/platform/sync/internal\";\nimport { SendApiService } from \"@bitwarden/common/tools/send/services/send-api.service.abstraction\";\nimport { InternalSendService } from \"@bitwarden/common/tools/send/services/send.service.abstraction\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderApiServiceAbstraction } from \"@bitwarden/common/vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\n\nimport { FULL_SYNC_FINISHED } from \"./sync-service.listener\";\n\nexport type FullSyncMessage = { forceSync: boolean; allowThrowOnError: boolean; requestId: string };\n\nexport const DO_FULL_SYNC = new CommandDefinition<FullSyncMessage>(\"doFullSync\");\n\nexport class ForegroundSyncService extends CoreSyncService {\n  constructor(\n    stateService: StateService,\n    folderService: InternalFolderService,\n    folderApiService: FolderApiServiceAbstraction,\n    messageSender: MessageSender,\n    logService: LogService,\n    cipherService: CipherService,\n    collectionService: CollectionService,\n    apiService: ApiService,\n    accountService: AccountService,\n    authService: AuthService,\n    sendService: InternalSendService,\n    sendApiService: SendApiService,\n    private readonly messageListener: MessageListener,\n  ) {\n    super(\n      stateService,\n      folderService,\n      folderApiService,\n      messageSender,\n      logService,\n      cipherService,\n      collectionService,\n      apiService,\n      accountService,\n      authService,\n      sendService,\n      sendApiService,\n    );\n  }\n\n  async fullSync(forceSync: boolean, allowThrowOnError: boolean = false): Promise<boolean> {\n    this.syncInProgress = true;\n    try {\n      const requestId = Utils.newGuid();\n      const syncCompletedPromise = firstValueFrom(\n        this.messageListener.messages$(FULL_SYNC_FINISHED).pipe(\n          filter((m) => m.requestId === requestId),\n          timeout({\n            first: 30_000,\n            // If we haven't heard back in 30 seconds, just pretend we heard back about an unsuccesful sync.\n            with: () => {\n              this.logService.warning(\n                \"ForegroundSyncService did not receive a message back in a reasonable time.\",\n              );\n              return of({ successfully: false, errorMessage: \"Sync timed out.\" });\n            },\n          }),\n        ),\n      );\n      this.messageSender.send(DO_FULL_SYNC, { forceSync, allowThrowOnError, requestId });\n      const result = await syncCompletedPromise;\n\n      if (allowThrowOnError && result.errorMessage != null) {\n        throw new Error(result.errorMessage);\n      }\n\n      return result.successfully;\n    } finally {\n      this.syncInProgress = false;\n    }\n  }\n}\n","import { map, share } from \"rxjs\";\n\nimport { Message } from \"@bitwarden/common/platform/messaging\";\nimport { tagAsExternal } from \"@bitwarden/common/platform/messaging/internal\";\n\nimport { fromChromeEvent } from \"../browser/from-chrome-event\";\n\n/**\n * Creates an observable that listens to messages through `chrome.runtime.onMessage`.\n * @returns An observable stream of messages.\n */\nexport const fromChromeRuntimeMessaging = () => {\n  return fromChromeEvent(chrome.runtime.onMessage).pipe(\n    map(([message, sender]) => {\n      message ??= {};\n\n      // Force the sender onto the message as long as we won't overwrite anything\n      if (!(\"webExtSender\" in message)) {\n        message.webExtSender = sender;\n      }\n\n      return message;\n    }),\n    tagAsExternal<Message<Record<string, unknown>>>(),\n    share(),\n  );\n};\n","import { combineLatest, filter, firstValueFrom, map, switchMap, timeout } from \"rxjs\";\n\nimport { LogoutReason } from \"@bitwarden/auth/common\";\n\nimport { SearchService } from \"../../abstractions/search.service\";\nimport { VaultTimeoutSettingsService } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { VaultTimeoutService as VaultTimeoutServiceAbstraction } from \"../../abstractions/vault-timeout/vault-timeout.service\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"../../auth/abstractions/master-password.service.abstraction\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { MessagingService } from \"../../platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"../../platform/abstractions/platform-utils.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { StateEventRunnerService } from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { CipherService } from \"../../vault/abstractions/cipher.service\";\nimport { CollectionService } from \"../../vault/abstractions/collection.service\";\nimport { FolderService } from \"../../vault/abstractions/folder/folder.service.abstraction\";\n\nexport class VaultTimeoutService implements VaultTimeoutServiceAbstraction {\n  private inited = false;\n\n  constructor(\n    private accountService: AccountService,\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    private cipherService: CipherService,\n    private folderService: FolderService,\n    private collectionService: CollectionService,\n    protected platformUtilsService: PlatformUtilsService,\n    private messagingService: MessagingService,\n    private searchService: SearchService,\n    private stateService: StateService,\n    private authService: AuthService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n    private stateEventRunnerService: StateEventRunnerService,\n    private lockedCallback: (userId?: string) => Promise<void> = null,\n    private loggedOutCallback: (\n      logoutReason: LogoutReason,\n      userId?: string,\n    ) => Promise<void> = null,\n  ) {}\n\n  async init(checkOnInterval: boolean) {\n    if (this.inited) {\n      return;\n    }\n\n    this.inited = true;\n    if (checkOnInterval) {\n      this.startCheck();\n    }\n  }\n\n  startCheck() {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.checkVaultTimeout();\n    setInterval(() => this.checkVaultTimeout(), 10 * 1000); // check every 10 seconds\n  }\n\n  async checkVaultTimeout(): Promise<void> {\n    // Get whether or not the view is open a single time so it can be compared for each user\n    const isViewOpen = await this.platformUtilsService.isViewOpen();\n\n    await firstValueFrom(\n      combineLatest([\n        this.accountService.activeAccount$,\n        this.accountService.accountActivity$,\n      ]).pipe(\n        switchMap(async ([activeAccount, accountActivity]) => {\n          const activeUserId = activeAccount?.id;\n          for (const userIdString in accountActivity) {\n            const userId = userIdString as UserId;\n            if (\n              userId != null &&\n              (await this.shouldLock(userId, accountActivity[userId], activeUserId, isViewOpen))\n            ) {\n              await this.executeTimeoutAction(userId);\n            }\n          }\n        }),\n      ),\n    );\n  }\n\n  async lock(userId?: UserId): Promise<void> {\n    const authed = await this.stateService.getIsAuthenticated({ userId: userId });\n    if (!authed) {\n      return;\n    }\n\n    const availableActions = await firstValueFrom(\n      this.vaultTimeoutSettingsService.availableVaultTimeoutActions$(userId),\n    );\n    const supportsLock = availableActions.includes(VaultTimeoutAction.Lock);\n    if (!supportsLock) {\n      await this.logOut(userId);\n    }\n\n    const currentUserId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(map((a) => a?.id)),\n    );\n\n    const lockingUserId = userId ?? currentUserId;\n\n    // HACK: Start listening for the transition of the locking user from something to the locked state.\n    // This is very much a hack to ensure that the authentication status to retrievable right after\n    // it does its work. Particularly the `lockedCallback` and `\"locked\"` message. Instead\n    // lockedCallback should be deprecated and people should subscribe and react to `authStatusFor$` themselves.\n    const lockPromise = firstValueFrom(\n      this.authService.authStatusFor$(lockingUserId).pipe(\n        filter((authStatus) => authStatus === AuthenticationStatus.Locked),\n        timeout({\n          first: 5_000,\n          with: () => {\n            throw new Error(\"The lock process did not complete in a reasonable amount of time.\");\n          },\n        }),\n      ),\n    );\n\n    if (userId == null || userId === currentUserId) {\n      await this.searchService.clearIndex();\n      await this.folderService.clearCache();\n      await this.collectionService.clearActiveUserCache();\n    }\n\n    await this.masterPasswordService.clearMasterKey(lockingUserId);\n\n    await this.stateService.setUserKeyAutoUnlock(null, { userId: lockingUserId });\n    await this.stateService.setCryptoMasterKeyAuto(null, { userId: lockingUserId });\n\n    await this.cipherService.clearCache(lockingUserId);\n\n    await this.stateEventRunnerService.handleEvent(\"lock\", lockingUserId);\n\n    // HACK: Sit here and wait for the the auth status to transition to `Locked`\n    // to ensure the message and lockedCallback will get the correct status\n    // if/when they call it.\n    await lockPromise;\n\n    this.messagingService.send(\"locked\", { userId: lockingUserId });\n\n    if (this.lockedCallback != null) {\n      await this.lockedCallback(userId);\n    }\n  }\n\n  async logOut(userId?: string): Promise<void> {\n    if (this.loggedOutCallback != null) {\n      await this.loggedOutCallback(\"vaultTimeout\", userId);\n    }\n  }\n\n  private async shouldLock(\n    userId: string,\n    lastActive: Date,\n    activeUserId: string,\n    isViewOpen: boolean,\n  ): Promise<boolean> {\n    if (isViewOpen && userId === activeUserId) {\n      // We know a view is open and this is the currently active user\n      // which means they are likely looking at their vault\n      // and they should not lock.\n      return false;\n    }\n\n    const authStatus = await this.authService.getAuthStatus(userId);\n    if (\n      authStatus === AuthenticationStatus.Locked ||\n      authStatus === AuthenticationStatus.LoggedOut\n    ) {\n      return false;\n    }\n\n    const vaultTimeout = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n    );\n\n    if (typeof vaultTimeout === \"string\") {\n      return false;\n    }\n\n    if (lastActive == null) {\n      return false;\n    }\n\n    const vaultTimeoutSeconds = vaultTimeout * 60;\n    const diffSeconds = (new Date().getTime() - lastActive.getTime()) / 1000;\n    return diffSeconds >= vaultTimeoutSeconds;\n  }\n\n  private async executeTimeoutAction(userId: UserId): Promise<void> {\n    const timeoutAction = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutActionByUserId$(userId),\n    );\n    timeoutAction === VaultTimeoutAction.LogOut\n      ? await this.logOut(userId)\n      : await this.lock(userId);\n  }\n}\n","import { VaultTimeoutService as BaseVaultTimeoutService } from \"@bitwarden/common/services/vault-timeout/vault-timeout.service\";\n\nimport { SafariApp } from \"../../browser/safariApp\";\n\nexport default class VaultTimeoutService extends BaseVaultTimeoutService {\n  startCheck() {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.checkVaultTimeout();\n    if (this.platformUtilsService.isSafari()) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.checkSafari();\n    } else {\n      setInterval(() => this.checkVaultTimeout(), 10 * 1000); // check every 10 seconds\n    }\n  }\n\n  // This is a work-around to safari adding an arbitrary delay to setTimeout and\n  //  setIntervals. It works by calling the native extension which sleeps for 10s,\n  //  efficiently replicating setInterval.\n  async checkSafari() {\n    // eslint-disable-next-line\n    while (true) {\n      try {\n        await SafariApp.sendMessageToApp(\"sleep\");\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.checkVaultTimeout();\n      } catch (e) {\n        // eslint-disable-next-line\n        console.log(\"Exception Safari VaultTimeout\", e);\n      }\n    }\n  }\n}\n","import {\n  Mv2ScriptInjectionDetails,\n  Mv3ScriptInjectionDetails,\n} from \"../../platform/services/abstractions/script-injector.service\";\n\ntype FilelessImporterInjectedScriptsConfigurations = {\n  LpSuppressImportDownload: {\n    mv2: Mv2ScriptInjectionDetails;\n    mv3: Mv3ScriptInjectionDetails;\n  };\n};\n\nconst FilelessImporterInjectedScriptsConfig: FilelessImporterInjectedScriptsConfigurations = {\n  LpSuppressImportDownload: {\n    mv2: {\n      file: \"content/lp-suppress-import-download-script-append-mv2.js\",\n    },\n    mv3: {\n      file: \"content/lp-suppress-import-download.js\",\n      world: \"MAIN\",\n    },\n  },\n} as const;\n\nexport { FilelessImporterInjectedScriptsConfig };\n","const FilelessImportType = {\n  LP: \"LP\",\n} as const;\n\ntype FilelessImportTypeKeys = (typeof FilelessImportType)[keyof typeof FilelessImportType];\n\nconst FilelessImportPort = {\n  NotificationBar: \"fileless-importer-notification-bar\",\n  LpImporter: \"lp-fileless-importer\",\n} as const;\n\nexport { FilelessImportType, FilelessImportTypeKeys, FilelessImportPort };\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { FeatureFlag } from \"@bitwarden/common/enums/feature-flag.enum\";\nimport { ConfigService } from \"@bitwarden/common/platform/abstractions/config/config.service\";\nimport { SyncService } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\nimport { ImportServiceAbstraction } from \"@bitwarden/importer/core\";\n\nimport NotificationBackground from \"../../autofill/background/notification.background\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { ScriptInjectorService } from \"../../platform/services/abstractions/script-injector.service\";\nimport { FilelessImporterInjectedScriptsConfig } from \"../config/fileless-importer-injected-scripts\";\nimport {\n  FilelessImportPort,\n  FilelessImportType,\n  FilelessImportTypeKeys,\n} from \"../enums/fileless-import.enums\";\n\nimport {\n  ImportNotificationMessageHandlers,\n  LpImporterMessageHandlers,\n  FilelessImporterBackground as FilelessImporterBackgroundInterface,\n  FilelessImportPortMessage,\n} from \"./abstractions/fileless-importer.background\";\n\nclass FilelessImporterBackground implements FilelessImporterBackgroundInterface {\n  private static readonly filelessImporterPortNames: Set<string> = new Set([\n    FilelessImportPort.LpImporter,\n    FilelessImportPort.NotificationBar,\n  ]);\n  private importNotificationsPort: chrome.runtime.Port;\n  private lpImporterPort: chrome.runtime.Port;\n  private readonly importNotificationsPortMessageHandlers: ImportNotificationMessageHandlers = {\n    startFilelessImport: ({ message }) => this.startFilelessImport(message.importType),\n    cancelFilelessImport: ({ message, port }) =>\n      this.cancelFilelessImport(message.importType, port.sender),\n  };\n  private readonly lpImporterPortMessageHandlers: LpImporterMessageHandlers = {\n    displayLpImportNotification: ({ port }) =>\n      this.displayFilelessImportNotification(port.sender.tab, FilelessImportType.LP),\n    startLpImport: ({ message }) => this.triggerLpImport(message.data),\n  };\n\n  /**\n   * Creates a new instance of the fileless importer background logic.\n   *\n   * @param configService - Identifies if the feature flag is enabled.\n   * @param authService - Verifies if the auth status of the user.\n   * @param policyService - Identifies if the user account has a policy that disables personal ownership.\n   * @param notificationBackground - Used to inject the notification bar into the tab.\n   * @param importService - Used to import the export data into the vault.\n   * @param syncService - Used to trigger a full sync after the import is completed.\n   * @param scriptInjectorService - Used to inject content scripts that initialize the import process\n   */\n  constructor(\n    private configService: ConfigService,\n    private authService: AuthService,\n    private policyService: PolicyService,\n    private notificationBackground: NotificationBackground,\n    private importService: ImportServiceAbstraction,\n    private syncService: SyncService,\n    private scriptInjectorService: ScriptInjectorService,\n  ) {}\n\n  /**\n   * Initializes the fileless importer background logic.\n   */\n  init() {\n    this.setupPortMessageListeners();\n  }\n\n  /**\n   * Starts an import of the export data pulled from the tab.\n   *\n   * @param importType - The type of import to start. Identifies the used content script.\n   */\n  private startFilelessImport(importType: FilelessImportTypeKeys) {\n    if (importType === FilelessImportType.LP) {\n      this.lpImporterPort?.postMessage({ command: \"startLpFilelessImport\" });\n    }\n  }\n\n  /**\n   * Cancels an import of the export data pulled from the tab. This closes any\n   * existing notifications that are present in the tab, and triggers importer\n   * specific behavior based on the import type.\n   *\n   * @param importType - The type of import to cancel. Identifies the used content script.\n   * @param sender - The sender of the message.\n   */\n  private async cancelFilelessImport(\n    importType: FilelessImportTypeKeys,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (importType === FilelessImportType.LP) {\n      this.triggerLpImporterCsvDownload();\n    }\n\n    await BrowserApi.tabSendMessage(sender.tab, { command: \"closeNotificationBar\" });\n  }\n\n  /**\n   * Injects the notification bar into the passed tab.\n   *\n   * @param tab\n   * @param importType\n   */\n  private async displayFilelessImportNotification(tab: chrome.tabs.Tab, importType: string) {\n    await this.notificationBackground.requestFilelessImport(tab, importType);\n  }\n\n  /**\n   * Triggers the download of the CSV file from the LP importer. This is triggered\n   * when the user opts to not save the export to Bitwarden within the notification bar.\n   */\n  private triggerLpImporterCsvDownload() {\n    this.lpImporterPort?.postMessage({ command: \"triggerCsvDownload\" });\n    this.lpImporterPort?.disconnect();\n  }\n\n  /**\n   * Completes the import process for the LP importer. This is triggered when the\n   * user opts to save the export to Bitwarden within the notification bar.\n   *\n   * @param data - The export data to import.\n   * @param sender - The sender of the message.\n   */\n  private async triggerLpImport(data: string) {\n    if (!data) {\n      return;\n    }\n\n    const promptForPassword_callback = async () => \"\";\n    const importer = this.importService.getImporter(\n      \"lastpasscsv\",\n      promptForPassword_callback,\n      null,\n    );\n\n    try {\n      const result = await this.importService.import(importer, data, null, null, false);\n      if (result.success) {\n        this.importNotificationsPort?.postMessage({ command: \"filelessImportCompleted\" });\n        await this.syncService.fullSync(true);\n      }\n    } catch (error) {\n      this.importNotificationsPort?.postMessage({\n        command: \"filelessImportFailed\",\n        importErrorMessage: Object.values(error).length\n          ? error\n          : chrome.i18n.getMessage(\"importNetworkError\"),\n      });\n    }\n  }\n\n  /**\n   * Identifies if the user account has a policy that disables personal ownership.\n   */\n  private async removeIndividualVault(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  /**\n   * Sets up onConnect listeners for the extension.\n   */\n  private setupPortMessageListeners() {\n    chrome.runtime.onConnect.addListener(this.handlePortOnConnect);\n  }\n\n  /**\n   * Handles connections from content scripts that affect the fileless importer behavior.\n   * Is used to facilitate the passing of data and user actions to enact the import\n   * of web content to the Bitwarden vault. Along with this, a check is made to ensure\n   * that the feature flag is enabled and the user is authenticated.\n   */\n  private handlePortOnConnect = async (port: chrome.runtime.Port) => {\n    if (!FilelessImporterBackground.filelessImporterPortNames.has(port.name)) {\n      return;\n    }\n\n    const filelessImportFeatureFlagEnabled = await this.configService.getFeatureFlag(\n      FeatureFlag.BrowserFilelessImport,\n    );\n    const userAuthStatus = await this.authService.getAuthStatus();\n    const removeIndividualVault = await this.removeIndividualVault();\n    const filelessImportEnabled =\n      filelessImportFeatureFlagEnabled &&\n      userAuthStatus === AuthenticationStatus.Unlocked &&\n      !removeIndividualVault;\n    port.postMessage({ command: \"verifyFeatureFlag\", filelessImportEnabled });\n\n    if (!filelessImportEnabled) {\n      return;\n    }\n\n    port.onMessage.addListener(this.handleImporterPortMessage);\n    port.onDisconnect.addListener(this.handleImporterPortDisconnect);\n\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        this.lpImporterPort = port;\n        await this.scriptInjectorService.inject({\n          tabId: port.sender.tab.id,\n          injectDetails: { runAt: \"document_start\" },\n          mv2Details: FilelessImporterInjectedScriptsConfig.LpSuppressImportDownload.mv2,\n          mv3Details: FilelessImporterInjectedScriptsConfig.LpSuppressImportDownload.mv3,\n        });\n        break;\n      case FilelessImportPort.NotificationBar:\n        this.importNotificationsPort = port;\n        break;\n    }\n  };\n\n  /**\n   * Handles messages that are sent from fileless importer content scripts.\n   * @param message - The message that was sent.\n   * @param port - The port that the message was sent from.\n   */\n  private handleImporterPortMessage = (\n    message: FilelessImportPortMessage,\n    port: chrome.runtime.Port,\n  ) => {\n    let handler: CallableFunction | undefined;\n\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        handler = this.lpImporterPortMessageHandlers[message.command];\n        break;\n      case FilelessImportPort.NotificationBar:\n        handler = this.importNotificationsPortMessageHandlers[message.command];\n        break;\n    }\n\n    if (!handler) {\n      return;\n    }\n\n    handler({ message, port });\n  };\n\n  /**\n   * Handles disconnections from fileless importer content scripts.\n   * @param port - The port that was disconnected.\n   */\n  private handleImporterPortDisconnect = (port: chrome.runtime.Port) => {\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        this.lpImporterPort = null;\n        break;\n      case FilelessImportPort.NotificationBar:\n        this.importNotificationsPort = null;\n        break;\n    }\n  };\n}\n\nexport default FilelessImporterBackground;\n","type Runner<T> = (abortController: AbortController) => Promise<T>;\n\n/**\n * Manages abort controllers for long running tasks and allow separate\n * execution contexts to abort each other by using ids.\n */\nexport class AbortManager {\n  private abortControllers = new Map<string, AbortController>();\n\n  runWithAbortController<T>(id: string, runner: Runner<T>): Promise<T> {\n    const abortController = new AbortController();\n    this.abortControllers.set(id, abortController);\n    return runner(abortController).finally(() => {\n      this.abortControllers.delete(id);\n    });\n  }\n\n  abort(id: string) {\n    this.abortControllers.get(id)?.abort();\n  }\n}\n","export const Fido2ContentScript = {\n  PageScript: \"content/fido2/page-script.js\",\n  PageScriptAppend: \"content/fido2/page-script-append-mv2.js\",\n  ContentScript: \"content/fido2/content-script.js\",\n} as const;\n\nexport const Fido2ContentScriptId = {\n  PageScript: \"fido2-page-script-registration\",\n  ContentScript: \"fido2-content-script-registration\",\n} as const;\n","export const Fido2PortName = {\n  InjectedScript: \"fido2-injected-content-script-port\",\n} as const;\n","import { firstValueFrom, startWith } from \"rxjs\";\nimport { pairwise } from \"rxjs/operators\";\n\nimport {\n  AssertCredentialParams,\n  AssertCredentialResult,\n  CreateCredentialParams,\n  CreateCredentialResult,\n  Fido2ClientService,\n} from \"@bitwarden/common/platform/abstractions/fido2/fido2-client.service.abstraction\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { VaultSettingsService } from \"@bitwarden/common/vault/abstractions/vault-settings/vault-settings.service\";\n\nimport { BrowserApi } from \"../../../platform/browser/browser-api\";\nimport { ScriptInjectorService } from \"../../../platform/services/abstractions/script-injector.service\";\nimport { AbortManager } from \"../../background/abort-manager\";\nimport { Fido2ContentScript, Fido2ContentScriptId } from \"../enums/fido2-content-script.enum\";\nimport { Fido2PortName } from \"../enums/fido2-port-name.enum\";\n\nimport {\n  Fido2Background as Fido2BackgroundInterface,\n  Fido2BackgroundExtensionMessageHandlers,\n  Fido2ExtensionMessage,\n  SharedFido2ScriptInjectionDetails,\n  SharedFido2ScriptRegistrationOptions,\n} from \"./abstractions/fido2.background\";\n\nexport class Fido2Background implements Fido2BackgroundInterface {\n  private abortManager = new AbortManager();\n  private fido2ContentScriptPortsSet = new Set<chrome.runtime.Port>();\n  private registeredContentScripts: browser.contentScripts.RegisteredContentScript;\n  private readonly sharedInjectionDetails: SharedFido2ScriptInjectionDetails = {\n    runAt: \"document_start\",\n  };\n  private readonly sharedRegistrationOptions: SharedFido2ScriptRegistrationOptions = {\n    matches: [\"https://*/*\"],\n    excludeMatches: [\"https://*/*.xml*\"],\n    allFrames: true,\n    ...this.sharedInjectionDetails,\n  };\n  private readonly extensionMessageHandlers: Fido2BackgroundExtensionMessageHandlers = {\n    fido2AbortRequest: ({ message }) => this.abortRequest(message),\n    fido2RegisterCredentialRequest: ({ message, sender }) =>\n      this.registerCredentialRequest(message, sender),\n    fido2GetCredentialRequest: ({ message, sender }) => this.getCredentialRequest(message, sender),\n  };\n\n  constructor(\n    private logService: LogService,\n    private fido2ClientService: Fido2ClientService,\n    private vaultSettingsService: VaultSettingsService,\n    private scriptInjectorService: ScriptInjectorService,\n  ) {}\n\n  /**\n   * Initializes the FIDO2 background service. Sets up the extension message\n   * and port listeners. Subscribes to the enablePasskeys$ observable to\n   * handle passkey enable/disable events.\n   */\n  init() {\n    BrowserApi.messageListener(\"fido2.background\", this.handleExtensionMessage);\n    BrowserApi.addListener(chrome.runtime.onConnect, this.handleInjectedScriptPortConnection);\n    this.vaultSettingsService.enablePasskeys$\n      .pipe(startWith(undefined), pairwise())\n      .subscribe(([previous, current]) => this.handleEnablePasskeysUpdate(previous, current));\n  }\n\n  /**\n   * Injects the FIDO2 content and page script into all existing browser tabs.\n   */\n  async injectFido2ContentScriptsInAllTabs() {\n    const tabs = await BrowserApi.tabsQuery({});\n\n    for (let index = 0; index < tabs.length; index++) {\n      const tab = tabs[index];\n\n      if (tab.url?.startsWith(\"https\")) {\n        void this.injectFido2ContentScripts(tab);\n      }\n    }\n  }\n\n  /**\n   * Handles reacting to the enablePasskeys setting being updated. If the setting\n   * is enabled, the FIDO2 content scripts are injected into all tabs. If the setting\n   * is disabled, the FIDO2 content scripts will be from all tabs. This logic will\n   * not trigger until after the first setting update.\n   *\n   * @param previousEnablePasskeysSetting - The previous value of the enablePasskeys setting.\n   * @param enablePasskeys - The new value of the enablePasskeys setting.\n   */\n  private async handleEnablePasskeysUpdate(\n    previousEnablePasskeysSetting: boolean,\n    enablePasskeys: boolean,\n  ) {\n    await this.updateContentScriptRegistration();\n\n    if (previousEnablePasskeysSetting === undefined) {\n      return;\n    }\n\n    this.destroyLoadedFido2ContentScripts();\n    if (enablePasskeys) {\n      void this.injectFido2ContentScriptsInAllTabs();\n    }\n  }\n\n  /**\n   * Updates the registration status of static FIDO2 content\n   * scripts based on the enablePasskeys setting.\n   */\n  private async updateContentScriptRegistration() {\n    if (BrowserApi.isManifestVersion(2)) {\n      await this.updateMv2ContentScriptsRegistration();\n\n      return;\n    }\n\n    await this.updateMv3ContentScriptsRegistration();\n  }\n\n  /**\n   * Updates the registration status of static FIDO2 content\n   * scripts based on the enablePasskeys setting for manifest v2.\n   */\n  private async updateMv2ContentScriptsRegistration() {\n    if (!(await this.isPasskeySettingEnabled())) {\n      await this.registeredContentScripts?.unregister();\n\n      return;\n    }\n\n    this.registeredContentScripts = await BrowserApi.registerContentScriptsMv2({\n      js: [\n        { file: Fido2ContentScript.PageScriptAppend },\n        { file: Fido2ContentScript.ContentScript },\n      ],\n      ...this.sharedRegistrationOptions,\n    });\n  }\n\n  /**\n   * Updates the registration status of static FIDO2 content\n   * scripts based on the enablePasskeys setting for manifest v3.\n   */\n  private async updateMv3ContentScriptsRegistration() {\n    if (await this.isPasskeySettingEnabled()) {\n      void BrowserApi.registerContentScriptsMv3([\n        {\n          id: Fido2ContentScriptId.PageScript,\n          js: [Fido2ContentScript.PageScript],\n          world: \"MAIN\",\n          ...this.sharedRegistrationOptions,\n        },\n        {\n          id: Fido2ContentScriptId.ContentScript,\n          js: [Fido2ContentScript.ContentScript],\n          ...this.sharedRegistrationOptions,\n        },\n      ]);\n\n      return;\n    }\n\n    void BrowserApi.unregisterContentScriptsMv3({\n      ids: [Fido2ContentScriptId.PageScript, Fido2ContentScriptId.ContentScript],\n    });\n  }\n\n  /**\n   * Injects the FIDO2 content and page script into the current tab.\n   *\n   * @param tab - The current tab to inject the scripts into.\n   */\n  private async injectFido2ContentScripts(tab: chrome.tabs.Tab): Promise<void> {\n    void this.scriptInjectorService.inject({\n      tabId: tab.id,\n      injectDetails: { frame: \"all_frames\", ...this.sharedInjectionDetails },\n      mv2Details: { file: Fido2ContentScript.PageScriptAppend },\n      mv3Details: { file: Fido2ContentScript.PageScript, world: \"MAIN\" },\n    });\n\n    void this.scriptInjectorService.inject({\n      tabId: tab.id,\n      injectDetails: {\n        file: Fido2ContentScript.ContentScript,\n        frame: \"all_frames\",\n        ...this.sharedInjectionDetails,\n      },\n    });\n  }\n\n  /**\n   * Iterates over the set of injected FIDO2 content script ports\n   * and disconnects them, destroying the content scripts.\n   */\n  private destroyLoadedFido2ContentScripts() {\n    this.fido2ContentScriptPortsSet.forEach((port) => {\n      port.disconnect();\n      this.fido2ContentScriptPortsSet.delete(port);\n    });\n  }\n\n  /**\n   * Aborts the FIDO2 request with the provided requestId.\n   *\n   * @param message - The FIDO2 extension message containing the requestId to abort.\n   */\n  private abortRequest(message: Fido2ExtensionMessage) {\n    this.abortManager.abort(message.abortedRequestId);\n  }\n\n  /**\n   * Registers a new FIDO2 credential with the provided request data.\n   *\n   * @param message - The FIDO2 extension message containing the request data.\n   * @param sender - The sender of the message.\n   */\n  private async registerCredentialRequest(\n    message: Fido2ExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ): Promise<CreateCredentialResult> {\n    return await this.handleCredentialRequest<CreateCredentialResult>(\n      message,\n      sender.tab,\n      this.fido2ClientService.createCredential.bind(this.fido2ClientService),\n    );\n  }\n\n  /**\n   * Gets a FIDO2 credential with the provided request data.\n   *\n   * @param message - The FIDO2 extension message containing the request data.\n   * @param sender - The sender of the message.\n   */\n  private async getCredentialRequest(\n    message: Fido2ExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ): Promise<AssertCredentialResult> {\n    return await this.handleCredentialRequest<AssertCredentialResult>(\n      message,\n      sender.tab,\n      this.fido2ClientService.assertCredential.bind(this.fido2ClientService),\n    );\n  }\n\n  /**\n   * Handles Fido2 credential requests by calling the provided callback with the\n   * request data, tab, and abort controller. The callback is expected to return\n   * a promise that resolves with the result of the credential request.\n   *\n   * @param requestId - The request ID associated with the request.\n   * @param data - The request data to handle.\n   * @param tab - The tab associated with the request.\n   * @param callback - The callback to call with the request data, tab, and abort controller.\n   */\n  private handleCredentialRequest = async <T>(\n    { requestId, data }: Fido2ExtensionMessage,\n    tab: chrome.tabs.Tab,\n    callback: (\n      data: AssertCredentialParams | CreateCredentialParams,\n      tab: chrome.tabs.Tab,\n      abortController: AbortController,\n    ) => Promise<T>,\n  ) => {\n    return await this.abortManager.runWithAbortController(requestId, async (abortController) => {\n      try {\n        return await callback(data, tab, abortController);\n      } finally {\n        await BrowserApi.focusTab(tab.id);\n        await BrowserApi.focusWindow(tab.windowId);\n      }\n    });\n  };\n\n  /**\n   * Checks if the enablePasskeys setting is enabled.\n   */\n  private async isPasskeySettingEnabled() {\n    return await firstValueFrom(this.vaultSettingsService.enablePasskeys$);\n  }\n\n  /**\n   * Handles the FIDO2 extension message by calling the\n   * appropriate handler based on the message command.\n   *\n   * @param message - The FIDO2 extension message to handle.\n   * @param sender - The sender of the message.\n   * @param sendResponse - The function to call with the response.\n   */\n  private handleExtensionMessage = (\n    message: Fido2ExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n    sendResponse: (response?: any) => void,\n  ) => {\n    const handler: CallableFunction | undefined = this.extensionMessageHandlers[message?.command];\n    if (!handler) {\n      return;\n    }\n\n    const messageResponse = handler({ message, sender });\n    if (!messageResponse) {\n      return;\n    }\n\n    Promise.resolve(messageResponse)\n      .then(\n        (response) => sendResponse(response),\n        (error) => sendResponse({ error: { ...error, message: error.message } }),\n      )\n      .catch(this.logService.error);\n\n    return true;\n  };\n\n  /**\n   * Handles the connection of a FIDO2 content script port by checking if the\n   * FIDO2 feature is enabled for the sender's hostname and origin. If the feature\n   * is not enabled, the port is disconnected.\n   *\n   * @param port - The port which is connecting\n   */\n  private handleInjectedScriptPortConnection = async (port: chrome.runtime.Port) => {\n    if (port.name !== Fido2PortName.InjectedScript || !port.sender?.url) {\n      return;\n    }\n\n    try {\n      const { hostname, origin } = new URL(port.sender.url);\n      if (!(await this.fido2ClientService.isFido2FeatureEnabled(hostname, origin))) {\n        port.disconnect();\n        return;\n      }\n\n      this.fido2ContentScriptPortsSet.add(port);\n      port.onDisconnect.addListener(this.handleInjectScriptPortOnDisconnect);\n    } catch (error) {\n      this.logService.error(error);\n      port.disconnect();\n    }\n  };\n\n  /**\n   * Handles the disconnection of a FIDO2 content script port\n   * by removing it from the set of connected ports.\n   *\n   * @param port - The port which is disconnecting\n   */\n  private handleInjectScriptPortOnDisconnect = (port: chrome.runtime.Port) => {\n    if (port.name !== Fido2PortName.InjectedScript) {\n      return;\n    }\n\n    this.fido2ContentScriptPortsSet.delete(port);\n  };\n}\n","import {\n  BehaviorSubject,\n  EmptyError,\n  filter,\n  firstValueFrom,\n  fromEvent,\n  fromEventPattern,\n  merge,\n  Observable,\n  Subject,\n  switchMap,\n  take,\n  takeUntil,\n  throwError,\n} from \"rxjs\";\n\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { UserRequestedFallbackAbortReason } from \"@bitwarden/common/platform/abstractions/fido2/fido2-client.service.abstraction\";\nimport {\n  Fido2UserInterfaceService as Fido2UserInterfaceServiceAbstraction,\n  Fido2UserInterfaceSession,\n  NewCredentialParams,\n  PickCredentialParams,\n} from \"@bitwarden/common/platform/abstractions/fido2/fido2-user-interface.service.abstraction\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { closeFido2Popout, openFido2Popout } from \"../popup/utils/vault-popout-window\";\n\nconst BrowserFido2MessageName = \"BrowserFido2UserInterfaceServiceMessage\";\n\nexport class SessionClosedError extends Error {\n  constructor() {\n    super(\"Fido2UserInterfaceSession was closed\");\n  }\n}\n\nexport type BrowserFido2Message = { sessionId: string } & (\n  | /**\n   * This message is used by popouts to announce that they are ready\n   * to recieve messages.\n   **/ {\n      type: \"ConnectResponse\";\n    }\n  /**\n   * This message is used to announce the creation of a new session.\n   * It is used by popouts to know when to close.\n   **/\n  | {\n      type: \"NewSessionCreatedRequest\";\n    }\n  | {\n      type: \"PickCredentialRequest\";\n      cipherIds: string[];\n      userVerification: boolean;\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"PickCredentialResponse\";\n      cipherId?: string;\n      userVerified: boolean;\n    }\n  | {\n      type: \"ConfirmNewCredentialRequest\";\n      credentialName: string;\n      userName: string;\n      userVerification: boolean;\n      fallbackSupported: boolean;\n      rpId: string;\n    }\n  | {\n      type: \"ConfirmNewCredentialResponse\";\n      cipherId: string;\n      userVerified: boolean;\n    }\n  | {\n      type: \"InformExcludedCredentialRequest\";\n      existingCipherIds: string[];\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"InformCredentialNotFoundRequest\";\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"AbortRequest\";\n    }\n  | {\n      type: \"AbortResponse\";\n      fallbackRequested: boolean;\n    }\n);\n\n/**\n * Browser implementation of the {@link Fido2UserInterfaceService}.\n * The user interface is implemented as a popout and the service uses the browser's messaging API to communicate with it.\n */\nexport class BrowserFido2UserInterfaceService implements Fido2UserInterfaceServiceAbstraction {\n  constructor(private authService: AuthService) {}\n\n  async newSession(\n    fallbackSupported: boolean,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2UserInterfaceSession> {\n    return await BrowserFido2UserInterfaceSession.create(\n      this.authService,\n      fallbackSupported,\n      tab,\n      abortController,\n    );\n  }\n}\n\nexport class BrowserFido2UserInterfaceSession implements Fido2UserInterfaceSession {\n  static async create(\n    authService: AuthService,\n    fallbackSupported: boolean,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<BrowserFido2UserInterfaceSession> {\n    return new BrowserFido2UserInterfaceSession(\n      authService,\n      fallbackSupported,\n      tab,\n      abortController,\n    );\n  }\n\n  static sendMessage(msg: BrowserFido2Message) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.sendMessage(BrowserFido2MessageName, msg);\n  }\n\n  static abortPopout(sessionId: string, fallbackRequested = false) {\n    this.sendMessage({\n      sessionId: sessionId,\n      type: \"AbortResponse\",\n      fallbackRequested: fallbackRequested,\n    });\n  }\n\n  static confirmNewCredentialResponse(sessionId: string, cipherId: string, userVerified: boolean) {\n    this.sendMessage({\n      sessionId: sessionId,\n      type: \"ConfirmNewCredentialResponse\",\n      cipherId,\n      userVerified,\n    });\n  }\n\n  private closed = false;\n  private messages$ = (BrowserApi.messageListener$() as Observable<BrowserFido2Message>).pipe(\n    filter((msg) => msg.sessionId === this.sessionId),\n  );\n  private connected$ = new BehaviorSubject(false);\n  private windowClosed$: Observable<number>;\n  private destroy$ = new Subject<void>();\n\n  private constructor(\n    private readonly authService: AuthService,\n    private readonly fallbackSupported: boolean,\n    private readonly tab: chrome.tabs.Tab,\n    readonly abortController = new AbortController(),\n    readonly sessionId = Utils.newGuid(),\n  ) {\n    this.messages$\n      .pipe(\n        filter((msg) => msg.type === \"ConnectResponse\"),\n        take(1),\n        takeUntil(this.destroy$),\n      )\n      .subscribe(() => {\n        this.connected$.next(true);\n      });\n\n    // Handle session aborted by RP\n    fromEvent(abortController.signal, \"abort\")\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.close();\n        BrowserFido2UserInterfaceSession.sendMessage({\n          type: \"AbortRequest\",\n          sessionId: this.sessionId,\n        });\n      });\n\n    // Handle session aborted by user\n    this.messages$\n      .pipe(\n        filter((msg) => msg.type === \"AbortResponse\"),\n        take(1),\n        takeUntil(this.destroy$),\n      )\n      .subscribe((msg) => {\n        if (msg.type === \"AbortResponse\") {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.close();\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.abort(msg.fallbackRequested);\n        }\n      });\n\n    this.windowClosed$ = fromEventPattern(\n      // FIXME: Make sure that is does not cause a memory leak in Safari or use BrowserApi.AddListener\n      // and test that it doesn't break. Tracking Ticket: https://bitwarden.atlassian.net/browse/PM-4735\n      // eslint-disable-next-line no-restricted-syntax\n      (handler: any) => chrome.windows.onRemoved.addListener(handler),\n      (handler: any) => chrome.windows.onRemoved.removeListener(handler),\n    );\n\n    BrowserFido2UserInterfaceSession.sendMessage({\n      type: \"NewSessionCreatedRequest\",\n      sessionId,\n    });\n  }\n\n  async pickCredential({\n    cipherIds,\n    userVerification,\n  }: PickCredentialParams): Promise<{ cipherId: string; userVerified: boolean }> {\n    const data: BrowserFido2Message = {\n      type: \"PickCredentialRequest\",\n      cipherIds,\n      sessionId: this.sessionId,\n      userVerification,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    const response = await this.receive(\"PickCredentialResponse\");\n\n    return { cipherId: response.cipherId, userVerified: response.userVerified };\n  }\n\n  async confirmNewCredential({\n    credentialName,\n    userName,\n    userVerification,\n    rpId,\n  }: NewCredentialParams): Promise<{ cipherId: string; userVerified: boolean }> {\n    const data: BrowserFido2Message = {\n      type: \"ConfirmNewCredentialRequest\",\n      sessionId: this.sessionId,\n      credentialName,\n      userName,\n      userVerification,\n      fallbackSupported: this.fallbackSupported,\n      rpId,\n    };\n\n    await this.send(data);\n    const response = await this.receive(\"ConfirmNewCredentialResponse\");\n\n    return { cipherId: response.cipherId, userVerified: response.userVerified };\n  }\n\n  async informExcludedCredential(existingCipherIds: string[]): Promise<void> {\n    const data: BrowserFido2Message = {\n      type: \"InformExcludedCredentialRequest\",\n      sessionId: this.sessionId,\n      existingCipherIds,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    await this.receive(\"AbortResponse\");\n  }\n\n  async ensureUnlockedVault(): Promise<void> {\n    if ((await this.authService.getAuthStatus()) !== AuthenticationStatus.Unlocked) {\n      await this.connect();\n    }\n  }\n\n  async informCredentialNotFound(): Promise<void> {\n    const data: BrowserFido2Message = {\n      type: \"InformCredentialNotFoundRequest\",\n      sessionId: this.sessionId,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    await this.receive(\"AbortResponse\");\n  }\n\n  async close() {\n    await closeFido2Popout(this.sessionId);\n    this.closed = true;\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  private async abort(fallback = false) {\n    this.abortController.abort(fallback ? UserRequestedFallbackAbortReason : undefined);\n  }\n\n  private async send(msg: BrowserFido2Message): Promise<void> {\n    if (!this.connected$.value) {\n      await this.connect();\n    }\n    BrowserFido2UserInterfaceSession.sendMessage(msg);\n  }\n\n  private async receive<T extends BrowserFido2Message[\"type\"]>(\n    type: T,\n  ): Promise<BrowserFido2Message & { type: T }> {\n    try {\n      const response = await firstValueFrom(\n        this.messages$.pipe(\n          filter((msg) => msg.sessionId === this.sessionId && msg.type === type),\n          takeUntil(this.destroy$),\n        ),\n      );\n      return response as BrowserFido2Message & { type: T };\n    } catch (error) {\n      if (error instanceof EmptyError) {\n        throw new SessionClosedError();\n      }\n      throw error;\n    }\n  }\n\n  private async connect(): Promise<void> {\n    if (this.closed) {\n      throw new Error(\"Cannot re-open closed session\");\n    }\n\n    const connectPromise = firstValueFrom(\n      merge(\n        this.connected$.pipe(filter((connected) => connected === true)),\n        fromEvent(this.abortController.signal, \"abort\").pipe(\n          switchMap(() => throwError(() => new SessionClosedError())),\n        ),\n      ),\n    );\n\n    const popoutId = await openFido2Popout(this.tab, {\n      sessionId: this.sessionId,\n      fallbackSupported: this.fallbackSupported,\n    });\n\n    this.windowClosed$\n      .pipe(\n        filter((windowId) => {\n          return popoutId === windowId;\n        }),\n        takeUntil(this.destroy$),\n      )\n      .subscribe(() => {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.close();\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.abort(true);\n      });\n\n    await connectPromise;\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { CipherStatus } from \"./cipher-status.model\";\n\nexport type VaultFilterFunction = (cipher: CipherView) => boolean;\n\nexport class VaultFilter {\n  cipherType?: CipherType;\n  selectedCollection = false; // This is needed because of how the \"Unassigned\" collection works. It has a null id.\n  selectedCollectionId?: string;\n  status?: CipherStatus;\n  selectedFolder = false; // This is needed because of how the \"No Folder\" folder works. It has a null id.\n  selectedFolderId?: string;\n  selectedOrganizationId?: string;\n  myVaultOnly = false;\n  refreshCollectionsAndFolders = false;\n\n  constructor(init?: Partial<VaultFilter>) {\n    Object.assign(this, init);\n  }\n\n  resetFilter() {\n    this.cipherType = null;\n    this.status = null;\n    this.selectedCollection = false;\n    this.selectedCollectionId = null;\n    this.selectedFolder = false;\n    this.selectedFolderId = null;\n  }\n\n  resetOrganization() {\n    this.myVaultOnly = false;\n    this.selectedOrganizationId = null;\n    this.resetFilter();\n  }\n\n  buildFilter(): VaultFilterFunction {\n    return (cipher) => {\n      let cipherPassesFilter = true;\n      if (this.status === \"favorites\" && cipherPassesFilter) {\n        cipherPassesFilter = cipher.favorite;\n      }\n      if (this.status === \"trash\" && cipherPassesFilter) {\n        cipherPassesFilter = cipher.isDeleted;\n      }\n      if (this.cipherType != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.type === this.cipherType;\n      }\n      if (this.selectedFolder && this.selectedFolderId == null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.folderId == null;\n      }\n      if (this.selectedFolder && this.selectedFolderId != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.folderId === this.selectedFolderId;\n      }\n      if (this.selectedCollection && this.selectedCollectionId == null && cipherPassesFilter) {\n        cipherPassesFilter =\n          cipher.organizationId != null &&\n          (cipher.collectionIds == null || cipher.collectionIds.length === 0);\n      }\n      if (this.selectedCollection && this.selectedCollectionId != null && cipherPassesFilter) {\n        cipherPassesFilter =\n          cipher.collectionIds != null && cipher.collectionIds.includes(this.selectedCollectionId);\n      }\n      if (this.selectedOrganizationId != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.organizationId === this.selectedOrganizationId;\n      }\n      if (this.myVaultOnly && cipherPassesFilter) {\n        cipherPassesFilter = cipher.organizationId === null;\n      }\n      return cipherPassesFilter;\n    };\n  }\n}\n","import { map, Observable } from \"rxjs\";\n\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { UserId } from \"../../../types/guid\";\nimport { OrganizationData } from \"../../models/data/organization.data\";\nimport { Organization } from \"../../models/domain/organization\";\n\nexport function canAccessVaultTab(org: Organization): boolean {\n  return org.canViewAssignedCollections || org.canViewAllCollections;\n}\n\nexport function canAccessSettingsTab(org: Organization): boolean {\n  return (\n    org.isOwner ||\n    org.canManagePolicies ||\n    org.canManageSso ||\n    org.canManageScim ||\n    org.canAccessImportExport ||\n    org.canManageDeviceApprovals\n  );\n}\n\nexport function canAccessMembersTab(org: Organization): boolean {\n  return org.canManageUsers || org.canManageUsersPassword;\n}\n\nexport function canAccessGroupsTab(org: Organization): boolean {\n  return org.canManageGroups;\n}\n\nexport function canAccessReportingTab(org: Organization): boolean {\n  return org.canAccessReports || org.canAccessEventLogs;\n}\n\nexport function canAccessBillingTab(org: Organization): boolean {\n  return org.isOwner;\n}\n\nexport function canAccessOrgAdmin(org: Organization): boolean {\n  // Admin console can only be accessed by Owners for disabled organizations\n  if (!org.enabled && !org.isOwner) {\n    return false;\n  }\n  return (\n    canAccessMembersTab(org) ||\n    canAccessGroupsTab(org) ||\n    canAccessReportingTab(org) ||\n    canAccessBillingTab(org) ||\n    canAccessSettingsTab(org) ||\n    canAccessVaultTab(org)\n  );\n}\n\nexport function getOrganizationById(id: string) {\n  return map<Organization[], Organization | undefined>((orgs) => orgs.find((o) => o.id === id));\n}\n\nexport function canAccessAdmin(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs.filter(canAccessOrgAdmin).sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\n/**\n * @deprecated\n * To be removed after Flexible Collections.\n **/\nexport function canAccessImportExport(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs\n      .filter((org) => org.canAccessImportExport)\n      .sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\nexport function canAccessImport(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs\n      .filter(\n        (org) =>\n          org.canAccessImportExport || (org.canCreateNewCollections && org.flexibleCollections),\n      )\n      .sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\n/**\n * Returns `true` if a user is a member of an organization (rather than only being a ProviderUser)\n * @deprecated Use organizationService.organizations$ with a filter instead\n */\nexport function isMember(org: Organization): boolean {\n  return org.isMember;\n}\n\n/**\n * Publishes an observable stream of organizations. This service is meant to\n * be used widely across Bitwarden as the primary way of fetching organizations.\n * Risky operations like updates are isolated to the\n * internal extension `InternalOrganizationServiceAbstraction`.\n */\nexport abstract class OrganizationService {\n  /**\n   * Publishes state for all organizations under the active user.\n   * @returns An observable list of organizations\n   */\n  organizations$: Observable<Organization[]>;\n\n  // @todo Clean these up. Continuing to expand them is not recommended.\n  // @see https://bitwarden.atlassian.net/browse/AC-2252\n  memberOrganizations$: Observable<Organization[]>;\n  /**\n   * @deprecated This is currently only used in the CLI, and should not be\n   * used in any new calls. Use get$ instead for the time being, and we'll be\n   * removing this method soon. See Jira for details:\n   * https://bitwarden.atlassian.net/browse/AC-2252.\n   */\n  getFromState: (id: string) => Promise<Organization>;\n  canManageSponsorships$: Observable<boolean>;\n  hasOrganizations: () => Promise<boolean>;\n  get$: (id: string) => Observable<Organization | undefined>;\n  get: (id: string) => Promise<Organization>;\n  getAll: (userId?: string) => Promise<Organization[]>;\n\n  /**\n   * Publishes state for all organizations for the given user id or the active user.\n   */\n  getAll$: (userId?: UserId) => Observable<Organization[]>;\n}\n\n/**\n * Big scary buttons that **update** organization state. These should only be\n * called from within admin-console scoped code. Extends the base\n * `OrganizationService` for easy access to `get` calls.\n * @internal\n */\nexport abstract class InternalOrganizationServiceAbstraction extends OrganizationService {\n  /**\n   * Replaces state for the provided organization, or creates it if not found.\n   * @param organization The organization state being saved.\n   * @param userId The userId to replace state for. Defaults to the active\n   * user.\n   */\n  upsert: (OrganizationData: OrganizationData) => Promise<void>;\n\n  /**\n   * Replaces state for the entire registered organization list for the active user.\n   * You probably don't want this unless you're calling from a full sync\n   * operation or a logout. See `upsert` for creating & updating a single\n   * organization in the state.\n   * @param organizations A complete list of all organization state for the active\n   * user.\n   * @param userId The userId to replace state for. Defaults to the active\n   * user.\n   */\n  replace: (organizations: { [id: string]: OrganizationData }, userId?: UserId) => Promise<void>;\n}\n","import { ITreeNodeObject, TreeNode } from \"@bitwarden/common/vault/models/domain/tree-node\";\n\nexport class DynamicTreeNode<T extends ITreeNodeObject> {\n  fullList: T[];\n  nestedList: TreeNode<T>[];\n\n  hasId(id: string): boolean {\n    return this.fullList != null && this.fullList.filter((i: T) => i.id === id).length > 0;\n  }\n\n  constructor(init?: Partial<DynamicTreeNode<T>>) {\n    Object.assign(this, init);\n  }\n}\n","import { UserKeyDefinition, VAULT_FILTER_DISK } from \"../../../platform/state\";\n\nexport const COLLAPSED_GROUPINGS = UserKeyDefinition.array<string>(\n  VAULT_FILTER_DISK,\n  \"collapsedGroupings\",\n  {\n    deserializer: (obj) => obj,\n    clearOn: [\"logout\", \"lock\"],\n  },\n);\n","import { Observable } from \"rxjs\";\n\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { FolderData } from \"../../models/data/folder.data\";\nimport { Folder } from \"../../models/domain/folder\";\nimport { FolderView } from \"../../models/view/folder.view\";\n\nexport abstract class FolderService {\n  folders$: Observable<Folder[]>;\n  folderViews$: Observable<FolderView[]>;\n\n  clearCache: () => Promise<void>;\n  encrypt: (model: FolderView, key?: SymmetricCryptoKey) => Promise<Folder>;\n  get: (id: string) => Promise<Folder>;\n  getAllFromState: () => Promise<Folder[]>;\n  /**\n   * @deprecated Only use in CLI!\n   */\n  getFromState: (id: string) => Promise<Folder>;\n  /**\n   * @deprecated Only use in CLI!\n   */\n  getAllDecryptedFromState: () => Promise<FolderView[]>;\n  decryptFolders: (folders: Folder[]) => Promise<FolderView[]>;\n}\n\nexport abstract class InternalFolderService extends FolderService {\n  upsert: (folder: FolderData | FolderData[]) => Promise<void>;\n  replace: (folders: { [id: string]: FolderData }) => Promise<void>;\n  clear: (userId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n}\n","import { Observable } from \"rxjs\";\n\nimport { UriMatchStrategySetting } from \"../../models/domain/domain-service\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { CipherId, CollectionId, OrganizationId } from \"../../types/guid\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherData } from \"../models/data/cipher.data\";\nimport { Cipher } from \"../models/domain/cipher\";\nimport { Field } from \"../models/domain/field\";\nimport { CipherView } from \"../models/view/cipher.view\";\nimport { FieldView } from \"../models/view/field.view\";\nimport { AddEditCipherInfo } from \"../types/add-edit-cipher-info\";\n\nexport abstract class CipherService {\n  cipherViews$: Observable<Record<CipherId, CipherView>>;\n  /**\n   *  An observable monitoring the add/edit cipher info saved to memory.\n   */\n  addEditCipherInfo$: Observable<AddEditCipherInfo>;\n  clearCache: (userId?: string) => Promise<void>;\n  encrypt: (\n    model: CipherView,\n    keyForEncryption?: SymmetricCryptoKey,\n    keyForCipherKeyDecryption?: SymmetricCryptoKey,\n    originalCipher?: Cipher,\n  ) => Promise<Cipher>;\n  encryptFields: (fieldsModel: FieldView[], key: SymmetricCryptoKey) => Promise<Field[]>;\n  encryptField: (fieldModel: FieldView, key: SymmetricCryptoKey) => Promise<Field>;\n  get: (id: string) => Promise<Cipher>;\n  getAll: () => Promise<Cipher[]>;\n  getAllDecrypted: () => Promise<CipherView[]>;\n  getAllDecryptedForGrouping: (groupingId: string, folder?: boolean) => Promise<CipherView[]>;\n  getAllDecryptedForUrl: (\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch?: UriMatchStrategySetting,\n  ) => Promise<CipherView[]>;\n  filterCiphersForUrl: (\n    ciphers: CipherView[],\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch?: UriMatchStrategySetting,\n  ) => Promise<CipherView[]>;\n  getAllFromApiForOrganization: (organizationId: string) => Promise<CipherView[]>;\n  /**\n   * Gets ciphers belonging to the specified organization that the user has explicit collection level access to.\n   * Ciphers that are not assigned to any collections are only included for users with admin access.\n   */\n  getManyFromApiForOrganization: (organizationId: string) => Promise<CipherView[]>;\n  getLastUsedForUrl: (url: string, autofillOnPageLoad: boolean) => Promise<CipherView>;\n  getLastLaunchedForUrl: (url: string, autofillOnPageLoad: boolean) => Promise<CipherView>;\n  getNextCipherForUrl: (url: string) => Promise<CipherView>;\n  updateLastUsedIndexForUrl: (url: string) => void;\n  updateLastUsedDate: (id: string) => Promise<void>;\n  updateLastLaunchedDate: (id: string) => Promise<void>;\n  saveNeverDomain: (domain: string) => Promise<void>;\n  /**\n   * Create a cipher with the server\n   *\n   * @param cipher The cipher to create\n   * @param orgAdmin If true, the request is submitted as an organization admin request\n   *\n   * @returns A promise that resolves to the created cipher\n   */\n  createWithServer: (cipher: Cipher, orgAdmin?: boolean) => Promise<Cipher>;\n  /**\n   * Update a cipher with the server\n   * @param cipher The cipher to update\n   * @param orgAdmin If true, the request is submitted as an organization admin request\n   * @param isNotClone If true, the cipher is not a clone and should be treated as a new cipher\n   *\n   * @returns A promise that resolves to the updated cipher\n   */\n  updateWithServer: (cipher: Cipher, orgAdmin?: boolean, isNotClone?: boolean) => Promise<Cipher>;\n  shareWithServer: (\n    cipher: CipherView,\n    organizationId: string,\n    collectionIds: string[],\n  ) => Promise<any>;\n  shareManyWithServer: (\n    ciphers: CipherView[],\n    organizationId: string,\n    collectionIds: string[],\n  ) => Promise<any>;\n  saveAttachmentWithServer: (\n    cipher: Cipher,\n    unencryptedFile: any,\n    admin?: boolean,\n  ) => Promise<Cipher>;\n  saveAttachmentRawWithServer: (\n    cipher: Cipher,\n    filename: string,\n    data: ArrayBuffer,\n    admin?: boolean,\n  ) => Promise<Cipher>;\n  /**\n   * Save the collections for a cipher with the server\n   *\n   * @param cipher The cipher to save collections for\n   *\n   * @returns A promise that resolves when the collections have been saved\n   */\n  saveCollectionsWithServer: (cipher: Cipher) => Promise<Cipher>;\n  /**\n   * Bulk update collections for many ciphers with the server\n   * @param orgId\n   * @param cipherIds\n   * @param collectionIds\n   * @param removeCollections - If true, the collections will be removed from the ciphers, otherwise they will be added\n   */\n  bulkUpdateCollectionsWithServer: (\n    orgId: OrganizationId,\n    cipherIds: CipherId[],\n    collectionIds: CollectionId[],\n    removeCollections: boolean,\n  ) => Promise<void>;\n  /**\n   * Update the local store of CipherData with the provided data. Values are upserted into the existing store.\n   *\n   * @param cipher The cipher data to upsert. Can be a single CipherData object or an array of CipherData objects.\n   * @returns A promise that resolves to a record of updated cipher store, keyed by their cipher ID. Returns all ciphers, not just those updated\n   */\n  upsert: (cipher: CipherData | CipherData[]) => Promise<Record<CipherId, CipherData>>;\n  replace: (ciphers: { [id: string]: CipherData }) => Promise<any>;\n  clear: (userId: string) => Promise<any>;\n  moveManyWithServer: (ids: string[], folderId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n  deleteWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  deleteManyWithServer: (ids: string[], asAdmin?: boolean) => Promise<any>;\n  deleteAttachment: (id: string, attachmentId: string) => Promise<void>;\n  deleteAttachmentWithServer: (id: string, attachmentId: string) => Promise<void>;\n  sortCiphersByLastUsed: (a: CipherView, b: CipherView) => number;\n  sortCiphersByLastUsedThenName: (a: CipherView, b: CipherView) => number;\n  getLocaleSortingFunction: () => (a: CipherView, b: CipherView) => number;\n  softDelete: (id: string | string[]) => Promise<any>;\n  softDeleteWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  softDeleteManyWithServer: (ids: string[], asAdmin?: boolean) => Promise<any>;\n  restore: (\n    cipher: { id: string; revisionDate: string } | { id: string; revisionDate: string }[],\n  ) => Promise<any>;\n  restoreWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  restoreManyWithServer: (ids: string[], orgId?: string) => Promise<void>;\n  getKeyForCipherKeyDecryption: (cipher: Cipher) => Promise<any>;\n  setAddEditCipherInfo: (value: AddEditCipherInfo) => Promise<void>;\n}\n","import { Observable } from \"rxjs\";\n\nimport { CollectionId } from \"../../types/guid\";\nimport { CollectionData } from \"../models/data/collection.data\";\nimport { Collection } from \"../models/domain/collection\";\nimport { TreeNode } from \"../models/domain/tree-node\";\nimport { CollectionView } from \"../models/view/collection.view\";\n\nexport abstract class CollectionService {\n  decryptedCollections$: Observable<CollectionView[]>;\n\n  clearActiveUserCache: () => Promise<void>;\n  encrypt: (model: CollectionView) => Promise<Collection>;\n  decryptedCollectionViews$: (ids: CollectionId[]) => Observable<CollectionView[]>;\n  /**\n   * @deprecated This method will soon be made private, use `decryptedCollectionViews$` instead.\n   */\n  decryptMany: (collections: Collection[]) => Promise<CollectionView[]>;\n  get: (id: string) => Promise<Collection>;\n  getAll: () => Promise<Collection[]>;\n  getAllDecrypted: () => Promise<CollectionView[]>;\n  getAllNested: (collections?: CollectionView[]) => Promise<TreeNode<CollectionView>[]>;\n  getNested: (id: string) => Promise<TreeNode<CollectionView>>;\n  upsert: (collection: CollectionData | CollectionData[]) => Promise<any>;\n  replace: (collections: { [id: string]: CollectionData }) => Promise<any>;\n  clear: (userId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { Policy } from \"../../models/domain/policy\";\nimport { ResetPasswordPolicyOptions } from \"../../models/domain/reset-password-policy-options\";\n\nexport abstract class PolicyService {\n  /**\n   * All policies for the active user from sync data.\n   * May include policies that are disabled or otherwise do not apply to the user. Be careful using this!\n   * Consider using {@link get$} or {@link getAll$} instead, which will only return policies that should be enforced against the user.\n   */\n  policies$: Observable<Policy[]>;\n\n  /**\n   * @returns the first {@link Policy} found that applies to the active user.\n   * A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   * @param policyType the {@link PolicyType} to search for\n   * @see {@link getAll$} if you need all policies of a given type\n   */\n  get$: (policyType: PolicyType) => Observable<Policy>;\n\n  /**\n   * @returns all {@link Policy} objects of a given type that apply to the specified user (or the active user if not specified).\n   * A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   * @param policyType the {@link PolicyType} to search for\n   */\n  getAll$: (policyType: PolicyType, userId?: UserId) => Observable<Policy[]>;\n\n  /**\n   * All {@link Policy} objects for the specified user (from sync data).\n   * May include policies that are disabled or otherwise do not apply to the user.\n   * Consider using {@link getAll$} instead, which will only return policies that should be enforced against the user.\n   */\n  getAll: (policyType: PolicyType) => Promise<Policy[]>;\n\n  /**\n   * @returns true if a policy of the specified type applies to the active user, otherwise false.\n   * A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   * This does not take into account the policy's configuration - if that is important, use {@link getAll$} to get the\n   * {@link Policy} objects and then filter by Policy.data.\n   */\n  policyAppliesToActiveUser$: (policyType: PolicyType) => Observable<boolean>;\n\n  policyAppliesToUser: (policyType: PolicyType) => Promise<boolean>;\n\n  // Policy specific interfaces\n\n  /**\n   * Combines all Master Password policies that apply to the user.\n   * @returns a set of options which represent the minimum Master Password settings that the user must\n   * comply with in order to comply with **all** Master Password policies.\n   */\n  masterPasswordPolicyOptions$: (policies?: Policy[]) => Observable<MasterPasswordPolicyOptions>;\n\n  /**\n   * Evaluates whether a proposed Master Password complies with all Master Password policies that apply to the user.\n   */\n  evaluateMasterPassword: (\n    passwordStrength: number,\n    newPassword: string,\n    enforcedPolicyOptions?: MasterPasswordPolicyOptions,\n  ) => boolean;\n\n  /**\n   * @returns Reset Password policy options for the specified organization and a boolean indicating whether the policy\n   * is enabled\n   */\n  getResetPasswordPolicyOptions: (\n    policies: Policy[],\n    orgId: string,\n  ) => [ResetPasswordPolicyOptions, boolean];\n}\n\nexport abstract class InternalPolicyService extends PolicyService {\n  upsert: (policy: PolicyData) => Promise<void>;\n  replace: (policies: { [id: string]: PolicyData }) => Promise<void>;\n}\n","import { Injectable } from \"@angular/core\";\nimport { firstValueFrom, from, map, mergeMap, Observable } from \"rxjs\";\n\nimport {\n  isMember,\n  OrganizationService,\n} from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { Organization } from \"@bitwarden/common/admin-console/models/domain/organization\";\nimport { ActiveUserState, StateProvider } from \"@bitwarden/common/platform/state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { TreeNode } from \"@bitwarden/common/vault/models/domain/tree-node\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { ServiceUtils } from \"@bitwarden/common/vault/service-utils\";\n\nimport { DeprecatedVaultFilterService as DeprecatedVaultFilterServiceAbstraction } from \"../../abstractions/deprecated-vault-filter.service\";\nimport { DynamicTreeNode } from \"../models/dynamic-tree-node.model\";\n\nimport { COLLAPSED_GROUPINGS } from \"./../../../../../common/src/vault/services/key-state/collapsed-groupings.state\";\n\nconst NestingDelimiter = \"/\";\n\n@Injectable()\nexport class VaultFilterService implements DeprecatedVaultFilterServiceAbstraction {\n  private collapsedGroupingsState: ActiveUserState<string[]> =\n    this.stateProvider.getActive(COLLAPSED_GROUPINGS);\n  private readonly collapsedGroupings$: Observable<Set<string>> =\n    this.collapsedGroupingsState.state$.pipe(map((c) => new Set(c)));\n\n  constructor(\n    protected organizationService: OrganizationService,\n    protected folderService: FolderService,\n    protected cipherService: CipherService,\n    protected collectionService: CollectionService,\n    protected policyService: PolicyService,\n    protected stateProvider: StateProvider,\n  ) {}\n\n  async storeCollapsedFilterNodes(collapsedFilterNodes: Set<string>): Promise<void> {\n    await this.collapsedGroupingsState.update(() => Array.from(collapsedFilterNodes));\n  }\n\n  async buildCollapsedFilterNodes(): Promise<Set<string>> {\n    return await firstValueFrom(this.collapsedGroupings$);\n  }\n\n  async buildOrganizations(): Promise<Organization[]> {\n    let organizations = await this.organizationService.getAll();\n    if (organizations != null) {\n      organizations = organizations.filter(isMember).sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    return organizations;\n  }\n\n  buildNestedFolders(organizationId?: string): Observable<DynamicTreeNode<FolderView>> {\n    const transformation = async (storedFolders: FolderView[]) => {\n      let folders: FolderView[];\n\n      // If no org or \"My Vault\" is selected, show all folders\n      if (organizationId == null || organizationId == \"MyVault\") {\n        folders = storedFolders;\n      } else {\n        // Otherwise, show only folders that have ciphers from the selected org and the \"no folder\" folder\n        const ciphers = await this.cipherService.getAllDecrypted();\n        const orgCiphers = ciphers.filter((c) => c.organizationId == organizationId);\n        folders = storedFolders.filter(\n          (f) => orgCiphers.some((oc) => oc.folderId == f.id) || f.id == null,\n        );\n      }\n\n      const nestedFolders = await this.getAllFoldersNested(folders);\n      return new DynamicTreeNode<FolderView>({\n        fullList: folders,\n        nestedList: nestedFolders,\n      });\n    };\n\n    return this.folderService.folderViews$.pipe(\n      mergeMap((folders) => from(transformation(folders))),\n    );\n  }\n\n  async buildCollections(organizationId?: string): Promise<DynamicTreeNode<CollectionView>> {\n    const storedCollections = await this.collectionService.getAllDecrypted();\n    let collections: CollectionView[];\n    if (organizationId != null) {\n      collections = storedCollections.filter((c) => c.organizationId === organizationId);\n    } else {\n      collections = storedCollections;\n    }\n    const nestedCollections = await this.collectionService.getAllNested(collections);\n    return new DynamicTreeNode<CollectionView>({\n      fullList: collections,\n      nestedList: nestedCollections,\n    });\n  }\n\n  async checkForSingleOrganizationPolicy(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.SingleOrg),\n    );\n  }\n\n  async checkForPersonalOwnershipPolicy(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  protected async getAllFoldersNested(folders: FolderView[]): Promise<TreeNode<FolderView>[]> {\n    const nodes: TreeNode<FolderView>[] = [];\n    folders.forEach((f) => {\n      const folderCopy = new FolderView();\n      folderCopy.id = f.id;\n      folderCopy.revisionDate = f.revisionDate;\n      const parts = f.name != null ? f.name.replace(/^\\/+|\\/+$/g, \"\").split(NestingDelimiter) : [];\n      ServiceUtils.nestedTraverse(nodes, 0, parts, folderCopy, null, NestingDelimiter);\n    });\n    return nodes;\n  }\n\n  async getFolderNested(id: string): Promise<TreeNode<FolderView>> {\n    const folders = await this.getAllFoldersNested(\n      await firstValueFrom(this.folderService.folderViews$),\n    );\n    return ServiceUtils.getTreeNodeObjectFromList(folders, id) as TreeNode<FolderView>;\n  }\n}\n","import { VaultFilter } from \"@bitwarden/angular/vault/vault-filter/models/vault-filter.model\";\nimport { VaultFilterService as BaseVaultFilterService } from \"@bitwarden/angular/vault/vault-filter/services/vault-filter.service\";\nimport { OrganizationService } from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { StateProvider } from \"@bitwarden/common/platform/state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nexport class VaultFilterService extends BaseVaultFilterService {\n  vaultFilter: VaultFilter = new VaultFilter();\n\n  allVaults = \"allVaults\";\n  myVault = \"myVault\";\n\n  constructor(\n    organizationService: OrganizationService,\n    folderService: FolderService,\n    cipherService: CipherService,\n    collectionService: CollectionService,\n    policyService: PolicyService,\n    stateProvider: StateProvider,\n    private accountService: AccountService,\n  ) {\n    super(\n      organizationService,\n      folderService,\n      cipherService,\n      collectionService,\n      policyService,\n      stateProvider,\n    );\n    this.vaultFilter.myVaultOnly = false;\n    this.vaultFilter.selectedOrganizationId = null;\n\n    this.accountService.activeAccount$.subscribe((account) => {\n      this.setVaultFilter(this.allVaults);\n    });\n  }\n\n  getVaultFilter() {\n    return this.vaultFilter;\n  }\n\n  setVaultFilter(filter: string) {\n    if (filter === this.allVaults) {\n      this.vaultFilter.myVaultOnly = false;\n      this.vaultFilter.selectedOrganizationId = null;\n    } else if (filter === this.myVault) {\n      this.vaultFilter.myVaultOnly = true;\n      this.vaultFilter.selectedOrganizationId = null;\n    } else {\n      this.vaultFilter.myVaultOnly = false;\n      this.vaultFilter.selectedOrganizationId = filter;\n    }\n  }\n\n  clear() {\n    this.setVaultFilter(this.allVaults);\n  }\n\n  filterCipherForSelectedVault(cipher: CipherView) {\n    if (!this.vaultFilter.selectedOrganizationId && !this.vaultFilter.myVaultOnly) {\n      return false;\n    }\n    if (this.vaultFilter.selectedOrganizationId) {\n      if (cipher.organizationId === this.vaultFilter.selectedOrganizationId) {\n        return false;\n      }\n    } else if (this.vaultFilter.myVaultOnly) {\n      if (!cipher.organizationId) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n","import { VaultTimeoutService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { PasswordGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/password\";\n\nimport { openUnlockPopout } from \"../auth/popup/utils/auth-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../autofill/background/abstractions/notification.background\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\n\nimport MainBackground from \"./main.background\";\n\nexport default class CommandsBackground {\n  private isSafari: boolean;\n  private isVivaldi: boolean;\n\n  constructor(\n    private main: MainBackground,\n    private passwordGenerationService: PasswordGenerationServiceAbstraction,\n    private platformUtilsService: PlatformUtilsService,\n    private vaultTimeoutService: VaultTimeoutService,\n    private authService: AuthService,\n  ) {\n    this.isSafari = this.platformUtilsService.isSafari();\n    this.isVivaldi = this.platformUtilsService.isVivaldi();\n  }\n\n  async init() {\n    BrowserApi.messageListener(\"commands.background\", (msg: any) => {\n      if (msg.command === \"unlockCompleted\" && msg.data.target === \"commands.background\") {\n        this.processCommand(\n          msg.data.commandToRetry.message.command,\n          msg.data.commandToRetry.sender,\n        ).catch((error) => this.main.logService.error(error));\n      }\n    });\n\n    if (chrome && chrome.commands) {\n      chrome.commands.onCommand.addListener(async (command: string) => {\n        await this.processCommand(command);\n      });\n    }\n  }\n\n  private async processCommand(command: string, sender?: chrome.runtime.MessageSender) {\n    switch (command) {\n      case \"generate_password\":\n        await this.generatePasswordToClipboard();\n        break;\n      case \"autofill_login\":\n        await this.autoFillLogin(sender ? sender.tab : null);\n        break;\n      case \"open_popup\":\n        await this.openPopup();\n        break;\n      case \"lock_vault\":\n        await this.vaultTimeoutService.lock();\n        break;\n      default:\n        break;\n    }\n  }\n\n  private async generatePasswordToClipboard() {\n    const options = (await this.passwordGenerationService.getOptions())?.[0] ?? {};\n    const password = await this.passwordGenerationService.generatePassword(options);\n    this.platformUtilsService.copyToClipboard(password);\n    await this.passwordGenerationService.addHistory(password);\n  }\n\n  private async autoFillLogin(tab?: chrome.tabs.Tab) {\n    if (!tab) {\n      tab = await BrowserApi.getTabFromCurrentWindowId();\n    }\n\n    if (tab == null) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      const retryMessage: LockedVaultPendingNotificationsData = {\n        commandToRetry: {\n          message: { command: \"autofill_login\" },\n          sender: { tab: tab },\n        },\n        target: \"commands.background\",\n      };\n      await BrowserApi.tabSendMessageData(\n        tab,\n        \"addToLockedVaultPendingNotifications\",\n        retryMessage,\n      );\n\n      await openUnlockPopout(tab);\n      return;\n    }\n\n    await this.main.collectPageDetailsForContentScript(tab, \"autofill_cmd\");\n  }\n\n  private async openPopup() {\n    // Chrome APIs cannot open popup\n    if (!this.isSafari) {\n      return;\n    }\n\n    await this.main.openPopup();\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { NotificationsService } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { VaultTimeoutSettingsService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { VaultTimeoutService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { VaultTimeoutAction } from \"@bitwarden/common/enums/vault-timeout-action.enum\";\nimport { VaultTimeoutStringType } from \"@bitwarden/common/types/vault-timeout.type\";\n\nimport { BrowserStateService } from \"../platform/services/abstractions/browser-state.service\";\n\nconst IdleInterval = 60 * 5; // 5 minutes\n\nexport default class IdleBackground {\n  private idle: typeof chrome.idle | typeof browser.idle | null;\n  private idleTimer: number | NodeJS.Timeout = null;\n  private idleState = \"active\";\n\n  constructor(\n    private vaultTimeoutService: VaultTimeoutService,\n    private stateService: BrowserStateService,\n    private notificationsService: NotificationsService,\n    private accountService: AccountService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n  ) {\n    this.idle = chrome.idle || (browser != null ? browser.idle : null);\n  }\n\n  async init() {\n    if (!this.idle) {\n      return;\n    }\n\n    const idleHandler = (newState: string) => {\n      if (newState === \"active\") {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.reconnectFromActivity();\n      } else {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.disconnectFromInactivity();\n      }\n    };\n    if (this.idle.onStateChanged && this.idle.setDetectionInterval) {\n      this.idle.setDetectionInterval(IdleInterval);\n      this.idle.onStateChanged.addListener(idleHandler);\n    } else {\n      this.pollIdle(idleHandler);\n    }\n\n    if (this.idle.onStateChanged) {\n      this.idle.onStateChanged.addListener(\n        async (newState: chrome.idle.IdleState | browser.idle.IdleState) => {\n          if (newState === \"locked\") {\n            // Need to check if any of the current users have their timeout set to `onLocked`\n            const allUsers = await firstValueFrom(this.accountService.accounts$);\n            for (const userId in allUsers) {\n              // If the screen is locked or the screensaver activates\n              const timeout = await firstValueFrom(\n                this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n              );\n              if (timeout === VaultTimeoutStringType.OnLocked) {\n                // On System Lock vault timeout option\n                const action = await firstValueFrom(\n                  this.vaultTimeoutSettingsService.getVaultTimeoutActionByUserId$(userId),\n                );\n                if (action === VaultTimeoutAction.LogOut) {\n                  await this.vaultTimeoutService.logOut(userId);\n                } else {\n                  await this.vaultTimeoutService.lock(userId);\n                }\n              }\n            }\n          }\n        },\n      );\n    }\n  }\n\n  private pollIdle(handler: (newState: string) => void) {\n    if (this.idleTimer != null) {\n      globalThis.clearTimeout(this.idleTimer);\n      this.idleTimer = null;\n    }\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.idle.queryState(IdleInterval, (state: string) => {\n      if (state !== this.idleState) {\n        this.idleState = state;\n        handler(state);\n      }\n      this.idleTimer = globalThis.setTimeout(() => this.pollIdle(handler), 5000);\n    });\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"@bitwarden/common/auth/abstractions/master-password.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { BiometricStateService } from \"@bitwarden/common/platform/biometrics/biometric-state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { UserKey, MasterKey } from \"@bitwarden/common/types/key\";\n\nimport { BrowserApi } from \"../platform/browser/browser-api\";\n\nimport RuntimeBackground from \"./runtime.background\";\n\nconst MessageValidTimeout = 10 * 1000;\nconst EncryptionAlgorithm = \"sha1\";\n\ntype Message = {\n  command: string;\n\n  // Filled in by this service\n  userId?: string;\n  timestamp?: number;\n\n  // Used for sharing secret\n  publicKey?: string;\n};\n\ntype OuterMessage = {\n  message: Message | EncString;\n  appId: string;\n};\n\ntype ReceiveMessage = {\n  timestamp: number;\n  command: string;\n  response?: any;\n\n  // Unlock key\n  keyB64?: string;\n  userKeyB64?: string;\n};\n\ntype ReceiveMessageOuter = {\n  command: string;\n  appId: string;\n\n  // Should only have one of these.\n  message?: EncString;\n  sharedSecret?: string;\n};\n\nexport class NativeMessagingBackground {\n  private connected = false;\n  private connecting: boolean;\n  private port: browser.runtime.Port | chrome.runtime.Port;\n\n  private resolver: any = null;\n  private privateKey: Uint8Array = null;\n  private publicKey: Uint8Array = null;\n  private secureSetupResolve: any = null;\n  private sharedSecret: SymmetricCryptoKey;\n  private appId: string;\n  private validatingFingerprint: boolean;\n\n  constructor(\n    private accountService: AccountService,\n    private masterPasswordService: InternalMasterPasswordServiceAbstraction,\n    private cryptoService: CryptoService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private runtimeBackground: RuntimeBackground,\n    private messagingService: MessagingService,\n    private appIdService: AppIdService,\n    private platformUtilsService: PlatformUtilsService,\n    private stateService: StateService,\n    private logService: LogService,\n    private authService: AuthService,\n    private biometricStateService: BiometricStateService,\n  ) {\n    if (chrome?.permissions?.onAdded) {\n      // Reload extension to activate nativeMessaging\n      chrome.permissions.onAdded.addListener((permissions) => {\n        if (permissions.permissions?.includes(\"nativeMessaging\")) {\n          BrowserApi.reloadExtension(null);\n        }\n      });\n    }\n  }\n\n  async connect() {\n    this.appId = await this.appIdService.getAppId();\n    await this.biometricStateService.setFingerprintValidated(false);\n\n    return new Promise<void>((resolve, reject) => {\n      this.port = BrowserApi.connectNative(\"com.8bit.bitwarden\");\n\n      this.connecting = true;\n\n      const connectedCallback = () => {\n        this.connected = true;\n        this.connecting = false;\n        resolve();\n      };\n\n      // Safari has a bundled native component which is always available, no need to\n      // check if the desktop app is running.\n      if (this.platformUtilsService.isSafari()) {\n        connectedCallback();\n      }\n\n      this.port.onMessage.addListener(async (message: ReceiveMessageOuter) => {\n        switch (message.command) {\n          case \"connected\":\n            connectedCallback();\n            break;\n          case \"disconnected\":\n            if (this.connecting) {\n              reject(new Error(\"startDesktop\"));\n            }\n            this.connected = false;\n            this.port.disconnect();\n            break;\n          case \"setupEncryption\": {\n            // Ignore since it belongs to another device\n            if (message.appId !== this.appId) {\n              return;\n            }\n\n            const encrypted = Utils.fromB64ToArray(message.sharedSecret);\n            const decrypted = await this.cryptoFunctionService.rsaDecrypt(\n              encrypted,\n              this.privateKey,\n              EncryptionAlgorithm,\n            );\n\n            if (this.validatingFingerprint) {\n              this.validatingFingerprint = false;\n              await this.biometricStateService.setFingerprintValidated(true);\n            }\n            this.sharedSecret = new SymmetricCryptoKey(decrypted);\n            this.secureSetupResolve();\n            break;\n          }\n          case \"invalidateEncryption\":\n            // Ignore since it belongs to another device\n            if (message.appId !== this.appId) {\n              return;\n            }\n\n            this.sharedSecret = null;\n            this.privateKey = null;\n            this.connected = false;\n\n            this.messagingService.send(\"showDialog\", {\n              title: { key: \"nativeMessagingInvalidEncryptionTitle\" },\n              content: { key: \"nativeMessagingInvalidEncryptionDesc\" },\n              acceptButtonText: { key: \"ok\" },\n              cancelButtonText: null,\n              type: \"danger\",\n            });\n\n            if (this.resolver) {\n              this.resolver(message);\n            }\n\n            break;\n          case \"verifyFingerprint\": {\n            if (this.sharedSecret == null) {\n              this.validatingFingerprint = true;\n              // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n              this.showFingerprintDialog();\n            }\n            break;\n          }\n          case \"wrongUserId\":\n            this.showWrongUserDialog();\n            break;\n          default:\n            // Ignore since it belongs to another device\n            if (!this.platformUtilsService.isSafari() && message.appId !== this.appId) {\n              return;\n            }\n\n            // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.onMessage(message.message);\n        }\n      });\n\n      this.port.onDisconnect.addListener((p: any) => {\n        let error;\n        if (BrowserApi.isWebExtensionsApi) {\n          error = p.error.message;\n        } else {\n          error = chrome.runtime.lastError.message;\n        }\n\n        this.sharedSecret = null;\n        this.privateKey = null;\n        this.connected = false;\n\n        this.logService.error(\"NativeMessaging port disconnected because of error: \" + error);\n\n        const reason = error != null ? \"desktopIntegrationDisabled\" : null;\n        reject(new Error(reason));\n      });\n    });\n  }\n\n  showWrongUserDialog() {\n    this.messagingService.send(\"showDialog\", {\n      title: { key: \"nativeMessagingWrongUserTitle\" },\n      content: { key: \"nativeMessagingWrongUserDesc\" },\n      acceptButtonText: { key: \"ok\" },\n      cancelButtonText: null,\n      type: \"danger\",\n    });\n  }\n\n  async send(message: Message) {\n    if (!this.connected) {\n      await this.connect();\n    }\n\n    message.userId = await this.stateService.getUserId();\n    message.timestamp = Date.now();\n\n    if (this.platformUtilsService.isSafari()) {\n      this.postMessage(message as any);\n    } else {\n      this.postMessage({ appId: this.appId, message: await this.encryptMessage(message) });\n    }\n  }\n\n  async encryptMessage(message: Message) {\n    if (this.sharedSecret == null) {\n      await this.secureCommunication();\n    }\n\n    return await this.cryptoService.encrypt(JSON.stringify(message), this.sharedSecret);\n  }\n\n  getResponse(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.resolver = resolve;\n    });\n  }\n\n  private postMessage(message: OuterMessage) {\n    // Wrap in try-catch to when the port disconnected without triggering `onDisconnect`.\n    try {\n      const msg: any = message;\n      if (message.message instanceof EncString) {\n        // Alternative, backwards-compatible serialization of EncString\n        msg.message = {\n          encryptedString: message.message.encryptedString,\n          encryptionType: message.message.encryptionType,\n          data: message.message.data,\n          iv: message.message.iv,\n          mac: message.message.mac,\n        };\n      }\n      this.port.postMessage(msg);\n    } catch (e) {\n      this.logService.error(\"NativeMessaging port disconnected, disconnecting.\");\n\n      this.sharedSecret = null;\n      this.privateKey = null;\n      this.connected = false;\n\n      this.messagingService.send(\"showDialog\", {\n        title: { key: \"nativeMessagingInvalidEncryptionTitle\" },\n        content: { key: \"nativeMessagingInvalidEncryptionDesc\" },\n        acceptButtonText: { key: \"ok\" },\n        cancelButtonText: null,\n        type: \"danger\",\n      });\n    }\n  }\n\n  private async onMessage(rawMessage: ReceiveMessage | EncString) {\n    let message = rawMessage as ReceiveMessage;\n    if (!this.platformUtilsService.isSafari()) {\n      message = JSON.parse(\n        await this.cryptoService.decryptToUtf8(rawMessage as EncString, this.sharedSecret),\n      );\n    }\n\n    if (Math.abs(message.timestamp - Date.now()) > MessageValidTimeout) {\n      this.logService.error(\"NativeMessage is to old, ignoring.\");\n      return;\n    }\n\n    switch (message.command) {\n      case \"biometricUnlock\": {\n        if (message.response === \"not enabled\") {\n          this.messagingService.send(\"showDialog\", {\n            title: { key: \"biometricsNotEnabledTitle\" },\n            content: { key: \"biometricsNotEnabledDesc\" },\n            acceptButtonText: { key: \"ok\" },\n            cancelButtonText: null,\n            type: \"danger\",\n          });\n          break;\n        } else if (message.response === \"not supported\") {\n          this.messagingService.send(\"showDialog\", {\n            title: { key: \"biometricsNotSupportedTitle\" },\n            content: { key: \"biometricsNotSupportedDesc\" },\n            acceptButtonText: { key: \"ok\" },\n            cancelButtonText: null,\n            type: \"danger\",\n          });\n          break;\n        } else if (message.response === \"not unlocked\") {\n          this.messagingService.send(\"showDialog\", {\n            title: { key: \"biometricsNotUnlockedTitle\" },\n            content: { key: \"biometricsNotUnlockedDesc\" },\n            acceptButtonText: { key: \"ok\" },\n            cancelButtonText: null,\n            type: \"danger\",\n          });\n          break;\n        } else if (message.response === \"canceled\") {\n          break;\n        }\n\n        // Check for initial setup of biometric unlock\n        const enabled = await firstValueFrom(this.biometricStateService.biometricUnlockEnabled$);\n        if (enabled === null || enabled === false) {\n          if (message.response === \"unlocked\") {\n            await this.biometricStateService.setBiometricUnlockEnabled(true);\n          }\n          break;\n        }\n\n        // Ignore unlock if already unlocked\n        if ((await this.authService.getAuthStatus()) === AuthenticationStatus.Unlocked) {\n          break;\n        }\n\n        if (message.response === \"unlocked\") {\n          try {\n            if (message.userKeyB64) {\n              const userKey = new SymmetricCryptoKey(\n                Utils.fromB64ToArray(message.userKeyB64),\n              ) as UserKey;\n              await this.cryptoService.setUserKey(userKey);\n            } else if (message.keyB64) {\n              const userId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n              // Backwards compatibility to support cases in which the user hasn't updated their desktop app\n              // TODO: Remove after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3472)\n              const encUserKeyPrim = await this.stateService.getEncryptedCryptoSymmetricKey();\n              const encUserKey =\n                encUserKeyPrim != null\n                  ? new EncString(encUserKeyPrim)\n                  : await this.masterPasswordService.getMasterKeyEncryptedUserKey(userId);\n              if (!encUserKey) {\n                throw new Error(\"No encrypted user key found\");\n              }\n              const masterKey = new SymmetricCryptoKey(\n                Utils.fromB64ToArray(message.keyB64),\n              ) as MasterKey;\n              const userKey = await this.masterPasswordService.decryptUserKeyWithMasterKey(\n                masterKey,\n                encUserKey,\n              );\n              await this.masterPasswordService.setMasterKey(masterKey, userId);\n              await this.cryptoService.setUserKey(userKey);\n            } else {\n              throw new Error(\"No key received\");\n            }\n          } catch (e) {\n            this.logService.error(\"Unable to set key: \" + e);\n            this.messagingService.send(\"showDialog\", {\n              title: { key: \"biometricsFailedTitle\" },\n              content: { key: \"biometricsFailedDesc\" },\n              acceptButtonText: { key: \"ok\" },\n              cancelButtonText: null,\n              type: \"danger\",\n            });\n\n            // Exit early\n            if (this.resolver) {\n              this.resolver(message);\n            }\n            return;\n          }\n\n          // Verify key is correct by attempting to decrypt a secret\n          try {\n            await this.cryptoService.getFingerprint(await this.stateService.getUserId());\n          } catch (e) {\n            this.logService.error(\"Unable to verify key: \" + e);\n            await this.cryptoService.clearKeys();\n            this.showWrongUserDialog();\n\n            // Exit early\n            if (this.resolver) {\n              this.resolver(message);\n            }\n            return;\n          }\n\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.runtimeBackground.processMessage({ command: \"unlocked\" });\n        }\n        break;\n      }\n      default:\n        this.logService.error(\"NativeMessage, got unknown command: \" + message.command);\n        break;\n    }\n\n    if (this.resolver) {\n      this.resolver(message);\n    }\n  }\n\n  private async secureCommunication() {\n    const [publicKey, privateKey] = await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n    this.publicKey = publicKey;\n    this.privateKey = privateKey;\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.sendUnencrypted({\n      command: \"setupEncryption\",\n      publicKey: Utils.fromBufferToB64(publicKey),\n      userId: await this.stateService.getUserId(),\n    });\n\n    return new Promise((resolve, reject) => (this.secureSetupResolve = resolve));\n  }\n\n  private async sendUnencrypted(message: Message) {\n    if (!this.connected) {\n      await this.connect();\n    }\n\n    message.timestamp = Date.now();\n\n    this.postMessage({ appId: this.appId, message: message });\n  }\n\n  private async showFingerprintDialog() {\n    const fingerprint = await this.cryptoService.getFingerprint(\n      await this.stateService.getUserId(),\n      this.publicKey,\n    );\n\n    this.messagingService.send(\"showNativeMessagingFinterprintDialog\", {\n      fingerprint: fingerprint,\n    });\n  }\n}\n","import { firstValueFrom, map, mergeMap } from \"rxjs\";\n\nimport { NotificationsService } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AutofillOverlayVisibility } from \"@bitwarden/common/autofill/constants\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { FeatureFlag } from \"@bitwarden/common/enums/feature-flag.enum\";\nimport { ConfigService } from \"@bitwarden/common/platform/abstractions/config/config.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { SystemService } from \"@bitwarden/common/platform/abstractions/system.service\";\nimport { devFlagEnabled } from \"@bitwarden/common/platform/misc/flags\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\n\nimport { MessageListener, isExternalMessage } from \"../../../../libs/common/src/platform/messaging\";\nimport {\n  closeUnlockPopout,\n  openSsoAuthResultPopout,\n  openTwoFactorAuthPopout,\n} from \"../auth/popup/utils/auth-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../autofill/background/abstractions/notification.background\";\nimport { AutofillService } from \"../autofill/services/abstractions/autofill.service\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\nimport { BrowserEnvironmentService } from \"../platform/services/browser-environment.service\";\nimport { BrowserPlatformUtilsService } from \"../platform/services/platform-utils/browser-platform-utils.service\";\nimport { Fido2Background } from \"../vault/fido2/background/abstractions/fido2.background\";\n\nimport MainBackground from \"./main.background\";\n\nexport default class RuntimeBackground {\n  private autofillTimeout: any;\n  private pageDetailsToAutoFill: any[] = [];\n  private onInstalledReason: string = null;\n  private lockedVaultPendingNotifications: LockedVaultPendingNotificationsData[] = [];\n\n  constructor(\n    private main: MainBackground,\n    private autofillService: AutofillService,\n    private platformUtilsService: BrowserPlatformUtilsService,\n    private notificationsService: NotificationsService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private systemService: SystemService,\n    private environmentService: BrowserEnvironmentService,\n    private messagingService: MessagingService,\n    private logService: LogService,\n    private configService: ConfigService,\n    private fido2Background: Fido2Background,\n    private messageListener: MessageListener,\n    private accountService: AccountService,\n  ) {\n    // onInstalled listener must be wired up before anything else, so we do it in the ctor\n    chrome.runtime.onInstalled.addListener((details: any) => {\n      this.onInstalledReason = details.reason;\n    });\n  }\n\n  async init() {\n    if (!chrome.runtime) {\n      return;\n    }\n\n    await this.checkOnInstalled();\n    const backgroundMessageListener = (\n      msg: any,\n      sender: chrome.runtime.MessageSender,\n      sendResponse: (response: any) => void,\n    ) => {\n      const messagesWithResponse = [\n        \"biometricUnlock\",\n        \"getUseTreeWalkerApiForPageDetailsCollectionFeatureFlag\",\n      ];\n\n      if (messagesWithResponse.includes(msg.command)) {\n        this.processMessageWithSender(msg, sender).then(\n          (value) => sendResponse({ result: value }),\n          (error) => sendResponse({ error: { ...error, message: error.message } }),\n        );\n        return true;\n      }\n\n      void this.processMessageWithSender(msg, sender).catch((err) =>\n        this.logService.error(\n          `Error while processing message in RuntimeBackground '${msg?.command}'.`,\n          err,\n        ),\n      );\n      return false;\n    };\n\n    this.messageListener.allMessages$\n      .pipe(\n        mergeMap(async (message: any) => {\n          try {\n            await this.processMessage(message);\n          } catch (err) {\n            this.logService.error(err);\n          }\n        }),\n      )\n      .subscribe();\n\n    // For messages that require the full on message interface\n    BrowserApi.messageListener(\"runtime.background\", backgroundMessageListener);\n  }\n\n  // Messages that need the chrome sender and send back a response need to be registered in this method.\n  async processMessageWithSender(msg: any, sender: chrome.runtime.MessageSender) {\n    switch (msg.command) {\n      case \"triggerAutofillScriptInjection\":\n        await this.autofillService.injectAutofillScripts(sender.tab, sender.frameId);\n        break;\n      case \"bgCollectPageDetails\":\n        await this.main.collectPageDetailsForContentScript(sender.tab, msg.sender, sender.frameId);\n        break;\n      case \"collectPageDetailsResponse\":\n        switch (msg.sender) {\n          case \"autofiller\":\n          case \"autofill_cmd\": {\n            const activeUserId = await firstValueFrom(\n              this.accountService.activeAccount$.pipe(map((a) => a?.id)),\n            );\n            await this.accountService.setAccountActivity(activeUserId, new Date());\n            const totpCode = await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              msg.sender === \"autofill_cmd\",\n            );\n            if (totpCode != null) {\n              this.platformUtilsService.copyToClipboard(totpCode);\n            }\n            break;\n          }\n          case \"autofill_card\": {\n            await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              false,\n              CipherType.Card,\n            );\n            break;\n          }\n          case \"autofill_identity\": {\n            await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              false,\n              CipherType.Identity,\n            );\n            break;\n          }\n          case \"contextMenu\":\n            clearTimeout(this.autofillTimeout);\n            this.pageDetailsToAutoFill.push({\n              frameId: sender.frameId,\n              tab: msg.tab,\n              details: msg.details,\n            });\n            this.autofillTimeout = setTimeout(async () => await this.autofillPage(msg.tab), 300);\n            break;\n          default:\n            break;\n        }\n        break;\n      case \"biometricUnlock\": {\n        const result = await this.main.biometricUnlock();\n        return result;\n      }\n      case \"getUseTreeWalkerApiForPageDetailsCollectionFeatureFlag\": {\n        return await this.configService.getFeatureFlag(\n          FeatureFlag.UseTreeWalkerApiForPageDetailsCollection,\n        );\n      }\n    }\n  }\n\n  async processMessage(msg: any) {\n    switch (msg.command) {\n      case \"loggedIn\":\n      case \"unlocked\": {\n        let item: LockedVaultPendingNotificationsData;\n\n        if (msg.command === \"loggedIn\") {\n          await this.sendBwInstalledMessageToVault();\n          await this.autofillService.reloadAutofillScripts();\n        }\n\n        if (this.lockedVaultPendingNotifications?.length > 0) {\n          item = this.lockedVaultPendingNotifications.pop();\n          await closeUnlockPopout();\n        }\n\n        await this.notificationsService.updateConnection(msg.command === \"loggedIn\");\n        this.systemService.cancelProcessReload();\n\n        if (item) {\n          await BrowserApi.focusWindow(item.commandToRetry.sender.tab.windowId);\n          await BrowserApi.focusTab(item.commandToRetry.sender.tab.id);\n          await BrowserApi.tabSendMessageData(\n            item.commandToRetry.sender.tab,\n            \"unlockCompleted\",\n            item,\n          );\n        }\n\n        // @TODO these need to happen last to avoid blocking `tabSendMessageData` above\n        // The underlying cause exists within `cipherService.getAllDecrypted` via\n        // `getAllDecryptedForUrl` and is anticipated to be refactored\n        await this.main.refreshBadge();\n        await this.main.refreshMenu(false);\n\n        break;\n      }\n      case \"addToLockedVaultPendingNotifications\":\n        this.lockedVaultPendingNotifications.push(msg.data);\n        break;\n      case \"logout\":\n        await this.main.logout(msg.expired, msg.userId);\n        break;\n      case \"syncCompleted\":\n        if (msg.successfully) {\n          setTimeout(async () => {\n            await this.main.refreshBadge();\n            await this.main.refreshMenu();\n          }, 2000);\n          await this.configService.ensureConfigFetched();\n        }\n        break;\n      case \"openPopup\":\n        await this.main.openPopup();\n        break;\n      case \"bgUpdateContextMenu\":\n      case \"editedCipher\":\n      case \"addedCipher\":\n      case \"deletedCipher\":\n        await this.main.refreshBadge();\n        await this.main.refreshMenu();\n        break;\n      case \"bgReseedStorage\":\n        await this.main.reseedStorage();\n        break;\n      case \"authResult\": {\n        const env = await firstValueFrom(this.environmentService.environment$);\n        const vaultUrl = env.getWebVaultUrl();\n\n        if (msg.referrer == null || Utils.getHostname(vaultUrl) !== msg.referrer) {\n          return;\n        }\n\n        if (msg.lastpass) {\n          this.messagingService.send(\"importCallbackLastPass\", {\n            code: msg.code,\n            state: msg.state,\n          });\n        } else {\n          try {\n            await openSsoAuthResultPopout(msg);\n          } catch {\n            this.logService.error(\"Unable to open sso popout tab\");\n          }\n        }\n        break;\n      }\n      case \"webAuthnResult\": {\n        const env = await firstValueFrom(this.environmentService.environment$);\n        const vaultUrl = env.getWebVaultUrl();\n\n        if (msg.referrer == null || Utils.getHostname(vaultUrl) !== msg.referrer) {\n          return;\n        }\n\n        await openTwoFactorAuthPopout(msg);\n        break;\n      }\n      case \"reloadPopup\":\n        if (isExternalMessage(msg)) {\n          this.messagingService.send(\"reloadPopup\");\n        }\n        break;\n      case \"emailVerificationRequired\":\n        this.messagingService.send(\"showDialog\", {\n          title: { key: \"emailVerificationRequired\" },\n          content: { key: \"emailVerificationRequiredDesc\" },\n          acceptButtonText: { key: \"ok\" },\n          cancelButtonText: null,\n          type: \"info\",\n        });\n        break;\n      case \"getClickedElementResponse\":\n        this.platformUtilsService.copyToClipboard(msg.identifier);\n        break;\n      case \"switchAccount\": {\n        await this.main.switchAccount(msg.userId);\n        break;\n      }\n      case \"clearClipboard\": {\n        await this.main.clearClipboard(msg.clipboardValue, msg.timeoutMs);\n        break;\n      }\n    }\n  }\n\n  private async autofillPage(tabToAutoFill: chrome.tabs.Tab) {\n    const totpCode = await this.autofillService.doAutoFill({\n      tab: tabToAutoFill,\n      cipher: this.main.loginToAutoFill,\n      pageDetails: this.pageDetailsToAutoFill,\n      fillNewPassword: true,\n      allowTotpAutofill: true,\n    });\n\n    if (totpCode != null) {\n      this.platformUtilsService.copyToClipboard(totpCode);\n    }\n\n    // reset\n    this.main.loginToAutoFill = null;\n    this.pageDetailsToAutoFill = [];\n  }\n\n  private async checkOnInstalled() {\n    setTimeout(async () => {\n      void this.fido2Background.injectFido2ContentScriptsInAllTabs();\n      void this.autofillService.loadAutofillScriptsOnInstall();\n\n      if (this.onInstalledReason != null) {\n        if (this.onInstalledReason === \"install\") {\n          if (!devFlagEnabled(\"skipWelcomeOnInstall\")) {\n            void BrowserApi.createNewTab(\"https://bitwarden.com/browser-start/\");\n          }\n\n          await this.autofillSettingsService.setInlineMenuVisibility(\n            AutofillOverlayVisibility.OnFieldFocus,\n          );\n\n          if (await this.environmentService.hasManagedEnvironment()) {\n            await this.environmentService.setUrlsToManagedEnvironment();\n          }\n        }\n\n        this.onInstalledReason = null;\n      }\n    }, 100);\n  }\n\n  async sendBwInstalledMessageToVault() {\n    try {\n      const env = await firstValueFrom(this.environmentService.environment$);\n      const vaultUrl = env.getWebVaultUrl();\n      const urlObj = new URL(vaultUrl);\n\n      const tabs = await BrowserApi.tabsQuery({ url: `${urlObj.href}*` });\n\n      if (!tabs?.length) {\n        return;\n      }\n\n      for (const tab of tabs) {\n        await BrowserApi.executeScriptInTab(tab.id, {\n          file: \"content/send-on-installed-message.js\",\n          runAt: \"document_end\",\n        });\n      }\n    } catch (e) {\n      this.logService.error(`Error sending on installed message to vault: ${e}`);\n    }\n  }\n}\n","import { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\n\nimport MainBackground from \"../background/main.background\";\n\nimport { BrowserApi } from \"./browser/browser-api\";\n\nconst logService = new ConsoleLogService(false);\nif (BrowserApi.isManifestVersion(3)) {\n  startHeartbeat().catch((error) => logService.error(error));\n}\nconst bitwardenMain = ((self as any).bitwardenMain = new MainBackground());\nbitwardenMain.bootstrap().catch((error) => logService.error(error));\n\n/**\n * Tracks when a service worker was last alive and extends the service worker\n * lifetime by writing the current time to extension storage every 20 seconds.\n */\nasync function runHeartbeat() {\n  await chrome.storage.local.set({ \"last-heartbeat\": new Date().getTime() });\n}\n\n/**\n * Starts the heartbeat interval which keeps the service worker alive.\n */\nasync function startHeartbeat() {\n  // Run the heartbeat once at service worker startup, then again every 20 seconds.\n  runHeartbeat()\n    .then(() => setInterval(runHeartbeat, 20 * 1000))\n    .catch((error) => logService.error(error));\n}\n","import { Subject, filter, firstValueFrom, map, merge, timeout } from \"rxjs\";\n\nimport {\n  PinServiceAbstraction,\n  PinService,\n  InternalUserDecryptionOptionsServiceAbstraction,\n  UserDecryptionOptionsService,\n  AuthRequestServiceAbstraction,\n  AuthRequestService,\n  LoginEmailServiceAbstraction,\n  LoginEmailService,\n  LogoutReason,\n} from \"@bitwarden/auth/common\";\nimport { ApiService as ApiServiceAbstraction } from \"@bitwarden/common/abstractions/api.service\";\nimport { AuditService as AuditServiceAbstraction } from \"@bitwarden/common/abstractions/audit.service\";\nimport { EventCollectionService as EventCollectionServiceAbstraction } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { EventUploadService as EventUploadServiceAbstraction } from \"@bitwarden/common/abstractions/event/event-upload.service\";\nimport { NotificationsService as NotificationsServiceAbstraction } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { SearchService as SearchServiceAbstraction } from \"@bitwarden/common/abstractions/search.service\";\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { InternalOrganizationServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyApiServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/policy/policy-api.service.abstraction\";\nimport { InternalPolicyService as InternalPolicyServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { ProviderService as ProviderServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/provider.service\";\nimport { OrganizationService } from \"@bitwarden/common/admin-console/services/organization/organization.service\";\nimport { PolicyApiService } from \"@bitwarden/common/admin-console/services/policy/policy-api.service\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/services/policy/policy.service\";\nimport { ProviderService } from \"@bitwarden/common/admin-console/services/provider.service\";\nimport { AccountService as AccountServiceAbstraction } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService as AuthServiceAbstraction } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AvatarService as AvatarServiceAbstraction } from \"@bitwarden/common/auth/abstractions/avatar.service\";\nimport { DeviceTrustServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust.service.abstraction\";\nimport { DevicesServiceAbstraction } from \"@bitwarden/common/auth/abstractions/devices/devices.service.abstraction\";\nimport { DevicesApiServiceAbstraction } from \"@bitwarden/common/auth/abstractions/devices-api.service.abstraction\";\nimport { KdfConfigService as kdfConfigServiceAbstraction } from \"@bitwarden/common/auth/abstractions/kdf-config.service\";\nimport { KeyConnectorService as KeyConnectorServiceAbstraction } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { InternalMasterPasswordServiceAbstraction } from \"@bitwarden/common/auth/abstractions/master-password.service.abstraction\";\nimport { SsoLoginServiceAbstraction } from \"@bitwarden/common/auth/abstractions/sso-login.service.abstraction\";\nimport { TokenService as TokenServiceAbstraction } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { UserVerificationApiServiceAbstraction } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { UserVerificationService as UserVerificationServiceAbstraction } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { AccountServiceImplementation } from \"@bitwarden/common/auth/services/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/services/auth.service\";\nimport { AvatarService } from \"@bitwarden/common/auth/services/avatar.service\";\nimport { DeviceTrustService } from \"@bitwarden/common/auth/services/device-trust.service.implementation\";\nimport { DevicesServiceImplementation } from \"@bitwarden/common/auth/services/devices/devices.service.implementation\";\nimport { DevicesApiServiceImplementation } from \"@bitwarden/common/auth/services/devices-api.service.implementation\";\nimport { KdfConfigService } from \"@bitwarden/common/auth/services/kdf-config.service\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/services/key-connector.service\";\nimport { MasterPasswordService } from \"@bitwarden/common/auth/services/master-password/master-password.service\";\nimport { SsoLoginService } from \"@bitwarden/common/auth/services/sso-login.service\";\nimport { TokenService } from \"@bitwarden/common/auth/services/token.service\";\nimport { UserVerificationApiService } from \"@bitwarden/common/auth/services/user-verification/user-verification-api.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/services/user-verification/user-verification.service\";\nimport {\n  AutofillSettingsServiceAbstraction,\n  AutofillSettingsService,\n} from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport {\n  BadgeSettingsServiceAbstraction,\n  BadgeSettingsService,\n} from \"@bitwarden/common/autofill/services/badge-settings.service\";\nimport {\n  DomainSettingsService,\n  DefaultDomainSettingsService,\n} from \"@bitwarden/common/autofill/services/domain-settings.service\";\nimport {\n  UserNotificationSettingsService,\n  UserNotificationSettingsServiceAbstraction,\n} from \"@bitwarden/common/autofill/services/user-notification-settings.service\";\nimport { BillingAccountProfileStateService } from \"@bitwarden/common/billing/abstractions/account/billing-account-profile-state.service\";\nimport { DefaultBillingAccountProfileStateService } from \"@bitwarden/common/billing/services/account/billing-account-profile-state.service\";\nimport { ClientType } from \"@bitwarden/common/enums\";\nimport { AppIdService as AppIdServiceAbstraction } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { ConfigApiServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config-api.service.abstraction\";\nimport { ConfigService } from \"@bitwarden/common/platform/abstractions/config/config.service\";\nimport { CryptoFunctionService as CryptoFunctionServiceAbstraction } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService as CryptoServiceAbstraction } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { Fido2AuthenticatorService as Fido2AuthenticatorServiceAbstraction } from \"@bitwarden/common/platform/abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport { Fido2ClientService as Fido2ClientServiceAbstraction } from \"@bitwarden/common/platform/abstractions/fido2/fido2-client.service.abstraction\";\nimport { Fido2UserInterfaceService as Fido2UserInterfaceServiceAbstraction } from \"@bitwarden/common/platform/abstractions/fido2/fido2-user-interface.service.abstraction\";\nimport { FileUploadService as FileUploadServiceAbstraction } from \"@bitwarden/common/platform/abstractions/file-upload/file-upload.service\";\nimport { I18nService as I18nServiceAbstraction } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { KeyGenerationService as KeyGenerationServiceAbstraction } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport { LogService as LogServiceAbstraction } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { PlatformUtilsService as PlatformUtilsServiceAbstraction } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { SystemService as SystemServiceAbstraction } from \"@bitwarden/common/platform/abstractions/system.service\";\nimport {\n  BiometricStateService,\n  DefaultBiometricStateService,\n} from \"@bitwarden/common/platform/biometrics/biometric-state.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { Message, MessageListener, MessageSender } from \"@bitwarden/common/platform/messaging\";\n// eslint-disable-next-line no-restricted-imports -- Used for dependency creation\nimport { SubjectMessageSender } from \"@bitwarden/common/platform/messaging/internal\";\nimport { Lazy } from \"@bitwarden/common/platform/misc/lazy\";\nimport { clearCaches } from \"@bitwarden/common/platform/misc/sequentialize\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { AppIdService } from \"@bitwarden/common/platform/services/app-id.service\";\nimport { ConfigApiService } from \"@bitwarden/common/platform/services/config/config-api.service\";\nimport { DefaultConfigService } from \"@bitwarden/common/platform/services/config/default-config.service\";\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\nimport { ContainerService } from \"@bitwarden/common/platform/services/container.service\";\nimport { EncryptServiceImplementation } from \"@bitwarden/common/platform/services/cryptography/encrypt.service.implementation\";\nimport { MultithreadEncryptServiceImplementation } from \"@bitwarden/common/platform/services/cryptography/multithread-encrypt.service.implementation\";\nimport { Fido2AuthenticatorService } from \"@bitwarden/common/platform/services/fido2/fido2-authenticator.service\";\nimport { Fido2ClientService } from \"@bitwarden/common/platform/services/fido2/fido2-client.service\";\nimport { FileUploadService } from \"@bitwarden/common/platform/services/file-upload/file-upload.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/services/key-generation.service\";\nimport { MigrationBuilderService } from \"@bitwarden/common/platform/services/migration-builder.service\";\nimport { MigrationRunner } from \"@bitwarden/common/platform/services/migration-runner\";\nimport { SystemService } from \"@bitwarden/common/platform/services/system.service\";\nimport { UserAutoUnlockKeyService } from \"@bitwarden/common/platform/services/user-auto-unlock-key.service\";\nimport { WebCryptoFunctionService } from \"@bitwarden/common/platform/services/web-crypto-function.service\";\nimport {\n  ActiveUserStateProvider,\n  DerivedStateProvider,\n  GlobalStateProvider,\n  SingleUserStateProvider,\n  StateEventRunnerService,\n  StateProvider,\n} from \"@bitwarden/common/platform/state\";\n/* eslint-disable import/no-restricted-paths -- We need the implementation to inject, but generally these should not be accessed */\nimport { DefaultActiveUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-active-user-state.provider\";\nimport { DefaultGlobalStateProvider } from \"@bitwarden/common/platform/state/implementations/default-global-state.provider\";\nimport { DefaultSingleUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-single-user-state.provider\";\nimport { DefaultStateProvider } from \"@bitwarden/common/platform/state/implementations/default-state.provider\";\nimport { InlineDerivedStateProvider } from \"@bitwarden/common/platform/state/implementations/inline-derived-state\";\nimport { StateEventRegistrarService } from \"@bitwarden/common/platform/state/state-event-registrar.service\";\n/* eslint-enable import/no-restricted-paths */\nimport { DefaultThemeStateService } from \"@bitwarden/common/platform/theming/theme-state.service\";\nimport { ApiService } from \"@bitwarden/common/services/api.service\";\nimport { AuditService } from \"@bitwarden/common/services/audit.service\";\nimport { EventCollectionService } from \"@bitwarden/common/services/event/event-collection.service\";\nimport { EventUploadService } from \"@bitwarden/common/services/event/event-upload.service\";\nimport { NotificationsService } from \"@bitwarden/common/services/notifications.service\";\nimport { SearchService } from \"@bitwarden/common/services/search.service\";\nimport { VaultTimeoutSettingsService } from \"@bitwarden/common/services/vault-timeout/vault-timeout-settings.service\";\nimport {\n  legacyPasswordGenerationServiceFactory,\n  legacyUsernameGenerationServiceFactory,\n} from \"@bitwarden/common/tools/generator\";\nimport { PasswordGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/password\";\nimport { UsernameGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/username\";\nimport {\n  PasswordStrengthService,\n  PasswordStrengthServiceAbstraction,\n} from \"@bitwarden/common/tools/password-strength\";\nimport { SendApiService } from \"@bitwarden/common/tools/send/services/send-api.service\";\nimport { SendApiService as SendApiServiceAbstraction } from \"@bitwarden/common/tools/send/services/send-api.service.abstraction\";\nimport { SendStateProvider } from \"@bitwarden/common/tools/send/services/send-state.provider\";\nimport { SendService } from \"@bitwarden/common/tools/send/services/send.service\";\nimport { InternalSendService as InternalSendServiceAbstraction } from \"@bitwarden/common/tools/send/services/send.service.abstraction\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { VaultTimeoutStringType } from \"@bitwarden/common/types/vault-timeout.type\";\nimport { CipherService as CipherServiceAbstraction } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService as CollectionServiceAbstraction } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { CipherFileUploadService as CipherFileUploadServiceAbstraction } from \"@bitwarden/common/vault/abstractions/file-upload/cipher-file-upload.service\";\nimport { FolderApiServiceAbstraction } from \"@bitwarden/common/vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService as InternalFolderServiceAbstraction } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { SyncNotifierService as SyncNotifierServiceAbstraction } from \"@bitwarden/common/vault/abstractions/sync/sync-notifier.service.abstraction\";\nimport { SyncService as SyncServiceAbstraction } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\nimport { TotpService as TotpServiceAbstraction } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { VaultSettingsService as VaultSettingsServiceAbstraction } from \"@bitwarden/common/vault/abstractions/vault-settings/vault-settings.service\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CipherService } from \"@bitwarden/common/vault/services/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/services/collection.service\";\nimport { CipherFileUploadService } from \"@bitwarden/common/vault/services/file-upload/cipher-file-upload.service\";\nimport { FolderApiService } from \"@bitwarden/common/vault/services/folder/folder-api.service\";\nimport { FolderService } from \"@bitwarden/common/vault/services/folder/folder.service\";\nimport { SyncNotifierService } from \"@bitwarden/common/vault/services/sync/sync-notifier.service\";\nimport { SyncService } from \"@bitwarden/common/vault/services/sync/sync.service\";\nimport { TotpService } from \"@bitwarden/common/vault/services/totp.service\";\nimport { VaultSettingsService } from \"@bitwarden/common/vault/services/vault-settings/vault-settings.service\";\nimport {\n  ImportApiService,\n  ImportApiServiceAbstraction,\n  ImportService,\n  ImportServiceAbstraction,\n} from \"@bitwarden/importer/core\";\nimport {\n  IndividualVaultExportService,\n  IndividualVaultExportServiceAbstraction,\n  OrganizationVaultExportService,\n  OrganizationVaultExportServiceAbstraction,\n  VaultExportService,\n  VaultExportServiceAbstraction,\n} from \"@bitwarden/vault-export-core\";\n\nimport ContextMenusBackground from \"../autofill/background/context-menus.background\";\nimport NotificationBackground from \"../autofill/background/notification.background\";\nimport OverlayBackground from \"../autofill/background/overlay.background\";\nimport TabsBackground from \"../autofill/background/tabs.background\";\nimport WebRequestBackground from \"../autofill/background/web-request.background\";\nimport { CipherContextMenuHandler } from \"../autofill/browser/cipher-context-menu-handler\";\nimport { ContextMenuClickedHandler } from \"../autofill/browser/context-menu-clicked-handler\";\nimport { MainContextMenuHandler } from \"../autofill/browser/main-context-menu-handler\";\nimport { AutofillService as AutofillServiceAbstraction } from \"../autofill/services/abstractions/autofill.service\";\nimport AutofillService from \"../autofill/services/autofill.service\";\nimport { SafariApp } from \"../browser/safariApp\";\nimport { Account } from \"../models/account\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\nimport { flagEnabled } from \"../platform/flags\";\nimport { UpdateBadge } from \"../platform/listeners/update-badge\";\n/* eslint-disable no-restricted-imports */\nimport { ChromeMessageSender } from \"../platform/messaging/chrome-message.sender\";\n/* eslint-enable no-restricted-imports */\nimport { OffscreenDocumentService } from \"../platform/offscreen-document/abstractions/offscreen-document\";\nimport { DefaultOffscreenDocumentService } from \"../platform/offscreen-document/offscreen-document.service\";\nimport { BrowserStateService as StateServiceAbstraction } from \"../platform/services/abstractions/browser-state.service\";\nimport { BrowserCryptoService } from \"../platform/services/browser-crypto.service\";\nimport { BrowserEnvironmentService } from \"../platform/services/browser-environment.service\";\nimport BrowserLocalStorageService from \"../platform/services/browser-local-storage.service\";\nimport BrowserMemoryStorageService from \"../platform/services/browser-memory-storage.service\";\nimport { BrowserScriptInjectorService } from \"../platform/services/browser-script-injector.service\";\nimport { DefaultBrowserStateService } from \"../platform/services/default-browser-state.service\";\nimport I18nService from \"../platform/services/i18n.service\";\nimport { LocalBackedSessionStorageService } from \"../platform/services/local-backed-session-storage.service\";\nimport { BackgroundPlatformUtilsService } from \"../platform/services/platform-utils/background-platform-utils.service\";\nimport { BrowserPlatformUtilsService } from \"../platform/services/platform-utils/browser-platform-utils.service\";\nimport { BackgroundMemoryStorageService } from \"../platform/storage/background-memory-storage.service\";\nimport { BrowserStorageServiceProvider } from \"../platform/storage/browser-storage-service.provider\";\nimport { ForegroundMemoryStorageService } from \"../platform/storage/foreground-memory-storage.service\";\nimport { ForegroundSyncService } from \"../platform/sync/foreground-sync.service\";\nimport { SyncServiceListener } from \"../platform/sync/sync-service.listener\";\nimport { fromChromeRuntimeMessaging } from \"../platform/utils/from-chrome-runtime-messaging\";\nimport VaultTimeoutService from \"../services/vault-timeout/vault-timeout.service\";\nimport FilelessImporterBackground from \"../tools/background/fileless-importer.background\";\nimport { Fido2Background as Fido2BackgroundAbstraction } from \"../vault/fido2/background/abstractions/fido2.background\";\nimport { Fido2Background } from \"../vault/fido2/background/fido2.background\";\nimport { BrowserFido2UserInterfaceService } from \"../vault/fido2/browser-fido2-user-interface.service\";\nimport { VaultFilterService } from \"../vault/services/vault-filter.service\";\n\nimport CommandsBackground from \"./commands.background\";\nimport IdleBackground from \"./idle.background\";\nimport { NativeMessagingBackground } from \"./nativeMessaging.background\";\nimport RuntimeBackground from \"./runtime.background\";\n\nexport default class MainBackground {\n  messagingService: MessageSender;\n  storageService: BrowserLocalStorageService;\n  secureStorageService: AbstractStorageService;\n  memoryStorageService: AbstractStorageService;\n  memoryStorageForStateProviders: AbstractStorageService & ObservableStorageService;\n  largeObjectMemoryStorageForStateProviders: AbstractStorageService & ObservableStorageService;\n  i18nService: I18nServiceAbstraction;\n  platformUtilsService: PlatformUtilsServiceAbstraction;\n  logService: LogServiceAbstraction;\n  keyGenerationService: KeyGenerationServiceAbstraction;\n  cryptoService: CryptoServiceAbstraction;\n  cryptoFunctionService: CryptoFunctionServiceAbstraction;\n  masterPasswordService: InternalMasterPasswordServiceAbstraction;\n  tokenService: TokenServiceAbstraction;\n  appIdService: AppIdServiceAbstraction;\n  apiService: ApiServiceAbstraction;\n  environmentService: BrowserEnvironmentService;\n  cipherService: CipherServiceAbstraction;\n  folderService: InternalFolderServiceAbstraction;\n  userDecryptionOptionsService: InternalUserDecryptionOptionsServiceAbstraction;\n  collectionService: CollectionServiceAbstraction;\n  vaultTimeoutService: VaultTimeoutService;\n  vaultTimeoutSettingsService: VaultTimeoutSettingsServiceAbstraction;\n  syncService: SyncServiceAbstraction;\n  passwordGenerationService: PasswordGenerationServiceAbstraction;\n  passwordStrengthService: PasswordStrengthServiceAbstraction;\n  totpService: TotpServiceAbstraction;\n  autofillService: AutofillServiceAbstraction;\n  containerService: ContainerService;\n  auditService: AuditServiceAbstraction;\n  authService: AuthServiceAbstraction;\n  loginEmailService: LoginEmailServiceAbstraction;\n  importApiService: ImportApiServiceAbstraction;\n  importService: ImportServiceAbstraction;\n  exportService: VaultExportServiceAbstraction;\n  searchService: SearchServiceAbstraction;\n  notificationsService: NotificationsServiceAbstraction;\n  stateService: StateServiceAbstraction;\n  userNotificationSettingsService: UserNotificationSettingsServiceAbstraction;\n  autofillSettingsService: AutofillSettingsServiceAbstraction;\n  badgeSettingsService: BadgeSettingsServiceAbstraction;\n  domainSettingsService: DomainSettingsService;\n  systemService: SystemServiceAbstraction;\n  eventCollectionService: EventCollectionServiceAbstraction;\n  eventUploadService: EventUploadServiceAbstraction;\n  policyService: InternalPolicyServiceAbstraction;\n  sendService: InternalSendServiceAbstraction;\n  sendStateProvider: SendStateProvider;\n  fileUploadService: FileUploadServiceAbstraction;\n  cipherFileUploadService: CipherFileUploadServiceAbstraction;\n  organizationService: InternalOrganizationServiceAbstraction;\n  providerService: ProviderServiceAbstraction;\n  keyConnectorService: KeyConnectorServiceAbstraction;\n  userVerificationService: UserVerificationServiceAbstraction;\n  vaultFilterService: VaultFilterService;\n  usernameGenerationService: UsernameGenerationServiceAbstraction;\n  encryptService: EncryptService;\n  folderApiService: FolderApiServiceAbstraction;\n  policyApiService: PolicyApiServiceAbstraction;\n  sendApiService: SendApiServiceAbstraction;\n  userVerificationApiService: UserVerificationApiServiceAbstraction;\n  syncNotifierService: SyncNotifierServiceAbstraction;\n  fido2UserInterfaceService: Fido2UserInterfaceServiceAbstraction;\n  fido2AuthenticatorService: Fido2AuthenticatorServiceAbstraction;\n  fido2ClientService: Fido2ClientServiceAbstraction;\n  avatarService: AvatarServiceAbstraction;\n  mainContextMenuHandler: MainContextMenuHandler;\n  cipherContextMenuHandler: CipherContextMenuHandler;\n  configService: ConfigService;\n  configApiService: ConfigApiServiceAbstraction;\n  devicesApiService: DevicesApiServiceAbstraction;\n  devicesService: DevicesServiceAbstraction;\n  deviceTrustService: DeviceTrustServiceAbstraction;\n  authRequestService: AuthRequestServiceAbstraction;\n  accountService: AccountServiceAbstraction;\n  globalStateProvider: GlobalStateProvider;\n  pinService: PinServiceAbstraction;\n  singleUserStateProvider: SingleUserStateProvider;\n  activeUserStateProvider: ActiveUserStateProvider;\n  derivedStateProvider: DerivedStateProvider;\n  stateProvider: StateProvider;\n  fido2Background: Fido2BackgroundAbstraction;\n  individualVaultExportService: IndividualVaultExportServiceAbstraction;\n  organizationVaultExportService: OrganizationVaultExportServiceAbstraction;\n  vaultSettingsService: VaultSettingsServiceAbstraction;\n  biometricStateService: BiometricStateService;\n  stateEventRunnerService: StateEventRunnerService;\n  ssoLoginService: SsoLoginServiceAbstraction;\n  billingAccountProfileStateService: BillingAccountProfileStateService;\n  // eslint-disable-next-line rxjs/no-exposed-subjects -- Needed to give access to services module\n  intraprocessMessagingSubject: Subject<Message<Record<string, unknown>>>;\n  userAutoUnlockKeyService: UserAutoUnlockKeyService;\n  scriptInjectorService: BrowserScriptInjectorService;\n  kdfConfigService: kdfConfigServiceAbstraction;\n  offscreenDocumentService: OffscreenDocumentService;\n  syncServiceListener: SyncServiceListener;\n\n  onUpdatedRan: boolean;\n  onReplacedRan: boolean;\n  loginToAutoFill: CipherView = null;\n\n  private commandsBackground: CommandsBackground;\n  private contextMenusBackground: ContextMenusBackground;\n  private idleBackground: IdleBackground;\n  private notificationBackground: NotificationBackground;\n  private overlayBackground: OverlayBackground;\n  private filelessImporterBackground: FilelessImporterBackground;\n  private runtimeBackground: RuntimeBackground;\n  private tabsBackground: TabsBackground;\n  private webRequestBackground: WebRequestBackground;\n\n  private syncTimeout: any;\n  private isSafari: boolean;\n  private nativeMessagingBackground: NativeMessagingBackground;\n\n  constructor(public popupOnlyContext: boolean = false) {\n    // Services\n    const lockedCallback = async (userId?: string) => {\n      if (this.notificationsService != null) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.updateConnection(false);\n      }\n      await this.refreshBadge();\n      await this.refreshMenu(true);\n      if (this.systemService != null) {\n        await this.systemService.clearPendingClipboard();\n        await this.systemService.startProcessReload(this.authService);\n      }\n    };\n\n    const logoutCallback = async (logoutReason: LogoutReason, userId?: UserId) =>\n      await this.logout(logoutReason, userId);\n\n    const refreshAccessTokenErrorCallback = () => {\n      // Send toast to popup\n      this.messagingService.send(\"showToast\", {\n        type: \"error\",\n        title: this.i18nService.t(\"errorRefreshingAccessToken\"),\n        message: this.i18nService.t(\"errorRefreshingAccessTokenDesc\"),\n      });\n    };\n\n    const isDev = process.env.ENV === \"development\";\n    this.logService = new ConsoleLogService(isDev);\n    this.cryptoFunctionService = new WebCryptoFunctionService(self);\n    this.keyGenerationService = new KeyGenerationService(this.cryptoFunctionService);\n    this.storageService = new BrowserLocalStorageService();\n\n    this.intraprocessMessagingSubject = new Subject<Message<Record<string, unknown>>>();\n\n    this.messagingService = MessageSender.combine(\n      new SubjectMessageSender(this.intraprocessMessagingSubject),\n      new ChromeMessageSender(this.logService),\n    );\n\n    const messageListener = new MessageListener(\n      merge(\n        this.intraprocessMessagingSubject.asObservable(), // For messages from the same context\n        fromChromeRuntimeMessaging(), // For messages from other contexts\n      ),\n    );\n\n    this.offscreenDocumentService = new DefaultOffscreenDocumentService(this.logService);\n\n    this.platformUtilsService = new BackgroundPlatformUtilsService(\n      this.messagingService,\n      (clipboardValue, clearMs) => this.clearClipboard(clipboardValue, clearMs),\n      async () => this.biometricUnlock(),\n      self,\n      this.offscreenDocumentService,\n    );\n\n    // Creates a session key for mv3 storage of large memory items\n    const sessionKey = new Lazy(async () => {\n      // Key already in session storage\n      const sessionStorage = new BrowserMemoryStorageService();\n      const existingKey = await sessionStorage.get<SymmetricCryptoKey>(\"session-key\");\n      if (existingKey) {\n        if (sessionStorage.valuesRequireDeserialization) {\n          return SymmetricCryptoKey.fromJSON(existingKey);\n        }\n        return existingKey;\n      }\n\n      // New key\n      const { derivedKey } = await this.keyGenerationService.createKeyWithPurpose(\n        128,\n        \"ephemeral\",\n        \"bitwarden-ephemeral\",\n      );\n      await sessionStorage.save(\"session-key\", derivedKey);\n      return derivedKey;\n    });\n\n    const mv3MemoryStorageCreator = () => {\n      if (this.popupOnlyContext) {\n        return new ForegroundMemoryStorageService();\n      }\n\n      return new LocalBackedSessionStorageService(\n        sessionKey,\n        this.storageService,\n        new EncryptServiceImplementation(this.cryptoFunctionService, this.logService, false),\n        this.platformUtilsService,\n        this.logService,\n      );\n    };\n\n    this.secureStorageService = this.storageService; // secure storage is not supported in browsers, so we use local storage and warn users when it is used\n    this.memoryStorageForStateProviders = BrowserApi.isManifestVersion(3)\n      ? new BrowserMemoryStorageService() // mv3 stores to storage.session\n      : popupOnlyContext\n        ? new ForegroundMemoryStorageService()\n        : new BackgroundMemoryStorageService(); // mv2 stores to memory\n    this.memoryStorageService = BrowserApi.isManifestVersion(3)\n      ? this.memoryStorageForStateProviders // manifest v3 can reuse the same storage. They are split for v2 due to lacking a good sync mechanism, which isn't true for v3\n      : popupOnlyContext\n        ? new ForegroundMemoryStorageService()\n        : new BackgroundMemoryStorageService();\n    this.largeObjectMemoryStorageForStateProviders = BrowserApi.isManifestVersion(3)\n      ? mv3MemoryStorageCreator() // mv3 stores to local-backed session storage\n      : this.memoryStorageForStateProviders; // mv2 stores to the same location\n\n    const storageServiceProvider = new BrowserStorageServiceProvider(\n      this.storageService,\n      this.memoryStorageForStateProviders,\n      this.largeObjectMemoryStorageForStateProviders,\n    );\n\n    this.globalStateProvider = new DefaultGlobalStateProvider(storageServiceProvider);\n\n    const stateEventRegistrarService = new StateEventRegistrarService(\n      this.globalStateProvider,\n      storageServiceProvider,\n    );\n\n    this.stateEventRunnerService = new StateEventRunnerService(\n      this.globalStateProvider,\n      storageServiceProvider,\n    );\n\n    this.encryptService =\n      flagEnabled(\"multithreadDecryption\") && BrowserApi.isManifestVersion(2)\n        ? new MultithreadEncryptServiceImplementation(\n            this.cryptoFunctionService,\n            this.logService,\n            true,\n          )\n        : new EncryptServiceImplementation(this.cryptoFunctionService, this.logService, true);\n\n    this.singleUserStateProvider = new DefaultSingleUserStateProvider(\n      storageServiceProvider,\n      stateEventRegistrarService,\n    );\n    this.accountService = new AccountServiceImplementation(\n      this.messagingService,\n      this.logService,\n      this.globalStateProvider,\n    );\n    this.activeUserStateProvider = new DefaultActiveUserStateProvider(\n      this.accountService,\n      this.singleUserStateProvider,\n    );\n    this.derivedStateProvider = new InlineDerivedStateProvider();\n    this.stateProvider = new DefaultStateProvider(\n      this.activeUserStateProvider,\n      this.singleUserStateProvider,\n      this.globalStateProvider,\n      this.derivedStateProvider,\n    );\n    this.environmentService = new BrowserEnvironmentService(\n      this.logService,\n      this.stateProvider,\n      this.accountService,\n    );\n    this.biometricStateService = new DefaultBiometricStateService(this.stateProvider);\n\n    this.userNotificationSettingsService = new UserNotificationSettingsService(this.stateProvider);\n\n    this.tokenService = new TokenService(\n      this.singleUserStateProvider,\n      this.globalStateProvider,\n      this.platformUtilsService.supportsSecureStorage(),\n      this.secureStorageService,\n      this.keyGenerationService,\n      this.encryptService,\n      this.logService,\n      logoutCallback,\n    );\n\n    const migrationRunner = new MigrationRunner(\n      this.storageService,\n      this.logService,\n      new MigrationBuilderService(),\n      ClientType.Browser,\n    );\n\n    this.stateService = new DefaultBrowserStateService(\n      this.storageService,\n      this.secureStorageService,\n      this.memoryStorageService,\n      this.logService,\n      new StateFactory(GlobalState, Account),\n      this.accountService,\n      this.environmentService,\n      this.tokenService,\n      migrationRunner,\n    );\n\n    const themeStateService = new DefaultThemeStateService(this.globalStateProvider);\n\n    this.masterPasswordService = new MasterPasswordService(\n      this.stateProvider,\n      this.stateService,\n      this.keyGenerationService,\n      this.encryptService,\n    );\n\n    this.i18nService = new I18nService(BrowserApi.getUILanguage(), this.globalStateProvider);\n\n    this.kdfConfigService = new KdfConfigService(this.stateProvider);\n\n    this.pinService = new PinService(\n      this.accountService,\n      this.cryptoFunctionService,\n      this.encryptService,\n      this.kdfConfigService,\n      this.keyGenerationService,\n      this.logService,\n      this.masterPasswordService,\n      this.stateProvider,\n      this.stateService,\n    );\n\n    this.cryptoService = new BrowserCryptoService(\n      this.pinService,\n      this.masterPasswordService,\n      this.keyGenerationService,\n      this.cryptoFunctionService,\n      this.encryptService,\n      this.platformUtilsService,\n      this.logService,\n      this.stateService,\n      this.accountService,\n      this.stateProvider,\n      this.biometricStateService,\n      this.kdfConfigService,\n    );\n\n    this.appIdService = new AppIdService(this.globalStateProvider);\n\n    this.userDecryptionOptionsService = new UserDecryptionOptionsService(this.stateProvider);\n    this.organizationService = new OrganizationService(this.stateProvider);\n    this.policyService = new PolicyService(this.stateProvider, this.organizationService);\n\n    this.vaultTimeoutSettingsService = new VaultTimeoutSettingsService(\n      this.accountService,\n      this.pinService,\n      this.userDecryptionOptionsService,\n      this.cryptoService,\n      this.tokenService,\n      this.policyService,\n      this.biometricStateService,\n      this.stateProvider,\n      this.logService,\n      VaultTimeoutStringType.OnRestart, // default vault timeout\n    );\n\n    this.apiService = new ApiService(\n      this.tokenService,\n      this.platformUtilsService,\n      this.environmentService,\n      this.appIdService,\n      refreshAccessTokenErrorCallback,\n      this.logService,\n      (logoutReason: LogoutReason, userId?: UserId) => this.logout(logoutReason, userId),\n      this.vaultTimeoutSettingsService,\n    );\n\n    this.domainSettingsService = new DefaultDomainSettingsService(this.stateProvider);\n    this.fileUploadService = new FileUploadService(this.logService);\n    this.cipherFileUploadService = new CipherFileUploadService(\n      this.apiService,\n      this.fileUploadService,\n    );\n    this.searchService = new SearchService(this.logService, this.i18nService, this.stateProvider);\n\n    this.collectionService = new CollectionService(\n      this.cryptoService,\n      this.i18nService,\n      this.stateProvider,\n    );\n    this.syncNotifierService = new SyncNotifierService();\n\n    this.autofillSettingsService = new AutofillSettingsService(\n      this.stateProvider,\n      this.policyService,\n    );\n    this.badgeSettingsService = new BadgeSettingsService(this.stateProvider);\n    this.policyApiService = new PolicyApiService(this.policyService, this.apiService);\n    this.keyConnectorService = new KeyConnectorService(\n      this.accountService,\n      this.masterPasswordService,\n      this.cryptoService,\n      this.apiService,\n      this.tokenService,\n      this.logService,\n      this.organizationService,\n      this.keyGenerationService,\n      logoutCallback,\n      this.stateProvider,\n    );\n\n    this.passwordStrengthService = new PasswordStrengthService();\n\n    this.passwordGenerationService = legacyPasswordGenerationServiceFactory(\n      this.encryptService,\n      this.cryptoService,\n      this.policyService,\n      this.accountService,\n      this.stateProvider,\n    );\n\n    this.userDecryptionOptionsService = new UserDecryptionOptionsService(this.stateProvider);\n\n    this.devicesApiService = new DevicesApiServiceImplementation(this.apiService);\n    this.deviceTrustService = new DeviceTrustService(\n      this.keyGenerationService,\n      this.cryptoFunctionService,\n      this.cryptoService,\n      this.encryptService,\n      this.appIdService,\n      this.devicesApiService,\n      this.i18nService,\n      this.platformUtilsService,\n      this.stateProvider,\n      this.secureStorageService,\n      this.userDecryptionOptionsService,\n      this.logService,\n    );\n\n    this.devicesService = new DevicesServiceImplementation(this.devicesApiService);\n\n    this.authRequestService = new AuthRequestService(\n      this.appIdService,\n      this.accountService,\n      this.masterPasswordService,\n      this.cryptoService,\n      this.apiService,\n      this.stateProvider,\n    );\n\n    this.authService = new AuthService(\n      this.accountService,\n      this.messagingService,\n      this.cryptoService,\n      this.apiService,\n      this.stateService,\n      this.tokenService,\n    );\n\n    this.billingAccountProfileStateService = new DefaultBillingAccountProfileStateService(\n      this.stateProvider,\n    );\n\n    this.loginEmailService = new LoginEmailService(this.stateProvider);\n\n    this.ssoLoginService = new SsoLoginService(this.stateProvider);\n\n    this.userVerificationApiService = new UserVerificationApiService(this.apiService);\n\n    this.configApiService = new ConfigApiService(this.apiService, this.tokenService);\n\n    this.configService = new DefaultConfigService(\n      this.configApiService,\n      this.environmentService,\n      this.logService,\n      this.stateProvider,\n    );\n\n    this.cipherService = new CipherService(\n      this.cryptoService,\n      this.domainSettingsService,\n      this.apiService,\n      this.i18nService,\n      this.searchService,\n      this.stateService,\n      this.autofillSettingsService,\n      this.encryptService,\n      this.cipherFileUploadService,\n      this.configService,\n      this.stateProvider,\n    );\n    this.folderService = new FolderService(\n      this.cryptoService,\n      this.i18nService,\n      this.cipherService,\n      this.stateProvider,\n    );\n    this.folderApiService = new FolderApiService(this.folderService, this.apiService);\n\n    this.userVerificationService = new UserVerificationService(\n      this.stateService,\n      this.cryptoService,\n      this.accountService,\n      this.masterPasswordService,\n      this.i18nService,\n      this.userVerificationApiService,\n      this.userDecryptionOptionsService,\n      this.pinService,\n      this.logService,\n      this.vaultTimeoutSettingsService,\n      this.platformUtilsService,\n      this.kdfConfigService,\n    );\n\n    this.vaultFilterService = new VaultFilterService(\n      this.organizationService,\n      this.folderService,\n      this.cipherService,\n      this.collectionService,\n      this.policyService,\n      this.stateProvider,\n      this.accountService,\n    );\n\n    this.vaultSettingsService = new VaultSettingsService(this.stateProvider);\n\n    this.vaultTimeoutService = new VaultTimeoutService(\n      this.accountService,\n      this.masterPasswordService,\n      this.cipherService,\n      this.folderService,\n      this.collectionService,\n      this.platformUtilsService,\n      this.messagingService,\n      this.searchService,\n      this.stateService,\n      this.authService,\n      this.vaultTimeoutSettingsService,\n      this.stateEventRunnerService,\n      lockedCallback,\n      logoutCallback,\n    );\n    this.containerService = new ContainerService(this.cryptoService, this.encryptService);\n\n    this.sendStateProvider = new SendStateProvider(this.stateProvider);\n    this.sendService = new SendService(\n      this.cryptoService,\n      this.i18nService,\n      this.keyGenerationService,\n      this.sendStateProvider,\n      this.encryptService,\n    );\n    this.sendApiService = new SendApiService(\n      this.apiService,\n      this.fileUploadService,\n      this.sendService,\n    );\n\n    this.avatarService = new AvatarService(this.apiService, this.stateProvider);\n\n    this.providerService = new ProviderService(this.stateProvider);\n\n    if (this.popupOnlyContext) {\n      this.syncService = new ForegroundSyncService(\n        this.stateService,\n        this.folderService,\n        this.folderApiService,\n        this.messagingService,\n        this.logService,\n        this.cipherService,\n        this.collectionService,\n        this.apiService,\n        this.accountService,\n        this.authService,\n        this.sendService,\n        this.sendApiService,\n        messageListener,\n      );\n    } else {\n      this.syncService = new SyncService(\n        this.masterPasswordService,\n        this.accountService,\n        this.apiService,\n        this.domainSettingsService,\n        this.folderService,\n        this.cipherService,\n        this.cryptoService,\n        this.collectionService,\n        this.messagingService,\n        this.policyService,\n        this.sendService,\n        this.logService,\n        this.keyConnectorService,\n        this.stateService,\n        this.providerService,\n        this.folderApiService,\n        this.organizationService,\n        this.sendApiService,\n        this.userDecryptionOptionsService,\n        this.avatarService,\n        logoutCallback,\n        this.billingAccountProfileStateService,\n        this.tokenService,\n        this.authService,\n      );\n\n      this.syncServiceListener = new SyncServiceListener(\n        this.syncService,\n        messageListener,\n        this.messagingService,\n        this.logService,\n      );\n    }\n    this.eventUploadService = new EventUploadService(\n      this.apiService,\n      this.stateProvider,\n      this.logService,\n      this.authService,\n    );\n    this.eventCollectionService = new EventCollectionService(\n      this.cipherService,\n      this.stateProvider,\n      this.organizationService,\n      this.eventUploadService,\n      this.authService,\n    );\n    this.totpService = new TotpService(this.cryptoFunctionService, this.logService);\n\n    this.scriptInjectorService = new BrowserScriptInjectorService(\n      this.platformUtilsService,\n      this.logService,\n    );\n    this.autofillService = new AutofillService(\n      this.cipherService,\n      this.autofillSettingsService,\n      this.totpService,\n      this.eventCollectionService,\n      this.logService,\n      this.domainSettingsService,\n      this.userVerificationService,\n      this.billingAccountProfileStateService,\n      this.scriptInjectorService,\n      this.accountService,\n      this.authService,\n    );\n    this.auditService = new AuditService(this.cryptoFunctionService, this.apiService);\n\n    this.importApiService = new ImportApiService(this.apiService);\n\n    this.importService = new ImportService(\n      this.cipherService,\n      this.folderService,\n      this.importApiService,\n      this.i18nService,\n      this.collectionService,\n      this.cryptoService,\n      this.pinService,\n    );\n\n    this.individualVaultExportService = new IndividualVaultExportService(\n      this.folderService,\n      this.cipherService,\n      this.pinService,\n      this.cryptoService,\n      this.cryptoFunctionService,\n      this.kdfConfigService,\n    );\n\n    this.organizationVaultExportService = new OrganizationVaultExportService(\n      this.cipherService,\n      this.apiService,\n      this.pinService,\n      this.cryptoService,\n      this.cryptoFunctionService,\n      this.collectionService,\n      this.kdfConfigService,\n    );\n\n    this.exportService = new VaultExportService(\n      this.individualVaultExportService,\n      this.organizationVaultExportService,\n    );\n\n    this.notificationsService = new NotificationsService(\n      this.logService,\n      this.syncService,\n      this.appIdService,\n      this.apiService,\n      this.environmentService,\n      logoutCallback,\n      this.stateService,\n      this.authService,\n      this.authRequestService,\n      this.messagingService,\n    );\n\n    this.fido2UserInterfaceService = new BrowserFido2UserInterfaceService(this.authService);\n    this.fido2AuthenticatorService = new Fido2AuthenticatorService(\n      this.cipherService,\n      this.fido2UserInterfaceService,\n      this.syncService,\n      this.logService,\n    );\n    this.fido2ClientService = new Fido2ClientService(\n      this.fido2AuthenticatorService,\n      this.configService,\n      this.authService,\n      this.vaultSettingsService,\n      this.domainSettingsService,\n      this.logService,\n    );\n\n    const systemUtilsServiceReloadCallback = () => {\n      const forceWindowReload =\n        this.platformUtilsService.isSafari() ||\n        this.platformUtilsService.isFirefox() ||\n        this.platformUtilsService.isOpera();\n      BrowserApi.reloadExtension(forceWindowReload ? self : null);\n      return Promise.resolve();\n    };\n\n    this.systemService = new SystemService(\n      this.pinService,\n      this.messagingService,\n      this.platformUtilsService,\n      systemUtilsServiceReloadCallback,\n      this.stateService,\n      this.autofillSettingsService,\n      this.vaultTimeoutSettingsService,\n      this.biometricStateService,\n      this.accountService,\n    );\n\n    // Other fields\n    this.isSafari = this.platformUtilsService.isSafari();\n\n    // Background\n    if (!this.popupOnlyContext) {\n      this.fido2Background = new Fido2Background(\n        this.logService,\n        this.fido2ClientService,\n        this.vaultSettingsService,\n        this.scriptInjectorService,\n      );\n      this.runtimeBackground = new RuntimeBackground(\n        this,\n        this.autofillService,\n        this.platformUtilsService as BrowserPlatformUtilsService,\n        this.notificationsService,\n        this.autofillSettingsService,\n        this.systemService,\n        this.environmentService,\n        this.messagingService,\n        this.logService,\n        this.configService,\n        this.fido2Background,\n        messageListener,\n        this.accountService,\n      );\n      this.nativeMessagingBackground = new NativeMessagingBackground(\n        this.accountService,\n        this.masterPasswordService,\n        this.cryptoService,\n        this.cryptoFunctionService,\n        this.runtimeBackground,\n        this.messagingService,\n        this.appIdService,\n        this.platformUtilsService,\n        this.stateService,\n        this.logService,\n        this.authService,\n        this.biometricStateService,\n      );\n      this.commandsBackground = new CommandsBackground(\n        this,\n        this.passwordGenerationService,\n        this.platformUtilsService,\n        this.vaultTimeoutService,\n        this.authService,\n      );\n      this.notificationBackground = new NotificationBackground(\n        this.autofillService,\n        this.cipherService,\n        this.authService,\n        this.policyService,\n        this.folderService,\n        this.stateService,\n        this.userNotificationSettingsService,\n        this.domainSettingsService,\n        this.environmentService,\n        this.logService,\n        themeStateService,\n        this.configService,\n      );\n      this.overlayBackground = new OverlayBackground(\n        this.cipherService,\n        this.autofillService,\n        this.authService,\n        this.environmentService,\n        this.domainSettingsService,\n        this.stateService,\n        this.autofillSettingsService,\n        this.i18nService,\n        this.platformUtilsService,\n        themeStateService,\n      );\n      this.filelessImporterBackground = new FilelessImporterBackground(\n        this.configService,\n        this.authService,\n        this.policyService,\n        this.notificationBackground,\n        this.importService,\n        this.syncService,\n        this.scriptInjectorService,\n      );\n      this.tabsBackground = new TabsBackground(\n        this,\n        this.notificationBackground,\n        this.overlayBackground,\n      );\n\n      const contextMenuClickedHandler = new ContextMenuClickedHandler(\n        (options) => this.platformUtilsService.copyToClipboard(options.text),\n        async (_tab) => {\n          const options = (await this.passwordGenerationService.getOptions())?.[0] ?? {};\n          const password = await this.passwordGenerationService.generatePassword(options);\n          this.platformUtilsService.copyToClipboard(password);\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.passwordGenerationService.addHistory(password);\n        },\n        async (tab, cipher) => {\n          this.loginToAutoFill = cipher;\n          if (tab == null) {\n            return;\n          }\n\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          BrowserApi.tabSendMessage(tab, {\n            command: \"collectPageDetails\",\n            tab: tab,\n            sender: \"contextMenu\",\n          });\n        },\n        this.authService,\n        this.cipherService,\n        this.totpService,\n        this.eventCollectionService,\n        this.userVerificationService,\n        this.accountService,\n      );\n\n      this.contextMenusBackground = new ContextMenusBackground(contextMenuClickedHandler);\n    }\n\n    this.idleBackground = new IdleBackground(\n      this.vaultTimeoutService,\n      this.stateService,\n      this.notificationsService,\n      this.accountService,\n      this.vaultTimeoutSettingsService,\n    );\n\n    this.usernameGenerationService = legacyUsernameGenerationServiceFactory(\n      this.apiService,\n      this.i18nService,\n      this.cryptoService,\n      this.encryptService,\n      this.policyService,\n      this.accountService,\n      this.stateProvider,\n    );\n\n    if (!this.popupOnlyContext) {\n      this.mainContextMenuHandler = new MainContextMenuHandler(\n        this.stateService,\n        this.autofillSettingsService,\n        this.i18nService,\n        this.logService,\n        this.billingAccountProfileStateService,\n      );\n\n      this.cipherContextMenuHandler = new CipherContextMenuHandler(\n        this.mainContextMenuHandler,\n        this.authService,\n        this.cipherService,\n      );\n\n      if (chrome.webRequest != null && chrome.webRequest.onAuthRequired != null) {\n        this.webRequestBackground = new WebRequestBackground(\n          this.platformUtilsService,\n          this.cipherService,\n          this.authService,\n          chrome.webRequest,\n        );\n      }\n    }\n\n    this.userAutoUnlockKeyService = new UserAutoUnlockKeyService(this.cryptoService);\n  }\n\n  async bootstrap() {\n    this.containerService.attachToGlobal(self);\n\n    // Only the \"true\" background should run migrations\n    await this.stateService.init({ runMigrations: !this.popupOnlyContext });\n\n    // This is here instead of in in the InitService b/c we don't plan for\n    // side effects to run in the Browser InitService.\n    const accounts = await firstValueFrom(this.accountService.accounts$);\n\n    const setUserKeyInMemoryPromises = [];\n    for (const userId of Object.keys(accounts) as UserId[]) {\n      // For each acct, we must await the process of setting the user key in memory\n      // if the auto user key is set to avoid race conditions of any code trying to access\n      // the user key from mem.\n      setUserKeyInMemoryPromises.push(\n        this.userAutoUnlockKeyService.setUserKeyInMemoryIfAutoUserKeySet(userId),\n      );\n    }\n    await Promise.all(setUserKeyInMemoryPromises);\n\n    await (this.i18nService as I18nService).init();\n    (this.eventUploadService as EventUploadService).init(true);\n\n    if (this.popupOnlyContext) {\n      return;\n    }\n\n    await this.vaultTimeoutService.init(true);\n    this.fido2Background.init();\n    await this.runtimeBackground.init();\n    await this.notificationBackground.init();\n    this.filelessImporterBackground.init();\n    await this.commandsBackground.init();\n    await this.overlayBackground.init();\n    await this.tabsBackground.init();\n    this.contextMenusBackground?.init();\n    await this.idleBackground.init();\n    this.webRequestBackground?.startListening();\n    this.syncServiceListener?.listener$().subscribe();\n\n    return new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        await this.refreshBadge();\n        await this.fullSync(true);\n        setTimeout(() => this.notificationsService.init(), 2500);\n        resolve();\n      }, 500);\n    });\n  }\n\n  async refreshBadge() {\n    await new UpdateBadge(self, this).run();\n  }\n\n  async refreshMenu(forLocked = false) {\n    if (!chrome.windows || !chrome.contextMenus) {\n      return;\n    }\n\n    await MainContextMenuHandler.removeAll();\n\n    if (forLocked) {\n      await this.mainContextMenuHandler?.noAccess();\n      this.onUpdatedRan = this.onReplacedRan = false;\n      return;\n    }\n\n    await this.mainContextMenuHandler?.init();\n\n    const tab = await BrowserApi.getTabFromCurrentWindow();\n    if (tab) {\n      await this.cipherContextMenuHandler?.update(tab.url);\n      this.onUpdatedRan = this.onReplacedRan = false;\n    }\n  }\n\n  /**\n   * Switch accounts to indicated userId -- null is no active user\n   */\n  async switchAccount(userId: UserId) {\n    let nextAccountStatus: AuthenticationStatus;\n    try {\n      const currentlyActiveAccount = await firstValueFrom(\n        this.accountService.activeAccount$.pipe(map((account) => account?.id)),\n      );\n      // can be removed once password generation history is migrated to state providers\n      await this.stateService.clearDecryptedData(currentlyActiveAccount);\n      // HACK to ensure account is switched before proceeding\n      const switchPromise = firstValueFrom(\n        this.accountService.activeAccount$.pipe(\n          filter((account) => (account?.id ?? null) === (userId ?? null)),\n          timeout({\n            first: 1_000,\n            with: () => {\n              throw new Error(\n                \"The account switch process did not complete in a reasonable amount of time.\",\n              );\n            },\n          }),\n        ),\n      );\n      await this.accountService.switchAccount(userId);\n      await switchPromise;\n      // Clear sequentialized caches\n      clearCaches();\n\n      if (userId == null) {\n        this.loginEmailService.setRememberEmail(false);\n        await this.loginEmailService.saveEmailSettings();\n\n        await this.refreshBadge();\n        await this.refreshMenu();\n        await this.overlayBackground?.updateOverlayCiphers(); // null in popup only contexts\n        this.messagingService.send(\"goHome\");\n        return;\n      }\n\n      nextAccountStatus = await this.authService.getAuthStatus(userId);\n      const forcePasswordReset =\n        (await firstValueFrom(this.masterPasswordService.forceSetPasswordReason$(userId))) !=\n        ForceSetPasswordReason.None;\n\n      await this.systemService.clearPendingClipboard();\n      await this.notificationsService.updateConnection(false);\n\n      if (nextAccountStatus === AuthenticationStatus.LoggedOut) {\n        this.messagingService.send(\"goHome\");\n      } else if (nextAccountStatus === AuthenticationStatus.Locked) {\n        this.messagingService.send(\"locked\", { userId: userId });\n      } else if (forcePasswordReset) {\n        this.messagingService.send(\"update-temp-password\", { userId: userId });\n      } else {\n        this.messagingService.send(\"unlocked\", { userId: userId });\n        await this.refreshBadge();\n        await this.refreshMenu();\n        await this.overlayBackground?.updateOverlayCiphers(); // null in popup only contexts\n        await this.syncService.fullSync(false);\n      }\n    } finally {\n      this.messagingService.send(\"switchAccountFinish\", {\n        userId: userId,\n        status: nextAccountStatus,\n      });\n    }\n  }\n\n  async logout(logoutReason: LogoutReason, userId?: UserId) {\n    const activeUserId = await firstValueFrom(\n      this.accountService.activeAccount$.pipe(\n        map((a) => a?.id),\n        timeout({\n          first: 2000,\n          with: () => {\n            throw new Error(\"No active account found to logout\");\n          },\n        }),\n      ),\n    );\n\n    const userBeingLoggedOut = userId ?? activeUserId;\n\n    await this.eventUploadService.uploadEvents(userBeingLoggedOut);\n\n    const newActiveUser =\n      userBeingLoggedOut === activeUserId\n        ? await firstValueFrom(this.accountService.nextUpAccount$.pipe(map((a) => a?.id)))\n        : null;\n\n    await this.switchAccount(newActiveUser);\n\n    // HACK: We shouldn't wait for the authentication status to change but instead subscribe to the\n    // authentication status to do various actions.\n    const logoutPromise = firstValueFrom(\n      this.authService.authStatusFor$(userBeingLoggedOut).pipe(\n        filter((authenticationStatus) => authenticationStatus === AuthenticationStatus.LoggedOut),\n        timeout({\n          first: 5_000,\n          with: () => {\n            throw new Error(\"The logout process did not complete in a reasonable amount of time.\");\n          },\n        }),\n      ),\n    );\n\n    await Promise.all([\n      this.syncService.setLastSync(new Date(0), userBeingLoggedOut),\n      this.cryptoService.clearKeys(userBeingLoggedOut),\n      this.cipherService.clear(userBeingLoggedOut),\n      this.folderService.clear(userBeingLoggedOut),\n      this.collectionService.clear(userBeingLoggedOut),\n      this.vaultTimeoutSettingsService.clear(userBeingLoggedOut),\n      this.vaultFilterService.clear(),\n      this.biometricStateService.logout(userBeingLoggedOut),\n      /* We intentionally do not clear:\n       *  - autofillSettingsService\n       *  - badgeSettingsService\n       *  - userNotificationSettingsService\n       */\n    ]);\n\n    //Needs to be checked before state is cleaned\n    const needStorageReseed = await this.needsStorageReseed(userBeingLoggedOut);\n\n    await this.stateService.clean({ userId: userBeingLoggedOut });\n    await this.accountService.clean(userBeingLoggedOut);\n\n    await this.stateEventRunnerService.handleEvent(\"logout\", userBeingLoggedOut);\n\n    // HACK: Wait for the user logging outs authentication status to transition to LoggedOut\n    await logoutPromise;\n\n    this.messagingService.send(\"doneLoggingOut\", {\n      logoutReason: logoutReason,\n      userId: userBeingLoggedOut,\n    });\n\n    if (needStorageReseed) {\n      await this.reseedStorage();\n    }\n\n    if (BrowserApi.isManifestVersion(3)) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.sendMessage(\"updateBadge\");\n    }\n    await this.refreshBadge();\n    await this.mainContextMenuHandler?.noAccess();\n    await this.notificationsService.updateConnection(false);\n    await this.systemService.clearPendingClipboard();\n    await this.systemService.startProcessReload(this.authService);\n  }\n\n  private async needsStorageReseed(userId: UserId): Promise<boolean> {\n    const currentVaultTimeout = await firstValueFrom(\n      this.vaultTimeoutSettingsService.getVaultTimeoutByUserId$(userId),\n    );\n    return currentVaultTimeout == VaultTimeoutStringType.Never ? false : true;\n  }\n\n  async collectPageDetailsForContentScript(tab: any, sender: string, frameId: number = null) {\n    if (tab == null || !tab.id) {\n      return;\n    }\n\n    const options: any = {};\n    if (frameId != null) {\n      options.frameId = frameId;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessage(\n      tab,\n      {\n        command: \"collectPageDetails\",\n        tab: tab,\n        sender: sender,\n      },\n      options,\n    );\n  }\n\n  async openPopup() {\n    // Chrome APIs cannot open popup\n\n    // TODO: Do we need to open this popup?\n    if (!this.isSafari) {\n      return;\n    }\n    await SafariApp.sendMessageToApp(\"showPopover\", null, true);\n  }\n\n  async reseedStorage() {\n    if (\n      !this.platformUtilsService.isChrome() &&\n      !this.platformUtilsService.isVivaldi() &&\n      !this.platformUtilsService.isOpera()\n    ) {\n      return;\n    }\n\n    const storage = await this.storageService.getAll();\n    await this.storageService.clear();\n\n    for (const key in storage) {\n      // eslint-disable-next-line\n      if (!storage.hasOwnProperty(key)) {\n        continue;\n      }\n      await this.storageService.save(key, storage[key]);\n    }\n  }\n\n  async clearClipboard(clipboardValue: string, clearMs: number) {\n    if (this.systemService != null) {\n      await this.systemService.clearClipboard(clipboardValue, clearMs);\n    }\n  }\n\n  async biometricUnlock(): Promise<boolean> {\n    if (this.nativeMessagingBackground == null) {\n      return false;\n    }\n\n    const responsePromise = this.nativeMessagingBackground.getResponse();\n    await this.nativeMessagingBackground.send({ command: \"biometricUnlock\" });\n    const response = await responsePromise;\n    return response.response === \"unlocked\";\n  }\n\n  private async fullSync(override = false) {\n    const syncInternal = 6 * 60 * 60 * 1000; // 6 hours\n    const lastSync = await this.syncService.getLastSync();\n\n    let lastSyncAgo = syncInternal + 1;\n    if (lastSync != null) {\n      lastSyncAgo = new Date().getTime() - lastSync.getTime();\n    }\n\n    if (override || lastSyncAgo >= syncInternal) {\n      await this.syncService.fullSync(override);\n      this.scheduleNextSync();\n    } else {\n      this.scheduleNextSync();\n    }\n  }\n\n  private scheduleNextSync() {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n\n    this.syncTimeout = setTimeout(async () => await this.fullSync(), 5 * 60 * 1000); // check every 5 minutes\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// expose the module cache\n__webpack_require__.c = __webpack_module_cache__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + \"encrypt-worker\" + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t352: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_bitwarden_browser\"] = self[\"webpackChunk_bitwarden_browser\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// module cache are used so entry inlining is disabled\n// startup\n// Load entry module and return exports\nvar __webpack_exports__ = __webpack_require__.O(undefined, [736], function() { return __webpack_require__(57011); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","leafPrototypes","getProto","LogLevelType","ConsoleLogService","constructor","isDev","filter","timersMap","Map","debug","message","optionalParams","this","write","Debug","info","Info","warning","Warning","error","Error","level","console","log","warn","AuthenticationType","provider","token","remember","nodeURL","self","init","inited","isNode","process","release","name","isBrowser","window","isMobileBrowser","isMobile","isAppleMobileBrowser","isAppleMobile","global","g","fromB64ToArray","str","Uint8Array","Buffer","from","binaryString","atob","bytes","length","i","charCodeAt","fromUrlB64ToArray","fromUrlB64ToB64","fromHexToArray","parseInt","substr","fromUtf8ToArray","strUtf8","unescape","encodeURIComponent","arr","fromByteStringToArray","fromBufferToB64","buffer","toString","binary","byteLength","String","fromCharCode","btoa","fromBufferToUrlB64","fromB64toUrlB64","b64Str","replace","fromBufferToUtf8","fromBufferToByteString","apply","fromBufferToHex","Array","prototype","map","call","x","slice","join","hexStringToArrayBuffer","hexString","arrayBuffer","ArrayBuffer","uint8Array","hexByte","byteValue","urlB64Str","output","fromUrlB64ToUtf8","fromB64ToUtf8","fromUtf8ToB64","utfStr","decodeURIComponent","escape","fromUtf8ToUrlB64","newGuid","c","r","Math","random","isGuid","id","RegExp","guidRegex","test","getHostname","uriString","isNullOrWhitespace","trim","startsWith","indexOf","hostname","validHosts","getHost","url","getUrl","host","getDomain","parseResult","allowPrivateDomains","isIp","domain","getQueryParams","search","split","forEach","pair","parts","set","toLowerCase","getSortFunction","i18nService","prop","a","b","collator","compare","localeCompare","isNullOrEmpty","isPromise","obj","undefined","nameOf","assign","target","source","Object","iterateEnum","keys","k","Number","isNaN","getUrlObject","camelToPascalCase","s","charAt","toUpperCase","pickTextColorBasedOnBgColor","bgColor","threshold","svgTextFill","bgColorHexNums","substring","stringToColor","hash","color","getContainerService","bitwardenContainerService","validateHexColor","mapToRecord","fromEntries","recordToMap","record","entries","e","merge","destination","encodeRFC3986URIComponent","normalizePath","denormalizedPath","win","mobile","navigator","userAgent","vendor","opera","match","delay","ms","Promise","resolve","setTimeout","asyncToObservable","generator","of","pipe","switchMap","daysRemaining","targetDate","diffTime","getTime","Date","now","max","floor","hasProtocol","URL","regexpEmojiPresentation","originalMinimumPasswordLength","minimumPasswordLength","DomainMatchBlacklist","Set","WebAuthnLoginResponseRequest","credential","rawId","type","extensions","WebAuthnLoginAssertionResponseRequest","super","response","AuthenticatorAssertionResponse","authenticatorData","signature","clientDataJSON","userHandle","fromJSON","json","create","EncryptionType","EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE","AesCbc256_B64","AesCbc128_HmacSha256_B64","AesCbc256_HmacSha256_B64","Rsa2048_OaepSha256_B64","Rsa2048_OaepSha1_B64","Rsa2048_OaepSha256_HmacSha256_B64","Rsa2048_OaepSha1_HmacSha256_B64","FileUploadType","HtmlStorageLocation","HashPurpose","iterations","kdfType","PBKDF2_SHA256","PBKDF2_ITERATIONS","defaultValue","validateKdfConfig","inRange","min","memory","parallelism","Argon2id","ARGON2_ITERATIONS","ARGON2_MEMORY","ARGON2_PARALLELISM","RangeWithDefault","value","KdfType","KeySuffixOptions","StorageLocation","ThemeType","key","encType","encKey","macKey","keyB64","encKeyB64","macKeyB64","toJSON","fromString","AuthRequestLoginCredentials","email","accessCode","authRequestId","decryptedUserKey","decryptedMasterKey","decryptedMasterKeyHash","twoFactor","AuthRequest","WebAuthnLoginCredentials","deviceResponse","prfKey","WebAuthn","fromResponse","options","keyConnectorUrl","hasAdminApproval","hasLoginApprovingDevice","hasManageResetPasswordPermission","decryptionOptions","userDecryptionOptions","responseOptions","hasMasterPassword","trustedDeviceOption","keyConnectorOption","usingKeyConnector","EncString","encryptedStringOrType","data","iv","mac","initFromData","initFromEncryptedString","ivBytes","macBytes","dataBytes","encryptedString","encryptionType","encPieces","parseEncryptedString","headerPieces","NaN","isSerializedEncString","decrypt","orgId","decryptedValue","getKeyForDecryption","encryptService","getEncryptService","decryptToUtf8","cryptoService","getCryptoService","getOrgKey","getUserKeyWithLegacySupport","DeriveDefinition","stateDefinition","uniqueDerivationName","definition","isFromDeriveDefinition","fromWithUserId","derive","deserialize","serialized","deserializer","cleanupDelayMs","clearOnCleanup","buildCacheKey","storageKey","isArray","StateProvider","array","elementDeserializer","element","valueDeserializer","jsonValue","KeyDefinition","errorKeyName","v","fullName","USER_KEY_DEFINITION_MARKER","Symbol","isUserKeyDefinition","keyDefinition","UserKeyDefinition","clearOn","fromBaseKeyDefinition","buildKey","userId","StateDefinition","defaultStorageLocation","storageLocationOverrides","ORGANIZATIONS_DISK","POLICIES_DISK","PROVIDERS_DISK","BILLING_DISK","web","ACCOUNT_DISK","AUTH_REQUEST_DISK_LOCAL","AVATAR_DISK","DEVICE_TRUST_DISK_LOCAL","KDF_CONFIG_DISK","KEY_CONNECTOR_DISK","LOGIN_EMAIL_DISK","LOGIN_STRATEGY_MEMORY","MASTER_PASSWORD_DISK","MASTER_PASSWORD_MEMORY","PIN_DISK","PIN_MEMORY","SSO_DISK","TOKEN_DISK","TOKEN_DISK_LOCAL","TOKEN_MEMORY","USER_DECRYPTION_OPTIONS_DISK","VAULT_TIMEOUT_SETTINGS_DISK_LOCAL","BADGE_SETTINGS_DISK","USER_NOTIFICATION_SETTINGS_DISK","DOMAIN_SETTINGS_DISK","AUTOFILL_SETTINGS_DISK","AUTOFILL_SETTINGS_DISK_LOCAL","APPLICATION_ID_DISK","BIOMETRIC_SETTINGS_DISK","CLEAR_EVENT_DISK","CONFIG_DISK","CRYPTO_DISK","CRYPTO_MEMORY","ENVIRONMENT_DISK","ENVIRONMENT_MEMORY","THEMING_DISK","TRANSLATION_DISK","GENERATOR_DISK","EVENT_COLLECTION_DISK","SEND_DISK","SEND_MEMORY","browser","COLLECTION_DATA","FOLDER_DISK","VAULT_FILTER_DISK","VAULT_SETTINGS_DISK","VAULT_SEARCH_MEMORY","CIPHERS_DISK","CIPHERS_DISK_LOCAL","CIPHERS_MEMORY","STATE_LOCK_EVENT","STATE_LOGOUT_EVENT","StateEventRegistrarService","globalStateProvider","storageServiceProvider","stateEventStateMap","lock","get","logout","registerEvents","clearEvent","eventState","storageLocation","newEvent","state","location","update","existingTickets","push","shouldUpdate","currentTickets","findIndex","StateEventRunnerService","stateEventMap","handleEvent","event","tickets","state$","failures","ticket","service","ticketStorageKey","storageKeyFor","remove","err","errorMessage","PIN_KEY_ENCRYPTED_USER_KEY_PERSISTENT","PIN_KEY_ENCRYPTED_USER_KEY_EPHEMERAL","USER_KEY_ENCRYPTED_PIN","OLD_PIN_KEY_ENCRYPTED_MASTER_KEY","PinService","accountService","cryptoFunctionService","kdfConfigService","keyGenerationService","logService","masterPasswordService","stateProvider","stateService","getPinKeyEncryptedUserKeyPersistent","validateUserId","getUserState$","setPinKeyEncryptedUserKeyPersistent","pinKeyEncryptedUserKey","setUserState","clearPinKeyEncryptedUserKeyPersistent","getPinKeyEncryptedUserKeyEphemeral","setPinKeyEncryptedUserKeyEphemeral","clearPinKeyEncryptedUserKeyEphemeral","createPinKeyEncryptedUserKey","pin","userKey","accounts$","accounts","kdfConfig","getKdfConfig","pinKey","makePinKey","encrypt","storePinKeyEncryptedUserKey","storeAsEphemeral","getUserKeyEncryptedPin","setUserKeyEncryptedPin","userKeyEncryptedPin","clearUserKeyEncryptedPin","createUserKeyEncryptedPin","getOldPinKeyEncryptedMasterKey","clearOldPinKeyEncryptedMasterKey","salt","deriveKeyFromPassword","stretchKey","getPinLockType","aUserKeyEncryptedPinIsSet","aPinKeyEncryptedUserKeyPersistentIsSet","anOldPinKeyEncryptedMasterKeyIsSet","isPinSet","decryptUserKeyWithPin","pinLockType","requireMasterPasswordOnClientRestart","oldPinKeyEncryptedMasterKey","getPinKeyEncryptedKeys","decryptAndMigrateOldPinKeyEncryptedMasterKey","decryptUserKey","validatePin","decryptToBytes","masterKey","decryptMasterKeyWithPin","encUserKey","getEncryptedCryptoSymmetricKey","decryptUserKeyWithMasterKey","setCryptoMasterKeyBiometric","oldPinKeyEncryptedMasterKeyString","decryptedPin","compareFast","STORED_EMAIL","LoginEmailService","storedEmailState","getGlobal","storedEmail$","getEmail","setEmail","getRememberEmail","rememberEmail","setRememberEmail","clearValues","saveEmailSettings","getResponseProperty","propertyName","exactName","otherCasePropertyName","status","identityResponse","errorModel","responseErrorModel","validationErrors","captchaSiteKey","HCaptcha_SiteKey","captchaRequired","statusCode","getSingleMessage","hasOwnProperty","getAllMessages","messages","item","prefix","lastSep","lastIndexOf","appId","platformUtilsService","getDevice","getDeviceString","identifier","pushToken","TokenRequest","device","alterIdentityTokenHeaders","headers","setTwoFactor","setAuthRequestAccessCode","authRequest","toIdentityToken","clientId","scope","client_id","deviceType","deviceIdentifier","deviceName","twoFactorToken","twoFactorProvider","twoFactorRemember","masterPasswordHash","captchaResponse","grant_type","username","password","DeviceType","TwoFactorProviderType","ForceSetPasswordReason","MasterPasswordPolicyResponse","minComplexity","minLength","requireUpper","requireLower","requireNumbers","requireSpecial","enforceOnLogin","KeyConnectorUserDecryptionOptionResponse","TrustedDeviceUserDecryptionOptionResponse","EncryptedPrivateKey","encryptedPrivateKey","EncryptedUserKey","encryptedUserKey","WebAuthnPrfDecryptionOptionResponse","UserDecryptionOptionsResponse","TrustedDeviceOption","KeyConnectorOption","WebAuthnPrfOption","webAuthnPrfOption","accessToken","access_token","expiresIn","expires_in","refreshToken","refresh_token","tokenType","token_type","resetMasterPassword","privateKey","kdf","kdfIterations","kdfMemory","kdfParallelism","forcePasswordReset","apiUseKeyConnector","masterPasswordPolicy","UserDecryptionOptions","ClientType","Android","iOS","AndroidAmazon","WindowsDesktop","MacOsDesktop","LinuxDesktop","UWP","WindowsCLI","MacOsCLI","LinuxCLI","EventSystemUser","EventType","IntegrationType","NativeMessagingVersion","NotificationType","ProductType","HttpStatusCode","EncryptionPair","encrypted","decrypted","decryptedFromJson","encryptedFromJson","AccountData","passwordGenerationHistory","AccountKeys","cryptoSymmetricKey","publicKey","initRecordEncryptionPairsFromJSON","decObj","AccountSettings","profile","settings","AuthRequestLoginStrategyData","tokenRequest","authRequestCredentials","Domain","buildDomainModel","dataObj","notEncList","objProp","buildDataModel","notEncStringList","decryptObj","viewModel","promises","theProp","p","then","mapProp","val","all","policy","PasswordLoginStrategyData","forcePasswordResetReason","None","code","codeVerifier","redirectUri","code_verifier","redirect_uri","SsoLoginStrategyData","clientSecret","client_secret","UserApiLoginStrategyData","JSON","stringify","WebAuthnLoginStrategyData","credentials","sso","userApiKey","webAuthn","USER_DECRYPTION_OPTIONS","UserDecryptionOptionsService","userDecryptionOptionsState","getActive","userDecryptionOptions$","hasMasterPassword$","userDecryptionOptionsById$","getUser","setUserDecryptionOptions","_","AdminAuthRequestStorable","privateKeyBuffer","requestApproved","ACCEPT_AUTH_REQUESTS_KEY","ADMIN_AUTH_REQUEST_KEY","AuthRequestService","appIdService","apiService","authRequestPushNotificationSubject","Subject","authRequestPushNotification$","asObservable","getAcceptAuthRequests","setAcceptAuthRequests","accept","getAdminAuthRequest","authRequestSerialized","setAdminAuthRequest","clearAdminAuthRequest","approveOrDenyAuthRequest","approve","pubKey","activeAccount$","masterKey$","masterKeyHash","masterKeyHash$","encryptedMasterKeyHash","keyToEncrypt","rsaEncrypt","getUserKey","encryptedKey","getAppId","putAuthRequest","setUserKeyAfterDecryptingSharedUserKey","authReqResponse","authReqPrivateKey","decryptPubKeyEncryptedUserKey","setUserKey","setKeysAfterDecryptingSharedMasterKeyAndHash","decryptPubKeyEncryptedMasterKeyAndHash","setMasterKey","setMasterKeyHash","pubKeyEncryptedUserKey","decryptedUserKeyBytes","rsaDecrypt","pubKeyEncryptedMasterKey","pubKeyEncryptedMasterKeyHash","decryptedMasterKeyArrayBuffer","decryptedMasterKeyHashArrayBuffer","sendAuthRequestPushNotification","notification","next","OrganizationData","enabled","usePolicies","useGroups","useDirectory","useEvents","useTotp","use2fa","useApi","useSso","useKeyConnector","useScim","useCustomPermissions","useResetPassword","useSecretsManager","usePasswordManager","useActivateAutofillPolicy","selfHost","usersGetPremium","seats","maxCollections","maxStorageGb","ssoBound","permissions","resetPasswordEnrolled","hasPublicAndPrivateKeys","providerId","providerName","providerType","familySponsorshipFriendlyName","familySponsorshipAvailable","planProductType","keyConnectorEnabled","familySponsorshipLastSyncDate","familySponsorshipValidUntil","familySponsorshipToDelete","accessSecretsManager","limitCollectionCreationDeletion","allowAdminAccessToAllCollectionItems","flexibleCollections","isMember","isProviderUser","OrganizationApiKeyType","OrganizationConnectionType","OrganizationUserStatusType","OrganizationUserType","PolicyType","ProviderType","ProviderUserStatusType","ProviderUserType","ScimProviderType","ProviderStatusType","Organization","canAccess","isOwner","Confirmed","isManager","Manager","isAdmin","Admin","Owner","canAccessEventLogs","accessEventLogs","canAccessImportExport","accessImportExport","canAccessReports","accessReports","canCreateNewCollections","createNewCollections","canEditAnyCollection","flexibleCollectionsV1Enabled","Custom","editAnyCollection","canEditUnmanagedCollections","canEditUnassignedCiphers","restrictProviderAccessFlagEnabled","canEditAllCiphers","canDeleteAnyCollection","deleteAnyCollection","canViewAllCollections","canEditAssignedCollections","editAssignedCollections","canDeleteAssignedCollections","deleteAssignedCollections","canViewAssignedCollections","canManageGroups","manageGroups","canManageSso","manageSso","canManageDomainVerification","canManageScim","manageScim","canManagePolicies","managePolicies","canManageUsers","manageUsers","canManageUsersPassword","manageResetPassword","canManageDeviceApprovals","isExemptFromPolicies","canViewSubscription","canEditSubscription","hasProvider","Msp","canEditPaymentMethods","canViewBillingHistory","hasReseller","Reseller","canAccessSecretsManager","isFreeOrg","canManageSponsorships","ORGANIZATIONS","mapToBooleanHasAnyOrganizations","orgs","mapToSingleOrganization","organizationId","find","o","OrganizationService","organizations$","getOrganizationsFromState$","memberOrganizations$","canManageSponsorships$","get$","getAll$","getAll","hasOrganizations","upsert","organization","stateFor","existingOrganizations","organizations","getFromState","mapOrganizationRecordToArray","values","ListResponse","t","dr","continuationToken","PolicyData","fromPolicy","Policy","fromListResponse","d","PolicyResponse","PolicyApiService","policyService","getPolicy","send","getPolicies","getPoliciesByToken","organizationUserId","getMasterPasswordPolicyResponseForOrgUser","getMasterPasswordPolicyOptsForOrgUser","masterPasswordPolicyResponse","masterPasswordPolicyOptions$","NotFound","putPolicy","request","ResetPasswordPolicyOptions","autoEnrollEnabled","policyRecordToArray","policiesMap","f","POLICIES","policyData","PolicyService","organizationService","activeUserPolicyState","activeUserPolicies$","policies$","policyType","filteredPolicies$","policies","combineLatest","enforcedPolicyFilter","at","policyAppliesToActiveUser$","policyAppliesToUser","orgDict","Accepted","isExemptFromPolicy","obsPolicies","enforcedOptions","filteredPolicies","MasterPassword","currentPolicy","evaluateMasterPassword","passwordStrength","newPassword","enforcedPolicyOptions","toLocaleLowerCase","toLocaleUpperCase","getResetPasswordPolicyOptions","resetPasswordPolicyOptions","ResetPassword","MaximumVaultTimeout","PasswordGenerator","Provider","providerStatus","isProviderAdmin","canCreateOrganizations","ProviderAdmin","PROVIDERS","mapToSingleProvider","providers","ProviderService","providers$","activeUserId$","take","mapProviderRecordToArray","save","AuthenticationStatus","accountInfoEqual","ACCOUNT_ACCOUNTS","accountInfo","ACCOUNT_ACTIVE_ACCOUNT_ID","ACCOUNT_ACTIVITY","activity","LOGGED_OUT_INFO","emailVerified","AccountServiceImplementation","messagingService","accountsState","activeAccountIdState","bufferSize","refCount","accountActivity$","sortedUserIds$","lastActive","sort","nextUpAccount$","activeAccount","sortedUserIds","nextId","addAccount","accountData","setAccountActivity","setAccountName","setAccountInfo","setAccountEmail","setAccountEmailVerified","clean","removeAccountActivity","switchAccount","updateActivity","combineLatestWith","lastActivity","oldActivity","newAccountInfo","oldAccountInfo","AuthService","messageSender","tokenService","activeAccountStatus$","account","authStatusFor$","authStatuses$","statuses","reduce","acc","getInMemoryUserKeyFor$","hasAccessToken$","hasAccessToken","Unlocked","Locked","LoggedOut","getAuthStatus","logOut","callback","UpdateAvatarRequest","avatarColor","AVATAR_COLOR","AvatarService","avatarColor$","setAvatarColor","putAvatar","setSyncAvatarColor","getUserAvatarColor$","SecretVerificationRequest","UpdateDevicesTrustRequest","DeviceKeysUpdateRequest","DEVICE_KEY","deviceKey","SHOULD_TRUST_DEVICE","shouldTrustDevice","DeviceTrustService","devicesApiService","secureStorageService","userDecryptionOptionsService","platformSupportsSecureStorage","supportsSecureStorage","deviceKeySecureStorageKey","supportsDeviceTrust$","getShouldTrustDevice","setShouldTrustDevice","trustDeviceIfRequired","trustDevice","makeDeviceKey","devicePublicKey","devicePrivateKey","rsaGenerateKeyPair","devicePublicKeyEncryptedUserKey","userKeyEncryptedDevicePublicKey","deviceKeyEncryptedDevicePrivateKey","updateTrustedDeviceKeys","setDeviceKey","showToast","rotateDevicesTrust","newUserKey","getDeviceKey","oldUserKey","userKey$","secretVerificationRequest","currentDeviceKeys","getDeviceKeys","decryptedDevicePublicKey","encryptedPublicKey","encryptedNewUserKey","encryptedDevicePublicKey","currentDeviceUpdateRequest","trustRequest","currentDevice","otherDevices","updateTrust","deviceKeyB64","getSecureStorageOptions","createKey","decryptUserKeyWithDeviceKey","encryptedDevicePrivateKey","Disk","useSecureStorage","DeviceView","DevicesServiceImplementation","getDevices$","defer","getDevices","deviceResponses","getDeviceByIdentifier$","getDeviceByIdentifier","isDeviceKnownForUser$","getKnownDevice","updateTrustedDeviceKeys$","DeviceResponse","creationDate","revisionDate","ProtectedDeviceResponse","TrustedDeviceKeysRequest","DevicesApiServiceImplementation","result","updateDevicesTrustRequestModel","KDF_CONFIG","KdfConfigService","setKdfConfig","KeyConnectorUserKeyRequest","SetKeyConnectorKeyRequest","orgIdentifier","USES_KEY_CONNECTOR","usesKeyConnector","CONVERT_ACCOUNT_TO_KEY_CONNECTOR","convertAccountToKeyConnector","KeyConnectorService","logoutCallback","usesKeyConnectorState","convertAccountToKeyConnectorState","setUsesKeyConnector","getUsesKeyConnector","userNeedsMigration","loggedInUsingSso","getIsExternal","requiredByOrganization","getManagingOrganization","userIsNotUsingKeyConnector","migrateUser","keyConnectorRequest","postUserKeyToKeyConnector","handleKeyConnectorError","postConvertToKeyConnector","setMasterKeyFromUrl","masterKeyResponse","getMasterKeyFromKeyConnector","keyArr","convertNewSsoUserToKeyConnector","tokenResponse","legacyKeyConnectorUrl","makeMasterKey","makeUserKey","setMasterKeyEncryptedUserKey","privKey","makeKeyPair","setPasswordRequest","postSetKeyConnectorKey","setConvertAccountRequired","getConvertAccountRequired","removeConvertAccountRequired","MASTER_KEY","MASTER_KEY_HASH","MASTER_KEY_ENCRYPTED_USER_KEY","FORCE_SET_PASSWORD_REASON","reason","MasterPasswordService","forceSetPasswordReason$","getMasterKeyEncryptedUserKey","clearMasterKey","clearMasterKeyHash","setForceSetPasswordReason","deprecatedKey","decUserKey","newKey","CODE_VERIFIER","SSO_STATE","USER_ORGANIZATION_SSO_IDENTIFIER","organizationIdentifier","GLOBAL_ORGANIZATION_SSO_IDENTIFIER","SSO_EMAIL","SsoLoginService","codeVerifierState","ssoState","orgSsoIdentifierState","ssoEmailState","activeUserOrgSsoIdentifierState","getCodeVerifier","setCodeVerifier","getSsoState","setSsoState","getOrganizationSsoIdentifier","setOrganizationSsoIdentifier","getSsoEmail","setSsoEmail","getActiveUserOrganizationSsoIdentifier","setActiveUserOrganizationSsoIdentifier","VaultTimeoutAction","VaultTimeoutStringType","ACCESS_TOKEN_DISK","ACCESS_TOKEN_MEMORY","REFRESH_TOKEN_DISK","REFRESH_TOKEN_MEMORY","EMAIL_TWO_FACTOR_TOKEN_RECORD_DISK_LOCAL","emailTwoFactorTokenRecord","API_KEY_CLIENT_ID_DISK","apiKeyClientId","API_KEY_CLIENT_ID_MEMORY","API_KEY_CLIENT_SECRET_DISK","apiKeyClientSecret","API_KEY_CLIENT_SECRET_MEMORY","SECURITY_STAMP_MEMORY","securityStamp","TokenStorageLocation","TokenService","singleUserStateProvider","accessTokenKeySecureStorageKey","refreshTokenSecureStorageKey","initializeState","disk","Boolean","emailTwoFactorTokenRecordGlobalState","activeUserIdGlobalState","setTokens","vaultTimeoutAction","vaultTimeout","clientIdClientSecret","getUserIdFromAccessToken","_setAccessToken","setRefreshToken","setClientId","setClientSecret","getAccessTokenKey","accessTokenKeyB64","createAndSaveAccessTokenKey","newAccessTokenKey","clearAccessTokenKey","getOrCreateAccessTokenKey","accessTokenKey","encryptAccessToken","decryptAccessToken","encryptedAccessToken","determineStorageLocation","SecureStorage","Memory","setAccessToken","clearAccessToken","getAccessToken","accessTokenMemory","getStateValueByUserIdAndKeyDef","accessTokenDisk","encryptedAccessTokenEncString","saveStringToSecureStorage","refreshTokenSecureStorage","getStringFromSecureStorage","getRefreshToken","refreshTokenMemory","refreshTokenDisk","clearRefreshToken","getClientId","apiKeyClientIdMemory","clearClientId","getClientSecret","apiKeyClientSecretMemory","clearClientSecret","setTwoFactorToken","getTwoFactorToken","clearTwoFactorToken","clearTokens","decodeAccessToken","jwtToken","encodedPayload","decodedPayloadJSON","decodingError","parse","jsonError","decodeJwtTokenToJson","getTokenExpirationDate","decoded","exp","expirationDate","setUTCSeconds","tokenSecondsRemaining","offsetSeconds","date","msRemaining","valueOf","round","tokenNeedsRefresh","minutes","getUserId","sub","getEmailVerified","email_verified","getName","getIssuer","iss","amr","includes","getSecurityStamp","setSecurityStamp","LogOut","VerificationType","UserVerificationApiService","postAccountVerifyOTP","postAccountRequestOTP","VerifyOTPRequest","OTP","UserVerificationService","userVerificationApiService","pinService","vaultTimeoutSettingsService","getAvailableVerificationOptions","verificationType","userHasMasterPassword","biometricsLockSet","biometricsUserKeyStored","hasMasterPasswordAndMasterKeyHash","isBiometricLockSet","hasUserKeyStored","Biometric","client","masterPassword","biometrics","server","otp","buildRequest","verification","requestClass","alreadyHashed","validateSecretInput","secret","hashMasterKey","verifyUser","verificationHasSecret","verifyUserByOTP","verifyUserByMasterPassword","PIN","verifyUserByPIN","Biometrics","verifyUserByBiometrics","compareAndUpdateKeyHash","getUserKeyFromStorage","requestOTP","ClearClipboardDelay","AUTOFILL_CARD_ID","AUTOFILL_ID","AUTOFILL_IDENTITY_ID","COPY_IDENTIFIER_ID","COPY_PASSWORD_ID","COPY_USERNAME_ID","COPY_VERIFICATION_CODE_ID","CREATE_CARD_ID","CREATE_IDENTITY_ID","CREATE_LOGIN_ID","GENERATE_PASSWORD_ID","NOOP_COMMAND_SUFFIX","ROOT_ID","SEPARATOR_ID","NOTIFICATION_BAR_LIFESPAN_MS","AutofillOverlayVisibility","AUTOFILL_ON_PAGE_LOAD","AUTOFILL_ON_PAGE_LOAD_DEFAULT","AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED","AUTOFILL_ON_PAGE_LOAD_POLICY_TOAST_HAS_DISPLAYED","AUTO_COPY_TOTP","INLINE_MENU_VISIBILITY","ENABLE_CONTEXT_MENU","CLEAR_CLIPBOARD_DELAY","AutofillSettingsService","autofillOnPageLoadState","autofillOnPageLoad$","autofillOnPageLoadDefaultState","autofillOnPageLoadDefault$","autofillOnPageLoadCalloutIsDismissedState","autofillOnPageLoadCalloutIsDismissed$","activateAutofillOnPageLoadFromPolicy$","ActivateAutofill","autofillOnPageLoadPolicyToastHasDisplayedState","autofillOnPageLoadPolicyToastHasDisplayed$","autoCopyTotpState","autoCopyTotp$","inlineMenuVisibilityState","inlineMenuVisibility$","enableContextMenuState","enableContextMenu$","clearClipboardDelayState","clearClipboardDelay$","setAutofillOnPageLoad","newValue","setAutofillOnPageLoadDefault","setAutofillOnPageLoadCalloutIsDismissed","setAutofillOnPageLoadPolicyToastHasDisplayed","setAutoCopyTotp","setInlineMenuVisibility","setEnableContextMenu","setClearClipboardDelay","ENABLE_BADGE_COUNTER","BadgeSettingsService","enableBadgeCounterState","enableBadgeCounter$","setEnableBadgeCounter","UriMatchStrategy","SHOW_FAVICONS","NEVER_DOMAINS","EQUIVALENT_DOMAINS","DEFAULT_URI_MATCH_STRATEGY","DefaultDomainSettingsService","showFaviconsState","showFavicons$","neverDomainsState","neverDomains$","equivalentDomainsState","equivalentDomains$","defaultUriMatchStrategyState","defaultUriMatchStrategy$","setShowFavicons","setNeverDomains","setEquivalentDomains","setDefaultUriMatchStrategy","getUrlEquivalentDomains","equivalentDomains","equivalents","ed","flat","ENABLE_ADDED_LOGIN_PROMPT","ENABLE_CHANGED_PASSWORD_PROMPT","UserNotificationSettingsService","enableAddedLoginPromptState","enableAddedLoginPrompt$","enableChangedPasswordPromptState","enableChangedPasswordPrompt$","setEnableAddedLoginPrompt","setEnableChangedPasswordPrompt","BILLING_ACCOUNT_PROFILE_KEY_DEFINITION","billingAccountProfile","DefaultBillingAccountProfileStateService","billingAccountProfileState","billingAccountProfileOrNull","hasPremiumFromAnyOrganization$","hasPremiumFromAnyOrganization","hasPremiumPersonally$","hasPremiumPersonally","hasPremiumFromAnySource$","setHasPremium","BIOMETRIC_UNLOCK_ENABLED","REQUIRE_PASSWORD_ON_START","ENCRYPTED_CLIENT_KEY_HALF","DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT","PROMPT_CANCELLED","PROMPT_AUTOMATICALLY","FINGERPRINT_VALIDATED","DefaultBiometricStateService","biometricUnlockEnabledState","biometricUnlockEnabled$","requirePasswordOnStartState","requirePasswordOnStart$","encryptedClientKeyHalfState","encryptedClientKeyHalf$","encryptedClientKeyHalfToEncString","dismissedRequirePasswordOnStartCalloutState","dismissedRequirePasswordOnStartCallout$","promptCancelledState","promptCancelled$","promptAutomaticallyState","promptAutomatically$","fingerprintValidatedState","fingerprintValidated$","setBiometricUnlockEnabled","getBiometricUnlockEnabled","setRequirePasswordOnStart","currentActiveId","combinedState$","removeEncryptedClientKeyHalf","setEncryptedClientKeyHalf","encryptedKeyHalf","getRequirePasswordOnStart","getEncryptedClientKeyHalf","resetUserPromptCancelled","setDismissedRequirePasswordOnStartCallout","activeUserId","setUserPromptCancelled","resetAllPromptCancelled","setPromptAutomatically","prompt","setFingerprintValidated","validated","AccountFactory","accountConstructor","args","GlobalStateFactory","globalStateConstructor","StateFactory","globalStateFactory","accountFactory","createGlobal","createAccount","MessageListener","messageStream","allMessages$","messages$","commandDefinition","msg","command","EMPTY","E","MultiMessageSender","innerMessageSenders","payload","MessageSender","combine","messageSenders","CommandDefinition","getCommand","EXTERNAL_SOURCE_TAG","isExternalMessage","SubjectMessageSender","messagesSubject","Lazy","factory","_value","_isCreated","caches","sequentialize","cacheKey","propertyKey","descriptor","originalMethod","cache","getCache","argsCacheKey","onFinally","delete","size","catch","GlobalState","APP_ID_KEY","ANONYMOUS_APP_ID_KEY","AppIdService","appIdState","anonymousAppIdState","appId$","tap","anonymousAppId$","getAnonymousAppId","ServerConfigResponse","featureStates","version","gitHash","ThirdPartyServerConfigResponse","environment","EnvironmentServerConfigResponse","cloudRegion","vault","api","identity","notifications","ConfigApiService","authed","FeatureFlag","FALSE","DefaultFeatureFlagValue","BrowserFilelessImport","ItemShare","FlexibleCollectionsV1","GeneratorToolsModernization","ShowPaymentMethodWarningBanners","EnableConsolidatedBilling","AC1795_UpdatedSubscriptionStatusSection","UnassignedItemsBanner","EnableDeleteProvider","ExtensionRefresh","RestrictProviderAccess","UseTreeWalkerApiForPageDetailsCollection","BulkDeviceApproval","ServerConfig","serverConfigData","utcDate","getAgeInMilliseconds","isValid","Region","getFlags","envFlags","flagEnabled","flag","flags","ServerConfigData","serverConfigResponse","ThirdPartyServerConfigData","toISOString","EnvironmentServerConfigData","USER_SERVER_CONFIG","GLOBAL_SERVER_CONFIGURATIONS","DefaultConfigService","configApiService","environmentService","failedFetchFallbackSubject","apiUrl$","environment$","getApiUrl","serverConfig$","apiUrl","globalConfigFor$","userConfigFor$","config","rec","existingConfig","olderThanRetrievalInterval","renewConfig","mergeWith","cloudRegion$","US","getFeatureFlag$","serverConfig","getFeatureFlag","checkServerMeetsVersionRequirement$","minimumRequiredServerVersion","SemVer","ensureConfigFetched","newConfig","setCloudRegion","configs","ContainerService","attachToGlobal","EncArrayBuffer","encBytes","minimumLength","ENC_TYPE_LENGTH","throwDecryptionError","fromB64","b64","EncryptedObject","EncryptServiceImplementation","logMacFailures","plainValue","plainBuf","encObj","aesEncrypt","encryptToBytes","encValue","macLen","encString","resolveLegacyKey","fastParams","aesDecryptFastParameters","computedMac","hmacFast","macData","logMacFailed","aesDecryptFast","encThing","hmac","aesDecrypt","algorithm","decryptItems","items","results","hashArray","randomBytes","InitializerKey","CipherType","CipherRepromptType","FieldType","LoginLinkedId","CardLinkedId","IdentityLinkedId","SecureNoteType","AttachmentData","fileName","sizeName","CardData","cardholderName","brand","number","expMonth","expYear","FieldData","linkedId","IdentityData","title","firstName","middleName","lastName","address1","address2","address3","city","postalCode","country","company","phone","ssn","passportNumber","licenseNumber","Fido2CredentialData","credentialId","keyType","keyAlgorithm","keyCurve","keyValue","rpId","userName","counter","rpName","userDisplayName","discoverable","LoginUriData","uri","uriChecksum","LoginData","passwordRevisionDate","totp","autofillOnPageLoad","uris","u","fido2Credentials","PasswordHistoryData","lastUsedDate","SecureNoteData","CipherData","collectionIds","folderId","edit","viewPassword","organizationUseTotp","favorite","notes","deletedDate","reprompt","Login","login","SecureNote","secureNote","Card","card","Identity","fields","attachments","passwordHistory","ph","AttachmentView","fileSize","LinkedMetadata","_i18nKey","i18nKey","linkedFieldOption","linkedFieldOptions","ItemView","CardView","_brand","_number","_subTitle","maskedCode","repeat","maskedNumber","subTitle","count","expiration","formatYear","year","getCardBrandByPatterns","cardNum","re","CardholderName","ExpMonth","ExpYear","Code","Brand","FieldView","newField","showValue","showCount","maskedValue","IdentityView","_firstName","_lastName","fullAddress","address","fullAddressPart2","addressPart2","Title","MiddleName","Address1","Address2","Address3","City","State","PostalCode","Country","Company","Email","Phone","Ssn","Username","PassportNumber","LicenseNumber","FirstName","LastName","FullName","Fido2CredentialView","CanLaunchWhitelist","SafeUrls","canLaunch","LoginUriView","_uri","_domain","_hostname","_host","_canLaunch","hostnameOrUri","hostOrUri","isWebsite","launchUri","matchesUri","targetUri","defaultUriMatch","matchType","targetDomain","matchDomains","add","matchesDomain","urlHost","has","domainUrlHost","LoginView","l","hasUris","maskedPassword","some","hasTotp","hasFido2Credentials","Password","PasswordHistoryView","SecureNoteView","n","CipherView","initializerKey","localData","hasPasswordHistory","hasAttachments","hasOldAttachments","hasFields","passwordRevisionDisplayDate","isDeleted","isUnassigned","linkedFieldValue","linkedFieldI18nKey","view","Attachment","decryptAttachmentKey","decValue","toAttachmentData","toCardData","Field","toFieldData","toIdentityData","Fido2Credential","toFido2CredentialData","LoginUri","validateChecksum","clearTextUri","localChecksum","toLoginUriData","bypassValidation","toLoginData","toPasswordHistoryData","toSecureNoteData","Cipher","model","promise","attachment","decAttachment","field","decField","decPh","toCipherData","classInitializers","MultithreadEncryptServiceImplementation","clear$","worker","Worker","restartTimeout","postMessage","fromEvent","jsonItem","className","takeUntil","defaultIfEmpty","clear","terminate","clearTimeout","timeout","Fido2AlgorithmIdentifier","Fido2AuthenticatorErrorCode","Fido2AuthenticatorError","errorCode","POW_2_32","POW_2_53","TaggedValue","tag","CBOR","decode","tagger","simpleValue","dataView","DataView","ta","offset","tagValueFunction","simpleValFunction","commitRead","readArrayBuffer","readUint8","readUint16","getUint16","readUint32","getUint32","readBreak","readLength","additionalInformation","readIndefiniteStringLength","majorType","initialByte","appendUtf16Data","utf16data","ret","decodeItem","tempArrayBuffer","tempDataView","sign","exponent","fraction","setUint32","getFloat32","readFloat16","getFloat64","elements","fullArrayLength","fullArray","fullArrayOffset","string","retArray","retObject","encode","lastLength","byteView","prepareWrite","newByteLength","requiredLength","oldDataView","uint32count","commitWrite","writeUint8","setUint8","writeUint8Array","writeUint16","setUint16","writeUint32","writeUint64","low","high","writeTypeAndLength","encodeItem","y","is","setFloat64","writeFloat64","utf8data","charCode","converted","isView","SharedArrayBuffer","mod","writeVarUint","retView","getUint8","getParamSize","keySize","paramBytesForAlg","ES256","ES384","ES512","MAX_OCTET","ENCODED_TAG_SEQ","TAG_SEQ","ENCODED_TAG_INT","countPadding","buf","start","end","padding","needs0x00","p1363ToDer","alg","paramBytes","getParamBytesForAlg","signatureBytes","TypeError","rPadding","rNeeds0x00","sPadding","sNeeds0x00","rActualLength","sActualLength","rLength","sLength","rsBytes","shortLength","dst","subarray","Fido2Utils","bufferToString","bufferSource","stringToBuffer","bufferSourceToUint8Array","isArrayBuffer","globalThis","byteToHex","guidToRawFormat","guid","isValidGuid","guidToStandardFormat","AAGUID","KeyUsages","cipherService","userInterface","syncService","makeCredential","params","tab","abortController","userInterfaceSession","newSession","fallbackSupported","credTypesAndPubKeyAlgs","every","requestedAlgorithms","NotSupported","requireResidentKey","Unknown","requireUserVerification","ensureUnlockedVault","fullSync","existingCipherIds","findExcludedCredentials","excludeCredentialDescriptorList","informExcludedCredential","NotAllowed","cipher","fido2Credential","keyPair","pubKeyDer","userVerified","confirmNewCredential","credentialName","rpEntity","userEntity","displayName","userVerification","cipherId","crypto","subtle","generateKey","namedCurve","createKeyPair","exportKey","getKeyForCipherKeyDecryption","pkcs8Key","createKeyView","reencrypted","updateWithServer","authData","generateAuthData","userPresence","attestationObject","fmt","attStmt","publicKeyAlgorithm","close","getAssertion","cipherOptions","allowCredentialDescriptorList","findCredentialsById","findCredentialsByRp","informCredentialNotFound","pickCredential","cipherIds","selectedCipherId","selectedCipher","selectedFido2Credential","selectedCredentialId","sigBase","clientDataHash","generateSignature","getPrivateKeyFromFido2Credential","selectedCredential","ids","getAllDecrypted","keyBuffer","importKey","rpIdHash","digest","extensionData","attestationData","backupEligibility","backupState","authDataFlags","attestedCredentialData","credentialIdLength","publicKeyJwk","keyX","keyY","coseBytes","UserRequestedFallbackAbortReason","FallbackRequestedError","fallbackRequested","isValidRpId","origin","parsedOrigin","parsedRpId","subdomain","endsWith","authenticator","configService","authService","vaultSettingsService","domainSettingsService","isFido2FeatureEnabled","neverDomains","enablePasskeys$","createCredential","AbortController","sameOriginWithAncestors","DOMException","user","rp","pubKeyCredParams","kp","collectedClientData","challenge","crossOrigin","clientDataJSONBytes","makeCredentialParams","excludeCredentials","transports","authenticatorSelection","residentKey","enterpriseAttestationPossible","attestation","mapToMakeCredentialParams","signal","aborted","setAbortTimeout","makeCredentialResult","credProps","InvalidState","rk","assertCredential","getAssertionParams","allowedCredentialIds","mapToGetAssertionParams","getAssertionResult","TIMEOUTS","NO_VERIFICATION","DEFAULT","MIN","MAX","WITH_VERIFICATION","clampedTimeout","abort","AzureFileUploadService","upload","renewalCallback","azureUploadBlob","azureUploadBlocks","urlObject","Headers","toUTCString","searchParams","Request","body","method","blobResponse","fetch","baseUrl","blockSize","getMaxBlockSize","blockIndex","numBlocks","ceil","blocksStaged","renewUrlIfNecessary","blockUrl","blockId","encodedBlockId","append","blockData","blockHeaders","blockRequest","blockResponse","blockListUrl","blockListXml","expiry","setTime","utfBlockId","blockIdList","xml","Version","month","day","compareTo","BitwardenFileUploadService","encryptedFileName","encryptedFileData","apiCall","fd","FormData","blob","Blob","filepath","contentType","FileUploadService","azureFileUploadService","bitwardenFileUploadService","uploadData","fileUploadMethods","fileUploadType","Direct","postDirect","Azure","renewFileUploadUrl","rollback","KeyGenerationService","bitLength","aesGenerateKey","createKeyWithPurpose","purpose","material","hkdf","derivedKey","deriveKeyFromMaterial","pbkdf2","saltHash","argon2","hkdfExpand","MigrationBuilder","migrations","migrate","addMigrator","helper","migrator","runMigrator","direction","newMigration","shouldMigrate","toVersion","bind","updateVersion","IRREVERSIBLE","Migrator","fromVersion","startVersion","currentVersion","endVersion","USER_EVER_HAD_USER_KEY","EverHadUserKeyMigrator","getAccounts","everHadUserKey","setToUser","migrateAccount","getFromUser","rollbackAccount","USER_ENCRYPTED_ORGANIZATION_KEYS","OrganizationKeyMigrator","organizationKeys","ENVIRONMENT_STATE","REGION_KEY","URLS_KEY","MoveEnvironmentStateToProviders","legacyGlobal","region","setToGlobal","environmentUrls","legacyAccounts","updatedLegacyGlobal","globalRegion","getFromGlobal","globalUrls","updatedAccount","userRegion","userUrls","rollbackUser","USER_ENCRYPTED_PROVIDER_KEYS","ProviderKeyMigrator","providerKeys","CLIENT_KEY_HALF","MoveBiometricClientKeyHalfToStateProviders","biometricEncryptionClientKeyHalf","userKeyHalf","USER_ENCRYPTED_FOLDERS","FolderMigrator","folders","LAST_SYNC_KEY","LastSyncMigrator","lastSync","USER_ENABLE_PASSKEYS","EnablePasskeysMigrator","enablePasskeys","globalEnablePasskeys","autofillSettingsStateDefinition","AutofillSettingsKeyMigrator","globalState","autoFillOverlayVisibility","updateAccount","accountSettings","autoFillOnPageLoadDefault","enableAutoFillOnPageLoad","dismissedAutoFillOnPageLoadCallout","disableAutoTotpCopy","activateAutoFillOnPageLoadFromPolicy","inlineMenuVisibility","autoCopyTotp","RequirePasswordOnStartMigrator","requirePasswordOnStart","requirePassword","USER_ENCRYPTED_PRIVATE_KEY","PrivateKeyMigrator","USER_ENCRYPTED_COLLECTIONS","CollectionMigrator","collections","COLLAPSED_GROUPINGS","CollapsedGroupingsMigrator","collapsedGroupings","DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT","MoveBiometricPromptsToStateProviders","dismissedBiometricRequirePasswordOnStartCallout","disableAutoBiometricsPrompt","userDismissed","userPromptAutomatically","SM_ONBOARDING_TASKS","SmOnboardingTasksMigrator","smOnboardingTasks","autofillSettingsLocalStateDefinition","ClearClipboardDelayMigrator","clearClipboard","clearClipboardDelay","RevertLastSyncMigrator","enableBadgeCounterKeyDefinition","BadgeSettingsMigrator","disableBadgeCounter","enableBadgeCounter","MoveBiometricUnlockToStateProviders","biometricUnlock","UserNotificationSettingsKeyMigrator","disableAddLoginNotification","disableChangedPasswordNotification","enableAddedLoginPrompt","enableChangedPasswordPrompt","POLICIES_KEY","PolicyMigrator","enableContextMenuKeyDefinition","EnableContextMenuMigrator","disableContextMenuItem","enableContextMenu","LOCALE_KEY","PreferredLanguageMigrator","locale","APP_ID_STORAGE_KEY","ANONYMOUS_APP_ID_STORAGE_KEY","AppIdMigrator","anonymousAppId","defaultUriMatchStrategyDefinition","equivalentDomainsDefinition","neverDomainsDefinition","DomainSettingsMigrator","defaultUriMatchStrategy","THEME_SELECTION","MoveThemeToStateProviderMigrator","legacyGlobalState","theme","removeFromGlobal","vaultSettingsStateDefinition","VaultSettingsKeyMigrator","dontShowCardsCurrentTab","dontShowIdentitiesCurrentTab","showCardsCurrentTab","showIdentitiesCurrentTab","AVATAR_COLOR_KEY","AvatarColorMigrator","userAvatarColor","TOKEN_STATE_DEF_LIKE","TokenServiceStateProviderMigrator","globalData","globalTwoFactorToken","existingAccessToken","tokens","existingRefreshToken","existingApiKeyClientId","existingApiKeyClientSecret","migratedTwoFactorToken","updatedLegacyAccount","migratedAccessToken","migratedRefreshToken","migratedApiKeyClientId","migratedApiKeyClientSecret","MoveBillingAccountProfileMigrator","hasPremiumFromOrganization","RemoveEverBeenUnlockedMigrator","everBeenUnlocked","removeEverBeenUnlocked","stateVersion","USER_ORGANIZATIONS","OrganizationMigrator","EVENT_COLLECTION","EventCollectionMigrator","eventCollection","ShowFaviconDefinition","EnableFaviconMigrator","disableFavicon","showFavicons","AUTO_CONFIRM_FINGERPRINTS","AutoConfirmFingerPrintsMigrator","autoConfirmFingerPrints","UserDecryptionOptionsMigrator","ENVIRONMENT_REGION","ENVIRONMENT_URLS","ENVIRONMENT_ENVIRONMENT","MergeEnvironmentState","urls","removeFromUser","DeleteBiometricPromptCancelledData","DESKTOP_SETTINGS_STATE","WINDOW_KEY","CLOSE_TO_TRAY_KEY","MINIMIZE_TO_TRAY_KEY","START_TO_TRAY_KEY","TRAY_ENABLED_KEY","OPEN_AT_LOGIN_KEY","ALWAYS_SHOW_DOCK_KEY","ALWAYS_ON_TOP_KEY","MoveDesktopSettingsMigrator","updatedGlobal","enableCloseToTray","enableMinimizeToTray","enableStartToTray","enableTray","openAtLogin","alwaysShowDock","enableAlwaysOnTop","DDG_KEY","MoveDdgToStateProviderMigrator","enableDuckDuckGoBrowserIntegration","enableDdg","AccountServerConfigMigrator","AddKeyTypeToOrgKeysMigrator","encryptedOrgKeys","newOrgKeys","updateOrgKey","usesKeyConnectorKeyDefinition","convertAccountToKeyConnectorKeyDefinition","KeyConnectorMigrator","RememberedEmailMigrator","rememberedEmail","globalStoredEmail","DeleteInstalledVersion","installedVersion","DeviceTrustServiceStateProviderMigrator","existingDeviceKey","existingShouldTrustDevice","trustDeviceChoiceForDecryption","migratedDeviceKey","migratedShouldTrustDevice","SendType","ENCRYPTED_SENDS","SendMigrator","sends","FORCE_SET_PASSWORD_REASON_DEFINITION","MASTER_KEY_HASH_DEFINITION","MASTER_KEY_ENCRYPTED_USER_KEY_DEFINITION","MoveMasterKeyStateToProviderMigrator","forceSetPasswordReason","keyHash","masterKeyEncryptedUserKey","AuthRequestMigrator","existingAdminAuthRequest","adminAuthRequest","existingApproveLoginRequests","approveLoginRequests","migratedAdminAuthRequest","migratedAcceptAuthRequest","CipherServiceMigrator","ciphers","REFRESH_TOKEN_MIGRATED_TO_SECURE_STORAGE","RemoveRefreshTokenMigratedFlagMigrator","kdfConfigKeyDefinition","KdfConfigMigrator","RemoveLegacyEtmKeyMigrator","legacyEtmKey","KnownAccountsMigrator","migrateAuthenticatedAccounts","migrateActiveAccountId","migrateAccountActivity","userIds","getKnownUserIds","activeAccountId","accountActivity","toStore","agg","dateString","authenticatedAccounts","accountsToStore","stored","dateMs","PIN_STATE","PinStateMigrator","protectedPin","pinProtected","accountPinKeyEncryptedUserKeyPersistent","accountUserKeyEncryptedPin","accountOldPinKeyEncryptedMasterKey","VAULT_TIMEOUT_SETTINGS_STATE_DEF_LIKE","VAULT_TIMEOUT","VAULT_TIMEOUT_ACTION","vaultTimeoutTypeMigrateRecord","null","vaultTimeoutTypeRollbackRecord","never","onRestart","onLocked","onSleep","onIdle","VaultTimeoutSettingsServiceStateProviderMigrator","existingVaultTimeout","clientType","Cli","newVaultTimeout","existingVaultTimeoutAction","migratedVaultTimeout","migratedVaultTimeoutAction","NAVIGATION","PASSWORD","PASSPHRASE","PasswordOptionsMigrator","legacyOptions","passwordGenerationOptions","ambiguous","uppercase","minUppercase","lowercase","minLowercase","minNumber","special","minSpecial","passphrase","numWords","wordSeparator","capitalize","includeNumber","convertSettings","existing","updated","storeSettings","deleteSettings","HISTORY","GeneratorHistoryMigrator","CATCHALL","EFF_USERNAME","SUBADDRESS","ADDY_IO","DUCK_DUCK_GO","FASTMAIL","FIREFOX_RELAY","FORWARD_EMAIL","SIMPLE_LOGIN","ForwarderOptionsMigrator","usernameGenerationOptions","forwarders","addyIo","forwardedAnonAddyBaseUrl","forwardedAnonAddyApiToken","forwardedAnonAddyDomain","duckDuckGo","forwardedDuckDuckGoToken","fastmail","forwardedFastmailApiToken","firefoxRelay","forwardedFirefoxApiToken","forwardEmail","forwardedForwardEmailApiToken","forwardedForwardEmailDomain","simpleLogin","forwardedSimpleLoginApiKey","forwardedSimpleLoginBaseUrl","forwarder","forwardedService","algorithms","effUsername","wordCapitalize","wordIncludeNumber","subaddress","subaddressType","subaddressEmail","catchall","catchallType","catchallDomain","MoveBiometricAutoPromptToAccount","noAutoPromptBiometrics","MoveStateVersionMigrator","MoveBrowserSettingsToGlobal","tryAddSetting","accountSelector","globalSetter","globalNeverDomainsValue","accumulator","normalizedNeverDomains","targetGlobalState","MinVersionMigrator","MIN_VERSION","storageService","MigrationBuilderService","build","migrationBuilderCache","with","MigrationHelper","getGlobalKey","knownAccountUserIdsBuilderPre60","knownAccountUserIdsBuilder","userKeyBuilderPre9","userKeyBuilder","globalKeyBuilderPre9","MigrationRunner","diskStorage","migrationBuilderService","run","migrationHelper","migrationBuilder","waitForCompletion","isReady","wait","time","nextTime","waitForMigrations","SystemService","reloadCallback","autofillSettingsService","biometricStateService","reloadInterval","clearClipboardTimeout","clearClipboardTimeoutFunction","startProcessReload","cancelProcessReload","executeProcessReload","clearInterval","getVaultTimeoutActionByUserId$","nextUser","clearDecryptedData","setInterval","clipboardValue","timeoutMs","clipboardValueNow","readFromClipboard","copyToClipboard","clearing","clearPendingClipboard","UserAutoUnlockKeyService","setUserKeyInMemoryIfAutoUserKeySet","autoUserKey","Auto","DecryptParameters","WebCryptoFunctionService","globalContext","wasmSupported","checkIfWasmSupported","wcLen","passwordBuf","toBuf","pbkdf2Params","toWebCryptoAlgorithm","impKey","deriveBits","passwordArr","saltArr","pass","mem","hashLen","ArgonType","unloadRuntime","ikm","outputByteSize","hkdfParams","prk","infoBuf","infoArr","runningOkmLength","previousT","okm","md","md5","valueBytes","toByteString","valueBuf","signingAlgorithm","mac1","mac2","arr1","arr2","getBytes","rand","Uint32Array","createBuffer","putInt32","meta","encKeyByteString","macKeyByteString","decode64","parameters","mode","decipher","createDecipher","toWebCryptoAesMode","dataBuffer","finish","rsaParams","rsaExtractPublicKey","impPrivateKey","jwkPrivateKey","jwkPublicKeyParams","kty","ext","impPublicKey","key1","key2","aesParams","rawKey","modulusLength","publicExponent","getRandomValues","encodeUtf8","WebAssembly","instantiate","module","Module","Instance","DefaultActiveUserState","_userId","configureState","first","throwError","DefaultActiveUserStateProvider","DEFAULT_OPTIONS","msTimeout","getStoredValue","storage","valuesRequireDeserialization","StateBase","storageUpdate$","updates$","storageUpdate","updateType","share","connector","ReplaySubject","resetOnRefCountZero","timer","populateOptionsWithDefault","updatePromise","internalUpdate","currentState","getStateForUpdate","combinedDependencies","newState","doStorageSave","oldState","DefaultGlobalState","chosenLocation","globalKeyBuilder","DefaultGlobalStateProvider","globalStateCache","existingGlobalState","newGlobalState","DefaultSingleUserState","stateEventRegistrarService","DefaultSingleUserStateProvider","existingUserState","newUserState","DefaultStateProvider","activeUserStateProvider","derivedStateProvider","getDerived","getUserStateOrDefault$","InlineDerivedStateProvider","parentState$","deriveDefinition","dependencies","InlineDerivedState","concatMap","forceValue","DefaultThemeStateService","defaultTheme","System","selectedThemeState","selectedTheme$","setSelectedTheme","currentTheme","OrganizationConnectionResponse","configType","rawConfig","CardApi","FieldApi","IdentityApi","Fido2CredentialApi","LoginUriApi","LoginApi","SecureNoteApi","AttachmentResponse","PasswordHistoryResponse","CipherResponse","h","SelectionReadOnlyResponse","readOnly","hidePasswords","manage","CollectionResponse","externalId","CollectionDetailsResponse","assigned","CollectionAccessDetailsResponse","groups","users","unmanaged","OrganizationExportResponse","OrganizationSponsorshipSyncStatusResponse","lastSyncDate","ProviderOrganizationResponse","userCount","plan","ProviderOrganizationOrganizationDetailsResponse","organizationName","OrganizationUserBulkPublicKeyResponse","ProviderUserBulkPublicKeyResponse","ProviderUserBulkResponse","PermissionsApi","manageCiphers","ProviderUserResponse","ProviderUserUserDetailsResponse","ApiKeyResponse","apiKey","AuthRequestResponse","requestDeviceType","requestIpAddress","responseDate","requestDate","requestDateUTC","UTC","getUTCFullYear","getUTCMonth","getDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","dateNow","dateNowUTC","isExpired","isAnswered","DeviceVerificationResponse","isDeviceVerificationSectionEnabled","unknownDeviceVerificationEnabled","siteKey","captchaToken","twoFactorProviders","twoFactorProviders2","ssoEmail2faSessionToken","KeyConnectorUserKeyResponse","PreloginResponse","RegisterResponse","captchaBypassToken","SsoPreValidateResponse","TwoFactorAuthenticatorResponse","TwoFactorDuoResponse","secretKey","integrationKey","TwoFactorEmailResponse","TwoFactorProviderResponse","TwoFactorRecoverResponse","TwoFactorWebAuthnResponse","KeyResponse","migrated","ChallengeResponse","TwoFactorYubiKeyResponse","key3","key4","key5","nfc","BillingSourceResponse","cardBrand","description","needsVerification","BillingInvoiceResponse","pdfUrl","paid","amount","BillingTransactionResponse","createdDate","refunded","partiallyRefunded","refundedAmount","paymentMethodType","details","BillingHistoryResponse","invoices","transactions","hasNoHistory","BillingPaymentResponse","balance","paymentSource","ProfileOrganizationResponse","familySponsorshipLastSyncDateString","familySponsorshipValidUntilString","ProfileProviderOrganizationResponse","ProfileProviderResponse","ProfileResponse","providerOrganizations","masterPasswordHint","premiumPersonally","premiumFromOrganization","culture","twoFactorEnabled","PaymentResponse","userProfile","paymentIntentClientSecret","success","PlanResponse","product","isAnnual","nameLocalizationKey","descriptionLocalizationKey","canBeUsedByBusiness","trialPeriodDays","hasSelfHost","hasPolicies","hasGroups","hasDirectory","hasEvents","has2fa","hasApi","hasSso","hasResetPassword","upgradeSortOrder","displaySortOrder","legacyYear","disabled","passwordManager","secretsManager","PasswordManager","PasswordManagerPlanFeaturesResponse","SecretsManager","SecretsManagerPlanFeaturesResponse","stripeSeatPlanId","baseSeats","basePrice","seatPrice","hasAdditionalSeatsOption","maxAdditionalSeats","maxSeats","stripeServiceAccountPlanId","additionalPricePerServiceAccount","baseServiceAccount","maxServiceAccount","hasAdditionalServiceAccountOption","maxAdditionalServiceAccounts","maxProjects","stripePlanId","stripeStoragePlanId","stripePremiumAccessPlanId","premiumAccessOptionPrice","additionalStoragePricePerGb","baseStorageGb","hasAdditionalStorageOption","maxAdditionalStorage","hasPremiumAccessOption","SubscriptionResponse","storageName","storageGb","license","subscription","upcomingInvoice","BillingSubscriptionResponse","BillingSubscriptionUpcomingInvoiceResponse","trialStartDate","trialEndDate","periodStartDate","periodEndDate","cancelledDate","cancelAtEndDate","cancelled","BillingSubscriptionItemResponse","collectionMethod","suspensionDate","unpaidPeriodEndDate","gracePeriod","productId","quantity","interval","sponsoredSubscriptionItem","addonSubscriptionItem","TaxInfoResponse","taxId","taxIdType","line1","line2","TaxRateResponse","rate","CollectionBulkDeleteRequest","BreachAccountResponse","addedDate","breachDate","dataClasses","isActive","isVerified","logoPath","modifiedDate","pwnCount","GlobalDomainResponse","domains","excluded","DomainsResponse","globalEquivalentDomains","EventResponse","collectionId","groupId","policyId","providerUserId","providerOrganizationId","actingUserId","ipAddress","installationId","systemUser","domainName","secretId","serviceAccountId","UserKeyResponse","AttachmentUploadDataResponse","attachmentId","cipherResponse","cipherMiniResponse","OptionalCipherResponse","unavailable","SendFileApi","SendTextApi","text","hidden","SendResponse","accessId","maxAccessCount","accessCount","deletionDate","disable","hideEmail","file","FolderResponse","SyncResponse","ApiService","refreshAccessTokenErrorCallback","customUserAgent","isWebClient","isDesktopClient","IEBrowser","ChromeBrowser","EdgeBrowser","FirefoxBrowser","OperaBrowser","SafariBrowser","UnknownBrowser","VivaldiBrowser","postIdentityToken","Accept","identityToken","getClientType","env","getIdentityUrl","qsStringify","getCredentials","responseJson","isJsonResponse","TwoFactorProviders2","reject","refreshIdentityToken","doAuthRefresh","postAuthRequest","postAdminAuthRequest","getAuthResponse","path","getAuthRequest","getAuthRequests","getLastAuthRequest","activeRequests","m","getProfile","getUserSubscription","getTaxInfo","putProfile","putTaxInfo","postPrelogin","postEmailToken","postEmail","postPassword","setPassword","postSecurityStamp","getAccountRevisionDate","postPasswordHint","postRegister","postPremium","postReinstatePremium","postAccountStorage","postAccountPayment","postAccountLicense","postAccountKeys","postAccountVerifyEmail","postAccountVerifyEmailToken","postAccountVerifyPassword","postAccountRecoverDelete","postAccountRecoverDeleteToken","postAccountKdf","deleteSsoUser","getSsoUserIdentifier","postUserApiKey","postUserRotateApiKey","putUpdateTempPassword","getUserBillingHistory","getUserBillingPayment","getCipher","getFullCipherDetails","getCipherAdmin","getCiphersOrganization","postCipher","postCipherCreate","postCipherAdmin","putCipher","putPartialCipher","putCipherAdmin","deleteCipher","deleteCipherAdmin","deleteManyCiphers","deleteManyCiphersAdmin","putMoveCiphers","putShareCipher","putShareCiphers","putCipherCollections","putCipherCollectionsAdmin","postPurgeCiphers","putDeleteCipher","putDeleteCipherAdmin","putDeleteManyCiphers","putDeleteManyCiphersAdmin","putRestoreCipher","putRestoreCipherAdmin","putRestoreManyCiphers","putRestoreManyCiphersAdmin","getAttachmentData","emergencyAccessId","postCipherAttachment","postCipherAttachmentLegacy","postCipherAttachmentAdminLegacy","deleteCipherAttachment","deleteCipherAttachmentAdmin","postShareCipherAttachment","renewAttachmentUploadUrl","postAttachmentFile","getCollectionAccessDetails","getUserCollections","getCollections","getManyCollectionsWithAccessDetails","getCollectionUsers","postCollection","putCollection","putCollectionUsers","deleteCollection","deleteManyCollections","deleteCollectionUser","getGroupUsers","deleteGroupUser","getPlans","postPublicImportDirectory","getTaxRates","getSettingsDomains","putSettingsDomains","getSync","getTwoFactorProviders","getTwoFactorOrganizationProviders","getTwoFactorAuthenticator","getTwoFactorEmail","getTwoFactorDuo","getTwoFactorOrganizationDuo","getTwoFactorYubiKey","getTwoFactorWebAuthn","getTwoFactorWebAuthnChallenge","getTwoFactorRecover","putTwoFactorAuthenticator","putTwoFactorEmail","putTwoFactorDuo","putTwoFactorOrganizationDuo","putTwoFactorYubiKey","putTwoFactorWebAuthn","getClientExtensionResults","AttestationObject","clientDataJson","deleteTwoFactorWebAuthn","putTwoFactorDisable","putTwoFactorOrganizationDisable","postTwoFactorRecover","postTwoFactorEmailSetup","postTwoFactorEmail","getDeviceVerificationSettings","putDeviceVerificationSettings","getCloudCommunicationsEnabled","getOrganizationConnection","createOrganizationConnection","updateOrganizationConnection","organizationConnectionId","deleteOrganizationConnection","getProviderUsers","getProviderUser","postProviderUserInvite","postProviderUserReinvite","postManyProviderUserReinvite","postProviderUserBulkConfirm","deleteManyProviderUsers","postProviderUserAccept","postProviderUserConfirm","postProviderUsersPublicKey","putProviderUser","deleteProviderUser","getProviderClients","postProviderAddOrganization","postProviderCreateOrganization","deleteProviderOrganization","getEvents","addEventParameters","getEventsCipher","getEventsOrganization","getEventsOrganizationUser","getEventsProvider","getEventsProviderUser","postEventsCollect","authHeader","Authorization","getEventsUrl","getUserPublicKey","getHibpBreach","postBitPayInvoice","postSetupPayment","getActiveBearerToken","handleError","getKeyConnectorAlive","getOrganizationExport","getApplicationVersionNumber","nativeFetch","preValidateSso","postCreateSponsorship","sponsoredOrgId","isSelfHost","getSponsorshipSyncStatus","deleteRevokeSponsorship","sponsoringOrganizationId","deleteRemoveSponsorship","sponsoringOrgId","postPreValidateSponsorshipToken","sponsorshipToken","postRedeemSponsorship","postResendSponsorshipOffer","doRefreshToken","doApiTokenRefresh","decodedToken","getVaultTimeoutByUserId$","deviceRequest","hasResponse","alterHeaders","pathParts","requestUrl","requestInit","responseType","responseIsJson","tokenError","isTextResponse","Message","hasBaseUrl","base","typeHeader","AuditService","passwordLeaked","hashBytes","hashStart","hashEnding","breachedAccounts","limit","throttleKey","allThrottles","throttles","getThrottles","argsThrottleKey","queue","exec","splice","EventData","EventCollectionService","eventUploadService","collect","eventType","uploadImmediately","eventStore","events","uploadEvents","orgIds$","cipher$","authStatus","orgIds","zip","User_ClientExportedVault","EventRequest","EventUploadService","checkOnInterval","takeEvents","req","taken","current","NotificationResponse","contextId","SyncCipherCreate","SyncCipherDelete","SyncCipherUpdate","SyncLoginDelete","SyncCipherNotification","SyncFolderCreate","SyncFolderDelete","SyncFolderUpdate","SyncFolderNotification","SyncVault","SyncCiphers","SyncOrganizations","SyncOrgKeys","SyncSettings","UserNotification","SyncSendCreate","SyncSendUpdate","SyncSendDelete","SyncSendNotification","AuthRequestPushNotification","NotificationsService","authRequestService","connected","inactive","reconnectTimer","subscribe","getNotificationsUrl","signalrConnection","off","stop","withUrl","accessTokenFactory","skipNegotiation","transport","WebSockets","withHubProtocol","on","processNotification","onclose","reconnect","isAuthedAndUnlocked","updateConnection","sync","reconnectFromActivity","disconnectFromInactivity","isAuthenticated","getIsAuthenticated","payloadUserId","UserId","myUserId","syncUpsertCipher","syncDeleteCipher","syncUpsertFolder","syncDeleteFolder","syncUpsertSend","syncDeleteSend","notificationId","LUNR_SEARCH_INDEX","LUNR_SEARCH_INDEXED_ENTITY_ID","LUNR_SEARCH_INDEXING","SearchService","searchIndexState","index$","searchIndex","lunr","Index","load","searchIndexEntityIdState","indexedEntityId$","searchIsIndexingState","searchIsIndexing$","indexing","immediateSearchLocales","defaultSearchableMinLength","searchableMinLength","locale$","registeredPipeline","Pipeline","registerFunction","normalizeAccentsPipelineFunction","clearIndex","isSearchable","query","normalizeSearchQuery","index","getIndexForSearch","indexCiphers","indexedEntityId","getIsIndexing","setIsIndexing","setIndexedEntityIdForSearch","builder","Builder","pipeline","ref","boost","extractor","uriExtractor","fieldExtractor","attachmentExtractor","setIndexForSearch","searchCiphers","searchCiphersBasic","ciphersMap","searchResults","soWild","Query","wildcard","LEADING","TRAILING","q","tokenizer","term","deleted","loginUri","searchSends","sendsMatched","lowPriorityMatched","concat","joined","Text","protocolIndex","queryIndex","searchableFields","metadata","normalize","VaultTimeoutSettingsService","defaultVaultTimeout","setVaultTimeoutOptions","action","setVaultTimeout","setVaultTimeoutAction","refreshAdditionalKeys","availableVaultTimeoutActions$","getAvailableVaultTimeoutActions","biometricUnlockPromise","getMaxVaultTimeoutPolicyByUserId$","currentVaultTimeout","maxVaultTimeoutPolicy","determineVaultTimeout","catchError","maxVaultTimeoutPolicyData","currentVaultTimeoutAction","determineVaultTimeoutAction","availableVaultTimeoutActions","Lock","availableActions","clearPinKeys","DefaultBoundaries","freeze","minDigits","minSpecialCharacters","initializeBoundaries","PasswordGeneratorOptionsEvaluator","createBoundary","defaultBoundary","structuredClone","numberCount","specialCount","minConsistentLength","minPolicyLength","policyInEffect","useUppercase","useLowercase","useNumbers","useSpecial","applyPolicy","fitToBounds","boundaries","withUpperBound","sanitize","cascade","enabledResult","DefaultPasswordGenerationOptions","BufferedKeyDefinition","toKeyDefinition","shouldOverwrite","dependency","input","SecretClassifier","disclosed","allSecret","disclose","newDisclosed","exclude","excludedPropertyName","newExcluded","classify","excludedProp","disclosedProp","declassify","cleaned","merged","SecretKeyDefinition","classifier","deconstruct","reconstruct","toEncryptedStateKey","inner","GeneratedCredential","category","generationDate","GeneratedPasswordHistory","GENERATOR_SETTINGS","PASSWORD_SETTINGS","PASSPHRASE_SETTINGS","EFF_USERNAME_SETTINGS","CATCHALL_SETTINGS","SUBADDRESS_SETTINGS","ADDY_IO_FORWARDER","DUCK_DUCK_GO_FORWARDER","FASTMAIL_FORWARDER","FIREFOX_RELAY_FORWARDER","FORWARD_EMAIL_FORWARDER","SIMPLE_LOGIN_FORWARDER","ADDY_IO_BUFFER","DUCK_DUCK_GO_BUFFER","FASTMAIL_BUFFER","FIREFOX_RELAY_BUFFER","FORWARD_EMAIL_BUFFER","SIMPLE_LOGIN_BUFFER","GENERATOR_HISTORY","GENERATOR_HISTORY_BUFFER","history","decryptor","reduceCollection","distinctIfShallowMatch","previous","isDistinct","DisabledPasswordGeneratorPolicy","leastPrivilege","useUpper","useLower","minNumbers","PasswordGeneratorStrategy","legacy","durableState","defaults$","toEvaluator","generate","generatePassword","PasswordGeneratorPolicyOptions","defaultType","minNumberWords","inEffect","clone","EFFLongWordList","DefaultPassphraseGenerationOptions","PassphraseGeneratorOptionsEvaluator","DefaultOptions","DefaultPolicy","PasswordGenerationService","generatePassphrase","positions","shuffleArray","allCharSet","lowercaseCharSet","uppercaseCharSet","numberCharSet","specialCharSet","positionChars","randomCharIndex","randomNumber","listLength","wordList","wordIndex","appendRandomNumberToRandomWord","getOptions$","getOptions","getPasswordGenerationOptions","setPasswordGenerationOptions","enforcePasswordGeneratorPoliciesOnOptions","getPasswordGeneratorPolicyOptions","evaluator","withPolicy","sanitized","saveOptions","getHistory","hasUserKey","getDecryptedPasswordGenerationHistory","getEncryptedPasswordGenerationHistory","decryptHistory","setDecryptedPasswordGenerationHistory","addHistory","currentHistory","matchesPrevious","unshift","pop","newHistory","encryptHistory","setEncryptedPasswordGenerationHistory","num","j","DefaultGeneratorService","strategy","tuning","_evaluators$","policyCacheMs","options$","evaluator$","createEvaluator","enforcePolicy","evaluated","BufferedState","dependency$","bufferedState","hasValue$","overwriteDependency$","overwrite$","hasValue","overwriteOutput","output$","emit","bufferedState$","buffered","normalized","DataPacker","DATA_PACKING","divider","hasInvalidPadding","PaddedDataPacker","frameSize","pack","separatorLength","payloadLength","paddingLength","unpack","frameEndIndex","dataStartIndex","dataEndIndex","paddingStartIndex","SecretState","encryptor","encryptedState","declassifyAll","declassifyItem","declassified","decryptTasks","classifyItem","classified","classifyAll","classifyTasks","latestClassified","latestCombined","latest","combined","latestDeclassified","updatedDeclassified","updatedClassified","UserEncryptor","UserKeyEncryptor","keyService","dataPacker","assertHasValue","packed","unpacked","GeneratorHistoryService","LegacyPasswordHistoryDecryptor","LocalGeneratorHistoryService","maxTotal","_credentialStates","track","getCredentialState","removeAt","Infinity","credentialIndex","credentials$","createSecretState","packer","decryptor$","DefaultGeneratorNavigation","GeneratorNavigationEvaluator","preferPassword","DisabledGeneratorNavigationPolicy","DefaultGeneratorNavigationService","applied","DisabledPassphraseGeneratorPolicy","PassphraseGeneratorStrategy","LegacyPasswordGenerationService","navigation","passwords","passphrases","getRawOptions$","withSequenceNumber","observable$","activeUser","pairwise","passwordPrevious","passphrasePrevious","generatorPrevious","passwordOptions","passwordDefaults","passwordEvaluator","passwordCurrent","passphraseOptions","passphraseDefaults","passphraseEvaluator","passphraseCurrent","generatorOptions","generatorDefaults","generatorEvaluator","generatorCurrent","policyUpdated","passwordOptionsWithPolicy","passphraseOptionsWithPolicy","generatorOptionsWithPolicy","toPasswordGeneratorOptions","navigationEvaluator","navigationApplied","navigationSanitized","toStoredOptions","navigationOptions$","defaults","navigationOptions","each","toGeneratedPasswordHistory","history$","DefaultPolicyEvaluator","DefaultEffUsernameOptions","website","EffUsernameGeneratorStrategy","usernameService","generateWord","DefaultCatchallOptions","CatchallGeneratorStrategy","generateCatchall","DefaultSubaddressOptions","SubaddressGeneratorStrategy","generateSubaddress","AnonAddyForwarder","anonaddy","redirect","statusText","DuckDuckGoForwarder","FastmailForwarder","accountId","getAccountId","forDomain","using","methodCalls","emailPrefix","methodResponses","created","notCreated","primaryAccounts","FirefoxRelayForwarder","generated_for","full_address","ForwarderOptions","FastmailForwarderOptions","AnonAddyForwarderOptions","forwardemail","ForwardEmailForwarderOptions","simplelogin","SimpleLoginForwarderOptions","SimpleLoginForwarder","Authentication","note","alias","ForwardEmailForwarder","labels","UsernameGenerationService","generateUsername","generateForwarded","word","zeroPad","atIndex","emailBeginning","emailEnding","subaddressString","randomString","startString","forwarderOptions","getUsernameGenerationOptions","setUsernameGenerationOptions","charSet","width","GeneratorStrategy","ForwarderGeneratorStrategy","durableStates","createState","secretState","canDecrypt$","rolloverKey","Forwarders","AddyIo","validForSelfHosted","DuckDuckGo","Fastmail","FirefoxRelay","ForwardEmail","SimpleLogin","DefaultAddyIoOptions","AddyIoForwarder","descriptionId","DefaultDuckDuckGoOptions","DefaultFastmailOptions","errorDescription","DefaultFirefoxRelayOptions","DefaultForwardEmailOptions","messageKey","DefaultSimpleLoginOptions","noteId","LegacyUsernameGenerationService","catchallOptions","catchallDefaults","effUsernameOptions","effUsernameDefaults","subaddressOptions","subaddressDefaults","addyIoOptions","addyIoDefaults","duckDuckGoOptions","duckDuckGoDefaults","fastmailOptions","fastmailDefaults","firefoxRelayOptions","firefoxRelayDefaults","forwardEmailOptions","forwardEmailDefaults","simpleLoginOptions","simpleLoginDefaults","toUsernameOptions","PasswordStrengthService","getPasswordStrength","emailInput","userInputs","globalUserInputs","emailToUserInputs","finalUserInputs","atPosition","SendFileData","SendTextData","SendData","File","SendRequest","fileLength","SendAccessResponse","creatorIdentifier","SendFileDownloadDataResponse","SendFileUploadDataResponse","sendResponse","SendApiService","fileUploadService","sendService","getSend","postSendAccess","getSendFileDownloadData","getSends","postSend","postFileTypeSend","renewSendFileUploadUrl","sendId","fileId","postSendFile","postSendFileLegacy","putSend","putSendRemovePassword","deleteSend","sendData","removePassword","uploadDataResponse","generateMethods","legacyServerSendFileUpload","generatePostDirectCallback","generateRenewFileUploadUrlCallback","generateRollbackCallback","renewResponse","SEND_USER_ENCRYPTED","SEND_USER_DECRYPTED","SendStateProvider","activeUserEncryptedState","encryptedState$","activeUserDecryptedState","decryptedState$","getEncryptedSends","setEncryptedSends","getDecryptedSends","setDecryptedSends","SendFileView","SendTextView","maskedText","SendView","urlB64Key","maxAccessCountReached","expired","pendingDelete","cryptoKey","SendFile","SendText","Send","makeSendKey","SendWithIdRequest","SendService","sendKeySalt","sendKeyPurpose","sends$","sendViews$","decryptSends","fileData","passwordKey","encryptFileData","parseFile","oldSends","newSends","oldSend","newSend","getAllDecryptedFromState","decSends","getRotatedKeys","originalUserKey","toRotatedKeyRequestMap","rotateUserKey","sendKey","reader","FileReader","readAsArrayBuffer","onload","evt","onerror","decryptSendPromises","decryptedSends","SortedCiphersCache","comparator","sortedCiphersByUrl","timeouts","isCached","addCiphers","Ciphers","resetTimer","getLastUsed","getLastLaunched","getNext","updateLastUsedIndex","lastUsedIndex","usedCiphers","lastLaunched","getNextIndex","CipherBulkDeleteRequest","CipherBulkMoveRequest","CipherBulkRestoreRequest","AttachmentRequest","CipherRequest","lastKnownRevisionDate","keyApi","attachments2","attachmentRequest","CipherWithIdRequest","CipherBulkShareRequest","CipherBulkUpdateCollectionsRequest","removeCollections","CipherCollectionsRequest","CipherCreateRequest","CipherPartialRequest","CipherShareRequest","ENCRYPTED_CIPHERS","DECRYPTED_CIPHERS","LOCAL_DATA_KEY","ADD_EDIT_CIPHER_INFO_KEY","addEditCipherInfo","CIPHER_KEY_ENC_MIN_SERVER_VER","CipherService","viewFor$","cipherViews$","views","searchService","cipherFileUploadService","sortedCiphersCache","sortCiphersByLastUsed","localDataState","encryptedCiphersState","decryptedCiphersState","addEditCipherInfoState","ciphersExpectingUpdate","localData$","ciphers$","skipWhile","expectingUpdate","addEditCipherInfo$","setDecryptedCipherCache","setDecryptedCiphers","cipherViews","clearCache","clearDecryptedCiphersState","keyForEncryption","keyForCipherKeyDecryption","originalCipher","updateModelfromExistingCipher","adjustPasswordHistoryLength","getCipherKeyEncryptionEnabled","userOrOrgKey","encryptCipherWithCipherKey","encryptCipher","encryptAttachments","attachmentsModel","encAttachments","encryptObjProperty","encryptFields","fieldsModel","encFields","encField","encryptField","fieldModel","encryptPasswordHistories","phModels","encPhs","encPh","encryptPasswordHistory","phModel","decCiphers","getDecryptedCiphers","reindexCiphers","decryptCiphers","cipherDecryptionKeys$","orgKeys","grouped","groupedCiphers","getLocaleSortingFunction","getAllDecryptedForGrouping","groupingId","folder","getAllDecryptedForUrl","includeOtherTypes","defaultMatch","filterCiphersForUrl","cipherIsLogin","getAllFromApiForOrganization","decryptOrganizationCiphersResponse","getManyFromApiForOrganization","cr","getLastUsedForUrl","getCipherForUrl","getLastLaunchedForUrl","getNextCipherForUrl","updateLastUsedIndexForUrl","updateLastUsedDate","ciphersLocalData","decryptedCipherCache","cached","updateLastLaunchedDate","saveNeverDomain","createWithServer","orgAdmin","isNotClone","shareWithServer","attachmentPromises","shareAttachmentWithServer","encCipher","encryptSharedCipher","shareManyWithServer","encCiphers","saveAttachmentWithServer","unencryptedFile","admin","cData","saveAttachmentRawWithServer","filename","cipherKeyEncryptionEnabled","cipherEncKey","encFileName","dataEncKey","makeDataEncKey","encData","saveCollectionsWithServer","bulkUpdateCollectionsWithServer","cid","updateEncryptedCipherState","updatedCiphers","clearEncryptedCiphersState","moveManyWithServer","deleteWithServer","asAdmin","deleteManyWithServer","deleteAttachment","deleteAttachmentWithServer","aLastUsed","bLastUsed","bothNotNull","sortCiphersByLastUsedThenName","aName","bName","softDelete","setDeletedDate","softDeleteWithServer","softDeleteManyWithServer","restore","clearDeletedDate","restoreWithServer","restoreManyWithServer","restores","setAddEditCipherInfo","existingCipher","existingHiddenFields","Hidden","hiddenFields","ef","matchedField","attachmentView","attachmentResponse","encBuf","decBuf","decryptFromBytes","theObj","modelProp","encryptCipherData","uriHash","viewKey","domainKey","getAutofillOnPageLoadDefault","lastUsed","autofillOnPageLoadDefault","clearSortedCiphers","keyForCipherKeyEncryption","decryptedCipherKey","makeCipherKey","CollectionData","CollectionView","Collection","canEditItems","org","v1FlexibleCollections","restrictProviderAccess","canEdit","canDelete","canDeleteManagedCollections","canViewCollectionInfo","orgKey","TreeNode","node","parent","children","ServiceUtils","nestedTraverse","nodeTree","partIndex","delimiter","partName","newPartName","getTreeNodeObject","getTreeNodeObjectFromList","ENCRYPTED_COLLECTION_DATA_KEY","jsonData","DECRYPTED_COLLECTION_DATA_KEY","collection","collectionService","decryptMany","CollectionService","decryptedCollectionViews$","decryptedCollections$","encryptedCollectionDataState","encryptedCollections$","decryptedCollectionDataState","clearActiveUserCache","decCollections","activeUserOrgKeys$","cs","getAllNested","nodes","collectionCopy","getNested","toUpdate","CipherFileUploadService","adminRequest","legacyServerAttachmentFileUpload","FolderData","FolderRequest","FolderApiService","folderService","postFolder","putFolder","deleteFolder","FolderView","Folder","FOLDER_ENCRYPTED_FOLDERS","FOLDER_DECRYPTED_FOLDERS","decryptFolders","FolderService","encryptedFoldersState","decryptedFoldersState","folders$","folderData","folderViews$","getAllFromState","updates","cId","decryptFolderPromises","decryptedFolders","noneFolder","SyncNotifierService","_sync","sync$","ProviderData","CoreSyncService","folderApiService","sendApiService","syncInProgress","getLastSync","setLastSync","isEdit","syncStarted","localFolder","remoteFolder","syncCompleted","localCipher","checkCollections","remoteCipher","localSend","remoteSend","successfully","SyncService","keyConnectorService","providerService","avatarService","billingAccountProfileStateService","forceSync","allowThrowOnError","needsSync","needsSyncing","syncProfile","syncFolders","syncCollections","syncCiphers","syncSends","syncSettings","syncPolicies","stamp","setPrivateKey","setProviderKeys","setOrgKeys","setForceSetPasswordReasonIfNeeded","syncProfileOrganizations","profileResponse","AdminForcePasswordReset","TdeUserWithoutPasswordHasPasswordResetPermission","eqDomains","B32Chars","SteamChars","TotpService","getCode","period","digits","keyB32","isOtpAuth","isSteamAuth","digitParams","periodParam","algParam","epoch","timeHex","leftPad","decToHex","timeBytes","keyBytes","b32ToBytes","fullCode","trunc","pow","getTimeInterval","b32ToHex","cleanedInput","bits","hex","byteIndex","chunk","SHOW_CARDS_CURRENT_TAB","SHOW_IDENTITIES_CURRENT_TAB","VaultSettingsService","enablePasskeysState","showCardsCurrentTabState","showCardsCurrentTab$","showIdentitiesCurrentTabState","showIdentitiesCurrentTab$","setShowCardsCurrentTab","setShowIdentitiesCurrentTab","setEnablePasskeys","ImportApiService","postImportCiphers","postImportOrganizationCiphers","ImportCiphersRequest","folderRelationships","ImportOrganizationCiphersRequest","collectionRelationships","KvpRequest","CollectionRequest","CollectionWithIdRequest","FolderWithIdRequest","newLineRegex","passwordFieldNames","usernameFieldNames","notesFieldNames","uriFieldNames","parseCsvOptions","encoding","skipEmptyLines","parseXml","validateNoExternalEntities","doc","DOMParser","parseFromString","querySelector","parseCsv","header","parseOptions","splitNewLine","errors","row","parseSingleRowCsv","rowData","parsedRow","makeUriArray","fixUri","returnArr","nameFromUrl","getValueOrDefault","setCardExpiration","expiryRegex","expiryMatch","moveFoldersToCollections","querySelectorDirectChild","parentEl","els","querySelectorAllDirectChild","querySelectorAll","el","parentNode","initLoginCipher","cleanupCipher","processKvp","processFolder","folderName","addRelationship","folderIndex","addFolder","convertToNoteIfNeeded","Generic","processFullName","nameParts","AscendoCsvImporter","fieldLower","AvastCsvImporter","AvastJsonImporter","logins","custName","pwd","loginName","label","cards","holderName","cardNumber","cvv","AviraCsvImporter","secondary_username","BlackBerryCsvImporter","grouping","fav","extra","ChromeCsvImporter","androidPatternRegex","BitwardenCsvImporter","col","addCollection","collectionIndex","delimPosition","login_totp","login_username","login_password","login_uri","safeGetString","CardExport","template","toView","toDomain","FieldExport","IdentityExport","Fido2CredentialExport","LoginUriExport","LoginExport","PasswordHistoryExport","SecureNoteExport","CipherExport","CipherWithIdExport","CollectionExport","CollectionWithIdExport","FolderExport","FolderWithIdExport","BitwardenJsonImporter","parseEncrypted","parseDecrypted","encKeyValidation_DO_NOT_EDIT","encKeyValidation","groupingsMap","parseCollections","parseFolders","folderView","collectionView","BitwardenPasswordProtectedImporter","promptForPassword_callback","parsedData","passwordProtected","cannotParseFile","checkPassword","clearTextData","jdoc","BlurCsvImporter","OfficialProps","ButtercupCsvImporter","processingCustomFields","ClipperzHtmlImporter","textarea","textContent","entry","property","actionType","labelLower","CodebookCsvImporter","Category","Favorite","Entry","Note","TOTP","Website","Account","_mappedCredentialsColumns","_mappedPersonalInfoAsIdentityColumns","_mappedSecureNoteColumns","DashlaneCsvImporter","parsePersonalInformationRecordAsIdentity","rowKeys","parseCredentialsRecord","parsePaymentRecord","parseIdRecord","parsePersonalInformationRecord","parseSecureNoteRecords","otpSecret","importUnmappedFields","account_name","mappedValues","cc_number","expiration_month","expiration_year","account_holder","account_number","first_name","middle_name","last_name","item_name","dataRow","phone_number","HandledResults","DashlaneJsonImporter","ADDRESS","processAddress","AUTHENTIFIANT","processAuth","BANKSTATEMENT","processNote","IDCARD","PAYMENTMEANS_CREDITCARD","processCard","IDENTITY","processIdentity","secondaryLogin","pseudo","addressName","addressFull","zipcode","bank","owner","nameProperty","EncryptrCsvImporter","Label","Notes","CVV","Expiry","expParts","EnpassCsvImporter","firstRow","containsField","fieldValue","fieldName","fieldNameLower","androidUrlRegex","EnpassJsonImporter","foldersMap","foldersIndexMap","folderTree","buildFolderTree","flattenFolderTree","template_type","processLogin","cleanedValue","sensitive","uuid","parent_uuid","titlePrefix","tree","FirefoxCsvImporter","FskEntryTypesEnum","FSecureFskImporter","parseEntry","handleLoginEntry","CreditCard","handleCreditCardEntry","creditNumber","creditCvv","creditExpiry","GnomeJsonImporter","keyRing","display_name","attributes","username_value","attr","NotesHeader","ApplicationsHeader","WebsitesHeader","Delimiter","KasperskyTxtImporter","notesData","applicationsData","websitesData","workingData","parseDataCategory","applications","websites","w","nameKey","itemComment","itemCommentKey","colonIndex","KeePass2XmlImporter","KeePassFileNode","RootNode","rootGroup","traverse","isRootNode","groupPrefixName","groupName","nameEl","cipherIndex","entryString","valueEl","keyEl","attrs","ProtectInMemory","group","KeePassXCsvImporter","Group","KeeperCsvImporter","LastPassCsvImporter","hasFolder","buildBaseCipher","parseSecureNote","parseCard","parseIdentity","ccnum","cardCipher","profilename","firstname","lastname","ccname","cccsc","ccexp","ccexpParts","middlename","extraParts","processedNote","typeParts","mappedData","parseSecureNoteMapping","monthString","getMonth","processingNotes","extraPart","LogMeOnceCsvImporter","MeldiumCsvImporter","DisplayName","UserName","Url","MSecureCsvImporter","mappedBaseColumns","_mappedUserAccountColumns","_mappedCreditCardColumns","_mappedIdentityColumns","_mappedIdCardColumns","_mappedTwoFaColumns","_mappedUserNoteColumns","MykiCsvImporter","nickname","additionalInfo","twofaSecret","authToken","cardName","exp_month","exp_year","firstAddressLine","secondAddressLine","zipCode","idType","idName","idCountry","idNumber","content","NordPassCsvImporter","recordType","evaluateType","cardholdername","cardnumber","cvc","expirydate","full_name","OnePassword1PifImporter","line","trashed","processStandardItem","processWinOpVaultItem","overview","URLs","parsePasswordHistory","notesPlain","parseFields","sections","section","openContents","faveIndex","typeName","secureContents","maxSize","designationKey","valueKey","fieldDesignation","street","fieldType","CategoryEnum","LoginFieldTypeEnum","OnePassword1PuxImporter","vaults","categoryUuid","Database","WirelessRouter","Server","API_Credential","BankAccount","SoftwareLicense","EmailAccount","MedicalRecord","DriversLicense","OutdoorLicense","Membership","Passport","RewardsProgram","SocialSecurityNumber","favIndex","processOverview","processLoginFields","processDetails","processSections","tags","inputString","loginFields","loginField","designation","CheckBox","parseSectionFields","sectionTitle","anyField","getFieldName","extractValue","fillLogin","fillApiCredentials","fillCreditCard","fillBankAccount","fillIdentity","fillDriversLicense","fillOutdoorLicense","fillMembership","fillPassport","fillRewardsProgram","fillSSN","email_address","guarded","monthYear","historyItems","CipherImportContext","importRecord","lowerProperty","IgnoredProperties","OnePasswordCsvImporter","loginPropertyParsers","setLoginUsername","setLoginPassword","setLoginUris","creditCardPropertyParsers","setCreditCardNumber","setCreditCardVerification","setCreditCardCardholderName","setCreditCardExpiry","identityPropertyParsers","setIdentityFirstName","setIdentityInitial","setIdentityLastName","setIdentityUserName","setIdentityEmail","setIdentityPhone","setIdentityCompany","quoteChar","escapeChar","getProp","setNotes","setCipherType","altUsername","context","setKnownLoginValue","setKnownCreditCardValue","setKnownIdentityValue","setUnknownValue","getPropByRegexp","regexp","matchingKeys","getPropIncluding","includesMap","func","readableDate","OnePasswordMacCsvImporter","OnePasswordWinCsvImporter","setIdentityAddress","expSplit","PadlockCsvImporter","PassKeepCsvImporter","getValue","PasskyJsonImporter","passkyExport","PassmanJsonImporter","custom_fields","customField","field_type","PasspackCsvImporter","tagsJson","Tags","tagJson","__parsed_extra","fieldsJson","extraFields","fieldJson","PasswordAgentCsvImporter","newVersion","altFormat","PasswordBossJsonImporter","login_url","identifiers","valObj","expDate","getFullYear","cf","PasswordDragonXmlImporter","records","categoryText","accountName","tagName","PasswordSafeXmlImporter","passwordSafe","notesDelimiter","getAttribute","groupText","PasswordWalletTxtImporter","ProtonPassItemState","ProtonPassJsonImporter","TRASHED","loginContent","totpUri","extraField","creditCardContent","verificationNumber","PsonoJsonImporter","WEBSITE_mappedValues","APP_PWD_mappedValues","BOOKMARK_mappedValues","NOTES_mappedValues","TOTP_mappedValues","ENV_VARIABLES_mappedValues","GPG_mappedValues","psonoExport","handleItemParsing","parentName","folderHasItems","folderHasSubfolders","parsePsonoItem","parseWebsiteLogins","parseApplicationPasswords","parseEnvironmentVariables","parseTOTP","parseBookmarks","parseNotes","website_password_title","website_password_notes","website_password_username","website_password_password","website_password_url","website_password_auto_submit","website_password_url_filter","application_password_title","application_password_notes","application_password_username","application_password_password","bookmark_title","bookmark_notes","bookmark_url","note_title","note_notes","totp_title","totp_notes","totp_code","environment_variables_title","environment_variables_notes","environment_variables_variables","KvPair","parseGPG","mail_gpg_own_key_title","mail_gpg_own_key_public","mail_gpg_own_key_name","mail_gpg_own_key_email","mail_gpg_own_key_private","RememBearCsvImporter","trash","cardholder","expiryMonth","expMonthNumber","expiryYear","expYearNumber","RoboFormCsvImporter","Name","Pwd","Rf_fields","SafariCsvImporter","OTPAuth","SafeInCloudXmlImporter","labelEl","cardEl","labelIdEl","labelId","fieldEl","notesEl","candidates","choice","SaferPassCsvImporter","SecureSafeCsvImporter","urlField","Comment","SplashIdCsvImporter","parseFieldsToNotes","startIndex","StickyPasswordXmlImporter","loginNodes","loginNode","usernameText","passwordText","titleText","linkText","notesText","accountLogin","parentElement","buildGroupText","PropertiesToIgnore","TrueKeyCsvImporter","memo","kind","expiryDate","document_content","UpmCsvImporter","YotiCsvImporter","ZohoVaultCsvImporter","ChamberName","parseData","SecretData","CustomData","featuredImportOptions","regularImportOptions","ImportService","importApiService","getImportOptions","import","importer","fileContents","selectedImportTarget","importResult","SyntaxError","halfway","last","badData","setImportTarget","handleOrganizationalImport","handleIndividualImport","errorResponse","handleServerError","getImporter","format","getImporterInstance","itemType","importTarget","noCollectionRelationShips","cipherPos","relationships","noFolderRelationShips","newFolderName","ExportHelper","getFileName","extension","padNumber","getHours","getMinutes","getSeconds","padCharacter","numString","VaultExportService","individualVaultExportService","organizationVaultExportService","getExport","getPasswordProtectedExport","onlyManagedCollections","BaseVaultExportService","buildPasswordExport","clearText","encText","jsonDoc","buildCommonCipher","OrganizationVaultExportService","getEncryptedManagedExport","getOrganizationEncryptedExport","getDecryptedManagedExport","getOrganizationDecryptedExport","exportData","exportPromises","decCol","decCipher","buildCsvExport","buildJsonExport","BuildEncryptedExport","allDecCiphers","dC","allCiphers","encCollections","eC","collectionsMap","exportCiphers","IndividualVaultExportService","getEncryptedExport","getDecryptedExport","decFolders","SafariApp","sendMessageToApp","resolveNow","isSafariApi","messageId","MAX_SAFE_INTEGER","runtime","sendNativeMessage","responseData","BrowserClipboardService","copy","isClipboardApiSupported","clipboard","writeText","consoleLogService","useLegacyCopyMethod","read","useLegacyReadMethod","readText","isLegacyClipboardMethodSupported","textareaElement","document","createElement","style","position","appendChild","select","execCommand","removeChild","focus","queryCommandSupported","BrowserPlatformUtilsService","clipboardWriteCallback","biometricCallback","offscreenDocumentService","deviceCache","isFirefox","FirefoxExtension","isOpera","OperaExtension","isEdge","EdgeExtension","isVivaldi","VivaldiExtension","isChrome","ChromeExtension","isSafari","SafariExtension","Browser","chrome","opr","addons","safariVersion","shouldApplySafariHeightFix","isIE","isMacAppStore","isViewOpen","isPopupOpen","sendMessageWithResponse","lockTimeout","createNewTab","extensionPage","getApplicationVersion","manifest","getManifest","version_name","supportsWebAuthn","PublicKeyCredential","supportsDuo","windowContext","clearMs","handleClipboardWriteCallback","isManifestVersion","offscreenApiSupported","triggerOffscreenCopyToClipboard","triggerOffscreenReadFromClipboard","supportsBiometric","platformInfo","getPlatformInfo","os","authenticateBiometric","getAutofillKeyboardShortcut","autofillCommand","commands","shortcut","withDocument","offscreen","Reason","CLIPBOARD","registerContentScripts","registerContentScriptsPolyfill","contentScriptOptions","chromeProxy","NestedProxy","patternValidationRegex","gotScripting","scripting","gotNavigation","Proxy","arguments_","lastError","assertValidPattern","matchPattern","isValidPattern","getRawPatternRegex","protocol","pathname","replaceAll","patternToRegex","matchPatterns","castAllFramesTarget","allFrames","tabId","frameId","castArray","possibleArray","arrayOrUndefined","insertCSS","files","matchAboutBlank","runAt","ignoreTargetErrors","everyInsertion","frameIds","css","tabs","catchTargetInjectionErrors","assertNoCode","executeScript","normalizedFiles","injection","executions","injectContentScript","where","scripts","targets","injectContentScriptInSpecificTarget","injections","flatMap","script","match_about_blank","run_at","js","isOriginPermitted","contains","origins","matches","excludeMatches","pattern","matchesRegex","excludeMatchesRegex","inject","tabListener","navListener","addListener","webNavigation","onCommitted","onUpdated","registeredContentScript","unregister","removeListener","buildRegisterContentScriptsPolyfill","manifestVersion","manifest_version","expectedVersion","getWindow","windowId","getWindowById","getCurrentWindow","windows","getCurrent","populate","createWindow","removeWindow","updateWindowProperties","focusWindow","focused","getTabFromCurrentWindowId","tabsQueryFirst","active","WINDOW_ID_CURRENT","getTab","getTabFromCurrentWindow","currentWindow","getActiveTabs","tabsQuery","tabSendMessageData","tabSendMessage","sendMessage","sendTabsMessage","responseCallback","onWindowCreated","onCreated","getBackgroundPage","isBackgroundPage","getExtensionViews","fetchProperties","getViews","messageListener","onMessage","messageListener$","Observable","subscriber","handler","storageChangeListener","onChanged","trackedChromeEventListeners","setupUnloadListeners","_event","eventListener","addEventListener","arg","focusTab","highlighted","closePopup","isWebExtensionsApi","isFirefoxOnAndroid","finally","gaFilter","getUILanguage","i18n","reloadExtension","reload","reloadOpenWindows","exemptCurrentHref","currentHref","href","connectNative","application","isChromeApi","requestPermission","permission","permissionsGranted","getBrowserAction","browserAction","getSidebarAction","sidebarAction","captureVisibleTab","executeScriptInTab","scriptingApiDetails","injectImmediately","world","browserAutofillSettingsOverridden","checkOverrideStatus","levelOfControl","autofillAddressOverridden","privacy","services","autofillAddressEnabled","autofillCreditCardOverridden","autofillCreditCardEnabled","passwordSavingOverridden","passwordSavingEnabled","updateDefaultBrowserAutofillSettings","registerContentScriptsMv2","contentScripts","register","registerContentScriptsMv3","unregisterContentScriptsMv3","unregisterContentScripts","ContextMenusBackground","contextMenuClickedHandler","contextMenus","onClicked","sender","cipherAction","commandToRetry","contextMenuOnClickData","inSidebar","urlContainsSearchParams","inPopout","inSingleActionPopout","popoutKey","inPopup","getContentScrollY","scrollingContainer","getElementsByTagName","scrollTop","setContentScrollY","scrollYAmount","containerSelector","container","backgroundInitializationRequired","openPopout","extensionUrlPath","senderWindowId","singleActionKey","forceCloseExistingWindows","windowOptions","defaultPopoutWindowOptions","height","popupWidth","senderWindow","popoutWindowOptions","left","top","buildPopoutUrl","isSingleActionPopoutOpen","closeSingleActionPopout","delayClose","extensionUrl","getURL","openCurrentPagePopout","popoutUrl","parsedUrl","hashRoute","windowInfo","popoutTabs","shift","searchParam","searchValue","AuthPopoutType","extensionUnlockUrls","openUnlockPopout","senderTab","skipNotification","windowType","VaultPopoutType","viewVaultItem","addEditVaultItem","fido2Popout","openViewVaultItemPopout","promptWindowPath","queryParamToken","formatQueryString","queryString","openVaultItemPasswordRepromptPopout","openAddEditVaultItemPopout","cipherType","addEditCipherUrl","NotificationQueueMessageType","NotificationBackground","autofillService","userNotificationSettingsService","themeStateService","notificationQueue","extensionMessageHandlers","unlockCompleted","handleUnlockCompleted","bgGetFolderData","getFolderData","bgCloseNotificationBar","handleCloseNotificationBarMessage","bgAdjustNotificationBar","handleAdjustNotificationBarMessage","bgAddLogin","addLogin","bgChangedPassword","changedPassword","bgRemoveTabFromNotificationQueue","removeTabFromNotificationQueue","bgSaveCipher","handleSaveCipherMessage","bgNeverSave","saveNever","collectPageDetailsResponse","handleCollectPageDetailsResponseMessage","bgUnlockPopoutOpened","unlockVault","checkNotificationQueue","bgReopenUnlockPopout","bgGetEnableChangedPasswordPrompt","getEnableChangedPasswordPrompt","bgGetEnableAddedLoginPrompt","getEnableAddedLoginPrompt","bgGetExcludedDomains","getExcludedDomains","bgGetActiveUserServerConfig","getActiveUserServerConfig","getWebVaultUrlForNotification","getWebVaultUrl","handleExtensionMessage","messageResponse","setupExtensionMessageListener","cleanupNotificationQueue","doNotificationQueueCheck","currentTab","expires","tabDomain","queueMessage","sendNotificationQueueMessage","notificationQueueMessage","notificationType","typeData","isVaultLocked","wasVaultLocked","removeIndividualVault","importType","loginInfo","normalizedUsername","loginDomain","addLoginIsEnabled","pushAddLoginToQueue","usernameMatches","pushChangePasswordToQueue","changeData","currentPassword","passwordMatches","forms","getFormsWithPasswordFields","pushUnlockVaultToQueue","requestFilelessImport","pushRequestFilelessImportToQueue","saveOrUpdateCredentials","cipherView","getDecryptedCipherById","updatePassword","folderExists","newCipher","convertAddLoginQueueMessageToCipherView","editItem","PersonalOwnership","messageData","retryCommand","retryHandler","uriView","loginView","buildCipherIcon","iconsServerUrl","showFavicon","icon","image","fallbackImage","cardIcons","Visa","Mastercard","Amex","Discover","JCB","Maestro","UnionPay","RuPay","hostnameUri","imageEnabled","AutofillOverlayElement","AutofillOverlayPort","overlayLoginCiphers","pageDetailsForTab","userAuthStatus","expiredPorts","openAutofillOverlay","openOverlay","autofillOverlayElementClosed","overlayElementClosed","autofillOverlayAddNewVaultItem","addNewVaultItem","getAutofillOverlayVisibility","getOverlayVisibility","checkAutofillOverlayFocused","checkOverlayFocused","focusAutofillOverlayList","focusOverlayList","updateAutofillOverlayPosition","updateOverlayPosition","updateAutofillOverlayHidden","updateOverlayHidden","updateFocusedFieldData","setFocusedFieldData","storePageDetails","addEditCipherSubmitted","updateOverlayCiphers","deletedCipher","overlayButtonPortMessageHandlers","overlayButtonClicked","port","handleOverlayButtonClicked","closeAutofillOverlay","closeOverlay","forceCloseAutofillOverlay","overlayPageBlurred","checkOverlayListFocused","redirectOverlayFocusOut","overlayListPortMessageHandlers","checkAutofillOverlayButtonFocused","checkOverlayButtonFocused","fillSelectedListItem","fillSelectedOverlayListItem","getNewVaultItemDetails","viewSelectedCipher","handlePortOnConnect","isOverlayListPort","isOverlayButtonPort","storeOverlayPort","handleOverlayElementPortMessage","styleSheetUrl","translations","getTranslations","getOverlayCipherData","overlayElement","removePageDetails","setupExtensionMessageListeners","getIconsUrl","ciphersViews","overlayListPort","isOverlayCiphersPopulated","overlayCiphersArray","overlayCipherData","loginCipherIcon","overlayCipherId","pageDetails","pageDetailsMap","isPasswordRepromptRequired","totpCode","doAutoFill","fillNewPassword","allowTotpAutofill","overlayButtonPort","forceCloseOverlay","focusedFieldData","disconnect","styles","getOverlayListPosition","getOverlayButtonPosition","focusedFieldRects","paddingRight","paddingLeft","focusedFieldStyles","elementOffset","elementHeight","elementTopPosition","elementLeftPosition","fieldPaddingRight","display","portMessage","isFocusingFieldElement","isOpeningFullOverlay","formerAuthStatus","updateOverlayButtonAuthStatus","retryMessage","overlayPageTranslations","opensInANewWindow","translate","buttonPageTitle","toggleBitwardenVaultOverlay","listPageTitle","unlockYourAccount","unlockAccount","fillCredentialsFor","partialUsername","noItemsToShow","newItem","onConnect","storeExpiredOverlayPort","TabsBackground","main","notificationBackground","overlayBackground","handleWindowOnFocusChanged","focusedWindowId","updateCurrentTabData","handleTabOnActivated","handleTabOnReplaced","onReplacedRan","handleTabOnUpdated","changeInfo","onUpdatedRan","refreshBadge","refreshMenu","handleTabOnRemoved","setupTabEventListeners","onFocusChanged","onActivated","onReplaced","onRemoved","WebRequestBackground","webRequest","pendingAuthRequests","startListening","onAuthRequired","requestId","resolveAuthCredentials","onCompleted","completeAuthRequest","onErrorOccurred","authCredentials","MainContextMenuHandler","initRunning","initContextMenuItems","parentId","checkPremiumAccess","noCardsContextMenuItems","noIdentitiesContextMenuItems","noLoginsContextMenuItems","removeAll","contexts","menuItemId","loadOptions","optionId","sanitizedTitle","sanitizeContextMenuTitle","createChildItem","noAccess","noCards","option","noIdentities","noLogins","CipherContextMenuHandler","mainContextMenuHandler","ciphersByType","existingCiphersOfType","updateForCipher","ContextMenuClickedHandler","generatePasswordToClipboard","autofillAction","totpService","eventCollectionService","userVerificationService","getIdentifier","isCreateCipherAction","additionalCiphersToGet","parentMenuItemId","getCipherCreationType","Cipher_ClientCopiedPassword","AutofillPort","AutofillScript","properties","autosubmit","AutoFillConstants","UsernameFieldNames","TotpFieldNames","SearchFieldNames","FieldIgnoreList","PasswordFieldExcludeList","ExcludedAutofillLoginTypes","ExcludedAutofillTypes","ExcludedOverlayTypes","CreditCardAutoFillConstants","CardAttributes","CardAttributesExtended","CardHolderFieldNames","CardHolderFieldNameValues","CardNumberFieldNames","CardNumberFieldNameValues","CardExpiryFieldNames","CardExpiryFieldNameValues","ExpiryMonthFieldNames","ExpiryYearFieldNames","CVVFieldNames","CardBrandFieldNames","MonthAbbr","YearAbbrShort","YearAbbrLong","IdentityAutoFillConstants","IdentityAttributes","FullNameFieldNames","FullNameFieldNameValues","TitleFieldNames","FirstnameFieldNames","MiddlenameFieldNames","LastnameFieldNames","EmailFieldNames","AddressFieldNames","AddressFieldNameValues","Address1FieldNames","Address2FieldNames","Address3FieldNames","PostalCodeFieldNames","CityFieldNames","StateFieldNames","CountryFieldNames","PhoneFieldNames","UserNameFieldNames","CompanyFieldNames","IsoCountries","afghanistan","albania","algeria","andorra","angola","anguilla","antarctica","argentina","armenia","aruba","australia","austria","azerbaijan","bahamas","bahrain","bangladesh","barbados","belarus","belgium","belize","benin","bermuda","bhutan","bolivia","botswana","brazil","bulgaria","burundi","cambodia","cameroon","canada","chad","chile","china","colombia","comoros","congo","croatia","cuba","cyprus","denmark","djibouti","dominica","ecuador","egypt","eritrea","estonia","ethiopia","fiji","finland","france","gabon","gambia","georgia","germany","ghana","gibraltar","greece","greenland","grenada","guadeloupe","guam","guatemala","guernsey","guinea","guyana","haiti","honduras","hungary","iceland","india","indonesia","iraq","ireland","israel","italy","jamaica","japan","jersey","jordan","kazakhstan","kenya","kiribati","kuwait","kyrgyzstan","latvia","lebanon","lesotho","liberia","liechtenstein","lithuania","luxembourg","macao","macedonia","madagascar","malawi","malaysia","maldives","mali","malta","martinique","mauritania","mauritius","mayotte","mexico","moldova","monaco","mongolia","montenegro","montserrat","morocco","mozambique","myanmar","namibia","nauru","nepal","netherlands","nicaragua","niger","nigeria","niue","norway","oman","pakistan","palau","panama","paraguay","peru","philippines","pitcairn","poland","portugal","qatar","reunion","romania","rwanda","samoa","senegal","serbia","seychelles","singapore","slovakia","slovenia","somalia","spain","sudan","suriname","swaziland","sweden","switzerland","taiwan","tajikistan","tanzania","thailand","togo","tokelau","tonga","tunisia","turkey","turkmenistan","tuvalu","uganda","ukraine","uruguay","uzbekistan","vanuatu","venezuela","vietnam","yemen","zambia","zimbabwe","IsoStates","alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","ohio","oklahoma","oregon","pennsylvania","tennessee","texas","utah","vermont","virginia","washington","wisconsin","wyoming","IsoProvinces","alberta","manitoba","ontario","quebec","saskatchewan","AutofillService","scriptInjectorService","currentlyOpeningPasswordRepromptPopout","autofillScriptPortsSet","handleInjectedScriptPortConnection","onDisconnect","handleInjectScriptPortOnDisconnect","loadAutofillScriptsOnInstall","injectAutofillScriptsInAllTabs","startWith","previousSetting","currentSetting","handleInlineMenuVisibilityChange","reloadAutofillScripts","injectAutofillScripts","triggeringOnPageLoad","accountIsUnlocked","overlayVisibility","autoFillOnPageLoadIsEnabled","injectedScripts","getAutofillOnPageLoad","injectDetails","injectedScript","frame","formData","passwordFields","loadPasswordFields","passwordFieldsWithoutForm","pf","form","formKeys","formCount","soloFormKey","formKey","formPasswordFields","uf","findUsernameField","getShouldAutoCopyTotp","getDefaultUriMatchStrategy","canAccessPremium","didAutofill","pd","fillScript","generateFillScript","skipUsernameOnlyFill","onlyEmptyFields","onlyVisibleFields","tabUrl","untrustedIframe","allowUntrustedIframe","delay_between_operations","skipLastUsed","pageDetailsUrl","shouldAutoCopyTotp","Cipher_ClientAutofilled","doAutoFillOnTab","fromCommand","lastLaunchedCipher","userHasMasterPasswordAndKeyHash","isDebouncingPasswordRepromptPopout","doAutoFillActiveTab","getActiveTab","filledFields","fieldNames","opid","viewable","isSearchField","matchingIndex","findMatchingFieldIndex","matchingField","Linked","fillByOpid","generateLoginFillScript","generateCardFillScript","generateIdentityFillScript","usernames","totps","savedUrls","inUntrustedIframe","passField","findTotpField","elementNumber","fieldIsFuzzyMatch","autoCompleteType","totpValue","setFillScriptForFocus","fillFields","isExcludedFieldType","isFieldMatch","makeScriptAction","selectInfo","siOptions","fieldAttrsContain","maxLength","fullMonth","fullYear","partYear","makeScriptActionWithValue","pageUrl","containsVal","doesContain","filledState","stateLower","isoState","filledCountry","countryLower","isoCountry","isExcludedType","excludedTypes","matchFieldAttributeValues","htmlName","htmlID","placeholder","attrIndex","attributeKeywords","keywordIndex","searchFieldNamesSet","forCustomFieldsOnly","containsOptions","checkValueContains","cipherData","dataProp","fieldProp","dataValue","doFill","valueIsLikePassword","fieldHasDisqualifyingAttributeValue","checkedAttributeValues","valueIsOnExclusionList","checkedAttributeValue","canBeHidden","canBeReadOnly","mustBeEmpty","isPassword","readonly","testedValues","isLikePassword","passwordField","withoutForm","usernameField","totpField","names","fieldPropertyIsPrefixMatch","fieldPropertyIsMatch","separator","sepIndex","fieldVal","regexParts","csvParts","csvVals","fuzzyMatch","lastField","lastPasswordField","openPasswordRepromptPopoutDebounce","autofillOverlayVisibility","BrowserComponentState","BrowserGroupingsComponentState","collectionCounts","folderCounts","typeCounts","favoriteCiphers","noFolderCiphers","BrowserSendComponentState","groupings","sendType","UpdateBadge","badgeAction","badgeSettingsService","opts","setBadgeBackgroundColor","setLoggedOut","setLocked","setUnlocked","setBadgeIcon","clearBadgeText","setBadgeText","countText","isOperaSidebar","setActionText","setSideBarText","iconSuffix","setActionIcon","setSidebarActionIcon","setTitle","setIcon","useSyncApiCalls","lastFocusedWindow","HANDLED_ERRORS","logger","ChromeMessageSender","errorHandler","DefaultOffscreenDocumentService","workerCount","reasons","justification","documentExists","createDocument","closeDocument","hasDocument","BaseEncryptedOrganizationKey","fromData","EncryptedOrganizationKey","ProviderEncryptedOrganizationKey","isProviderEncrypted","toData","encryptedOrganizationKey","USER_KEY","CryptoService","platformUtilService","activeUserEverHadUserKey","everHadUserKey$","orgKeys$","storeAdditionalKeys","isLegacyUser","validateUserKey","keySuffix","getKeyFromStorage","clearAllStoredUserKeys","hasUserKeyInMemory","buildProtectedSymmetricKey","clearUserKey","clearStoredUserKey","setUserKeyAutoUnlock","clearDeprecatedKeys","Pin","userKeyMasterKey","getOrDeriveMasterKey","resolvedUserId","KdfConfig","encryptUserKeyWithMasterKey","hashPurpose","LocalAuthorization","storedPasswordHash","localKeyHash","serverKeyHash","ServerAuthorization","providerOrgs","encOrgKeyData","newSymKey","clearOrgKeys","encProviderKeys","getProviderKey","providerKeys$","clearProviderKeys","makeOrgKey","shareKey","userPublicKey$","encPrivateKey","getPrivateKey","userPrivateKey$","getFingerprint","fingerprintMaterial","keyFingerprint","userFingerprint","hashPhrase","clearKeyPair","keyMaterial","clearKeys","rval","range","bitsNeeded","log2","bytesNeeded","mask","byteArray","decryptPrivateKey","derivePublicKey","initAccount","shouldStoreKey","noPreExistingPersistentKey","getUserKeyAutoUnlock","minimumEntropy","entropyPerWord","hashArr","phrase","hashNumber","remainder","divide","encryptionKey","protectedSymKey","stretchedEncryptionKey","setCryptoMasterKeyAuto","encBuffer","userKeyWithLegacySupport$","pk","userPrivateKeyHelper$","userPrivateKey","legacySupport","providerKeysHelper$","project","inputRecord","encryptedProviderKeys","forkJoin","userKeys","BrowserCryptoService","EnvironmentState","GLOBAL_ENVIRONMENT_KEY","USER_ENVIRONMENT_KEY","GLOBAL_CLOUD_REGION_KEY","USER_CLOUD_REGION_KEY","PRODUCTION_REGIONS","icons","webVault","scim","EU","DEFAULT_REGION","DEFAULT_REGION_CONFIG","DefaultEnvironmentService","activeAccountId$","globalCloudRegionState","account$","oldUserId","newUserId","buildEnvironment","cloudWebVaultUrl$","getRegionConfig","availableRegions","additionalRegions","ADDITIONAL_REGIONS","setEnvironment","SelfHosted","isEmpty","formatUrl","keyConnector","regionConfig","CloudEnvironment","SelfHostedEnvironment","getEnvironment","getEnvironmentState","seedUserEnvironment","UrlEnvironment","getRegion","getUrls","getKeyConnectorUrl","getScimUrl","getSendUrl","isCloud","baseSuffix","BrowserEnvironmentService","hasManagedEnvironment","getManagedEnvironment","settingsHaveChanged","managedEnv","managed","setUrlsToManagedEnvironment","fromChromeEvent","serializationIndicator","AbstractChromeStorageService","chromeStorageApi","changes","mergeMap","change","processGetObject","objToStore","keyedObj","isSerialized","asSerialized","BrowserLocalStorageService","local","allStorage","resolved","BrowserMemoryStorageService","session","ScriptInjectorService","BrowserScriptInjectorService","mv3Details","getScriptFile","injectionDetails","buildInjectionDetails","mv2Details","globals","accountDeserializer","buildAccountMapFromJSON","jsonAccounts","partialKeys","DDG_SHARED_KEY","StateService","memoryStorageService","stateFactory","migrationRunner","hasBeenInited","isRecoveredSession","initOptions","runMigrations","setState","createGlobals","initAccountState","updateState","syncAccountFromDisk","diskAccount","getAccountFromDisk","scaffoldNewAccountStorage","reconcileOptions","defaultInMemoryOptions","deAuthenticateAccount","removeAccountFromDisk","removeAccountFromMemory","defaultSecureStorageOptions","saveSecureStorageKey","getUserKeyBiometric","hasUserKeyBiometric","setUserKeyBiometric","getCryptoMasterKeyB64","setCryptoMasterKeyB64","getCryptoMasterKeyBiometric","hasCryptoMasterKeyBiometric","getAccount","saveAccount","getDuckDuckGoSharedKey","setDuckDuckGoSharedKey","getEnableBrowserIntegration","getGlobals","defaultOnDiskOptions","enableBrowserIntegration","setEnableBrowserIntegration","saveGlobals","getEnableBrowserIntegrationFingerprint","enableBrowserIntegrationFingerprint","setEnableBrowserIntegrationFingerprint","setEnableDuckDuckGoBrowserIntegration","defaultOnDiskMemoryOptions","getMinimizeOnCopyToClipboard","minimizeOnCopyToClipboard","setMinimizeOnCopyToClipboard","defaultOnDiskLocalOptions","getGeneratorOptions","setGeneratorOptions","useMemory","getGlobalsFromMemory","useDisk","getGlobalsFromDisk","saveGlobalsToMemory","saveGlobalsToDisk","getAccountFromMemory","htmlStorageLocation","Local","Both","saveAccountToMemory","saveAccountToDisk","deepClone","scaffoldNewAccountLocalStorage","scaffoldNewAccountSessionStorage","scaffoldNewAccountMemoryStorage","storedAccount","requestedOptions","defaultOptions","Session","getActiveUserIdFromStorage","removeAccountFromLocalStorage","resetAccount","removeAccountFromSessionStorage","removeAccountFromSecureStorage","persistentAccountInformation","stateUpdater","updatedState","withPrototypeForArrayMembers","memberConstructor","memberConverter","originalResult","getOwnPropertyDescriptors","DefaultBrowserStateService","TranslationService","systemLanguage","localesDirectory","getLocalesJson","supportedTranslationLocales","defaultLocale","localeNames","defaultMessages","localeMessages","translationLocale","Intl","Collator","numeric","sensitivity","loadMessages","p1","p2","p3","messagesObj","formattedLocale","locales","placeholders","placeProp","replaceToken","replaceContent","translationLocaleState","userSetLocale$","setLocale","storedLocale","I18nService","getMessage","AbstractStorageService","portName","LocalBackedSessionStorageService","sessionKey","localStorage","ports","updatesSubject","listenerCallback","onMessageFromForeground","sendMessageTo","broadcastMessage","getLocalSessionValue","existingValue","compareValues","updateLocalSessionValue","sessionStorageKey","valueJson","originator","value1","value2","BackgroundPlatformUtilsService","MemoryStorageService","store","BackgroundMemoryStorageService","_ports","StorageServiceProvider","diskStorageService","defaultLocation","overrides","BrowserStorageServiceProvider","limitedMemoryStorageService","largeObjectMemoryStorageService","ForegroundMemoryStorageService","partitionName","_port","connect","_backgroundResponses$","handleInitialize","handleSubjectUpdate","delegateToBackground","FULL_SYNC_FINISHED","SyncServiceListener","listener$","DO_FULL_SYNC","doFullSync","ForegroundSyncService","syncCompletedPromise","fromChromeRuntimeMessaging","webExtSender","stateEventRunnerService","lockedCallback","loggedOutCallback","startCheck","checkVaultTimeout","userIdString","shouldLock","executeTimeoutAction","currentUserId","lockingUserId","lockPromise","vaultTimeoutSeconds","VaultTimeoutService","checkSafari","FilelessImporterInjectedScriptsConfig","LpSuppressImportDownload","mv2","mv3","FilelessImportType","FilelessImportPort","FilelessImporterBackground","importService","importNotificationsPortMessageHandlers","startFilelessImport","cancelFilelessImport","lpImporterPortMessageHandlers","displayLpImportNotification","displayFilelessImportNotification","startLpImport","triggerLpImport","filelessImporterPortNames","filelessImportFeatureFlagEnabled","filelessImportEnabled","handleImporterPortMessage","handleImporterPortDisconnect","lpImporterPort","importNotificationsPort","setupPortMessageListeners","triggerLpImporterCsvDownload","importErrorMessage","AbortManager","abortControllers","runWithAbortController","runner","Fido2ContentScript","Fido2ContentScriptId","Fido2PortName","Fido2Background","fido2ClientService","abortManager","fido2ContentScriptPortsSet","sharedInjectionDetails","sharedRegistrationOptions","fido2AbortRequest","abortRequest","fido2RegisterCredentialRequest","registerCredentialRequest","fido2GetCredentialRequest","getCredentialRequest","handleCredentialRequest","handleEnablePasskeysUpdate","injectFido2ContentScriptsInAllTabs","injectFido2ContentScripts","previousEnablePasskeysSetting","updateContentScriptRegistration","destroyLoadedFido2ContentScripts","updateMv2ContentScriptsRegistration","updateMv3ContentScriptsRegistration","isPasskeySettingEnabled","registeredContentScripts","abortedRequestId","SessionClosedError","BrowserFido2UserInterfaceService","BrowserFido2UserInterfaceSession","abortPopout","sessionId","confirmNewCredentialResponse","closed","connected$","destroy$","windowClosed$","fromEventPattern","receive","closeFido2Popout","complete","fallback","EmptyError","connectPromise","popoutId","openFido2Popout","VaultFilter","selectedCollection","selectedFolder","myVaultOnly","refreshCollectionsAndFolders","resetFilter","selectedCollectionId","selectedFolderId","resetOrganization","selectedOrganizationId","buildFilter","cipherPassesFilter","DynamicTreeNode","hasId","fullList","collapsedGroupingsState","collapsedGroupings$","storeCollapsedFilterNodes","collapsedFilterNodes","buildCollapsedFilterNodes","buildOrganizations","buildNestedFolders","transformation","storedFolders","orgCiphers","oc","nestedFolders","getAllFoldersNested","nestedList","buildCollections","storedCollections","nestedCollections","checkForSingleOrganizationPolicy","SingleOrg","checkForPersonalOwnershipPolicy","folderCopy","getFolderNested","VaultFilterService","vaultFilter","allVaults","myVault","setVaultFilter","getVaultFilter","filterCipherForSelectedVault","CommandsBackground","passwordGenerationService","vaultTimeoutService","processCommand","onCommand","autoFillLogin","openPopup","collectPageDetailsForContentScript","IdleBackground","notificationsService","idleTimer","idleState","idle","idleHandler","onStateChanged","setDetectionInterval","pollIdle","allUsers","queryState","NativeMessagingBackground","runtimeBackground","resolver","secureSetupResolve","onAdded","connecting","connectedCallback","sharedSecret","validatingFingerprint","acceptButtonText","cancelButtonText","showFingerprintDialog","showWrongUserDialog","timestamp","encryptMessage","secureCommunication","getResponse","rawMessage","abs","userKeyB64","encUserKeyPrim","processMessage","sendUnencrypted","fingerprint","RuntimeBackground","systemService","fido2Background","pageDetailsToAutoFill","onInstalledReason","lockedVaultPendingNotifications","onInstalled","checkOnInstalled","processMessageWithSender","autofillTimeout","autofillPage","sendBwInstalledMessageToVault","closeUnlockPopout","reseedStorage","vaultUrl","referrer","lastpass","resultData","authResultUrl","openSsoAuthResultPopout","twoFactorAuthData","twoFactorUrl","openTwoFactorAuthPopout","tabToAutoFill","loginToAutoFill","urlObj","runHeartbeat","startHeartbeat","bitwardenMain","popupOnlyContext","logoutReason","intraprocessMessagingSubject","sessionStorage","existingKey","memoryStorageForStateProviders","largeObjectMemoryStorageForStateProviders","mv3MemoryStorageCreator","syncNotifierService","policyApiService","passwordStrengthService","deprecatedService","legacyPasswordGenerationServiceFactory","deviceTrustService","devicesService","loginEmailService","ssoLoginService","vaultFilterService","containerService","sendStateProvider","syncServiceListener","auditService","exportService","fido2UserInterfaceService","fido2AuthenticatorService","forceWindowReload","nativeMessagingBackground","commandsBackground","filelessImporterBackground","tabsBackground","_tab","contextMenusBackground","idleBackground","usernameGenerationService","legacyUsernameGenerationServiceFactory","cipherContextMenuHandler","webRequestBackground","userAutoUnlockKeyService","bootstrap","setUserKeyInMemoryPromises","forLocked","nextAccountStatus","currentlyActiveAccount","switchPromise","userBeingLoggedOut","newActiveUser","logoutPromise","authenticationStatus","needStorageReseed","needsStorageReseed","responsePromise","override","syncInternal","lastSyncAgo","scheduleNextSync","syncTimeout","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","loaded","__webpack_modules__","O","chunkIds","fn","priority","notFulfilled","fulfilled","getPrototypeOf","__proto__","__esModule","ns","def","getOwnPropertyNames","defineProperty","enumerable","chunkId","Function","toStringTag","nmd","paths","scriptUrl","importScripts","currentScript","src","baseURI","installedChunks","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}
\usepackage{fontspec}
\usepackage{newunicodechar}
\usepackage{xcolor}

% Set main fonts
\setmainfont{Noto Serif}
\setsansfont{Noto Sans}
\setmonofont{Noto Sans Mono}
\setmathfont{Latin Modern Math}

% Prioritize monochrome emoji fonts for universal PDF compatibility
\IfFontExistsTF{Symbola}{
  \newfontfamily\emoji{Symbola}
}{
  \IfFontExistsTF{Noto Emoji}{
    \newfontfamily\emoji{Noto Emoji}
  }{
    \IfFontExistsTF{DejaVu Sans}{
      \newfontfamily\emoji{DejaVu Sans}
    }{
      \newfontfamily\emoji{Latin Modern Roman}
    }
  }
}

% Symbol font setup
\IfFontExistsTF{Apple Symbols}{
  \newfontfamily\symbolsfont{Apple Symbols}
}{
  \IfFontExistsTF{Symbola}{
    \newfontfamily\symbolsfont{Symbola}
  }{
    \IfFontExistsTF{Noto Sans Symbols}{
      \newfontfamily\symbolsfont{Noto Sans Symbols}
    }{
      \newfontfamily\symbolsfont{Latin Modern Roman}
    }
  }
}

% Enhanced emoji handling for PDF compatibility
\newcommand{\textemoji}[1]{%
  \begingroup
  \emoji
  \strut #1%
  \endgroup
}

% Define Unicode characters for maximum compatibility
\newunicodechar{â}{{\symbolsfont â†’}}
\newunicodechar{âœ…}{\textemoji{âœ…}}
\newunicodechar{ğŸ¯}{\textemoji{ğŸ¯}}
\newunicodechar{ğŸ¬}{\textemoji{ğŸ¬}}
\newunicodechar{ğŸ“¹}{\textemoji{ğŸ“¹}}
\newunicodechar{ğŸ§ }{\textemoji{ğŸ§ }}
\newunicodechar{ğŸ”§}{\textemoji{ğŸ”§}}
\newunicodechar{ğŸ“£}{\textemoji{ğŸ“£}}
\newunicodechar{ğŸ“ˆ}{\textemoji{ğŸ“ˆ}}
\newunicodechar{ğŸ”}{\textemoji{ğŸ”}}
\newunicodechar{ğŸ”œ}{\textemoji{ğŸ”œ}}
\newunicodechar{ğŸ¥}{\textemoji{ğŸ¥}}
\newunicodechar{ğŸ’„}{\textemoji{ğŸ’„}}
\newunicodechar{ğŸ› }{\textemoji{ğŸ› }}
\newunicodechar{ğŸ¤}{\textemoji{ğŸ¤}}

% Handle variation selector
\catcode`\ï¸=\active
\defï¸{}

% Arrow symbol
\DeclareTextCommand{\symbolarrow}{\encodingdefault}{{\symbolsfont â†’}}

% Emoji commands for Lua filter
\newcommand{\emojicheckmark}{\textemoji{âœ…}}
\newcommand{\emojitarget}{\textemoji{ğŸ¯}}
\newcommand{\emojifilm}{\textemoji{ğŸ¬}}
\newcommand{\emojivideo}{\textemoji{ğŸ“¹}}
\newcommand{\emojibrain}{\textemoji{ğŸ§ }}
\newcommand{\emojitool}{\textemoji{ğŸ”§}}
\newcommand{\emojimegaphone}{\textemoji{ğŸ“£}}
\newcommand{\emojichart}{\textemoji{ğŸ“ˆ}}
\newcommand{\emojisearch}{\textemoji{ğŸ”}}
\newcommand{\emojisoon}{\textemoji{ğŸ”œ}}
\newcommand{\emojimakeup}{\textemoji{ï¿½}}
\newcommand{\emojihandshake}{\textemoji{ğŸ¤}}

